generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlserver"
  url      = env("DATABASE_URL")
}

model User {
  id               String         @id @default(uuid())
  email            String         @unique @db.NVarChar(255)
  name             String?        @db.NVarChar(255)
  password         String?        @db.NVarChar(255)
  purchasedModules String         @default("[]") @db.NVarChar(Max)
  credits          Int            @default(0)
  createdAt        DateTime       @default(now()) @db.DateTime2
  updatedAt        DateTime       @updatedAt @db.DateTime2
  resetToken       String?        @db.NVarChar(255)
  resetTokenExpiry DateTime?      @db.DateTime2
  aircraft         UserAircraft[]
  memberships      GroupMember[]
  Booking          Booking[]
  FlightLog        FlightLog[]
  PartnershipProfile PartnershipProfile?

  @@map("User")
}

model UserAircraft {
  id        String   @id @default(uuid())
  userId    String
  nNumber   String   @db.NVarChar(10)
  nickname  String?  @db.NVarChar(100)
  notes     String?  @db.NVarChar(Max)
  createdAt DateTime @default(now()) @db.DateTime2
  updatedAt DateTime @updatedAt @db.DateTime2

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("UserAircraft")
}

model AircraftMaster {
  nNumber        String  @id @map("N_NUMBER") @db.NVarChar(10)
  name           String? @map("NAME") @db.NVarChar(255)
  typeRegistrant String? @map("TYPE_REGISTRANT") @db.NVarChar(50)
  lastActionDate String? @map("LAST_ACTION_DATE") @db.NVarChar(50)
  airWorthDate   String? @map("AIR_WORTH_DATE") @db.NVarChar(50)
  mfr            String? @map("MFR") @db.NVarChar(255)
  model          String? @map("MODEL") @db.NVarChar(255)
  serialNumber   String? @map("SERIAL_NUMBER") @db.NVarChar(255)
  engMfr         String? @map("ENG_MFR") @db.NVarChar(255)
  engineModel    String? @map("ENGINE_MODEL") @db.NVarChar(255)
  engCount       Int?    @map("ENG_COUNT") @db.Int
  statusCode     String? @map("STATUS_CODE") @db.NVarChar(50)

  @@map("AircraftMaster")
}

model AircraftPerformance {
  id                 Int       @id @default(autoincrement())
  designation        String    @db.VarChar(100)
  manufacturer       String?   @db.VarChar(100)
  model              String?   @db.VarChar(100)
  eis                String?   @db.VarChar(50)
  maxpax             Int?
  pax                Int?
  range_nm           String?   @db.VarChar(50)
  tofl               String?   @db.VarChar(50)
  mrw                String?   @db.VarChar(50)
  mtow               String?   @db.VarChar(50)
  mlw                String?   @db.VarChar(50)
  mzfw               String?   @db.VarChar(50)
  oew                String?   @db.VarChar(50)
  fuel               String?   @db.VarChar(50)
  engine_designation String?   @db.VarChar(100)
  alternate_engines  String?   @db.VarChar(100)
  num_engines        Int?
  thrust_sls         String?   @db.VarChar(50)
  thrust_max         String?   @db.VarChar(50)
  fuel_type          String?   @db.VarChar(50)
  fuel_density       String?   @db.VarChar(50)
  fuel_cap_usable    String?   @db.VarChar(50)
  fuel_cap_unusable  String?   @db.VarChar(50)
  span_ft            String?   @db.VarChar(50)
  length_ft          String?   @db.VarChar(50)
  height_ft          String?   @db.VarChar(50)
  tip_chord          String?   @db.VarChar(50)
  sweep_deg          String?   @db.VarChar(50)
  root_chord         String?   @db.VarChar(50)
  wing_area          String?   @db.VarChar(50)
  wingtip_device     String?   @db.VarChar(50)
  mac                String?   @db.VarChar(50)
  vmo_mo             String?   @db.VarChar(50)
  vc_cruise          String?   @db.VarChar(50)
  v_takeoff          String?   @db.VarChar(50)
  cruise_alt         String?   @db.VarChar(50)
  created_at         DateTime? @default(now()) @db.DateTime2

  @@map("AircraftPerformance")
}

model AircraftSpecs {
  id                     Int       @id @default(autoincrement())
  manufacturer           String    @db.NVarChar(100)
  model                  String    @db.NVarChar(255)
  length_ft              String?   @db.NVarChar(50)
  wingspan_ft            String?   @db.NVarChar(50)
  height_ft              String?   @db.NVarChar(50)
  takeoff_ground_roll_ft String?   @db.NVarChar(50)
  takeoff_over_50ft_ft   String?   @db.NVarChar(50)
  landing_ground_roll_ft String?   @db.NVarChar(50)
  landing_over_50ft_ft   String?   @db.NVarChar(50)
  top_speed_kts          String?   @db.NVarChar(50)
  cruise_speed_kts       String?   @db.NVarChar(50)
  stall_speed_dirty_kts  String?   @db.NVarChar(50)
  stall_speed_clean_kts  String?   @db.NVarChar(50)
  empty_weight_lbs       String?   @db.NVarChar(50)
  gross_weight_lbs       String?   @db.NVarChar(50)
  range_nm               String?   @db.NVarChar(50)
  fuel_capacity_gal      String?   @db.NVarChar(50)
  horsepower             String?   @db.NVarChar(50)
  rate_of_climb_fpm      String?   @db.NVarChar(50)
  service_ceiling_ft     String?   @db.NVarChar(50)
  source_url             String?   @db.NVarChar(500)
  scraped_at             DateTime? @db.DateTime2

  @@map("AircraftSpecs")
}

// ============================================
// Flying Club Models
// ============================================

model FlyingGroup {
  id          String   @id @default(uuid())
  name        String   @db.NVarChar(255)
  description String?  @db.NVarChar(Max)
  ownerId     String
  dryRate     Decimal? @db.Decimal(10, 2)
  wetRate     Decimal? @db.Decimal(10, 2)
  customRates String?  @db.NVarChar(Max)
  createdAt   DateTime @default(now()) @db.DateTime2
  updatedAt   DateTime @updatedAt @db.DateTime2

  members  GroupMember[]
  aircraft ClubAircraft[]
  Invite   Invite[]

  @@map("FlyingGroup")
}

model GroupMember {
  id       String   @id @default(uuid())
  userId   String
  groupId  String
  role     String   @default("VIEWER") @db.NVarChar(20)
  joinedAt DateTime @default(now()) @db.DateTime2

  user  User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  group FlyingGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)

  @@unique([userId, groupId])
  @@map("GroupMember")
}

model Invite {
  id        String   @id @default(uuid())
  groupId   String
  token     String   @unique @db.NVarChar(255)
  email     String?  @db.NVarChar(255)
  role      String   @default("VIEWER") @db.NVarChar(20)
  expiresAt DateTime @db.DateTime2
  createdBy String
  createdAt DateTime @default(now()) @db.DateTime2
  acceptedAt DateTime? @db.DateTime2

  group FlyingGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)

  @@map("Invite")
}

model Maintenance {
  id           String   @id @default(uuid())
  aircraftId   String
  userId       String
  groupId      String?
  description  String   @db.NVarChar(500)
  notes        String?  @db.NVarChar(Max)
  status       String   @default("NEEDED") @db.NVarChar(20)
  isGrounded   Boolean  @default(false)
  reportedDate DateTime @db.DateTime2
  resolvedDate DateTime? @db.DateTime2
  cost         Decimal? @db.Decimal(10, 2)
  createdAt    DateTime @default(now()) @db.DateTime2
  updatedAt    DateTime @updatedAt @db.DateTime2

  @@map("Maintenance")
}

model ClubAircraft {
  id                String   @id @default(uuid())
  groupId           String
  nNumber           String?  @db.NVarChar(10)
  nickname          String?  @db.NVarChar(100)
  customName        String?  @db.NVarChar(255)
  make              String?  @db.NVarChar(100)
  model             String?  @db.NVarChar(100)
  year              Int?
  totalTachHours   Decimal? @db.Decimal(6, 2)
  totalHobbsHours  Decimal? @db.Decimal(6, 2)
  registrationType String?  @db.NVarChar(50)
  hasInsurance     Boolean?
  maxPassengers    Int?
  hourlyRate       Decimal? @db.Decimal(10, 2)
  aircraftNotes    String?  @db.NVarChar(Max)
  createdAt        DateTime @default(now()) @db.DateTime2
  updatedAt        DateTime @updatedAt @db.DateTime2

  group      FlyingGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)
  bookings   Booking[]
  flightLogs FlightLog[]

  @@map("ClubAircraft")
}

model Booking {
  id         String   @id @default(uuid())
  aircraftId String
  userId     String
  startTime  DateTime @db.DateTime2
  endTime    DateTime @db.DateTime2
  purpose    String?  @db.NVarChar(500)
  createdAt  DateTime @default(now()) @db.DateTime2
  updatedAt  DateTime @updatedAt @db.DateTime2

  aircraft ClubAircraft @relation(fields: [aircraftId], references: [id], onDelete: Cascade)
  user     User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("Booking")
}

model FlightLog {
  id        String   @id @default(uuid())
  aircraftId String
  userId    String
  date      DateTime @db.DateTime2
  tachTime  Decimal? @db.Decimal(6, 2)
  hobbsTime Decimal? @db.Decimal(6, 2)
  notes     String?  @db.NVarChar(Max)
  createdAt DateTime @default(now()) @db.DateTime2
  updatedAt DateTime @updatedAt @db.DateTime2

  aircraft ClubAircraft @relation(fields: [aircraftId], references: [id], onDelete: Cascade)
  user     User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("FlightLog")
}

model PartnershipProfile {
  id              String   @id @default(uuid())
  userId          String   @unique
  availability    String?  @db.NVarChar(500)  // e.g., "Weekends", "Evenings"
  flightInterests String?  @db.NVarChar(500)  // e.g., "XC, IFR, Sightseeing"
  homeAirport     String?  @db.NVarChar(10)   // e.g., "KORD"
  experienceLevel String?  @db.NVarChar(50)  // e.g., "Private PPL", "Commercial"
  bio             String?  @db.NVarChar(1000)
  lookingFor      String?  @db.NVarChar(500)  // What kind of partner seeking
  isActive        Boolean  @default(true)
  // Location for map display
  city            String?  @db.NVarChar(100)
  state           String?  @db.NVarChar(50)
  latitude        Float?
  longitude       Float?
  createdAt       DateTime @default(now()) @db.DateTime2
  updatedAt       DateTime @updatedAt @db.DateTime2

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("PartnershipProfile")
}
