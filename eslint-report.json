[{"filePath":"C:\\Users\\David\\next-dashboard\\app\\admin\\data\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\admin\\errors\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":48,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1531,1534],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1531,1534],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchReports'. Either include it or remove the dependency array.","line":57,"column":6,"nodeType":"ArrayExpression","endLine":57,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [fetchReports, filter, page]","fix":{"range":[1665,1679],"text":"[fetchReports, filter, page]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":72,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":72,"endColumn":17}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useEffect, useState } from 'react';\n\ninterface ErrorReport {\n  id: string;\n  userId: string | null;\n  email: string | null;\n  title: string;\n  description: string;\n  stepsToReproduce: string | null;\n  url: string | null;\n  browser: string | null;\n  status: string;\n  resolution: string | null;\n  createdAt: string;\n  userEmail: string | null;\n  userName: string | null;\n}\n\nexport default function AdminErrorsPage() {\n  const [reports, setReports] = useState<ErrorReport[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [filter, setFilter] = useState('open');\n  const [page, setPage] = useState(1);\n  const [totalPages, setTotalPages] = useState(1);\n  const [statusCounts, setStatusCounts] = useState<Record<string, number>>({});\n  const [selectedReport, setSelectedReport] = useState<ErrorReport | null>(null);\n\n  const fetchReports = async () => {\n    setLoading(true);\n    try {\n      const params = new URLSearchParams();\n      params.set('page', page.toString());\n      params.set('limit', '20');\n      if (filter !== 'all') params.set('status', filter);\n\n      const res = await fetch(`/api/admin/error-reports?${params}`);\n      if (!res.ok) {\n        const data = await res.json();\n        throw new Error(data.error || 'Failed to fetch');\n      }\n      const data = await res.json();\n      setReports(data.reports);\n      setStatusCounts(data.statusCounts);\n      setTotalPages(data.pagination.totalPages);\n    } catch (err: any) {\n      setError(err.message);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    fetchReports();\n  }, [filter, page]);\n\n  // Update report status\n  const updateStatus = async (reportId: string, status: string, resolution?: string) => {\n    try {\n      const res = await fetch('/api/admin/error-reports', {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ id: reportId, status, resolution }),\n      });\n      if (!res.ok) throw new Error('Failed to update');\n      fetchReports();\n      if (selectedReport?.id === reportId) {\n        setSelectedReport({ ...selectedReport, status, resolution: resolution || null });\n      }\n    } catch (err) {\n      alert('Failed to update report');\n    }\n  };\n\n  if (error) {\n    return (\n      <div className=\"bg-red-500/10 border border-red-500/30 rounded-lg p-6\">\n        <h2 className=\"text-red-400 font-semibold mb-2\">Access Denied</h2>\n        <p className=\"text-slate-400\">{error}</p>\n      </div>\n    );\n  }\n\n  const filters = ['open', 'in_progress', 'resolved', 'closed'];\n\n  return (\n    <div className=\"space-y-6\">\n      <h1 className=\"text-2xl font-bold text-white\">Error Reports</h1>\n\n      {/* Status Tabs */}\n      <div className=\"flex gap-2\">\n        {filters.map((f) => (\n          <button\n            key={f}\n            onClick={() => { setFilter(f); setPage(1); }}\n            className={`px-4 py-2 rounded-lg font-medium transition ${\n              filter === f\n                ? 'bg-sky-600 text-white'\n                : 'bg-slate-800 text-slate-400 hover:text-white'\n            }`}\n          >\n            {f === 'open' && 'ðŸ”´ '}\n            {f === 'in_progress' && 'ðŸŸ¡ '}\n            {f === 'resolved' && 'ðŸŸ¢ '}\n            {f === 'closed' && 'âš« '}\n            {f.replace('_', ' ').toUpperCase()}\n            {statusCounts[f] !== undefined && ` (${statusCounts[f]})`}\n          </button>\n        ))}\n        <button\n          onClick={() => { setFilter('all'); setPage(1); }}\n          className={`px-4 py-2 rounded-lg font-medium transition ${\n            filter === 'all'\n              ? 'bg-sky-600 text-white'\n              : 'bg-slate-800 text-slate-400 hover:text-white'\n          }`}\n        >\n          ALL\n        </button>\n      </div>\n\n      {/* Reports List */}\n      <div className=\"bg-slate-900 rounded-xl border border-slate-800 overflow-hidden\">\n        {loading ? (\n          <div className=\"p-8 text-center text-slate-400\">Loading...</div>\n        ) : reports.length === 0 ? (\n          <div className=\"p-8 text-center text-slate-400\">No error reports found</div>\n        ) : (\n          <div className=\"divide-y divide-slate-800\">\n            {reports.map((report) => (\n              <div\n                key={report.id}\n                className=\"p-4 hover:bg-slate-800/30 cursor-pointer\"\n                onClick={() => setSelectedReport(report)}\n              >\n                <div className=\"flex justify-between items-start\">\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center gap-2 mb-1\">\n                      <span className={`w-2 h-2 rounded-full ${\n                        report.status === 'open' ? 'bg-red-500' :\n                        report.status === 'in_progress' ? 'bg-yellow-500' :\n                        report.status === 'resolved' ? 'bg-green-500' : 'bg-slate-500'\n                      }`} />\n                      <span className=\"text-white font-medium\">{report.title}</span>\n                    </div>\n                    <p className=\"text-sm text-slate-400 line-clamp-2\">{report.description}</p>\n                    <div className=\"flex gap-4 mt-2 text-xs text-slate-500\">\n                      {report.userEmail && <span>User: {report.userEmail}</span>}\n                      {report.email && !report.userEmail && <span>Email: {report.email}</span>}\n                      <span>{new Date(report.createdAt).toLocaleString()}</span>\n                    </div>\n                  </div>\n                  <span className={`px-2 py-1 rounded text-xs ${\n                    report.status === 'open' ? 'bg-red-500/20 text-red-400' :\n                    report.status === 'in_progress' ? 'bg-yellow-500/20 text-yellow-400' :\n                    report.status === 'resolved' ? 'bg-green-500/20 text-green-400' :\n                    'bg-slate-700 text-slate-400'\n                  }`}>\n                    {report.status}\n                  </span>\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n\n        {/* Pagination */}\n        {totalPages > 1 && (\n          <div className=\"flex justify-center gap-2 py-4 border-t border-slate-800\">\n            <button\n              onClick={() => setPage(p => Math.max(1, p - 1))}\n              disabled={page === 1}\n              className=\"px-3 py-1 rounded bg-slate-800 text-white disabled:opacity-50\"\n            >\n              Prev\n            </button>\n            <span className=\"px-4 py-1 text-slate-400\">\n              Page {page} of {totalPages}\n            </span>\n            <button\n              onClick={() => setPage(p => Math.min(totalPages, p + 1))}\n              disabled={page === totalPages}\n              className=\"px-3 py-1 rounded bg-slate-800 text-white disabled:opacity-50\"\n            >\n              Next\n            </button>\n          </div>\n        )}\n      </div>\n\n      {/* Report Detail Modal */}\n      {selectedReport && (\n        <div className=\"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-slate-900 rounded-xl border border-slate-700 max-w-2xl w-full max-h-[80vh] overflow-y-auto\">\n            <div className=\"p-6\">\n              <div className=\"flex justify-between items-start mb-6\">\n                <h2 className=\"text-xl font-bold text-white\">Error Report Details</h2>\n                <button\n                  onClick={() => setSelectedReport(null)}\n                  className=\"text-slate-400 hover:text-white\"\n                >\n                  âœ•\n                </button>\n              </div>\n\n              <div className=\"space-y-4\">\n                <div>\n                  <label className=\"text-sm text-slate-400\">Status</label>\n                  <div className=\"flex gap-2 mt-1\">\n                    {['open', 'in_progress', 'resolved', 'closed'].map((s) => (\n                      <button\n                        key={s}\n                        onClick={() => updateStatus(selectedReport.id, s)}\n                        className={`px-3 py-1 rounded text-sm ${\n                          selectedReport.status === s\n                            ? s === 'open' ? 'bg-red-500 text-white' :\n                              s === 'in_progress' ? 'bg-yellow-500 text-white' :\n                              s === 'resolved' ? 'bg-green-500 text-white' :\n                              'bg-slate-500 text-white'\n                            : 'bg-slate-700 text-slate-400 hover:bg-slate-600'\n                        }`}\n                      >\n                        {s.replace('_', ' ')}\n                      </button>\n                    ))}\n                  </div>\n                </div>\n\n                <div>\n                  <label className=\"text-sm text-slate-400\">Title</label>\n                  <div className=\"text-white\">{selectedReport.title}</div>\n                </div>\n\n                <div>\n                  <label className=\"text-sm text-slate-400\">Description</label>\n                  <div className=\"text-white whitespace-pre-wrap bg-slate-800 p-3 rounded mt-1\">\n                    {selectedReport.description}\n                  </div>\n                </div>\n\n                {selectedReport.stepsToReproduce && (\n                  <div>\n                    <label className=\"text-sm text-slate-400\">Steps to Reproduce</label>\n                    <div className=\"text-white whitespace-pre-wrap bg-slate-800 p-3 rounded mt-1\">\n                      {selectedReport.stepsToReproduce}\n                    </div>\n                  </div>\n                )}\n\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div>\n                    <label className=\"text-sm text-slate-400\">Reported by</label>\n                    <div className=\"text-white\">\n                      {selectedReport.userEmail || selectedReport.email || 'Anonymous'}\n                    </div>\n                  </div>\n                  <div>\n                    <label className=\"text-sm text-slate-400\">Date</label>\n                    <div className=\"text-white\">\n                      {new Date(selectedReport.createdAt).toLocaleString()}\n                    </div>\n                  </div>\n                </div>\n\n                {selectedReport.url && (\n                  <div>\n                    <label className=\"text-sm text-slate-400\">Page URL</label>\n                    <a\n                      href={selectedReport.url}\n                      target=\"_blank\"\n                      rel=\"noopener noreferrer\"\n                      className=\"text-sky-400 hover:underline break-all\"\n                    >\n                      {selectedReport.url}\n                    </a>\n                  </div>\n                )}\n\n                {selectedReport.browser && (\n                  <div>\n                    <label className=\"text-sm text-slate-400\">Browser</label>\n                    <div className=\"text-white\">{selectedReport.browser}</div>\n                  </div>\n                )}\n\n                {selectedReport.status === 'resolved' && selectedReport.resolution && (\n                  <div>\n                    <label className=\"text-sm text-slate-400\">Resolution</label>\n                    <div className=\"text-white whitespace-pre-wrap bg-slate-800 p-3 rounded mt-1\">\n                      {selectedReport.resolution}\n                    </div>\n                  </div>\n                )}\n\n                <div className=\"pt-4 border-t border-slate-700\">\n                  <label className=\"text-sm text-slate-400\">Add Resolution Note</label>\n                  <textarea\n                    id=\"resolutionText\"\n                    placeholder=\"Resolution notes (will be saved when you set status to resolved)\"\n                    className=\"w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-white mt-1\"\n                    rows={3}\n                  />\n                  <button\n                    onClick={() => {\n                      const resolution = (document.getElementById('resolutionText') as HTMLTextAreaElement)?.value;\n                      if (resolution) {\n                        updateStatus(selectedReport.id, 'resolved', resolution);\n                      }\n                    }}\n                    className=\"mt-2 bg-green-600 hover:bg-green-500 text-white px-4 py-2 rounded-lg font-medium\"\n                  >\n                    Mark as Resolved\n                  </button>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\admin\\layout.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":18,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[651,654],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[651,654],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\David\\next-dashboard\\app\\admin\\layout.tsx:20:9\n  18 |       const userRole = (session?.user as any)?.role;\n  19 |       if (userRole === 'admin' || userRole === 'owner') {\n> 20 |         setIsAdmin(true);\n     |         ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  21 |       }\n  22 |       setLoading(false);\n  23 |       ","line":20,"column":9,"nodeType":null,"endLine":20,"endColumn":19}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useSession } from 'next-auth/react';\nimport { useRouter } from 'next/navigation';\nimport { useEffect, useState } from 'react';\n\nexport default function AdminLayout({ children }: { children: React.ReactNode }) {\n  const { data: session, status } = useSession();\n  const router = useRouter();\n  const [loading, setLoading] = useState(true);\n  const [isAdmin, setIsAdmin] = useState(false);\n\n  useEffect(() => {\n    if (status === 'unauthenticated') {\n      router.push('/login?redirect=/admin');\n    } else if (status === 'authenticated') {\n      // Check if user has admin or owner role\n      const userRole = (session?.user as any)?.role;\n      if (userRole === 'admin' || userRole === 'owner') {\n        setIsAdmin(true);\n      }\n      setLoading(false);\n      \n      if (userRole !== 'admin' && userRole !== 'owner') {\n        // Not admin, redirect to home\n        router.push('/');\n      }\n    }\n  }, [status, router, session]);\n\n  if (loading || status === 'loading') {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div>Loading...</div>\n      </div>\n    );\n  }\n\n  if (!isAdmin) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"text-center\">\n          <h1 className=\"text-2xl font-bold mb-2\">Access Denied</h1>\n          <p className=\"text-muted-foreground\">You need admin privileges to access this page.</p>\n        </div>\n      </div>\n    );\n  }\n\n  return <>{children}</>;\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\admin\\outreach\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CheckCircle2' is defined but never used.","line":10,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":34,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"CheckCircle2"},"fix":{"range":[411,425],"text":""},"desc":"Remove unused variable \"CheckCircle2\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'XCircle' is defined but never used.","line":10,"column":36,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":43,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"XCircle"},"fix":{"range":[425,434],"text":""},"desc":"Remove unused variable \"XCircle\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Clock' is defined but never used.","line":10,"column":45,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":50,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Clock"},"fix":{"range":[434,441],"text":""},"desc":"Remove unused variable \"Clock\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Filter' is defined but never used.","line":11,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":17,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Filter"},"fix":{"range":[452,460],"text":""},"desc":"Remove unused variable \"Filter\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Trash2' is defined but never used.","line":11,"column":46,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":52,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Trash2"},"fix":{"range":[487,495],"text":""},"desc":"Remove unused variable \"Trash2\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Phone' is defined but never used.","line":12,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":31,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Phone"},"fix":{"range":[520,527],"text":""},"desc":"Remove unused variable \"Phone\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MapPin' is defined but never used.","line":12,"column":33,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":39,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"MapPin"},"fix":{"range":[527,535],"text":""},"desc":"Remove unused variable \"MapPin\"."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchContacts'. Either include it or remove the dependency array.","line":54,"column":6,"nodeType":"ArrayExpression","endLine":54,"endColumn":31,"suggestions":[{"desc":"Update the dependencies array to be: [filterType, filterState, fetchContacts]","fix":{"range":[1534,1559],"text":"[filterType, filterState, fetchContacts]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect } from 'react';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { \n  Mail, Users, Send, CheckCircle2, XCircle, Clock, \n  Search, Filter, Download, Plus, Eye, Edit, Trash2,\n  BarChart3, TrendingUp, Phone, MapPin, Building2,\n  FileText, RefreshCw, Upload\n} from 'lucide-react';\n\ntype Contact = {\n  id: string;\n  organizationType: string;\n  organizationName: string;\n  airportIcao?: string;\n  city?: string;\n  state?: string;\n  contactName?: string;\n  contactTitle?: string;\n  contactEmail?: string;\n  contactPhone?: string;\n  sourceType: string;\n  createdAt: string;\n};\n\ntype Campaign = {\n  id: string;\n  name: string;\n  status: string;\n  emailsSent: number;\n  emailsOpened: number;\n  responses: number;\n  interested: number;\n  createdAt: string;\n};\n\nexport default function OutreachPage() {\n  const [contacts, setContacts] = useState<Contact[]>([]);\n  const [campaigns, setCampaigns] = useState<Campaign[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [filterType, setFilterType] = useState('all');\n  const [filterState, setFilterState] = useState('');\n\n  // Fetch contacts\n  useEffect(() => {\n    fetchContacts();\n    fetchCampaigns();\n  }, [filterType, filterState]);\n\n  async function fetchContacts() {\n    setLoading(true);\n    try {\n      const params = new URLSearchParams();\n      if (filterType !== 'all') params.set('type', filterType);\n      if (filterState) params.set('state', filterState);\n      if (searchTerm) params.set('search', searchTerm);\n\n      const res = await fetch(`/api/admin/outreach/contacts?${params}`);\n      const data = await res.json();\n      setContacts(data.contacts || []);\n    } catch (error) {\n      console.error('Error fetching contacts:', error);\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  async function fetchCampaigns() {\n    try {\n      const res = await fetch('/api/admin/outreach/campaigns');\n      const data = await res.json();\n      setCampaigns(data.campaigns || []);\n    } catch (error) {\n      console.error('Error fetching campaigns:', error);\n    }\n  }\n\n  const stats = {\n    totalContacts: contacts.length,\n    totalEmails: campaigns.reduce((sum, c) => sum + c.emailsSent, 0),\n    totalResponses: campaigns.reduce((sum, c) => sum + c.responses, 0),\n    totalInterested: campaigns.reduce((sum, c) => sum + c.interested, 0),\n  };\n\n  const responseRate = stats.totalEmails > 0 \n    ? ((stats.totalResponses / stats.totalEmails) * 100).toFixed(1)\n    : '0';\n\n  const interestRate = stats.totalResponses > 0\n    ? ((stats.totalInterested / stats.totalResponses) * 100).toFixed(1)\n    : '0';\n\n  return (\n    <div className=\"min-h-screen pt-[44px] p-6 space-y-6\">\n      {/* Header */}\n      <div>\n        <h1 className=\"text-2xl font-bold\">Outreach Management</h1>\n        <p className=\"text-sm text-muted-foreground\">\n          Manage contacts, campaigns, and track outreach performance\n        </p>\n      </div>\n\n      {/* Stats Cards */}\n      <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Contacts</CardTitle>\n            <Users className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{stats.totalContacts}</div>\n            <p className=\"text-xs text-muted-foreground\">\n              Airports, clubs, schools\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Emails Sent</CardTitle>\n            <Send className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{stats.totalEmails}</div>\n            <p className=\"text-xs text-muted-foreground\">\n              Across all campaigns\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Response Rate</CardTitle>\n            <BarChart3 className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{responseRate}%</div>\n            <p className=\"text-xs text-muted-foreground\">\n              {stats.totalResponses} responses\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Interest Rate</CardTitle>\n            <TrendingUp className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{interestRate}%</div>\n            <p className=\"text-xs text-muted-foreground\">\n              {stats.totalInterested} interested\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Main Content Tabs */}\n      <Tabs defaultValue=\"contacts\" className=\"space-y-4\">\n        <TabsList>\n          <TabsTrigger value=\"contacts\">Contacts</TabsTrigger>\n          <TabsTrigger value=\"campaigns\">Campaigns</TabsTrigger>\n          <TabsTrigger value=\"scrape\">Scraping Tools</TabsTrigger>\n        </TabsList>\n\n        {/* Contacts Tab */}\n        <TabsContent value=\"contacts\" className=\"space-y-4\">\n          <Card>\n            <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <CardTitle>Contact Database</CardTitle>\n                  <CardDescription>\n                    Scraped contacts from airports, flight clubs, and schools\n                  </CardDescription>\n                </div>\n                <div className=\"flex gap-2\">\n                  <Button size=\"sm\" variant=\"outline\">\n                    <Upload className=\"mr-2 h-4 w-4\" />\n                    Import CSV\n                  </Button>\n                  <Button size=\"sm\" variant=\"outline\">\n                    <Download className=\"mr-2 h-4 w-4\" />\n                    Export\n                  </Button>\n                  <Button size=\"sm\">\n                    <Plus className=\"mr-2 h-4 w-4\" />\n                    Add Contact\n                  </Button>\n                </div>\n              </div>\n            </CardHeader>\n            <CardContent>\n              {/* Filters */}\n              <div className=\"mb-4 flex gap-2\">\n                <div className=\"flex-1\">\n                  <Input\n                    placeholder=\"Search contacts...\"\n                    value={searchTerm}\n                    onChange={(e) => setSearchTerm(e.target.value)}\n                    className=\"max-w-sm\"\n                  />\n                </div>\n                <select\n                  value={filterType}\n                  onChange={(e) => setFilterType(e.target.value)}\n                  className=\"rounded-md border border-input bg-background px-3 py-2 text-sm\"\n                >\n                  <option value=\"all\">All Types</option>\n                  <option value=\"airport\">Airports</option>\n                  <option value=\"flight_club\">Flight Clubs</option>\n                  <option value=\"flight_school\">Flight Schools</option>\n                  <option value=\"fbo\">FBOs</option>\n                </select>\n                <Input\n                  placeholder=\"State (e.g., MI)\"\n                  value={filterState}\n                  onChange={(e) => setFilterState(e.target.value.toUpperCase())}\n                  className=\"w-24\"\n                />\n                <Button onClick={fetchContacts}>\n                  <Search className=\"h-4 w-4\" />\n                </Button>\n              </div>\n\n              {/* Contacts Table */}\n              <div className=\"rounded-md border\">\n                <table className=\"w-full\">\n                  <thead>\n                    <tr className=\"border-b bg-muted/50\">\n                      <th className=\"p-3 text-left text-xs font-medium\">Organization</th>\n                      <th className=\"p-3 text-left text-xs font-medium\">Type</th>\n                      <th className=\"p-3 text-left text-xs font-medium\">Contact</th>\n                      <th className=\"p-3 text-left text-xs font-medium\">Email</th>\n                      <th className=\"p-3 text-left text-xs font-medium\">Phone</th>\n                      <th className=\"p-3 text-left text-xs font-medium\">Location</th>\n                      <th className=\"p-3 text-left text-xs font-medium\">Source</th>\n                      <th className=\"p-3 text-right text-xs font-medium\">Actions</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    {loading ? (\n                      <tr>\n                        <td colSpan={8} className=\"p-8 text-center text-sm text-muted-foreground\">\n                          Loading contacts...\n                        </td>\n                      </tr>\n                    ) : contacts.length === 0 ? (\n                      <tr>\n                        <td colSpan={8} className=\"p-8 text-center text-sm text-muted-foreground\">\n                          No contacts found. Run the scraper to collect data.\n                        </td>\n                      </tr>\n                    ) : (\n                      contacts.map((contact) => (\n                        <tr key={contact.id} className=\"border-b\">\n                          <td className=\"p-3 text-sm\">\n                            <div className=\"font-medium\">{contact.organizationName}</div>\n                            {contact.airportIcao && (\n                              <div className=\"text-xs text-muted-foreground\">{contact.airportIcao}</div>\n                            )}\n                          </td>\n                          <td className=\"p-3\">\n                            <Badge variant=\"outline\" className=\"text-xs\">\n                              {contact.organizationType.replace('_', ' ')}\n                            </Badge>\n                          </td>\n                          <td className=\"p-3 text-sm\">\n                            {contact.contactName && (\n                              <div className=\"font-medium\">{contact.contactName}</div>\n                            )}\n                            {contact.contactTitle && (\n                              <div className=\"text-xs text-muted-foreground\">{contact.contactTitle}</div>\n                            )}\n                          </td>\n                          <td className=\"p-3 text-sm\">\n                            {contact.contactEmail && (\n                              <a href={`mailto:${contact.contactEmail}`} className=\"text-primary hover:underline\">\n                                {contact.contactEmail}\n                              </a>\n                            )}\n                          </td>\n                          <td className=\"p-3 text-sm text-muted-foreground\">\n                            {contact.contactPhone || 'â€”'}\n                          </td>\n                          <td className=\"p-3 text-sm text-muted-foreground\">\n                            {contact.city && contact.state ? `${contact.city}, ${contact.state}` : 'â€”'}\n                          </td>\n                          <td className=\"p-3\">\n                            <Badge variant=\"secondary\" className=\"text-xs\">\n                              {contact.sourceType}\n                            </Badge>\n                          </td>\n                          <td className=\"p-3 text-right\">\n                            <div className=\"flex justify-end gap-1\">\n                              <Button size=\"sm\" variant=\"ghost\">\n                                <Eye className=\"h-4 w-4\" />\n                              </Button>\n                              <Button size=\"sm\" variant=\"ghost\">\n                                <Edit className=\"h-4 w-4\" />\n                              </Button>\n                            </div>\n                          </td>\n                        </tr>\n                      ))\n                    )}\n                  </tbody>\n                </table>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* Campaigns Tab */}\n        <TabsContent value=\"campaigns\" className=\"space-y-4\">\n          <Card>\n            <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <CardTitle>Email Campaigns</CardTitle>\n                  <CardDescription>\n                    Create and manage outreach campaigns\n                  </CardDescription>\n                </div>\n                <Button size=\"sm\">\n                  <Plus className=\"mr-2 h-4 w-4\" />\n                  New Campaign\n                </Button>\n              </div>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-4\">\n                {campaigns.length === 0 ? (\n                  <div className=\"rounded-md border border-dashed p-8 text-center\">\n                    <Mail className=\"mx-auto h-12 w-12 text-muted-foreground/50\" />\n                    <h3 className=\"mt-4 text-sm font-semibold\">No campaigns yet</h3>\n                    <p className=\"mt-2 text-sm text-muted-foreground\">\n                      Create your first outreach campaign to start sending emails\n                    </p>\n                    <Button className=\"mt-4\" size=\"sm\">\n                      <Plus className=\"mr-2 h-4 w-4\" />\n                      Create Campaign\n                    </Button>\n                  </div>\n                ) : (\n                  campaigns.map((campaign) => (\n                    <Card key={campaign.id}>\n                      <CardContent className=\"p-4\">\n                        <div className=\"flex items-center justify-between\">\n                          <div className=\"flex-1\">\n                            <div className=\"flex items-center gap-2\">\n                              <h3 className=\"font-semibold\">{campaign.name}</h3>\n                              <Badge variant={\n                                campaign.status === 'active' ? 'default' :\n                                campaign.status === 'completed' ? 'secondary' :\n                                'outline'\n                              }>\n                                {campaign.status}\n                              </Badge>\n                            </div>\n                            <div className=\"mt-2 grid grid-cols-4 gap-4 text-sm\">\n                              <div>\n                                <div className=\"text-muted-foreground\">Sent</div>\n                                <div className=\"font-medium\">{campaign.emailsSent}</div>\n                              </div>\n                              <div>\n                                <div className=\"text-muted-foreground\">Opened</div>\n                                <div className=\"font-medium\">{campaign.emailsOpened}</div>\n                              </div>\n                              <div>\n                                <div className=\"text-muted-foreground\">Responded</div>\n                                <div className=\"font-medium\">{campaign.responses}</div>\n                              </div>\n                              <div>\n                                <div className=\"text-muted-foreground\">Interested</div>\n                                <div className=\"font-medium text-chart-2\">{campaign.interested}</div>\n                              </div>\n                            </div>\n                          </div>\n                          <div className=\"flex gap-2\">\n                            <Button size=\"sm\" variant=\"outline\">\n                              <Eye className=\"mr-2 h-4 w-4\" />\n                              View\n                            </Button>\n                            <Button size=\"sm\" variant=\"outline\">\n                              <Send className=\"mr-2 h-4 w-4\" />\n                              Send\n                            </Button>\n                          </div>\n                        </div>\n                      </CardContent>\n                    </Card>\n                  ))\n                )}\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* Scraping Tools Tab */}\n        <TabsContent value=\"scrape\" className=\"space-y-4\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Scraping Tools</CardTitle>\n              <CardDescription>\n                Run scrapers to collect contact information\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"grid gap-4 md:grid-cols-2\">\n                <Card>\n                  <CardContent className=\"p-4\">\n                    <div className=\"flex items-start gap-4\">\n                      <Building2 className=\"h-8 w-8 text-primary\" />\n                      <div className=\"flex-1\">\n                        <h3 className=\"font-semibold\">Airport & FBO Contacts</h3>\n                        <p className=\"mt-1 text-sm text-muted-foreground\">\n                          Scrape AirNav.com for airport managers and FBO contacts\n                        </p>\n                        <Button className=\"mt-3\" size=\"sm\">\n                          <RefreshCw className=\"mr-2 h-4 w-4\" />\n                          Run Scraper\n                        </Button>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardContent className=\"p-4\">\n                    <div className=\"flex items-start gap-4\">\n                      <Users className=\"h-8 w-8 text-primary\" />\n                      <div className=\"flex-1\">\n                        <h3 className=\"font-semibold\">Flight Club Contacts</h3>\n                        <p className=\"mt-1 text-sm text-muted-foreground\">\n                          Scrape EAA chapters and AOPA club directories\n                        </p>\n                        <Button className=\"mt-3\" size=\"sm\">\n                          <RefreshCw className=\"mr-2 h-4 w-4\" />\n                          Run Scraper\n                        </Button>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              </div>\n\n              <Card className=\"border-dashed\">\n                <CardContent className=\"p-6\">\n                  <div className=\"text-center\">\n                    <FileText className=\"mx-auto h-12 w-12 text-muted-foreground/50\" />\n                    <h3 className=\"mt-4 text-sm font-semibold\">Manual Import</h3>\n                    <p className=\"mt-2 text-sm text-muted-foreground\">\n                      Upload a CSV file with contact information\n                    </p>\n                    <Button className=\"mt-4\" size=\"sm\" variant=\"outline\">\n                      <Upload className=\"mr-2 h-4 w-4\" />\n                      Choose File\n                    </Button>\n                  </div>\n                </CardContent>\n              </Card>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\admin\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MoreHorizontal' is defined but never used.","line":33,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":33,"endColumn":17,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"MoreHorizontal"},"fix":{"range":[843,861],"text":""},"desc":"Remove unused variable \"MoreHorizontal\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CreditCard' is defined but never used.","line":51,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":51,"endColumn":13,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"CreditCard"},"fix":{"range":[1058,1072],"text":""},"desc":"Remove unused variable \"CreditCard\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Settings' is defined but never used.","line":53,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":53,"endColumn":11,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Settings"},"fix":{"range":[1084,1096],"text":""},"desc":"Remove unused variable \"Settings\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'BarChart3' is defined but never used.","line":56,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":56,"endColumn":12,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"BarChart3"},"fix":{"range":[1114,1127],"text":""},"desc":"Remove unused variable \"BarChart3\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'billingTransactions' is assigned a value but never used.","line":80,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":80,"endColumn":26},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":96,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":96,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2030,2033],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2030,2033],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":292,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":292,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8747,8750],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8747,8750],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":293,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":293,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8802,8805],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8802,8805],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":294,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":294,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8856,8859],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8856,8859],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":295,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":295,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8904,8907],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8904,8907],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":296,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":296,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8958,8961],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8958,8961],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":297,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":297,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9034,9037],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9034,9037],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":298,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":298,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9098,9101],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9098,9101],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":299,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":299,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9171,9174],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9171,9174],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":301,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":301,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9306,9309],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9306,9309],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":328,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":328,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10514,10517],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10514,10517],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":329,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":329,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10585,10588],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10585,10588],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":330,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":330,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10664,10667],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10664,10667],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":331,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":331,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10743,10746],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10743,10746],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":332,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":332,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10814,10817],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10814,10817],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":333,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":333,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10885,10888],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10885,10888],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":334,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":334,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10962,10965],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10962,10965],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":335,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":335,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11047,11050],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11047,11050],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setGeneralSettings' is assigned a value but never used.","line":340,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":340,"endColumn":45},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setUserSettings' is assigned a value but never used.","line":346,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":346,"endColumn":39},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setScheduleSettings' is assigned a value but never used.","line":352,"column":28,"nodeType":"Identifier","messageId":"unusedVar","endLine":352,"endColumn":47},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":606,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":606,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18964,18967],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18964,18967],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":649,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":649,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20108,20111],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20108,20111],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":653,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":653,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20184,20187],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20184,20187],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":668,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":668,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20566,20569],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20566,20569],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":672,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":672,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20646,20649],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20646,20649],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":683,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":683,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20957,20960],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20957,20960],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":687,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":687,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21033,21036],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21033,21036],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":702,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":702,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21408,21411],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21408,21411],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":717,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":717,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21867,21870],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21867,21870],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":975,"column":168,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":975,"endColumn":171,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[36673,36676],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[36673,36676],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1092,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1092,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[43276,43279],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[43276,43279],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1100,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1100,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[43655,43658],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[43655,43658],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":30,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from \"react\"\nimport Link from \"next/link\"\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\"\nimport { Badge } from \"@/components/ui/badge\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Progress } from \"@/components/ui/progress\"\nimport { Separator } from \"@/components/ui/separator\"\nimport { Switch } from \"@/components/ui/switch\"\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\"\nimport { Label } from \"@/components/ui/label\"\nimport { Textarea } from \"@/components/ui/textarea\"\nimport {\n  Users,\n  Plane,\n  DollarSign,\n  TrendingUp,\n  TrendingDown,\n  AlertTriangle,\n  CheckCircle2,\n  Clock,\n  Search,\n  Filter,\n  MoreHorizontal,\n  ShieldCheck,\n  ShieldAlert,\n  Activity,\n  Server,\n  Database,\n  Globe,\n  Mail,\n  Download,\n  Trash2,\n  Edit,\n  Eye,\n  UserPlus,\n  Ban,\n  RefreshCw,\n  ArrowUpRight,\n  ArrowDownRight,\n  Building2,\n  CreditCard,\n  FileText,\n  Settings,\n  Bell,\n  Wrench,\n  BarChart3,\n} from \"lucide-react\"\nimport { Tabs, TabsList, TabsTrigger } from \"@/components/ui/tabs\"\nimport {\n  AreaChart,\n  Area,\n  BarChart,\n  Bar,\n  LineChart,\n  Line,\n  ResponsiveContainer,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  Tooltip,\n} from \"recharts\"\n\n// â”€â”€ Mock data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\nconst signupData: { month: string; users: number }[] = []\nconst revenueData: { month: string; revenue: number }[] = []\nconst activityData: { day: string; flights: number; plans: number }[] = []\n\n\nconst billingTransactions: {\n  id: string\n  user: string\n  plan: string\n  amount: number\n  date: string\n  status: string\n}[] = []\n\n// â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\nfunction StatCard({ label, value, sub, trend, icon: Icon, accent }: {\n  label: string\n  value: string\n  sub: string\n  trend: \"up\" | \"down\" | \"neutral\"\n  icon: any\n  accent: string\n}) {\n  return (\n    <Card>\n      <CardContent className=\"p-5\">\n        <div className=\"flex items-start justify-between\">\n          <div className=\"space-y-1\">\n            <p className=\"text-xs font-medium text-muted-foreground\">{label}</p>\n            <p className=\"text-2xl font-bold tracking-tight\">{value}</p>\n            <div className=\"flex items-center gap-1\">\n              {trend === \"up\" && <ArrowUpRight className=\"h-3 w-3 text-chart-2\" />}\n              {trend === \"down\" && <ArrowDownRight className=\"h-3 w-3 text-destructive\" />}\n              <span className={`text-xs ${trend === \"up\" ? \"text-chart-2\" : trend === \"down\" ? \"text-destructive\" : \"text-muted-foreground\"}`}>{sub}</span>\n            </div>\n          </div>\n          <div className={`flex h-10 w-10 items-center justify-center rounded-lg ${accent}`}>\n            <Icon className=\"h-5 w-5\" />\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  )\n}\n\nfunction StatusDot({ status }: { status: string }) {\n  const color =\n    status === \"operational\" ? \"bg-chart-2\"\n    : status === \"degraded\" ? \"bg-chart-3\"\n    : \"bg-destructive\"\n  return <span className={`inline-block h-2 w-2 rounded-full ${color}`} />\n}\n\nfunction UserStatusBadge({ status }: { status: string }) {\n  const variants: Record<string, string> = {\n    active: \"bg-chart-2/10 text-chart-2 border-chart-2/20\",\n    suspended: \"bg-destructive/10 text-destructive border-destructive/20\",\n    pending: \"bg-chart-3/10 text-chart-3 border-chart-3/20\",\n  }\n  return (\n    <span className={`inline-flex items-center rounded-full border px-2 py-0.5 text-[11px] font-medium ${variants[status] ?? \"\"}`}>\n      {status}\n    </span>\n  )\n}\n\nfunction TxnStatusBadge({ status }: { status: string }) {\n  const variants: Record<string, string> = {\n    paid: \"bg-chart-2/10 text-chart-2 border-chart-2/20\",\n    failed: \"bg-destructive/10 text-destructive border-destructive/20\",\n    refunded: \"bg-muted text-muted-foreground border-border\",\n  }\n  return (\n    <span className={`inline-flex items-center rounded-full border px-2 py-0.5 text-[11px] font-medium ${variants[status] ?? \"\"}`}>\n      {status}\n    </span>\n  )\n}\n\nfunction PipelineStageCard({\n  label,\n  value,\n  usedBy,\n}: {\n  label: string\n  value: number\n  usedBy?: string[]\n}) {\n  return (\n    <div className=\"rounded-lg border border-border bg-card p-4\">\n      <div className=\"flex items-center justify-between\">\n        <p className=\"text-xs font-semibold uppercase tracking-wider text-muted-foreground\">{label}</p>\n        <Badge variant=\"secondary\">{value}</Badge>\n      </div>\n      {usedBy && (\n        <p className=\"mt-2 text-[11px] text-muted-foreground\">Used by: {usedBy.join(', ')}</p>\n      )}\n      <div className=\"mt-3\">\n        <Progress value={Math.min(100, value % 100)} className=\"h-1.5\" />\n      </div>\n    </div>\n  )\n}\n\nconst pipelineModuleColors: Record<string, string> = {\n  logbook: \"bg-sky-500\",\n  training: \"bg-emerald-500\",\n  currency: \"bg-amber-500\",\n  plan: \"bg-violet-500\",\n  marketplace: \"bg-blue-500\",\n  mechanic: \"bg-orange-500\",\n  club: \"bg-teal-500\",\n}\n\nfunction StackedStage({\n  label,\n  breakdown,\n}: {\n  label: string\n  breakdown: Record<string, number>\n}) {\n  const total = Object.values(breakdown).reduce((sum, v) => sum + v, 0) || 1\n  return (\n    <div className=\"rounded-lg border border-border bg-card p-4\">\n      <div className=\"flex items-center justify-between\">\n        <p className=\"text-xs font-semibold uppercase tracking-wider text-muted-foreground\">{label}</p>\n        <Badge variant=\"secondary\">{total}</Badge>\n      </div>\n      <div className=\"mt-3 flex h-2 overflow-hidden rounded-full bg-muted\">\n        {Object.entries(breakdown).map(([key, value]) => (\n          <div\n            key={key}\n            className={`h-full ${pipelineModuleColors[key] ?? \"bg-muted-foreground/40\"}`}\n            style={{ width: `${(value / total) * 100}%` }}\n          />\n        ))}\n      </div>\n      <div className=\"mt-2 flex flex-wrap gap-2 text-[11px] text-muted-foreground\">\n        {Object.entries(breakdown).map(([key, value]) => (\n          <span key={key} className=\"inline-flex items-center gap-1\">\n            <span className={`h-2 w-2 rounded-full ${pipelineModuleColors[key] ?? \"bg-muted-foreground/40\"}`} />\n            {key}: {value}\n          </span>\n        ))}\n      </div>\n    </div>\n  )\n}\n\n// â”€â”€ Sidebar nav data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\ntype Tab =\n  | \"overview\"\n  | \"awaiting-dispatch\" | \"currently-dispatched\" | \"past-flights\"\n  | \"users\" | \"administrators\" | \"instructors\" | \"groups\"\n  | \"aircraft\" | \"items\" | \"adjustments\" | \"forms\"\n  | \"general-settings\" | \"general-settings2\" | \"users-settings\" | \"schedule-settings\"\n  | \"notification-settings\" | \"add-ons\"\n  | \"clubs\" | \"marketplace\" | \"billing\" | \"system\"\n\ntype NavItem = { id: Tab; label: string; href?: string }\ntype NavGroup = { label: string; items: NavItem[] }\n\nconst NAV_GROUPS: NavGroup[] = [\n  {\n    label: \"Management\",\n    items: [\n      { id: \"users\", label: \"Users\", href: \"/admin/users\" },\n      { id: \"administrators\", label: \"Outreach\", href: \"/admin/outreach\" },\n    ],\n  },\n  {\n    label: \"Flights\",\n    items: [\n      { id: \"awaiting-dispatch\", label: \"Awaiting Dispatch\" },\n      { id: \"currently-dispatched\", label: \"Currently Dispatched\" },\n      { id: \"past-flights\", label: \"Past Flights\" },\n    ],\n  },\n  {\n    label: \"Resources\",\n    items: [\n      { id: \"aircraft\", label: \"Aircraft\" },\n      { id: \"items\", label: \"Items\" },\n      { id: \"adjustments\", label: \"Adjustments\" },\n      { id: \"forms\", label: \"Forms\" },\n    ],\n  },\n  {\n    label: \"Settings\",\n    items: [\n      { id: \"general-settings\", label: \"General Settings\" },\n      { id: \"users-settings\", label: \"Users Settings\" },\n      { id: \"schedule-settings\", label: \"Schedule Settings\" },\n      { id: \"notification-settings\", label: \"Notification Settings\" },\n      { id: \"add-ons\", label: \"Add-ons\" },\n    ],\n  },\n]\n\n// placeholder panels for new sections\nfunction PlaceholderPanel({ title, description }: { title: string; description: string }) {\n  return (\n    <div className=\"flex flex-col items-center justify-center rounded-xl border border-dashed border-border bg-muted/30 py-24 text-center\">\n      <p className=\"text-sm font-semibold text-foreground\">{title}</p>\n      <p className=\"mt-1 max-w-xs text-xs text-muted-foreground\">{description}</p>\n    </div>\n  )\n}\n\n// â”€â”€ Main component â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\nexport default function AdminDashboard() {\n  const [activeTab, setActiveTab] = useState<Tab>(\"awaiting-dispatch\")\n  const [userSearch, setUserSearch] = useState(\"\")\n\n  const [stats, setStats] = useState<any | null>(null)\n  const [users, setUsers] = useState<any[]>([])\n  const [aircraft, setAircraft] = useState<any[]>([])\n  const [clubs, setClubs] = useState<any[]>([])\n  const [listings, setListings] = useState<any[]>([])\n  const [billingTransactions, setBillingTransactions] = useState<any[]>([])\n  const [flightSummary, setFlightSummary] = useState<any | null>(null)\n  const [systemServices, setSystemServices] = useState<any[]>([])\n  const [pipelineModule, setPipelineModule] = useState<string>('totals')\n  const [pipelineData, setPipelineData] = useState<any | null>(null)\n\n  const [isOverviewLoading, setIsOverviewLoading] = useState(false)\n  const [overviewError, setOverviewError] = useState<string | null>(null)\n\n  const [isUsersLoading, setIsUsersLoading] = useState(false)\n  const [usersError, setUsersError] = useState<string | null>(null)\n\n  const [isAircraftLoading, setIsAircraftLoading] = useState(false)\n  const [aircraftError, setAircraftError] = useState<string | null>(null)\n\n  const [isClubsLoading, setIsClubsLoading] = useState(false)\n  const [clubsError, setClubsError] = useState<string | null>(null)\n\n  const [isMarketplaceLoading, setIsMarketplaceLoading] = useState(false)\n  const [marketplaceError, setMarketplaceError] = useState<string | null>(null)\n\n  const [isBillingLoading, setIsBillingLoading] = useState(false)\n  const [billingError, setBillingError] = useState<string | null>(null)\n\n  const [isFlightsLoading, setIsFlightsLoading] = useState(false)\n  const [flightsError, setFlightsError] = useState<string | null>(null)\n\n  const [isSystemLoading, setIsSystemLoading] = useState(false)\n  const [systemError, setSystemError] = useState<string | null>(null)\n  \n  // Modal states\n  const [viewUserModal, setViewUserModal] = useState<any | null>(null)\n  const [editUserModal, setEditUserModal] = useState<any | null>(null)\n  const [viewAircraftModal, setViewAircraftModal] = useState<any | null>(null)\n  const [editAircraftModal, setEditAircraftModal] = useState<any | null>(null)\n  const [viewClubModal, setViewClubModal] = useState<any | null>(null)\n  const [editClubModal, setEditClubModal] = useState<any | null>(null)\n  const [viewListingModal, setViewListingModal] = useState<any | null>(null)\n  const [viewTransactionModal, setViewTransactionModal] = useState<any | null>(null)\n  const [inviteUserModal, setInviteUserModal] = useState(false)\n  const [addClubModal, setAddClubModal] = useState(false)\n  \n  // Settings state\n  const [generalSettings, setGeneralSettings] = useState({\n    siteName: \"AviationHub\",\n    supportEmail: \"support@aviationhub.com\",\n    maintenanceMode: false,\n  })\n  \n  const [userSettings, setUserSettings] = useState({\n    allowSelfSignup: true,\n    requireEmailVerification: true,\n    defaultPlan: \"Free\",\n  })\n  \n  const [scheduleSettings, setScheduleSettings] = useState({\n    advanceBookingDays: 30,\n    minBookingNotice: 2,\n    maxBookingDuration: 8,\n  })\n\n  const filteredUsers = users.filter(u =>\n    u.name?.toLowerCase().includes(userSearch.toLowerCase()) ||\n    u.email?.toLowerCase().includes(userSearch.toLowerCase())\n  )\n\n  useEffect(() => {\n    let cancelled = false\n\n    async function loadOverview() {\n      setIsOverviewLoading(true)\n      setOverviewError(null)\n      try {\n        const [statsRes, flightsRes, usersRes, aircraftRes, listingsRes] = await Promise.all([\n          fetch('/api/admin/stats'),\n          fetch('/api/admin/flights/summary'),\n          fetch('/api/admin/users?limit=4'),\n          fetch('/api/admin/aircraft'),\n          fetch('/api/admin/marketplace/listings?take=50'),\n        ])\n\n        if (!statsRes.ok) throw new Error('Failed to load stats')\n        if (!flightsRes.ok) throw new Error('Failed to load flight summary')\n        if (!usersRes.ok) throw new Error('Failed to load users')\n        if (!aircraftRes.ok) throw new Error('Failed to load aircraft')\n        if (!listingsRes.ok) throw new Error('Failed to load listings')\n\n        const statsData = await statsRes.json()\n        const flightsData = await flightsRes.json()\n        const usersData = await usersRes.json()\n        const aircraftData = await aircraftRes.json()\n        const listingsData = await listingsRes.json()\n\n        if (!cancelled) {\n          setStats(statsData)\n          setFlightSummary(flightsData)\n          setUsers(usersData.users || [])\n          setAircraft(aircraftData.aircraft || [])\n          setListings(listingsData.listings || [])\n        }\n      } catch (error) {\n        console.error('Failed to load overview data', error)\n        if (!cancelled) setOverviewError('Failed to load overview data')\n      } finally {\n        if (!cancelled) setIsOverviewLoading(false)\n      }\n    }\n\n    loadOverview()\n    return () => {\n      cancelled = true\n    }\n  }, [])\n\n  useEffect(() => {\n    let cancelled = false\n\n    async function loadPipeline() {\n      try {\n        const res = await fetch(`/api/admin/pipeline?module=${pipelineModule}`)\n        if (!res.ok) throw new Error('Failed to load pipeline')\n        const data = await res.json()\n        if (!cancelled) setPipelineData(data)\n      } catch (error) {\n        console.error('Failed to load pipeline', error)\n      }\n    }\n\n    loadPipeline()\n    const interval = setInterval(loadPipeline, 10000)\n    return () => {\n      cancelled = true\n      clearInterval(interval)\n    }\n  }, [pipelineModule])\n\n  useEffect(() => {\n    let cancelled = false\n    setIsSystemLoading(true)\n    setSystemError(null)\n\n    if (!cancelled) {\n      setSystemServices([])\n      setIsSystemLoading(false)\n    }\n\n    return () => {\n      cancelled = true\n    }\n  }, [])\n\n  useEffect(() => {\n    if (activeTab !== 'users') return\n    let cancelled = false\n\n    async function loadUsers() {\n      setIsUsersLoading(true)\n      setUsersError(null)\n      try {\n        const res = await fetch(`/api/admin/users?limit=50&search=${encodeURIComponent(userSearch)}`)\n        if (!res.ok) throw new Error('Failed to load users')\n        const data = await res.json()\n        if (!cancelled) setUsers(data.users || [])\n      } catch (error) {\n        console.error('Failed to load users', error)\n        if (!cancelled) setUsersError('Failed to load users')\n      } finally {\n        if (!cancelled) setIsUsersLoading(false)\n      }\n    }\n\n    loadUsers()\n    return () => {\n      cancelled = true\n    }\n  }, [activeTab, userSearch])\n\n  useEffect(() => {\n    if (activeTab !== 'aircraft') return\n    let cancelled = false\n\n    async function loadAircraft() {\n      setIsAircraftLoading(true)\n      setAircraftError(null)\n      try {\n        const res = await fetch('/api/admin/aircraft')\n        if (!res.ok) throw new Error('Failed to load aircraft')\n        const data = await res.json()\n        if (!cancelled) setAircraft(data.aircraft || [])\n      } catch (error) {\n        console.error('Failed to load aircraft', error)\n        if (!cancelled) setAircraftError('Failed to load aircraft')\n      } finally {\n        if (!cancelled) setIsAircraftLoading(false)\n      }\n    }\n\n    loadAircraft()\n    return () => {\n      cancelled = true\n    }\n  }, [activeTab])\n\n  useEffect(() => {\n    if (activeTab !== 'clubs') return\n    let cancelled = false\n\n    async function loadClubs() {\n      setIsClubsLoading(true)\n      setClubsError(null)\n      try {\n        const res = await fetch('/api/admin/clubs')\n        if (!res.ok) throw new Error('Failed to load clubs')\n        const data = await res.json()\n        if (!cancelled) setClubs(data.clubs || [])\n      } catch (error) {\n        console.error('Failed to load clubs', error)\n        if (!cancelled) setClubsError('Failed to load clubs')\n      } finally {\n        if (!cancelled) setIsClubsLoading(false)\n      }\n    }\n\n    loadClubs()\n    return () => {\n      cancelled = true\n    }\n  }, [activeTab])\n\n  useEffect(() => {\n    if (activeTab !== 'marketplace') return\n    let cancelled = false\n\n    async function loadListings() {\n      setIsMarketplaceLoading(true)\n      setMarketplaceError(null)\n      try {\n        const res = await fetch('/api/admin/marketplace/listings?take=50')\n        if (!res.ok) throw new Error('Failed to load listings')\n        const data = await res.json()\n        if (!cancelled) setListings(data.listings || [])\n      } catch (error) {\n        console.error('Failed to load listings', error)\n        if (!cancelled) setMarketplaceError('Failed to load listings')\n      } finally {\n        if (!cancelled) setIsMarketplaceLoading(false)\n      }\n    }\n\n    loadListings()\n    return () => {\n      cancelled = true\n    }\n  }, [activeTab])\n\n  useEffect(() => {\n    if (activeTab !== 'billing') return\n    let cancelled = false\n\n    async function loadBilling() {\n      setIsBillingLoading(true)\n      setBillingError(null)\n      try {\n        const res = await fetch('/api/admin/billing/transactions?take=50')\n        if (!res.ok) throw new Error('Failed to load transactions')\n        const data = await res.json()\n        if (!cancelled) setBillingTransactions(data.transactions || [])\n      } catch (error) {\n        console.error('Failed to load billing', error)\n        if (!cancelled) setBillingError('Failed to load billing')\n      } finally {\n        if (!cancelled) setIsBillingLoading(false)\n      }\n    }\n\n    loadBilling()\n    return () => {\n      cancelled = true\n    }\n  }, [activeTab])\n\n  useEffect(() => {\n    if (!['awaiting-dispatch', 'currently-dispatched', 'past-flights'].includes(activeTab)) return\n    let cancelled = false\n\n    async function loadFlightSummary() {\n      setIsFlightsLoading(true)\n      setFlightsError(null)\n      try {\n        const res = await fetch('/api/admin/flights/summary')\n        if (!res.ok) throw new Error('Failed to load flight summary')\n        const data = await res.json()\n        if (!cancelled) setFlightSummary(data)\n      } catch (error) {\n        console.error('Failed to load flight summary', error)\n        if (!cancelled) setFlightsError('Failed to load flight summary')\n      } finally {\n        if (!cancelled) setIsFlightsLoading(false)\n      }\n    }\n\n    loadFlightSummary()\n    return () => {\n      cancelled = true\n    }\n  }, [activeTab])\n  \n  // Handler functions\n  const handleExport = () => {\n    const dataMap: Record<Tab, any[]> = {\n      overview: [],\n      users,\n      aircraft,\n      clubs,\n      marketplace: listings,\n      billing: billingTransactions,\n      \"general-settings\": [],\n      \"awaiting-dispatch\": [],\n      \"currently-dispatched\": [],\n      \"past-flights\": [],\n      administrators: [],\n      instructors: [],\n      groups: [],\n      items: [],\n      adjustments: [],\n      forms: [],\n      \"general-settings2\": [],\n      \"users-settings\": [],\n      \"schedule-settings\": [],\n      \"notification-settings\": [],\n      \"add-ons\": [],\n      system: systemServices,\n    }\n    \n    const data = dataMap[activeTab] || []\n    const csv = JSON.stringify(data, null, 2)\n    const blob = new Blob([csv], { type: 'application/json' })\n    const url = URL.createObjectURL(blob)\n    const a = document.createElement('a')\n    a.href = url\n    a.download = `${activeTab}-export-${Date.now()}.json`\n    a.click()\n    URL.revokeObjectURL(url)\n    alert('Data exported successfully!')\n  }\n  \n  const handleRefresh = () => {\n    // In production, this would refetch data from API\n    window.location.reload()\n  }\n  \n  // User actions\n  const handleViewUser = (user: any) => {\n    setViewUserModal(user)\n  }\n  \n  const handleEditUser = (user: any) => {\n    setEditUserModal(user)\n  }\n  \n  const handleBanUser = (userId: string | number) => {\n    if (confirm('Are you sure you want to suspend this user?')) {\n      alert(`User ${userId} suspended. In production, this would call API.`)\n    }\n  }\n  \n  const handleInviteUser = () => {\n    setInviteUserModal(true)\n  }\n  \n  // Aircraft actions\n  const handleViewAircraft = (ac: any) => {\n    setViewAircraftModal(ac)\n  }\n  \n  const handleEditAircraft = (ac: any) => {\n    setEditAircraftModal(ac)\n  }\n  \n  const handleDeleteAircraft = (id: string | number) => {\n    if (confirm('Are you sure you want to delete this aircraft?')) {\n      alert(`Aircraft ${id} deleted. In production, this would call API.`)\n    }\n  }\n  \n  // Club actions\n  const handleViewClub = (club: any) => {\n    setViewClubModal(club)\n  }\n  \n  const handleEditClub = (club: any) => {\n    setEditClubModal(club)\n  }\n  \n  const handleDeleteClub = (id: string | number) => {\n    if (confirm('Are you sure you want to delete this club?')) {\n      alert(`Club ${id} deleted. In production, this would call API.`)\n    }\n  }\n  \n  const handleAddClub = () => {\n    setAddClubModal(true)\n  }\n  \n  // Marketplace actions\n  const handleViewListing = (listing: any) => {\n    setViewListingModal(listing)\n  }\n  \n  const handleApproveListing = (id: string | number) => {\n    alert(`Listing ${id} approved. In production, this would call API.`)\n  }\n  \n  const handleDeleteListing = (id: string | number) => {\n    if (confirm('Are you sure you want to delete this listing?')) {\n      alert(`Listing ${id} deleted. In production, this would call API.`)\n    }\n  }\n  \n  // Billing actions\n  const handleViewTransaction = (txn: any) => {\n    setViewTransactionModal(txn)\n  }\n  \n  const handleDownloadInvoice = (txnId: string) => {\n    alert(`Downloading invoice ${txnId}. In production, this would generate PDF.`)\n  }\n  \n  // Settings actions\n  const handleSaveGeneralSettings = () => {\n    console.log('Saving general settings:', generalSettings)\n    alert('General settings saved successfully!')\n  }\n  \n  const handleSaveUserSettings = () => {\n    console.log('Saving user settings:', userSettings)\n    alert('User settings saved successfully!')\n  }\n  \n  const handleSaveScheduleSettings = () => {\n    console.log('Saving schedule settings:', scheduleSettings)\n    alert('Schedule settings saved successfully!')\n  }\n\n  return (\n    <div className=\"flex min-h-screen bg-background pt-[44px]\">\n\n      {/* â”€â”€ SIDEBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}\n      <aside className=\"fixed top-[44px] left-0 h-[calc(100vh-44px)] w-56 shrink-0 overflow-y-auto border-r border-border bg-card\">\n        {/* Sidebar header */}\n        <div className=\"flex items-center gap-2 border-b border-border px-4 py-3\">\n          <div className=\"flex h-6 w-6 items-center justify-center rounded bg-destructive/90\">\n            <ShieldCheck className=\"h-3.5 w-3.5 text-white\" />\n          </div>\n          <span className=\"text-xs font-semibold\">Admin</span>\n          <Badge variant=\"destructive\" className=\"ml-auto text-[9px] px-1 py-0\">ADMIN</Badge>\n        </div>\n\n        {/* Nav groups */}\n        <nav className=\"py-2\">\n          {NAV_GROUPS.map((group, gi) => (\n            <div key={group.label} className={gi > 0 ? \"mt-1 border-t border-border pt-1\" : \"\"}>\n              <p className=\"px-4 py-1.5 text-[10px] font-semibold uppercase tracking-wider text-muted-foreground/60\">\n                {group.label}\n              </p>\n              {group.items.map((item) => {\n                const isActive = activeTab === item.id\n                \n                // If item has href, render as Link\n                if (item.href) {\n                  return (\n                    <Link\n                      key={item.id}\n                      href={item.href}\n                      className=\"flex w-full items-center justify-between px-4 py-2.5 text-xs font-medium transition-colors text-foreground hover:bg-muted\"\n                    >\n                      {item.label}\n                      <ArrowUpRight className=\"h-3 w-3 shrink-0 rotate-45 text-muted-foreground\" />\n                    </Link>\n                  )\n                }\n                \n                // Otherwise, render as button with state\n                return (\n                  <button\n                    key={item.id}\n                    onClick={() => setActiveTab(item.id)}\n                    className={`flex w-full items-center justify-between px-4 py-2.5 text-xs font-medium transition-colors ${\n                      isActive\n                        ? \"bg-primary text-primary-foreground\"\n                        : \"text-foreground hover:bg-muted\"\n                    }`}\n                  >\n                    {item.label}\n                    <ArrowUpRight className={`h-3 w-3 shrink-0 rotate-45 ${isActive ? \"text-primary-foreground/70\" : \"text-muted-foreground\"}`} />\n                  </button>\n                )\n              })}\n            </div>\n          ))}\n        </nav>\n      </aside>\n\n      {/* â”€â”€ MAIN CONTENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}\n      <div className=\"flex-1 overflow-auto ml-[224px]\">\n        {/* Top bar */}\n        <div className=\"sticky top-0 z-30 flex h-11 items-center justify-between border-b border-border bg-card/95 px-6 backdrop-blur\">\n          <h1 className=\"text-sm font-semibold capitalize\">\n            {NAV_GROUPS.flatMap(g => g.items).find(i => i.id === activeTab)?.label ?? \"Overview\"}\n          </h1>\n          <div className=\"flex items-center gap-2\">\n            <Button size=\"sm\" variant=\"outline\" className=\"h-7 gap-1.5 text-xs\" onClick={handleExport}>\n              <Download className=\"h-3 w-3\" /> Export\n            </Button>\n            <Button size=\"sm\" variant=\"outline\" className=\"h-7 gap-1.5 text-xs\" onClick={handleRefresh}>\n              <RefreshCw className=\"h-3 w-3\" /> Refresh\n            </Button>\n          </div>\n        </div>\n\n      <div className=\"p-6 space-y-6\">\n\n        {/* â”€â”€ FLIGHTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}\n        {activeTab === \"awaiting-dispatch\" && (\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"text-sm\">Scheduled Flights</CardTitle>\n              <CardDescription className=\"text-xs\">\n                Upcoming bookings waiting to start\n                {flightsError && <span className=\"ml-2 text-destructive\">{flightsError}</span>}\n                {isFlightsLoading && !flightsError && <span className=\"ml-2 text-muted-foreground\">Loadingâ€¦</span>}\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"grid gap-4 sm:grid-cols-3\">\n                <StatCard label=\"Scheduled\" value={String(flightSummary?.scheduledFlights ?? 0)} sub=\"Upcoming\" trend=\"neutral\" icon={Clock} accent=\"bg-muted text-muted-foreground\" />\n                <StatCard label=\"Active\" value={String(flightSummary?.activeFlights ?? 0)} sub=\"In progress\" trend=\"neutral\" icon={Plane} accent=\"bg-chart-2/10 text-chart-2\" />\n                <StatCard label=\"Completed\" value={String(flightSummary?.completedFlights ?? 0)} sub=\"Logged\" trend=\"neutral\" icon={CheckCircle2} accent=\"bg-primary/10 text-primary\" />\n              </div>\n            </CardContent>\n          </Card>\n        )}\n        {activeTab === \"currently-dispatched\" && (\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"text-sm\">Active Flights</CardTitle>\n              <CardDescription className=\"text-xs\">\n                Flights currently in progress\n                {flightsError && <span className=\"ml-2 text-destructive\">{flightsError}</span>}\n                {isFlightsLoading && !flightsError && <span className=\"ml-2 text-muted-foreground\">Loadingâ€¦</span>}\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"grid gap-4 sm:grid-cols-3\">\n                <StatCard label=\"Active\" value={String(flightSummary?.activeFlights ?? 0)} sub=\"In progress\" trend=\"neutral\" icon={Plane} accent=\"bg-chart-2/10 text-chart-2\" />\n                <StatCard label=\"Scheduled\" value={String(flightSummary?.scheduledFlights ?? 0)} sub=\"Upcoming\" trend=\"neutral\" icon={Clock} accent=\"bg-muted text-muted-foreground\" />\n                <StatCard label=\"Completed\" value={String(flightSummary?.completedFlights ?? 0)} sub=\"Logged\" trend=\"neutral\" icon={CheckCircle2} accent=\"bg-primary/10 text-primary\" />\n              </div>\n            </CardContent>\n          </Card>\n        )}\n        {activeTab === \"past-flights\" && (\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"text-sm\">Completed Flights</CardTitle>\n              <CardDescription className=\"text-xs\">\n                Historical flight count across the platform\n                {flightsError && <span className=\"ml-2 text-destructive\">{flightsError}</span>}\n                {isFlightsLoading && !flightsError && <span className=\"ml-2 text-muted-foreground\">Loadingâ€¦</span>}\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"grid gap-4 sm:grid-cols-3\">\n                <StatCard label=\"Completed\" value={String(flightSummary?.completedFlights ?? 0)} sub=\"Logged\" trend=\"neutral\" icon={CheckCircle2} accent=\"bg-primary/10 text-primary\" />\n                <StatCard label=\"Active\" value={String(flightSummary?.activeFlights ?? 0)} sub=\"In progress\" trend=\"neutral\" icon={Plane} accent=\"bg-chart-2/10 text-chart-2\" />\n                <StatCard label=\"Scheduled\" value={String(flightSummary?.scheduledFlights ?? 0)} sub=\"Upcoming\" trend=\"neutral\" icon={Clock} accent=\"bg-muted text-muted-foreground\" />\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {/* â”€â”€ PEOPLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}\n        {activeTab === \"administrators\" && (\n          <PlaceholderPanel title=\"Administrators\" description=\"Platform admins with elevated privileges. Manage roles and access levels here.\" />\n        )}\n        {activeTab === \"instructors\" && (\n          <PlaceholderPanel title=\"Instructors\" description=\"Certified flight instructors registered on the platform. Manage endorsements and schedules.\" />\n        )}\n        {activeTab === \"groups\" && (\n          <PlaceholderPanel title=\"Groups\" description=\"Custom user groups for permissions, scheduling, and billing segmentation.\" />\n        )}\n\n        {/* â”€â”€ RESOURCES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}\n        {activeTab === \"items\" && (\n          <PlaceholderPanel title=\"Items\" description=\"Billable items such as fuel, instruction, or add-on charges attached to flights.\" />\n        )}\n        {activeTab === \"adjustments\" && (\n          <PlaceholderPanel title=\"Adjustments\" description=\"Manual billing adjustments, credits, and debits applied to member accounts.\" />\n        )}\n        {activeTab === \"forms\" && (\n          <PlaceholderPanel title=\"Forms\" description=\"Custom pre-flight, post-flight, and maintenance forms assigned to aircraft or members.\" />\n        )}\n\n        {/* â”€â”€ SETTINGS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}\n        {activeTab === \"users-settings\" && (\n          <PlaceholderPanel title=\"Users Settings\" description=\"Configure user registration, roles, self-sign-up, and profile requirements.\" />\n        )}\n        {activeTab === \"schedule-settings\" && (\n          <PlaceholderPanel title=\"Schedule Settings\" description=\"Configure booking windows, advance notice rules, and scheduling constraints.\" />\n        )}\n        {activeTab === \"notification-settings\" && (\n          <PlaceholderPanel title=\"Notification Settings\" description=\"Set up email, SMS, and push notification triggers for all platform events.\" />\n        )}\n        {activeTab === \"add-ons\" && (\n          <PlaceholderPanel title=\"Add-ons\" description=\"Manage third-party integrations, plugins, and premium feature modules.\" />\n        )}\n\n        {/* â”€â”€ PLATFORM OVERVIEW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}\n        {activeTab === \"general-settings\" && (\n          <>\n            {overviewError && <div className=\"text-xs text-destructive\">{overviewError}</div>}\n            {isOverviewLoading && !overviewError && <div className=\"text-xs text-muted-foreground\">Loadingâ€¦</div>}\n            {/* Stat cards */}\n            <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-4\">\n              <StatCard label=\"Total Users\" value={String(stats?.totalUsers ?? 0)} sub=\"All users\" trend=\"neutral\" icon={Users} accent=\"bg-primary/10 text-primary\" />\n              <StatCard label=\"Active Aircraft\" value={String(stats?.totalAircraft ?? aircraft.length)} sub=\"Registered\" trend=\"neutral\" icon={Plane} accent=\"bg-chart-2/10 text-chart-2\" />\n              <StatCard label=\"MRR\" value={`$${Number(stats?.estimatedMRR ?? 0).toFixed(2)}`} sub=\"Estimated\" trend=\"neutral\" icon={DollarSign} accent=\"bg-chart-3/10 text-chart-3\" />\n              <StatCard label=\"Flagged Items\" value={String(stats?.listingFlagged ?? listings.filter(l => l.flagged).length)} sub=\"Needs review\" trend=\"neutral\" icon={AlertTriangle} accent=\"bg-destructive/10 text-destructive\" />\n            </div>\n\n            {/* Charts row */}\n            <div className=\"grid gap-4 lg:grid-cols-3\">\n              <Card className=\"lg:col-span-1\">\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-sm\">User Signups</CardTitle>\n                  <CardDescription className=\"text-xs\">New registrations per month</CardDescription>\n                </CardHeader>\n                <CardContent>\n                  <ResponsiveContainer width=\"100%\" height={180}>\n                    {signupData.length === 0 ? (\n                      <div className=\"flex h-[180px] items-center justify-center text-xs text-muted-foreground\">\n                        No signup data yet\n                      </div>\n                    ) : (\n                      <AreaChart data={signupData}>\n                        <defs>\n                          <linearGradient id=\"gUsers\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                            <stop offset=\"5%\" stopColor=\"#3b82f6\" stopOpacity={0.4} />\n                            <stop offset=\"95%\" stopColor=\"#3b82f6\" stopOpacity={0.05} />\n                          </linearGradient>\n                        </defs>\n                        <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#334155\" opacity={0.3} />\n                        <XAxis dataKey=\"month\" tick={{ fill: \"#94a3b8\", fontSize: 10 }} axisLine={false} tickLine={false} />\n                        <YAxis tick={{ fill: \"#94a3b8\", fontSize: 10 }} axisLine={false} tickLine={false} />\n                        <Tooltip contentStyle={{ background: \"#1e293b\", border: \"1px solid #334155\", borderRadius: 8, fontSize: 11, color: \"#f1f5f9\" }} />\n                        <Area type=\"monotone\" dataKey=\"users\" stroke=\"#3b82f6\" strokeWidth={2} fill=\"url(#gUsers)\" />\n                      </AreaChart>\n                    )}\n                  </ResponsiveContainer>\n                </CardContent>\n              </Card>\n\n              <Card className=\"lg:col-span-1\">\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-sm\">Revenue (MRR)</CardTitle>\n                  <CardDescription className=\"text-xs\">Monthly recurring revenue</CardDescription>\n                </CardHeader>\n                <CardContent>\n                  <ResponsiveContainer width=\"100%\" height={180}>\n                    {revenueData.length === 0 ? (\n                      <div className=\"flex h-[180px] items-center justify-center text-xs text-muted-foreground\">\n                        No revenue data yet\n                      </div>\n                    ) : (\n                      <LineChart data={revenueData}>\n                        <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#334155\" opacity={0.3} />\n                        <XAxis dataKey=\"month\" tick={{ fill: \"#94a3b8\", fontSize: 10 }} axisLine={false} tickLine={false} />\n                        <YAxis tick={{ fill: \"#94a3b8\", fontSize: 10 }} axisLine={false} tickLine={false} tickFormatter={(v) => `$${(v/1000).toFixed(0)}k`} />\n                        <Tooltip contentStyle={{ background: \"#1e293b\", border: \"1px solid #334155\", borderRadius: 8, fontSize: 11, color: \"#f1f5f9\" }} formatter={(v: any) => [`$${v.toLocaleString()}`, \"Revenue\"]} />\n                        <Line type=\"monotone\" dataKey=\"revenue\" stroke=\"#10b981\" strokeWidth={2} dot={{ fill: \"#10b981\", r: 3 }} />\n                      </LineChart>\n                    )}\n                  </ResponsiveContainer>\n                </CardContent>\n              </Card>\n\n              <Card className=\"lg:col-span-1\">\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-sm\">Platform Activity</CardTitle>\n                  <CardDescription className=\"text-xs\">Flights logged vs plans created (7d)</CardDescription>\n                </CardHeader>\n                <CardContent>\n                  <ResponsiveContainer width=\"100%\" height={180}>\n                    {activityData.length === 0 ? (\n                      <div className=\"flex h-[180px] items-center justify-center text-xs text-muted-foreground\">\n                        No activity data yet\n                      </div>\n                    ) : (\n                      <BarChart data={activityData}>\n                        <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#334155\" opacity={0.3} />\n                        <XAxis dataKey=\"day\" tick={{ fill: \"#94a3b8\", fontSize: 10 }} axisLine={false} tickLine={false} />\n                        <YAxis tick={{ fill: \"#94a3b8\", fontSize: 10 }} axisLine={false} tickLine={false} />\n                        <Tooltip contentStyle={{ background: \"#1e293b\", border: \"1px solid #334155\", borderRadius: 8, fontSize: 11, color: \"#f1f5f9\" }} />\n                        <Bar dataKey=\"plans\" fill=\"#a855f7\" opacity={0.4} radius={[2, 2, 0, 0]} />\n                        <Bar dataKey=\"flights\" fill=\"#a855f7\" radius={[2, 2, 0, 0]} />\n                      </BarChart>\n                    )}\n                  </ResponsiveContainer>\n                </CardContent>\n              </Card>\n            </div>\n\n            {/* Plan distribution + recent users */}\n            <div className=\"grid gap-4 lg:grid-cols-3\">\n              <Card>\n                <CardHeader className=\"pb-3\">\n                  <CardTitle className=\"text-sm\">Plan Distribution</CardTitle>\n                </CardHeader>\n                  <CardContent className=\"space-y-3\">\n                  {[\n                    { plan: \"Pro\", count: Number(stats?.proUsers ?? 0), total: Number(stats?.totalUsers ?? 0) || 1, color: \"bg-chart-2\" },\n                    { plan: \"Free\", count: Number(stats?.freeUsers ?? 0), total: Number(stats?.totalUsers ?? 0) || 1, color: \"bg-muted-foreground\" },\n                  ].map((p) => (\n                    <div key={p.plan} className=\"space-y-1.5\">\n                      <div className=\"flex items-center justify-between text-xs\">\n                        <span className=\"font-medium\">{p.plan}</span>\n                        <span className=\"text-muted-foreground\">{p.count.toLocaleString()} users</span>\n                      </div>\n                      <div className=\"h-2 w-full overflow-hidden rounded-full bg-muted\">\n                        <div className={`h-full rounded-full ${p.color}`} style={{ width: `${(p.count / p.total) * 100}%` }} />\n                      </div>\n                    </div>\n                  ))}\n                  <Separator />\n                  <div className=\"flex justify-between text-xs text-muted-foreground\">\n                    <span>Total users</span><span className=\"font-semibold text-foreground\">{Number(stats?.totalUsers ?? 0).toLocaleString()}</span>\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card className=\"lg:col-span-2\">\n                <CardHeader className=\"pb-3\">\n                  <div className=\"flex items-center justify-between\">\n                    <CardTitle className=\"text-sm\">Recent Registrations</CardTitle>\n                    <Button size=\"sm\" variant=\"ghost\" className=\"h-7 text-xs\" onClick={() => setActiveTab(\"users\")}>View all</Button>\n                  </div>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-2\">\n                    {users.slice(0, 4).map((user) => (\n                      <div key={user.id} className=\"flex items-center justify-between rounded-lg border border-border p-3\">\n                        <div className=\"flex items-center gap-3\">\n                          <div className=\"flex h-8 w-8 items-center justify-center rounded-full bg-primary/10 text-xs font-semibold text-primary\">\n                            {user.name?.split(\" \").map((n: string) => n[0]).join(\"\")}\n                          </div>\n                          <div>\n                            <p className=\"text-xs font-medium\">{user.name}</p>\n                            <p className=\"text-[11px] text-muted-foreground\">{user.email}</p>\n                          </div>\n                        </div>\n                        <div className=\"flex items-center gap-3\">\n                          <Badge variant=\"outline\" className=\"text-[10px]\">{user.tier || 'free'}</Badge>\n                          <UserStatusBadge status={user.status || 'active'} />\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n\n            {/* Data pipeline visualization */}\n            <Card>\n              <CardHeader className=\"pb-3\">\n                <div className=\"flex items-center justify-between\">\n                  <CardTitle className=\"text-sm\">Data Pipeline</CardTitle>\n                  <Tabs value={pipelineModule} onValueChange={setPipelineModule}>\n                    <TabsList className=\"h-7\">\n                      {['totals','logbook','training','currency','plan','marketplace','mechanic','club'].map((key) => (\n                        <TabsTrigger key={key} value={key} className=\"text-[10px] px-2\">\n                          {key.charAt(0).toUpperCase() + key.slice(1)}\n                        </TabsTrigger>\n                      ))}\n                    </TabsList>\n                  </Tabs>\n                </div>\n                <CardDescription className=\"text-xs\">Ingestion â†’ Validation â†’ Storage â†’ Analytics â†’ Outputs</CardDescription>\n              </CardHeader>\n              <CardContent>\n                {!pipelineData && (\n                  <div className=\"text-xs text-muted-foreground\">Loading pipelineâ€¦</div>\n                )}\n\n                {pipelineData?.module === 'totals' && (\n                  <div className=\"grid gap-4 lg:grid-cols-5\">\n                    {pipelineData.stages?.map((stage: any) => (\n                      <StackedStage key={stage.stage} label={stage.stage} breakdown={stage.breakdown} />\n                    ))}\n                  </div>\n                )}\n\n                {pipelineData?.module !== 'totals' && pipelineData?.stages && (\n                  <div className=\"grid gap-4 lg:grid-cols-5\">\n                    {pipelineData.stages.map((stage: any) => (\n                      <PipelineStageCard\n                        key={stage.stage}\n                        label={stage.stage}\n                        value={stage.value}\n                        usedBy={pipelineData.usedBy}\n                      />\n                    ))}\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n\n            {/* System health quick view */}\n            <Card>\n              <CardHeader className=\"pb-3\">\n                <div className=\"flex items-center justify-between\">\n                  <CardTitle className=\"text-sm\">System Health</CardTitle>\n                  <Button size=\"sm\" variant=\"ghost\" className=\"h-7 text-xs\" onClick={() => setActiveTab(\"system\")}>View all</Button>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <div className=\"grid gap-3 sm:grid-cols-2 lg:grid-cols-4\">\n                  {systemServices.slice(0, 4).map((svc) => (\n                    <div key={svc.name} className=\"flex items-center gap-3 rounded-lg border border-border p-3\">\n                      <StatusDot status={svc.status} />\n                      <div>\n                        <p className=\"text-xs font-medium\">{svc.name}</p>\n                        <p className=\"text-[11px] text-muted-foreground\">{svc.uptime} uptime Â· {svc.latency}</p>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n          </>\n        )}\n\n        {/* â”€â”€ USERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}\n        {activeTab === \"users\" && (\n          <>\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <h2 className=\"text-lg font-semibold\">Users</h2>\n                <p className=\"text-xs text-muted-foreground\">Manage all registered pilots and administrators</p>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <Button size=\"sm\" variant=\"outline\" className=\"h-8 gap-1.5 text-xs\" onClick={handleExport}>\n                  <Download className=\"h-3 w-3\" /> Export\n                </Button>\n                <Button size=\"sm\" className=\"h-8 gap-1.5 text-xs\" onClick={handleInviteUser}>\n                  <UserPlus className=\"h-3 w-3\" /> Invite User\n                </Button>\n              </div>\n            </div>\n\n            <div className=\"grid gap-4 sm:grid-cols-3\">\n              <StatCard label=\"Total Users\" value={String(stats?.totalUsers ?? users.length ?? 0)} sub=\"All users\" trend=\"neutral\" icon={Users} accent=\"bg-primary/10 text-primary\" />\n              <StatCard label=\"Active\" value={String(users.filter(u => u.status === 'active').length)} sub=\"Active users\" trend=\"neutral\" icon={CheckCircle2} accent=\"bg-chart-2/10 text-chart-2\" />\n              <StatCard label=\"Suspended\" value={String(users.filter(u => u.status === 'suspended').length)} sub=\"Suspended\" trend=\"neutral\" icon={Ban} accent=\"bg-destructive/10 text-destructive\" />\n            </div>\n\n            <Card>\n              <CardHeader className=\"pb-3\">\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"relative flex-1 max-w-xs\">\n                    <Search className=\"absolute left-2.5 top-1/2 h-3.5 w-3.5 -translate-y-1/2 text-muted-foreground\" />\n                    <Input\n                      placeholder=\"Search users...\"\n                      value={userSearch}\n                      onChange={(e) => setUserSearch(e.target.value)}\n                      className=\"h-8 pl-8 text-xs\"\n                    />\n                  </div>\n                  <Button size=\"sm\" variant=\"outline\" className=\"h-8 gap-1.5 text-xs\">\n                    <Filter className=\"h-3 w-3\" /> Filter\n                  </Button>\n                  {usersError && <span className=\"text-xs text-destructive\">{usersError}</span>}\n                  {isUsersLoading && !usersError && <span className=\"text-xs text-muted-foreground\">Loadingâ€¦</span>}\n                </div>\n              </CardHeader>\n              <CardContent className=\"p-0\">\n                <table className=\"w-full text-xs\">\n                  <thead>\n                    <tr className=\"border-b border-border bg-muted/40\">\n                      <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">User</th>\n                      <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">Role</th>\n                      <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">Plan</th>\n                      <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">Status</th>\n                      <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">Flight Hours</th>\n                      <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">Club</th>\n                      <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">Joined</th>\n                      <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">Actions</th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"divide-y divide-border\">\n                    {filteredUsers.map((user) => (\n                      <tr key={user.id} className=\"hover:bg-muted/30 transition-colors\">\n                        <td className=\"px-4 py-3\">\n                          <div className=\"flex items-center gap-2.5\">\n                            <div className=\"flex h-7 w-7 items-center justify-center rounded-full bg-primary/10 text-[11px] font-semibold text-primary shrink-0\">\n                                {user.name?.split(\" \").map((n: string) => n[0]).join(\"\")}\n                            </div>\n                            <div>\n                              <p className=\"font-medium text-foreground\">{user.name}</p>\n                              <p className=\"text-muted-foreground\">{user.email}</p>\n                            </div>\n                          </div>\n                        </td>\n                        <td className=\"px-4 py-3 capitalize text-muted-foreground\">{user.role}</td>\n                        <td className=\"px-4 py-3\">\n                          <Badge variant=\"outline\" className=\"text-[10px]\">{user.tier || 'free'}</Badge>\n                        </td>\n                        <td className=\"px-4 py-3\"><UserStatusBadge status={user.status || 'active'} /></td>\n                        <td className=\"px-4 py-3 text-muted-foreground\">{Number(user.hours || 0).toFixed(1)}</td>\n                        <td className=\"px-4 py-3 text-muted-foreground\">{user.club || \"â€”\"}</td>\n                        <td className=\"px-4 py-3 text-muted-foreground\">{user.joined || \"â€”\"}</td>\n                        <td className=\"px-4 py-3\">\n                          <div className=\"flex items-center gap-1\">\n                            <Button size=\"sm\" variant=\"ghost\" className=\"h-6 w-6 p-0\" onClick={() => handleViewUser(user)}><Eye className=\"h-3 w-3\" /></Button>\n                            <Button size=\"sm\" variant=\"ghost\" className=\"h-6 w-6 p-0\" onClick={() => handleEditUser(user)}><Edit className=\"h-3 w-3\" /></Button>\n                            <Button size=\"sm\" variant=\"ghost\" className=\"h-6 w-6 p-0 text-destructive hover:text-destructive\" onClick={() => handleBanUser(user.id)}><Ban className=\"h-3 w-3\" /></Button>\n                          </div>\n                        </td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </CardContent>\n            </Card>\n          </>\n        )}\n\n        {/* â”€â”€ AIRCRAFT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}\n        {activeTab === \"aircraft\" && (\n          <>\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <h2 className=\"text-lg font-semibold\">Aircraft Registry</h2>\n                <p className=\"text-xs text-muted-foreground\">All aircraft registered across the platform</p>\n              </div>\n              <Button size=\"sm\" variant=\"outline\" className=\"h-8 gap-1.5 text-xs\" onClick={handleExport}>\n                <Download className=\"h-3 w-3\" /> Export\n              </Button>\n            </div>\n            {aircraftError && <div className=\"text-xs text-destructive\">{aircraftError}</div>}\n            {isAircraftLoading && !aircraftError && <div className=\"text-xs text-muted-foreground\">Loadingâ€¦</div>}\n\n            <div className=\"grid gap-4 sm:grid-cols-4\">\n              <StatCard label=\"Total Aircraft\" value={String(aircraft.length)} sub=\"Registered\" trend=\"neutral\" icon={Plane} accent=\"bg-primary/10 text-primary\" />\n              <StatCard label=\"Active\" value={String(aircraft.filter(a => a.status === 'Available').length)} sub=\"Available\" trend=\"neutral\" icon={CheckCircle2} accent=\"bg-chart-2/10 text-chart-2\" />\n              <StatCard label=\"In Maintenance\" value={String(aircraft.filter(a => a.status === 'Maintenance').length)} sub=\"Needs service\" trend=\"neutral\" icon={Wrench} accent=\"bg-chart-3/10 text-chart-3\" />\n              <StatCard label=\"Grounded\" value={String(aircraft.filter(a => a.status === 'Grounded').length)} sub=\"Not airworthy\" trend=\"neutral\" icon={AlertTriangle} accent=\"bg-destructive/10 text-destructive\" />\n            </div>\n\n            <Card>\n              <CardContent className=\"p-0\">\n                <table className=\"w-full text-xs\">\n                  <thead>\n                    <tr className=\"border-b border-border bg-muted/40\">\n                      <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">Registration</th>\n                      <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">Type</th>\n                      <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">Owner</th>\n                      <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">Status</th>\n                      <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">Hobbs Time</th>\n                      <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">Next MX</th>\n                      <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">Airworthiness</th>\n                      <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">Actions</th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"divide-y divide-border\">\n                    {aircraft.map((a) => (\n                      <tr key={a.id} className=\"hover:bg-muted/30 transition-colors\">\n                        <td className=\"px-4 py-3 font-mono font-semibold text-foreground\">{a.nNumber || 'N/A'}</td>\n                        <td className=\"px-4 py-3 text-muted-foreground\">{[a.make, a.model].filter(Boolean).join(' ') || 'â€”'}</td>\n                        <td className=\"px-4 py-3 text-muted-foreground\">{a.groupName || 'â€”'}</td>\n                        <td className=\"px-4 py-3\">\n                          <UserStatusBadge status={a.status === \"Available\" ? \"active\" : a.status === \"Maintenance\" ? \"pending\" : \"suspended\"} />\n                        </td>\n                        <td className=\"px-4 py-3 text-muted-foreground\">{Number(a.hobbs || 0).toFixed(1)}</td>\n                        <td className={`px-4 py-3 font-medium ${a.nextMx === \"Overdue\" ? \"text-destructive\" : \"text-muted-foreground\"}`}>{a.nextMx || 'â€”'}</td>\n                        <td className=\"px-4 py-3\">\n                          <span className={`inline-flex items-center gap-1 text-[11px] font-medium ${a.status === \"Available\" ? \"text-chart-2\" : \"text-destructive\"}`}>\n                            {a.status === \"Available\" ? <CheckCircle2 className=\"h-3 w-3\" /> : <AlertTriangle className=\"h-3 w-3\" />}\n                            {a.status || 'Unknown'}\n                          </span>\n                        </td>\n                        <td className=\"px-4 py-3\">\n                          <div className=\"flex items-center gap-1\">\n                            <Button size=\"sm\" variant=\"ghost\" className=\"h-6 w-6 p-0\" onClick={() => handleViewAircraft(a)}><Eye className=\"h-3 w-3\" /></Button>\n                            <Button size=\"sm\" variant=\"ghost\" className=\"h-6 w-6 p-0\" onClick={() => handleEditAircraft(a)}><Edit className=\"h-3 w-3\" /></Button>\n                            <Button size=\"sm\" variant=\"ghost\" className=\"h-6 w-6 p-0 text-destructive hover:text-destructive\" onClick={() => handleDeleteAircraft(a.id)}><Trash2 className=\"h-3 w-3\" /></Button>\n                          </div>\n                        </td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </CardContent>\n            </Card>\n          </>\n        )}\n\n        {/* â”€â”€ CLUBS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}\n        {activeTab === \"clubs\" && (\n          <>\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <h2 className=\"text-lg font-semibold\">Flying Clubs</h2>\n                <p className=\"text-xs text-muted-foreground\">Manage all registered clubs and organisations</p>\n              </div>\n              <Button size=\"sm\" className=\"h-8 gap-1.5 text-xs\" onClick={handleAddClub}>\n                <Building2 className=\"h-3 w-3\" /> Add Club\n              </Button>\n            </div>\n            {clubsError && <div className=\"text-xs text-destructive\">{clubsError}</div>}\n            {isClubsLoading && !clubsError && <div className=\"text-xs text-muted-foreground\">Loadingâ€¦</div>}\n\n            <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-4\">\n              <StatCard label=\"Total Clubs\" value={String(clubs.length)} sub=\"Registered\" trend=\"neutral\" icon={Building2} accent=\"bg-primary/10 text-primary\" />\n              <StatCard label=\"Total Members\" value={String(clubs.reduce((sum, c) => sum + (c.members || 0), 0))} sub=\"Across clubs\" trend=\"neutral\" icon={Users} accent=\"bg-chart-2/10 text-chart-2\" />\n              <StatCard label=\"Club Revenue\" value={`$${clubs.reduce((sum, c) => sum + (c.revenue || 0), 0).toLocaleString()}`} sub=\"This month\" trend=\"neutral\" icon={DollarSign} accent=\"bg-chart-3/10 text-chart-3\" />\n              <StatCard label=\"On Trial\" value={String(clubs.filter(c => c.status === 'trial').length)} sub=\"Trial groups\" trend=\"neutral\" icon={Clock} accent=\"bg-muted text-muted-foreground\" />\n            </div>\n\n            <div className=\"grid gap-4 md:grid-cols-2\">\n              {clubs.map((club) => (\n                  <Card key={club.id} className=\"hover:border-primary/40 transition-colors\">\n                  <CardContent className=\"p-5\">\n                    <div className=\"flex items-start justify-between mb-4\">\n                      <div className=\"flex items-center gap-3\">\n                        <div className=\"flex h-10 w-10 items-center justify-center rounded-lg bg-primary/10 text-sm font-bold text-primary\">\n                          {club.name?.split(\" \").map((w: string) => w[0]).slice(0, 2).join(\"\")}\n                        </div>\n                        <div>\n                          <p className=\"text-sm font-semibold\">{club.name}</p>\n                          <p className=\"text-xs text-muted-foreground\">Since {club.createdAt ? new Date(club.createdAt).toLocaleDateString() : 'â€”'}</p>\n                        </div>\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        <Badge variant=\"outline\" className=\"text-[10px]\">{club.plan || 'Free'}</Badge>\n                        <UserStatusBadge status={club.status === \"trial\" ? \"pending\" : \"active\"} />\n                      </div>\n                    </div>\n                    <div className=\"grid grid-cols-3 gap-3 text-center\">\n                      <div className=\"rounded-lg bg-muted/50 p-2\">\n                        <p className=\"text-sm font-bold\">{club.members ?? 0}</p>\n                        <p className=\"text-[11px] text-muted-foreground\">Members</p>\n                      </div>\n                      <div className=\"rounded-lg bg-muted/50 p-2\">\n                        <p className=\"text-sm font-bold\">{club.aircraft ?? 0}</p>\n                        <p className=\"text-[11px] text-muted-foreground\">Aircraft</p>\n                      </div>\n                      <div className=\"rounded-lg bg-muted/50 p-2\">\n                        <p className=\"text-sm font-bold\">${Number(club.revenue || 0).toLocaleString()}</p>\n                        <p className=\"text-[11px] text-muted-foreground\">Revenue/mo</p>\n                      </div>\n                    </div>\n                    <div className=\"mt-3 flex gap-2\">\n                      <Button size=\"sm\" variant=\"outline\" className=\"flex-1 h-7 text-xs\" onClick={() => handleViewClub(club)}>View</Button>\n                      <Button size=\"sm\" variant=\"ghost\" className=\"h-7 w-7 p-0\" onClick={() => handleEditClub(club)}><Edit className=\"h-3 w-3\" /></Button>\n                      <Button size=\"sm\" variant=\"ghost\" className=\"h-7 w-7 p-0 text-destructive hover:text-destructive\" onClick={() => handleDeleteClub(club.id)}><Trash2 className=\"h-3 w-3\" /></Button>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          </>\n        )}\n\n        {/* â”€â”€ MARKETPLACE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}\n        {activeTab === \"marketplace\" && (\n          <>\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <h2 className=\"text-lg font-semibold\">Marketplace</h2>\n                <p className=\"text-xs text-muted-foreground\">Review, approve, and moderate aircraft listings</p>\n              </div>\n              <Button size=\"sm\" variant=\"outline\" className=\"h-8 gap-1.5 text-xs\" onClick={handleExport}>\n                <Download className=\"h-3 w-3\" /> Export\n              </Button>\n            </div>\n            {marketplaceError && <div className=\"text-xs text-destructive\">{marketplaceError}</div>}\n            {isMarketplaceLoading && !marketplaceError && <div className=\"text-xs text-muted-foreground\">Loadingâ€¦</div>}\n\n            <div className=\"grid gap-4 sm:grid-cols-4\">\n              <StatCard label=\"Active Listings\" value={String(stats?.listingActive ?? listings.filter(l => l.status === 'active').length)} sub=\"Active\" trend=\"neutral\" icon={Globe} accent=\"bg-primary/10 text-primary\" />\n              <StatCard label=\"Pending Review\" value={String(stats?.listingPending ?? listings.filter(l => l.status === 'pending').length)} sub=\"Awaiting\" trend=\"neutral\" icon={Clock} accent=\"bg-chart-3/10 text-chart-3\" />\n              <StatCard label=\"Flagged\" value={String(stats?.listingFlagged ?? listings.filter(l => l.flagged).length)} sub=\"Require action\" trend=\"neutral\" icon={ShieldAlert} accent=\"bg-destructive/10 text-destructive\" />\n              <StatCard label=\"Sold (30d)\" value={String(stats?.listingSold ?? listings.filter(l => l.status === 'sold').length)} sub=\"Sold\" trend=\"neutral\" icon={DollarSign} accent=\"bg-chart-2/10 text-chart-2\" />\n            </div>\n\n            <Card>\n              <CardContent className=\"p-0\">\n                <table className=\"w-full text-xs\">\n                  <thead>\n                    <tr className=\"border-b border-border bg-muted/40\">\n                      <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">Listing</th>\n                      <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">Seller</th>\n                      <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">Price</th>\n                      <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">Status</th>\n                      <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">Views</th>\n                      <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">Listed</th>\n                      <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">Actions</th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"divide-y divide-border\">\n                    {listings.map((l) => (\n                      <tr key={l.id} className={`hover:bg-muted/30 transition-colors ${l.flagged ? \"bg-destructive/5\" : \"\"}`}>\n                        <td className=\"px-4 py-3\">\n                          <div className=\"flex items-center gap-2\">\n                            {l.flagged && <AlertTriangle className=\"h-3 w-3 text-destructive shrink-0\" />}\n                            <span className=\"font-medium text-foreground\">{l.title}</span>\n                          </div>\n                        </td>\n                        <td className=\"px-4 py-3 text-muted-foreground\">{l.seller}</td>\n                        <td className=\"px-4 py-3 font-medium text-foreground\">${Number(l.price || 0).toLocaleString()}</td>\n                        <td className=\"px-4 py-3\">\n                          <UserStatusBadge status={l.status === \"active\" ? \"active\" : l.status === \"flagged\" ? \"suspended\" : l.status === \"sold\" ? \"active\" : \"pending\"} />\n                        </td>\n                        <td className=\"px-4 py-3 text-muted-foreground\">{l.views ?? 0}</td>\n                        <td className=\"px-4 py-3 text-muted-foreground\">{l.listed ? new Date(l.listed).toLocaleDateString() : 'â€”'}</td>\n                        <td className=\"px-4 py-3\">\n                          <div className=\"flex items-center gap-1\">\n                            <Button size=\"sm\" variant=\"ghost\" className=\"h-6 w-6 p-0\" onClick={() => handleViewListing(l)}><Eye className=\"h-3 w-3\" /></Button>\n                            <Button size=\"sm\" variant=\"ghost\" className=\"h-6 w-6 p-0 text-chart-2 hover:text-chart-2\" onClick={() => handleApproveListing(l.id)}><CheckCircle2 className=\"h-3 w-3\" /></Button>\n                            <Button size=\"sm\" variant=\"ghost\" className=\"h-6 w-6 p-0 text-destructive hover:text-destructive\" onClick={() => handleDeleteListing(l.id)}><Trash2 className=\"h-3 w-3\" /></Button>\n                          </div>\n                        </td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </CardContent>\n            </Card>\n          </>\n        )}\n\n        {/* â”€â”€ BILLING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}\n        {activeTab === \"billing\" && (\n          <>\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <h2 className=\"text-lg font-semibold\">Billing & Revenue</h2>\n                <p className=\"text-xs text-muted-foreground\">Transaction history, subscriptions, and revenue tracking</p>\n              </div>\n              <Button size=\"sm\" variant=\"outline\" className=\"h-8 gap-1.5 text-xs\" onClick={handleExport}>\n                <Download className=\"h-3 w-3\" /> Export CSV\n              </Button>\n            </div>\n            {billingError && <div className=\"text-xs text-destructive\">{billingError}</div>}\n            {isBillingLoading && !billingError && <div className=\"text-xs text-muted-foreground\">Loadingâ€¦</div>}\n\n            <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-4\">\n              <StatCard label=\"MRR\" value={`$${Number(stats?.estimatedMRR ?? 0).toFixed(2)}`} sub=\"Estimated\" trend=\"neutral\" icon={TrendingUp} accent=\"bg-chart-2/10 text-chart-2\" />\n              <StatCard label=\"ARR\" value={`$${Number(stats?.estimatedAnnualRevenue ?? 0).toFixed(2)}`} sub=\"Estimated\" trend=\"neutral\" icon={DollarSign} accent=\"bg-primary/10 text-primary\" />\n              <StatCard label=\"Failed Payments\" value={String(billingTransactions.filter((t) => t.status === 'failed').length)} sub=\"Failed\" trend=\"neutral\" icon={AlertTriangle} accent=\"bg-destructive/10 text-destructive\" />\n              <StatCard label=\"Refunds (30d)\" value={String(billingTransactions.filter((t) => t.status === 'refunded').length)} sub=\"Refunded\" trend=\"neutral\" icon={TrendingDown} accent=\"bg-muted text-muted-foreground\" />\n            </div>\n\n            <Card>\n              <CardHeader className=\"pb-3\">\n                <CardTitle className=\"text-sm\">Recent Transactions</CardTitle>\n              </CardHeader>\n              <CardContent className=\"p-0\">\n                <table className=\"w-full text-xs\">\n                  <thead>\n                    <tr className=\"border-b border-border bg-muted/40\">\n                      <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">Transaction ID</th>\n                      <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">User / Club</th>\n                      <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">Plan</th>\n                      <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">Amount</th>\n                      <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">Date</th>\n                      <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">Status</th>\n                      <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">Actions</th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"divide-y divide-border\">\n                    {billingTransactions.map((txn) => (\n                      <tr key={txn.id} className=\"hover:bg-muted/30 transition-colors\">\n                        <td className=\"px-4 py-3 font-mono text-muted-foreground\">{txn.id}</td>\n                        <td className=\"px-4 py-3 font-medium text-foreground\">{txn.user}</td>\n                        <td className=\"px-4 py-3\"><Badge variant=\"outline\" className=\"text-[10px]\">{txn.plan}</Badge></td>\n                        <td className=\"px-4 py-3 font-semibold\">${Number(txn.amount || 0).toFixed(2)}</td>\n                        <td className=\"px-4 py-3 text-muted-foreground\">{txn.date || 'â€”'}</td>\n                        <td className=\"px-4 py-3\"><TxnStatusBadge status={txn.status} /></td>\n                        <td className=\"px-4 py-3\">\n                          <div className=\"flex items-center gap-1\">\n                            <Button size=\"sm\" variant=\"ghost\" className=\"h-6 w-6 p-0\" onClick={() => handleViewTransaction(txn)}><Eye className=\"h-3 w-3\" /></Button>\n                            <Button size=\"sm\" variant=\"ghost\" className=\"h-6 w-6 p-0\" onClick={() => handleDownloadInvoice(txn.id)}><FileText className=\"h-3 w-3\" /></Button>\n                          </div>\n                        </td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </CardContent>\n            </Card>\n          </>\n        )}\n\n        {/* â”€â”€ SYSTEM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}\n        {activeTab === \"system\" && (\n          <>\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <h2 className=\"text-lg font-semibold\">System Status</h2>\n                <p className=\"text-xs text-muted-foreground\">Monitor all platform services and infrastructure</p>\n              </div>\n              <Button size=\"sm\" variant=\"outline\" className=\"h-8 gap-1.5 text-xs\" onClick={handleRefresh}>\n                <RefreshCw className=\"h-3 w-3\" /> Refresh\n              </Button>\n            </div>\n            {systemError && <div className=\"text-xs text-destructive\">{systemError}</div>}\n            {isSystemLoading && !systemError && <div className=\"text-xs text-muted-foreground\">Loadingâ€¦</div>}\n\n            <div className=\"grid gap-4 sm:grid-cols-4\">\n              <StatCard label=\"Services Online\" value=\"6/7\" sub=\"1 degraded\" trend=\"neutral\" icon={Server} accent=\"bg-chart-3/10 text-chart-3\" />\n              <StatCard label=\"Avg Response\" value=\"94ms\" sub=\"-12ms vs yesterday\" trend=\"up\" icon={Activity} accent=\"bg-chart-2/10 text-chart-2\" />\n              <StatCard label=\"DB Storage\" value=\"68%\" sub=\"34.2 GB used\" trend=\"neutral\" icon={Database} accent=\"bg-primary/10 text-primary\" />\n              <StatCard label=\"Error Rate\" value=\"0.04%\" sub=\"Last 24 hours\" trend=\"up\" icon={AlertTriangle} accent=\"bg-muted text-muted-foreground\" />\n            </div>\n\n            <div className=\"grid gap-4 lg:grid-cols-2\">\n              <Card>\n                <CardHeader className=\"pb-3\">\n                  <CardTitle className=\"text-sm\">Services</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-3\">\n                  {systemServices.map((svc) => (\n                    <div key={svc.name} className=\"flex items-center justify-between rounded-lg border border-border p-3\">\n                      <div className=\"flex items-center gap-3\">\n                        <StatusDot status={svc.status} />\n                        <div>\n                          <p className=\"text-xs font-medium\">{svc.name}</p>\n                          <p className=\"text-[11px] text-muted-foreground\">{svc.latency} avg</p>\n                        </div>\n                      </div>\n                      <div className=\"flex items-center gap-3\">\n                        <span className={`text-xs font-medium ${svc.status === \"operational\" ? \"text-chart-2\" : \"text-chart-3\"}`}>\n                          {svc.uptime}\n                        </span>\n                        <span className={`text-[11px] px-2 py-0.5 rounded-full capitalize ${\n                          svc.status === \"operational\"\n                            ? \"bg-chart-2/10 text-chart-2\"\n                            : \"bg-chart-3/10 text-chart-3\"\n                        }`}>\n                          {svc.status}\n                        </span>\n                      </div>\n                    </div>\n                  ))}\n                </CardContent>\n              </Card>\n\n              <div className=\"space-y-4\">\n                <Card>\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-sm\">Resource Usage</CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-4\">\n                    {[\n                      { label: \"CPU\", value: 34 },\n                      { label: \"Memory\", value: 58 },\n                      { label: \"Storage\", value: 68 },\n                      { label: \"Bandwidth\", value: 22 },\n                    ].map((r) => (\n                      <div key={r.label} className=\"space-y-1.5\">\n                        <div className=\"flex justify-between text-xs\">\n                          <span className=\"font-medium\">{r.label}</span>\n                          <span className=\"text-muted-foreground\">{r.value}%</span>\n                        </div>\n                        <Progress value={r.value} className=\"h-1.5\" />\n                      </div>\n                    ))}\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-sm\">Recent Errors</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"space-y-2\">\n                      {[\n                        { code: \"503\", msg: \"File Storage timeout\", time: \"12 min ago\" },\n                        { code: \"429\", msg: \"Weather API rate limit\", time: \"2h ago\" },\n                        { code: \"500\", msg: \"PDF export failure (1 user)\", time: \"5h ago\" },\n                      ].map((err, i) => (\n                        <div key={i} className=\"flex items-center gap-3 rounded border border-destructive/20 bg-destructive/5 p-2.5\">\n                          <Badge variant=\"destructive\" className=\"text-[10px] shrink-0\">{err.code}</Badge>\n                          <p className=\"flex-1 text-xs\">{err.msg}</p>\n                          <span className=\"text-[11px] text-muted-foreground shrink-0\">{err.time}</span>\n                        </div>\n                      ))}\n                    </div>\n                  </CardContent>\n                </Card>\n              </div>\n            </div>\n          </>\n        )}\n\n        {/* â”€â”€ SETTINGS (platform config) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}\n        {activeTab === \"general-settings2\" && (\n          <>\n            <div>\n              <h2 className=\"text-lg font-semibold\">Platform Settings</h2>\n              <p className=\"text-xs text-muted-foreground\">Global configuration for the AviationHub platform</p>\n            </div>\n\n            <div className=\"grid gap-4 lg:grid-cols-2\">\n              <Card>\n                <CardHeader className=\"pb-3\">\n                  <CardTitle className=\"text-sm flex items-center gap-2\"><Globe className=\"h-4 w-4 text-primary\" /> General</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  {[\n                    { label: \"Platform Name\", value: \"AviationHub\" },\n                    { label: \"Support Email\", value: \"support@aviationhub.com\" },\n                    { label: \"Max Aircraft per Club (Free)\", value: \"2\" },\n                    { label: \"Max Members per Club (Free)\", value: \"10\" },\n                  ].map((f) => (\n                    <div key={f.label} className=\"space-y-1.5\">\n                      <label className=\"text-xs font-medium text-muted-foreground\">{f.label}</label>\n                      <Input defaultValue={f.value} className=\"h-8 text-xs\" />\n                    </div>\n                  ))}\n                  <Button size=\"sm\" className=\"h-8 text-xs gap-1.5 w-full\" onClick={handleSaveGeneralSettings}>Save Changes</Button>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader className=\"pb-3\">\n                  <CardTitle className=\"text-sm flex items-center gap-2\"><Bell className=\"h-4 w-4 text-primary\" /> Notifications & Alerts</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  {[\n                    { label: \"Email new user signups to admin\", enabled: true },\n                    { label: \"Alert on flagged marketplace listing\", enabled: true },\n                    { label: \"Daily revenue digest email\", enabled: true },\n                    { label: \"System health alerts (Slack)\", enabled: false },\n                    { label: \"Failed payment alerts\", enabled: true },\n                    { label: \"Weekly analytics report\", enabled: false },\n                  ].map((s) => (\n                    <div key={s.label} className=\"flex items-center justify-between\">\n                      <label className=\"text-xs text-foreground\">{s.label}</label>\n                      <Switch defaultChecked={s.enabled} />\n                    </div>\n                  ))}\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader className=\"pb-3\">\n                  <CardTitle className=\"text-sm flex items-center gap-2\"><ShieldCheck className=\"h-4 w-4 text-primary\" /> Security & Access</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  {[\n                    { label: \"Require 2FA for admin accounts\", enabled: true },\n                    { label: \"Auto-suspend users after 5 failed logins\", enabled: true },\n                    { label: \"Allow self-registration\", enabled: true },\n                    { label: \"Require email verification\", enabled: true },\n                  ].map((s) => (\n                    <div key={s.label} className=\"flex items-center justify-between\">\n                      <label className=\"text-xs text-foreground\">{s.label}</label>\n                      <Switch defaultChecked={s.enabled} />\n                    </div>\n                  ))}\n                  <Separator />\n                  <div className=\"space-y-1.5\">\n                    <label className=\"text-xs font-medium text-muted-foreground\">Session Timeout (minutes)</label>\n                    <Input defaultValue=\"60\" className=\"h-8 text-xs\" />\n                  </div>\n                  <Button size=\"sm\" className=\"h-8 text-xs gap-1.5 w-full\" onClick={handleSaveUserSettings}>Save Changes</Button>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader className=\"pb-3\">\n                  <CardTitle className=\"text-sm flex items-center gap-2\"><Mail className=\"h-4 w-4 text-primary\" /> Email & Integrations</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  {[\n                    { label: \"SMTP Host\", value: \"smtp.sendgrid.net\" },\n                    { label: \"SMTP Port\", value: \"587\" },\n                    { label: \"Stripe Publishable Key\", value: \"pk_live_â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢\" },\n                    { label: \"Google Maps API Key\", value: \"AIzaâ€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢\" },\n                    { label: \"Slack Webhook URL\", value: \"https://hooks.slack.com/â€¢â€¢â€¢â€¢\" },\n                  ].map((f) => (\n                    <div key={f.label} className=\"space-y-1.5\">\n                      <label className=\"text-xs font-medium text-muted-foreground\">{f.label}</label>\n                      <Input defaultValue={f.value} className=\"h-8 text-xs\" />\n                    </div>\n                  ))}\n                  <Button size=\"sm\" className=\"h-8 text-xs gap-1.5 w-full\" onClick={handleSaveScheduleSettings}>Save Changes</Button>\n                </CardContent>\n              </Card>\n            </div>\n          </>\n        )}\n      </div>\n\n      {/* â”€â”€ MODALS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}\n      \n      {/* View User Modal */}\n      <Dialog open={!!viewUserModal} onOpenChange={() => setViewUserModal(null)}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>User Details</DialogTitle>\n            <DialogDescription>View complete user information</DialogDescription>\n          </DialogHeader>\n          {viewUserModal && (\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-3 text-sm\">\n                <div><span className=\"text-muted-foreground\">Name:</span> <span className=\"font-medium\">{viewUserModal.name}</span></div>\n                <div><span className=\"text-muted-foreground\">Email:</span> <span className=\"font-medium\">{viewUserModal.email}</span></div>\n                <div><span className=\"text-muted-foreground\">Role:</span> <span className=\"font-medium capitalize\">{viewUserModal.role}</span></div>\n                <div><span className=\"text-muted-foreground\">Plan:</span> <Badge variant=\"outline\">{viewUserModal.plan}</Badge></div>\n                <div><span className=\"text-muted-foreground\">Status:</span> <UserStatusBadge status={viewUserModal.status} /></div>\n                <div><span className=\"text-muted-foreground\">Hours:</span> <span className=\"font-medium\">{viewUserModal.hours.toFixed(1)}</span></div>\n                <div><span className=\"text-muted-foreground\">Club:</span> <span className=\"font-medium\">{viewUserModal.club || \"â€”\"}</span></div>\n                <div><span className=\"text-muted-foreground\">Joined:</span> <span className=\"font-medium\">{viewUserModal.joined}</span></div>\n              </div>\n            </div>\n          )}\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setViewUserModal(null)}>Close</Button>\n            <Button onClick={() => { setEditUserModal(viewUserModal); setViewUserModal(null); }}>Edit User</Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Edit User Modal */}\n      <Dialog open={!!editUserModal} onOpenChange={() => setEditUserModal(null)}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>Edit User</DialogTitle>\n            <DialogDescription>Update user information and settings</DialogDescription>\n          </DialogHeader>\n          {editUserModal && (\n            <div className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label>Name</Label>\n                <Input defaultValue={editUserModal.name} />\n              </div>\n              <div className=\"space-y-2\">\n                <Label>Email</Label>\n                <Input type=\"email\" defaultValue={editUserModal.email} />\n              </div>\n              <div className=\"space-y-2\">\n                <Label>Plan</Label>\n                <select className=\"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm\" defaultValue={editUserModal.plan}>\n                  <option value=\"Free\">Free</option>\n                  <option value=\"Pro\">Pro</option>\n                  <option value=\"Enterprise\">Enterprise</option>\n                </select>\n              </div>\n              <div className=\"space-y-2\">\n                <Label>Status</Label>\n                <select className=\"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm\" defaultValue={editUserModal.status}>\n                  <option value=\"active\">Active</option>\n                  <option value=\"suspended\">Suspended</option>\n                  <option value=\"pending\">Pending</option>\n                </select>\n              </div>\n            </div>\n          )}\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setEditUserModal(null)}>Cancel</Button>\n            <Button onClick={() => { alert('User updated!'); setEditUserModal(null); }}>Save Changes</Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* View Aircraft Modal */}\n      <Dialog open={!!viewAircraftModal} onOpenChange={() => setViewAircraftModal(null)}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>Aircraft Details</DialogTitle>\n          </DialogHeader>\n          {viewAircraftModal && (\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-3 text-sm\">\n                <div><span className=\"text-muted-foreground\">Registration:</span> <span className=\"font-mono font-bold\">{viewAircraftModal.reg}</span></div>\n                <div><span className=\"text-muted-foreground\">Type:</span> <span className=\"font-medium\">{viewAircraftModal.type}</span></div>\n                <div><span className=\"text-muted-foreground\">Owner:</span> <span className=\"font-medium\">{viewAircraftModal.owner}</span></div>\n                <div><span className=\"text-muted-foreground\">Status:</span> <UserStatusBadge status={viewAircraftModal.status === \"active\" ? \"active\" : \"suspended\"} /></div>\n                <div><span className=\"text-muted-foreground\">Hobbs:</span> <span className=\"font-medium\">{viewAircraftModal.hobbs.toFixed(1)} hrs</span></div>\n                <div><span className=\"text-muted-foreground\">Next MX:</span> <span className={viewAircraftModal.nextMx === \"Overdue\" ? \"text-destructive font-medium\" : \"font-medium\"}>{viewAircraftModal.nextMx}</span></div>\n              </div>\n            </div>\n          )}\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setViewAircraftModal(null)}>Close</Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Edit Aircraft Modal */}\n      <Dialog open={!!editAircraftModal} onOpenChange={() => setEditAircraftModal(null)}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>Edit Aircraft</DialogTitle>\n          </DialogHeader>\n          {editAircraftModal && (\n            <div className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label>Registration</Label>\n                <Input defaultValue={editAircraftModal.reg} />\n              </div>\n              <div className=\"space-y-2\">\n                <Label>Type</Label>\n                <Input defaultValue={editAircraftModal.type} />\n              </div>\n              <div className=\"space-y-2\">\n                <Label>Owner</Label>\n                <Input defaultValue={editAircraftModal.owner} />\n              </div>\n              <div className=\"space-y-2\">\n                <Label>Status</Label>\n                <select className=\"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm\" defaultValue={editAircraftModal.status}>\n                  <option value=\"active\">Active</option>\n                  <option value=\"maintenance\">Maintenance</option>\n                  <option value=\"grounded\">Grounded</option>\n                </select>\n              </div>\n            </div>\n          )}\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setEditAircraftModal(null)}>Cancel</Button>\n            <Button onClick={() => { alert('Aircraft updated!'); setEditAircraftModal(null); }}>Save Changes</Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* View Club Modal */}\n      <Dialog open={!!viewClubModal} onOpenChange={() => setViewClubModal(null)}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>Club Details</DialogTitle>\n          </DialogHeader>\n          {viewClubModal && (\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-3 text-sm\">\n                <div><span className=\"text-muted-foreground\">Name:</span> <span className=\"font-medium\">{viewClubModal.name}</span></div>\n                <div><span className=\"text-muted-foreground\">Plan:</span> <Badge variant=\"outline\">{viewClubModal.plan}</Badge></div>\n                <div><span className=\"text-muted-foreground\">Members:</span> <span className=\"font-medium\">{viewClubModal.members}</span></div>\n                <div><span className=\"text-muted-foreground\">Aircraft:</span> <span className=\"font-medium\">{viewClubModal.aircraft}</span></div>\n                <div><span className=\"text-muted-foreground\">Revenue:</span> <span className=\"font-medium\">${viewClubModal.revenue}/mo</span></div>\n                <div><span className=\"text-muted-foreground\">Joined:</span> <span className=\"font-medium\">{viewClubModal.joined}</span></div>\n              </div>\n            </div>\n          )}\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setViewClubModal(null)}>Close</Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Edit Club Modal */}\n      <Dialog open={!!editClubModal} onOpenChange={() => setEditClubModal(null)}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>Edit Club</DialogTitle>\n          </DialogHeader>\n          {editClubModal && (\n            <div className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label>Club Name</Label>\n                <Input defaultValue={editClubModal.name} />\n              </div>\n              <div className=\"space-y-2\">\n                <Label>Plan</Label>\n                <select className=\"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm\" defaultValue={editClubModal.plan}>\n                  <option value=\"Free\">Free</option>\n                  <option value=\"Pro\">Pro</option>\n                  <option value=\"Enterprise\">Enterprise</option>\n                </select>\n              </div>\n            </div>\n          )}\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setEditClubModal(null)}>Cancel</Button>\n            <Button onClick={() => { alert('Club updated!'); setEditClubModal(null); }}>Save Changes</Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* View Listing Modal */}\n      <Dialog open={!!viewListingModal} onOpenChange={() => setViewListingModal(null)}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>Listing Details</DialogTitle>\n          </DialogHeader>\n          {viewListingModal && (\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-3 text-sm\">\n                <div className=\"col-span-2\"><span className=\"text-muted-foreground\">Title:</span> <span className=\"font-medium\">{viewListingModal.title}</span></div>\n                <div><span className=\"text-muted-foreground\">Price:</span> <span className=\"font-bold\">${viewListingModal.price.toLocaleString()}</span></div>\n                <div><span className=\"text-muted-foreground\">Seller:</span> <span className=\"font-medium\">{viewListingModal.seller}</span></div>\n                <div><span className=\"text-muted-foreground\">Status:</span> <UserStatusBadge status={viewListingModal.status === \"active\" ? \"active\" : \"pending\"} /></div>\n                <div><span className=\"text-muted-foreground\">Views:</span> <span className=\"font-medium\">{viewListingModal.views}</span></div>\n                <div className=\"col-span-2\"><span className=\"text-muted-foreground\">Listed:</span> <span className=\"font-medium\">{viewListingModal.listed}</span></div>\n              </div>\n              {viewListingModal.flagged && (\n                <div className=\"rounded-lg bg-destructive/10 border border-destructive/20 p-3 text-sm text-destructive\">\n                  âš ï¸ This listing has been flagged and requires review.\n                </div>\n              )}\n            </div>\n          )}\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setViewListingModal(null)}>Close</Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* View Transaction Modal */}\n      <Dialog open={!!viewTransactionModal} onOpenChange={() => setViewTransactionModal(null)}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>Transaction Details</DialogTitle>\n          </DialogHeader>\n          {viewTransactionModal && (\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-3 text-sm\">\n                <div className=\"col-span-2\"><span className=\"text-muted-foreground\">ID:</span> <span className=\"font-mono\">{viewTransactionModal.id}</span></div>\n                <div><span className=\"text-muted-foreground\">User:</span> <span className=\"font-medium\">{viewTransactionModal.user}</span></div>\n                <div><span className=\"text-muted-foreground\">Plan:</span> <Badge variant=\"outline\">{viewTransactionModal.plan}</Badge></div>\n                <div><span className=\"text-muted-foreground\">Amount:</span> <span className=\"font-bold\">${viewTransactionModal.amount}</span></div>\n                <div><span className=\"text-muted-foreground\">Status:</span> <TxnStatusBadge status={viewTransactionModal.status} /></div>\n                <div className=\"col-span-2\"><span className=\"text-muted-foreground\">Date:</span> <span className=\"font-medium\">{viewTransactionModal.date}</span></div>\n              </div>\n            </div>\n          )}\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setViewTransactionModal(null)}>Close</Button>\n            <Button onClick={() => { handleDownloadInvoice(viewTransactionModal!.id); setViewTransactionModal(null); }}>\n              <Download className=\"h-3 w-3 mr-2\" /> Download Invoice\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Invite User Modal */}\n      <Dialog open={inviteUserModal} onOpenChange={setInviteUserModal}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>Invite New User</DialogTitle>\n            <DialogDescription>Send an invitation to join the platform</DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label>Email Address</Label>\n              <Input type=\"email\" placeholder=\"pilot@example.com\" />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Name (optional)</Label>\n              <Input placeholder=\"John Doe\" />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Default Plan</Label>\n              <select className=\"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm\">\n                <option value=\"Free\">Free</option>\n                <option value=\"Pro\">Pro</option>\n                <option value=\"Enterprise\">Enterprise</option>\n              </select>\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Personal Message (optional)</Label>\n              <Textarea placeholder=\"Welcome to AviationHub...\" rows={3} />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setInviteUserModal(false)}>Cancel</Button>\n            <Button onClick={() => { alert('Invitation sent!'); setInviteUserModal(false); }}>\n              <Mail className=\"h-3 w-3 mr-2\" /> Send Invitation\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Add Club Modal */}\n      <Dialog open={addClubModal} onOpenChange={setAddClubModal}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>Add New Club</DialogTitle>\n            <DialogDescription>Register a new flying club or organization</DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label>Club Name</Label>\n              <Input placeholder=\"Boston Flying Club\" />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Admin Email</Label>\n              <Input type=\"email\" placeholder=\"admin@flyingclub.com\" />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Initial Plan</Label>\n              <select className=\"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm\">\n                <option value=\"Free\">Free (Trial)</option>\n                <option value=\"Pro\">Pro</option>\n                <option value=\"Enterprise\">Enterprise</option>\n              </select>\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Notes (optional)</Label>\n              <Textarea placeholder=\"Any special requirements...\" rows={2} />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setAddClubModal(false)}>Cancel</Button>\n            <Button onClick={() => { alert('Club created!'); setAddClubModal(false); }}>\n              <Building2 className=\"h-3 w-3 mr-2\" /> Create Club\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\admin\\users\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'router' is assigned a value but never used.","line":19,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":47,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1508,1511],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1508,1511],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchUsers'. Either include it or remove the dependency array.","line":56,"column":6,"nodeType":"ArrayExpression","endLine":56,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [fetchUsers, page]","fix":{"range":[1640,1646],"text":"[fetchUsers, page]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":92,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":92,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":110,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":110,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":130,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":130,"endColumn":17}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useEffect, useState } from 'react';\nimport { useRouter, useSearchParams } from 'next/navigation';\n\ninterface User {\n  id: string;\n  email: string;\n  name: string | null;\n  tier: string;\n  role: string;\n  createdAt: string;\n  flightPlanCount: number;\n  clubCount: number;\n  homeState?: string | null;\n}\n\nexport default function AdminUsersPage() {\n  const router = useRouter();\n  const searchParams = useSearchParams();\n  const [users, setUsers] = useState<User[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [search, setSearch] = useState(searchParams.get('search') || '');\n  const [page, setPage] = useState(parseInt(searchParams.get('page') || '1'));\n  const [totalPages, setTotalPages] = useState(1);\n  const [selectedUser, setSelectedUser] = useState<User | null>(null);\n  const [detailLoading, setDetailLoading] = useState(false);\n\n  // Fetch users\n  const fetchUsers = async () => {\n    setLoading(true);\n    try {\n      const params = new URLSearchParams();\n      params.set('page', page.toString());\n      params.set('limit', '20');\n      if (search) params.set('search', search);\n\n      const res = await fetch(`/api/admin/users?${params}`);\n      if (!res.ok) {\n        const data = await res.json();\n        throw new Error(data.error || 'Failed to fetch');\n      }\n      const data = await res.json();\n      setUsers(data.users);\n      setTotalPages(data.pagination.totalPages);\n    } catch (err: any) {\n      setError(err.message);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    fetchUsers();\n  }, [page]);\n\n  const handleSearch = (e: React.FormEvent) => {\n    e.preventDefault();\n    setPage(1);\n    fetchUsers();\n  };\n\n  // Fetch user details\n  const fetchUserDetails = async (userId: string) => {\n    setDetailLoading(true);\n    try {\n      const res = await fetch(`/api/admin/users/${userId}`);\n      if (!res.ok) throw new Error('Failed to fetch user');\n      const data = await res.json();\n      setSelectedUser(data.user);\n    } catch (err) {\n      console.error(err);\n    } finally {\n      setDetailLoading(false);\n    }\n  };\n\n  // Update user tier\n  const updateUserTier = async (userId: string, tier: string) => {\n    try {\n      const res = await fetch(`/api/admin/users/${userId}`, {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ tier }),\n      });\n      if (!res.ok) throw new Error('Failed to update');\n      fetchUsers();\n      if (selectedUser?.id === userId) {\n        fetchUserDetails(userId);\n      }\n    } catch (err) {\n      alert('Failed to update user');\n    }\n  };\n\n  // Update user role\n  const updateUserRole = async (userId: string, role: string) => {\n    try {\n      const res = await fetch(`/api/admin/users/${userId}`, {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ role }),\n      });\n      if (!res.ok) throw new Error('Failed to update');\n      fetchUsers();\n      if (selectedUser?.id === userId) {\n        fetchUserDetails(userId);\n      }\n    } catch (err) {\n      alert('Failed to update user');\n    }\n  };\n\n  // Reset password\n  const resetPassword = async (userId: string) => {\n    const newPassword = prompt('Enter new password (min 6 characters):');\n    if (!newPassword || newPassword.length < 6) {\n      alert('Password must be at least 6 characters');\n      return;\n    }\n    try {\n      const res = await fetch(`/api/admin/users/${userId}`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ newPassword }),\n      });\n      if (!res.ok) throw new Error('Failed to reset password');\n      alert('Password reset successfully');\n    } catch (err) {\n      alert('Failed to reset password');\n    }\n  };\n\n  if (error) {\n    return (\n      <div className=\"bg-red-500/10 border border-red-500/30 rounded-lg p-6\">\n        <h2 className=\"text-red-400 font-semibold mb-2\">Access Denied</h2>\n        <p className=\"text-slate-400\">{error}</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen pt-[44px] p-6 space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <h1 className=\"text-2xl font-bold text-white\">User Management</h1>\n      </div>\n\n      {/* Search */}\n      <form onSubmit={handleSearch} className=\"flex gap-3\">\n        <input\n          type=\"text\"\n          value={search}\n          onChange={(e) => setSearch(e.target.value)}\n          placeholder=\"Search by email or name...\"\n          className=\"flex-1 bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 text-white\"\n        />\n        <button\n          type=\"submit\"\n          className=\"bg-sky-600 hover:bg-sky-500 text-white px-4 py-2 rounded-lg font-medium\"\n        >\n          Search\n        </button>\n      </form>\n\n      {/* Users Table */}\n      <div className=\"bg-slate-900 rounded-xl border border-slate-800 overflow-hidden\">\n        <table className=\"w-full\">\n          <thead className=\"bg-slate-800/50\">\n            <tr>\n              <th className=\"text-left px-4 py-3 text-slate-400 text-sm font-medium\">User</th>\n              <th className=\"text-left px-4 py-3 text-slate-400 text-sm font-medium\">Tier</th>\n              <th className=\"text-left px-4 py-3 text-slate-400 text-sm font-medium\">Role</th>\n              <th className=\"text-left px-4 py-3 text-slate-400 text-sm font-medium\">Plans</th>\n              <th className=\"text-left px-4 py-3 text-slate-400 text-sm font-medium\">Clubs</th>\n              <th className=\"text-left px-4 py-3 text-slate-400 text-sm font-medium\">Joined</th>\n              <th className=\"text-left px-4 py-3 text-slate-400 text-sm font-medium\">Actions</th>\n            </tr>\n          </thead>\n          <tbody>\n            {loading ? (\n              <tr>\n                <td colSpan={7} className=\"px-4 py-8 text-center text-slate-400\">\n                  Loading...\n                </td>\n              </tr>\n            ) : users.length === 0 ? (\n              <tr>\n                <td colSpan={7} className=\"px-4 py-8 text-center text-slate-400\">\n                  No users found\n                </td>\n              </tr>\n            ) : (\n              users.map((user) => (\n                <tr key={user.id} className=\"border-t border-slate-800 hover:bg-slate-800/30\">\n                  <td className=\"px-4 py-3\">\n                    <div className=\"text-white font-medium\">{user.name || 'No name'}</div>\n                    <div className=\"text-sm text-slate-400\">{user.email}</div>\n                  </td>\n                  <td className=\"px-4 py-3\">\n                    <span className={`px-2 py-1 rounded text-xs font-medium ${\n                      user.tier === 'pro' \n                        ? 'bg-emerald-500/20 text-emerald-400' \n                        : 'bg-slate-700 text-slate-400'\n                    }`}>\n                      {user.tier.toUpperCase()}\n                    </span>\n                  </td>\n                  <td className=\"px-4 py-3\">\n                    <span className={`px-2 py-1 rounded text-xs font-medium ${\n                      user.role === 'owner' \n                        ? 'bg-amber-500/20 text-amber-400' \n                        : user.role === 'admin'\n                        ? 'bg-purple-500/20 text-purple-400'\n                        : 'bg-slate-700 text-slate-400'\n                    }`}>\n                      {user.role.toUpperCase()}\n                    </span>\n                  </td>\n                  <td className=\"px-4 py-3 text-white\">{user.flightPlanCount}</td>\n                  <td className=\"px-4 py-3 text-white\">{user.clubCount}</td>\n                  <td className=\"px-4 py-3 text-slate-400 text-sm\">\n                    {new Date(user.createdAt).toLocaleDateString()}\n                  </td>\n                  <td className=\"px-4 py-3\">\n                    <button\n                      onClick={() => fetchUserDetails(user.id)}\n                      className=\"text-sky-400 hover:text-sky-300 text-sm mr-2\"\n                    >\n                      View\n                    </button>\n                    <button\n                      onClick={() => resetPassword(user.id)}\n                      className=\"text-red-400 hover:text-red-300 text-sm\"\n                    >\n                      Reset PW\n                    </button>\n                  </td>\n                </tr>\n              ))\n            )}\n          </tbody>\n        </table>\n\n        {/* Pagination */}\n        {totalPages > 1 && (\n          <div className=\"flex justify-center gap-2 py-4 border-t border-slate-800\">\n            <button\n              onClick={() => setPage(p => Math.max(1, p - 1))}\n              disabled={page === 1}\n              className=\"px-3 py-1 rounded bg-slate-800 text-white disabled:opacity-50\"\n            >\n              Prev\n            </button>\n            <span className=\"px-4 py-1 text-slate-400\">\n              Page {page} of {totalPages}\n            </span>\n            <button\n              onClick={() => setPage(p => Math.min(totalPages, p + 1))}\n              disabled={page === totalPages}\n              className=\"px-3 py-1 rounded bg-slate-800 text-white disabled:opacity-50\"\n            >\n              Next\n            </button>\n          </div>\n        )}\n      </div>\n\n      {/* User Detail Modal */}\n      {selectedUser && (\n        <div className=\"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-slate-900 rounded-xl border border-slate-700 max-w-lg w-full max-h-[80vh] overflow-y-auto\">\n            <div className=\"p-6\">\n              <div className=\"flex justify-between items-start mb-6\">\n                <h2 className=\"text-xl font-bold text-white\">User Details</h2>\n                <button\n                  onClick={() => setSelectedUser(null)}\n                  className=\"text-slate-400 hover:text-white\"\n                >\n                  âœ•\n                </button>\n              </div>\n\n              {detailLoading ? (\n                <div className=\"text-center py-8 text-slate-400\">Loading...</div>\n              ) : (\n                <>\n                  <div className=\"space-y-4\">\n                    <div>\n                      <label className=\"text-sm text-slate-400\">Email</label>\n                      <div className=\"text-white\">{selectedUser.email}</div>\n                    </div>\n                    <div>\n                      <label className=\"text-sm text-slate-400\">Name</label>\n                      <div className=\"text-white\">{selectedUser.name || 'Not set'}</div>\n                    </div>\n                    <div>\n                      <label className=\"text-sm text-slate-400\">Tier</label>\n                      <div className=\"flex gap-2 mt-1\">\n                        <button\n                          onClick={() => updateUserTier(selectedUser.id, 'free')}\n                          className={`px-3 py-1 rounded text-sm ${\n                            selectedUser.tier === 'free'\n                              ? 'bg-emerald-500 text-white'\n                              : 'bg-slate-700 text-slate-400 hover:bg-slate-600'\n                          }`}\n                        >\n                          Free\n                        </button>\n                        <button\n                          onClick={() => updateUserTier(selectedUser.id, 'pro')}\n                          className={`px-3 py-1 rounded text-sm ${\n                            selectedUser.tier === 'pro'\n                              ? 'bg-emerald-500 text-white'\n                              : 'bg-slate-700 text-slate-400 hover:bg-slate-600'\n                          }`}\n                        >\n                          Pro\n                        </button>\n                        <button\n                          onClick={() => updateUserTier(selectedUser.id, 'proplus')}\n                          className={`px-3 py-1 rounded text-sm ${\n                            selectedUser.tier === 'proplus'\n                              ? 'bg-emerald-500 text-white'\n                              : 'bg-slate-700 text-slate-400 hover:bg-slate-600'\n                          }`}\n                        >\n                          Pro+\n                        </button>\n                      </div>\n                    </div>\n                    <div>\n                      <label className=\"text-sm text-slate-400\">Role</label>\n                      <div className=\"flex gap-2 mt-1\">\n                        <button\n                          onClick={() => updateUserRole(selectedUser.id, 'user')}\n                          className={`px-3 py-1 rounded text-sm ${\n                            selectedUser.role === 'user'\n                              ? 'bg-purple-500 text-white'\n                              : 'bg-slate-700 text-slate-400 hover:bg-slate-600'\n                          }`}\n                        >\n                          User\n                        </button>\n                        <button\n                          onClick={() => updateUserRole(selectedUser.id, 'admin')}\n                          className={`px-3 py-1 rounded text-sm ${\n                            selectedUser.role === 'admin'\n                              ? 'bg-purple-500 text-white'\n                              : 'bg-slate-700 text-slate-400 hover:bg-slate-600'\n                          }`}\n                        >\n                          Admin\n                        </button>\n                      </div>\n                    </div>\n                    <div>\n                      <label className=\"text-sm text-slate-400\">Home State</label>\n                      <div className=\"text-white\">{selectedUser.homeState || 'Not set'}</div>\n                    </div>\n                    <div>\n                      <label className=\"text-sm text-slate-400\">Flight Plans</label>\n                      <div className=\"text-white\">{selectedUser.flightPlanCount}</div>\n                    </div>\n                    <div>\n                      <label className=\"text-sm text-slate-400\">Clubs</label>\n                      <div className=\"text-white\">{selectedUser.clubCount}</div>\n                    </div>\n                    <div>\n                      <label className=\"text-sm text-slate-400\">Joined</label>\n                      <div className=\"text-white\">\n                        {new Date(selectedUser.createdAt).toLocaleString()}\n                      </div>\n                    </div>\n                  </div>\n\n                  <div className=\"mt-6 pt-4 border-t border-slate-700\">\n                    <button\n                      onClick={() => resetPassword(selectedUser.id)}\n                      className=\"w-full bg-red-600 hover:bg-red-500 text-white py-2 rounded-lg font-medium\"\n                    >\n                      Reset Password\n                    </button>\n                  </div>\n                </>\n              )}\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\aircraft\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\airports\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\admin\\aircraft\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\admin\\billing\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\admin\\billing\\transactions\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[432,435],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[432,435],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":28,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[979,982],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[979,982],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth } from '@/lib/auth';\nimport { prisma } from '@/lib/prisma';\n\n// GET /api/admin/billing/transactions - List billing transactions (invoices)\nexport async function GET(request: Request) {\n  try {\n    const session = await auth();\n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const role = (session.user as any)?.role;\n    if (role !== 'admin' && role !== 'owner') {\n      return NextResponse.json({ error: 'Admin access required' }, { status: 403 });\n    }\n\n    const { searchParams } = new URL(request.url);\n    const take = parseInt(searchParams.get('take') || '50');\n\n    const invoices = await prisma.$queryRawUnsafe(`\n      SELECT TOP (${take})\n        i.id, i.totalAmount, i.status, i.createdAt,\n        u.name as userName, u.email as userEmail\n      FROM Invoice i\n      JOIN [User] u ON i.userId = u.id\n      ORDER BY i.createdAt DESC\n    `) as any[];\n\n    return NextResponse.json({\n      transactions: invoices.map(i => ({\n        id: i.id,\n        user: i.userName || i.userEmail || 'Unknown',\n        plan: 'Flight',\n        amount: i.totalAmount ? Number(i.totalAmount) : 0,\n        date: i.createdAt ? new Date(i.createdAt).toISOString().split('T')[0] : null,\n        status: i.status || 'pending',\n      }))\n    });\n  } catch (error) {\n    console.error('Error fetching billing transactions:', error);\n    return NextResponse.json({ error: 'Failed to fetch transactions' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\admin\\clubs\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[398,401],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[398,401],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth } from '@/lib/auth';\nimport { prisma } from '@/lib/prisma';\n\n// GET /api/admin/clubs - List all flying clubs (site-wide)\nexport async function GET() {\n  try {\n    const session = await auth();\n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const role = (session.user as any)?.role;\n    if (role !== 'admin' && role !== 'owner') {\n      return NextResponse.json({ error: 'Admin access required' }, { status: 403 });\n    }\n\n    const groups = await prisma.flyingGroup.findMany({\n      orderBy: { createdAt: 'desc' },\n      include: {\n        _count: {\n          select: {\n            members: true,\n          },\n        },\n      },\n    });\n\n    const groupIds = groups.map(g => g.id);\n    const aircraftCounts = await prisma.clubAircraft.groupBy({\n      by: ['groupId'],\n      _count: { _all: true },\n      where: { groupId: { in: groupIds } },\n    });\n    const aircraftCountMap = new Map(aircraftCounts.map(a => [a.groupId, a._count._all]));\n\n    return NextResponse.json({\n      clubs: groups.map(g => ({\n        id: g.id,\n        name: g.name,\n        description: g.description,\n        ownerId: g.ownerId,\n        createdAt: g.createdAt?.toISOString() || null,\n        members: Number(g._count?.members || 0),\n        aircraft: Number(aircraftCountMap.get(g.id) || 0),\n        plan: 'Free',\n        revenue: 0,\n        status: 'active',\n      }))\n    });\n  } catch (error) {\n    console.error('Error fetching clubs:', error);\n    return NextResponse.json({ error: 'Failed to fetch clubs' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\admin\\demo-data\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":16,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[546,549],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[546,549],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":25,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[839,842],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[839,842],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":30,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[990,993],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[990,993],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":32,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1042,1045],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1042,1045],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":281,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":281,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10783,10786],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10783,10786],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":284,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":284,"endColumn":17}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth } from '@/lib/auth';\nimport { prisma } from '@/lib/prisma';\n\n// POST /api/admin/demo-data - Generate demo data based on config\nexport async function POST(request: Request) {\n  try {\n    const session = await auth();\n    if (!session?.user?.email) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Check if user is admin\n    const user = await prisma.$queryRawUnsafe(`\n      SELECT role FROM [User] WHERE email = '${session.user.email}'\n    `) as any[];\n\n    if (!user || user.length === 0 || user[0].role !== 'admin') {\n      return NextResponse.json({ error: 'Admin access required' }, { status: 403 });\n    }\n\n    const body = await request.json();\n    const { seedAll = true, dataTypes = [] } = body;\n\n    const results: Record<string, any> = {};\n\n    // Get demo data config\n    const demoConfig = await prisma.$queryRawUnsafe(`\n      SELECT * FROM DemoData WHERE enabled = 1\n    `) as any[];\n\n    const enabledTypes = demoConfig.map((d: any) => d.key);\n\n    // Default to all if none specified\n    const typesToSeed = dataTypes.length > 0 \n      ? dataTypes \n      : (seedAll ? enabledTypes : ['clubs']);\n\n    // Helper to generate UUIDs deterministically\n    const generateId = (prefix: string, index: number) => {\n      const hex = index.toString(16).padStart(8, '0');\n      return `${prefix}${hex}-${prefix.slice(0, 4)}-0000-000000000000`.slice(0, 36);\n    };\n\n    // Seed Clubs\n    if (typesToSeed.includes('clubs')) {\n      const clubs = [\n        { name: 'Sky High Flying Club', description: 'A welcoming club for pilots of all experience levels' },\n        { name: 'Weekend Warriors', description: 'Casual flying group for weekend adventures' },\n      ];\n\n      for (let i = 0; i < clubs.length; i++) {\n        const clubId = generateId('club', i);\n        await prisma.$executeRawUnsafe(`\n          IF NOT EXISTS (SELECT 1 FROM FlyingGroup WHERE id = '${clubId}')\n          INSERT INTO FlyingGroup (id, name, description, ownerId, createdAt)\n          VALUES ('${clubId}', '${clubs[i].name.replace(/'/g, \"''\")}', '${clubs[i].description.replace(/'/g, \"''\")}', '${generateId('user', i)}', GETDATE())\n        `);\n      }\n      results.clubs = { created: clubs.length };\n    }\n\n    // Seed Aircraft\n    if (typesToSeed.includes('aircraft')) {\n      const aircraft = [\n        { clubIndex: 0, nNumber: 'N172SP', nickname: 'Skyhawk', make: 'Cessna', model: '172S', year: 2020, rate: 165 },\n        { clubIndex: 0, nNumber: 'N9876P', nickname: 'Warrior', make: 'Piper', model: 'PA-28-161', year: 2019, rate: 145 },\n        { clubIndex: 0, nNumber: 'N345AB', nickname: 'Archer', make: 'Piper', model: 'PA-28-181', year: 2021, rate: 175 },\n        { clubIndex: 1, nNumber: 'N5678C', nickname: 'Cherokee', make: 'Piper', model: 'PA-32-300', year: 2018, rate: 135 },\n        { clubIndex: 1, nNumber: 'N9999X', nickname: 'Skylane', make: 'Cessna', model: '182S', year: 2022, rate: 195 },\n      ];\n\n      for (let i = 0; i < aircraft.length; i++) {\n        const a = aircraft[i];\n        const aircraftId = generateId('airc', i);\n        const clubId = generateId('club', a.clubIndex);\n        \n        await prisma.$executeRawUnsafe(`\n          IF NOT EXISTS (SELECT 1 FROM ClubAircraft WHERE id = '${aircraftId}')\n          INSERT INTO ClubAircraft (id, groupId, nNumber, nickname, make, model, year, hourlyRate, totalHobbsHours, status, bookingWindowDays, createdAt)\n          VALUES ('${aircraftId}', '${clubId}', '${a.nNumber}', '${a.nickname}', '${a.make}', '${a.model}', ${a.year}, ${a.rate}, ${1000 + i * 200}, 'Available', 30, GETDATE())\n        `);\n      }\n      results.aircraft = { created: aircraft.length };\n    }\n\n    // Seed Users\n    if (typesToSeed.includes('users')) {\n      const users = [\n        { email: 'admin@skyhigh.com', name: 'John Smith' },\n        { email: 'pilot@skyhigh.com', name: 'Jane Doe' },\n        { email: 'cfi@skyhigh.com', name: 'Mike Wilson' },\n        { email: 'pilot2@skyhigh.com', name: 'Sarah Johnson' },\n        { email: 'admin@weekend.com', name: 'Alice Cooper' },\n        { email: 'pilot@weekend.com', name: 'Bob Miller' },\n      ];\n\n      for (let i = 0; i < users.length; i++) {\n        const u = users[i];\n        const userId = generateId('user', i);\n        \n        await prisma.$executeRawUnsafe(`\n          IF NOT EXISTS (SELECT 1 FROM [User] WHERE email = '${u.email}')\n          INSERT INTO [User] (id, email, name, username, createdAt)\n          VALUES ('${userId}', '${u.email}', '${u.name}', '${u.email.split('@')[0]}', GETDATE())\n        `);\n\n        // Set some pilot credentials\n        if (i > 0 && i < 5) {\n          const bfrDate = new Date();\n          bfrDate.setMonth(bfrDate.getMonth() + 6);\n          const medicalDate = new Date();\n          medicalDate.setMonth(medicalDate.getMonth() + 18);\n\n          await prisma.$executeRawUnsafe(`\n            UPDATE [User] SET bfrExpiry = '${bfrDate.toISOString()}', medicalExpiry = '${medicalDate.toISOString()}', medicalClass = '2'\n            WHERE email = '${u.email}'\n          `);\n        }\n      }\n      results.users = { created: users.length };\n    }\n\n    // Seed Memberships\n    if (typesToSeed.includes('memberships')) {\n      const memberships = [\n        { userIndex: 0, clubIndex: 0, role: 'ADMIN' },\n        { userIndex: 1, clubIndex: 0, role: 'MEMBER' },\n        { userIndex: 2, clubIndex: 0, role: 'CFI' },\n        { userIndex: 3, clubIndex: 0, role: 'MEMBER' },\n        { userIndex: 4, clubIndex: 1, role: 'ADMIN' },\n        { userIndex: 5, clubIndex: 1, role: 'MEMBER' },\n      ];\n\n      for (let i = 0; i < memberships.length; i++) {\n        const m = memberships[i];\n        const userId = generateId('user', m.userIndex);\n        const clubId = generateId('club', m.clubIndex);\n        \n        await prisma.$executeRawUnsafe(`\n          IF NOT EXISTS (SELECT 1 FROM GroupMember WHERE userId = '${userId}' AND groupId = '${clubId}')\n          INSERT INTO GroupMember (id, userId, groupId, role, joinedAt)\n          VALUES (NEWID(), '${userId}', '${clubId}', '${m.role}', GETDATE())\n        `);\n      }\n      results.memberships = { created: memberships.length };\n    }\n\n    // Seed Bookings\n    if (typesToSeed.includes('bookings')) {\n      const now = new Date();\n      const bookings: { clubIndex: number; userIndex: number; aircraftIndex: number; daysOffset: number; purpose: string }[] = [];\n\n      // Past bookings (last 30 days)\n      for (let i = 0; i < 10; i++) {\n        bookings.push({\n          clubIndex: i % 2,\n          userIndex: i % 4,\n          aircraftIndex: i % 3,\n          daysOffset: -Math.floor(Math.random() * 30),\n          purpose: ['Training', 'Cross Country', 'Local Practice', 'Night Flight'][i % 4],\n        });\n      }\n\n      // Future bookings (next 14 days)\n      for (let i = 0; i < 10; i++) {\n        bookings.push({\n          clubIndex: i % 2,\n          userIndex: i % 4,\n          aircraftIndex: i % 3,\n          daysOffset: Math.floor(Math.random() * 14) + 1,\n          purpose: ['Training', 'Cross Country', 'Local Practice', 'Night Flight'][i % 4],\n        });\n      }\n\n      for (let i = 0; i < bookings.length; i++) {\n        const b = bookings[i];\n        const date = new Date(now);\n        date.setDate(date.getDate() + b.daysOffset);\n        date.setHours(9 + (i % 8), 0, 0, 0);\n        \n        const startTime = date.toISOString();\n        const endDate = new Date(date);\n        endDate.setHours(endDate.getHours() + 1 + (i % 3));\n        const endTime = endDate.toISOString();\n\n        const aircraftId = generateId('airc', b.aircraftIndex);\n        const userId = generateId('user', b.userIndex);\n\n        await prisma.$executeRawUnsafe(`\n          INSERT INTO Booking (id, aircraftId, userId, startTime, endTime, purpose, createdAt)\n          VALUES (NEWID(), '${aircraftId}', '${userId}', '${startTime}', '${endTime}', '${b.purpose}', GETDATE())\n        `);\n      }\n      results.bookings = { created: bookings.length };\n    }\n\n    // Seed Flight Logs\n    if (typesToSeed.includes('flights')) {\n      const now = new Date();\n      \n      for (let i = 0; i < 30; i++) {\n        const date = new Date(now);\n        date.setDate(date.getDate() - Math.floor(Math.random() * 90));\n        \n        const aircraftIndex = i % 5;\n        const userIndex = i % 4;\n        \n        const aircraftId = generateId('airc', aircraftIndex);\n        const userId = generateId('user', userIndex);\n        const hobbsTime = 0.5 + Math.random() * 2.5;\n        \n        const rates = [165, 145, 175, 135, 195];\n        const hourlyRate = rates[aircraftIndex];\n\n        await prisma.$executeRawUnsafe(`\n          INSERT INTO FlightLog (id, aircraftId, userId, date, hobbsTime, hobbsStart, hobbsEnd, calculatedCost, createdAt)\n          VALUES (\n            NEWID(), \n            '${aircraftId}', \n            '${userId}', \n            '${date.toISOString()}', \n            ${hobbsTime.toFixed(2)},\n            ${(1000 + i * 0.1).toFixed(1)},\n            ${(1000 + i * 0.1 + hobbsTime).toFixed(1)},\n            ${(hobbsTime * hourlyRate).toFixed(2)},\n            GETDATE()\n          )\n        `);\n      }\n      results.flights = { created: 30 };\n    }\n\n    // Seed Logbook Entries\n    if (typesToSeed.includes('logbook')) {\n      const now = new Date();\n      \n      for (let userIndex = 0; userIndex < 4; userIndex++) {\n        for (let i = 0; i < 5; i++) {\n          const date = new Date(now);\n          date.setDate(date.getDate() - Math.floor(Math.random() * 80));\n          \n          const userId = generateId('user', userIndex);\n\n          await prisma.$executeRawUnsafe(`\n            INSERT INTO LogbookEntry (id, userId, date, aircraft, routeFrom, routeTo, totalTime, dayLandings, nightLandings, createdAt)\n            VALUES (\n              NEWID(),\n              '${userId}',\n              '${date.toISOString()}',\n              'Cessna 172',\n              'KABC',\n              'KXYZ',\n              ${(1 + Math.random() * 2).toFixed(1)},\n              ${Math.floor(Math.random() * 3) + 1},\n              ${Math.random() > 0.5 ? Math.floor(Math.random() * 2) : 0},\n              GETDATE()\n            )\n          `);\n        }\n      }\n      results.logbook = { created: 20 };\n    }\n\n    return NextResponse.json({\n      success: true,\n      message: 'Demo data generated successfully',\n      results,\n    });\n  } catch (error) {\n    console.error('Error generating demo data:', error);\n    return NextResponse.json({ error: 'Failed to generate demo data', details: String(error) }, { status: 500 });\n  }\n}\n\n// GET /api/admin/demo-data - Get demo data config\nexport async function GET() {\n  try {\n    const demoConfig = await prisma.$queryRawUnsafe(`\n      SELECT * FROM DemoData ORDER BY key\n    `) as any[];\n\n    return NextResponse.json(demoConfig);\n  } catch (error) {\n    // Table might not exist yet\n    return NextResponse.json([\n      { key: 'clubs', enabled: true },\n      { key: 'aircraft', enabled: true },\n      { key: 'users', enabled: true },\n      { key: 'memberships', enabled: true },\n      { key: 'bookings', enabled: true },\n      { key: 'flights', enabled: true },\n      { key: 'logbook', enabled: true },\n    ]);\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\admin\\error-reports\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[407,410],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[407,410],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":24,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[875,878],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[875,878],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":48,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1512,1515],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1512,1515],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":56,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1795,1798],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1795,1798],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":56,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1803,1806],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1803,1806],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":81,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2500,2503],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2500,2503],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth } from '@/lib/auth';\nimport { prisma } from '@/lib/prisma';\n\n// GET /api/admin/error-reports - List error reports\nexport async function GET(request: Request) {\n  try {\n    const session = await auth();\n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const role = (session.user as any)?.role;\n    if (role !== 'admin' && role !== 'owner') {\n      return NextResponse.json({ error: 'Admin access required' }, { status: 403 });\n    }\n\n    const url = new URL(request.url);\n    const status = url.searchParams.get('status'); // open, in_progress, resolved, closed\n    const page = parseInt(url.searchParams.get('page') || '1');\n    const limit = parseInt(url.searchParams.get('limit') || '20');\n    const offset = (page - 1) * limit;\n\n    const where: any = {};\n    if (status && status !== 'all') {\n      where.status = status;\n    }\n\n    const [total, reports, statusCounts] = await prisma.$transaction([\n      prisma.errorReport.count({ where }),\n      prisma.errorReport.findMany({\n        where,\n        orderBy: { createdAt: 'desc' },\n        skip: offset,\n        take: limit,\n        include: {\n          user: { select: { email: true, name: true } },\n        },\n      }),\n      prisma.errorReport.groupBy({\n        by: ['status'],\n        _count: { _all: true },\n        orderBy: { status: 'asc' },\n      }),\n    ]);\n\n    return NextResponse.json({\n      reports: reports.map((r: any) => ({\n        ...r,\n        userEmail: r.user?.email || null,\n        userName: r.user?.name || null,\n        user: undefined,\n        createdAt: r.createdAt?.toISOString(),\n        updatedAt: r.updatedAt?.toISOString(),\n      })),\n      statusCounts: statusCounts.reduce((acc: any, s: any) => {\n        acc[s.status] = Number(s._count?._all || 0);\n        return acc;\n      }, {}),\n      pagination: {\n        page,\n        limit,\n        total,\n        totalPages: Math.ceil(total / limit),\n      },\n    });\n  } catch (error) {\n    console.error('Error fetching error reports:', error);\n    return NextResponse.json({ error: 'Failed to fetch error reports' }, { status: 500 });\n  }\n}\n\n// PUT /api/admin/error-reports - Update error report status\nexport async function PUT(request: Request) {\n  try {\n    const session = await auth();\n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const role = (session.user as any)?.role;\n    if (role !== 'admin' && role !== 'owner') {\n      return NextResponse.json({ error: 'Admin access required' }, { status: 403 });\n    }\n\n    const body = await request.json();\n    const { id, status, resolution } = body;\n\n    if (!id || !status) {\n      return NextResponse.json({ error: 'ID and status required' }, { status: 400 });\n    }\n\n    await prisma.errorReport.update({\n      where: { id },\n      data: { status, resolution: resolution || null },\n    });\n\n    return NextResponse.json({ success: true });\n  } catch (error) {\n    console.error('Error updating error report:', error);\n    return NextResponse.json({ error: 'Failed to update error report' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\admin\\flights\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\admin\\flights\\summary\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[418,421],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[418,421],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth } from '@/lib/auth';\nimport { prisma } from '@/lib/prisma';\n\n// GET /api/admin/flights/summary - Aggregate active/scheduled/completed counts\nexport async function GET() {\n  try {\n    const session = await auth();\n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const role = (session.user as any)?.role;\n    if (role !== 'admin' && role !== 'owner') {\n      return NextResponse.json({ error: 'Admin access required' }, { status: 403 });\n    }\n\n    const now = new Date();\n\n    const [activeFlights, scheduledFlights, completedFlights] = await Promise.all([\n      prisma.flightLog.count({ where: { hobbsEnd: null } }),\n      prisma.booking.count({ where: { startTime: { gt: now } } }),\n      prisma.flightLog.count({ where: { hobbsEnd: { not: null } } }),\n    ]);\n\n    return NextResponse.json({\n      activeFlights,\n      scheduledFlights,\n      completedFlights,\n    });\n  } catch (error) {\n    console.error('Error fetching flight summary:', error);\n    return NextResponse.json({ error: 'Failed to fetch flight summary' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\admin\\fuel-expenses\\[id]\\route.ts","messages":[{"ruleId":"prefer-const","severity":2,"message":"'updateData' is never reassigned. Use 'const' instead.","line":54,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":54,"endColumn":24,"fix":{"range":[1438,1561],"text":"const updateData: any = {\n      updatedAt: new Date(),\n      approvedBy: session.user.id,\n      approvedAt: new Date()\n    };"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":54,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1454,1457],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1454,1457],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth } from '@/lib/auth';\nimport { prisma } from '@/lib/auth';\n\ninterface RouteParams {\n  params: Promise<{ id: string }>;\n}\n\nexport async function PATCH(request: Request, { params }: RouteParams) {\n  try {\n    const session = await auth();\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const { id } = await params;\n    const body = await request.json();\n    const { action, notes } = body; // action: 'approve' | 'deny'\n\n    // Get the fuel expense\n    const expense = await prisma.fuelExpense.findUnique({\n      where: { id }\n    });\n\n    if (!expense) {\n      return NextResponse.json({ error: 'Expense not found' }, { status: 404 });\n    }\n\n    // Get the aircraft's group\n    const aircraft = await prisma.clubAircraft.findUnique({\n      where: { id: expense.aircraftId },\n      select: { groupId: true }\n    });\n\n    if (!aircraft) {\n      return NextResponse.json({ error: 'Aircraft not found' }, { status: 404 });\n    }\n\n    // Check admin access\n    const membership = await prisma.groupMember.findFirst({\n      where: {\n        userId: session.user.id,\n        groupId: aircraft.groupId,\n        role: { in: ['ADMIN', 'OWNER'] }\n      }\n    });\n\n    if (!membership) {\n      return NextResponse.json({ error: 'Admin access required' }, { status: 403 });\n    }\n\n    // Update expense based on action\n    let updateData: any = {\n      updatedAt: new Date(),\n      approvedBy: session.user.id,\n      approvedAt: new Date()\n    };\n\n    if (action === 'approve') {\n      updateData.status = 'APPROVED';\n    } else if (action === 'deny') {\n      updateData.status = 'DENIED';\n    } else {\n      return NextResponse.json({ error: 'Invalid action' }, { status: 400 });\n    }\n\n    if (notes) {\n      updateData.notes = (expense.notes || '') + '\\n[Admin note] ' + notes;\n    }\n\n    const updated = await prisma.fuelExpense.update({\n      where: { id },\n      data: updateData\n    });\n\n    return NextResponse.json({ success: true, expense: updated });\n  } catch (error) {\n    console.error('Error updating fuel expense:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\admin\\fuel-expenses\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":43,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1220,1223],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1220,1223],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth } from '@/lib/auth';\nimport { prisma } from '@/lib/auth';\n\nexport async function GET(request: Request) {\n  try {\n    const session = await auth();\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const { searchParams } = new URL(request.url);\n    const groupId = searchParams.get('groupId');\n    const status = searchParams.get('status'); // 'PENDING', 'APPROVED', 'DENIED'\n\n    if (!groupId) {\n      return NextResponse.json({ error: 'Group ID required' }, { status: 400 });\n    }\n\n    // Check admin access\n    const membership = await prisma.groupMember.findFirst({\n      where: {\n        userId: session.user.id,\n        groupId,\n        role: { in: ['ADMIN', 'OWNER'] }\n      }\n    });\n\n    if (!membership) {\n      return NextResponse.json({ error: 'Admin access required' }, { status: 403 });\n    }\n\n    // Get all aircraft IDs for this group\n    const aircraftList = await prisma.clubAircraft.findMany({\n      where: { groupId },\n      select: { id: true, nNumber: true }\n    });\n\n    const aircraftIds = aircraftList.map(a => a.id);\n\n    // Fetch fuel expenses\n    const whereClause: any = {\n      aircraftId: { in: aircraftIds }\n    };\n\n    if (status) {\n      whereClause.status = status;\n    }\n\n    const expenses = await prisma.fuelExpense.findMany({\n      where: whereClause,\n      orderBy: { createdAt: 'desc' },\n      take: 100\n    });\n\n    // Enrich with pilot and aircraft info\n    const enrichedExpenses = await Promise.all(expenses.map(async (expense) => {\n      const pilot = await prisma.user.findUnique({\n        where: { id: expense.userId },\n        select: { name: true, email: true }\n      });\n\n      const aircraft = aircraftList.find(a => a.id === expense.aircraftId);\n\n      return {\n        id: expense.id,\n        pilot: pilot?.name || 'Unknown',\n        pilotEmail: pilot?.email || '',\n        aircraft: aircraft?.nNumber || 'N/A',\n        date: expense.createdAt?.toISOString().split('T')[0] || 'N/A',\n        gallons: expense.gallons.toNumber(),\n        pricePerGal: expense.pricePerGallon.toNumber(),\n        total: expense.totalCost.toNumber(),\n        status: expense.status,\n        submittedAt: expense.createdAt?.toLocaleString() || 'N/A',\n        approvedAt: expense.approvedAt?.toISOString() || null,\n        approvedBy: expense.approvedBy,\n        receiptUrl: expense.receiptUrl,\n        notes: expense.notes,\n      };\n    }));\n\n    // Calculate stats\n    const pending = enrichedExpenses.filter(e => e.status === 'PENDING');\n    const approved = enrichedExpenses.filter(e => e.status === 'APPROVED');\n    const denied = enrichedExpenses.filter(e => e.status === 'DENIED');\n\n    const pendingTotal = pending.reduce((sum, e) => sum + e.total, 0);\n    const approvedTotal = approved.reduce((sum, e) => sum + e.total, 0);\n\n    return NextResponse.json({\n      expenses: enrichedExpenses,\n      stats: {\n        pendingCount: pending.length,\n        pendingTotal,\n        approvedCount: approved.length,\n        approvedTotal,\n        deniedCount: denied.length\n      }\n    });\n  } catch (error) {\n    console.error('Error fetching fuel expenses:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\admin\\maintenance\\history\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\admin\\maintenance\\issues\\[id]\\route.ts","messages":[{"ruleId":"prefer-const","severity":2,"message":"'updateData' is never reassigned. Use 'const' instead.","line":54,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":54,"endColumn":24,"fix":{"range":[1406,1464],"text":"const updateData: any = {\n      updatedAt: new Date()\n    };"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":54,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1422,1425],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1422,1425],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth } from '@/lib/auth';\nimport { prisma } from '@/lib/auth';\n\ninterface RouteParams {\n  params: Promise<{ id: string }>;\n}\n\nexport async function PATCH(request: Request, { params }: RouteParams) {\n  try {\n    const session = await auth();\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const { id } = await params;\n    const body = await request.json();\n    const { action, notes, cost } = body;\n\n    // Get the maintenance issue\n    const issue = await prisma.maintenance.findUnique({\n      where: { id },\n    });\n\n    if (!issue) {\n      return NextResponse.json({ error: 'Issue not found' }, { status: 404 });\n    }\n\n    // Get the aircraft's group\n    const aircraft = await prisma.clubAircraft.findUnique({\n      where: { id: issue.aircraftId },\n      select: { groupId: true }\n    });\n\n    if (!aircraft) {\n      return NextResponse.json({ error: 'Aircraft not found' }, { status: 404 });\n    }\n\n    // Check admin access\n    const membership = await prisma.groupMember.findFirst({\n      where: {\n        userId: session.user.id,\n        groupId: aircraft.groupId,\n        role: { in: ['ADMIN', 'OWNER'] }\n      }\n    });\n\n    if (!membership) {\n      return NextResponse.json({ error: 'Admin access required' }, { status: 403 });\n    }\n\n    // Handle different actions\n    let updateData: any = {\n      updatedAt: new Date()\n    };\n\n    switch (action) {\n      case 'resolve':\n        updateData.status = 'DONE';\n        updateData.resolvedDate = new Date();\n        updateData.isGrounded = false;\n        if (cost !== undefined) updateData.cost = cost;\n        if (notes) updateData.notes = notes;\n        break;\n\n      case 'dismiss':\n        // Mark as resolved without creating work order\n        updateData.status = 'DONE';\n        updateData.resolvedDate = new Date();\n        updateData.isGrounded = false;\n        if (notes) updateData.notes = (issue.notes || '') + '\\n[Dismissed by admin] ' + notes;\n        break;\n\n      case 'ground':\n        updateData.isGrounded = true;\n        updateData.status = 'IN_PROGRESS';\n        if (notes) updateData.notes = notes;\n        break;\n\n      case 'unground':\n        updateData.isGrounded = false;\n        if (notes) updateData.notes = notes;\n        break;\n\n      case 'create-work-order':\n        updateData.status = 'IN_PROGRESS';\n        if (notes) updateData.notes = notes;\n        if (cost !== undefined) updateData.cost = cost;\n        break;\n\n      case 'update':\n        if (notes !== undefined) updateData.notes = notes;\n        if (cost !== undefined) updateData.cost = cost;\n        break;\n\n      default:\n        return NextResponse.json({ error: 'Invalid action' }, { status: 400 });\n    }\n\n    // Update the maintenance record\n    const updated = await prisma.maintenance.update({\n      where: { id },\n      data: updateData\n    });\n\n    return NextResponse.json({ success: true, issue: updated });\n  } catch (error) {\n    console.error('Error updating maintenance issue:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\admin\\maintenance\\issues\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\admin\\marketplace\\listings\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[436,439],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[436,439],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":22,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[765,768],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[765,768],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth } from '@/lib/auth';\nimport { prisma } from '@/lib/prisma';\n\n// GET /api/admin/marketplace/listings - List marketplace listings for moderation\nexport async function GET(request: Request) {\n  try {\n    const session = await auth();\n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const role = (session.user as any)?.role;\n    if (role !== 'admin' && role !== 'owner') {\n      return NextResponse.json({ error: 'Admin access required' }, { status: 403 });\n    }\n\n    const { searchParams } = new URL(request.url);\n    const status = searchParams.get('status');\n    const take = parseInt(searchParams.get('take') || '50');\n\n    const where: any = {};\n    if (status) where.status = status;\n\n    const listings = await prisma.marketplaceListing.findMany({\n      where,\n      orderBy: { createdAt: 'desc' },\n      take,\n      include: {\n        user: { select: { name: true, email: true } },\n      },\n    });\n\n    return NextResponse.json({\n      listings: listings.map(l => ({\n        id: l.id,\n        title: l.title,\n        price: l.price || 0,\n        status: l.status,\n        views: 0,\n        listed: l.createdAt?.toISOString() || null,\n        flagged: l.status === 'flagged',\n        seller: l.user?.name || l.user?.email || 'Unknown',\n      }))\n    });\n  } catch (error) {\n    console.error('Error fetching marketplace listings:', error);\n    return NextResponse.json({ error: 'Failed to fetch listings' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\admin\\members\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\admin\\migrate\\presence\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\admin\\migrate\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1174,1177],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1174,1177],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":45,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1520,1523],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1520,1523],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":50,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1658,1661],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1658,1661],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth, prisma } from '@/lib/auth';\n\nexport async function POST() {\n  try {\n    const session = await auth();\n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Not authenticated' }, { status: 401 });\n    }\n\n    // Only admins can run migrations\n    if (session.user.role !== 'admin') {\n      return NextResponse.json({ error: 'Admin only' }, { status: 403 });\n    }\n\n    const results: string[] = [];\n\n    // Create UserPresence table if it doesn't exist\n    try {\n      await prisma.$executeRawUnsafe(`\n        IF NOT EXISTS (SELECT * FROM sys.tables WHERE name = 'UserPresence')\n        BEGIN\n          CREATE TABLE [UserPresence] (\n            [id] NVARCHAR(36) NOT NULL PRIMARY KEY,\n            [userId] NVARCHAR(36) NOT NULL UNIQUE,\n            [isOnline] BIT NOT NULL DEFAULT 0,\n            [lastSeenAt] DATETIME NOT NULL DEFAULT GETDATE(),\n            [updatedAt] DATETIME NOT NULL DEFAULT GETDATE()\n          );\n          CREATE NONCLUSTERED INDEX [IX_UserPresence_isOnline] ON [UserPresence]([isOnline]);\n        END\n      `);\n      results.push('UserPresence table created');\n    } catch (e: any) {\n      results.push(`UserPresence: ${e.message}`);\n    }\n\n    // Add image column to User if it doesn't exist\n    try {\n      await prisma.$executeRawUnsafe(`\n        IF COL_LENGTH('[User]', 'image') IS NULL\n          ALTER TABLE [User] ADD image NVARCHAR(500) NULL;\n      `);\n      results.push('User.image column added');\n    } catch (e: any) {\n      results.push(`User.image: ${e.message}`);\n    }\n\n    return NextResponse.json({ success: true, results });\n  } catch (error: any) {\n    console.error('Migration failed', error);\n    return NextResponse.json({ error: error.message }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\admin\\outreach\\campaigns\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'request' is defined but never used.","line":5,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":34},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[383,386],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[383,386],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":29,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[814,817],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[814,817],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1266,1269],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1266,1269],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":66,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1813,1816],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1813,1816],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\nimport { auth } from '@/lib/auth';\nimport { prisma } from '@/lib/prisma';\n\nexport async function GET(request: NextRequest) {\n  try {\n    const session = await auth();\n    \n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const sessionRole = (session.user as any)?.role;\n    if (sessionRole !== 'admin' && sessionRole !== 'owner') {\n      return NextResponse.json({ error: 'Admin access required' }, { status: 403 });\n    }\n\n    const campaigns = await prisma.outreachCampaign.findMany({\n      orderBy: { createdAt: 'desc' },\n      include: {\n        _count: {\n          select: { emails: true },\n        },\n      },\n    });\n\n    return NextResponse.json({ campaigns });\n\n  } catch (error: any) {\n    console.error('[Outreach Campaigns API] Error:', error);\n    return NextResponse.json(\n      { error: 'Internal server error', details: error.message },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const session = await auth();\n    \n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const sessionRole = (session.user as any)?.role;\n    if (sessionRole !== 'admin' && sessionRole !== 'owner') {\n      return NextResponse.json({ error: 'Admin access required' }, { status: 403 });\n    }\n\n    const body = await request.json();\n\n    const campaign = await prisma.outreachCampaign.create({\n      data: {\n        name: body.name,\n        description: body.description,\n        subject: body.subject,\n        bodyHtml: body.bodyHtml,\n        bodyText: body.bodyText,\n        status: 'draft',\n      },\n    });\n\n    return NextResponse.json({ campaign });\n\n  } catch (error: any) {\n    console.error('[Outreach Campaigns API] Error:', error);\n    return NextResponse.json(\n      { error: 'Internal server error', details: error.message },\n      { status: 500 }\n    );\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\admin\\outreach\\contacts\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[383,386],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[383,386],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":23,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[753,756],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[753,756],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":55,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1441,1444],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1441,1444],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":72,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1892,1895],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1892,1895],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":101,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":101,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2818,2821],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2818,2821],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\nimport { auth } from '@/lib/auth';\nimport { prisma } from '@/lib/prisma';\n\nexport async function GET(request: NextRequest) {\n  try {\n    const session = await auth();\n    \n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const sessionRole = (session.user as any)?.role;\n    if (sessionRole !== 'admin' && sessionRole !== 'owner') {\n      return NextResponse.json({ error: 'Admin access required' }, { status: 403 });\n    }\n\n    const { searchParams } = new URL(request.url);\n    const type = searchParams.get('type');\n    const state = searchParams.get('state');\n    const search = searchParams.get('search');\n\n    const where: any = {};\n\n    if (type) {\n      where.organizationType = type;\n    }\n\n    if (state) {\n      where.state = state;\n    }\n\n    if (search) {\n      where.OR = [\n        { organizationName: { contains: search } },\n        { contactName: { contains: search } },\n        { contactEmail: { contains: search } },\n        { city: { contains: search } },\n      ];\n    }\n\n    const contacts = await prisma.outreachContact.findMany({\n      where,\n      orderBy: { createdAt: 'desc' },\n      take: 100,\n    });\n\n    const stats = await prisma.outreachContact.groupBy({\n      by: ['organizationType'],\n      _count: true,\n    });\n\n    return NextResponse.json({ contacts, stats });\n\n  } catch (error: any) {\n    console.error('[Outreach Contacts API] Error:', error);\n    return NextResponse.json(\n      { error: 'Internal server error', details: error.message },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const session = await auth();\n    \n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const sessionRole = (session.user as any)?.role;\n    if (sessionRole !== 'admin' && sessionRole !== 'owner') {\n      return NextResponse.json({ error: 'Admin access required' }, { status: 403 });\n    }\n\n    const body = await request.json();\n\n    const contact = await prisma.outreachContact.create({\n      data: {\n        organizationType: body.organizationType,\n        organizationName: body.organizationName,\n        airportIcao: body.airportIcao,\n        airportName: body.airportName,\n        city: body.city,\n        state: body.state,\n        contactName: body.contactName,\n        contactTitle: body.contactTitle,\n        contactEmail: body.contactEmail,\n        contactPhone: body.contactPhone,\n        alternateEmail: body.alternateEmail,\n        alternatePhone: body.alternatePhone,\n        website: body.website,\n        notes: body.notes,\n        sourceType: 'manual',\n      },\n    });\n\n    return NextResponse.json({ contact });\n\n  } catch (error: any) {\n    console.error('[Outreach Contacts API] Error:', error);\n    return NextResponse.json(\n      { error: 'Internal server error', details: error.message },\n      { status: 500 }\n    );\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\admin\\pipeline\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[525,528],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[525,528],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":117,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":117,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3545,3548],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3545,3548],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":131,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":131,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3941,3944],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3941,3944],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server'\nimport { auth } from '@/lib/auth'\nimport { prisma } from '@/lib/prisma'\n\ntype ModuleKey = 'logbook' | 'training' | 'currency' | 'plan' | 'marketplace' | 'mechanic' | 'club' | 'totals'\n\nconst stageOrder = ['ingestion', 'validation', 'storage', 'analytics', 'outputs'] as const\n\nexport async function GET(request: Request) {\n  const session = await auth()\n  if (!session?.user?.id) return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n\n  const role = (session.user as any)?.role\n  if (role !== 'admin' && role !== 'owner') {\n    return NextResponse.json({ error: 'Admin access required' }, { status: 403 })\n  }\n\n  const { searchParams } = new URL(request.url)\n  const moduleKey = (searchParams.get('module') as ModuleKey) || 'totals'\n\n  const [\n    logbookEntries,\n    logbookAttachments,\n    currencyStatuses,\n    endorsements,\n    trainingProgress,\n    flightPlans,\n    marketplaceListings,\n    mechanicRequests,\n    clubGroups,\n  ] = await Promise.all([\n    prisma.logbookEntry.count(),\n    prisma.logbookAttachment.count(),\n    prisma.currencyStatus.count(),\n    prisma.endorsement.count(),\n    prisma.trainingProgress.count(),\n    prisma.flightPlan.count(),\n    prisma.marketplaceListing.count(),\n    prisma.maintenanceRequest.count(),\n    prisma.flyingGroup.count(),\n  ])\n\n  const data = {\n    logbookEntries,\n    logbookAttachments,\n    currencyStatuses,\n    endorsements,\n    trainingProgress,\n    flightPlans,\n    marketplaceListings,\n    mechanicRequests,\n    clubGroups,\n  }\n\n  const modules = {\n    logbook: {\n      ingestion: data.logbookEntries,\n      validation: data.currencyStatuses,\n      storage: data.logbookAttachments + data.logbookEntries,\n      analytics: data.currencyStatuses,\n      outputs: data.logbookEntries,\n      usedBy: ['currency', 'training', 'exports'],\n    },\n    training: {\n      ingestion: data.endorsements,\n      validation: data.trainingProgress,\n      storage: data.trainingProgress,\n      analytics: data.trainingProgress,\n      outputs: data.endorsements,\n      usedBy: ['readiness', 'exports'],\n    },\n    currency: {\n      ingestion: data.logbookEntries,\n      validation: data.currencyStatuses,\n      storage: data.currencyStatuses,\n      analytics: data.currencyStatuses,\n      outputs: data.currencyStatuses,\n      usedBy: ['dashboard', 'alerts'],\n    },\n    plan: {\n      ingestion: data.flightPlans,\n      validation: data.flightPlans,\n      storage: data.flightPlans,\n      analytics: data.flightPlans,\n      outputs: data.flightPlans,\n      usedBy: ['logbook', 'fuel-saver'],\n    },\n    marketplace: {\n      ingestion: data.marketplaceListings,\n      validation: data.marketplaceListings,\n      storage: data.marketplaceListings,\n      analytics: data.marketplaceListings,\n      outputs: data.marketplaceListings,\n      usedBy: ['reports', 'exports'],\n    },\n    mechanic: {\n      ingestion: data.mechanicRequests,\n      validation: data.mechanicRequests,\n      storage: data.mechanicRequests,\n      analytics: data.mechanicRequests,\n      outputs: data.mechanicRequests,\n      usedBy: ['club', 'logbook'],\n    },\n    club: {\n      ingestion: data.clubGroups,\n      validation: data.clubGroups,\n      storage: data.clubGroups,\n      analytics: data.clubGroups,\n      outputs: data.clubGroups,\n      usedBy: ['admin', 'maintenance'],\n    },\n  }\n\n  if (moduleKey === 'totals') {\n    const totals = stageOrder.map((stage) => {\n      const breakdown = Object.entries(modules).reduce((acc, [key, value]) => {\n        acc[key] = (value as any)[stage]\n        return acc\n      }, {} as Record<string, number>)\n\n      const total = Object.values(breakdown).reduce((sum, value) => sum + value, 0)\n      return { stage, total, breakdown }\n    })\n\n    return NextResponse.json({ module: moduleKey, stages: totals })\n  }\n\n  const selected = modules[moduleKey]\n  const stages = stageOrder.map((stage) => ({\n    stage,\n    value: (selected as any)[stage],\n  }))\n\n  return NextResponse.json({ module: moduleKey, stages, usedBy: selected.usedBy })\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\admin\\stats\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[384,387],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[384,387],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth } from '@/lib/auth';\nimport { prisma } from '@/lib/prisma';\n\n// GET /api/admin/stats - Overview statistics\nexport async function GET() {\n  try {\n    const session = await auth();\n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const role = (session.user as any)?.role;\n    if (role !== 'admin' && role !== 'owner') {\n      return NextResponse.json({ error: 'Admin access required' }, { status: 403 });\n    }\n\n    const totalUsers = await prisma.user.count();\n    const tierCounts = await prisma.user.groupBy({\n      by: ['tier'],\n      _count: { _all: true },\n      orderBy: { tier: 'asc' },\n    });\n    const freeUsers = Number(tierCounts.find((t) => t.tier === 'free')?._count?._all || 0);\n    const proUsers = Number(tierCounts.find((t) => t.tier === 'pro')?._count?._all || 0);\n\n    const thirtyDaysAgo = new Date();\n    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);\n\n    const newUsers30Days = await prisma.user.count({ where: { createdAt: { gte: thirtyDaysAgo } } });\n    const openErrorReports = await prisma.errorReport.count({ where: { status: 'open' } });\n    const totalFlightPlans = await prisma.flightPlan.count();\n    const totalGroups = await prisma.flyingGroup.count();\n    const totalAircraft = await prisma.clubAircraft.count();\n\n    const listingCounts = await prisma.marketplaceListing.groupBy({\n      by: ['status'],\n      _count: { _all: true },\n    });\n    const listingCountMap = new Map(listingCounts.map((l) => [l.status, l._count._all]));\n\n    // Estimate revenue (assuming $39.99/year for pro users)\n    const estimatedAnnualRevenue = proUsers * 39.99;\n    const estimatedMRR = (proUsers * 39.99) / 12;\n\n    return NextResponse.json({\n      totalUsers,\n      freeUsers,\n      proUsers,\n      newUsers30Days,\n      openErrorReports,\n      totalFlightPlans,\n      totalGroups,\n      totalAircraft,\n      listingActive: Number(listingCountMap.get('active') || 0),\n      listingPending: Number(listingCountMap.get('pending') || 0),\n      listingFlagged: Number(listingCountMap.get('flagged') || 0),\n      listingSold: Number(listingCountMap.get('sold') || 0),\n      estimatedAnnualRevenue: Math.round(estimatedAnnualRevenue * 100) / 100,\n      estimatedMRR: Math.round(estimatedMRR * 100) / 100,\n    });\n  } catch (error) {\n    console.error('Error fetching admin stats:', error);\n    return NextResponse.json({ error: 'Failed to fetch stats' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\admin\\users\\[id]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[497,500],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[497,500],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":93,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2726,2729],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2726,2729],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":102,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3014,3017],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3014,3017],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":130,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":130,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3853,3856],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3853,3856],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth } from '@/lib/auth';\nimport { prisma } from '@/lib/prisma';\nimport { hash } from 'bcryptjs';\n\n// GET /api/admin/users/[id] - Get single user details\nexport async function GET(\n  request: Request,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const session = await auth();\n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const role = (session.user as any)?.role;\n    if (role !== 'admin' && role !== 'owner') {\n      return NextResponse.json({ error: 'Admin access required' }, { status: 403 });\n    }\n\n    const { id } = await params;\n\n    const user = await prisma.user.findUnique({\n      where: { id },\n      select: {\n        id: true,\n        email: true,\n        name: true,\n        username: true,\n        tier: true,\n        role: true,\n        homeState: true,\n        stripeCustomerId: true,\n        subscriptionEnd: true,\n        createdAt: true,\n        updatedAt: true,\n        _count: { select: { flightPlans: true, memberships: true } },\n      },\n    });\n\n    if (!user) {\n      return NextResponse.json({ error: 'User not found' }, { status: 404 });\n    }\n\n    const errorReports = await prisma.errorReport.findMany({\n      where: { userId: id },\n      orderBy: { createdAt: 'desc' },\n      take: 5,\n      select: { id: true, title: true, status: true, createdAt: true },\n    });\n\n    return NextResponse.json({\n      user: {\n        id: user.id,\n        email: user.email,\n        name: user.name,\n        username: user.username,\n        tier: user.tier,\n        role: user.role,\n        homeState: user.homeState,\n        stripeCustomerId: user.stripeCustomerId,\n        subscriptionEnd: user.subscriptionEnd?.toISOString(),\n        createdAt: user.createdAt?.toISOString(),\n        updatedAt: user.updatedAt?.toISOString(),\n        flightPlanCount: Number(user._count?.flightPlans || 0),\n        clubCount: Number(user._count?.memberships || 0),\n        errorReports: errorReports.map((e) => ({\n          id: e.id,\n          title: e.title,\n          status: e.status,\n          createdAt: e.createdAt?.toISOString(),\n        })),\n      },\n    });\n  } catch (error) {\n    console.error('Error fetching user:', error);\n    return NextResponse.json({ error: 'Failed to fetch user' }, { status: 500 });\n  }\n}\n\n// PUT /api/admin/users/[id] - Update user tier or role\nexport async function PUT(\n  request: Request,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const session = await auth();\n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const sessionRole = (session.user as any)?.role;\n    if (sessionRole !== 'admin' && sessionRole !== 'owner') {\n      return NextResponse.json({ error: 'Admin access required' }, { status: 403 });\n    }\n\n    const { id } = await params;\n    const body = await request.json();\n    const { tier, role } = body;\n\n    const data: any = {};\n    if (tier) data.tier = tier;\n    if (role) data.role = role;\n\n    if (Object.keys(data).length === 0) {\n      return NextResponse.json({ error: 'No fields to update' }, { status: 400 });\n    }\n\n    await prisma.user.update({ where: { id }, data });\n\n    return NextResponse.json({ success: true });\n  } catch (error) {\n    console.error('Error updating user:', error);\n    return NextResponse.json({ error: 'Failed to update user' }, { status: 500 });\n  }\n}\n\n// POST /api/admin/users/[id]/reset-password - Reset user's password\nexport async function POST(\n  request: Request,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const session = await auth();\n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const sessionRole = (session.user as any)?.role;\n    if (sessionRole !== 'admin' && sessionRole !== 'owner') {\n      return NextResponse.json({ error: 'Admin access required' }, { status: 403 });\n    }\n\n    const { id } = await params;\n    const body = await request.json();\n    const { newPassword } = body;\n\n    if (!newPassword || newPassword.length < 6) {\n      return NextResponse.json({ error: 'Password must be at least 6 characters' }, { status: 400 });\n    }\n\n    // Hash the new password\n    const hashedPassword = await hash(newPassword, 12);\n\n    await prisma.user.update({\n      where: { id },\n      data: { password: hashedPassword },\n    });\n\n    return NextResponse.json({ success: true, message: 'Password reset successfully' });\n  } catch (error) {\n    console.error('Error resetting password:', error);\n    return NextResponse.json({ error: 'Failed to reset password' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\admin\\users\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[425,428],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[425,428],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1011,1014],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1011,1014],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":66,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1961,1964],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1961,1964],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":73,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2224,2227],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2224,2227],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":87,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2669,2672],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2669,2672],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth } from '@/lib/auth';\nimport { prisma } from '@/lib/prisma';\n\n// GET /api/admin/users - List users with search and pagination\nexport async function GET(request: Request) {\n  try {\n    const session = await auth();\n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const sessionRole = (session.user as any)?.role;\n    if (sessionRole !== 'admin' && sessionRole !== 'owner') {\n      return NextResponse.json({ error: 'Admin access required' }, { status: 403 });\n    }\n\n    const url = new URL(request.url);\n    const search = url.searchParams.get('search') || '';\n    const page = parseInt(url.searchParams.get('page') || '1');\n    const limit = parseInt(url.searchParams.get('limit') || '20');\n    const tier = url.searchParams.get('tier'); // free, pro, or all\n    const role = url.searchParams.get('role'); // user, admin, owner\n    const offset = (page - 1) * limit;\n\n    const where: any = {};\n\n    if (search) {\n      const term = search.trim();\n      if (term) {\n        where.OR = [\n          { email: { contains: term } },\n          { name: { contains: term } },\n          { username: { contains: term } },\n        ];\n      }\n    }\n    if (tier && tier !== 'all') {\n      where.tier = tier;\n    }\n    if (role) {\n      where.role = role;\n    }\n\n    const [total, users] = await prisma.$transaction([\n      prisma.user.count({ where }),\n      prisma.user.findMany({\n        where,\n        orderBy: { createdAt: 'desc' },\n        skip: offset,\n        take: limit,\n          select: {\n            id: true,\n            email: true,\n            name: true,\n            username: true,\n            tier: true,\n            role: true,\n            createdAt: true,\n            updatedAt: true,\n            _count: { select: { flightPlans: true, memberships: true } },\n          },\n        }),\n    ]);\n\n    const userIds = users.map((u: any) => u.id);\n    const memberships = await prisma.groupMember.findMany({\n      where: { userId: { in: userIds } },\n      include: { group: { select: { name: true } } },\n    });\n\n    const groupNameByUser = new Map<string, string>();\n    memberships.forEach((m: any) => {\n      if (!groupNameByUser.has(m.userId)) {\n        groupNameByUser.set(m.userId, m.group?.name || '');\n      }\n    });\n\n    const logbookHours = await prisma.logbookEntry.groupBy({\n      by: ['userId'],\n      _sum: { totalTime: true },\n      where: { userId: { in: userIds } },\n    });\n    const hoursMap = new Map(logbookHours.map(h => [h.userId, h._sum.totalTime || 0]));\n\n    return NextResponse.json({\n       users: users.map((u: any) => ({\n        id: u.id,\n        email: u.email,\n        name: u.name,\n        username: u.username,\n        tier: u.tier,\n        role: u.role,\n        createdAt: u.createdAt?.toISOString(),\n        updatedAt: u.updatedAt?.toISOString(),\n        flightPlanCount: Number(u._count?.flightPlans || 0),\n        clubCount: Number(u._count?.memberships || 0),\n        status: 'active',\n        hours: Number(hoursMap.get(u.id) || 0),\n        club: groupNameByUser.get(u.id) || 'â€”',\n        joined: u.createdAt?.toISOString()?.split('T')[0],\n      })),\n      pagination: {\n        page,\n        limit,\n        total,\n        totalPages: Math.ceil(total / limit),\n      },\n    });\n  } catch (error) {\n    console.error('Error fetching users:', error);\n    return NextResponse.json({ error: 'Failed to fetch users' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\aircraft\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\aircraft\\search\\models\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\aircraft\\search\\options\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\aircraft\\search\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'yearFrom' is assigned a value but never used.","line":13,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'yearTo' is assigned a value but never used.","line":14,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":24,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[848,851],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[848,851],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\nimport { PrismaClient } from \"@prisma/client\";\n\nconst prisma = new PrismaClient();\n\nexport const dynamic = 'force-dynamic';\n\nexport async function GET(request: Request) {\n  const { searchParams } = new URL(request.url);\n  \n  const manufacturer = searchParams.get(\"manufacturer\") || \"\";\n  const model = searchParams.get(\"model\") || \"\";\n  const yearFrom = searchParams.get(\"yearFrom\") || \"\";\n  const yearTo = searchParams.get(\"yearTo\") || \"\";\n  const status = searchParams.get(\"status\") || \"\";\n  const typeRegistrant = searchParams.get(\"typeRegistrant\") || \"\";\n  const page = parseInt(searchParams.get(\"page\") || \"1\");\n  const limit = parseInt(searchParams.get(\"limit\") || \"50\");\n  \n  const skip = (page - 1) * limit;\n\n  try {\n    // Build where clause - use contains for partial matching\n    const where: any = {};\n    \n    if (manufacturer) {\n      // Use contains for partial match (case insensitive in SQL Server)\n      where.mfr = { contains: manufacturer, mode: 'insensitive' };\n    }\n    \n    if (model) {\n      where.model = { contains: model, mode: 'insensitive' };\n    }\n    \n    if (status) {\n      where.statusCode = status;\n    }\n    \n    if (typeRegistrant) {\n      where.typeRegistrant = typeRegistrant;\n    }\n\n    // Get total count\n    const total = await prisma.aircraftMaster.count({ where });\n    \n    // Get paginated results\n    const results = await prisma.aircraftMaster.findMany({\n      where,\n      skip,\n      take: limit,\n      orderBy: { nNumber: 'asc' }\n    });\n\n    return NextResponse.json({\n      results: results.map(r => ({\n        nNumber: r.nNumber,\n        serialNumber: r.serialNumber,\n        manufacturer: r.mfr,\n        model: r.model,\n        status: r.statusCode,\n        typeRegistrant: r.typeRegistrant,\n        lastActionDate: r.lastActionDate,\n        airWorthDate: r.airWorthDate,\n        name: r.name,\n      })),\n      pagination: {\n        page,\n        limit,\n        total,\n        totalPages: Math.ceil(total / limit),\n        hasMore: skip + results.length < total\n      }\n    });\n  } catch (error) {\n    console.error(\"Search error:\", error);\n    return NextResponse.json({ error: String(error) }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\airports\\[icao]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":7,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[177,180],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[177,180],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":114,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3521,3524],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3521,3524],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":115,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3593,3596],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3593,3596],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":125,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":125,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3950,3953],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3950,3953],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":127,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":127,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4070,4073],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4070,4073],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":144,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4710,4713],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4710,4713],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":157,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":157,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5138,5141],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5138,5141],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":167,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":167,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5504,5507],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5504,5507],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":188,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":188,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":199,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":199,"endColumn":17}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport sqlite3 from 'sqlite3';\nimport { open } from 'sqlite';\nimport path from 'path';\nimport { prisma } from '@/lib/auth';\n\nlet db: any = null;\n\nasync function getDb() {\n  if (!db) {\n    const dbPath = path.join(process.cwd(), 'data', 'aviation_hub.db');\n    db = await open({\n      filename: dbPath,\n      driver: sqlite3.Database\n    });\n  }\n  return db;\n}\n\n// Demo fuel prices for airports without cached data\nconst DEMO_FUEL_PRICES: Record<string, number> = {\n  'KORD': 9.58, 'KLAX': 10.65, 'KVNY': 8.32, 'KPDK': 8.67,\n  'KJFK': 12.50, 'KATL': 9.45, 'KDEN': 8.99, 'KSFO': 11.25,\n  'KLAS': 9.50, 'KSEA': 10.80, 'KMIA': 10.25, 'KDFW': 8.75,\n  'KPHX': 9.15, 'KIAH': 9.30, 'KBOS': 11.50, 'KMSP': 9.20,\n  'KCLT': 8.85, 'KSTL': 8.45, 'KPDX': 10.50, 'KRDU': 9.10,\n  'KSMF': 9.95, 'KMCO': 9.80, 'KTPA': 10.10,\n  'KMDW': 8.55, 'KDAL': 7.95, 'KSAT': 8.25, 'KOAK': 10.40,\n  'KSNA': 9.75, 'KBUR': 8.95, 'KFLL': 10.30, 'KPSP': 9.40,\n  'KDTW': 9.25, 'KCLE': 8.95, 'KMKE': 8.75, 'KIND': 8.50,\n  'KSDF': 8.45, 'KTUL': 8.15, 'KABQ': 8.85, 'KOMA': 8.30,\n};\n\n// Demo landing fees\nconst DEMO_FEES: Record<string, number> = {\n  'KJFK': 45, 'KLAX': 40, 'KSFO': 35, 'KORD': 30,\n  'KMIA': 38, 'KATL': 28, 'KDEN': 25, 'KLAS': 22,\n  'KDTW': 28, 'KCLE': 25, 'KMKE': 22, 'KIND': 24,\n};\n\n// GET /api/airports/[icao] - Get full airport details\nexport async function GET(request: Request, { params }: { params: Promise<{ icao: string }> }) {\n  try {\n    const { icao } = await params;\n    let icaoUpper = icao.toUpperCase();\n    \n    const db = await getDb();\n    \n    // Get basic airport info\n    let airport = await db.get(`\n      SELECT icao, iata, name, type, latitude, longitude, elevation_ft, city, state, country\n      FROM airports \n      WHERE icao = ?\n    `, icaoUpper);\n\n    // If user passed IATA (e.g. DTW), resolve to ICAO (e.g. KDTW)\n    if (!airport && /^[A-Z0-9]{3}$/.test(icaoUpper)) {\n      airport = await db.get(`\n        SELECT icao, iata, name, type, latitude, longitude, elevation_ft, city, state, country\n        FROM airports\n        WHERE iata = ?\n      `, icaoUpper);\n\n      if (airport?.icao) {\n        icaoUpper = airport.icao.toUpperCase();\n      }\n    }\n    \n    if (!airport) {\n      return NextResponse.json({ error: 'Airport not found' }, { status: 404 });\n    }\n    \n    // Get runways\n    const runways = await db.all(`\n      SELECT length_ft, width_ft, surface, he_ident, le_ident\n      FROM runways \n      WHERE icao = ?\n      ORDER BY length_ft DESC\n      LIMIT 5\n    `, icaoUpper);\n    \n    // Get frequencies\n    const frequencies = await db.all(`\n      SELECT frequency_mhz, description, type\n      FROM frequencies \n      WHERE icao = ?\n      ORDER BY \n        CASE type \n          WHEN 'APP' THEN 1 \n          WHEN 'TWR' THEN 2 \n          WHEN 'GND' THEN 3 \n          WHEN 'DEP' THEN 4 \n          WHEN 'ATIS' THEN 5 \n          WHEN 'CTAF' THEN 6 \n          ELSE 7 \n        END\n      LIMIT 10\n    `, icaoUpper);\n    \n    // Get cached fuel prices from new table (AirNav data)\n    const fuelPrices = await db.all(`\n      SELECT fuel_type, service_type, price, last_reported, source_url, scraped_at, has_tower, attendance, phone, landing_fee, manager\n      FROM airport_fuel \n      WHERE icao = ?\n    `, icaoUpper);\n    \n    // Also check old cache table\n    const fuelCache = await db.all(`\n      SELECT data_type, price, source_site, last_updated\n      FROM airport_cache \n      WHERE icao = ?\n    `, icaoUpper);\n    \n    const fuelData = fuelCache.find((f: any) => f.data_type === 'fuel');\n    const feeData = fuelCache.find((f: any) => f.data_type === 'fee');\n    \n    // Use new AirNav table first, then fallback to old cache\n    let fuelPrice = null;\n    let fuelSource = 'demo';\n    let fuelSourceUrl = '';\n    let fuelLastReported = '';\n    \n    if (fuelPrices && fuelPrices.length > 0) {\n      // Get 100LL price (average if multiple)\n      const llPrices = fuelPrices.filter((f: any) => f.fuel_type === '100LL');\n      if (llPrices.length > 0) {\n        fuelPrice = llPrices.reduce((sum: number, f: any) => sum + f.price, 0) / llPrices.length;\n        fuelSource = 'airnav';\n        fuelSourceUrl = llPrices[0].source_url || '';\n        fuelLastReported = llPrices[0].last_reported || '';\n      }\n    } else if (fuelData) {\n      // Fallback to old cache\n      fuelPrice = fuelData.price;\n      fuelSource = fuelData.source_site || 'demo';\n    } else {\n      // Fallback to demo prices\n      fuelPrice = DEMO_FUEL_PRICES[icaoUpper] || null;\n    }\n    \n    const landingFeeAmount = feeData ? feeData.price : (DEMO_FEES[icaoUpper] || null);\n    \n    // Get community-reported fuel prices (most recent for each type)\n    let communityPrices: any[] = [];\n    try {\n      communityPrices = await prisma.communityFuelPrice.findMany({\n        where: { icao: icaoUpper },\n        orderBy: { purchaseDate: 'desc' },\n        take: 10,\n      });\n    } catch (e) {\n      // Community table might not exist yet\n      console.log('Community prices not available:', e);\n    }\n    \n    // Get latest community price for each fuel type\n    const latestCommunityByType: Record<string, any> = {};\n    for (const p of communityPrices) {\n      if (!latestCommunityByType[p.fuelType]) {\n        latestCommunityByType[p.fuelType] = p;\n      }\n    }\n    \n    // Calculate price divergence (flag if > 15% difference)\n    const community100ll = latestCommunityByType['100LL'];\n    const communityJetA = latestCommunityByType['JetA'];\n    let priceDivergence: any = null;\n    \n    if (fuelPrice && community100ll) {\n      const diff = Math.abs(fuelPrice - Number(community100ll.price)) / fuelPrice;\n      if (diff > 0.15) {\n        priceDivergence = {\n          type: '100LL',\n          airnavPrice: fuelPrice,\n          communityPrice: Number(community100ll.price),\n          difference: `${(diff * 100).toFixed(0)}% ${community100ll.price > fuelPrice ? 'higher' : 'lower'}`\n        };\n      }\n    }\n    \n    // If using demo prices, cache them for future use\n    if (!fuelData && fuelPrice) {\n      try {\n        await db.run(`\n          INSERT OR REPLACE INTO airport_cache (icao, data_type, price, source_site, last_updated)\n          VALUES (?, 'fuel', ?, 'demo', datetime('now'))\n        `, icaoUpper, fuelPrice);\n      } catch (e) {\n        // Ignore cache errors\n      }\n    }\n    \n    if (!feeData && landingFeeAmount) {\n      try {\n        await db.run(`\n          INSERT OR REPLACE INTO airport_cache (icao, data_type, price, source_site, last_updated)\n          VALUES (?, 'fee', ?, 'demo', datetime('now'))\n        `, icaoUpper, landingFeeAmount);\n      } catch (e) {\n        // Ignore cache errors\n      }\n    }\n    \n    return NextResponse.json({\n      ...airport,\n      runways,\n      frequencies,\n      // Manager/owner info from airport_fuel table\n      manager: fuelPrices[0]?.manager || null,\n      phone: fuelPrices[0]?.phone || null,\n      hasTower: fuelPrices[0]?.has_tower ?? null,\n      attendance: fuelPrices[0]?.attendance || null,\n      fuel: fuelPrice ? {\n        price100ll: fuelPrice,\n        source: fuelSource,\n        sourceUrl: fuelSourceUrl,\n        lastReported: fuelLastReported,\n        lastUpdated: fuelData ? fuelData.last_updated : new Date().toISOString(),\n        // Fuel provider info\n        providerName: fuelPrices[0]?.fbo_name || null,\n        providerPhone: fuelPrices[0]?.phone || null,\n        // Community-reported prices\n        community100ll: community100ll ? {\n          price: Number(community100ll.price),\n          fbo: community100ll.fbo,\n          date: community100ll.purchaseDate,\n          reportedAt: community100ll.createdAt,\n          daysAgo: Math.floor((Date.now() - new Date(community100ll.purchaseDate).getTime()) / (1000 * 60 * 60 * 24))\n        } : null,\n        communityJetA: communityJetA ? {\n          price: Number(communityJetA.price),\n          fbo: communityJetA.fbo,\n          date: communityJetA.purchaseDate,\n          reportedAt: communityJetA.createdAt,\n          daysAgo: Math.floor((Date.now() - new Date(communityJetA.purchaseDate).getTime()) / (1000 * 60 * 60 * 24))\n        } : null,\n        // Price divergence warning\n        priceDivergence\n      } : null,\n      landingFee: landingFeeAmount ? {\n        amount: landingFeeAmount,\n        source: feeData ? feeData.source_site : 'demo',\n        lastUpdated: feeData ? feeData.last_updated : new Date().toISOString()\n      } : null\n    });\n  } catch (error) {\n    console.error('Error fetching airport details:', error);\n    return NextResponse.json({ error: 'Failed to fetch airport details' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\airports\\bounds\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[140,143],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[140,143],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":42,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1437,1440],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1437,1440],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":79,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2805,2808],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2805,2808],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport sqlite3 from 'sqlite3';\nimport { open } from 'sqlite';\nimport path from 'path';\n\nlet db: any = null;\n\nasync function getDb() {\n  if (!db) {\n    const dbPath = path.join(process.cwd(), 'data', 'aviation_hub.db');\n    db = await open({\n      filename: dbPath,\n      driver: sqlite3.Database\n    });\n  }\n  return db;\n}\n\n// GET /api/airports/bounds?minLat=30&maxLat=50&minLon=-120&maxLon=-70&minSize=small&country=US\nexport async function GET(request: Request) {\n  try {\n    const { searchParams } = new URL(request.url);\n    \n    const minLat = parseFloat(searchParams.get('minLat') || '-90');\n    const maxLat = parseFloat(searchParams.get('maxLat') || '90');\n    const minLon = parseFloat(searchParams.get('minLon') || '-180');\n    const maxLon = parseFloat(searchParams.get('maxLon') || '180');\n    const minSize = searchParams.get('minSize') || 'small'; // small, medium, large, heli, seaplane\n    const limit = parseInt(searchParams.get('limit') || '200');\n    const icao = searchParams.get('icao'); // Single airport lookup\n    const country = searchParams.get('country'); // Optional country filter\n    \n    const db = await getDb();\n    \n    // If single ICAO requested\n    if (icao) {\n      let sql = `\n        SELECT icao, iata, name, city, country, latitude, longitude, type, elevation_ft\n        FROM airports \n        WHERE (icao = ? OR iata = ?)\n      `;\n      const params: any[] = [icao.toUpperCase(), icao.toUpperCase()];\n      \n      // Add country filter if specified\n      if (country) {\n        sql += ' AND country = ?';\n        params.push(country);\n      }\n      \n      const airport = await db.get(sql, params);\n      \n      if (airport) {\n        return NextResponse.json(airport);\n      }\n      return NextResponse.json({ error: 'Airport not found' }, { status: 404 });\n    }\n    \n    // Build size filter - map sizes to airport types\n    const typeFilters: Record<string, string[]> = {\n      'large': ['large_airport'],\n      'medium': ['large_airport', 'medium_airport'],\n      'small': ['large_airport', 'medium_airport', 'small_airport'],\n      'heli': ['large_airport', 'medium_airport', 'small_airport', 'heliport'],\n      'seaplane': ['large_airport', 'medium_airport', 'small_airport', 'seaplane_base'],\n    };\n    \n    const allowedTypes = typeFilters[minSize] || typeFilters['small'];\n    const typePlaceholders = allowedTypes.map(() => '?').join(',');\n    \n    // Build query with optional country filter\n    let sql = `\n      SELECT icao, iata, name, city, country, latitude, longitude, type, elevation_ft\n      FROM airports \n      WHERE latitude BETWEEN ? AND ?\n        AND longitude BETWEEN ? AND ?\n        AND type IN (${typePlaceholders})\n        AND (is_closed IS NULL OR is_closed = 0)\n    `;\n    const params: any[] = [minLat, maxLat, minLon, maxLon, ...allowedTypes];\n    \n    // Add country filter if specified\n    if (country) {\n      sql += ' AND country = ?';\n      params.push(country);\n    }\n    \n    sql += `\n      ORDER BY \n        CASE type \n          WHEN 'large_airport' THEN 1 \n          WHEN 'medium_airport' THEN 2 \n          WHEN 'small_airport' THEN 3 \n          WHEN 'heliport' THEN 4 \n          WHEN 'seaplane_base' THEN 5 \n          ELSE 6 \n        END,\n        elevation_ft DESC\n      LIMIT ?\n    `;\n    params.push(limit);\n    \n    const airports = await db.all(sql, params);\n    \n    return NextResponse.json({\n      airports,\n      count: airports.length,\n      bounds: { minLat, maxLat, minLon, maxLon }\n    });\n  } catch (error) {\n    console.error('Error fetching airports:', error);\n    return NextResponse.json({ error: 'Failed to fetch airports' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\airports\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[140,143],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[140,143],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":35,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[966,969],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[966,969],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport sqlite3 from 'sqlite3';\nimport { open } from 'sqlite';\nimport path from 'path';\n\nlet db: any = null;\n\nasync function getDb() {\n  if (!db) {\n    const dbPath = path.join(process.cwd(), 'data', 'aviation_hub.db');\n    db = await open({\n      filename: dbPath,\n      driver: sqlite3.Database\n    });\n  }\n  return db;\n}\n\nexport async function GET(request: Request) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const query = searchParams.get('q') || '';\n    const limit = parseInt(searchParams.get('limit') || '20');\n    const type = searchParams.get('type') || 'all'; // all, large, medium, small\n    const country = searchParams.get('country') || 'US'; // Default to US only\n    \n    const db = await getDb();\n    \n    let sql = `\n      SELECT icao, iata, name, city, state, country, type, latitude, longitude, elevation_ft\n      FROM airports\n      WHERE country = ?\n    `;\n    \n    const params: any[] = [country];\n    \n    // Add search filter if query provided\n    if (query) {\n      sql += ` AND (icao LIKE ? OR iata LIKE ? OR name LIKE ? OR city LIKE ?)`;\n      const searchTerm = `%${query}%`;\n      params.push(searchTerm, searchTerm, searchTerm, searchTerm);\n    }\n    \n    // Filter by type\n    if (type === 'large') {\n      sql += \" AND type = 'large_airport'\";\n    } else if (type === 'medium') {\n      sql += \" AND type = 'medium_airport'\";\n    } else if (type === 'small') {\n      sql += \" AND type = 'small_airport'\";\n    }\n    \n    sql += ' ORDER BY type, icao LIMIT ?';\n    params.push(limit);\n    \n    const airports = await db.all(sql, params);\n    \n    return NextResponse.json({ airports });\n  } catch (error) {\n    console.error('Error fetching airports:', error);\n    return NextResponse.json({ error: 'Failed to fetch airports' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\auth\\[...nextauth]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\auth\\delete-account\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\auth\\forgot-password\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\auth\\resend-verification\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\auth\\reset-password\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\auth\\signup\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\auth\\verify-email\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\billing\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":15,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[487,490],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[487,490],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[853,856],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[853,856],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":42,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1564,1567],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1564,1567],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":64,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2414,2417],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2414,2417],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":67,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2500,2503],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2500,2503],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":105,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3680,3683],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3680,3683],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":111,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3824,3827],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3824,3827],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":111,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3832,3835],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3832,3835],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":119,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":119,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4170,4173],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4170,4173],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":120,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":120,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4248,4251],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4248,4251],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":121,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":121,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4328,4331],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4328,4331],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":11,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth } from '@/lib/auth';\nimport { prisma } from '@/lib/prisma';\n\nexport async function GET(request: Request) {\n  try {\n    const session = await auth();\n    if (!session?.user?.email) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Get user by email using raw SQL\n    const users = await prisma.$queryRawUnsafe(`\n      SELECT id FROM [User] WHERE email = '${session.user.email}'\n    `) as any[];\n    \n    if (!users || users.length === 0) {\n      return NextResponse.json({ error: '[User] not found' }, { status: 404 });\n    }\n    \n    const userId = users[0].id;\n    \n    // Check admin role using raw SQL\n    const adminMemberships = await prisma.$queryRawUnsafe(`\n      SELECT * FROM GroupMember WHERE userId = '${userId}' AND role = 'ADMIN'\n    `) as any[];\n\n    if (!adminMemberships || adminMemberships.length === 0) {\n      return NextResponse.json({ error: 'Only admins can view billing' }, { status: 403 });\n    }\n\n    const url = new URL(request.url);\n    const month = parseInt(url.searchParams.get('month') || new Date().getMonth().toString());\n    const year = parseInt(url.searchParams.get('year') || new Date().getFullYear().toString());\n    const groupId = url.searchParams.get('groupId') || null;\n\n    // Get start and end of month\n    const startDate = new Date(year, month, 1).toISOString();\n    const endDate = new Date(year, month + 1, 0, 23, 59, 59).toISOString();\n\n    // Get admin group IDs\n    const adminGroupIds = adminMemberships.map((m: any) => m.groupId);\n\n    // Filter by specific group if provided\n    const targetGroupIds = groupId && adminGroupIds.includes(groupId) ? [groupId] : adminGroupIds;\n\n    if (targetGroupIds.length === 0) {\n      return NextResponse.json({ error: 'No group selected' }, { status: 400 });\n    }\n\n    const groupIdList = targetGroupIds.map((id: string) => \"'\" + id + \"'\").join(',');\n\n    // Get flight logs for the month using raw SQL\n    const flightLogs = await prisma.$queryRawUnsafe(`\n      SELECT \n        fl.*,\n        a.nNumber, a.customName, a.nickname, a.hourlyRate,\n        u.name as userName, u.email as userEmail\n      FROM FlightLog fl\n      JOIN ClubAircraft a ON fl.aircraftId = a.id\n      JOIN [User] u ON fl.userId = u.id\n      WHERE fl.date >= '${startDate}' AND fl.date <= '${endDate}'\n      AND a.groupId IN (${groupIdList})\n    `) as any[];\n\n    // Calculate billing per member\n    const billingByMember: Record<string, any> = {};\n\n    for (const log of flightLogs) {\n      const userId = log.userId;\n      const userName = log.userName || 'Unknown';\n      const userEmail = log.userEmail || '';\n      \n      const hobbsUsed = log.hobbsTime ? Number(log.hobbsTime) : 0;\n      const tachUsed = log.tachTime ? Number(log.tachTime) : 0;\n      const hourlyRate = log.hourlyRate ? Number(log.hourlyRate) : 0;\n      const cost = hobbsUsed * hourlyRate;\n\n      if (!billingByMember[userId]) {\n        billingByMember[userId] = {\n          userId,\n          name: userName,\n          email: userEmail,\n          flights: 0,\n          totalHobbs: 0,\n          totalTach: 0,\n          totalCost: 0,\n          details: [],\n        };\n      }\n\n      billingByMember[userId].flights++;\n      billingByMember[userId].totalHobbs += hobbsUsed;\n      billingByMember[userId].totalTach += tachUsed;\n      billingByMember[userId].totalCost += cost;\n      billingByMember[userId].details.push({\n        date: log.date,\n        aircraft: log.nNumber || log.customName || 'Unknown',\n        hobbs: hobbsUsed,\n        tach: tachUsed,\n        cost,\n      });\n    }\n\n    const result = Object.values(billingByMember).map((m: any) => ({\n      ...m,\n      totalCost: Math.round(m.totalCost * 100) / 100,\n    }));\n\n    // Sort by total cost descending\n    result.sort((a: any, b: any) => b.totalCost - a.totalCost);\n\n    const MONTHS = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];\n\n    return NextResponse.json({\n      month: MONTHS[month],\n      year,\n      totalMembers: result.length,\n      totalFlights: result.reduce((sum: number, m: any) => sum + m.flights, 0),\n      totalHobbs: result.reduce((sum: number, m: any) => sum + m.totalHobbs, 0),\n      totalCost: result.reduce((sum: number, m: any) => sum + m.totalCost, 0),\n      members: result,\n    });\n  } catch (error) {\n    console.error('Error fetching billing:', error);\n    return NextResponse.json({ error: 'Failed to fetch billing', details: String(error) }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\bookings\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[450,453],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[450,453],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":47,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1747,1750],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1747,1750],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":49,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1810,1813],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1810,1813],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":87,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2944,2947],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2944,2947],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":89,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":89,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3010,3013],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3010,3013],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth } from '@/lib/auth';\nimport { prisma } from '@/lib/prisma';\n\nexport async function GET(request: Request) {\n  try {\n    const session = await auth();\n    if (!session?.user?.email) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const userRow = await prisma.$queryRawUnsafe(`\n      SELECT id FROM [User] WHERE email = '${session.user.email}'\n    `) as any[];\n\n    if (!userRow || userRow.length === 0) {\n      return NextResponse.json({ error: '[User] not found' }, { status: 404 });\n    }\n\n    const userId = userRow[0].id;\n\n    const { searchParams } = new URL(request.url);\n    const daysParam = searchParams.get('days') || '7';\n    const now = new Date();\n    const windowEnd = daysParam === 'all'\n      ? null\n      : new Date(now.getTime() + Number(daysParam) * 24 * 60 * 60 * 1000);\n\n    const startFilter = now.toISOString();\n    const endFilter = windowEnd ? windowEnd.toISOString() : null;\n\n    const bookings = await prisma.$queryRawUnsafe(`\n      SELECT \n        b.id, b.aircraftId, b.userId, b.startTime, b.endTime, b.purpose, b.createdAt, b.updatedAt,\n        a.nNumber, a.customName, a.nickname, a.make, a.model, a.groupId as aircraftGroupId,\n        g.name as groupName,\n        u.name as userName, u.email as userEmail\n      FROM Booking b\n      JOIN ClubAircraft a ON b.aircraftId = a.id\n      JOIN [User] u ON b.userId = u.id\n      JOIN FlyingGroup g ON a.groupId = g.id\n      JOIN GroupMember gm ON gm.groupId = g.id AND gm.userId = '${userId}'\n      WHERE b.userId = '${userId}'\n        AND b.startTime >= '${startFilter}'\n        ${endFilter ? `AND b.startTime <= '${endFilter}'` : ''}\n      ORDER BY b.startTime ASC\n    `) as any[];\n\n    const formattedBookings = (bookings || []).map((b: any) => ({\n      id: b.id,\n      aircraftId: b.aircraftId,\n      userId: b.userId,\n      startTime: b.startTime,\n      endTime: b.endTime,\n      purpose: b.purpose,\n      createdAt: b.createdAt,\n      updatedAt: b.updatedAt,\n      groupId: b.aircraftGroupId,\n      groupName: b.groupName,\n      aircraft: {\n        id: b.aircraftId,\n        nNumber: b.nNumber,\n        customName: b.customName,\n        nickname: b.nickname,\n        make: b.make,\n        model: b.model,\n        groupId: b.aircraftGroupId,\n      },\n      user: {\n        id: b.userId,\n        name: b.userName,\n        email: b.userEmail,\n      },\n      source: 'club',\n    }));\n\n    const personalRows = await prisma.$queryRawUnsafe(`\n      SELECT \n        pb.id, pb.userId, pb.userAircraftId, pb.startTime, pb.endTime, pb.purpose, pb.createdAt, pb.updatedAt,\n        ua.nNumber, ua.nickname\n      FROM PersonalBooking pb\n      JOIN UserAircraft ua ON pb.userAircraftId = ua.id\n      WHERE pb.userId = '${userId}'\n        AND pb.startTime >= '${startFilter}'\n        ${endFilter ? `AND pb.startTime <= '${endFilter}'` : ''}\n      ORDER BY pb.startTime ASC\n    `) as any[];\n\n    const personalBookings = (personalRows || []).map((b: any) => ({\n      id: b.id,\n      userId: b.userId,\n      userAircraftId: b.userAircraftId,\n      startTime: b.startTime,\n      endTime: b.endTime,\n      purpose: b.purpose,\n      createdAt: b.createdAt,\n      updatedAt: b.updatedAt,\n      aircraft: {\n        id: b.userAircraftId,\n        nNumber: b.nNumber,\n        nickname: b.nickname,\n      },\n      source: 'personal',\n    }));\n\n    return NextResponse.json({ bookings: [...formattedBookings, ...personalBookings] });\n  } catch (error) {\n    console.error('Error fetching bookings:', error);\n    return NextResponse.json({ error: 'Failed to fetch bookings' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\clubs\\[groupId]\\billing\\run\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'generateSimpleInvoiceHTML' is defined but never used.","line":6,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":55,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"generateSimpleInvoiceHTML"},"fix":{"range":[243,270],"text":""},"desc":"Remove unused variable \"generateSimpleInvoiceHTML\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":27,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[910,913],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[910,913],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":37,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1227,1230],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1227,1230],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1552,1555],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1552,1555],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":67,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2434,2437],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2434,2437],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":75,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2709,2712],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2709,2712],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth } from '@/lib/auth';\nimport { prisma } from '@/lib/prisma';\nimport { runBillingCycle } from '@/lib/billing';\nimport { sendInvoiceEmail } from '@/lib/resend';\nimport { generateInvoicePDF, generateSimpleInvoiceHTML } from '@/lib/invoice';\nimport { writeFileSync } from 'fs';\nimport { join } from 'path';\n\ninterface RouteParams {\n  params: Promise<{ groupId: string }>;\n}\n\n// POST /api/clubs/[groupId]/billing/run - Run monthly billing cycle\nexport async function POST(request: Request, { params }: RouteParams) {\n  try {\n    const session = await auth();\n    if (!session?.user?.email) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const { groupId } = await params;\n\n    // Verify admin\n    const user = await prisma.$queryRawUnsafe(`\n      SELECT id FROM [User] WHERE email = '${session.user.email}'\n    `) as any[];\n\n    if (!user || user.length === 0) {\n      return NextResponse.json({ error: 'User not found' }, { status: 404 });\n    }\n\n    const userId = user[0].id;\n\n    const memberships = await prisma.$queryRawUnsafe(`\n      SELECT role FROM GroupMember WHERE groupId = '${groupId}' AND userId = '${userId}'\n    `) as any[];\n\n    if (!memberships || memberships.length === 0 || memberships[0].role !== 'ADMIN') {\n      return NextResponse.json({ error: 'Admin access required' }, { status: 403 });\n    }\n\n    // Get club name\n    const club = await prisma.$queryRawUnsafe(`\n      SELECT name FROM FlyingGroup WHERE id = '${groupId}'\n    `) as any[];\n\n    const clubName = club && club.length > 0 ? club[0].name : 'Your Flying Club';\n\n    // Run the billing cycle\n    console.log('Starting billing cycle for group:', groupId);\n    const results = await runBillingCycle(groupId);\n    console.log('Billing cycle complete:', results.length, 'members processed');\n\n    // Send invoice emails (only for successful charges)\n    for (const result of results) {\n      if (result.success && result.invoiceId) {\n        // Get invoice details\n        const invoiceItems = await prisma.$queryRawUnsafe(`\n          SELECT \n            fl.date, a.nNumber, fl.hobbsTime, a.hourlyRate,\n            fl.hobbsTime * a.hourlyRate as amount\n          FROM InvoiceItem ii\n          JOIN FlightLog fl ON ii.flightLogId = fl.id\n          JOIN ClubAircraft a ON ii.aircraftId = a.id\n          WHERE ii.invoiceId = '${result.invoiceId}'\n        `) as any[];\n\n        const pdfBuffer = await generateInvoicePDF({\n          id: result.invoiceId,\n          clubName,\n          memberName: result.name,\n          memberEmail: result.email,\n          date: new Date().toLocaleDateString(),\n          items: invoiceItems.map((item: any) => ({\n            date: new Date(item.date).toLocaleDateString(),\n            aircraft: item.nNumber,\n            hobbsHours: parseFloat(item.hobbsTime),\n            hourlyRate: parseFloat(item.hourlyRate),\n            amount: parseFloat(item.amount),\n          })),\n          totalAmount: result.amount,\n        });\n\n        // Save PDF temporarily\n        const pdfPath = join('/tmp', `invoice-${result.invoiceId}.pdf`);\n        writeFileSync(pdfPath, pdfBuffer);\n\n        // Send email\n        await sendInvoiceEmail({\n          to: result.email,\n          clubName,\n          memberName: result.name,\n          totalAmount: result.amount,\n          invoiceId: result.invoiceId,\n          pdfBuffer,\n        });\n      }\n    }\n\n    return NextResponse.json({\n      success: true,\n      summary: {\n        totalMembers: results.length,\n        successful: results.filter(r => r.success).length,\n        failed: results.filter(r => !r.success).length,\n        totalAmount: results.reduce((sum, r) => sum + r.amount, 0),\n      },\n      results,\n    });\n  } catch (error) {\n    console.error('Error running billing:', error);\n    return NextResponse.json({ error: 'Failed to run billing', details: String(error) }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\clubs\\[groupId]\\blockouts\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":22,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[664,667],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[664,667],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":32,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[981,984],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[981,984],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1439,1442],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1439,1442],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":68,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2138,2141],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2138,2141],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":78,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2455,2458],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2455,2458],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth } from '@/lib/auth';\nimport { prisma } from '@/lib/prisma';\n\ninterface RouteParams {\n  params: Promise<{ groupId: string }>;\n}\n\n// GET /api/clubs/[groupId]/blockouts - List blockouts\nexport async function GET(request: Request, { params }: RouteParams) {\n  try {\n    const session = await auth();\n    if (!session?.user?.email) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const { groupId } = await params;\n\n    // Verify admin membership\n    const user = await prisma.$queryRawUnsafe(`\n      SELECT id FROM [User] WHERE email = '${session.user.email}'\n    `) as any[];\n\n    if (!user || user.length === 0) {\n      return NextResponse.json({ error: 'User not found' }, { status: 404 });\n    }\n\n    const userId = user[0].id;\n\n    const memberships = await prisma.$queryRawUnsafe(`\n      SELECT role FROM GroupMember WHERE groupId = '${groupId}' AND userId = '${userId}'\n    `) as any[];\n\n    if (!memberships || memberships.length === 0 || memberships[0].role !== 'ADMIN') {\n      return NextResponse.json({ error: 'Admin access required' }, { status: 403 });\n    }\n\n    const blockouts = await prisma.$queryRawUnsafe(`\n      SELECT \n        bo.*,\n        a.nNumber, a.customName\n      FROM BlockOut bo\n      LEFT JOIN ClubAircraft a ON bo.aircraftId = a.id\n      WHERE bo.groupId = '${groupId}'\n      ORDER BY bo.startTime ASC\n    `) as any[];\n\n    return NextResponse.json(blockouts);\n  } catch (error) {\n    console.error('Error fetching blockouts:', error);\n    return NextResponse.json({ error: 'Failed to fetch blockouts' }, { status: 500 });\n  }\n}\n\n// POST /api/clubs/[groupId]/blockouts - Create blockout\nexport async function POST(request: Request, { params }: RouteParams) {\n  try {\n    const session = await auth();\n    if (!session?.user?.email) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const { groupId } = await params;\n\n    // Verify admin membership\n    const user = await prisma.$queryRawUnsafe(`\n      SELECT id FROM [User] WHERE email = '${session.user.email}'\n    `) as any[];\n\n    if (!user || user.length === 0) {\n      return NextResponse.json({ error: 'User not found' }, { status: 404 });\n    }\n\n    const userId = user[0].id;\n\n    const memberships = await prisma.$queryRawUnsafe(`\n      SELECT role FROM GroupMember WHERE groupId = '${groupId}' AND userId = '${userId}'\n    `) as any[];\n\n    if (!memberships || memberships.length === 0 || memberships[0].role !== 'ADMIN') {\n      return NextResponse.json({ error: 'Admin access required' }, { status: 403 });\n    }\n\n    const body = await request.json();\n    const { aircraftId, title, startTime, endTime } = body;\n\n    if (!title || !startTime || !endTime) {\n      return NextResponse.json({ error: 'Title, startTime, and endTime required' }, { status: 400 });\n    }\n\n    const id = crypto.randomUUID();\n    \n    await prisma.$executeRawUnsafe(`\n      INSERT INTO BlockOut (id, groupId, aircraftId, title, startTime, endTime, createdAt)\n      VALUES (\n        '${id}', \n        '${groupId}', \n        ${aircraftId ? \"'\" + aircraftId + \"'\" : 'NULL'}, \n        '${title.replace(/'/g, \"''\")}', \n        '${new Date(startTime).toISOString()}', \n        '${new Date(endTime).toISOString()}', \n        GETDATE()\n      )\n    `);\n\n    return NextResponse.json({ success: true, id });\n  } catch (error) {\n    console.error('Error creating blockout:', error);\n    return NextResponse.json({ error: 'Failed to create blockout' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\clubs\\[groupId]\\flights\\active\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":31,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1031,1034],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1031,1034],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth } from '@/lib/auth';\nimport { prisma } from '@/lib/prisma';\n\ninterface RouteParams {\n  params: Promise<{ groupId: string }>;\n}\n\n// GET /api/clubs/[groupId]/flights/active - Get all active flights\nexport async function GET(request: Request, { params }: RouteParams) {\n  try {\n    const session = await auth();\n    if (!session?.user?.email) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const { groupId } = await params;\n\n    // Get active flights (where hobbsEnd is null)\n    const activeFlights = await prisma.$queryRawUnsafe(`\n      SELECT \n        fl.id, fl.aircraftId, fl.userId, fl.hobbsStart, fl.createdAt as checkedOutAt,\n        a.nNumber, a.customName, a.make, a.model,\n        u.name as userName\n      FROM FlightLog fl\n      JOIN ClubAircraft a ON fl.aircraftId = a.id\n      JOIN [User] u ON fl.userId = u.id\n      WHERE a.groupId = '${groupId}'\n      AND fl.hobbsEnd IS NULL\n      ORDER BY fl.createdAt DESC\n    `) as any[];\n\n    return NextResponse.json(\n      activeFlights.map(f => ({\n        id: f.id,\n        aircraftId: f.aircraftId,\n        aircraft: {\n          nNumber: f.nNumber,\n          name: f.customName,\n          make: f.make,\n          model: f.model,\n        },\n        user: {\n          id: f.userId,\n          name: f.userName,\n        },\n        hobbsStart: f.hobbsStart,\n        checkedOutAt: f.checkedOutAt,\n      }))\n    );\n  } catch (error) {\n    console.error('Error fetching active flights:', error);\n    return NextResponse.json({ error: 'Failed to fetch active flights' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\clubs\\[groupId]\\flights\\checkin\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'groupId' is assigned a value but never used.","line":17,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":17,"endColumn":20},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":22,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[696,699],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[696,699],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":43,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1339,1342],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1339,1342],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":98,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3213,3216],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3213,3216],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth } from '@/lib/auth';\nimport { prisma } from '@/lib/prisma';\n\ninterface RouteParams {\n  params: Promise<{ groupId: string }>;\n}\n\n// POST /api/clubs/[groupId]/flights/checkin - End a flight (record hobbs end, calculate cost)\nexport async function POST(request: Request, { params }: RouteParams) {\n  try {\n    const session = await auth();\n    if (!session?.user?.email) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const { groupId } = await params;\n\n    // Get user\n    const user = await prisma.$queryRawUnsafe(`\n      SELECT id, name FROM [User] WHERE email = '${session.user.email}'\n    `) as any[];\n\n    if (!user || user.length === 0) {\n      return NextResponse.json({ error: 'User not found' }, { status: 404 });\n    }\n\n    const userId = user[0].id;\n\n    const body = await request.json();\n    const { flightLogId, hobbsEnd, notes } = body;\n\n    if (!flightLogId || !hobbsEnd) {\n      return NextResponse.json({ error: 'flightLogId and hobbsEnd required' }, { status: 400 });\n    }\n\n    // Get the flight log\n    const flight = await prisma.$queryRawUnsafe(`\n      SELECT fl.*, a.hourlyRate, a.totalHobbsHours\n      FROM FlightLog fl\n      JOIN ClubAircraft a ON fl.aircraftId = a.id\n      WHERE fl.id = '${flightLogId}'\n    `) as any[];\n\n    if (!flight || flight.length === 0) {\n      return NextResponse.json({ error: 'Flight not found' }, { status: 404 });\n    }\n\n    const flightData = flight[0];\n\n    // Verify ownership\n    if (flightData.userId !== userId) {\n      return NextResponse.json({ error: 'Not your flight' }, { status: 403 });\n    }\n\n    // Calculate hobbs time\n    const hobbsStart = parseFloat(flightData.hobbsStart);\n    const hobbsEndVal = parseFloat(hobbsEnd);\n    const hobbsTime = hobbsEndVal - hobbsStart;\n\n    if (hobbsTime <= 0) {\n      return NextResponse.json({ error: 'Hobbs end must be greater than hobbs start' }, { status: 400 });\n    }\n\n    // Calculate cost\n    const hourlyRate = flightData.hourlyRate ? parseFloat(flightData.hourlyRate) : 0;\n    const calculatedCost = hobbsTime * hourlyRate;\n\n    // Calculate new total Hobbs for aircraft\n    const currentTotal = flightData.totalHobbsHours ? parseFloat(flightData.totalHobbsHours) : 0;\n    const newTotal = currentTotal + hobbsTime;\n\n    // Update flight log\n    await prisma.$executeRawUnsafe(`\n      UPDATE FlightLog \n      SET hobbsEnd = ${hobbsEnd},\n          hobbsTime = ${hobbsTime},\n          calculatedCost = ${calculatedCost},\n          notes = ${notes ? \"'\" + notes.replace(/'/g, \"''\") + \"'\" : 'NULL'},\n          updatedAt = GETDATE()\n      WHERE id = '${flightLogId}'\n    `);\n\n    // Update aircraft total Hobbs\n    await prisma.$executeRawUnsafe(`\n      UPDATE ClubAircraft \n      SET totalHobbsHours = ${newTotal}\n      WHERE id = '${flightData.aircraftId}'\n    `);\n\n    // Fetch updated flight\n    const updated = await prisma.$queryRawUnsafe(`\n      SELECT fl.*, a.nNumber, a.customName, a.make, a.model, a.hourlyRate, u.name as userName\n      FROM FlightLog fl\n      JOIN ClubAircraft a ON fl.aircraftId = a.id\n      JOIN [User] u ON fl.userId = u.id\n      WHERE fl.id = '${flightLogId}'\n    `) as any[];\n\n    const f = updated[0];\n\n    return NextResponse.json({\n      success: true,\n      flight: {\n        id: f.id,\n        aircraftId: f.aircraftId,\n        aircraft: {\n          nNumber: f.nNumber,\n          name: f.customName,\n          make: f.make,\n          model: f.model,\n        },\n        user: {\n          id: f.userId,\n          name: f.userName,\n        },\n        hobbsStart: f.hobbsStart,\n        hobbsEnd: f.hobbsEnd,\n        hobbsTime: f.hobbsTime,\n        hourlyRate: f.hourlyRate,\n        calculatedCost: f.calculatedCost,\n        date: f.date,\n      }\n    });\n  } catch (error) {\n    console.error('Error during checkin:', error);\n    return NextResponse.json({ error: 'Failed to check in' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\clubs\\[groupId]\\flights\\checkout\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":22,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[685,688],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[685,688],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'userName' is assigned a value but never used.","line":29,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":29,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1062,1065],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1062,1065],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":50,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1629,1632],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1629,1632],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'aircraftData' is assigned a value but never used.","line":56,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":56,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":62,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2032,2035],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2032,2035],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'conflicts' is assigned a value but never used.","line":73,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":73,"endColumn":20},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":78,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2560,2563],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2560,2563],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":104,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":104,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3352,3355],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3352,3355],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth } from '@/lib/auth';\nimport { prisma } from '@/lib/prisma';\n\ninterface RouteParams {\n  params: Promise<{ groupId: string }>;\n}\n\n// POST /api/clubs/[groupId]/flights/checkout - Start a flight (record hobbs start)\nexport async function POST(request: Request, { params }: RouteParams) {\n  try {\n    const session = await auth();\n    if (!session?.user?.email) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const { groupId } = await params;\n\n    // Get user\n    const user = await prisma.$queryRawUnsafe(`\n      SELECT id, name FROM [User] WHERE email = '${session.user.email}'\n    `) as any[];\n\n    if (!user || user.length === 0) {\n      return NextResponse.json({ error: 'User not found' }, { status: 404 });\n    }\n\n    const userId = user[0].id;\n    const userName = user[0].name;\n\n    // Verify membership\n    const memberships = await prisma.$queryRawUnsafe(`\n      SELECT role FROM GroupMember WHERE groupId = '${groupId}' AND userId = '${userId}'\n    `) as any[];\n\n    if (!memberships || memberships.length === 0) {\n      return NextResponse.json({ error: 'Not a member' }, { status: 403 });\n    }\n\n    const body = await request.json();\n    const { aircraftId, hobbsStart, notes } = body;\n\n    if (!aircraftId || !hobbsStart) {\n      return NextResponse.json({ error: 'aircraftId and hobbsStart required' }, { status: 400 });\n    }\n\n    // Verify aircraft belongs to group\n    const aircraft = await prisma.$queryRawUnsafe(`\n      SELECT * FROM ClubAircraft WHERE id = '${aircraftId}' AND groupId = '${groupId}'\n    `) as any[];\n\n    if (!aircraft || aircraft.length === 0) {\n      return NextResponse.json({ error: 'Aircraft not found in this club' }, { status: 404 });\n    }\n\n    const aircraftData = aircraft[0];\n\n    // Check if aircraft is already checked out\n    const activeFlights = await prisma.$queryRawUnsafe(`\n      SELECT * FROM FlightLog \n      WHERE aircraftId = '${aircraftId}' AND hobbsEnd IS NULL\n    `) as any[];\n\n    if (activeFlights && activeFlights.length > 0) {\n      return NextResponse.json({ \n        error: 'Aircraft already checked out',\n        checkedOutBy: activeFlights[0].userId \n      }, { status: 409 });\n    }\n\n    // Check for conflicting booking at current time\n    const now = new Date();\n    const conflicts = await prisma.$queryRawUnsafe(`\n      SELECT * FROM Booking \n      WHERE aircraftId = '${aircraftId}' \n      AND startTime <= '${now.toISOString()}'\n      AND endTime >= '${now.toISOString()}'\n    `) as any[];\n\n    // Create flight log entry\n    const flightLogId = crypto.randomUUID();\n    await prisma.$executeRawUnsafe(`\n      INSERT INTO FlightLog (id, aircraftId, userId, date, hobbsStart, hobbsEnd, hobbsTime, notes, createdAt)\n      VALUES (\n        '${flightLogId}',\n        '${aircraftId}',\n        '${userId}',\n        GETDATE(),\n        ${hobbsStart},\n        NULL,\n        NULL,\n        ${notes ? \"'\" + notes.replace(/'/g, \"''\") + \"'\" : 'NULL'},\n        GETDATE()\n      )\n    `);\n\n    // Fetch created entry\n    const created = await prisma.$queryRawUnsafe(`\n      SELECT fl.*, a.nNumber, a.customName, u.name as userName\n      FROM FlightLog fl\n      JOIN ClubAircraft a ON fl.aircraftId = a.id\n      JOIN [User] u ON fl.userId = u.id\n      WHERE fl.id = '${flightLogId}'\n    `) as any[];\n\n    return NextResponse.json({\n      success: true,\n      flight: {\n        id: created[0].id,\n        aircraftId: created[0].aircraftId,\n        aircraft: {\n          nNumber: created[0].nNumber,\n          name: created[0].customName,\n        },\n        user: {\n          id: created[0].userId,\n          name: created[0].userName,\n        },\n        hobbsStart: created[0].hobbsStart,\n        checkedOutAt: created[0].createdAt,\n      }\n    });\n  } catch (error) {\n    console.error('Error during checkout:', error);\n    return NextResponse.json({ error: 'Failed to check out' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\clubs\\[groupId]\\flights\\complete\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\clubs\\[groupId]\\schedule\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":22,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[688,691],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[688,691],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":32,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1002,1005],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1002,1005],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":49,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1580,1583],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1580,1583],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":60,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1932,1935],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1932,1935],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":67,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2162,2165],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2162,2165],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":75,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2423,2426],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2423,2426],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth } from '@/lib/auth';\nimport { prisma } from '@/lib/prisma';\n\ninterface RouteParams {\n  params: Promise<{ groupId: string }>;\n}\n\n// GET /api/clubs/[groupId]/schedule - Get full schedule with bookings and blockouts\nexport async function GET(request: Request, { params }: RouteParams) {\n  try {\n    const session = await auth();\n    if (!session?.user?.email) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const { groupId } = await params;\n\n    // Verify membership\n    const user = await prisma.$queryRawUnsafe(`\n      SELECT id FROM [User] WHERE email = '${session.user.email}'\n    `) as any[];\n\n    if (!user || user.length === 0) {\n      return NextResponse.json({ error: 'User not found' }, { status: 404 });\n    }\n\n    const userId = user[0].id;\n\n    const memberships = await prisma.$queryRawUnsafe(`\n      SELECT * FROM GroupMember WHERE groupId = '${groupId}' AND userId = '${userId}'\n    `) as any[];\n\n    if (!memberships || memberships.length === 0) {\n      return NextResponse.json({ error: 'Not a member' }, { status: 403 });\n    }\n\n    // Get bookings\n    const bookings = await prisma.$queryRawUnsafe(`\n      SELECT \n        b.id, b.aircraftId, b.userId, b.startTime, b.endTime, b.purpose,\n        a.nNumber, a.customName, a.nickname, a.make, a.model,\n        u.name as userName\n      FROM Booking b\n      JOIN ClubAircraft a ON b.aircraftId = a.id\n      JOIN [User] u ON b.userId = u.id\n      WHERE a.groupId = '${groupId}'\n      ORDER BY b.startTime ASC\n    `) as any[];\n\n    // Get blockouts\n    const blockouts = await prisma.$queryRawUnsafe(`\n      SELECT \n        bo.id, bo.aircraftId, bo.title, bo.startTime, bo.endTime,\n        a.nNumber, a.customName\n      FROM BlockOut bo\n      LEFT JOIN ClubAircraft a ON bo.aircraftId = a.id\n      WHERE bo.groupId = '${groupId}'\n      ORDER BY bo.startTime ASC\n    `) as any[];\n\n    // Get aircraft\n    const aircraft = await prisma.$queryRawUnsafe(`\n      SELECT id, nNumber, customName, nickname, make, model, status, hourlyRate\n      FROM ClubAircraft \n      WHERE groupId = '${groupId}'\n    `) as any[];\n\n    // Get members for the response\n    const members = await prisma.$queryRawUnsafe(`\n      SELECT gm.userId, gm.role, u.name as userName\n      FROM GroupMember gm\n      JOIN [User] u ON gm.userId = u.id\n      WHERE gm.groupId = '${groupId}'\n    `) as any[];\n\n    return NextResponse.json({\n      bookings: bookings.map(b => ({\n        id: b.id,\n        title: b.purpose || `${b.nNumber} flight`,\n        start: b.startTime,\n        end: b.endTime,\n        aircraftId: b.aircraftId,\n        aircraft: {\n          nNumber: b.nNumber,\n          name: b.customName || b.nickname || `${b.make} ${b.model}`,\n        },\n        user: {\n          id: b.userId,\n          name: b.userName,\n        },\n        type: 'booking',\n      })),\n      blockouts: blockouts.map(b => ({\n        id: b.id,\n        title: b.title,\n        start: b.startTime,\n        end: b.endTime,\n        aircraftId: b.aircraftId,\n        aircraft: b.aircraftId ? {\n          nNumber: b.nNumber,\n          name: b.customName,\n        } : null,\n        type: 'blockout',\n      })),\n      aircraft,\n      members,\n    });\n  } catch (error) {\n    console.error('Error fetching schedule:', error);\n    return NextResponse.json({ error: 'Failed to fetch schedule' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\conversations\\[id]\\messages\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":27,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":27,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":76,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":76,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e2' is defined but never used.","line":81,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":81,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":168,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":168,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":177,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":177,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth, prisma } from '@/lib/auth';\nimport { triggerPusher } from '@/lib/pusher-server';\nimport { rateLimit } from '@/lib/rate-limit';\nimport { encryptMessage, decryptMessage, getUserEncryptionKey } from '@/lib/server-encryption';\n\nfunction getClientKey(request: Request, userId: string) {\n  const ip = request.headers.get('x-forwarded-for')?.split(',')[0]?.trim() || 'unknown';\n  return `${userId}:${ip}`;\n}\n\nexport async function GET(request: Request, { params }: { params: Promise<{ id: string }> }) {\n  try {\n    const session = await auth();\n    if (!session?.user?.id) {\n      console.log('Messages GET: Not authenticated');\n      return NextResponse.json({ error: 'Not authenticated' }, { status: 401 });\n    }\n\n    const { id } = await params;\n    const currentUserId = session.user.id;\n    \n    // Get current user's encryption key\n    let currentUserKey: string;\n    try {\n      currentUserKey = await getUserEncryptionKey(currentUserId);\n    } catch (e) {\n      // User doesn't have an encryption key yet - generate one\n      const { createUserEncryptionKey } = await import('@/lib/server-encryption');\n      currentUserKey = await createUserEncryptionKey(currentUserId);\n    }\n    \n    // Get conversation to find other participants\n    const conversation = await prisma.conversation.findUnique({\n      where: { id },\n      include: {\n        participants: {\n          include: {\n            user: { select: { id: true } }\n          }\n        }\n      }\n    });\n    \n    if (!conversation) {\n      return NextResponse.json({ error: 'Conversation not found' }, { status: 404 });\n    }\n    \n    const participant = conversation.participants.find(p => p.userId === currentUserId);\n    if (!participant) {\n      return NextResponse.json({ error: 'Not authorized' }, { status: 403 });\n    }\n\n    // Get all messages\n    const messages = await prisma.message.findMany({\n      where: { conversationId: id },\n      orderBy: { createdAt: 'asc' },\n      select: {\n        id: true,\n        body: true,\n        bodyForSender: true,\n        createdAt: true,\n        senderId: true,\n        sender: { select: { id: true, name: true, username: true } },\n      },\n    });\n\n    // Decrypt messages for current user\n    const decryptedMessages = await Promise.all(messages.map(async (m) => {\n      let decryptedBody = '';\n      \n      // Try to decrypt with current user's key (they might be recipient or sender)\n      if (m.body) {\n        try {\n          decryptedBody = decryptMessage(m.body, currentUserKey);\n        } catch (e) {\n          // If decrypt fails, try the sender copy\n          if (m.bodyForSender) {\n            try {\n              decryptedBody = decryptMessage(m.bodyForSender, currentUserKey);\n            } catch (e2) {\n              // Both fail - return encrypted blob as-is\n              decryptedBody = m.body;\n            }\n          } else {\n            decryptedBody = m.body;\n          }\n        }\n      }\n      \n      return {\n        id: m.id,\n        body: decryptedBody,\n        createdAt: m.createdAt.toISOString(),\n        senderId: m.senderId,\n        sender: m.sender,\n      };\n    }));\n\n    return NextResponse.json({ messages: decryptedMessages });\n  } catch (error) {\n    console.error('Messages GET failed', error);\n    return NextResponse.json({ error: 'Failed to load messages' }, { status: 500 });\n  }\n}\n\nexport async function POST(request: Request, { params }: { params: Promise<{ id: string }> }) {\n  try {\n    const session = await auth();\n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Not authenticated' }, { status: 401 });\n    }\n\n    const rl = rateLimit({ key: `message-send:${getClientKey(request, session.user.id)}`, limit: 60, windowMs: 60_000 });\n    if (!rl.ok) {\n      return NextResponse.json({ error: 'Too many requests' }, { status: 429 });\n    }\n\n    const { id } = await params;\n    const senderId = session.user.id;\n    \n    // Get conversation to find recipient\n    const conversation = await prisma.conversation.findUnique({\n      where: { id },\n      include: {\n        participants: {\n          include: {\n            user: { select: { id: true } }\n          }\n        }\n      }\n    });\n    \n    if (!conversation) {\n      return NextResponse.json({ error: 'Conversation not found' }, { status: 404 });\n    }\n    \n    const participant = conversation.participants.find(p => p.userId === senderId);\n    if (!participant) {\n      return NextResponse.json({ error: 'Not authorized' }, { status: 403 });\n    }\n    \n    // Find the recipient (the other participant)\n    const recipient = conversation.participants.find(p => p.userId !== senderId);\n    if (!recipient) {\n      return NextResponse.json({ error: 'No recipient found' }, { status: 400 });\n    }\n    \n    const recipientId = recipient.userId;\n    const body = await request.json().catch(() => null);\n    const messageText = body?.body;\n    \n    // Validate message body\n    if (!messageText || typeof messageText !== 'string' || messageText.trim().length === 0) {\n      return NextResponse.json({ error: 'Message is required' }, { status: 400 });\n    }\n    \n    if (messageText.length > 12_000) {\n      return NextResponse.json({ error: 'Message too long (max 12000 characters)' }, { status: 400 });\n    }\n    \n    const plaintext = messageText.trim();\n    \n    // Get sender's key\n    let senderKey: string;\n    try {\n      senderKey = await getUserEncryptionKey(senderId);\n    } catch (e) {\n      const { createUserEncryptionKey } = await import('@/lib/server-encryption');\n      senderKey = await createUserEncryptionKey(senderId);\n    }\n    \n    // Get recipient's key\n    let recipientKey: string;\n    try {\n      recipientKey = await getUserEncryptionKey(recipientId);\n    } catch (e) {\n      const { createUserEncryptionKey } = await import('@/lib/server-encryption');\n      recipientKey = await createUserEncryptionKey(recipientId);\n    }\n    \n    // Encrypt message for recipient\n    const encryptedForRecipient = encryptMessage(plaintext, recipientKey);\n    \n    // Encrypt message for sender (so they can read their own messages)\n    const encryptedForSender = encryptMessage(plaintext, senderKey);\n\n    const message = await prisma.message.create({\n      data: {\n        conversationId: id,\n        senderId: session.user.id,\n        body: encryptedForRecipient,\n        bodyForSender: encryptedForSender,\n      },\n      select: {\n        id: true,\n        body: true,\n        createdAt: true,\n        senderId: true,\n        sender: { select: { id: true, name: true, username: true } },\n      },\n    });\n\n    await prisma.conversation.update({\n      where: { id },\n      data: { updatedAt: new Date() },\n    });\n\n    // Return decrypted message to the sender for immediate display\n    const returnMessage = {\n      ...message,\n      body: plaintext,\n      createdAt: message.createdAt.toISOString(),\n    };\n\n    await triggerPusher(`conversation-${id}`, 'new-message', { message: returnMessage });\n\n    return NextResponse.json({ message: returnMessage });\n  } catch (error) {\n    console.error('Messages POST failed', error);\n    return NextResponse.json({ error: 'Failed to send message' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\conversations\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\data-status\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[215,218],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[215,218],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":62,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1474,1477],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1474,1477],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Data Status Page - Shows what's cached and how old the data is\n */\n\nimport { NextResponse } from 'next/server';\nimport sqlite3 from 'sqlite3';\nimport { open } from 'sqlite';\nimport path from 'path';\n\nlet db: any = null;\n\nasync function getDb() {\n  if (!db) {\n    const dbPath = path.join(process.cwd(), 'data', 'aviation_hub.db');\n    db = await open({\n      filename: dbPath,\n      driver: sqlite3.Database\n    });\n  }\n  return db;\n}\n\nexport async function GET() {\n  try {\n    const database = await getDb();\n    \n    // Get fuel cache stats\n    const fuelStats = await database.get(`\n      SELECT \n        COUNT(*) as total,\n        MIN(last_updated) as oldest,\n        MAX(last_updated) as newest,\n        source_site\n      FROM airport_cache \n      WHERE data_type = 'fuel'\n      GROUP BY source_site\n    `);\n    \n    // Get all cached fuel prices with age\n    const fuelPrices = await database.all(`\n      SELECT \n        icao,\n        price,\n        last_updated,\n        source_site\n      FROM airport_cache \n      WHERE data_type = 'fuel'\n      ORDER BY last_updated DESC\n    `);\n    \n    // Get airports by type that have fuel data\n    const airportsWithFuel = await database.all(`\n      SELECT a.type, COUNT(*) as count\n      FROM airports a\n      INNER JOIN airport_cache c ON a.icao = c.icao\n      WHERE c.data_type = 'fuel'\n      GROUP BY a.type\n    `);\n    \n    // Calculate ages\n    const now = new Date();\n    const pricesWithAge = fuelPrices.map((p: any) => {\n      const cached = new Date(p.last_updated);\n      const hoursAgo = Math.floor((now.getTime() - cached.getTime()) / (1000 * 60 * 60));\n      const daysAgo = Math.floor(hoursAgo / 24);\n      \n      let ageDisplay;\n      if (daysAgo > 30) {\n        ageDisplay = `${Math.floor(daysAgo / 30)} months ago`;\n      } else if (daysAgo > 0) {\n        ageDisplay = `${daysAgo} days ago`;\n      } else if (hoursAgo > 0) {\n        ageDisplay = `${hoursAgo} hours ago`;\n      } else {\n        ageDisplay = 'Just now';\n      }\n      \n      return {\n        icao: p.icao,\n        price: p.price,\n        cachedAt: p.last_updated,\n        ageHours: hoursAgo,\n        ageDisplay,\n        source: p.source_site\n      };\n    });\n    \n    // Get total airports count\n    const totalAirports = await database.get(`\n      SELECT \n        SUM(CASE WHEN type = 'large_airport' THEN 1 ELSE 0 END) as large,\n        SUM(CASE WHEN type = 'medium_airport' THEN 1 ELSE 0 END) as medium,\n        SUM(CASE WHEN type = 'small_airport' THEN 1 ELSE 0 END) as small,\n        COUNT(*) as total\n      FROM airports\n    `);\n    \n    return NextResponse.json({\n      summary: {\n        totalAirports: totalAirports,\n        totalFuelCached: fuelPrices.length,\n        airportsWithFuel: airportsWithFuel,\n        lastUpdate: fuelStats?.newest || null,\n        nextUpdate: fuelStats?.newest ? \n          new Date(new Date(fuelStats.newest).getTime() + 72 * 60 * 60 * 1000).toISOString() : null,\n        updateInterval: '72 hours'\n      },\n      fuelPrices: pricesWithAge\n    });\n    \n  } catch (error) {\n    console.error('Error fetching data status:', error);\n    return NextResponse.json({ error: 'Failed to fetch data status' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\debug-aircraft\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[428,431],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[428,431],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\"\nimport { PrismaClient } from \"@prisma/client\"\n\nconst prisma = new PrismaClient()\n\nexport const dynamic = 'force-dynamic'\n\nexport async function GET() {\n  try {\n    // Try to get table info via raw query\n    const result = await prisma.$queryRaw`SELECT TOP 5 * FROM AircraftMaster`\n    \n    return NextResponse.json({ \n      success: true, \n      data: result \n    })\n  } catch (error: any) {\n    return NextResponse.json({ \n      error: error.message || String(error),\n      hint: \"Table may not exist\"\n    }, { status: 500 })\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\debug\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":19,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[489,492],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[489,492],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\"\nimport { auth } from '@/lib/auth';\nimport { PrismaClient } from \"@prisma/client\"\n\nconst prisma = new PrismaClient({\n  log: [\"error\"],\n})\n\nexport const dynamic = 'force-dynamic'\nexport const runtime = 'nodejs'\n\nexport async function GET() {\n  try {\n    if (process.env.NODE_ENV === 'production') {\n      return NextResponse.json({ error: 'Not found' }, { status: 404 });\n    }\n\n    const session = await auth();\n    const role = (session?.user as any)?.role;\n    if (!session?.user?.id || (role !== 'owner' && role !== 'admin')) {\n      return NextResponse.json({ error: 'Not found' }, { status: 404 });\n    }\n\n    console.log(\"Testing database connection...\")\n    \n    // Try to count users\n    const userCount = await prisma.user.count()\n    console.log(\"User count:\", userCount)\n    \n    // Get all users (limited)\n    const users = await prisma.user.findMany({\n      select: { id: true, email: true, name: true, password: true },\n      take: 5\n    })\n    console.log(\"Users found:\", users.length)\n    \n    return NextResponse.json({\n      success: true,\n      userCount,\n      users: users.map(u => ({\n        id: u.id,\n        email: u.email,\n        name: u.name,\n        hasPassword: !!u.password\n      }))\n    })\n  } catch (error) {\n    console.error(\"Debug error:\", error)\n    return NextResponse.json({\n      success: false,\n      error: error instanceof Error ? error.message : String(error)\n    }, { status: 500 })\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\e2ee\\public-key\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\endorsements\\requests\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\endorsements\\sign\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\endorsements\\templates\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\engine\\anomalies\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":20,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[690,693],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[690,693],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { auth } from '@/lib/auth'\nimport { prisma } from '@/lib/prisma'\n\n// GET /api/engine/anomalies\n// Get engine anomalies for user's aircraft\nexport async function GET(request: NextRequest) {\n  try {\n    const session = await auth()\n    \n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n    \n    const { searchParams } = new URL(request.url)\n    const aircraftId = searchParams.get('aircraftId')\n    const severity = searchParams.get('severity') // CRITICAL, WARNING, INFO\n    const acknowledged = searchParams.get('acknowledged') // true, false\n    \n    const where: any = {\n      userId: session.user.id,\n    }\n    \n    if (aircraftId) {\n      where.aircraftId = aircraftId\n    }\n    \n    if (severity) {\n      where.severity = severity\n    }\n    \n    if (acknowledged !== null) {\n      where.acknowledged = acknowledged === 'true'\n    }\n    \n    const anomalies = await prisma.engineAnomaly.findMany({\n      where,\n      orderBy: { createdAt: 'desc' },\n      take: 50,\n    })\n    \n    // Get counts by severity\n    const counts = await prisma.engineAnomaly.groupBy({\n      by: ['severity', 'acknowledged'],\n      where: {\n        userId: session.user.id,\n        aircraftId: aircraftId || undefined,\n      },\n      _count: true,\n    })\n    \n    return NextResponse.json({\n      anomalies,\n      counts: {\n        critical: counts.find(c => c.severity === 'CRITICAL' && !c.acknowledged)?._count || 0,\n        warning: counts.find(c => c.severity === 'WARNING' && !c.acknowledged)?._count || 0,\n        info: counts.find(c => c.severity === 'INFO' && !c.acknowledged)?._count || 0,\n      }\n    })\n  } catch (error) {\n    console.error('Error fetching anomalies:', error)\n    return NextResponse.json({ error: 'Failed to fetch anomalies' }, { status: 500 })\n  }\n}\n\n// PATCH /api/engine/anomalies\n// Acknowledge an anomaly\nexport async function PATCH(request: NextRequest) {\n  try {\n    const session = await auth()\n    \n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n    \n    const body = await request.json()\n    const { anomalyId, acknowledge } = body\n    \n    if (!anomalyId) {\n      return NextResponse.json({ error: 'anomalyId required' }, { status: 400 })\n    }\n    \n    const anomaly = await prisma.engineAnomaly.update({\n      where: { id: anomalyId },\n      data: {\n        acknowledged: acknowledge,\n        acknowledgedBy: session.user.id,\n        acknowledgedAt: acknowledge ? new Date() : null,\n      }\n    })\n    \n    return NextResponse.json(anomaly)\n  } catch (error) {\n    console.error('Error updating anomaly:', error)\n    return NextResponse.json({ error: 'Failed to update anomaly' }, { status: 500 })\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\engine\\upload\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":66,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1952,1955],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1952,1955],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":117,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":117,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3459,3462],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3459,3462],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { auth } from '@/lib/auth'\nimport { prisma } from '@/lib/prisma'\nimport { detectFileType, parseCSV, validateEngineData } from '@/lib/engine/parser'\nimport { detectAnomalies, DEFAULT_THRESHOLDS } from '@/lib/engine/anomaly-detection'\n\n// POST /api/engine/upload\n// Upload engine monitoring data\nexport async function POST(request: NextRequest) {\n  try {\n    const session = await auth()\n    \n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n    \n    const formData = await request.formData()\n    const file = formData.get('file') as File | null\n    const aircraftId = formData.get('aircraftId') as string | null\n    \n    if (!file) {\n      return NextResponse.json({ error: 'No file provided' }, { status: 400 })\n    }\n    \n    if (!aircraftId) {\n      return NextResponse.json({ error: 'aircraftId is required' }, { status: 400 })\n    }\n    \n    // Read file content\n    const content = await file.text()\n    \n    // Detect file type\n    const fileType = detectFileType(content, file.name)\n    \n    // Parse based on type\n    let parsedData\n    try {\n      parsedData = parseCSV(content)\n    } catch (error) {\n      console.error('Parse error:', error)\n      return NextResponse.json({ error: 'Failed to parse file' }, { status: 400 })\n    }\n    \n    // Validate data\n    const { valid, errors } = validateEngineData(parsedData)\n    \n    if (valid.length === 0) {\n      return NextResponse.json({ \n        error: 'No valid data found in file',\n        details: errors \n      }, { status: 400 })\n    }\n    \n    // Create upload record\n    const upload = await prisma.engineDataUpload.create({\n      data: {\n        aircraftId,\n        userId: session.user.id,\n        fileName: file.name,\n        fileType,\n        data: JSON.stringify(valid),\n      }\n    })\n    \n    // Detect anomalies for each flight\n    const allAnomalies: any[] = []\n    \n    for (const flightData of valid) {\n      const anomalies = detectAnomalies(flightData, DEFAULT_THRESHOLDS)\n      \n      for (const anomaly of anomalies) {\n        const createdAnomaly = await prisma.engineAnomaly.create({\n          data: {\n            aircraftId,\n            userId: session.user.id,\n            uploadId: upload.id,\n            flightDate: flightData.flightDate,\n            type: anomaly.type,\n            severity: anomaly.severity,\n            value: anomaly.value,\n            threshold: anomaly.threshold,\n            message: anomaly.message,\n          }\n        })\n        allAnomalies.push(createdAnomaly)\n      }\n    }\n    \n    return NextResponse.json({\n      success: true,\n      uploadId: upload.id,\n      flightsProcessed: valid.length,\n      anomaliesFound: allAnomalies.length,\n      anomalies: allAnomalies.slice(0, 10), // Return first 10\n      errors: errors.slice(0, 5), // Return first 5 errors\n    })\n    \n  } catch (error) {\n    console.error('Engine upload error:', error)\n    return NextResponse.json({ error: 'Upload failed' }, { status: 500 })\n  }\n}\n\n// GET /api/engine/upload\n// Get user's engine uploads\nexport async function GET(request: NextRequest) {\n  try {\n    const session = await auth()\n    \n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n    \n    const { searchParams } = new URL(request.url)\n    const aircraftId = searchParams.get('aircraftId')\n    \n    const where: any = {\n      userId: session.user.id,\n    }\n    \n    if (aircraftId) {\n      where.aircraftId = aircraftId\n    }\n    \n    const uploads = await prisma.engineDataUpload.findMany({\n      where,\n      orderBy: { uploadDate: 'desc' },\n      take: 20,\n    })\n    \n    return NextResponse.json(uploads)\n  } catch (error) {\n    console.error('Error fetching uploads:', error)\n    return NextResponse.json({ error: 'Failed to fetch uploads' }, { status: 500 })\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\error-report\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\faa\\aircraft\\[nNumber]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":33,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[982,985],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[982,985],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'code' is defined but never used.","line":85,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":85,"endColumn":31}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\n\n// FAA API endpoint for aircraft registration lookup\nconst FAA_REGISTRY_URL = 'https://registry.faa.gov/aircraftinquiry/api/v1/nnumber';\n\n/**\n * Fetch aircraft registration data from FAA\n * N-number should be provided without the 'N' prefix (e.g., \"123AB\" for N123AB)\n */\nasync function fetchFAAData(nNumber: string): Promise<FAAAircraftData | null> {\n  try {\n    const normalized = nNumber.toUpperCase().replace(/^N/i, '').trim();\n    \n    const response = await fetch(`${FAA_REGISTRY_URL}/${normalized}`, {\n      headers: {\n        'Accept': 'application/json',\n      },\n    });\n\n    if (!response.ok) {\n      console.error('FAA API error:', response.status, response.statusText);\n      return null;\n    }\n\n    const data = await response.json();\n    \n    // Check if we got valid data\n    if (!data || !data.results || data.results.length === 0) {\n      return null;\n    }\n\n    const result = data.results[0];\n    const r = result as any;\n    \n    return {\n      nNumber: `N${r.nNumber || normalized}`,\n      serialNumber: r.serialNumber || null,\n      manufacturer: r.mfrModelCode ? getManufacturerFromCode(r.mfrModelCode) : null,\n      model: r.mfrModelCode ? getModelFromCode(r.mfrModelCode) : null,\n      year: r.yearMfr ? parseInt(r.yearMfr) : null,\n      category: r.aircraftType || null,\n      engineType: r.engineType || null,\n      registrationStatus: r.statusCode || null,\n      ownerName: r.name || null,\n      ownerCity: r.city || null,\n      ownerState: r.state || null,\n      expirationDate: r.expirationDate || null,\n    };\n  } catch (error) {\n    console.error('FAA fetch error:', error);\n    return null;\n  }\n}\n\n// Helper functions to parse FAA codes (simplified - FAA uses codes for efficiency)\nfunction getManufacturerFromCode(code: string): string | null {\n  // Common manufacturer codes\n  const codes: Record<string, string> = {\n    'CESSNA': 'Cessna',\n    'PIPER': 'Piper',\n    'BEECH': 'Beechcraft',\n    'BOEING': 'Boeing',\n    'AIRBUS': 'Airbus',\n    'LOCKHEED': 'Lockheed',\n    'BELL': 'Bell',\n    'ROBINSON': 'Robinson',\n    'MOONEY': 'Mooney',\n    'GRUMMAN': 'Grumman',\n    'AERO': 'Aero',\n    'CHAMPION': 'Champion',\n    'MAULE': 'Maule',\n    'AYRES': 'Ayres',\n  };\n  \n  // Try to match prefix\n  for (const [key, value] of Object.entries(codes)) {\n    if (code.toUpperCase().startsWith(key)) {\n      return value;\n    }\n  }\n  \n  return null;\n}\n\nfunction getModelFromCode(code: string): string | null {\n  // This would need a full database for accurate mapping\n  // For now, return null and let user fill in\n  return null;\n}\n\ninterface FAAAircraftData {\n  nNumber: string;\n  serialNumber: string | null;\n  manufacturer: string | null;\n  model: string | null;\n  year: number | null;\n  category: string | null;\n  engineType: string | null;\n  registrationStatus: string | null;\n  ownerName: string | null;\n  ownerCity: string | null;\n  ownerState: string | null;\n  expirationDate: string | null;\n}\n\nexport async function GET(\n  request: Request,\n  { params }: { params: Promise<{ nNumber: string }> }\n) {\n  try {\n    const { nNumber } = await params;\n    \n    if (!nNumber || nNumber.length < 1 || nNumber.length > 5) {\n      return NextResponse.json(\n        { error: 'Invalid N-number. Must be 1-5 characters.' },\n        { status: 400 }\n      );\n    }\n\n    const faaData = await fetchFAAData(nNumber);\n    \n    if (!faaData) {\n      return NextResponse.json(\n        { error: 'Aircraft not found in FAA registry' },\n        { status: 404 }\n      );\n    }\n\n    return NextResponse.json({\n      success: true,\n      data: faaData,\n    });\n  } catch (error) {\n    console.error('FAA lookup error:', error);\n    return NextResponse.json(\n      { error: 'Failed to lookup aircraft' },\n      { status: 500 }\n    );\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\fbo-fees\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[140,143],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[140,143],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1218,1221],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1218,1221],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport sqlite3 from 'sqlite3';\nimport { open } from 'sqlite';\nimport path from 'path';\n\nlet db: any = null;\n\nasync function getDb() {\n  if (!db) {\n    const dbPath = path.join(process.cwd(), 'data', 'aviation_hub.db');\n    db = await open({\n      filename: dbPath,\n      driver: sqlite3.Database\n    });\n  }\n  return db;\n}\n\nexport async function GET(request: Request) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const icao = searchParams.get('icao')?.toUpperCase();\n    \n    if (!icao) {\n      return NextResponse.json({ error: 'ICAO code required' }, { status: 400 });\n    }\n    \n    const database = await getDb();\n    \n    // Get FBO fees from database\n    const fees = await database.all(`\n      SELECT icao, fbo_name, ramp_fee, overnight_fee, handling_fee, \n             fuel_minimum, credit_card_fee, callahead_required, phone, amenities, last_updated\n      FROM fbo_fees\n      WHERE icao = ?\n    `, icao);\n    \n    if (!fees || fees.length === 0) {\n      return NextResponse.json({\n        icao,\n        fbos: [],\n        note: 'No FBO fee data available. Contribute fees to help other pilots!'\n      });\n    }\n    \n    const fbos = fees.map((f: any) => ({\n      name: f.fbo_name,\n      rampFee: f.ramp_fee,\n      overnightFee: f.overnight_fee,\n      handlingFee: f.handling_fee,\n      fuelMinimum: f.fuel_minimum,\n      creditCardFee: f.credit_card_fee,\n      callAheadRequired: f.callahead_required === 1,\n      phone: f.phone,\n      amenities: f.amenities ? JSON.parse(f.amenities) : {},\n      lastUpdated: f.last_updated\n    }));\n    \n    return NextResponse.json({\n      icao,\n      fbos\n    });\n    \n  } catch (error) {\n    console.error('Error fetching FBO fees:', error);\n    return NextResponse.json({ error: 'Failed to fetch FBO fees' }, { status: 500 });\n  }\n}\n\n// POST - Submit new FBO fee data\nexport async function POST(request: Request) {\n  try {\n    const body = await request.json();\n    const { icao, fboName, rampFee, overnightFee, handlingFee, fuelMinimum, phone, amenities } = body;\n    \n    if (!icao || !fboName) {\n      return NextResponse.json({ error: 'ICAO and FBO name required' }, { status: 400 });\n    }\n    \n    const database = await getDb();\n    \n    await database.run(`\n      INSERT OR REPLACE INTO fbo_fees \n      (icao, fbo_name, ramp_fee, overnight_fee, handling_fee, fuel_minimum, phone, amenities, source)\n      VALUES (?, ?, ?, ?, ?, ?, ?, ?, 'user')\n    `, \n      icao.toUpperCase(),\n      fboName,\n      rampFee || null,\n      overnightFee || null,\n      handlingFee || null,\n      fuelMinimum || null,\n      phone || null,\n      amenities ? JSON.stringify(amenities) : null\n    );\n    \n    return NextResponse.json({\n      success: true,\n      message: 'FBO fee data submitted. Thanks for contributing!'\n    });\n    \n  } catch (error) {\n    console.error('Error saving FBO fees:', error);\n    return NextResponse.json({ error: 'Failed to save FBO fees' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\fix-passwords\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":18,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[497,500],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[497,500],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\"\nimport { auth } from '@/lib/auth';\nimport { PrismaClient } from \"@prisma/client\"\nimport bcrypt from \"bcrypt\"\n\nconst prisma = new PrismaClient()\n\nexport const dynamic = 'force-dynamic'\nexport const runtime = 'nodejs'\n\nexport async function POST() {\n  try {\n    if (process.env.NODE_ENV === 'production') {\n      return NextResponse.json({ error: 'Not found' }, { status: 404 });\n    }\n\n    const session = await auth();\n    const role = (session?.user as any)?.role;\n    if (!session?.user?.id || (role !== 'owner' && role !== 'admin')) {\n      return NextResponse.json({ error: 'Not found' }, { status: 404 });\n    }\n\n    const users = await prisma.user.findMany({\n      where: {\n        password: {\n          not: \"\"\n        }\n      }\n    })\n    \n    let fixed = 0\n    let alreadyHashed = 0\n    \n    for (const user of users) {\n      const pwd = user.password!\n      \n      // Check if already a bcrypt hash (starts with $2)\n      if (pwd.startsWith('$2')) {\n        alreadyHashed++\n        continue\n      }\n      \n      // Hash the plain text password\n      const hashed = await bcrypt.hash(pwd, 10)\n      \n      await prisma.user.update({\n        where: { id: user.id },\n        data: { password: hashed }\n      })\n      \n      fixed++\n      console.log(`Fixed password for ${user.email}`)\n    }\n    \n    return NextResponse.json({\n      success: true,\n      fixed,\n      alreadyHashed,\n      total: users.length\n    })\n  } catch (error) {\n    console.error(\"Fix error:\", error)\n    return NextResponse.json({ error: String(error) }, { status: 500 })\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\flight-plans\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":104,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":104,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3117,3120],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3117,3120],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":251,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":251,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7651,7654],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7651,7654],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":266,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":266,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8109,8112],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8109,8112],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth } from '@/lib/auth';\nimport { prisma } from '@/lib/auth';\n\n// GET - Fetch user's flight plans\nexport async function GET() {\n  try {\n    const session = await auth();\n    \n    if (!session?.user?.id) {\n      // Return empty list if not logged in\n      return NextResponse.json({ flightPlans: [], message: 'Not authenticated' });\n    }\n\n    const flightPlans = await prisma.flightPlan.findMany({\n      where: { userId: session.user.id },\n      include: { waypoints: { orderBy: { sequence: 'asc' } } },\n      orderBy: { createdAt: 'desc' },\n    });\n\n    return NextResponse.json({ flightPlans });\n  } catch (error) {\n    console.error('Error fetching flight plans:', error);\n    return NextResponse.json({ error: 'Failed to fetch flight plans' }, { status: 500 });\n  }\n}\n\n// POST - Create new flight plan\nexport async function POST(request: Request) {\n  try {\n    const session = await auth();\n    \n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Not authenticated' }, { status: 401 });\n    }\n\n    // Check if email is verified\n    const user = await prisma.user.findUnique({\n      where: { id: session.user.id },\n      select: { emailVerified: true, email: true }\n    });\n\n    if (!user?.emailVerified) {\n      return NextResponse.json({ \n        error: 'Please verify your email before saving flight plans',\n        code: 'EMAIL_NOT_VERIFIED'\n      }, { status: 403 });\n    }\n\n    const body = await request.json();\n    \n    const {\n      name,\n      callsign,\n      aircraftType,\n      aircraftSpeed,\n      aircraftBurnRate,\n      aircraftFuelCapacity,\n      pilotName,\n      departureTime,\n      cruisingAlt,\n      alternateIcao,\n      remarks,\n      soulsOnBoard,\n      departureIcao,\n      arrivalIcao,\n      departureFuel,\n      waypoints,\n    } = body;\n\n    const planName = name || `Flight Plan ${new Date().toLocaleDateString()}`;\n    \n    // Check for duplicate name\n    const duplicateName = await prisma.flightPlan.findFirst({\n      where: { \n        userId: session.user.id,\n        name: planName\n      },\n    });\n    if (duplicateName) {\n      return NextResponse.json({ error: 'A flight plan with this name already exists' }, { status: 400 });\n    }\n\n    // Create flight plan with waypoints in a transaction\n    const flightPlan = await prisma.flightPlan.create({\n      data: {\n        userId: session.user.id,\n        name: planName,\n        callsign,\n        aircraftType,\n        aircraftSpeed: typeof aircraftSpeed === 'number' ? Math.max(0, Math.round(aircraftSpeed)) : null,\n        aircraftBurnRate: typeof aircraftBurnRate === 'number' ? Math.max(0, aircraftBurnRate) : null,\n        aircraftFuelCapacity: typeof aircraftFuelCapacity === 'number' ? Math.max(0, Math.round(aircraftFuelCapacity)) : null,\n        pilotName,\n        departureTime: departureTime ? new Date(departureTime) : null,\n        departureFuel,\n        cruisingAlt,\n        arrivalIcao,\n        alternateIcao,\n        remarks,\n        soulsOnBoard,\n        departureIcao,\n        waypoints: waypoints ? {\n          create: waypoints.map((wp: any, index: number) => ({\n            sequence: index,\n            icao: wp.icao,\n            name: wp.name,\n            city: wp.city,\n            latitude: wp.latitude,\n            longitude: wp.longitude,\n            altitude: wp.altitude,\n          }))\n        } : undefined,\n      },\n      include: { waypoints: { orderBy: { sequence: 'asc' } } },\n    });\n\n    return NextResponse.json({ flightPlan, message: 'Flight plan saved' });\n  } catch (error) {\n    console.error('Error creating flight plan:', error);\n    return NextResponse.json({ error: 'Failed to create flight plan' }, { status: 500 });\n  }\n}\n\n// DELETE - Delete a flight plan\nexport async function DELETE(request: Request) {\n  try {\n    const session = await auth();\n    \n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Not authenticated' }, { status: 401 });\n    }\n\n    const { searchParams } = new URL(request.url);\n    const id = searchParams.get('id');\n\n    if (!id) {\n      return NextResponse.json({ error: 'Flight plan ID required' }, { status: 400 });\n    }\n\n    // Only delete if it belongs to the user\n    await prisma.flightPlan.deleteMany({\n      where: { id, userId: session.user.id },\n    });\n\n    return NextResponse.json({ message: 'Flight plan deleted' });\n  } catch (error) {\n    console.error('Error deleting flight plan:', error);\n    return NextResponse.json({ error: 'Failed to delete flight plan' }, { status: 500 });\n  }\n}\n\n// PUT - Update a flight plan\nexport async function PUT(request: Request) {\n  try {\n    const session = await auth();\n    \n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Not authenticated' }, { status: 401 });\n    }\n\n    // Check if email is verified\n    const user = await prisma.user.findUnique({\n      where: { id: session.user.id },\n      select: { emailVerified: true, email: true }\n    });\n\n    if (!user?.emailVerified) {\n      return NextResponse.json({ \n        error: 'Please verify your email before saving flight plans',\n        code: 'EMAIL_NOT_VERIFIED'\n      }, { status: 403 });\n    }\n\n    const { searchParams } = new URL(request.url);\n    const id = searchParams.get('id');\n\n    if (!id) {\n      return NextResponse.json({ error: 'Flight plan ID required' }, { status: 400 });\n    }\n\n    const body = await request.json();\n    \n    const {\n      name,\n      callsign,\n      aircraftType,\n      aircraftSpeed,\n      aircraftBurnRate,\n      aircraftFuelCapacity,\n      pilotName,\n      departureTime,\n      cruisingAlt,\n      alternateIcao,\n      remarks,\n      soulsOnBoard,\n      departureIcao,\n      arrivalIcao,\n      departureFuel,\n      waypoints,\n    } = body;\n\n    // First check if the plan exists and belongs to the user\n    const existingPlan = await prisma.flightPlan.findFirst({\n      where: { id, userId: session.user.id },\n    });\n    \n    if (!existingPlan) {\n      return NextResponse.json({ error: 'Flight plan not found or not owned by user' }, { status: 404 });\n    }\n\n    // Check for duplicate name (but allow the same name if it's the same plan)\n    if (name && name !== existingPlan.name) {\n      const duplicateName = await prisma.flightPlan.findFirst({\n        where: { \n          userId: session.user.id,\n          name: name,\n          id: { not: id } // exclude current plan\n        },\n      });\n      if (duplicateName) {\n        return NextResponse.json({ error: 'A flight plan with this name already exists' }, { status: 400 });\n      }\n    }\n\n    // Delete existing waypoints\n    await prisma.flightPlanWaypoint.deleteMany({\n      where: { flightPlanId: id },\n    });\n\n    // Then update the flight plan with new waypoints\n    const flightPlan = await prisma.flightPlan.update({\n      where: { id, userId: session.user.id },\n      data: {\n        name: name || `Flight Plan ${new Date().toLocaleDateString()}`,\n        callsign,\n        aircraftType,\n        aircraftSpeed: typeof aircraftSpeed === 'number' ? Math.max(0, Math.round(aircraftSpeed)) : null,\n        aircraftBurnRate: typeof aircraftBurnRate === 'number' ? Math.max(0, aircraftBurnRate) : null,\n        aircraftFuelCapacity: typeof aircraftFuelCapacity === 'number' ? Math.max(0, Math.round(aircraftFuelCapacity)) : null,\n        pilotName,\n        departureTime: departureTime ? new Date(departureTime) : null,\n        departureFuel,\n        cruisingAlt,\n        arrivalIcao,\n        alternateIcao,\n        remarks,\n        soulsOnBoard,\n        departureIcao,\n        waypoints: waypoints && waypoints.length > 0 ? {\n          create: waypoints.map((wp: any, index: number) => ({\n            sequence: index,\n            icao: wp.icao,\n            name: wp.name,\n            city: wp.city,\n            latitude: wp.latitude,\n            longitude: wp.longitude,\n            altitude: wp.altitude,\n          }))\n        } : undefined,\n      },\n      include: { waypoints: { orderBy: { sequence: 'asc' } } },\n    });\n\n    return NextResponse.json({ flightPlan, message: 'Flight plan updated' });\n  } catch (error: any) {\n    console.error('Error updating flight plan:', error);\n    console.error('Error message:', error.message);\n    console.error('Error code:', error.code);\n    return NextResponse.json({ error: 'Failed to update flight plan: ' + (error.message || 'Unknown error') }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\flight-tracks\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrackPoint' is defined but never used.","line":5,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth } from '@/lib/auth';\nimport { prisma } from '@/lib/auth';\n\ninterface TrackPoint {\n  lat: number;\n  lng: number;\n  alt?: number;\n  speed?: number;\n  timestamp: string;\n}\n\n// GET - Fetch user's flight tracks (list or single track with full data)\nexport async function GET(request: Request) {\n  try {\n    const session = await auth();\n    const { searchParams } = new URL(request.url);\n    const trackId = searchParams.get('id');\n    \n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Not authenticated' }, { status: 401 });\n    }\n\n    // Check if user has Pro+ tier\n    const user = await prisma.user.findUnique({\n      where: { id: session.user.id },\n      select: { tier: true }\n    });\n\n    if (user?.tier !== 'proplus') {\n      return NextResponse.json({ \n        error: 'Pro+ subscription required',\n        code: 'PROPLUS_REQUIRED'\n      }, { status: 403 });\n    }\n\n    // If requesting a specific track, return full data\n    if (trackId) {\n      const track = await prisma.flightTrack.findFirst({\n        where: { id: trackId, userId: session.user.id },\n      });\n\n      if (!track) {\n        return NextResponse.json({ error: 'Track not found' }, { status: 404 });\n      }\n\n      return NextResponse.json({ track });\n    }\n\n    // Otherwise return list of tracks\n    const tracks = await prisma.flightTrack.findMany({\n      where: { userId: session.user.id },\n      orderBy: { date: 'desc' },\n      select: {\n        id: true,\n        name: true,\n        date: true,\n        aircraft: true,\n        totalDistance: true,\n        maxAltitude: true,\n        maxSpeed: true,\n        duration: true,\n        createdAt: true,\n      },\n    });\n\n    return NextResponse.json({ tracks });\n  } catch (error) {\n    console.error('Error fetching flight tracks:', error);\n    return NextResponse.json({ error: 'Failed to fetch tracks' }, { status: 500 });\n  }\n}\n\n// POST - Save a new flight track\nexport async function POST(request: Request) {\n  try {\n    const session = await auth();\n    \n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Not authenticated' }, { status: 401 });\n    }\n\n    // Check if user has Pro+ tier\n    const user = await prisma.user.findUnique({\n      where: { id: session.user.id },\n      select: { tier: true, emailVerified: true }\n    });\n\n    if (!user?.emailVerified) {\n      return NextResponse.json({ \n        error: 'Please verify your email first',\n        code: 'EMAIL_NOT_VERIFIED'\n      }, { status: 403 });\n    }\n\n    if (user?.tier !== 'proplus') {\n      return NextResponse.json({ \n        error: 'Pro+ subscription required',\n        code: 'PROPLUS_REQUIRED'\n      }, { status: 403 });\n    }\n\n    const body = await request.json();\n    \n    const { name, date, aircraft, trackData } = body;\n\n    if (!trackData || !Array.isArray(trackData) || trackData.length < 2) {\n      return NextResponse.json({ error: 'Valid track data required (at least 2 points)' }, { status: 400 });\n    }\n\n    // Calculate statistics from track data\n    let totalDistance = 0;\n    let maxAltitude = 0;\n    let maxSpeed = 0;\n\n    for (let i = 1; i < trackData.length; i++) {\n      const prev = trackData[i - 1];\n      const curr = trackData[i];\n      \n      // Calculate distance using Haversine formula (in nautical miles)\n      const R = 3440.065; // Earth radius in NM\n      const dLat = (curr.lat - prev.lat) * Math.PI / 180;\n      const dLng = (curr.lng - prev.lng) * Math.PI / 180;\n      const a = Math.sin(dLat/2) * Math.sin(dLat/2) +\n                Math.cos(prev.lat * Math.PI / 180) * Math.cos(curr.lat * Math.PI / 180) *\n                Math.sin(dLng/2) * Math.sin(dLng/2);\n      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));\n      totalDistance += R * c;\n\n      // Track max altitude\n      if (curr.alt && curr.alt > maxAltitude) {\n        maxAltitude = curr.alt;\n      }\n\n      // Track max speed\n      if (curr.speed && curr.speed > maxSpeed) {\n        maxSpeed = curr.speed;\n      }\n    }\n\n    // Calculate duration in minutes\n    let duration = 0;\n    if (trackData.length > 1) {\n      const firstTime = new Date(trackData[0].timestamp).getTime();\n      const lastTime = new Date(trackData[trackData.length - 1].timestamp).getTime();\n      duration = (lastTime - firstTime) / 60000; // Convert ms to minutes\n    }\n\n    const track = await prisma.flightTrack.create({\n      data: {\n        userId: session.user.id,\n        name: name || 'Flight Track',\n        date: date ? new Date(date) : new Date(),\n        aircraft: aircraft || 'Unknown',\n        trackData: JSON.stringify(trackData),\n        totalDistance: Math.round(totalDistance * 10) / 10,\n        maxAltitude: Math.round(maxAltitude),\n        maxSpeed: Math.round(maxSpeed),\n        duration: Math.round(duration),\n      },\n    });\n\n    return NextResponse.json({ track, message: 'Track saved' });\n  } catch (error) {\n    console.error('Error saving flight track:', error);\n    return NextResponse.json({ error: 'Failed to save track' }, { status: 500 });\n  }\n}\n\n// DELETE - Delete a flight track\nexport async function DELETE(request: Request) {\n  try {\n    const session = await auth();\n    \n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Not authenticated' }, { status: 401 });\n    }\n\n    const { searchParams } = new URL(request.url);\n    const id = searchParams.get('id');\n\n    if (!id) {\n      return NextResponse.json({ error: 'Track ID required' }, { status: 400 });\n    }\n\n    await prisma.flightTrack.deleteMany({\n      where: { id, userId: session.user.id },\n    });\n\n    return NextResponse.json({ message: 'Track deleted' });\n  } catch (error) {\n    console.error('Error deleting flight track:', error);\n    return NextResponse.json({ error: 'Failed to delete track' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\flying-club\\maintenance\\queue\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'neededBy' is assigned a value but never used.","line":54,"column":53,"nodeType":"Identifier","messageId":"unusedVar","endLine":54,"endColumn":61},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'jobSize' is assigned a value but never used.","line":54,"column":63,"nodeType":"Identifier","messageId":"unusedVar","endLine":54,"endColumn":70},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'allowTailNumber' is assigned a value but never used.","line":54,"column":72,"nodeType":"Identifier","messageId":"unusedVar","endLine":54,"endColumn":87}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server'\nimport { auth, prisma } from '@/lib/auth'\n\nasync function hasMaintenanceAccess(userId: string, groupId: string) {\n  const member = await prisma.groupMember.findUnique({\n    where: { userId_groupId: { userId, groupId } },\n  })\n\n  if (member?.role === 'ADMIN' || member?.role === 'OWNER') return true\n\n  const settings = await prisma.groupMemberSettings.findUnique({\n    where: { userId_groupId: { userId, groupId } },\n  })\n\n  return settings?.maintenanceRole === 'MAINTENANCE_MANAGER'\n}\n\nexport async function GET(request: Request) {\n  try {\n    const session = await auth()\n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    const url = new URL(request.url)\n    const groupId = url.searchParams.get('groupId')\n    if (!groupId) {\n      return NextResponse.json({ error: 'Group required' }, { status: 400 })\n    }\n\n    if (!await hasMaintenanceAccess(session.user.id, groupId)) {\n      return NextResponse.json({ error: 'Forbidden' }, { status: 403 })\n    }\n\n    const queue = await prisma.$queryRaw`\n      SELECT TOP 200 * FROM Maintenance WHERE groupId = ${groupId} ORDER BY reportedDate DESC\n    `\n\n    return NextResponse.json({ queue })\n  } catch (error) {\n    console.error('Failed to load maintenance queue', error)\n    return NextResponse.json({ error: 'Failed to load maintenance queue' }, { status: 500 })\n  }\n}\n\nexport async function POST(request: Request) {\n  try {\n    const session = await auth()\n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    const body = await request.json()\n    const { description, aircraftLabel, isGrounded, neededBy, jobSize, allowTailNumber, groupId } = body || {}\n\n    if (!description || !groupId) {\n      return NextResponse.json({ error: 'Missing fields' }, { status: 400 })\n    }\n\n    await prisma.$executeRaw`\n      INSERT INTO Maintenance (id, aircraftId, userId, groupId, description, notes, status, isGrounded, reportedDate, createdAt, updatedAt)\n      VALUES (NEWID(), NULL, ${session.user.id}, ${groupId}, ${description}, ${aircraftLabel || null}, 'NEEDED', ${isGrounded ? 1 : 0}, GETDATE(), GETDATE(), GETDATE())\n    `\n\n    return NextResponse.json({ success: true })\n  } catch (error) {\n    console.error('Failed to add to maintenance queue', error)\n    return NextResponse.json({ error: 'Failed to add to queue' }, { status: 500 })\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\friends\\requests\\[id]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\friends\\requests\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\friends\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\friends\\with-status\\route.ts","messages":[{"ruleId":"prefer-const","severity":2,"message":"'onlineStatusMap' is never reassigned. Use 'const' instead.","line":40,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":40,"endColumn":88,"fix":{"range":[1068,1157],"text":"const onlineStatusMap: Record<string, { isOnline: boolean; lastSeenAt: Date | null }> = {};"}},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":59,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":59,"endColumn":15}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth, prisma } from '@/lib/auth';\n\nexport async function GET() {\n  try {\n    const session = await auth();\n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Not authenticated' }, { status: 401 });\n    }\n\n    const userId = session.user.id;\n\n    // Get accepted friend requests\n    const friendRequests = await prisma.friendRequest.findMany({\n      where: {\n        status: 'accepted',\n        OR: [\n          { requesterId: userId },\n          { recipientId: userId },\n        ],\n      },\n      include: {\n        requester: {\n          select: { id: true, name: true, username: true, image: true },\n        },\n        recipient: {\n          select: { id: true, name: true, username: true, image: true },\n        },\n      },\n    });\n\n    // Transform to get friend user objects\n    const friendUsers = friendRequests.map(f => \n      f.requesterId === userId ? f.recipient : f.requester\n    );\n\n    // Get online status for all friends\n    const friendIds = friendUsers.map(u => u.id);\n    \n    let onlineStatusMap: Record<string, { isOnline: boolean; lastSeenAt: Date | null }> = {};\n    \n    try {\n      // Get all presences for friends (both online and offline)\n      const allPresences = await prisma.userPresence.findMany({\n        where: { userId: { in: friendIds } },\n        select: {\n          userId: true,\n          isOnline: true,\n          lastSeenAt: true,\n        },\n      });\n\n      for (const p of allPresences) {\n        onlineStatusMap[p.userId] = {\n          isOnline: p.isOnline,\n          lastSeenAt: p.lastSeenAt,\n        };\n      }\n    } catch (e) {\n      // Table doesn't exist yet\n      console.warn('UserPresence table not ready');\n    }\n\n    // Get pilot profiles for friends\n    const profiles = await prisma.pilotProfile.findMany({\n      where: { userId: { in: friendIds } },\n      select: {\n        userId: true,\n        homeAirport: true,\n      },\n    });\n\n    const profileMap: Record<string, { homeAirport: string | null }> = {};\n    for (const p of profiles) {\n      profileMap[p.userId] = { homeAirport: p.homeAirport };\n    }\n\n    // Build response\n    const friendsWithStatus = friendUsers.map(user => {\n      const status = onlineStatusMap[user.id] || { isOnline: false, lastSeenAt: null };\n      const profile = profileMap[user.id] || { homeAirport: null };\n      \n      return {\n        id: user.id,\n        name: user.name,\n        username: user.username,\n        image: user.image,\n        homeAirport: profile.homeAirport,\n        isOnline: status.isOnline,\n        lastSeenAt: status.lastSeenAt,\n      };\n    });\n\n    // Sort: online first, then by name\n    friendsWithStatus.sort((a, b) => {\n      if (a.isOnline && !b.isOnline) return -1;\n      if (!a.isOnline && b.isOnline) return 1;\n      return (a.name || a.username || '').localeCompare(b.name || b.username || '');\n    });\n\n    return NextResponse.json({ friends: friendsWithStatus });\n  } catch (error) {\n    console.error('Friends with presence GET failed', error);\n    return NextResponse.json({ error: 'Failed to load friends' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\fuel-price\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\fuel-prices\\community\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":75,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2611,2614],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2611,2614],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CommunityFuelPrice' is defined but never used.","line":93,"column":6,"nodeType":"Identifier","messageId":"unusedVar","endLine":93,"endColumn":24}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth, prisma } from '@/lib/auth';\n\nexport async function POST(request: Request) {\n  try {\n    const session = await auth();\n    \n    const body = await request.json();\n    const { icao, fbo, fuelType, price, purchaseDate } = body;\n\n    // Validate required fields\n    if (!icao || !fuelType || !price || !purchaseDate) {\n      return NextResponse.json({ error: 'Missing required fields' }, { status: 400 });\n    }\n\n    if (!['100LL', 'JetA'].includes(fuelType)) {\n      return NextResponse.json({ error: 'Invalid fuel type' }, { status: 400 });\n    }\n\n    const priceNum = Number(price);\n    if (isNaN(priceNum) || priceNum <= 0 || priceNum > 50) {\n      return NextResponse.json({ error: 'Invalid price' }, { status: 400 });\n    }\n\n    const date = new Date(purchaseDate);\n    if (isNaN(date.getTime())) {\n      return NextResponse.json({ error: 'Invalid date' }, { status: 400 });\n    }\n\n    // Don't allow future dates or dates more than 2 years ago\n    const now = new Date();\n    const twoYearsAgo = new Date(now.getFullYear() - 2, now.getMonth(), now.getDate());\n    if (date > now || date < twoYearsAgo) {\n      return NextResponse.json({ error: 'Date must be within the last 2 years' }, { status: 400 });\n    }\n\n    // Store the community fuel price\n    const communityPrice = await prisma.communityFuelPrice.create({\n      data: {\n        icao: icao.toUpperCase(),\n        fbo: fbo?.trim() || null,\n        fuelType,\n        price: priceNum,\n        purchaseDate: date,\n        userId: session?.user?.id || null,\n      },\n    });\n\n    return NextResponse.json({ success: true, id: communityPrice.id });\n  } catch (error) {\n    console.error('Community fuel price submission failed', error);\n    return NextResponse.json({ error: 'Failed to submit price' }, { status: 500 });\n  }\n}\n\n// GET - fetch community prices for an airport or multiple airports\nexport async function GET(request: Request) {\n  try {\n    const url = new URL(request.url);\n    const icaos = url.searchParams.get('icaos')?.split(',').map(i => i.trim().toUpperCase()).filter(Boolean);\n\n    if (!icaos || icaos.length === 0) {\n      return NextResponse.json({ error: 'No airports specified' }, { status: 400 });\n    }\n\n    // Get the latest community price for each fuel type at each airport\n    const communityPrices = await prisma.communityFuelPrice.findMany({\n      where: {\n        icao: { in: icaos },\n      },\n      orderBy: { purchaseDate: 'desc' },\n    });\n\n    // Group by airport and fuel type, keeping only the most recent\n    const latestByAirportAndType: Record<string, any> = {};\n    for (const p of communityPrices) {\n      const key = `${p.icao}-${p.fuelType}`;\n      if (!latestByAirportAndType[key]) {\n        latestByAirportAndType[key] = {\n          ...p,\n          price: Number(p.price)\n        };\n      }\n    }\n\n    return NextResponse.json({ prices: Object.values(latestByAirportAndType) });\n  } catch (error) {\n    console.error('Failed to fetch community prices', error);\n    return NextResponse.json({ error: 'Failed to fetch prices' }, { status: 500 });\n  }\n}\n\ntype CommunityFuelPrice = {\n  id: string;\n  icao: string;\n  fbo: string | null;\n  fuelType: string;\n  price: number;\n  purchaseDate: Date;\n  userId: string | null;\n  createdAt: Date;\n};\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\fuel\\nearest\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":31,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[888,891],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[888,891],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":44,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1341,1344],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1341,1344],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Nearest Cheap Fuel API\n * Find lowest 100LL price within a given airport\n */\n\nimport { NextRequest, NextResponse } from 'next/server';\nimport sqlite3 from 'sqlite3';\nimport path from 'path';\n\nconst DB_PATH = path.join(process.cwd(), 'data', 'aviation_hub.db');\n\nexport async function GET(request: NextRequest): Promise<NextResponse> {\n  const { searchParams } = new URL(request.url);\n  const icao = searchParams.get('icao');\n  const radius = searchParams.get('radius') || '50';\n\n  if (!icao) {\n    return NextResponse.json({ error: 'Missing icao parameter' }, { status: 400 });\n  }\n\n  const radiusNm = parseInt(radius);\n\n  if (isNaN(radiusNm) || radiusNm < 1 || radiusNm > 500) {\n    return NextResponse.json({ error: 'Invalid radius (1-500 nm)' }, { status: 400 });\n  }\n\n  const db = new sqlite3.Database(DB_PATH);\n\n  try {\n    // Get center airport coordinates\n    const center: any = await new Promise((resolve, reject) => {\n      db.get(\"SELECT icao, latitude, longitude FROM airports WHERE icao = ?\", [icao.toUpperCase()], (err, row) => {\n        if (err) reject(err);\n        else resolve(row);\n      });\n    });\n\n    if (!center) {\n      db.close();\n      return NextResponse.json({ error: 'Airport not found', icao: icao.toUpperCase() }, { status: 404 });\n    }\n\n    // Calculate distance and find fuel prices\n    const rows: any[] = await new Promise((resolve, reject) => {\n      const sql = `\n        SELECT \n          af.icao,\n          a.name,\n          a.city,\n          a.state,\n          a.latitude,\n          a.longitude,\n          a.type,\n          af.price,\n          af.fuel_type,\n          af.last_reported,\n          af.source_url,\n          (6371 * acos(cos(radians(?)) * cos(radians(a.latitude)) * \n           cos(radians(a.longitude) - radians(?)) + sin(radians(?)) * \n           sin(radians(a.latitude)))) * 0.539997 AS distance_nm\n        FROM airport_fuel af\n        JOIN airports a ON af.icao = a.icao\n        WHERE af.fuel_type = '100LL' \n          AND af.price IS NOT NULL \n          AND af.price > 0\n        HAVING distance_nm <= ?\n        ORDER BY af.price ASC, distance_nm ASC\n        LIMIT 20\n      `;\n      db.all(sql, [center.latitude, center.longitude, center.latitude, radiusNm], (err, rows) => {\n        if (err) reject(err);\n        else resolve(rows || []);\n      });\n    });\n\n    db.close();\n\n    const results = rows.map((row) => ({\n      icao: row.icao,\n      name: row.name,\n      city: row.city,\n      state: row.state,\n      latitude: row.latitude,\n      longitude: row.longitude,\n      type: row.type,\n      price100ll: row.price,\n      fuelType: row.fuel_type,\n      lastReported: row.last_reported,\n      sourceUrl: row.source_url,\n      distanceNm: Math.round(row.distance_nm * 10) / 10,\n      direction: getDirection(center.latitude, center.longitude, row.latitude, row.longitude)\n    }));\n\n    return NextResponse.json({\n      centerAirport: icao.toUpperCase(),\n      radiusNm: radiusNm,\n      count: results.length,\n      results\n    });\n\n  } catch (error) {\n    db.close();\n    console.error('Error:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}\n\nfunction getDirection(lat1: number, lon1: number, lat2: number, lon2: number): string {\n  const dLon = (lon2 - lon1) * Math.PI / 180;\n  const lat1Rad = lat1 * Math.PI / 180;\n  const lat2Rad = lat2 * Math.PI / 180;\n\n  const y = Math.sin(dLon) * Math.cos(lat2Rad);\n  const x = Math.cos(lat1Rad) * Math.sin(lat2Rad) - Math.sin(lat1Rad) * Math.cos(lat2Rad) * Math.cos(dLon);\n\n  let bearing = Math.atan2(y, x) * 180 / Math.PI;\n  bearing = (bearing + 360) % 360;\n\n  const directions = ['N', 'NNE', 'NE', 'ENE', 'E', 'ESE', 'SE', 'SSE', 'S', 'SSW', 'SW', 'WSW', 'W', 'WNW', 'NW', 'NNW'];\n  const index = Math.round(bearing / 22.5) % 16;\n\n  return directions[index];\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\fuel\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[140,143],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[140,143],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":56,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1553,1556],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1553,1556],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":67,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1860,1863],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1860,1863],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":67,"column":96,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":99,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1916,1919],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1916,1919],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":67,"column":142,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":145,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1962,1965],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1962,1965],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":68,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2048,2051],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2048,2051],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":68,"column":94,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":97,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2103,2106],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2103,2106],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":68,"column":140,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":143,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2149,2152],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2149,2152],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":91,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2809,2812],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2809,2812],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport sqlite3 from 'sqlite3';\nimport { open } from 'sqlite';\nimport path from 'path';\n\nlet db: any = null;\n\nasync function getDb() {\n  if (!db) {\n    const dbPath = path.join(process.cwd(), 'data', 'aviation_hub.db');\n    db = await open({\n      filename: dbPath,\n      driver: sqlite3.Database\n    });\n  }\n  return db;\n}\n\n// Attribution for AirNav\nconst AIRNAV_ATTRIBUTION = {\n  name: 'AirNav',\n  url: 'https://www.airnav.com',\n  airbossUrl: 'https://www.airnav.com/airboss/',\n  description: 'Fuel prices provided by AirNav.com - the leading aviation fuel price database'\n};\n\nexport async function GET(request: Request) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const icao = searchParams.get('icao')?.toUpperCase();\n    const includeHistory = searchParams.get('history') === 'true';\n    \n    if (!icao) {\n      return NextResponse.json({ error: 'ICAO code required' }, { status: 400 });\n    }\n    \n    const database = await getDb();\n    \n    // Get current fuel prices from airport_fuel table\n    const fuel = await database.all(`\n      SELECT icao, fbo_name, fuel_type, service_type, price, guaranteed, last_reported, source_url, scraped_at\n      FROM airport_fuel\n      WHERE icao = ?\n    `, icao);\n    \n    if (!fuel || fuel.length === 0) {\n      return NextResponse.json({\n        icao,\n        prices: [],\n        attribution: AIRNAV_ATTRIBUTION,\n        error: 'No fuel data available'\n      }, { status: 404 });\n    }\n    \n    // Format prices\n    const prices = fuel.map((f: any) => ({\n      fuelType: f.fuel_type,\n      serviceType: f.service_type,\n      price: f.price,\n      fboName: f.fbo_name,\n      lastReported: f.last_reported,\n      guaranteed: f.guaranteed === 1,\n      sourceUrl: f.source_url\n    }));\n    \n    // Calculate average\n    const avg100LL = prices.filter((p: any) => p.fuelType === '100LL').reduce((sum: number, p: any) => sum + p.price, 0) / prices.filter((p: any) => p.fuelType === '100LL').length || null;\n    const avgJetA = prices.filter((p: any) => p.fuelType === 'JetA').reduce((sum: number, p: any) => sum + p.price, 0) / prices.filter((p: any) => p.fuelType === 'JetA').length || null;\n    \n    // Get history if requested\n    let history = null;\n    if (includeHistory) {\n      history = await database.all(`\n        SELECT fuel_type, price, recorded_at\n        FROM airport_fuel_history\n        WHERE icao = ?\n        ORDER BY recorded_at DESC\n        LIMIT 30\n      `, icao);\n    }\n    \n    return NextResponse.json({\n      icao,\n      prices,\n      average: {\n        '100LL': avg100LL ? avg100LL.toFixed(2) : null,\n        'JetA': avgJetA ? avgJetA.toFixed(2) : null\n      },\n      scrapedAt: fuel[0]?.scraped_at,\n      attribution: AIRNAV_ATTRIBUTION,\n      history: history ? history.map((h: any) => ({\n        fuelType: h.fuel_type,\n        price: h.price,\n        recordedAt: h.recorded_at\n      })) : null\n    });\n    \n  } catch (error) {\n    console.error('Error fetching fuel data:', error);\n    return NextResponse.json({ error: 'Failed to fetch fuel data' }, { status: 500 });\n  }\n}\n\n// POST - Add or update fuel price (for user submissions)\nexport async function POST(request: Request) {\n  try {\n    const body = await request.json();\n    const { icao, fuelType, serviceType, price, fboName, source } = body;\n    \n    if (!icao || !price) {\n      return NextResponse.json({ error: 'icao and price required' }, { status: 400 });\n    }\n    \n    const database = await getDb();\n    \n    // Insert/update current price\n    await database.run(`\n      INSERT OR REPLACE INTO airport_fuel \n      (icao, fbo_name, fuel_type, service_type, price, guaranteed, last_reported, source_url, scraped_at)\n      VALUES (?, ?, ?, ?, ?, 0, datetime('now'), ?, datetime('now'))\n    `, icao.toUpperCase(), fboName || 'User Submitted', fuelType || '100LL', serviceType || 'Full Service', price, source || 'user');\n    \n    // Add to history\n    await database.run(`\n      INSERT INTO airport_fuel_history \n      (icao, fbo_name, fuel_type, service_type, price, source)\n      VALUES (?, ?, ?, ?, ?, 'user')\n    `, icao.toUpperCase(), fboName || 'User Submitted', fuelType || '100LL', serviceType || 'Full Service', price);\n    \n    return NextResponse.json({\n      success: true,\n      icao: icao.toUpperCase(),\n      price,\n      message: 'Fuel price submitted. Thanks for contributing!'\n    });\n  } catch (error) {\n    console.error('Error saving fuel data:', error);\n    return NextResponse.json({ error: 'Failed to save fuel data' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\groups\\[groupId]\\aircraft\\[aircraftId]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":25,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[845,848],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[845,848],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":36,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1233,1236],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1233,1236],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":58,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2067,2070],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2067,2070],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":82,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2911,2914],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2911,2914],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":93,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3299,3302],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3299,3302],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth } from '@/lib/auth';\nimport { prisma } from '@/lib/prisma';\nimport { isUuid } from '@/lib/validate';\n\ninterface RouteParams {\n  params: Promise<{ groupId: string; aircraftId: string }>;\n}\n\nexport async function PUT(request: Request, { params }: RouteParams) {\n  try {\n    const session = await auth();\n    if (!session?.user?.email) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const { groupId, aircraftId } = await params;\n    if (!isUuid(groupId) || !isUuid(aircraftId)) {\n      return NextResponse.json({ error: 'Invalid groupId or aircraftId' }, { status: 400 });\n    }\n    \n    // Get user by email using raw SQL\n    const users = await prisma.$queryRawUnsafe(`\n      SELECT id FROM [User] WHERE email = '${session.user.email}'\n    `) as any[];\n    \n    if (!users || users.length === 0) {\n      return NextResponse.json({ error: '[User] not found' }, { status: 404 });\n    }\n    \n    const userId = users[0].id;\n    \n    // Check admin role using raw SQL\n    const memberships = await prisma.$queryRawUnsafe(`\n      SELECT * FROM GroupMember WHERE groupId = '${groupId}' AND userId = '${userId}' AND role = 'ADMIN'\n    `) as any[];\n\n    if (!memberships || memberships.length === 0) {\n      return NextResponse.json({ error: 'Only admins can update aircraft' }, { status: 403 });\n    }\n\n    const body = await request.json();\n    const { notes, status } = body;\n\n    // Build update query\n    const updates: string[] = [];\n    if (notes !== undefined) updates.push(`aircraftNotes = ${notes ? \"'\" + notes.replace(/'/g, \"''\") + \"'\" : 'NULL'}`);\n    if (status !== undefined) updates.push(`status = '${status}'`);\n    updates.push(`updatedAt = GETDATE()`);\n\n    await prisma.$executeRawUnsafe(`\n      UPDATE ClubAircraft SET ${updates.join(', ')} WHERE id = '${aircraftId}' AND groupId = '${groupId}'\n    `);\n\n    // Fetch updated aircraft\n    const aircraft = await prisma.$queryRawUnsafe(`\n      SELECT * FROM ClubAircraft WHERE id = '${aircraftId}'\n    `) as any[];\n\n    return NextResponse.json(aircraft[0]);\n  } catch (error) {\n    console.error('Error updating aircraft:', error);\n    return NextResponse.json({ error: 'Failed to update aircraft', details: String(error) }, { status: 500 });\n  }\n}\n\nexport async function DELETE(request: Request, { params }: RouteParams) {\n  try {\n    const session = await auth();\n    if (!session?.user?.email) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const { groupId, aircraftId } = await params;\n    if (!isUuid(groupId) || !isUuid(aircraftId)) {\n      return NextResponse.json({ error: 'Invalid groupId or aircraftId' }, { status: 400 });\n    }\n    \n    // Get user by email using raw SQL\n    const users = await prisma.$queryRawUnsafe(`\n      SELECT id FROM [User] WHERE email = '${session.user.email}'\n    `) as any[];\n    \n    if (!users || users.length === 0) {\n      return NextResponse.json({ error: '[User] not found' }, { status: 404 });\n    }\n    \n    const userId = users[0].id;\n    \n    // Check admin role using raw SQL\n    const memberships = await prisma.$queryRawUnsafe(`\n      SELECT * FROM GroupMember WHERE groupId = '${groupId}' AND userId = '${userId}' AND role = 'ADMIN'\n    `) as any[];\n\n    if (!memberships || memberships.length === 0) {\n      return NextResponse.json({ error: 'Only admins can remove aircraft' }, { status: 403 });\n    }\n\n    await prisma.$executeRawUnsafe(`\n      DELETE FROM ClubAircraft WHERE id = '${aircraftId}' AND groupId = '${groupId}'\n    `);\n\n    return NextResponse.json({ success: true });\n  } catch (error) {\n    console.error('Error removing aircraft:', error);\n    return NextResponse.json({ error: 'Failed to remove aircraft' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\groups\\[groupId]\\aircraft\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[808,811],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[808,811],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":37,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1177,1180],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1177,1180],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":45,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1468,1471],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1468,1471],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":47,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1531,1534],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1531,1534],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":91,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3015,3018],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3015,3018],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":102,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3399,3402],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3399,3402],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":144,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5251,5254],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5251,5254],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth } from '@/lib/auth';\nimport { prisma } from '@/lib/prisma';\nimport { isUuid } from '@/lib/validate';\n\ninterface RouteParams {\n  params: Promise<{ groupId: string }>;\n}\n\n// GET all aircraft for a group\nexport async function GET(request: Request, { params }: RouteParams) {\n  try {\n    const session = await auth();\n    if (!session?.user?.email) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const { groupId } = await params;\n    if (!isUuid(groupId)) {\n      return NextResponse.json({ error: 'Invalid groupId' }, { status: 400 });\n    }\n    \n    // Get user by email using raw SQL\n    const users = await prisma.$queryRawUnsafe(`\n      SELECT id FROM [User] WHERE email = '${session.user.email}'\n    `) as any[];\n    \n    if (!users || users.length === 0) {\n      return NextResponse.json({ error: '[User] not found' }, { status: 404 });\n    }\n    \n    const userId = users[0].id;\n    \n    // Check membership using raw SQL\n    const memberships = await prisma.$queryRawUnsafe(`\n      SELECT * FROM GroupMember WHERE groupId = '${groupId}' AND userId = '${userId}'\n    `) as any[];\n\n    if (!memberships || memberships.length === 0) {\n      return NextResponse.json({ error: 'Not a member' }, { status: 403 });\n    }\n\n    const aircraft = await prisma.$queryRawUnsafe(`\n      SELECT * FROM ClubAircraft WHERE groupId = '${groupId}' ORDER BY createdAt DESC\n    `) as any[];\n\n    const formattedAircraft = (aircraft || []).map((a: any) => ({\n      id: a.id,\n      groupId: a.groupId,\n      nNumber: a.nNumber,\n      nickname: a.nickname,\n      customName: a.customName,\n      make: a.make,\n      model: a.model,\n      year: a.year,\n      totalTachHours: a.totalTachHours ? Number(a.totalTachHours) : null,\n      totalHobbsHours: a.totalHobbsHours ? Number(a.totalHobbsHours) : null,\n      registrationType: a.registrationType,\n      hasInsurance: a.hasInsurance,\n      maxPassengers: a.maxPassengers,\n      hourlyRate: a.hourlyRate ? Number(a.hourlyRate) : null,\n      aircraftNotes: a.aircraftNotes,\n      status: a.status,\n      createdAt: a.createdAt,\n      updatedAt: a.updatedAt,\n    }));\n\n    return NextResponse.json(formattedAircraft);\n  } catch (error) {\n    console.error('Error fetching aircraft:', error);\n    return NextResponse.json({ error: 'Failed to fetch aircraft', details: String(error) }, { status: 500 });\n  }\n}\n\n// POST add aircraft to group\nexport async function POST(request: Request, { params }: RouteParams) {\n  try {\n    const session = await auth();\n    if (!session?.user?.email) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const { groupId } = await params;\n    if (!isUuid(groupId)) {\n      return NextResponse.json({ error: 'Invalid groupId' }, { status: 400 });\n    }\n    \n    // Get user by email using raw SQL\n    const users = await prisma.$queryRawUnsafe(`\n      SELECT id FROM [User] WHERE email = '${session.user.email}'\n    `) as any[];\n    \n    if (!users || users.length === 0) {\n      return NextResponse.json({ error: '[User] not found' }, { status: 404 });\n    }\n    \n    const userId = users[0].id;\n\n    // Check admin role using raw SQL\n    const memberships = await prisma.$queryRawUnsafe(`\n      SELECT * FROM GroupMember WHERE groupId = '${groupId}' AND userId = '${userId}' AND role = 'ADMIN'\n    `) as any[];\n\n    if (!memberships || memberships.length === 0) {\n      return NextResponse.json({ error: 'Only admins can add aircraft' }, { status: 403 });\n    }\n\n    const body = await request.json();\n    const { \n      nNumber, nickname, customName, make, model, year, \n      totalTachHours, totalHobbsHours, registrationType, \n      hasInsurance, maxPassengers, hourlyRate, notes \n    } = body;\n\n    const aircraftId = crypto.randomUUID();\n    \n    await prisma.$executeRawUnsafe(`\n      INSERT INTO ClubAircraft (id, groupId, nNumber, nickname, customName, make, model, year, totalTachHours, totalHobbsHours, registrationType, hasInsurance, maxPassengers, hourlyRate, aircraftNotes, status, createdAt, updatedAt)\n      VALUES (\n        '${aircraftId}', \n        '${groupId}', \n        ${nNumber ? \"'\" + nNumber.replace(/'/g, \"''\") + \"'\" : 'NULL'}, \n        ${nickname ? \"'\" + nickname.replace(/'/g, \"''\") + \"'\" : 'NULL'}, \n        ${customName ? \"'\" + customName.replace(/'/g, \"''\") + \"'\" : 'NULL'}, \n        ${make ? \"'\" + make.replace(/'/g, \"''\") + \"'\" : 'NULL'}, \n        ${model ? \"'\" + model.replace(/'/g, \"''\") + \"'\" : 'NULL'}, \n        ${year ? parseInt(year) : 'NULL'}, \n        ${totalTachHours ? parseFloat(totalTachHours) : 'NULL'}, \n        ${totalHobbsHours ? parseFloat(totalHobbsHours) : 'NULL'}, \n        ${registrationType ? \"'\" + registrationType.replace(/'/g, \"''\") + \"'\" : 'NULL'}, \n        ${hasInsurance ? 1 : 0}, \n        ${maxPassengers ? parseInt(maxPassengers) : 'NULL'}, \n        ${hourlyRate ? parseFloat(hourlyRate) : 'NULL'}, \n        ${notes ? \"'\" + notes.replace(/'/g, \"''\") + \"'\" : 'NULL'}, \n        'Available',\n        GETDATE(),\n        GETDATE()\n      )\n    `);\n\n    // Fetch created aircraft\n    const aircraft = await prisma.$queryRawUnsafe(`\n      SELECT * FROM ClubAircraft WHERE id = '${aircraftId}'\n    `) as any[];\n\n    const a = aircraft[0];\n    return NextResponse.json({\n      id: a.id,\n      groupId: a.groupId,\n      nNumber: a.nNumber,\n      nickname: a.nickname,\n      customName: a.customName,\n      make: a.make,\n      model: a.model,\n      year: a.year,\n      totalTachHours: a.totalTachHours ? Number(a.totalTachHours) : null,\n      totalHobbsHours: a.totalHobbsHours ? Number(a.totalHobbsHours) : null,\n      registrationType: a.registrationType,\n      hasInsurance: a.hasInsurance,\n      maxPassengers: a.maxPassengers,\n      hourlyRate: a.hourlyRate ? Number(a.hourlyRate) : null,\n      aircraftNotes: a.aircraftNotes,\n      status: a.status,\n      createdAt: a.createdAt,\n      updatedAt: a.updatedAt,\n    });\n  } catch (error) {\n    console.error('Error adding aircraft:', error);\n    return NextResponse.json({ error: 'Failed to add aircraft', details: String(error) }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\groups\\[groupId]\\bookings\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[808,811],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[808,811],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":37,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1177,1180],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1177,1180],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":54,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1847,1850],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1847,1850],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":56,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1910,1913],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1910,1913],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":104,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":104,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3286,3289],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3286,3289],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":115,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3696,3699],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3696,3699],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":127,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":127,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4143,4146],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4143,4146],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":137,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":137,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4558,4561],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4558,4561],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":154,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":154,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5158,5161],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5158,5161],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":173,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":173,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5991,5994],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5991,5994],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth } from '@/lib/auth';\nimport { prisma } from '@/lib/prisma';\nimport { isUuid } from '@/lib/validate';\n\ninterface RouteParams {\n  params: Promise<{ groupId: string }>;\n}\n\n// GET all bookings for a group\nexport async function GET(request: Request, { params }: RouteParams) {\n  try {\n    const session = await auth();\n    if (!session?.user?.email) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const { groupId } = await params;\n    if (!isUuid(groupId)) {\n      return NextResponse.json({ error: 'Invalid groupId' }, { status: 400 });\n    }\n    \n    // Get user by email using raw SQL\n    const users = await prisma.$queryRawUnsafe(`\n      SELECT id FROM [User] WHERE email = '${session.user.email}'\n    `) as any[];\n    \n    if (!users || users.length === 0) {\n      return NextResponse.json({ error: '[User] not found' }, { status: 404 });\n    }\n    \n    const userId = users[0].id;\n    \n    // Check membership using raw SQL\n    const memberships = await prisma.$queryRawUnsafe(`\n      SELECT * FROM GroupMember WHERE groupId = '${groupId}' AND userId = '${userId}'\n    `) as any[];\n\n    if (!memberships || memberships.length === 0) {\n      return NextResponse.json({ error: 'Not a member' }, { status: 403 });\n    }\n\n    // Get bookings using raw SQL\n    const bookings = await prisma.$queryRawUnsafe(`\n      SELECT \n        b.id, b.aircraftId, b.userId, b.startTime, b.endTime, b.purpose, b.createdAt, b.updatedAt,\n        a.nNumber, a.customName, a.nickname, a.make, a.model, a.groupId as aircraftGroupId,\n        u.name as userName, u.email as userEmail\n      FROM Booking b\n      JOIN ClubAircraft a ON b.aircraftId = a.id\n      JOIN [User] u ON b.userId = u.id\n      WHERE a.groupId = '${groupId}'\n      ORDER BY b.startTime ASC\n    `) as any[];\n\n    const formattedBookings = (bookings || []).map((b: any) => ({\n      id: b.id,\n      aircraftId: b.aircraftId,\n      userId: b.userId,\n      startTime: b.startTime,\n      endTime: b.endTime,\n      purpose: b.purpose,\n      createdAt: b.createdAt,\n      updatedAt: b.updatedAt,\n      aircraft: {\n        id: b.aircraftId,\n        nNumber: b.nNumber,\n        customName: b.customName,\n        nickname: b.nickname,\n        make: b.make,\n        model: b.model,\n        groupId: b.aircraftGroupId,\n      },\n      user: {\n        id: b.userId,\n        name: b.userName,\n        email: b.userEmail,\n      },\n    }));\n\n    return NextResponse.json(formattedBookings);\n  } catch (error) {\n    console.error('Error fetching bookings:', error);\n    return NextResponse.json({ error: 'Failed to fetch bookings', details: String(error) }, { status: 500 });\n  }\n}\n\n// POST create a booking\nexport async function POST(request: Request, { params }: RouteParams) {\n  try {\n    const session = await auth();\n    if (!session?.user?.email) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const { groupId } = await params;\n    if (!isUuid(groupId)) {\n      return NextResponse.json({ error: 'Invalid groupId' }, { status: 400 });\n    }\n    \n    // Get user by email using raw SQL\n    const users = await prisma.$queryRawUnsafe(`\n      SELECT id FROM [User] WHERE email = '${session.user.email}'\n    `) as any[];\n    \n    if (!users || users.length === 0) {\n      return NextResponse.json({ error: '[User] not found' }, { status: 404 });\n    }\n    \n    const userId = users[0].id;\n    \n    // Check membership and role using raw SQL\n    const memberships = await prisma.$queryRawUnsafe(`\n      SELECT * FROM GroupMember WHERE groupId = '${groupId}' AND userId = '${userId}' AND role IN ('MEMBER', 'ADMIN')\n    `) as any[];\n\n    if (!memberships || memberships.length === 0) {\n      return NextResponse.json({ error: 'Only members can book' }, { status: 403 });\n    }\n\n    const body = await request.json();\n    const { aircraftId, startTime, endTime, purpose } = body;\n\n    // Verify aircraft belongs to group\n    const aircraftList = await prisma.$queryRawUnsafe(`\n      SELECT * FROM ClubAircraft WHERE id = '${aircraftId}' AND groupId = '${groupId}'\n    `) as any[];\n\n    if (!aircraftList || aircraftList.length === 0) {\n      return NextResponse.json({ error: 'Aircraft not found in group' }, { status: 404 });\n    }\n\n    // Check if aircraft is grounded for maintenance\n    const maintenanceList = await prisma.$queryRawUnsafe(`\n      SELECT * FROM Maintenance \n      WHERE aircraftId = '${aircraftId}' AND isGrounded = 1 AND status IN ('NEEDED', 'IN_PROGRESS')\n    `) as any[];\n\n    if (maintenanceList && maintenanceList.length > 0) {\n      return NextResponse.json({ \n        error: 'This aircraft is currently Grounded for maintenance. Please contact your admin.' \n      }, { status: 403 });\n    }\n\n    // Check for conflicts - need to parse dates\n    const startDate = new Date(startTime).toISOString();\n    const endDate = new Date(endTime).toISOString();\n    \n    const conflicts = await prisma.$queryRawUnsafe(`\n      SELECT * FROM Booking \n      WHERE aircraftId = '${aircraftId}' \n      AND startTime < '${endDate}' \n      AND endTime > '${startDate}'\n    `) as any[];\n\n    if (conflicts && conflicts.length > 0) {\n      return NextResponse.json({ error: 'Time slot conflicts with existing booking' }, { status: 409 });\n    }\n\n    // Create booking using raw SQL\n    const bookingId = crypto.randomUUID();\n    await prisma.$executeRawUnsafe(`\n      INSERT INTO Booking (id, aircraftId, userId, startTime, endTime, purpose, createdAt, updatedAt)\n      VALUES ('${bookingId}', '${aircraftId}', '${userId}', '${startDate}', '${endDate}', ${purpose ? \"'\" + purpose.replace(/'/g, \"''\") + \"'\" : 'NULL'}, GETDATE(), GETDATE())\n    `);\n\n    // Fetch created booking\n    const bookings = await prisma.$queryRawUnsafe(`\n      SELECT b.*, a.nNumber, a.customName, a.nickname, a.make, a.model\n      FROM Booking b\n      JOIN ClubAircraft a ON b.aircraftId = a.id\n      WHERE b.id = '${bookingId}'\n    `) as any[];\n\n    const b = bookings[0];\n    return NextResponse.json({\n      id: b.id,\n      aircraftId: b.aircraftId,\n      userId: b.userId,\n      startTime: b.startTime,\n      endTime: b.endTime,\n      purpose: b.purpose,\n      createdAt: b.createdAt,\n      updatedAt: b.updatedAt,\n      aircraft: {\n        id: b.aircraftId,\n        nNumber: b.nNumber,\n        customName: b.customName,\n        nickname: b.nickname,\n        make: b.make,\n        model: b.model,\n      },\n      user: {\n        id: userId,\n        name: b.userName,\n        email: b.userEmail,\n      },\n    });\n  } catch (error) {\n    console.error('Error creating booking:', error);\n    return NextResponse.json({ error: 'Failed to create booking', details: String(error) }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\groups\\[groupId]\\chat\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":16,"column":101,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":104,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[583,586],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[583,586],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":47,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1458,1461],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1458,1461],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":52,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1671,1674],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1671,1674],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":98,"column":101,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":104,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3124,3127],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3124,3127],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth } from '@/lib/auth';\nimport { prisma } from '@/lib/prisma';\n\nexport async function GET(request: Request, { params }: { params: Promise<{ groupId: string }> }) {\n  try {\n    const session = await auth();\n    if (!session?.user?.email) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const { groupId } = await params;\n\n    // Get user by email\n    const userEmail = session.user.email;\n    const users = await prisma.$queryRaw`SELECT id, name FROM [User] WHERE email = ${userEmail}` as any[];\n\n    if (!users || users.length === 0) {\n      return NextResponse.json({ error: 'User not found' }, { status: 404 });\n    }\n\n    const userId = users[0].id;\n\n    // Check membership using Prisma\n    const membership = await prisma.groupMember.findFirst({\n      where: { userId, groupId }\n    });\n\n    if (!membership) {\n      return NextResponse.json({ error: 'Not a member of this group' }, { status: 403 });\n    }\n\n    // Fetch messages with user info using raw SQL\n    const messages = await prisma.$queryRawUnsafe(`\n      SELECT \n        gcm.id,\n        gcm.groupId,\n        gcm.userId,\n        gcm.message,\n        gcm.createdAt,\n        u.name as userName\n      FROM GroupChatMessage gcm\n      LEFT JOIN [User] u ON gcm.userId = u.id\n      WHERE gcm.groupId = '${groupId}'\n      ORDER BY gcm.createdAt ASC\n      OFFSET 0 ROWS FETCH NEXT 100 ROWS ONLY\n    `) as any[];\n\n    // Transform messages\n    const colors = ['bg-primary', 'bg-green-500', 'bg-blue-500', 'bg-purple-500', 'bg-orange-500', 'bg-pink-500'];\n    \n    const transformedMessages = (messages || []).map((msg: any) => {\n      const userName = msg.userName || 'Unknown';\n      const initials = userName \n        ? userName.split(' ').map((n: string) => n[0]).join('').substring(0, 2).toUpperCase()\n        : '??';\n      \n      const colorIndex = msg.userId.charCodeAt(0) % colors.length;\n      \n      return {\n        id: msg.id,\n        groupId: msg.groupId,\n        userId: msg.userId,\n        user: {\n          name: userName,\n          initials,\n          color: colors[colorIndex]\n        },\n        message: msg.message,\n        timestamp: msg.createdAt\n      };\n    });\n\n    return NextResponse.json(transformedMessages);\n  } catch (error) {\n    console.error('Error fetching chat messages:', error);\n    return NextResponse.json({ error: 'Failed to fetch messages' }, { status: 500 });\n  }\n}\n\nexport async function POST(request: Request, { params }: { params: Promise<{ groupId: string }> }) {\n  try {\n    const session = await auth();\n    if (!session?.user?.email) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const { groupId } = await params;\n    const body = await request.json();\n    const { message } = body;\n\n    if (!message || !message.trim()) {\n      return NextResponse.json({ error: 'Message is required' }, { status: 400 });\n    }\n\n    // Get user by email\n    const userEmail = session.user.email;\n    const users = await prisma.$queryRaw`SELECT id, name FROM [User] WHERE email = ${userEmail}` as any[];\n\n    if (!users || users.length === 0) {\n      return NextResponse.json({ error: 'User not found' }, { status: 404 });\n    }\n\n    const userId = users[0].id;\n    const userName = users[0].name;\n\n    // Check membership using Prisma\n    const membership = await prisma.groupMember.findFirst({\n      where: { userId, groupId }\n    });\n\n    if (!membership) {\n      return NextResponse.json({ error: 'Not a member of this group' }, { status: 403 });\n    }\n\n    // Create message using Prisma\n    const newMessage = await prisma.groupChatMessage.create({\n      data: {\n        groupId,\n        userId,\n        message: message.trim()\n      }\n    });\n\n    // Generate response\n    const initials = userName \n      ? userName.split(' ').map((n: string) => n[0]).join('').substring(0, 2).toUpperCase()\n      : '??';\n    \n    const colors = ['bg-primary', 'bg-green-500', 'bg-blue-500', 'bg-purple-500', 'bg-orange-500', 'bg-pink-500'];\n    const colorIndex = userId.charCodeAt(0) % colors.length;\n\n    const response = {\n      id: newMessage.id,\n      groupId: newMessage.groupId,\n      userId: newMessage.userId,\n      user: {\n        name: userName || 'Unknown',\n        initials,\n        color: colors[colorIndex]\n      },\n      message: newMessage.message,\n      timestamp: newMessage.createdAt\n    };\n\n    return NextResponse.json(response);\n  } catch (error) {\n    console.error('Error sending chat message:', error);\n    return NextResponse.json({ error: 'Failed to send message' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\groups\\[groupId]\\invites\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":27,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[858,861],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[858,861],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":38,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1246,1249],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1246,1249],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":51,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1674,1677],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1674,1677],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":53,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1735,1738],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1735,1738],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":90,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2806,2809],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2806,2809],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":101,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":101,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3194,3197],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3194,3197],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":117,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":117,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3778,3781],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3778,3781],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":128,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":128,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4271,4274],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4271,4274],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":138,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":138,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4651,4654],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4651,4654],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":187,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":187,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6472,6475],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6472,6475],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":201,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":201,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6900,6903],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6900,6903],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":212,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":212,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7291,7294],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7291,7294],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":12,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth } from '@/lib/auth';\nimport { prisma } from '@/lib/prisma';\nimport { isUuid } from '@/lib/validate';\nimport { randomBytes } from 'crypto';\n\ninterface RouteParams {\n  params: Promise<{ groupId: string }>;\n}\n\n// GET all invites for a group (admin only)\nexport async function GET(request: Request, { params }: RouteParams) {\n  try {\n    const session = await auth();\n    if (!session?.user?.email) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const { groupId } = await params;\n    if (!isUuid(groupId)) {\n      return NextResponse.json({ error: 'Invalid groupId' }, { status: 400 });\n    }\n    \n    // Get user by email using raw SQL\n    const users = await prisma.$queryRawUnsafe(`\n      SELECT id FROM [User] WHERE email = '${session.user.email}'\n    `) as any[];\n    \n    if (!users || users.length === 0) {\n      return NextResponse.json({ error: '[User] not found' }, { status: 404 });\n    }\n    \n    const userId = users[0].id;\n    \n    // Check admin role using raw SQL\n    const memberships = await prisma.$queryRawUnsafe(`\n      SELECT * FROM GroupMember WHERE groupId = '${groupId}' AND userId = '${userId}' AND role = 'ADMIN'\n    `) as any[];\n\n    if (!memberships || memberships.length === 0) {\n      return NextResponse.json({ error: 'Only admins can view invites' }, { status: 403 });\n    }\n\n    // Get invites using raw SQL\n    const invites = await prisma.$queryRawUnsafe(`\n      SELECT i.*, fg.name as groupName\n      FROM Invite i\n      JOIN FlyingGroup fg ON i.groupId = fg.id\n      WHERE i.groupId = '${groupId}'\n      ORDER BY i.createdAt DESC\n    `) as any[];\n\n    const formattedInvites = (invites || []).map((i: any) => ({\n      id: i.id,\n      groupId: i.groupId,\n      token: i.token,\n      email: i.email,\n      role: i.role,\n      expiresAt: i.expiresAt,\n      createdAt: i.createdAt,\n      group: {\n        id: i.groupId,\n        name: i.groupName\n      }\n    }));\n\n    return NextResponse.json(formattedInvites);\n  } catch (error) {\n    console.error('Error fetching invites:', error);\n    return NextResponse.json({ error: 'Failed to fetch invites', details: String(error) }, { status: 500 });\n  }\n}\n\n// POST create an invite\nexport async function POST(request: Request, { params }: RouteParams) {\n  try {\n    const session = await auth();\n    if (!session?.user?.email) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const { groupId } = await params;\n    if (!isUuid(groupId)) {\n      return NextResponse.json({ error: 'Invalid groupId' }, { status: 400 });\n    }\n    \n    // Get user by email using raw SQL\n    const users = await prisma.$queryRawUnsafe(`\n      SELECT id FROM [User] WHERE email = '${session.user.email}'\n    `) as any[];\n    \n    if (!users || users.length === 0) {\n      return NextResponse.json({ error: '[User] not found' }, { status: 404 });\n    }\n    \n    const userId = users[0].id;\n    \n    // Check admin role using raw SQL\n    const memberships = await prisma.$queryRawUnsafe(`\n      SELECT * FROM GroupMember WHERE groupId = '${groupId}' AND userId = '${userId}' AND role = 'ADMIN'\n    `) as any[];\n\n    if (!memberships || memberships.length === 0) {\n      return NextResponse.json({ error: 'Only admins can create invites' }, { status: 403 });\n    }\n\n    const body = await request.json();\n    const { email, role, expiresInDays } = body;\n\n    // Check if invite already exists for this email+group (and not expired)\n    if (email) {\n      const existingInvites = await prisma.$queryRawUnsafe(`\n        SELECT * FROM Invite \n        WHERE groupId = '${groupId}' \n        AND LOWER(email) = LOWER('${email.replace(/'/g, \"''\")}')\n        AND expiresAt > GETDATE()\n      `) as any[];\n\n      if (existingInvites && existingInvites.length > 0) {\n        return NextResponse.json({ error: 'An invitation has already been sent to this email' }, { status: 400 });\n      }\n\n      // Also check if user is already a member\n      const existingMembers = await prisma.$queryRawUnsafe(`\n        SELECT gm.* FROM GroupMember gm\n        JOIN [User] u ON gm.userId = u.id\n        WHERE gm.groupId = '${groupId}' AND LOWER(u.email) = LOWER('${email.replace(/'/g, \"''\")}')\n      `) as any[];\n\n      if (existingMembers && existingMembers.length > 0) {\n        return NextResponse.json({ error: 'This user is already a member of the group' }, { status: 400 });\n      }\n    }\n\n    // Get group's default expiry setting using raw SQL\n    const groups = await prisma.$queryRawUnsafe(`\n      SELECT defaultInviteExpiry FROM FlyingGroup WHERE id = '${groupId}'\n    `) as any[];\n    \n    // Determine expiry: use provided value, or group's default, or 7 days\n    let expiresAtStr = 'NULL';\n    if (expiresInDays !== -1) { // -1 means never\n      const days = expiresInDays ?? groups?.[0]?.defaultInviteExpiry ?? 7;\n      expiresAtStr = `DATEADD(day, ${days}, GETDATE())`;\n    } else {\n      expiresAtStr = \"DATEADD(year, 10, GETDATE())\";\n    }\n\n    // Generate unique token\n    const token = randomBytes(32).toString('hex');\n\n    // Insert using raw SQL\n    await prisma.$executeRawUnsafe(`\n      INSERT INTO Invite (id, groupId, token, email, role, createdBy, expiresAt, createdAt, updatedAt)\n      VALUES (NEWID(), '${groupId}', '${token}', ${email ? \"'\" + email.toLowerCase().replace(/'/g, \"''\") + \"'\" : 'NULL'}, '${role || 'VIEWER'}', '${userId}', ${expiresAtStr}, GETDATE(), GETDATE())\n    `);\n\n    return NextResponse.json({ \n      token, \n      expiresAt: expiresInDays === -1 ? null : new Date(Date.now() + (expiresInDays ?? 7) * 24 * 60 * 60 * 1000),\n      expiresNever: expiresInDays === -1 \n    });\n  } catch (error) {\n    console.error('Error creating invite:', error);\n    return NextResponse.json({ error: 'Failed to create invite: ' + String(error) }, { status: 500 });\n  }\n}\n\n// DELETE revoke an invite\nexport async function DELETE(request: Request) {\n  try {\n    const session = await auth();\n    if (!session?.user?.email) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const url = new URL(request.url);\n    const inviteId = url.searchParams.get('inviteId');\n\n    if (!inviteId) {\n      return NextResponse.json({ error: 'inviteId required' }, { status: 400 });\n    }\n\n    // Get user by email using raw SQL\n    const users = await prisma.$queryRawUnsafe(`\n      SELECT id FROM [User] WHERE email = '${session.user.email}'\n    `) as any[];\n    \n    if (!users || users.length === 0) {\n      return NextResponse.json({ error: '[User] not found' }, { status: 404 });\n    }\n    \n    const userId = users[0].id;\n    \n    // Find the invite to check group ownership\n    const invites = await prisma.$queryRawUnsafe(`\n      SELECT i.*, fg.name as groupName\n      FROM Invite i\n      JOIN FlyingGroup fg ON i.groupId = fg.id\n      WHERE i.id = '${inviteId}'\n    `) as any[];\n\n    if (!invites || invites.length === 0) {\n      return NextResponse.json({ error: 'Invite not found' }, { status: 404 });\n    }\n\n    const invite = invites[0];\n\n    // Check if user is admin of the group\n    const memberships = await prisma.$queryRawUnsafe(`\n      SELECT * FROM GroupMember WHERE groupId = '${invite.groupId}' AND userId = '${userId}' AND role = 'ADMIN'\n    `) as any[];\n\n    if (!memberships || memberships.length === 0) {\n      return NextResponse.json({ error: 'Not authorized' }, { status: 403 });\n    }\n\n    await prisma.$executeRawUnsafe(`DELETE FROM Invite WHERE id = '${inviteId}'`);\n\n    return NextResponse.json({ success: true });\n  } catch (error) {\n    console.error('Error deleting invite:', error);\n    return NextResponse.json({ error: 'Failed to delete invite' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\groups\\[groupId]\\join\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":29,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[878,881],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[878,881],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":35,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1096,1099],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1096,1099],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":54,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1937,1940],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1937,1940],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":72,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2477,2480],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2477,2480],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":83,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2859,2862],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2859,2862],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth } from '@/lib/auth';\nimport { prisma } from '@/lib/prisma';\nimport { isUuid } from '@/lib/validate';\n\ninterface RouteParams {\n  params: Promise<{ groupId: string }>;\n}\n\nexport async function POST(request: Request, { params }: RouteParams) {\n  try {\n    const session = await auth();\n    \n    const { groupId } = await params;\n    if (!isUuid(groupId)) {\n      return NextResponse.json({ error: 'Invalid groupId' }, { status: 400 });\n    }\n    const body = await request.json();\n    const { token } = body;\n\n    if (!token) {\n      return NextResponse.json({ error: 'Token required' }, { status: 400 });\n    }\n\n    // Find the invite using raw SQL\n    const invites = await prisma.$queryRawUnsafe(`\n      SELECT * FROM Invite \n      WHERE token = '${token}' AND groupId = '${groupId}' AND expiresAt > GETDATE()\n    `) as any[];\n\n    if (!invites || invites.length === 0) {\n      // Check if invite exists but expired\n      const anyInvites = await prisma.$queryRawUnsafe(`\n        SELECT * FROM Invite WHERE token = '${token}'\n      `) as any[];\n      \n      if (anyInvites && anyInvites.length > 0) {\n        const inv = anyInvites[0];\n        if (new Date(inv.expiresAt) <= new Date()) {\n          return NextResponse.json({ error: 'Invite has expired. Please ask for a new one.' }, { status: 404 });\n        }\n        return NextResponse.json({ error: 'Invalid invite link for this group' }, { status: 404 });\n      }\n      return NextResponse.json({ error: 'Invalid invite link' }, { status: 404 });\n    }\n\n    const invite = invites[0];\n\n    // VIEWER role can join without account - just return success\n    if (invite.role === 'VIEWER' && !session?.user?.email) {\n      // For viewer invites without login, just return success info\n      const groups = await prisma.$queryRawUnsafe(`\n        SELECT id, name, description FROM FlyingGroup WHERE id = '${groupId}'\n      `) as any[];\n      \n      return NextResponse.json({ \n        success: true, \n        role: 'VIEWER',\n        group: groups[0],\n        message: 'You can view this group as a viewer'\n      });\n    }\n\n    // For MEMBER/ADMIN roles, require login\n    if (!session?.user?.email) {\n      return NextResponse.json({ error: 'Please log in to join as a member' }, { status: 401 });\n    }\n\n    // Get user by email using raw SQL\n    const users = await prisma.$queryRawUnsafe(`\n      SELECT id FROM [User] WHERE email = '${session.user.email}'\n    `) as any[];\n    \n    if (!users || users.length === 0) {\n      return NextResponse.json({ error: '[User] not found' }, { status: 404 });\n    }\n    \n    const userId = users[0].id;\n    \n    // Check if already a member using raw SQL\n    const existingMembers = await prisma.$queryRawUnsafe(`\n      SELECT * FROM GroupMember WHERE userId = '${userId}' AND groupId = '${groupId}'\n    `) as any[];\n\n    if (existingMembers && existingMembers.length > 0) {\n      return NextResponse.json({ error: 'Already a member of this group' }, { status: 400 });\n    }\n\n    // Add user as member using raw SQL\n    const memberId = crypto.randomUUID();\n    await prisma.$executeRawUnsafe(`\n      INSERT INTO GroupMember (id, userId, groupId, role, joinedAt)\n      VALUES ('${memberId}', '${userId}', '${groupId}', '${invite.role}', GETDATE())\n    `);\n\n    // Delete the used invite\n    await prisma.$executeRawUnsafe(`DELETE FROM Invite WHERE id = '${invite.id}'`);\n\n    return NextResponse.json({ success: true });\n  } catch (error) {\n    console.error('Error joining group:', error);\n    return NextResponse.json({ error: 'Failed to join group', details: String(error) }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\groups\\[groupId]\\logs\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[811,814],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[811,814],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":37,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1180,1183],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1180,1183],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":44,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1386,1389],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1386,1389],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":54,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1785,1788],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1785,1788],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":61,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2071,2074],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2071,2074],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":62,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2149,2152],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2149,2152],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-const","severity":2,"message":"'aircraftMap' is never reassigned. Use 'const' instead.","line":64,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":64,"endColumn":41,"fix":{"range":[2179,2221],"text":"const aircraftMap: Record<string, any> = {};"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":64,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2211,2214],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2211,2214],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-const","severity":2,"message":"'userMap' is never reassigned. Use 'const' instead.","line":65,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":65,"endColumn":37,"fix":{"range":[2226,2264],"text":"const userMap: Record<string, any> = {};"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":65,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2254,2257],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2254,2257],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":72,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2555,2558],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2555,2558],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":73,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2601,2604],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2601,2604],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":79,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2859,2862],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2859,2862],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":80,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2901,2904],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2901,2904],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":83,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2988,2991],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2988,2991],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":98,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3443,3446],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3443,3446],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":107,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":107,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3784,3787],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3784,3787],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":112,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":112,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3932,3935],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3932,3935],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":161,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":161,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5423,5426],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5423,5426],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":172,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":172,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5853,5856],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5853,5856],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":218,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":218,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7739,7742],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7739,7742],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":21,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":2,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth } from '@/lib/auth';\nimport { prisma } from '@/lib/prisma';\nimport { isUuid } from '@/lib/validate';\n\ninterface RouteParams {\n  params: Promise<{ groupId: string }>;\n}\n\n// GET all flight logs for a group\nexport async function GET(request: Request, { params }: RouteParams) {\n  try {\n    const session = await auth();\n    if (!session?.user?.email) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const { groupId } = await params;\n    if (!isUuid(groupId)) {\n      return NextResponse.json({ error: 'Invalid groupId' }, { status: 400 });\n    }\n    \n    // Get user by email using raw SQL\n    const users = await prisma.$queryRawUnsafe(`\n      SELECT id FROM [User] WHERE email = '${session.user.email}'\n    `) as any[];\n    \n    if (!users || users.length === 0) {\n      return NextResponse.json({ error: '[User] not found' }, { status: 404 });\n    }\n    \n    const userId = users[0].id;\n    \n    // Check membership using raw SQL\n    const memberships = await prisma.$queryRawUnsafe(`\n      SELECT * FROM GroupMember WHERE groupId = '${groupId}' AND userId = '${userId}'\n    `) as any[];\n\n    if (!memberships || memberships.length === 0) {\n      return NextResponse.json({ error: 'Not a member' }, { status: 403 });\n    }\n\n    // Get logs using raw SQL - simplified query\n    let logs: any[] = [];\n    try {\n      const logResult = await prisma.$queryRawUnsafe(`\n        SELECT TOP 100\n          fl.id, fl.aircraftId, fl.userId, fl.date, fl.tachTime, fl.hobbsTime, fl.notes, fl.createdAt, fl.updatedAt\n        FROM FlightLog fl\n        JOIN ClubAircraft a ON fl.aircraftId = a.id\n        WHERE a.groupId = '${groupId}'\n        ORDER BY fl.date DESC\n      `);\n      logs = logResult as any[];\n    } catch (e) {\n      console.error('Error fetching logs:', e);\n      return NextResponse.json({ error: 'Failed to fetch logs', details: String(e) }, { status: 500 });\n    }\n\n    // Get aircraft and user data separately\n    const aircraftIds = [...new Set((logs || []).map((l: any) => l.aircraftId))];\n    const userIds = [...new Set((logs || []).map((l: any) => l.userId))];\n    \n    let aircraftMap: Record<string, any> = {};\n    let userMap: Record<string, any> = {};\n    \n    if (aircraftIds.length > 0) {\n      const aircraftList = await prisma.$queryRawUnsafe(`\n        SELECT id, nNumber, customName, nickname, make, model, groupId\n        FROM ClubAircraft \n        WHERE id IN (${aircraftIds.map((id: string) => \"'\" + id + \"'\").join(',')})\n      `) as any[];\n      (aircraftList || []).forEach((a: any) => { aircraftMap[a.id] = a; });\n    }\n    \n    if (userIds.length > 0) {\n      const userList = await prisma.$queryRawUnsafe(`\n        SELECT id, name, email FROM [User] WHERE id IN (${userIds.map((id: string) => \"'\" + id + \"'\").join(',')})\n      `) as any[];\n      (userList || []).forEach((u: any) => { userMap[u.id] = u; });\n    }\n\n    const formattedLogs = (logs || []).map((l: any) => ({\n      id: l.id,\n      aircraftId: l.aircraftId,\n      userId: l.userId,\n      date: l.date,\n      tachTime: l.tachTime ? Number(l.tachTime) : null,\n      hobbsTime: l.hobbsTime ? Number(l.hobbsTime) : null,\n      notes: l.notes,\n      createdAt: l.createdAt,\n      updatedAt: l.updatedAt,\n      aircraft: aircraftMap[l.aircraftId] || {},\n      user: userMap[l.userId] || {},\n    }));\n\n    // Get maintenance for this group\n    let maintenance: any[] = [];\n    try {\n      const maintResult = await prisma.$queryRawUnsafe(`\n        SELECT TOP 20 m.*, a.nNumber, a.customName, a.nickname\n        FROM Maintenance m\n        JOIN ClubAircraft a ON m.aircraftId = a.id\n        WHERE a.groupId = '${groupId}'\n        ORDER BY m.reportedDate DESC\n      `);\n      maintenance = maintResult as any[];\n    } catch (e) {\n      console.error('Error fetching maintenance:', e);\n    }\n\n    const formattedMaintenance = (maintenance || []).map((m: any) => ({\n      id: m.id,\n      aircraftId: m.aircraftId,\n      userId: m.userId,\n      groupId: m.groupId,\n      description: m.description,\n      notes: m.notes,\n      status: m.status,\n      cost: m.cost ? Number(m.cost) : null,\n      isGrounded: m.isGrounded,\n      reportedDate: m.reportedDate,\n      resolvedDate: m.resolvedDate,\n      createdAt: m.createdAt,\n      updatedAt: m.updatedAt,\n      aircraft: {\n        id: m.aircraftId,\n        nNumber: m.nNumber,\n        customName: m.customName,\n        nickname: m.nickname,\n      },\n    }));\n\n    return NextResponse.json({ logs: formattedLogs, maintenance: formattedMaintenance });\n  } catch (error) {\n    console.error('Error fetching logs:', error);\n    return NextResponse.json({ \n      error: 'Failed to fetch flight logs', \n      details: String(error),\n      stack: error instanceof Error ? error.stack : undefined\n    }, { status: 500 });\n  }\n}\n\n// POST create a flight log\nexport async function POST(request: Request, { params }: RouteParams) {\n  try {\n    const session = await auth();\n    if (!session?.user?.email) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const { groupId } = await params;\n    if (!isUuid(groupId)) {\n      return NextResponse.json({ error: 'Invalid groupId' }, { status: 400 });\n    }\n    \n    // Get user by email using raw SQL\n    const users = await prisma.$queryRawUnsafe(`\n      SELECT id FROM [User] WHERE email = '${session.user.email}'\n    `) as any[];\n    \n    if (!users || users.length === 0) {\n      return NextResponse.json({ error: '[User] not found' }, { status: 404 });\n    }\n    \n    const userId = users[0].id;\n    \n    // Check membership and role (MEMBER or ADMIN can log flights)\n    const memberships = await prisma.$queryRawUnsafe(`\n      SELECT * FROM GroupMember WHERE groupId = '${groupId}' AND userId = '${userId}' AND role IN ('MEMBER', 'ADMIN')\n    `) as any[];\n\n    if (!memberships || memberships.length === 0) {\n      return NextResponse.json({ error: 'Only members can log flights' }, { status: 403 });\n    }\n\n    const body = await request.json();\n    const { \n      aircraftId, \n      date, \n      tachStart, \n      tachEnd,\n      hobbsStart, \n      hobbsEnd, \n      notes,\n      maintenance \n    } = body;\n\n    // Calculate hours\n    const hobbsUsed = (hobbsEnd && hobbsStart) ? (parseFloat(hobbsEnd) - parseFloat(hobbsStart)) : 0;\n    const tachUsed = (tachEnd && tachStart) ? (parseFloat(tachEnd) - parseFloat(tachStart)) : 0;\n\n    // Create log using raw SQL\n    const logId = crypto.randomUUID();\n    const dateStr = new Date(date).toISOString();\n    \n    await prisma.$executeRawUnsafe(`\n      INSERT INTO FlightLog (id, aircraftId, userId, date, tachTime, hobbsTime, notes, createdAt, updatedAt)\n      VALUES ('${logId}', '${aircraftId}', '${userId}', '${dateStr}', ${tachUsed || 'NULL'}, ${hobbsUsed || 'NULL'}, ${notes ? \"'\" + notes.replace(/'/g, \"''\") + \"'\" : 'NULL'}, GETDATE(), GETDATE())\n    `);\n\n    // Create maintenance if provided\n    if (maintenance && maintenance.description) {\n      const maintId = crypto.randomUUID();\n      await prisma.$executeRawUnsafe(`\n        INSERT INTO Maintenance (id, aircraftId, userId, groupId, description, notes, status, isGrounded, reportedDate, createdAt, updatedAt)\n        VALUES ('${maintId}', '${aircraftId}', '${userId}', '${groupId}', '${maintenance.description.replace(/'/g, \"''\")}', ${maintenance.notes ? \"'\" + maintenance.notes.replace(/'/g, \"''\") + \"'\" : 'NULL'}, 'NEEDED', 0, GETDATE(), GETDATE(), GETDATE())\n      `);\n    }\n\n    // Fetch created log\n    const logs = await prisma.$queryRawUnsafe(`\n      SELECT fl.*, a.nNumber, a.customName, a.nickname\n      FROM FlightLog fl\n      JOIN ClubAircraft a ON fl.aircraftId = a.id\n      WHERE fl.id = '${logId}'\n    `) as any[];\n\n    const l = logs[0];\n    return NextResponse.json({\n      id: l.id,\n      aircraftId: l.aircraftId,\n      userId: l.userId,\n      date: l.date,\n      tachTime: l.tachTime ? Number(l.tachTime) : null,\n      hobbsTime: l.hobbsTime ? Number(l.hobbsTime) : null,\n      notes: l.notes,\n      createdAt: l.createdAt,\n      aircraft: {\n        id: l.aircraftId,\n        nNumber: l.nNumber,\n        customName: l.customName,\n        nickname: l.nickname,\n      },\n    });\n  } catch (error) {\n    console.error('Error creating flight log:', error);\n    return NextResponse.json({ error: 'Failed to create flight log', details: String(error) }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\groups\\[groupId]\\members\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":28,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[856,859],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[856,859],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":42,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1289,1292],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1289,1292],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1462,1465],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1462,1465],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":57,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1843,1846],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1843,1846],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":64,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2096,2099],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2096,2099],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":70,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2339,2342],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2339,2342],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":103,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3287,3290],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3287,3290],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":114,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3661,3664],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3661,3664],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":147,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":147,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4729,4732],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4729,4732],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":165,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":165,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5288,5291],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5288,5291],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":177,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":177,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5750,5753],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5750,5753],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":11,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth } from '@/lib/auth';\nimport { prisma } from '@/lib/prisma';\nimport { isUuid } from '@/lib/validate';\n\ninterface RouteParams {\n  params: Promise<{ groupId: string }>;\n}\n\n// GET members of a group\nexport async function GET(request: Request, { params }: RouteParams) {\n  try {\n    const session = await auth();\n    if (!session?.user?.email) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const { groupId } = await params;\n    if (!isUuid(groupId)) {\n      return NextResponse.json({ error: 'Invalid groupId' }, { status: 400 });\n    }\n    \n    // Get user by email using raw SQL\n    let userId: string | null = null;\n    try {\n      const users = await prisma.$queryRawUnsafe(`\n        SELECT id FROM [User] WHERE email = '${session.user.email}'\n      `) as any[];\n      if (users && users.length > 0) {\n        userId = users[0].id;\n      }\n    } catch (e) {\n      console.error('Error fetching user:', e);\n      return NextResponse.json({ error: 'Failed to find user', details: String(e) }, { status: 500 });\n    }\n    \n    if (!userId) {\n      return NextResponse.json({ error: '[User] not found' }, { status: 404 });\n    }\n    \n    // Check membership using raw SQL\n    let memberships: any[] = [];\n    try {\n      memberships = await prisma.$queryRawUnsafe(`\n        SELECT * FROM GroupMember WHERE groupId = '${groupId}' AND userId = '${userId}'\n      `) as any[];\n    } catch (e) {\n      console.error('Error checking membership:', e);\n      return NextResponse.json({ error: 'Failed to check membership', details: String(e) }, { status: 500 });\n    }\n\n    if (!memberships || memberships.length === 0) {\n      return NextResponse.json({ error: 'Not a member' }, { status: 403 });\n    }\n\n    // Get members using raw SQL\n    let members: any[] = [];\n    try {\n      members = await prisma.$queryRawUnsafe(`\n        SELECT gm.*, u.name as userName, u.email as userEmail\n        FROM GroupMember gm\n        JOIN [User] u ON gm.userId = u.id\n        WHERE gm.groupId = '${groupId}'\n      `) as any[];\n    } catch (e) {\n      console.error('Error fetching members:', e);\n      return NextResponse.json({ error: 'Failed to fetch members', details: String(e) }, { status: 500 });\n    }\n\n    const formattedMembers = (members || []).map((m: any) => ({\n      id: m.id,\n      userId: m.userId,\n      groupId: m.groupId,\n      role: m.role,\n      joinedAt: m.joinedAt,\n      user: {\n        id: m.userId,\n        name: m.userName,\n        email: m.userEmail\n      }\n    }));\n\n    return NextResponse.json(formattedMembers);\n  } catch (error) {\n    console.error('Error fetching members:', error);\n    return NextResponse.json({ error: 'Failed to fetch members', details: String(error) }, { status: 500 });\n  }\n}\n\n// PUT update a member's role (admin only)\nexport async function PUT(request: Request, { params }: RouteParams) {\n  try {\n    const session = await auth();\n    if (!session?.user?.email) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const { groupId } = await params;\n    \n    // Get user by email using raw SQL\n    const users = await prisma.$queryRawUnsafe(`\n      SELECT id FROM [User] WHERE email = '${session.user.email}'\n    `) as any[];\n    \n    if (!users || users.length === 0) {\n      return NextResponse.json({ error: '[User] not found' }, { status: 404 });\n    }\n    \n    const userId = users[0].id;\n    \n    // Check admin role\n    const memberships = await prisma.$queryRawUnsafe(`\n      SELECT * FROM GroupMember WHERE groupId = '${groupId}' AND userId = '${userId}' AND role = 'ADMIN'\n    `) as any[];\n\n    if (!memberships || memberships.length === 0) {\n      return NextResponse.json({ error: 'Only admins can update members' }, { status: 403 });\n    }\n\n    const body = await request.json();\n    const { memberId, role } = body;\n\n    await prisma.$executeRawUnsafe(`\n      UPDATE GroupMember SET role = '${role}' WHERE id = '${memberId}'\n    `);\n\n    return NextResponse.json({ success: true });\n  } catch (error) {\n    console.error('Error updating member:', error);\n    return NextResponse.json({ error: 'Failed to update member', details: String(error) }, { status: 500 });\n  }\n}\n\n// DELETE remove a member from group\nexport async function DELETE(request: Request, { params }: RouteParams) {\n  try {\n    const session = await auth();\n    if (!session?.user?.email) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const { groupId } = await params;\n    \n    // Get user by email using raw SQL\n    const users = await prisma.$queryRawUnsafe(`\n      SELECT id FROM [User] WHERE email = '${session.user.email}'\n    `) as any[];\n    \n    if (!users || users.length === 0) {\n      return NextResponse.json({ error: '[User] not found' }, { status: 404 });\n    }\n    \n    const userId = users[0].id;\n    \n    const url = new URL(request.url);\n    const memberId = url.searchParams.get('memberId');\n\n    if (!memberId) {\n      return NextResponse.json({ error: 'memberId required' }, { status: 400 });\n    }\n\n    // Get target member\n    const targetMembers = await prisma.$queryRawUnsafe(`\n      SELECT * FROM GroupMember WHERE id = '${memberId}' AND groupId = '${groupId}'\n    `) as any[];\n\n    if (!targetMembers || targetMembers.length === 0) {\n      return NextResponse.json({ error: 'Member not found' }, { status: 404 });\n    }\n\n    const targetMember = targetMembers[0];\n    const isSelfRemoval = targetMember.userId === userId;\n    \n    // Check if user is admin\n    const adminMemberships = await prisma.$queryRawUnsafe(`\n      SELECT * FROM GroupMember WHERE groupId = '${groupId}' AND userId = '${userId}' AND role = 'ADMIN'\n    `) as any[];\n\n    if ((!adminMemberships || adminMemberships.length === 0) && !isSelfRemoval) {\n      return NextResponse.json({ error: 'Not authorized' }, { status: 403 });\n    }\n\n    await prisma.$executeRawUnsafe(`DELETE FROM GroupMember WHERE id = '${memberId}'`);\n\n    return NextResponse.json({ success: true });\n  } catch (error) {\n    console.error('Error removing member:', error);\n    return NextResponse.json({ error: 'Failed to remove member', details: String(error) }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\groups\\[groupId]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":25,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[776,779],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[776,779],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":36,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1145,1148],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1145,1148],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":45,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1457,1460],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1457,1460],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":59,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1863,1866],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1863,1866],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":64,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2015,2018],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2015,2018],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":85,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2729,2732],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2729,2732],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":97,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3025,3028],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3025,3028],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":141,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":141,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4514,4517],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4514,4517],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":152,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":152,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4902,4905],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4902,4905],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":191,"column":105,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":191,"endColumn":108,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7165,7168],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7165,7168],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":214,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":214,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7951,7954],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7951,7954],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":225,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":225,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8284,8287],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8284,8287],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":12,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth } from '@/lib/auth';\nimport { prisma } from '@/lib/prisma';\nimport { isUuid } from '@/lib/validate';\n\ninterface RouteParams {\n  params: Promise<{ groupId: string }>;\n}\n\nexport async function GET(request: Request, { params }: RouteParams) {\n  try {\n    const session = await auth();\n    if (!session?.user?.email) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const { groupId } = await params;\n    if (!isUuid(groupId)) {\n      return NextResponse.json({ error: 'Invalid groupId' }, { status: 400 });\n    }\n    \n    // Get user by email using raw SQL\n    const users = await prisma.$queryRawUnsafe(`\n      SELECT id FROM [User] WHERE email = '${session.user.email}'\n    `) as any[];\n    \n    if (!users || users.length === 0) {\n      return NextResponse.json({ error: '[User] not found' }, { status: 404 });\n    }\n    \n    const userId = users[0].id;\n    \n    // Check membership using raw SQL\n    const memberships = await prisma.$queryRawUnsafe(`\n      SELECT * FROM GroupMember WHERE groupId = '${groupId}' AND userId = '${userId}'\n    `) as any[];\n\n    if (!memberships || memberships.length === 0) {\n      return NextResponse.json({ error: 'Not a member of this group' }, { status: 403 });\n    }\n\n    // Get group details using raw SQL\n    const groups = await prisma.$queryRawUnsafe(`\n      SELECT * FROM FlyingGroup WHERE id = '${groupId}'\n    `) as any[];\n\n    if (!groups || groups.length === 0) {\n      return NextResponse.json({ error: 'Group not found' }, { status: 404 });\n    }\n\n    const g = groups[0];\n\n    // Get members\n    const members = await prisma.$queryRawUnsafe(`\n      SELECT gm.*, u.name as userName, u.email as userEmail\n      FROM GroupMember gm\n      JOIN [User] u ON gm.userId = u.id\n      WHERE gm.groupId = '${groupId}'\n    `) as any[];\n\n    // Get aircraft\n    const aircraft = await prisma.$queryRawUnsafe(`\n      SELECT * FROM ClubAircraft WHERE groupId = '${groupId}'\n    `) as any[];\n\n    const formattedGroup = {\n      id: g.id,\n      name: g.name,\n      description: g.description,\n      ownerId: g.ownerId,\n      dryRate: g.dryRate ? Number(g.dryRate) : null,\n      wetRate: g.wetRate ? Number(g.wetRate) : null,\n      customRates: g.customRates,\n      showBookings: g.showBookings,\n      showAircraft: g.showAircraft,\n      showFlights: g.showFlights,\n      showMaintenance: g.showMaintenance,\n      showBilling: g.showBilling,\n      showBillingAll: g.showBillingAll,\n      showMembers: g.showMembers,\n      showPartners: g.showPartners,\n      defaultInviteExpiry: g.defaultInviteExpiry,\n      createdAt: g.createdAt,\n      updatedAt: g.updatedAt,\n      members: (members || []).map((m: any) => ({\n        id: m.id,\n        userId: m.userId,\n        groupId: m.groupId,\n        role: m.role,\n        joinedAt: m.joinedAt,\n        user: {\n          id: m.userId,\n          name: m.userName,\n          email: m.userEmail,\n        },\n      })),\n      aircraft: (aircraft || []).map((a: any) => ({\n        id: a.id,\n        groupId: a.groupId,\n        nNumber: a.nNumber,\n        nickname: a.nickname,\n        customName: a.customName,\n        make: a.make,\n        model: a.model,\n        year: a.year,\n        totalTachHours: a.totalTachHours ? Number(a.totalTachHours) : null,\n        totalHobbsHours: a.totalHobbsHours ? Number(a.totalHobbsHours) : null,\n        registrationType: a.registrationType,\n        hasInsurance: a.hasInsurance,\n        maxPassengers: a.maxPassengers,\n        hourlyRate: a.hourlyRate ? Number(a.hourlyRate) : null,\n        aircraftNotes: a.aircraftNotes,\n        status: a.status,\n        createdAt: a.createdAt,\n        updatedAt: a.updatedAt,\n      })),\n    };\n\n    return NextResponse.json(formattedGroup);\n  } catch (error) {\n    console.error('Error fetching group:', error);\n    return NextResponse.json({ error: 'Failed to fetch group', details: String(error) }, { status: 500 });\n  }\n}\n\nexport async function PUT(request: Request, { params }: RouteParams) {\n  try {\n    const session = await auth();\n    if (!session?.user?.email) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const { groupId } = await params;\n    if (!isUuid(groupId)) {\n      return NextResponse.json({ error: 'Invalid groupId' }, { status: 400 });\n    }\n    \n    // Get user by email using raw SQL\n    const users = await prisma.$queryRawUnsafe(`\n      SELECT id FROM [User] WHERE email = '${session.user.email}'\n    `) as any[];\n    \n    if (!users || users.length === 0) {\n      return NextResponse.json({ error: '[User] not found' }, { status: 404 });\n    }\n    \n    const userId = users[0].id;\n    \n    // Check admin role using raw SQL\n    const memberships = await prisma.$queryRawUnsafe(`\n      SELECT * FROM GroupMember WHERE groupId = '${groupId}' AND userId = '${userId}' AND role = 'ADMIN'\n    `) as any[];\n\n    if (!memberships || memberships.length === 0) {\n      return NextResponse.json({ error: 'Only admins can update the group' }, { status: 403 });\n    }\n\n    const body = await request.json();\n    const { \n      name, description, dryRate, wetRate, customRates,\n      showBookings, showAircraft, showFlights, showMaintenance, \n      showBilling, showBillingAll, showMembers, showPartners,\n      defaultInviteExpiry\n    } = body;\n\n    // Build update query\n    const updates: string[] = [];\n    if (name !== undefined) updates.push(`name = '${name.replace(/'/g, \"''\")}'`);\n    if (description !== undefined) updates.push(`description = ${description ? \"'\" + description.replace(/'/g, \"''\") + \"'\" : 'NULL'}`);\n    if (dryRate !== undefined) updates.push(`dryRate = ${dryRate ? parseFloat(dryRate) : 'NULL'}`);\n    if (wetRate !== undefined) updates.push(`wetRate = ${wetRate ? parseFloat(wetRate) : 'NULL'}`);\n    if (customRates !== undefined) updates.push(`customRates = '${JSON.stringify(customRates).replace(/'/g, \"''\")}'`);\n    if (showBookings !== undefined) updates.push(`showBookings = ${showBookings ? 1 : 0}`);\n    if (showAircraft !== undefined) updates.push(`showAircraft = ${showAircraft ? 1 : 0}`);\n    if (showFlights !== undefined) updates.push(`showFlights = ${showFlights ? 1 : 0}`);\n    if (showMaintenance !== undefined) updates.push(`showMaintenance = ${showMaintenance ? 1 : 0}`);\n    if (showBilling !== undefined) updates.push(`showBilling = ${showBilling ? 1 : 0}`);\n    if (showBillingAll !== undefined) updates.push(`showBillingAll = ${showBillingAll ? 1 : 0}`);\n    if (showMembers !== undefined) updates.push(`showMembers = ${showMembers ? 1 : 0}`);\n    if (showPartners !== undefined) updates.push(`showPartners = ${showPartners ? 1 : 0}`);\n    if (defaultInviteExpiry !== undefined) updates.push(`defaultInviteExpiry = ${defaultInviteExpiry !== null ? defaultInviteExpiry : 'NULL'}`);\n\n    if (updates.length > 0) {\n      updates.push(`updatedAt = GETDATE()`);\n      await prisma.$executeRawUnsafe(`\n        UPDATE FlyingGroup SET ${updates.join(', ')} WHERE id = '${groupId}'\n      `);\n    }\n\n    // Fetch updated group\n    const groups = await prisma.$queryRawUnsafe(`SELECT * FROM FlyingGroup WHERE id = '${groupId}'`) as any[];\n    return NextResponse.json(groups[0]);\n  } catch (error) {\n    console.error('Error updating group:', error);\n    return NextResponse.json({ error: 'Failed to update group', details: String(error) }, { status: 500 });\n  }\n}\n\nexport async function DELETE(request: Request, { params }: RouteParams) {\n  try {\n    const session = await auth();\n    if (!session?.user?.email) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const { groupId } = await params;\n    if (!isUuid(groupId)) {\n      return NextResponse.json({ error: 'Invalid groupId' }, { status: 400 });\n    }\n    \n    // Get user by email using raw SQL\n    const users = await prisma.$queryRawUnsafe(`\n      SELECT id FROM [User] WHERE email = '${session.user.email}'\n    `) as any[];\n    \n    if (!users || users.length === 0) {\n      return NextResponse.json({ error: '[User] not found' }, { status: 404 });\n    }\n    \n    const userId = users[0].id;\n    \n    // Check ownership using raw SQL\n    const groups = await prisma.$queryRawUnsafe(`\n      SELECT * FROM FlyingGroup WHERE id = '${groupId}'\n    `) as any[];\n\n    if (!groups || groups.length === 0) {\n      return NextResponse.json({ error: 'Group not found' }, { status: 404 });\n    }\n\n    if (groups[0].ownerId !== userId) {\n      return NextResponse.json({ error: 'Only the owner can delete this group' }, { status: 403 });\n    }\n\n    await prisma.$executeRawUnsafe(`DELETE FROM FlyingGroup WHERE id = '${groupId}'`);\n\n    return NextResponse.json({ success: true });\n  } catch (error) {\n    console.error('Error deleting group:', error);\n    return NextResponse.json({ error: 'Failed to delete group' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\groups\\all-bookings\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":15,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[471,474],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[471,474],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":49,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1416,1419],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1416,1419],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":51,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1479,1482],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1479,1482],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth } from '@/lib/auth';\nimport { prisma } from '@/lib/prisma';\n\nexport async function GET() {\n  try {\n    const session = await auth();\n    if (!session?.user?.email) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Get user by email using raw SQL\n    const users = await prisma.$queryRawUnsafe(`\n      SELECT id FROM [User] WHERE email = '${session.user.email}'\n    `) as any[];\n    \n    if (!users || users.length === 0) {\n      return NextResponse.json({ error: '[User] not found' }, { status: 404 });\n    }\n    \n    const userId = users[0].id;\n\n    // Get all bookings for user's groups using raw SQL\n    const bookings = await prisma.$queryRawUnsafe(`\n      SELECT \n        b.id,\n        b.aircraftId,\n        b.userId,\n        b.startTime,\n        b.endTime,\n        b.purpose,\n        b.createdAt,\n        b.updatedAt,\n        a.nNumber,\n        a.customName,\n        a.nickname,\n        a.make,\n        a.model,\n        a.groupId as aircraftGroupId,\n        fg.name as groupName,\n        u.name as userName,\n        u.email as userEmail\n      FROM Booking b\n      JOIN ClubAircraft a ON b.aircraftId = a.id\n      JOIN FlyingGroup fg ON a.groupId = fg.id\n      JOIN GroupMember gm ON fg.id = gm.groupId AND gm.userId = '${userId}'\n      JOIN [User] u ON b.userId = u.id\n      ORDER BY b.startTime ASC\n    `) as any[];\n\n    const formattedBookings = (bookings || []).map((b: any) => ({\n      id: b.id,\n      aircraftId: b.aircraftId,\n      userId: b.userId,\n      startTime: b.startTime,\n      endTime: b.endTime,\n      purpose: b.purpose,\n      createdAt: b.createdAt,\n      updatedAt: b.updatedAt,\n      aircraft: {\n        id: b.aircraftId,\n        nNumber: b.nNumber,\n        customName: b.customName,\n        nickname: b.nickname,\n        make: b.make,\n        model: b.model,\n        groupName: b.groupName,\n      },\n      groupName: b.groupName,\n      user: {\n        id: b.userId,\n        name: b.userName,\n        email: b.userEmail,\n      },\n    }));\n\n    return NextResponse.json(formattedBookings);\n  } catch (error) {\n    console.error('Error fetching all bookings:', error);\n    return NextResponse.json([]);\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\groups\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":15,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[488,491],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[488,491],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":43,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1311,1314],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1311,1314],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":51,"column":107,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":110,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2078,2081],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2078,2081],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":64,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2442,2445],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2442,2445],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":102,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3700,3703],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3700,3703],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":120,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":120,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4459,4462],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4459,4462],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":128,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":128,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4725,4728],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4725,4728],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-const","severity":2,"message":"'aircraftMap' is never reassigned. Use 'const' instead.","line":129,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":129,"endColumn":43,"fix":{"range":[4744,4788],"text":"const aircraftMap: Record<string, any[]> = {};"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":129,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":129,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4776,4779],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4776,4779],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":137,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":137,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5100,5103],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5100,5103],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":140,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":140,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5180,5183],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5180,5183],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":156,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":156,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5666,5669],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5666,5669],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":12,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth } from '@/lib/auth';\nimport { prisma } from '@/lib/prisma';\n\nexport async function POST(request: Request) {\n  try {\n    const session = await auth();\n    if (!session?.user?.email) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Get user by email using raw SQL\n    const users = await prisma.$queryRawUnsafe(`\n      SELECT id FROM [User] WHERE email = '${session.user.email}'\n    `) as any[];\n\n    if (!users || users.length === 0) {\n      return NextResponse.json({ error: '[User] not found' }, { status: 404 });\n    }\n\n    const userId = users[0].id;\n\n    const body = await request.json();\n    const { name, description, dryRate, wetRate, customRates } = body;\n\n    if (!name) {\n      return NextResponse.json({ error: 'Name is required' }, { status: 400 });\n    }\n\n    // Try using Prisma create with error handling\n    let group;\n    try {\n      group = await prisma.flyingGroup.create({\n        data: {\n          name,\n          description,\n          ownerId: userId,\n          dryRate: dryRate ? parseFloat(dryRate) : null,\n          wetRate: wetRate ? parseFloat(wetRate) : null,\n          customRates: customRates ? JSON.stringify(customRates) : null,\n        },\n      });\n    } catch (prismaError: any) {\n      console.error('Prisma error creating group:', prismaError);\n      // If Prisma fails, try raw SQL\n      const groupId = crypto.randomUUID();\n      await prisma.$executeRawUnsafe(`\n        INSERT INTO FlyingGroup (id, name, description, ownerId, dryRate, wetRate, customRates, createdAt, updatedAt)\n        VALUES ('${groupId}', '${name.replace(/'/g, \"''\")}', ${description ? \"'\" + description.replace(/'/g, \"''\") + \"'\" : 'NULL'}, '${userId}', ${dryRate ? parseFloat(dryRate) : 'NULL'}, ${wetRate ? parseFloat(wetRate) : 'NULL'}, ${customRates ? \"'\" + JSON.stringify(customRates).replace(/'/g, \"''\") + \"'\" : 'NULL'}, GETDATE(), GETDATE())\n      `);\n      const groups = await prisma.$queryRawUnsafe(`SELECT * FROM FlyingGroup WHERE id = '${groupId}'`) as any[];\n      group = { id: groups[0].id, name: groups[0].name, description: groups[0].description, ownerId: groups[0].ownerId };\n    }\n\n    // Add creator as admin member\n    try {\n      await prisma.groupMember.create({\n        data: {\n          userId: userId,\n          groupId: group.id,\n          role: 'ADMIN',\n        },\n      });\n    } catch (prismaError: any) {\n      console.error('Prisma error adding member:', prismaError);\n      // Try raw SQL\n      const memberId = crypto.randomUUID();\n      await prisma.$executeRawUnsafe(`\n        INSERT INTO GroupMember (id, userId, groupId, role, joinedAt)\n        VALUES ('${memberId}', '${userId}', '${group.id}', 'ADMIN', GETDATE())\n      `);\n    }\n\n    return NextResponse.json({\n      id: group.id,\n      name: group.name,\n      description: group.description,\n      ownerId: group.ownerId,\n      dryRate: group.dryRate ? Number(group.dryRate) : null,\n      wetRate: group.wetRate ? Number(group.wetRate) : null,\n      customRates: group.customRates,\n      createdAt: group.createdAt,\n      updatedAt: group.updatedAt,\n    });\n  } catch (error) {\n    console.error('Error creating group:', error);\n    return NextResponse.json({ error: 'Failed to create group', details: String(error) }, { status: 500 });\n  }\n}\n\nexport async function GET() {\n  try {\n    const session = await auth();\n    if (!session?.user?.email) {\n      console.log('No session found');\n      return NextResponse.json([]);\n    }\n\n    // Get user by email using raw SQL\n    const users = await prisma.$queryRawUnsafe(`\n      SELECT id FROM [User] WHERE email = '${session.user.email}'\n    `) as any[];\n\n    if (!users || users.length === 0) {\n      console.log('[User] not found for email:', session.user.email);\n      return NextResponse.json([]);\n    }\n\n    const userId = users[0].id;\n    console.log('Fetching groups for user:', userId);\n    console.log('[User] email:', session.user.email);\n\n    // Use raw SQL - SQL Server doesn't support ? placeholders in $queryRawUnsafe\n    // userId is a UUID from auth, so string interpolation is safe\n    const memberships = await prisma.$queryRawUnsafe(`\n      SELECT gm.role, fg.id, fg.name, fg.description, fg.ownerId, fg.dryRate, fg.wetRate, fg.customRates, fg.createdAt, fg.updatedAt\n      FROM GroupMember gm\n      JOIN FlyingGroup fg ON gm.groupId = fg.id\n      WHERE gm.userId = '${userId}'\n    `) as any[];\n\n    console.log('Memberships SQL:', memberships);\n    console.log('Memberships count:', memberships?.length || 0);\n\n    console.log('Memberships found:', memberships.length);\n\n    // Now fetch aircraft for each group\n    const groupIds = memberships.map((m: any) => m.id);\n    let aircraftMap: Record<string, any[]> = {};\n    \n    if (groupIds.length > 0) {\n      const aircraftList = await prisma.$queryRawUnsafe(`\n        SELECT a.*, fg.name as groupName\n        FROM ClubAircraft a\n        JOIN FlyingGroup fg ON a.groupId = fg.id\n        WHERE a.groupId IN (${groupIds.map((id: string) => \"'\" + id + \"'\").join(',')})\n      `) as any[];\n      \n      // Group aircraft by groupId\n      aircraftList.forEach((a: any) => {\n        if (!aircraftMap[a.groupId]) aircraftMap[a.groupId] = [];\n        aircraftMap[a.groupId].push({\n          id: a.id,\n          nNumber: a.nNumber,\n          nickname: a.nickname,\n          customName: a.customName,\n          make: a.make,\n          model: a.model,\n          status: a.status,\n          hourlyRate: a.hourlyRate ? Number(a.hourlyRate) : null,\n          aircraftNotes: a.aircraftNotes,\n        });\n      });\n    }\n\n    const groups = memberships.map((m: any) => ({\n      id: m.id,\n      name: m.name,\n      description: m.description,\n      ownerId: m.ownerId,\n      dryRate: m.dryRate ? Number(m.dryRate) : null,\n      wetRate: m.wetRate ? Number(m.wetRate) : null,\n      customRates: m.customRates,\n      createdAt: m.createdAt,\n      updatedAt: m.updatedAt,\n      role: m.role,\n      aircraft: aircraftMap[m.id] || [],\n    }));\n    \n    return NextResponse.json(groups);\n  } catch (error) {\n    console.error('Error fetching groups:', error);\n    // Return empty array instead of error to allow app to work\n    return NextResponse.json([]);\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\instructors\\certificates\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\instructors\\profile\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\integrations\\quickbooks\\callback\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'integration' is assigned a value but never used.","line":54,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":54,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { prisma } from '@/lib/prisma'\nimport { QuickBooksClient } from '@/lib/integrations/quickbooks-client'\n\n/**\n * GET /api/integrations/quickbooks/callback\n * \n * OAuth callback from QuickBooks\n * Exchanges authorization code for access/refresh tokens\n * Creates or updates Integration record in database\n */\nexport async function GET(request: NextRequest) {\n  try {\n    const searchParams = request.nextUrl.searchParams\n    const code = searchParams.get('code')\n    const state = searchParams.get('state')\n    const realmId = searchParams.get('realmId')\n    const error = searchParams.get('error')\n\n    // Check for OAuth errors\n    if (error) {\n      return NextResponse.redirect(\n        new URL(`/flying-club/manage/add-ons?error=${error}`, request.url)\n      )\n    }\n\n    if (!code || !state || !realmId) {\n      return NextResponse.redirect(\n        new URL('/flying-club/manage/add-ons?error=missing_parameters', request.url)\n      )\n    }\n\n    // Extract groupId from state (format: \"groupId:randomState\")\n    const [groupId] = state.split(':')\n\n    if (!groupId) {\n      return NextResponse.redirect(\n        new URL('/flying-club/manage/add-ons?error=invalid_state', request.url)\n      )\n    }\n\n    // TODO: Verify state matches what we stored (CSRF protection)\n    // In production, check session storage for the state token\n\n    // Exchange code for tokens\n    const client = new QuickBooksClient()\n    const tokens = await client.exchangeCodeForToken(code)\n\n    // Calculate token expiry\n    const tokenExpiry = new Date()\n    tokenExpiry.setSeconds(tokenExpiry.getSeconds() + tokens.expiresIn)\n\n    // Create or update integration record\n    const integration = await prisma.integration.upsert({\n      where: {\n        groupId_provider: {\n          groupId: groupId,\n          provider: 'quickbooks',\n        },\n      },\n      create: {\n        groupId: groupId,\n        provider: 'quickbooks',\n        status: 'connected',\n        accessToken: tokens.accessToken,\n        refreshToken: tokens.refreshToken,\n        tokenExpiry: tokenExpiry,\n        realmId: tokens.realmId || realmId,\n        lastSyncStatus: 'success',\n      },\n      update: {\n        status: 'connected',\n        accessToken: tokens.accessToken,\n        refreshToken: tokens.refreshToken,\n        tokenExpiry: tokenExpiry,\n        realmId: tokens.realmId || realmId,\n        lastSyncStatus: 'success',\n        updatedAt: new Date(),\n      },\n    })\n\n    // Redirect back to add-ons page with success message\n    return NextResponse.redirect(\n      new URL('/flying-club/manage/add-ons?success=quickbooks_connected', request.url)\n    )\n  } catch (error) {\n    console.error('QuickBooks callback error:', error)\n    return NextResponse.redirect(\n      new URL('/flying-club/manage/add-ons?error=connection_failed', request.url)\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\integrations\\quickbooks\\connect\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\integrations\\quickbooks\\disconnect\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\integrations\\quickbooks\\status\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\integrations\\quickbooks\\sync\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":219,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":219,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6877,6880],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6877,6880],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":250,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":250,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7599,7602],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7599,7602],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { auth } from '@/lib/auth'\nimport { prisma } from '@/lib/prisma'\nimport { QuickBooksClient } from '@/lib/integrations/quickbooks-client'\n\n/**\n * POST /api/integrations/quickbooks/sync\n * \n * Manually trigger QuickBooks sync\n * Syncs invoices, payments, and customers\n */\nexport async function POST(request: NextRequest) {\n  try {\n    const session = await auth()\n    \n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    const { groupId, syncType } = await request.json()\n\n    if (!groupId) {\n      return NextResponse.json({ error: 'groupId required' }, { status: 400 })\n    }\n\n    // TODO: Verify user has admin access to this group\n\n    // Find integration\n    const integration = await prisma.integration.findUnique({\n      where: {\n        groupId_provider: {\n          groupId: groupId,\n          provider: 'quickbooks',\n        },\n      },\n    })\n\n    if (!integration || integration.status !== 'connected') {\n      return NextResponse.json({ error: 'QuickBooks not connected' }, { status: 400 })\n    }\n\n    // Create sync log\n    const syncLog = await prisma.syncLog.create({\n      data: {\n        integrationId: integration.id,\n        syncType: syncType || 'manual',\n        direction: 'to_qb',\n        status: 'pending',\n        recordsTotal: 0,\n        recordsSuccess: 0,\n        recordsFailed: 0,\n      },\n    })\n\n    const startTime = Date.now()\n    let recordsTotal = 0\n    let recordsSuccess = 0\n    let recordsFailed = 0\n    let errorMessage = null\n\n    try {\n      const client = new QuickBooksClient({}, integration.id)\n\n      // Get company info to verify connection\n      const companyInfo = await client.getCompanyInfo(integration.realmId!)\n      console.log('QuickBooks company:', companyInfo.CompanyName)\n\n      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n      // Sync Members â†’ Customers\n      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n      if (!syncType || syncType === 'customers' || syncType === 'all') {\n        const members = await prisma.groupMember.findMany({\n          where: { groupId: groupId },\n          include: { user: true },\n        })\n\n        for (const member of members) {\n          recordsTotal++\n          \n          try {\n            // Check if customer already exists in QB\n            const mapping = await prisma.quickBooksMapping.findUnique({\n              where: {\n                integrationId_entityType_entityId: {\n                  integrationId: integration.id,\n                  entityType: 'member',\n                  entityId: member.id,\n                },\n              },\n            })\n\n            if (!mapping) {\n              // Create new customer in QuickBooks\n              const customer = await client.createCustomer({\n                DisplayName: member.user.name || member.user.email,\n                PrimaryEmailAddr: { Address: member.user.email },\n              }, integration.realmId!)\n\n              // Save mapping\n              await prisma.quickBooksMapping.create({\n                data: {\n                  integrationId: integration.id,\n                  entityType: 'member',\n                  entityId: member.id,\n                  entityName: member.user.name || member.user.email,\n                  qbType: 'Customer',\n                  qbId: customer.Id,\n                  qbName: customer.DisplayName,\n                },\n              })\n\n              recordsSuccess++\n            } else {\n              recordsSuccess++ // Already synced\n            }\n          } catch (error) {\n            console.error(`Failed to sync member ${member.id}:`, error)\n            recordsFailed++\n          }\n        }\n      }\n\n      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n      // Sync Aircraft Rates â†’ Items\n      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n      if (!syncType || syncType === 'items' || syncType === 'all') {\n        const aircraft = await prisma.clubAircraft.findMany({\n          where: { groupId: groupId },\n        })\n\n        for (const ac of aircraft) {\n          recordsTotal++\n          \n          try {\n            // Check if item already exists in QB\n            const mapping = await prisma.quickBooksMapping.findUnique({\n              where: {\n                integrationId_entityType_entityId: {\n                  integrationId: integration.id,\n                  entityType: 'aircraft',\n                  entityId: ac.id,\n                },\n              },\n            })\n\n            if (!mapping) {\n              // Create service item in QuickBooks\n              const item = await client.createItem({\n                Name: `${ac.nNumber || ac.nickname || ac.customName || 'Aircraft'} - Aircraft Rental`,\n                Type: 'Service',\n                IncomeAccountRef: {\n                  value: '1', // Default income account - should be configurable\n                },\n              }, integration.realmId!)\n\n              // Save mapping\n              await prisma.quickBooksMapping.create({\n                data: {\n                  integrationId: integration.id,\n                  entityType: 'aircraft',\n                  entityId: ac.id,\n                  entityName: ac.nNumber || ac.nickname || ac.customName || 'Aircraft',\n                  qbType: 'Item',\n                  qbId: item.Id,\n                  qbName: item.Name,\n                },\n              })\n\n              recordsSuccess++\n            } else {\n              recordsSuccess++ // Already synced\n            }\n          } catch (error) {\n            console.error(`Failed to sync aircraft ${ac.id}:`, error)\n            recordsFailed++\n          }\n        }\n      }\n\n      // Update sync log with success\n      const durationMs = Date.now() - startTime\n      await prisma.syncLog.update({\n        where: { id: syncLog.id },\n        data: {\n          status: recordsFailed > 0 ? 'partial' : 'success',\n          recordsTotal,\n          recordsSuccess,\n          recordsFailed,\n          completedAt: new Date(),\n          durationMs,\n          details: JSON.stringify({\n            syncType,\n            companyName: companyInfo.CompanyName,\n          }),\n        },\n      })\n\n      // Update integration last sync\n      await prisma.integration.update({\n        where: { id: integration.id },\n        data: {\n          lastSyncAt: new Date(),\n          lastSyncStatus: recordsFailed > 0 ? 'partial' : 'success',\n        },\n      })\n\n      return NextResponse.json({\n        success: true,\n        syncLog: {\n          id: syncLog.id,\n          status: recordsFailed > 0 ? 'partial' : 'success',\n          recordsTotal,\n          recordsSuccess,\n          recordsFailed,\n          durationMs,\n        },\n      })\n\n    } catch (error: any) {\n      errorMessage = error.message\n\n      // Update sync log with failure\n      const durationMs = Date.now() - startTime\n      await prisma.syncLog.update({\n        where: { id: syncLog.id },\n        data: {\n          status: 'error',\n          recordsTotal,\n          recordsSuccess,\n          recordsFailed,\n          errorMessage,\n          completedAt: new Date(),\n          durationMs,\n        },\n      })\n\n      // Update integration status\n      await prisma.integration.update({\n        where: { id: integration.id },\n        data: {\n          lastSyncAt: new Date(),\n          lastSyncStatus: 'error',\n          lastSyncError: errorMessage,\n        },\n      })\n\n      throw error\n    }\n\n  } catch (error: any) {\n    console.error('QuickBooks sync error:', error)\n    return NextResponse.json(\n      { error: error.message || 'Sync failed' },\n      { status: 500 }\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\invitations\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\logbook\\currency\\calc\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\logbook\\currency\\progress\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":19,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[418,421],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[418,421],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server'\nimport { auth } from '@/lib/auth'\nimport { prisma } from '@/lib/prisma'\nimport { addDays, subDays } from 'date-fns'\n\ntype ProgressRule = {\n  code: string\n  authority: 'FAA' | 'EASA'\n  name: string\n  status: 'current' | 'expiring' | 'expired'\n  progress: {\n    required: number\n    completed: number\n    unit: string\n  }[]\n  nextDueAt?: string | null\n}\n\nconst sum = (entries: any[], field: string) => entries.reduce((acc, e) => acc + (e[field] || 0), 0)\n\nexport async function GET() {\n  const session = await auth()\n  if (!session?.user?.id) {\n    return NextResponse.json({ error: 'Not authenticated' }, { status: 401 })\n  }\n\n  const now = new Date()\n  const user = await prisma.user.findUnique({\n    where: { id: session.user.id },\n    select: { bfrExpiry: true, medicalExpiry: true },\n  })\n\n  const entries = await prisma.logbookEntry.findMany({\n    where: { userId: session.user.id },\n    orderBy: { date: 'desc' },\n  })\n\n  const endorsements = await prisma.endorsement.findMany({\n    where: {\n      studentId: session.user.id,\n    },\n    select: { signedAt: true, template: { select: { code: true } } },\n    orderBy: { signedAt: 'desc' },\n  })\n\n  const lastFlightReview = endorsements.find((e) => e.template.code === 'FAA-61.56-FR')?.signedAt || null\n  const flightReviewDue = user?.bfrExpiry || (lastFlightReview ? addDays(new Date(lastFlightReview), 730) : null)\n\n  const nightCutoff = subDays(now, 90)\n  const nightEntries = entries.filter((e) => new Date(e.date) >= nightCutoff)\n  const nightLandings = sum(nightEntries, 'nightLandings')\n\n  const ipcCutoff = subDays(now, 183)\n  const ipcEntries = entries.filter((e) => new Date(e.date) >= ipcCutoff)\n  const approaches = sum(ipcEntries, 'approaches')\n  const holds = sum(ipcEntries, 'holds')\n  const intercepts = sum(ipcEntries, 'intercepts')\n\n  const sepCutoff = subDays(now, 365)\n  const sepEntries = entries.filter((e) => new Date(e.date) >= sepCutoff)\n  const sepTime = sum(sepEntries, 'totalTime')\n  const sepLandings = sum(sepEntries, 'dayLandings') + sum(sepEntries, 'nightLandings')\n  const sepInstructor = sum(sepEntries, 'dualReceived')\n\n  const lpcEndorsement = endorsements.find((e) => e.template.code === 'EASA-LPC-OPC')?.signedAt || null\n  const lpcDue = lpcEndorsement ? addDays(new Date(lpcEndorsement), 365) : null\n\n  const progress: ProgressRule[] = [\n    {\n      code: 'FAA-FR',\n      authority: 'FAA',\n      name: 'Flight Review (24 months)',\n      status: flightReviewDue ? (flightReviewDue < now ? 'expired' : 'current') : 'expired',\n      nextDueAt: flightReviewDue ? flightReviewDue.toISOString() : null,\n      progress: [{ required: 1, completed: flightReviewDue ? 1 : 0, unit: 'review' }],\n    },\n    {\n      code: 'FAA-IPC',\n      authority: 'FAA',\n      name: 'Instrument Proficiency (6 months)',\n      status: approaches >= 6 && holds >= 1 && intercepts >= 1 ? 'current' : 'expired',\n      progress: [\n        { required: 6, completed: approaches, unit: 'approaches' },\n        { required: 1, completed: holds, unit: 'holds' },\n        { required: 1, completed: intercepts, unit: 'intercepts' },\n      ],\n    },\n    {\n      code: 'FAA-NIGHT',\n      authority: 'FAA',\n      name: 'Night Landings (90 days)',\n      status: nightLandings >= 3 ? 'current' : 'expired',\n      progress: [{ required: 3, completed: nightLandings, unit: 'landings' }],\n    },\n    {\n      code: 'FAA-MED',\n      authority: 'FAA',\n      name: 'Medical Certificate',\n      status: user?.medicalExpiry ? (user.medicalExpiry < now ? 'expired' : 'current') : 'expired',\n      nextDueAt: user?.medicalExpiry ? user.medicalExpiry.toISOString() : null,\n      progress: [{ required: 1, completed: user?.medicalExpiry ? 1 : 0, unit: 'medical' }],\n    },\n    {\n      code: 'EASA-SEP',\n      authority: 'EASA',\n      name: 'SEP Revalidation (12 months)',\n      status: sepTime >= 12 && sepLandings >= 12 && sepInstructor >= 1 ? 'current' : 'expired',\n      progress: [\n        { required: 12, completed: sepTime, unit: 'hours' },\n        { required: 12, completed: sepLandings, unit: 'landings' },\n        { required: 1, completed: sepInstructor, unit: 'instructor hours' },\n      ],\n    },\n    {\n      code: 'EASA-LPC',\n      authority: 'EASA',\n      name: 'LPC/OPC (12 months)',\n      status: lpcDue ? (lpcDue < now ? 'expired' : 'current') : 'expired',\n      nextDueAt: lpcDue ? lpcDue.toISOString() : null,\n      progress: [{ required: 1, completed: lpcDue ? 1 : 0, unit: 'check' }],\n    },\n  ]\n\n  return NextResponse.json({ progress })\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\logbook\\currency\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\logbook\\custom-rules\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\logbook\\deadlines\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\logbook\\imports\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\logbook\\preferences\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\logbook\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\logbook\\sharing\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\logbook\\starting-totals\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\logbook\\templates\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\maintenance\\[id]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":76,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2739,2742],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2739,2742],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth } from '@/lib/auth';\nimport { prisma } from '@/lib/prisma';\n\ninterface RouteParams {\n  params: Promise<{ id: string }>;\n}\n\nexport async function PUT(request: Request, { params }: RouteParams) {\n  try {\n    const session = await auth();\n    if (!session?.user?.email) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const user = await prisma.user.findUnique({ where: { email: session.user.email } });\n    if (!user) {\n      return NextResponse.json({ error: 'User not found' }, { status: 404 });\n    }\n\n    const { id } = await params;\n    const body = await request.json();\n    const { status, cost, notes, isGrounded } = body;\n\n    // Get maintenance record first\n    const maintenance = await prisma.maintenance.findUnique({\n      where: { id }\n    });\n\n    if (!maintenance) {\n      return NextResponse.json({ error: 'Maintenance not found' }, { status: 404 });\n    }\n\n    // Skip group/membership check for now - just update\n    const resolvedDate = status === 'DONE' ? new Date() : null;\n    const groundedStatus = isGrounded !== undefined ? isGrounded : (status === 'DONE' ? false : null);\n\n    // Update maintenance using raw SQL to avoid schema mismatch\n    // Use string interpolation since SQL Server doesn't support ? placeholders in $queryRawUnsafe\n    await prisma.$executeRawUnsafe(`\n      UPDATE Maintenance \n      SET status = '${status}', cost = ${cost || 'NULL'}, notes = ${notes ? \"'\" + notes.replace(/'/g, \"''\") + \"'\" : 'NULL'}, resolvedDate = ${resolvedDate ? \"GETDATE()\" : 'NULL'}, isGrounded = ${groundedStatus !== null ? groundedStatus : 'NULL'}, updatedAt = GETDATE()\n      WHERE id = '${id}'\n    `);\n\n    return NextResponse.json({ success: true });\n  } catch (error) {\n    console.error('Error updating maintenance:', error);\n    return NextResponse.json({ \n      error: 'Failed to update maintenance', \n      details: error instanceof Error ? error.message : String(error)\n    }, { status: 500 });\n  }\n}\n\nexport async function DELETE(request: Request, { params }: RouteParams) {\n  try {\n    const session = await auth();\n    if (!session?.user?.email) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const user = await prisma.user.findUnique({ where: { email: session.user.email } });\n    if (!user) {\n      return NextResponse.json({ error: 'User not found' }, { status: 404 });\n    }\n\n    const { id } = await params;\n\n    // Only allow delete for NEEDED status and by admin\n    const maintenance = await prisma.$queryRawUnsafe(`\n      SELECT m.*, a.groupId\n      FROM Maintenance m\n      JOIN ClubAircraft a ON m.aircraftId = a.id\n      WHERE m.id = '${id}'\n    `) as any[];\n\n    if (!maintenance || maintenance.length === 0) {\n      return NextResponse.json({ error: 'Maintenance not found' }, { status: 404 });\n    }\n\n    // Check admin role\n    const membership = await prisma.groupMember.findFirst({\n      where: { userId: user.id, groupId: maintenance[0].groupId, role: 'ADMIN' },\n    });\n\n    if (!membership) {\n      return NextResponse.json({ error: 'Only admins can delete maintenance' }, { status: 403 });\n    }\n\n    await prisma.$queryRawUnsafe(`DELETE FROM Maintenance WHERE id = '${id}'`);\n\n    return NextResponse.json({ success: true });\n  } catch (error) {\n    console.error('Error deleting maintenance:', error);\n    return NextResponse.json({ error: 'Failed to delete maintenance' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\maintenance\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'request' is defined but never used.","line":4,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":34}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth, prisma } from '@/lib/auth';\n\nexport async function GET(request: Request) {\n  try {\n    const session = await auth();\n    if (!session?.user?.email) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const user = await prisma.user.findUnique({ where: { email: session.user.email } });\n    if (!user) {\n      return NextResponse.json({ error: 'User not found' }, { status: 404 });\n    }\n\n    const maintenance = await prisma.$queryRaw`\n      SELECT m.*, a.nNumber, a.customName, a.nickname, a.make, a.model\n      FROM Maintenance m\n      LEFT JOIN ClubAircraft a ON m.aircraftId = a.id\n      WHERE m.userId = ${user.id}\n      ORDER BY m.reportedDate DESC\n    `;\n\n    console.log('Maintenance fetched:', maintenance);\n    return NextResponse.json(maintenance);\n  } catch (error) {\n    console.error('Error fetching maintenance:', error);\n    return NextResponse.json({ error: 'Failed to fetch maintenance', details: String(error), stack: error instanceof Error ? error.stack : undefined }, { status: 500 });\n  }\n}\n\nexport async function POST(request: Request) {\n  try {\n    const session = await auth();\n    if (!session?.user?.email) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const user = await prisma.user.findUnique({ where: { email: session.user.email } });\n    if (!user) {\n      return NextResponse.json({ error: 'User not found' }, { status: 404 });\n    }\n\n    const body = await request.json();\n    const { aircraftId, description, notes, groupId, isGrounded, postToMarketplace, postAnonymously, neededBy, jobSize, allowTailNumber } = body;\n\n    if (!aircraftId || !description) {\n      return NextResponse.json({ error: 'Aircraft and description required' }, { status: 400 });\n    }\n\n    await prisma.$executeRaw`\n      INSERT INTO Maintenance (id, aircraftId, userId, groupId, description, notes, status, isGrounded, reportedDate, createdAt, updatedAt)\n      VALUES (NEWID(), ${aircraftId}, ${user.id}, ${groupId || null}, ${description}, ${notes || null}, 'NEEDED', ${isGrounded ? 1 : 0}, GETDATE(), GETDATE(), GETDATE())\n    `;\n\n    if (postToMarketplace) {\n      const aircraft = await prisma.clubAircraft.findUnique({\n        where: { id: aircraftId },\n      })\n\n      const isAnonymous = typeof postAnonymously === 'boolean' ? postAnonymously : true\n      const aircraftSnapshot = aircraft ? {\n        make: aircraft.make,\n        model: aircraft.model,\n        year: aircraft.year,\n        registrationType: aircraft.registrationType,\n        nNumber: allowTailNumber ? aircraft.nNumber : null,\n      } : null\n\n      const logbookEntries = await prisma.logbookEntry.findMany({\n        where: { userId: user.id },\n        orderBy: { date: 'desc' },\n      })\n      const normalizedSize = jobSize || (description?.toLowerCase().includes('overhaul') || description?.toLowerCase().includes('rebuild') ? 'LARGE' : 'MEDIUM')\n      await prisma.maintenanceRequest.create({\n        data: {\n          title: description.slice(0, 120),\n          description,\n          category: 'OTHER',\n          urgency: isGrounded ? 'URGENT' : 'NORMAL',\n          neededBy: neededBy ? new Date(neededBy) : null,\n          jobSize: normalizedSize,\n          aircraftType: [aircraft?.make, aircraft?.model].filter(Boolean).join(' ') || null,\n          airportIcao: null,\n          city: null,\n          state: null,\n          locationPrivacy: 'CITY',\n          source: 'scheduled',\n          anonymous: isAnonymous,\n          allowTailNumber: !!allowTailNumber,\n          aircraftSnapshot: aircraftSnapshot ? JSON.stringify(aircraftSnapshot) : null,\n          logbookSnapshot: JSON.stringify({ entries: logbookEntries, totalEntries: logbookEntries.length }),\n          postedByUserId: user.id,\n          postedByName: isAnonymous ? null : user.name,\n          postedByEmail: isAnonymous ? null : user.email,\n        },\n      })\n    }\n\n    return NextResponse.json({ success: true });\n  } catch (error) {\n    console.error('Error creating maintenance:', error);\n    return NextResponse.json({ error: 'Failed to create maintenance', details: String(error) }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\marketplace\\inquiries\\[id]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\marketplace\\inquiries\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":101,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":101,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3553,3556],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3553,3556],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth, prisma } from '@/lib/auth';\n\nasync function ensureInquiryTable() {\n  try {\n    await prisma.$executeRawUnsafe(`\n      IF NOT EXISTS (SELECT * FROM sys.tables WHERE name = 'AircraftInquiry')\n      BEGIN\n        CREATE TABLE [AircraftInquiry] (\n          [id] NVARCHAR(36) NOT NULL PRIMARY KEY DEFAULT NEWID(),\n          [listingId] NVARCHAR(36) NOT NULL,\n          [buyerId] NVARCHAR(36) NOT NULL,\n          [message] NVARCHAR(MAX) NOT NULL,\n          [offerAmount] INT NULL,\n          [status] NVARCHAR(20) NOT NULL DEFAULT 'unread',\n          [createdAt] DATETIME NOT NULL DEFAULT GETDATE(),\n          [updatedAt] DATETIME NOT NULL DEFAULT GETDATE()\n        );\n        CREATE NONCLUSTERED INDEX [IX_AircraftInquiry_listingId] ON [AircraftInquiry]([listingId]);\n        CREATE NONCLUSTERED INDEX [IX_AircraftInquiry_buyerId] ON [AircraftInquiry]([buyerId]);\n        CREATE NONCLUSTERED INDEX [IX_AircraftInquiry_status] ON [AircraftInquiry]([status]);\n      END\n    `);\n  } catch (error) {\n    console.error('Failed to ensure AircraftInquiry table:', error);\n  }\n}\n\nexport async function POST(request: Request) {\n  try {\n    await ensureInquiryTable();\n    const session = await auth();\n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Not authenticated' }, { status: 401 });\n    }\n\n    const body = await request.json();\n    const { listingId, message, offerAmount } = body;\n\n    if (!listingId) {\n      return NextResponse.json({ error: 'Listing ID is required' }, { status: 400 });\n    }\n\n    if (!message || typeof message !== 'string' || message.trim().length < 10) {\n      return NextResponse.json({ error: 'Message must be at least 10 characters' }, { status: 400 });\n    }\n\n    // Get the listing to find the seller\n    const listing = await prisma.marketplaceListing.findUnique({\n      where: { id: listingId },\n      select: { id: true, userId: true, title: true },\n    });\n\n    if (!listing) {\n      return NextResponse.json({ error: 'Listing not found' }, { status: 404 });\n    }\n\n    // Can't inquire about your own listing\n    if (listing.userId === session.user.id) {\n      return NextResponse.json({ error: 'Cannot inquire about your own listing' }, { status: 400 });\n    }\n\n    // Create the inquiry\n    const inquiry = await prisma.aircraftInquiry.create({\n      data: {\n        listingId,\n        buyerId: session.user.id,\n        message: message.trim().slice(0, 5000),\n        offerAmount: offerAmount ? Math.round(Number(offerAmount)) : null,\n        status: 'unread',\n      },\n    });\n\n    return NextResponse.json({ success: true, inquiry });\n  } catch (error) {\n    console.error('Inquiry POST failed', error);\n    return NextResponse.json({ error: 'Failed to send inquiry' }, { status: 500 });\n  }\n}\n\n// GET - fetch inquiries for the current user (as buyer or seller)\nexport async function GET(request: Request) {\n  try {\n    await ensureInquiryTable();\n    const session = await auth();\n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Not authenticated' }, { status: 401 });\n    }\n\n    const url = new URL(request.url);\n    const role = url.searchParams.get('role'); // 'buyer' or 'seller'\n    const status = url.searchParams.get('status');\n\n    // Get listings owned by user (to find inquiries as seller)\n    const userListings = await prisma.marketplaceListing.findMany({\n      where: { userId: session.user.id },\n      select: { id: true },\n    });\n    const listingIds = userListings.map(l => l.id);\n\n    const where: any = {};\n\n    if (role === 'buyer') {\n      // As buyer - inquiries I sent\n      where.buyerId = session.user.id;\n    } else if (role === 'seller') {\n      // As seller - inquiries on my listings\n      where.listingId = { in: listingIds };\n    } else {\n      // Default - either I'm the buyer OR the listing is mine\n      where.OR = [\n        { buyerId: session.user.id },\n        { listingId: { in: listingIds } },\n      ];\n    }\n\n    if (status) {\n      where.status = status;\n    }\n\n    const inquiries = await prisma.aircraftInquiry.findMany({\n      where,\n      orderBy: { createdAt: 'desc' },\n      take: 100,\n      include: {\n        listing: {\n          select: {\n            id: true,\n            title: true,\n            nNumber: true,\n            make: true,\n            model: true,\n            price: true,\n            images: true,\n          },\n        },\n        buyer: {\n          select: {\n            id: true,\n            name: true,\n            username: true,\n          },\n        },\n      },\n    });\n\n    return NextResponse.json({ inquiries });\n  } catch (error) {\n    console.error('Inquiry GET failed', error);\n    return NextResponse.json({ error: 'Failed to load inquiries' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\marketplace\\listings\\[id]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":163,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":163,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5928,5931],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5928,5931],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport { auth, prisma } from '@/lib/auth';\r\n\r\nconst PUBLIC_LISTING_SELECT = {\n  id: true,\n  userId: true,\n  type: true,\n  title: true,\n  description: true,\n  aircraftType: true,\n  airportIcao: true,\n  airportName: true,\n  airportCity: true,\n  latitude: true,\n  longitude: true,\n  price: true,\n  sharePercent: true,\n  hours: true,\n  contactMethod: true,\n  contactValue: true,\n  status: true,\n  createdAt: true,\n  images: true,\n  // Aircraft-specific fields\n  nNumber: true,\n  make: true,\n  model: true,\n  year: true,\n  totalTime: true,\n  engineTime: true,\n  propTime: true,\n  airframeTime: true,\n  annualDue: true,\n  registrationType: true,\n  airworthiness: true,\n  fuelType: true,\n  avionics: true,\n  features: true,\n  upgrades: true,\n  sellerType: true,\n  isVerified: true,\n  verifiedAt: true,\n  videoUrl: true,\n  user: {\n    select: {\n      id: true,\n      name: true,\n      username: true,\n      tier: true,\n    },\n  },\n} as const;\n\r\nexport async function GET(\r\n  _request: NextRequest,\r\n  context: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    const { id } = await context.params;\r\n    const listing = await prisma.marketplaceListing.findUnique({\r\n      where: { id },\r\n      select: PUBLIC_LISTING_SELECT,\r\n    });\r\n\r\n    if (!listing) {\r\n      return NextResponse.json({ error: 'Listing not found' }, { status: 404 });\r\n    }\r\n\r\n    return NextResponse.json({ listing: sanitizeListing(listing) });\r\n  } catch (error) {\r\n    console.error('Marketplace GET detail failed', error);\r\n    return NextResponse.json({ error: 'Failed to load listing' }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function PUT(\r\n  request: NextRequest,\r\n  context: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    const session = await auth();\r\n    if (!session?.user?.id) {\r\n      return NextResponse.json({ error: 'Not authenticated' }, { status: 401 });\r\n    }\r\n\r\n    const { id } = await context.params;\r\n    const body = await request.json();\r\n    const listing = await prisma.marketplaceListing.findUnique({ where: { id } });\r\n    if (!listing) {\r\n      return NextResponse.json({ error: 'Listing not found' }, { status: 404 });\r\n    }\r\n\r\n    if (listing.userId !== session.user.id) {\r\n      return NextResponse.json({ error: 'Not authorized to edit this listing' }, { status: 403 });\r\n    }\r\n\r\n    const data: Record<string, unknown> = {};\n    if (body.title) data.title = body.title.toString().slice(0, 200);\n    if (body.description !== undefined) data.description = body.description.toString().slice(0, 2000);\n    if (body.price !== undefined) data.price = normalizeInt(body.price);\n    if (body.sharePercent !== undefined) data.sharePercent = normalizeInt(body.sharePercent);\n    if (body.status) data.status = body.status.toString().toLowerCase() === 'inactive' ? 'inactive' : 'active';\n    \n    // Aircraft-specific fields\n    if (body.nNumber !== undefined) data.nNumber = body.nNumber?.toString().slice(0, 10) || null;\n    if (body.make !== undefined) data.make = body.make?.toString().slice(0, 100) || null;\n    if (body.model !== undefined) data.model = body.model?.toString().slice(0, 100) || null;\n    if (body.year !== undefined) data.year = normalizeInt(body.year);\n    if (body.totalTime !== undefined) data.totalTime = normalizeInt(body.totalTime);\n    if (body.engineTime !== undefined) data.engineTime = normalizeInt(body.engineTime);\n    if (body.propTime !== undefined) data.propTime = normalizeInt(body.propTime);\n    if (body.airframeTime !== undefined) data.airframeTime = normalizeInt(body.airframeTime);\n    if (body.registrationType !== undefined) data.registrationType = body.registrationType?.toString().slice(0, 50) || null;\n    if (body.airworthiness !== undefined) data.airworthiness = body.airworthiness?.toString().slice(0, 50) || null;\n    if (body.fuelType !== undefined) data.fuelType = body.fuelType?.toString().slice(0, 20) || null;\n    if (body.sellerType !== undefined) data.sellerType = body.sellerType?.toString().slice(0, 20) || null;\n    if (body.videoUrl !== undefined) data.videoUrl = body.videoUrl?.toString().slice(0, 500) || null;\n    if (body.avionics !== undefined) data.avionics = Array.isArray(body.avionics) ? JSON.stringify(body.avionics.slice(0, 50)) : null;\n    if (body.features !== undefined) data.features = Array.isArray(body.features) ? JSON.stringify(body.features.slice(0, 50)) : null;\n    if (body.upgrades !== undefined) data.upgrades = Array.isArray(body.upgrades) ? JSON.stringify(body.upgrades.slice(0, 50)) : null;\n\r\n    const updated = await prisma.marketplaceListing.update({\r\n      where: { id },\r\n      data,\r\n      select: PUBLIC_LISTING_SELECT,\r\n    });\r\n\r\n    return NextResponse.json({ listing: sanitizeListing(updated) });\r\n  } catch (error) {\r\n    console.error('Marketplace PUT failed', error);\r\n    return NextResponse.json({ error: 'Failed to update listing' }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function DELETE(\r\n  _request: NextRequest,\r\n  context: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    const session = await auth();\r\n    if (!session?.user?.id) {\r\n      return NextResponse.json({ error: 'Not authenticated' }, { status: 401 });\r\n    }\r\n\r\n    const { id } = await context.params;\r\n    const listing = await prisma.marketplaceListing.findUnique({ where: { id } });\r\n    if (!listing) {\r\n      return NextResponse.json({ error: 'Listing not found' }, { status: 404 });\r\n    }\r\n\r\n    if (listing.userId !== session.user.id) {\r\n      return NextResponse.json({ error: 'Not authorized to delete this listing' }, { status: 403 });\r\n    }\r\n\r\n    await prisma.marketplaceListing.delete({ where: { id } });\r\n    return NextResponse.json({ success: true });\r\n  } catch (error) {\r\n    console.error('Marketplace DELETE failed', error);\r\n    return NextResponse.json({ error: 'Failed to delete listing' }, { status: 500 });\r\n  }\r\n}\r\n\r\nfunction sanitizeListing(listing: any) {\n  if (!listing) return listing;\n  return {\n    ...listing,\n    images: listing.images ? safeParseJSON(listing.images) : [],\n    avionics: listing.avionics ? safeParseJSON(listing.avionics) : [],\n    features: listing.features ? safeParseJSON(listing.features) : [],\n    upgrades: listing.upgrades ? safeParseJSON(listing.upgrades) : [],\n  };\n}\n\r\nfunction safeParseJSON(value: string | null) {\r\n  if (!value) return [];\r\n  try {\r\n    const parsed = JSON.parse(value);\r\n    return Array.isArray(parsed) ? parsed : [];\r\n  } catch (error) {\r\n    console.error('Failed to parse listing images', error);\r\n    return [];\r\n  }\r\n}\r\n\r\nfunction normalizeInt(value: unknown): number | null {\r\n  if (value === undefined || value === null || value === '') return null;\r\n  const num = Number(value);\r\n  if (Number.isNaN(num)) return null;\r\n  return Math.round(num);\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\marketplace\\listings\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":57,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1135,1138],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1135,1138],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isPreview' is assigned a value but never used.","line":128,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":128,"endColumn":20},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":141,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":141,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4215,4218],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4215,4218],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":275,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":275,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8625,8628],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8625,8628],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":275,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":275,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8652,8655],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8652,8655],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth, prisma } from '@/lib/auth';\n\nconst LISTING_TYPES = ['FOR_SALE', 'SHARE_SELL', 'SHARE_WANTED', 'AIRCRAFT_SALE'] as const;\n\ntype ListingType = (typeof LISTING_TYPES)[number];\n\nconst PUBLIC_LISTING_SELECT = {\n  id: true,\n  userId: true,\n  type: true,\n  title: true,\n  description: true,\n  aircraftType: true,\n  airportIcao: true,\n  airportName: true,\n  airportCity: true,\n  latitude: true,\n  longitude: true,\n  price: true,\n  sharePercent: true,\n  hours: true,\n  contactMethod: true,\n  contactValue: true,\n  status: true,\n  createdAt: true,\n  images: true,\n  // Aircraft-specific fields\n  nNumber: true,\n  make: true,\n  model: true,\n  year: true,\n  totalTime: true,\n  engineTime: true,\n  propTime: true,\n  annualDue: true,\n  registrationType: true,\n  airworthiness: true,\n  fuelType: true,\n  avionics: true,\n  features: true,\n  upgrades: true,\n  sellerType: true,\n  isVerified: true,\n  verifiedAt: true,\n  videoUrl: true,\n  user: {\n    select: {\n      id: true,\n      name: true,\n      username: true,\n      tier: true,\n    },\n  },\n} as const;\n\nfunction sanitizeListing(listing: any) {\n  if (!listing) return listing;\n  return {\n    ...listing,\n    images: listing.images ? safeParseJSON(listing.images) : [],\n    avionics: listing.avionics ? safeParseJSON(listing.avionics) : [],\n    features: listing.features ? safeParseJSON(listing.features) : [],\n    upgrades: listing.upgrades ? safeParseJSON(listing.upgrades) : [],\n  };\n}\n\nfunction safeParseJSON(value: string | null) {\n  if (!value) return [];\n  try {\n    const parsed = JSON.parse(value);\n    return Array.isArray(parsed) ? parsed : [];\n  } catch (error) {\n    console.error('Failed to parse listing images', error);\n    return [];\n  }\n}\n\nasync function ensureMarketplaceTable() {\n  try {\n    // Create table if missing (Azure SQL / SQL Server)\n    await prisma.$executeRawUnsafe(`\n      IF OBJECT_ID('MarketplaceListing', 'U') IS NULL\n      BEGIN\n        CREATE TABLE MarketplaceListing (\n          id NVARCHAR(36) NOT NULL PRIMARY KEY,\n          userId NVARCHAR(36) NOT NULL,\n          type NVARCHAR(20) NOT NULL,\n          title NVARCHAR(200) NOT NULL,\n          description NVARCHAR(MAX) NULL,\n          aircraftType NVARCHAR(100) NOT NULL,\n          airportIcao NVARCHAR(10) NOT NULL,\n          airportName NVARCHAR(200) NULL,\n          airportCity NVARCHAR(200) NULL,\n          latitude FLOAT NULL,\n          longitude FLOAT NULL,\n          price INT NULL,\n          sharePercent INT NULL,\n          hours INT NULL,\n          contactMethod NVARCHAR(50) NULL,\n          contactValue NVARCHAR(200) NULL,\n          images NVARCHAR(MAX) NULL,\n          status NVARCHAR(20) NOT NULL DEFAULT('active'),\n          createdAt DATETIME2 NOT NULL DEFAULT SYSUTCDATETIME(),\n          updatedAt DATETIME2 NOT NULL DEFAULT SYSUTCDATETIME()\n        );\n\n        CREATE INDEX idx_marketplace_airport ON MarketplaceListing(airportIcao);\n        CREATE INDEX idx_marketplace_status ON MarketplaceListing(status);\n      END\n    `);\n  } catch (error) {\n    // If permissions disallow DDL, queries below will return 500; log for visibility.\n    console.error('Failed to ensure MarketplaceListing table:', error);\n  }\n}\n\nexport async function GET(request: Request) {\n  try {\n    await ensureMarketplaceTable();\n    const url = new URL(request.url);\n    const type = url.searchParams.get('type');\n    const airport = url.searchParams.get('airport');\n    const query = url.searchParams.get('q');\n    const take = Math.min(Number(url.searchParams.get('take')) || 60, 200);\n\n    // Check if this is a preview request (no filters = preview)\n    const isPreview = !type && !airport && !query;\n\n    // Aircraft-specific filters\n    const make = url.searchParams.get('make');\n    const model = url.searchParams.get('model');\n    const minYear = url.searchParams.get('minYear');\n    const maxYear = url.searchParams.get('maxYear');\n    const minPrice = url.searchParams.get('minPrice');\n    const maxPrice = url.searchParams.get('maxPrice');\n    const minTime = url.searchParams.get('minTime');\n    const maxTime = url.searchParams.get('maxTime');\n    const engineType = url.searchParams.get('engineType');\n\n    const where: any = { status: 'active' };\n    if (type && LISTING_TYPES.includes(type as ListingType)) {\n      where.type = type;\n    }\n    if (airport) {\n      where.airportIcao = airport.toUpperCase();\n    }\n    if (query) {\n      const search = query.trim();\n      where.OR = [\n        { title: { contains: search } },\n        { description: { contains: search } },\n        { aircraftType: { contains: search } },\n        { airportCity: { contains: search } },\n        // Aircraft-specific search\n        { nNumber: { contains: search } },\n        { make: { contains: search } },\n        { model: { contains: search } },\n      ];\n    }\n\n    // Aircraft-specific filters\n    if (make) {\n      where.make = { contains: make };\n    }\n    if (model) {\n      where.model = { contains: model };\n    }\n    if (minYear || maxYear) {\n      where.year = {};\n      if (minYear) where.year.gte = parseInt(minYear);\n      if (maxYear) where.year.lte = parseInt(maxYear);\n    }\n    if (minPrice || maxPrice) {\n      where.price = {};\n      if (minPrice) where.price.gte = parseInt(minPrice);\n      if (maxPrice) where.price.lte = parseInt(maxPrice);\n    }\n    if (minTime || maxTime) {\n      where.totalTime = {};\n      if (minTime) where.totalTime.gte = parseInt(minTime);\n      if (maxTime) where.totalTime.lte = parseInt(maxTime);\n    }\n    if (engineType) {\n      where.engineType = engineType;\n    }\n\n    const listings = await prisma.marketplaceListing.findMany({\n      where,\n      orderBy: { createdAt: 'desc' },\n      take,\n      select: PUBLIC_LISTING_SELECT,\n    });\n\n    return NextResponse.json({\n      listings: listings.map(sanitizeListing),\n    }, {\n      headers: {\n        // Cache for 1 hour (3600 seconds), stale-while-revalidate allows serving old content while fetching new\n        'Cache-Control': 'public, s-maxage=3600, stale-while-revalidate=86400',\n      },\n    });\n  } catch (error) {\n    console.error('Marketplace GET failed', error);\n    return NextResponse.json({ error: 'Failed to load listings' }, { status: 500 });\n  }\n}\n\nexport async function POST(request: Request) {\n  try {\n    await ensureMarketplaceTable();\n    const session = await auth();\n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Not authenticated' }, { status: 401 });\n    }\n\n    if (!session.user.emailVerified) {\n      return NextResponse.json({ error: 'Please verify your email before posting listings' }, { status: 403 });\n    }\n\n    const body = await request.json();\n    const validation = validateListingPayload(body);\n    if (!validation.valid) {\n      return NextResponse.json({ error: validation.error }, { status: 400 });\n    }\n\n    const data = validation.data;\n    const listing = await prisma.marketplaceListing.create({\n      data: {\n        userId: session.user.id,\n        type: data.type,\n        title: data.title,\n        description: data.description,\n        aircraftType: data.aircraftType,\n        airportIcao: data.airportIcao,\n        airportName: data.airportName,\n        airportCity: data.airportCity,\n        latitude: data.latitude,\n        longitude: data.longitude,\n        price: data.price,\n        sharePercent: data.sharePercent,\n        hours: data.hours,\n        contactMethod: data.contactMethod,\n        contactValue: data.contactValue,\n        images: data.images ? JSON.stringify(data.images) : null,\n        // Aircraft-specific fields\n        nNumber: data.nNumber,\n        make: data.make,\n        model: data.model,\n        year: data.year,\n        totalTime: data.totalTime,\n        engineTime: data.engineTime,\n        propTime: data.propTime,\n        airframeTime: data.airframeTime,\n        annualDue: data.annualDue,\n        registrationType: data.registrationType,\n        airworthiness: data.airworthiness,\n        fuelType: data.fuelType,\n        avionics: data.avionics ? JSON.stringify(data.avionics) : null,\n        features: data.features ? JSON.stringify(data.features) : null,\n        upgrades: data.upgrades ? JSON.stringify(data.upgrades) : null,\n        sellerType: data.sellerType,\n        videoUrl: data.videoUrl,\n      },\n      select: PUBLIC_LISTING_SELECT,\n    });\n\n    return NextResponse.json({ listing: sanitizeListing(listing) });\n  } catch (error) {\n    console.error('Marketplace POST failed', error);\n    return NextResponse.json({ error: 'Failed to create listing' }, { status: 500 });\n  }\n}\n\nfunction validateListingPayload(payload: any): { valid: true; data: any } | { valid: false; error: string } {\n  if (!payload || typeof payload !== 'object') {\n    return { valid: false, error: 'Invalid payload' };\n  }\n\n  const type = typeof payload.type === 'string' ? payload.type.toUpperCase() : '';\n  if (!LISTING_TYPES.includes(type as ListingType)) {\n    return { valid: false, error: 'Invalid listing type' };\n  }\n\n  const title = (payload.title || '').toString().trim();\n  if (title.length < 4) {\n    return { valid: false, error: 'Title must be at least 4 characters' };\n  }\n\n  const aircraftType = (payload.aircraftType || '').toString().trim();\n  if (!aircraftType) {\n    return { valid: false, error: 'Aircraft type is required' };\n  }\n\n  const airportIcao = (payload.airportIcao || '').toString().trim().toUpperCase();\n  if (!/^[A-Z0-9]{3,4}$/.test(airportIcao)) {\n    return { valid: false, error: 'Airport ICAO must be 3-4 characters' };\n  }\n\n  const data = {\n    type,\n    title,\n    description: (payload.description || '').toString().trim().slice(0, 2000),\n    aircraftType,\n    airportIcao,\n    airportName: payload.airportName ? payload.airportName.toString().slice(0, 200) : null,\n    airportCity: payload.airportCity ? payload.airportCity.toString().slice(0, 200) : null,\n    latitude: typeof payload.latitude === 'number' ? payload.latitude : null,\n    longitude: typeof payload.longitude === 'number' ? payload.longitude : null,\n    price: normalizeInt(payload.price),\n    sharePercent: normalizeInt(payload.sharePercent),\n    hours: normalizeInt(payload.hours),\n    contactMethod: payload.contactMethod ? payload.contactMethod.toString().slice(0, 50) : 'email',\n    contactValue: payload.contactValue ? payload.contactValue.toString().slice(0, 200) : null,\n    images: Array.isArray(payload.images) ? payload.images.slice(0, type === 'AIRCRAFT_SALE' ? 20 : 6) : undefined,\n    // Aircraft-specific fields\n    nNumber: payload.nNumber ? payload.nNumber.toString().trim().toUpperCase().slice(0, 10) : null,\n    make: payload.make ? payload.make.toString().trim().slice(0, 100) : null,\n    model: payload.model ? payload.model.toString().trim().slice(0, 100) : null,\n    year: normalizeInt(payload.year),\n    totalTime: normalizeInt(payload.totalTime),\n    engineTime: normalizeInt(payload.engineTime),\n    propTime: normalizeInt(payload.propTime),\n    airframeTime: normalizeInt(payload.airframeTime),\n    annualDue: payload.annualDue ? new Date(payload.annualDue) : null,\n    registrationType: payload.registrationType ? payload.registrationType.toString().slice(0, 50) : null,\n    airworthiness: payload.airworthiness ? payload.airworthiness.toString().slice(0, 50) : null,\n    fuelType: payload.fuelType ? payload.fuelType.toString().slice(0, 20) : null,\n    avionics: Array.isArray(payload.avionics) ? payload.avionics.slice(0, 50) : undefined,\n    features: Array.isArray(payload.features) ? payload.features.slice(0, 50) : undefined,\n    upgrades: Array.isArray(payload.upgrades) ? payload.upgrades.slice(0, 50) : undefined,\n    sellerType: payload.sellerType ? payload.sellerType.toString().slice(0, 20) : null,\n    videoUrl: payload.videoUrl ? payload.videoUrl.toString().slice(0, 500) : null,\n  };\n\n  return { valid: true, data };\n}\n\nfunction normalizeInt(value: unknown): number | null {\n  if (value === undefined || value === null || value === '') return null;\n  const num = Number(value);\n  if (Number.isNaN(num)) return null;\n  return Math.round(num);\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\me\\currency\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'request' is defined but never used.","line":6,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":34},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[587,590],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[587,590],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":42,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1362,1365],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1362,1365],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":56,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1847,1850],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1847,1850],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":81,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2761,2764],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2761,2764],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth } from '@/lib/auth';\nimport { prisma } from '@/lib/prisma';\n\n// GET /api/me/currency - Get detailed currency status\nexport async function GET(request: Request) {\n  try {\n    const session = await auth();\n    if (!session?.user?.email) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Get user with credentials\n    const user = await prisma.$queryRawUnsafe(`\n      SELECT id, name, bfrExpiry, medicalExpiry, medicalClass\n      FROM [User] WHERE email = '${session.user.email}'\n    `) as any[];\n\n    if (!user || user.length === 0) {\n      return NextResponse.json({ error: 'User not found' }, { status: 404 });\n    }\n\n    const userData = user[0];\n    const userId = userData.id;\n\n    // Calculate date ranges\n    const today = new Date();\n    const ninetyDaysAgo = new Date();\n    ninetyDaysAgo.setDate(ninetyDaysAgo.getDate() - 90);\n    \n    const calendarMonthsAgo = new Date();\n    calendarMonthsAgo.setMonth(calendarMonthsAgo.getMonth() - 24);\n\n    // Get landings in last 90 days\n    const landings90Days = await prisma.$queryRawUnsafe(`\n      SELECT \n        SUM(dayLandings) as dayLandings,\n        SUM(nightLandings) as nightLandings\n      FROM LogbookEntry\n      WHERE userId = '${userId}' \n      AND date >= '${ninetyDaysAgo.toISOString()}'\n    `) as any[];\n\n    const dayLandings = landings90Days && landings90Days.length > 0 \n      ? parseInt(landings90Days[0].dayLandings || 0) \n      : 0;\n    const nightLandings = landings90Days && landings90Days.length > 0 \n      ? parseInt(landings90Days[0].nightLandings || 0) \n      : 0;\n\n    // Get BFR status\n    const bfrEntries = await prisma.$queryRawUnsafe(`\n      SELECT TOP 1 date FROM LogbookEntry\n      WHERE userId = '${userId}' AND dualGiven > 0\n      ORDER BY date DESC\n    `) as any[];\n\n    const lastBFRDate = bfrEntries && bfrEntries.length > 0 ? new Date(bfrEntries[0].date) : null;\n    const bfrExpiry = userData.bfrExpiry ? new Date(userData.bfrExpiry) : null;\n    \n    // Calculate BFR due date (24 calendar months from last BFR)\n    let bfrDueDate: Date | null = null;\n    if (lastBFRDate) {\n      bfrDueDate = new Date(lastBFRDate);\n      bfrDueDate.setMonth(bfrDueDate.getMonth() + 24);\n    } else if (bfrExpiry) {\n      bfrDueDate = bfrExpiry;\n    }\n\n    const bfrDays = bfrDueDate \n      ? Math.ceil((bfrDueDate.getTime() - today.getTime()) / (1000 * 60 * 60 * 24))\n      : null;\n\n    // Get medical status\n    const medicalExpiry = userData.medicalExpiry ? new Date(userData.medicalExpiry) : null;\n    const medicalDays = medicalExpiry \n      ? Math.ceil((medicalExpiry.getTime() - today.getTime()) / (1000 * 60 * 60 * 24))\n      : null;\n\n    // Build response\n    const response: any = {\n      vfrDay: {\n        current: dayLandings >= 3,\n        landings: dayLandings,\n        required: 3,\n        window: 90,\n        description: '3 takeoffs/landings in last 90 days',\n      },\n      vfrNight: {\n        current: nightLandings >= 3,\n        landings: nightLandings,\n        required: 3,\n        window: 90,\n        description: '3 night takeoffs/landings in last 90 days',\n      },\n    };\n\n    // BFR\n    if (bfrDueDate) {\n      response.bfr = {\n        current: bfrDays !== null && bfrDays > 0,\n        daysRemaining: bfrDays,\n        dueDate: bfrDueDate,\n        lastBFRDate: lastBFRDate,\n        description: 'Biennial Flight Review (24 calendar months)',\n        alerts: bfrDays !== null && bfrDays <= 60 ? [\n          { days: 60, label: 'Due in 60 days', active: bfrDays <= 60 && bfrDays > 30 },\n          { days: 30, label: 'Due in 30 days', active: bfrDays <= 30 && bfrDays > 14 },\n          { days: 14, label: 'Due in 14 days - URGENT', active: bfrDays <= 14 },\n        ] : [],\n      };\n    } else {\n      response.bfr = {\n        current: false,\n        notCompleted: true,\n        description: 'Biennial Flight Review - No BFR on record',\n      };\n    }\n\n    // Medical\n    if (medicalExpiry) {\n      response.medical = {\n        current: medicalDays !== null && medicalDays > 0,\n        daysRemaining: medicalDays,\n        expiresAt: medicalExpiry,\n        class: userData.medicalClass || 'Unknown',\n        description: `Class ${userData.medicalClass || '?'} Medical`,\n        alerts: medicalDays !== null && medicalDays <= 30 ? [\n          { days: 30, label: 'Expires in 30 days', active: medicalDays <= 30 && medicalDays > 14 },\n          { days: 14, label: 'Expires in 14 days', active: medicalDays <= 14 && medicalDays > 7 },\n          { days: 7, label: 'Expires in 7 days - URGENT', active: medicalDays <= 7 },\n        ] : [],\n      };\n    } else {\n      response.medical = {\n        current: false,\n        notOnFile: true,\n        description: 'No medical on file',\n      };\n    }\n\n    // Summary status\n    response.summary = {\n      allCurrent: (\n        dayLandings >= 3 &&\n        nightLandings >= 3 &&\n        (bfrDays === null || bfrDays > 0) &&\n        (medicalDays === null || medicalDays > 0)\n      ),\n      needsAttention: [] as string[],\n    };\n\n    if (dayLandings < 3) response.summary.needsAttention.push('VFR Day currency');\n    if (nightLandings < 3) response.summary.needsAttention.push('VFR Night currency');\n    if (bfrDays !== null && bfrDays <= 60) response.summary.needsAttention.push('BFR due');\n    if (medicalDays !== null && medicalDays <= 30) response.summary.needsAttention.push('Medical expiring');\n\n    return NextResponse.json(response);\n  } catch (error) {\n    console.error('Error fetching currency:', error);\n    return NextResponse.json({ error: 'Failed to fetch currency' }, { status: 500 });\n  }\n}\n\n// PATCH /api/me/currency - Update pilot credentials\nexport async function PATCH(request: Request) {\n  try {\n    const session = await auth();\n    if (!session?.user?.email) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const body = await request.json();\n    const { bfrExpiry, medicalExpiry, medicalClass } = body;\n\n    // Build update query\n    const updates: string[] = [];\n    if (bfrExpiry) updates.push(`bfrExpiry = '${new Date(bfrExpiry).toISOString()}'`);\n    if (medicalExpiry) updates.push(`medicalExpiry = '${new Date(medicalExpiry).toISOString()}'`);\n    if (medicalClass) updates.push(`medicalClass = '${medicalClass}'`);\n\n    if (updates.length === 0) {\n      return NextResponse.json({ error: 'No fields to update' }, { status: 400 });\n    }\n\n    await prisma.$executeRawUnsafe(`\n      UPDATE [User] \n      SET ${updates.join(', ')}\n      WHERE email = '${session.user.email}'\n    `);\n\n    return NextResponse.json({ success: true });\n  } catch (error) {\n    console.error('Error updating currency:', error);\n    return NextResponse.json({ error: 'Failed to update currency' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\me\\dashboard\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'request' is defined but never used.","line":6,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":34},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[583,586],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[583,586],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":35,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1149,1152],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1149,1152],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":47,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1538,1541],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1538,1541],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":55,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1776,1779],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1776,1779],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":63,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2101,2104],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2101,2104],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":75,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2507,2510],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2507,2510],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth } from '@/lib/auth';\nimport { prisma } from '@/lib/prisma';\n\n// GET /api/me/dashboard - Get pilot dashboard data\nexport async function GET(request: Request) {\n  try {\n    const session = await auth();\n    if (!session?.user?.email) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Get user\n    const user = await prisma.$queryRawUnsafe(`\n      SELECT id, name, email, bfrExpiry, medicalExpiry, medicalClass, credits\n      FROM [User] WHERE email = '${session.user.email}'\n    `) as any[];\n\n    if (!user || user.length === 0) {\n      return NextResponse.json({ error: 'User not found' }, { status: 404 });\n    }\n\n    const userData = user[0];\n    const userId = userData.id;\n\n    // Get recent flights (last 10)\n    const recentFlights = await prisma.$queryRawUnsafe(`\n      SELECT TOP 10 \n        fl.id, fl.date, fl.routeFrom, fl.routeTo, fl.totalTime, fl.hobbsTime,\n        a.nNumber, a.customName\n      FROM FlightLog fl\n      JOIN ClubAircraft a ON fl.aircraftId = a.id\n      WHERE fl.userId = '${userId}'\n      ORDER BY fl.date DESC\n    `) as any[];\n\n    // Get time totals\n    const totals = await prisma.$queryRawUnsafe(`\n      SELECT \n        SUM(fl.totalTime) as totalTime,\n        SUM(fl.soloTime) as soloTime,\n        SUM(fl.nightTime) as nightTime,\n        SUM(fl.instrumentTime) as instrumentTime,\n        SUM(fl.crossCountryTime) as crossCountryTime\n      FROM LogbookEntry fl\n      WHERE fl.userId = '${userId}'\n    `) as any[];\n\n    // Get member clubs\n    const clubs = await prisma.$queryRawUnsafe(`\n      SELECT fg.id, fg.name, gm.role\n      FROM GroupMember gm\n      JOIN FlyingGroup fg ON gm.groupId = fg.id\n      WHERE gm.userId = '${userId}'\n    `) as any[];\n\n    // Get active flights (checked out)\n    const activeFlights = await prisma.$queryRawUnsafe(`\n      SELECT fl.id, fl.hobbsStart, fl.checkedOutAt, a.nNumber, a.customName\n      FROM FlightLog fl\n      JOIN ClubAircraft a ON fl.aircraftId = a.id\n      WHERE fl.userId = '${userId}' AND fl.hobbsEnd IS NULL\n    `) as any[];\n\n    // Calculate currency status\n    const ninetyDaysAgo = new Date();\n    ninetyDaysAgo.setDate(ninetyDaysAgo.getDate() - 90);\n\n    const recentLandings = await prisma.$queryRawUnsafe(`\n      SELECT \n        SUM(dayLandings) as dayLandings,\n        SUM(nightLandings) as nightLandings\n      FROM LogbookEntry\n      WHERE userId = '${userId}' AND date >= '${ninetyDaysAgo.toISOString()}'\n    `) as any[];\n\n    const dayLandings = recentLandings && recentLandings.length > 0 \n      ? (recentLandings[0].dayLandings || 0) \n      : 0;\n    const nightLandings = recentLandings && recentLandings.length > 0 \n      ? (recentLandings[0].nightLandings || 0) \n      : 0;\n\n    // Currency calculations\n    const today = new Date();\n    const bfrExpiry = userData.bfrExpiry ? new Date(userData.bfrExpiry) : null;\n    const medicalExpiry = userData.medicalExpiry ? new Date(userData.medicalExpiry) : null;\n\n    const bfrDays = bfrExpiry ? Math.ceil((bfrExpiry.getTime() - today.getTime()) / (1000 * 60 * 60 * 24)) : null;\n    const medicalDays = medicalExpiry ? Math.ceil((medicalExpiry.getTime() - today.getTime()) / (1000 * 60 * 60 * 24)) : null;\n\n    return NextResponse.json({\n      user: {\n        id: userData.id,\n        name: userData.name,\n        email: userData.email,\n        credits: userData.credits,\n      },\n      recentFlights: recentFlights.map(f => ({\n        id: f.id,\n        date: f.date,\n        route: `${f.routeFrom} â†’ ${f.routeTo}`,\n        totalTime: f.totalTime,\n        hobbsTime: f.hobbsTime,\n        aircraft: f.nNumber || f.customName,\n      })),\n      totals: {\n        totalTime: totals && totals.length > 0 ? parseFloat(totals[0].totalTime || 0) : 0,\n        soloTime: totals && totals.length > 0 ? parseFloat(totals[0].soloTime || 0) : 0,\n        nightTime: totals && totals.length > 0 ? parseFloat(totals[0].nightTime || 0) : 0,\n        instrumentTime: totals && totals.length > 0 ? parseFloat(totals[0].instrumentTime || 0) : 0,\n        crossCountryTime: totals && totals.length > 0 ? parseFloat(totals[0].crossCountryTime || 0) : 0,\n      },\n      currency: {\n        vfrDay: {\n          current: dayLandings >= 3,\n          landings: dayLandings,\n          required: 3,\n          window: 90,\n        },\n        vfrNight: {\n          current: nightLandings >= 3,\n          landings: nightLandings,\n          required: 3,\n          window: 90,\n        },\n        bfr: bfrDays !== null ? {\n          daysRemaining: bfrDays,\n          expiresAt: bfrExpiry,\n          alert: bfrDays <= 60,\n        } : null,\n        medical: medicalDays !== null ? {\n          daysRemaining: medicalDays,\n          expiresAt: medicalExpiry,\n          class: userData.medicalClass,\n          alert: medicalDays <= 30,\n        } : null,\n      },\n      clubs: clubs.map(c => ({\n        id: c.id,\n        name: c.name,\n        role: c.role,\n      })),\n      activeFlight: activeFlights && activeFlights.length > 0 ? {\n        id: activeFlights[0].id,\n        aircraft: activeFlights[0].nNumber || activeFlights[0].customName,\n        hobbsStart: activeFlights[0].hobbsStart,\n        checkedOutAt: activeFlights[0].checkedOutAt,\n      } : null,\n    });\n  } catch (error) {\n    console.error('Error fetching dashboard:', error);\n    return NextResponse.json({ error: 'Failed to fetch dashboard' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\mechanics\\file-requests\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\mechanics\\listings\\[id]\\respond\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\mechanics\\listings\\[id]\\revoke\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\mechanics\\listings\\mine\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\mechanics\\listings\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\mechanics\\profile\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\mechanics\\quotes\\[id]\\status\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\mechanics\\quotes\\mark-read\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\mechanics\\quotes\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\mechanics\\quotes\\unread\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\mechanics\\requests\\files\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\mechanics\\schedules\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\mechanics\\search\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\notams\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":137,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":137,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\n\n// Demo NOTAMs for when API is unavailable\nconst demoNotams: Record<string, Array<{\n  id: string;\n  category: 'TFR' | 'RUNWAY' | 'NAVAID' | 'OBSTACLE' | 'AIRSPACE' | 'GENERAL';\n  title: string;\n  description: string;\n  startDate: string;\n  endDate: string;\n}>> = {\n  'KJFK': [\n    { id: '1', category: 'RUNWAY', title: 'RWY 4L/22R CLSD', description: 'Runway 4L/22R closed for maintenance until 28-Feb', startDate: '2026-02-15', endDate: '2026-02-28' },\n    { id: '2', category: 'GENERAL', title: 'ARTS SITE', description: 'Beacon out of service', startDate: '2026-02-10', endDate: '2026-03-01' },\n  ],\n  'KLAX': [\n    { id: '3', category: 'TFR', title: 'SPACE OPS', description: 'TFR - Space vehicle launch operations', startDate: '2026-02-20', endDate: '2026-02-20' },\n    { id: '4', category: 'RUNWAY', title: 'RWY 25L CLSD', description: 'Runway 25L closed for construction', startDate: '2026-02-01', endDate: '2026-04-30' },\n  ],\n  'KORF': [\n    { id: '5', category: 'AIRSPACE', title: 'MIL OPERS', description: 'Military operations in area', startDate: '2026-02-18', endDate: '2026-02-18' },\n  ],\n  'KDCA': [\n    { id: '6', category: 'RUNWAY', title: 'RWY 1/19 CLSD', description: 'Runway closed - construction', startDate: '2026-02-15', endDate: '2026-03-01' },\n  ],\n  'KMIA': [\n    { id: '7', category: 'OBSTACLE', title: 'CRANE', description: 'Crane in vicinity of airport - 150ft AGL', startDate: '2026-02-10', endDate: '2026-03-15' },\n  ],\n  'KORD': [\n    { id: '8', category: 'TFR', title: 'VIP MOVEMENT', description: 'TFR - Presidential movement', startDate: '2026-02-22', endDate: '2026-02-22' },\n  ],\n  'KSEA': [\n    { id: '9', category: 'RUNWAY', title: 'RWY 16R/34L CLSD', description: 'Runway closed for maintenance', startDate: '2026-02-19', endDate: '2026-02-21' },\n    { id: '10', category: 'GENERAL', title: 'ARFF', description: 'Airport Rescue and Fire Fighting equipment testing', startDate: '2026-02-20', endDate: '2026-02-20' },\n  ],\n  'KAWO': [\n    { id: '11', category: 'GENERAL', title: 'PATRIOT', description: 'Practice Approaches - expect increased traffic', startDate: '2026-02-18', endDate: '2026-02-22' },\n  ],\n};\n\n// Default NOTAMs for unknown airports\nconst defaultNotams = [\n  { id: 'demo1', category: 'GENERAL' as const, title: 'Check NOTAMs', description: 'Contact FBO or Flight Service for current NOTAMs', startDate: '', endDate: '' },\n];\n\ninterface ParsedNotam {\n  id: string;\n  icao: string;\n  category: 'TFR' | 'RUNWAY' | 'NAVAID' | 'OBSTACLE' | 'AIRSPACE' | 'GENERAL';\n  title: string;\n  description: string;\n  startDate: string;\n  endDate: string;\n  location: string;\n  coordinates?: {\n    lat: number;\n    lon: number;\n  };\n}\n\n// GET /api/notams?icaos=KJFK,KLAX\nexport async function GET(request: Request) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const icaos = searchParams.get('icaos');\n    \n    if (!icaos) {\n      return NextResponse.json(\n        { error: 'Missing icaos parameter' },\n        { status: 400 }\n      );\n    }\n    \n    const icaoList = icaos.split(',').map(i => i.trim().toUpperCase()).filter(i => i && i.startsWith('K'));\n    \n    if (icaoList.length === 0) {\n      return NextResponse.json({\n        notams: [],\n        count: 0,\n        message: 'No valid US airport ICAOs provided (must start with K)',\n        timestamp: new Date().toISOString()\n      });\n    }\n    \n    // Limit to 10 airports per request\n    const limitedIcaos = icaoList.slice(0, 10);\n    \n    const allNotams: ParsedNotam[] = [];\n    \n    // First try to fetch from FAA NOTAM API\n    // If that fails, use demo data\n    let apiSuccess = false;\n    \n    for (const icao of limitedIcaos) {\n      try {\n        // Try FAA's public NOTAM API\n        const response = await fetch(\n          `https://notams.aim.aero/api/v1/notams/search?location=${icao}&format=json`,\n          {\n            headers: {\n              'Accept': 'application/json',\n            },\n            next: { revalidate: 300 }\n          }\n        );\n        \n        if (response.ok) {\n          const data = await response.json();\n          apiSuccess = true;\n          \n          // Parse FAA response\n          const notamList = data?.notamList || data?.notams || [];\n          for (const notam of notamList) {\n            const summary = notam.summary || notam.text || '';\n            const lower = summary.toLowerCase();\n            \n            let category: ParsedNotam['category'] = 'GENERAL';\n            if (lower.includes('tfr') || lower.includes('temporary flight restriction')) category = 'TFR';\n            else if (lower.includes('runway') || lower.includes('rw') || lower.includes('rwy')) category = 'RUNWAY';\n            else if (lower.includes('navaid') || lower.includes('vor') || lower.includes('ils')) category = 'NAVAID';\n            else if (lower.includes('obstacle') || lower.includes('tower') || lower.includes('crane')) category = 'OBSTACLE';\n            else if (lower.includes('airspace') || lower.includes('moa') || lower.includes('restricted')) category = 'AIRSPACE';\n            \n            allNotams.push({\n              id: notam.id || Math.random().toString(36).substring(7),\n              icao,\n              category,\n              title: summary.substring(0, 50) || 'NOTAM',\n              description: summary,\n              startDate: notam.startDate || notam.effective || '',\n              endDate: notam.endDate || notam.expiration || '',\n              location: notam.location || '',\n              coordinates: notam.coordinates\n            });\n          }\n        }\n      } catch (error) {\n        // Continue to demo data\n        console.log(`Using demo data for ${icao}`);\n      }\n    }\n    \n    // If API didn't work, use demo data\n    if (!apiSuccess || allNotams.length === 0) {\n      for (const icao of limitedIcaos) {\n        const demoForAirport = demoNotams[icao] || defaultNotams;\n        for (const notam of demoForAirport) {\n          allNotams.push({\n            ...notam,\n            icao,\n            location: icao\n          });\n        }\n      }\n    }\n    \n    // Sort by category priority\n    const categoryOrder: Record<ParsedNotam['category'], number> = {\n      'TFR': 0,\n      'RUNWAY': 1,\n      'OBSTACLE': 2,\n      'AIRSPACE': 3,\n      'NAVAID': 4,\n      'GENERAL': 5\n    };\n    \n    allNotams.sort((a, b) => categoryOrder[a.category] - categoryOrder[b.category]);\n    \n    return NextResponse.json({\n      notams: allNotams,\n      count: allNotams.length,\n      fetched: limitedIcaos,\n      source: apiSuccess ? 'faa' : 'demo',\n      timestamp: new Date().toISOString()\n    });\n    \n  } catch (error) {\n    console.error('NOTAM API error:', error);\n    return NextResponse.json(\n      { error: 'Failed to fetch NOTAMs' },\n      { status: 500 }\n    );\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\partnership\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":21,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[726,729],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[726,729],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":30,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[969,972],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[969,972],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":53,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1695,1698],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1695,1698],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":78,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2522,2525],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2522,2525],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":123,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":123,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3872,3875],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3872,3875],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":128,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":128,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4036,4039],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4036,4039],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":129,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":129,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4159,4162],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4159,4162],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":130,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":130,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4251,4254],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4251,4254],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":180,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":180,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6156,6159],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6156,6159],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth } from '@/lib/auth';\nimport { prisma } from '@/lib/prisma';\n\n// GET all active partnership profiles\nexport async function GET(request: Request) {\n  try {\n    const session = await auth();\n    if (!session?.user?.email) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const url = new URL(request.url);\n    const airport = url.searchParams.get('airport');\n    const state = url.searchParams.get('state');\n    const experience = url.searchParams.get('experience');\n\n    // Get user by email using raw SQL\n    const users = await prisma.$queryRawUnsafe(`\n      SELECT id FROM [User] WHERE email = '${session.user.email}'\n    `) as any[];\n    \n    if (!users || users.length === 0) {\n      return NextResponse.json({ error: 'User not found' }, { status: 404 });\n    }\n    \n    const userId = users[0].id;\n\n    // Try to get partnership profile with raw SQL\n    let profiles: any[] = [];\n    try {\n      let query = `\n        SELECT pp.*, u.name as userName, u.email as userEmail\n        FROM PartnershipProfile pp\n        JOIN [User] u ON pp.userId = u.id\n        WHERE pp.isActive = 1\n      `;\n      \n      if (airport) {\n        query += ` AND pp.homeAirport LIKE '%${airport.toUpperCase()}%'`;\n      }\n      if (state) {\n        query += ` AND pp.state LIKE '%${state.toUpperCase()}%'`;\n      }\n      if (experience) {\n        query += ` AND pp.experienceLevel LIKE '%${experience}%'`;\n      }\n      \n      // Exclude current user's profile\n      query += ` AND pp.userId != '${userId}'`;\n      query += ` ORDER BY pp.createdAt DESC`;\n      \n      profiles = await prisma.$queryRawUnsafe(query) as any[];\n    } catch (e) {\n      // Partnership table might not exist yet\n      console.error('Partnership table error:', e);\n      return NextResponse.json([]);\n    }\n\n    return NextResponse.json(profiles);\n  } catch (error) {\n    console.error('Error fetching partnerships:', error);\n    return NextResponse.json({ error: 'Failed to fetch partnerships', details: String(error) }, { status: 500 });\n  }\n}\n\n// POST create or update user's partnership profile\nexport async function POST(request: Request) {\n  try {\n    const session = await auth();\n    if (!session?.user?.email) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Get user by email using raw SQL\n    const users = await prisma.$queryRawUnsafe(`\n      SELECT id FROM [User] WHERE email = '${session.user.email}'\n    `) as any[];\n    \n    if (!users || users.length === 0) {\n      return NextResponse.json({ error: 'User not found' }, { status: 404 });\n    }\n    \n    const userId = users[0].id;\n\n    const body = await request.json();\n    const {\n      availability,\n      flightInterests,\n      homeAirport,\n      experienceLevel,\n      bio,\n      lookingFor,\n      isActive,\n      city,\n      state\n    } = body;\n\n    // Geocode city/state to lat/long (free Nominatim API)\n    let latitude: number | null = null;\n    let longitude: number | null = null;\n\n    if (city && state) {\n      try {\n        const geoUrl = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(city)},${encodeURIComponent(state)},USA&limit=1`;\n        const geoRes = await fetch(geoUrl, {\n          headers: { 'User-Agent': 'AviationDashboard/1.0' }\n        });\n        const geoData = await geoRes.json();\n        if (geoData && geoData.length > 0) {\n          latitude = parseFloat(geoData[0].lat);\n          longitude = parseFloat(geoData[0].lon);\n        }\n      } catch (geoError) {\n        console.error('Geocoding error:', geoError);\n        // Continue without coordinates\n      }\n    }\n\n    // Check if profile exists using raw SQL\n    const existing = await prisma.$queryRawUnsafe(`\n      SELECT id FROM PartnershipProfile WHERE userId = '${userId}'\n    `) as any[];\n\n    const profileId = existing.length > 0 ? existing[0].id : crypto.randomUUID();\n    \n    // Helper to safely escape strings for SQL\n    const esc = (val: any) => val === null || val === undefined ? 'NULL' : \"'\" + String(val).replace(/'/g, \"''\") + \"'\";\n    const escNum = (val: any) => val === null || val === undefined ? 'NULL' : String(val);\n    const escJson = (val: any) => val === null || val === undefined ? 'NULL' : \"'\" + JSON.stringify(val).replace(/'/g, \"''\") + \"'\";\n\n    if (existing.length > 0) {\n      // Update existing profile\n      await prisma.$executeRawUnsafe(`\n        UPDATE PartnershipProfile SET\n          availability = ${escJson(availability)},\n          flightInterests = ${escJson(flightInterests)},\n          homeAirport = ${esc(homeAirport?.toUpperCase())},\n          experienceLevel = ${esc(experienceLevel)},\n          bio = ${esc(bio)},\n          lookingFor = ${escJson(lookingFor)},\n          isActive = ${isActive !== false ? 1 : 0},\n          city = ${esc(city)},\n          state = ${esc(state?.toUpperCase())},\n          latitude = ${escNum(latitude)},\n          longitude = ${escNum(longitude)},\n          updatedAt = GETDATE()\n        WHERE userId = '${userId}'\n      `);\n    } else {\n      // Insert new profile\n      await prisma.$executeRawUnsafe(`\n        INSERT INTO PartnershipProfile (id, userId, availability, flightInterests, homeAirport, experienceLevel, bio, lookingFor, isActive, city, state, latitude, longitude, createdAt, updatedAt)\n        VALUES (\n          '${profileId}',\n          '${userId}',\n          ${escJson(availability)},\n          ${escJson(flightInterests)},\n          ${esc(homeAirport?.toUpperCase())},\n          ${esc(experienceLevel)},\n          ${esc(bio)},\n          ${escJson(lookingFor)},\n          ${isActive !== false ? 1 : 0},\n          ${esc(city)},\n          ${esc(state?.toUpperCase())},\n          ${escNum(latitude)},\n          ${escNum(longitude)},\n          GETDATE(),\n          GETDATE()\n        )\n      `);\n    }\n\n    // Fetch and return the updated profile\n    const profiles = await prisma.$queryRawUnsafe(`\n      SELECT pp.*, u.name as userName, u.email as userEmail\n      FROM PartnershipProfile pp\n      JOIN [User] u ON pp.userId = u.id\n      WHERE pp.userId = '${userId}'\n    `) as any[];\n\n    return NextResponse.json(profiles[0] || {});\n  } catch (error) {\n    console.error('Error saving partnership profile:', error);\n    return NextResponse.json({ \n      error: 'Failed to save profile', \n      details: String(error),\n      hint: 'Make sure PartnershipProfile table exists in the database'\n    }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\personal-bookings\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[450,453],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[450,453],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":41,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1477,1480],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1477,1480],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":43,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1527,1530],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1527,1530],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":75,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2446,2449],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2446,2449],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":91,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3051,3054],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3051,3054],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":105,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3521,3524],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3521,3524],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth } from '@/lib/auth';\nimport { prisma } from '@/lib/prisma';\n\nexport async function GET(request: Request) {\n  try {\n    const session = await auth();\n    if (!session?.user?.email) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const userRow = await prisma.$queryRawUnsafe(`\n      SELECT id FROM [User] WHERE email = '${session.user.email}'\n    `) as any[];\n\n    if (!userRow || userRow.length === 0) {\n      return NextResponse.json({ error: '[User] not found' }, { status: 404 });\n    }\n\n    const userId = userRow[0].id;\n    const { searchParams } = new URL(request.url);\n    const daysParam = searchParams.get('days') || '7';\n    const now = new Date();\n    const windowEnd = daysParam === 'all'\n      ? null\n      : new Date(now.getTime() + Number(daysParam) * 24 * 60 * 60 * 1000);\n\n    const startFilter = now.toISOString();\n    const endFilter = windowEnd ? windowEnd.toISOString() : null;\n\n    const rows = await prisma.$queryRawUnsafe(`\n      SELECT \n        pb.id, pb.userId, pb.userAircraftId, pb.startTime, pb.endTime, pb.purpose, pb.createdAt, pb.updatedAt,\n        ua.nNumber, ua.nickname\n      FROM PersonalBooking pb\n      JOIN UserAircraft ua ON pb.userAircraftId = ua.id\n      WHERE pb.userId = '${userId}'\n        AND pb.startTime >= '${startFilter}'\n        ${endFilter ? `AND pb.startTime <= '${endFilter}'` : ''}\n      ORDER BY pb.startTime ASC\n    `) as any[];\n\n    const bookings = (rows || []).map((b: any) => ({\n      id: b.id,\n      userId: b.userId,\n      userAircraftId: b.userAircraftId,\n      startTime: b.startTime,\n      endTime: b.endTime,\n      purpose: b.purpose,\n      createdAt: b.createdAt,\n      updatedAt: b.updatedAt,\n      aircraft: {\n        id: b.userAircraftId,\n        nNumber: b.nNumber,\n        nickname: b.nickname,\n      },\n    }));\n\n    return NextResponse.json({ bookings });\n  } catch (error) {\n    console.error('Error fetching personal bookings:', error);\n    return NextResponse.json({ error: 'Failed to fetch personal bookings' }, { status: 500 });\n  }\n}\n\nexport async function POST(request: Request) {\n  try {\n    const session = await auth();\n    if (!session?.user?.email) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const userRow = await prisma.$queryRawUnsafe(`\n      SELECT id FROM [User] WHERE email = '${session.user.email}'\n    `) as any[];\n\n    if (!userRow || userRow.length === 0) {\n      return NextResponse.json({ error: '[User] not found' }, { status: 404 });\n    }\n\n    const userId = userRow[0].id;\n    const body = await request.json();\n    const { userAircraftId, startTime, endTime, purpose } = body || {};\n\n    if (!userAircraftId || !startTime || !endTime) {\n      return NextResponse.json({ error: 'Aircraft, start time, and end time are required' }, { status: 400 });\n    }\n\n    const owned = await prisma.$queryRawUnsafe(`\n      SELECT id FROM UserAircraft WHERE id = '${userAircraftId}' AND userId = '${userId}'\n    `) as any[];\n\n    if (!owned || owned.length === 0) {\n      return NextResponse.json({ error: 'Aircraft not found' }, { status: 404 });\n    }\n\n    const startDate = new Date(startTime).toISOString();\n    const endDate = new Date(endTime).toISOString();\n\n    const conflicts = await prisma.$queryRawUnsafe(`\n      SELECT * FROM PersonalBooking\n      WHERE userAircraftId = '${userAircraftId}'\n        AND startTime < '${endDate}'\n        AND endTime > '${startDate}'\n    `) as any[];\n\n    if (conflicts && conflicts.length > 0) {\n      return NextResponse.json({ error: 'Time slot conflicts with existing booking' }, { status: 409 });\n    }\n\n    const bookingId = crypto.randomUUID();\n    await prisma.$executeRawUnsafe(`\n      INSERT INTO PersonalBooking (id, userId, userAircraftId, startTime, endTime, purpose, createdAt, updatedAt)\n      VALUES ('${bookingId}', '${userId}', '${userAircraftId}', '${startDate}', '${endDate}', ${purpose ? \"'\" + purpose.replace(/'/g, \"''\") + \"'\" : 'NULL'}, GETDATE(), GETDATE())\n    `);\n\n    return NextResponse.json({\n      id: bookingId,\n      userId,\n      userAircraftId,\n      startTime: startDate,\n      endTime: endDate,\n      purpose: purpose || null,\n    });\n  } catch (error) {\n    console.error('Error creating personal booking:', error);\n    return NextResponse.json({ error: 'Failed to create personal booking' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\pilots\\me\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":91,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2784,2787],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2784,2787],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":91,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2811,2814],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2811,2814],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":97,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3047,3050],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3047,3050],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth, prisma } from '@/lib/auth';\n\nexport async function GET() {\n  try {\n    const session = await auth();\n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Not authenticated' }, { status: 401 });\n    }\n\n    await ensurePilotProfileTable();\n    const profile = await prisma.pilotProfile.findUnique({\n      where: { userId: session.user.id },\n    });\n\n    return NextResponse.json({\n      profile: profile\n        ? { ...profile, ratings: profile.ratings ? safeParseJSON(profile.ratings) : [] }\n        : null,\n    });\n  } catch (error) {\n    console.error('Pilot profile GET failed', error);\n    return NextResponse.json({ error: 'Failed to load profile' }, { status: 500 });\n  }\n}\n\nexport async function PUT(request: Request) {\n  try {\n    const session = await auth();\n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Not authenticated' }, { status: 401 });\n    }\n\n    await ensurePilotProfileTable();\n    const body = await request.json();\n    const payload = validateProfilePayload(body);\n    if (!payload.valid) {\n      return NextResponse.json({ error: payload.error }, { status: 400 });\n    }\n\n    const data = {\n      userId: session.user.id,\n      homeAirport: payload.data.homeAirport,\n      availability: payload.data.availability,\n      aircraft: payload.data.aircraft,\n      hours: payload.data.hours,\n      bio: payload.data.bio,\n      ratings: JSON.stringify(payload.data.ratings),\n    };\n\n    const profile = await prisma.pilotProfile.upsert({\n      where: { userId: session.user.id },\n      update: data,\n      create: data,\n    });\n\n    return NextResponse.json({\n      profile: { ...profile, ratings: payload.data.ratings },\n    });\n  } catch (error) {\n    console.error('Pilot profile PUT failed', error);\n    return NextResponse.json({ error: 'Failed to save profile' }, { status: 500 });\n  }\n}\n\nasync function ensurePilotProfileTable() {\n  try {\n    await prisma.$executeRawUnsafe(`\n      IF OBJECT_ID('PilotProfile', 'U') IS NULL\n      BEGIN\n        CREATE TABLE PilotProfile (\n          id NVARCHAR(36) NOT NULL PRIMARY KEY,\n          userId NVARCHAR(36) NOT NULL UNIQUE,\n          homeAirport NVARCHAR(10) NULL,\n          ratings NVARCHAR(MAX) NULL,\n          availability NVARCHAR(50) NULL,\n          aircraft NVARCHAR(MAX) NULL,\n          hours INT NULL,\n          bio NVARCHAR(MAX) NULL,\n          createdAt DATETIME2 NOT NULL DEFAULT SYSUTCDATETIME(),\n          updatedAt DATETIME2 NOT NULL DEFAULT SYSUTCDATETIME()\n        );\n        CREATE INDEX idx_pilotprofile_homeAirport ON PilotProfile(homeAirport);\n      END\n    `);\n  } catch (error) {\n    console.error('Failed to ensure PilotProfile table:', error);\n  }\n}\n\nfunction validateProfilePayload(payload: any): { valid: true; data: any } | { valid: false; error: string } {\n  if (!payload || typeof payload !== 'object') {\n    return { valid: false, error: 'Invalid payload' };\n  }\n\n  const ratings = Array.isArray(payload.ratings)\n    ? payload.ratings.filter((item: any) => typeof item === 'string').slice(0, 10)\n    : [];\n\n  const data = {\n    homeAirport: payload.homeAirport ? payload.homeAirport.toString().toUpperCase().slice(0, 10) : null,\n    availability: payload.availability ? payload.availability.toString().slice(0, 50) : null,\n    aircraft: payload.aircraft ? payload.aircraft.toString().slice(0, 2000) : null,\n    bio: payload.bio ? payload.bio.toString().slice(0, 2000) : null,\n    hours: typeof payload.hours === 'number' ? Math.max(0, Math.round(payload.hours)) : null,\n    ratings,\n  };\n\n  return { valid: true, data };\n}\n\nfunction safeParseJSON(value: string | null) {\n  if (!value) return [];\n  try {\n    const parsed = JSON.parse(value);\n    return Array.isArray(parsed) ? parsed : [];\n  } catch (error) {\n    console.error('Failed to parse ratings', error);\n    return [];\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\pilots\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":33,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[749,752],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[749,752],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":100,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":100,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2611,2614],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2611,2614],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { prisma } from '@/lib/auth';\n\nconst PUBLIC_PROFILE_SELECT = {\n  id: true,\n  userId: true,\n  homeAirport: true,\n  ratings: true,\n  availability: true,\n  aircraft: true,\n  hours: true,\n  bio: true,\n  createdAt: true,\n  user: {\n    select: {\n      id: true,\n      name: true,\n      username: true,\n      tier: true,\n    },\n  },\n} as const;\n\nexport async function GET(request: Request) {\n  try {\n    await ensurePilotProfileTable();\n    const url = new URL(request.url);\n    const rating = url.searchParams.get('rating');\n    const airport = url.searchParams.get('airport');\n    const availability = url.searchParams.get('availability');\n    const query = url.searchParams.get('q');\n\n    const where: any = {};\n    if (airport) {\n      where.homeAirport = airport.toUpperCase();\n    }\n    if (availability) {\n      where.availability = availability;\n    }\n    if (rating) {\n      where.ratings = { contains: rating };\n    }\n    if (query) {\n      const term = query.trim();\n      where.OR = [\n        { bio: { contains: term } },\n        { aircraft: { contains: term } },\n        {\n          user: {\n            OR: [\n              { name: { contains: term } },\n              { username: { contains: term } },\n            ],\n          },\n        },\n      ];\n    }\n\n    const profiles = await prisma.pilotProfile.findMany({\n      where,\n      orderBy: { updatedAt: 'desc' },\n      take: 200,\n      select: PUBLIC_PROFILE_SELECT,\n    });\n\n    return NextResponse.json({\n      profiles: profiles.map(serializeProfile),\n    });\n  } catch (error) {\n    console.error('Pilot directory GET failed', error);\n    return NextResponse.json({ error: 'Failed to load pilot profiles' }, { status: 500 });\n  }\n}\n\nasync function ensurePilotProfileTable() {\n  try {\n    await prisma.$executeRawUnsafe(`\n      IF OBJECT_ID('PilotProfile', 'U') IS NULL\n      BEGIN\n        CREATE TABLE PilotProfile (\n          id NVARCHAR(36) NOT NULL PRIMARY KEY,\n          userId NVARCHAR(36) NOT NULL UNIQUE,\n          homeAirport NVARCHAR(10) NULL,\n          ratings NVARCHAR(MAX) NULL,\n          availability NVARCHAR(50) NULL,\n          aircraft NVARCHAR(MAX) NULL,\n          hours INT NULL,\n          bio NVARCHAR(MAX) NULL,\n          createdAt DATETIME2 NOT NULL DEFAULT SYSUTCDATETIME(),\n          updatedAt DATETIME2 NOT NULL DEFAULT SYSUTCDATETIME()\n        );\n        CREATE INDEX idx_pilotprofile_homeAirport ON PilotProfile(homeAirport);\n      END\n    `);\n  } catch (error) {\n    console.error('Failed to ensure PilotProfile table:', error);\n  }\n}\n\nfunction serializeProfile(profile: any) {\n  return {\n    ...profile,\n    ratings: profile.ratings ? safeParseJSON(profile.ratings) : [],\n    user: profile.user\n      ? {\n          id: profile.user.id,\n          name: profile.user.name,\n          username: profile.user.username,\n          tier: profile.user.tier,\n        }\n      : null,\n  };\n}\n\nfunction safeParseJSON(value: string | null) {\n  if (!value) return [];\n  try {\n    const parsed = JSON.parse(value);\n    return Array.isArray(parsed) ? parsed : [];\n  } catch (error) {\n    console.error('Failed to parse profile ratings', error);\n    return [];\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\pireps\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":133,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":133,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3307,3310],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3307,3310],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":154,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":154,"endColumn":21}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\n\n// Demo PIREPs data - In production, fetch from aviationweather.gov\nconst demoPireps = [\n  {\n    id: 'p1',\n    icao: 'KJFK',\n    reportType: 'PIREP',\n    flightLevel: 350,\n    aircraft: 'B737',\n    skyCondition: 'OVC045',\n    visibility: 10,\n    wxString: 'NVG',\n    turbulence: 'NIL',\n    icing: 'NIL',\n    temperature: -48,\n    windDirection: 270,\n    windSpeed: 45,\n    time: '2026-02-18T20:15:00Z',\n    latitude: 40.5,\n    longitude: -73.5,\n    reportText: 'KJFK JFK UUA /OV KJFK/TM 2015Z/FL350/TP B737/SK OVC045/TB NIL/IC NIL'\n  },\n  {\n    id: 'p2',\n    icao: 'KORD',\n    reportType: 'PIREP',\n    flightLevel: 280,\n    aircraft: 'A320',\n    skyCondition: 'SCT040',\n    visibility: 10,\n    wxString: 'FZRA',\n    turbulence: 'LGT',\n    icing: 'LGT-MOD',\n    temperature: -32,\n    windDirection: 250,\n    windSpeed: 35,\n    time: '2026-02-18T19:45:00Z',\n    latitude: 41.5,\n    longitude: -88.0,\n    reportText: 'KORD ORD UUA /OV KORD/TM 1945Z/FL280/TP A320/SK SCT040/FZRA/TB LGT/IC LGT-MOD'\n  },\n  {\n    id: 'p3',\n    icao: 'KLAX',\n    reportType: 'PIREP',\n    flightLevel: 390,\n    aircraft: 'B777',\n    skyCondition: 'CLR',\n    visibility: 10,\n    wxString: 'SKC',\n    turbulence: 'MOD',\n    icing: 'NIL',\n    temperature: -52,\n    windDirection: 220,\n    windSpeed: 60,\n    time: '2026-02-18T18:30:00Z',\n    latitude: 33.5,\n    longitude: -118.0,\n    reportText: 'KLAX LAX UUA /OV KLAX/TM 1830Z/FL390/TP B777/SK CLR/SKC/TB MOD/IC NIL'\n  },\n  {\n    id: 'p4',\n    icao: 'KMIA',\n    reportType: 'PIREP',\n    flightLevel: 100,\n    aircraft: 'C172',\n    skyCondition: 'BKN020',\n    visibility: 5,\n    wxString: 'BR',\n    turbulence: 'SEV',\n    icing: 'NIL',\n    temperature: 22,\n    windDirection: 90,\n    windSpeed: 15,\n    time: '2026-02-18T17:00:00Z',\n    latitude: 25.5,\n    longitude: -80.0,\n    reportText: 'KMIA MIA UUA /OV KMIA/TM 1700Z/FL100/TP C172/SK BKN020/BR/TB SEV/IC NIL'\n  }\n];\n\ninterface PIREP {\n  id: string;\n  icao: string;\n  reportType: string;\n  flightLevel: number;\n  aircraft: string;\n  skyCondition: string;\n  visibility: number;\n  wxString: string;\n  turbulence: string;\n  icing: string;\n  temperature: number;\n  windDirection: number;\n  windSpeed: number;\n  time: string;\n  latitude: number;\n  longitude: number;\n  reportText: string;\n}\n\n// GET /api/pireps?bounds=minLat,maxLat,minLon,maxLon\nexport async function GET(request: Request) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const bounds = searchParams.get('bounds');\n    \n    // Try to fetch from aviationweather.gov first\n    let pireps: PIREP[] = [];\n    let source = 'demo';\n    \n    if (bounds) {\n      const [minLat, maxLat, minLon, maxLon] = bounds.split(',').map(Number);\n      \n      try {\n        const response = await fetch(\n          `https://aviationweather.gov/api/data/pirep?format=json&bbox=${minLon},${minLat},${maxLon},${maxLat}`,\n          {\n            headers: {\n              'Accept': 'application/json',\n            },\n            next: { revalidate: 300 }\n          }\n        );\n        \n        if (response.ok) {\n          const data = await response.json();\n          source = 'aviationweather.gov';\n          \n          // Parse aviationweather.gov response\n          if (Array.isArray(data)) {\n            pireps = data.map((p: any) => ({\n              id: p.pirepId || Math.random().toString(36).substring(7),\n              icao: p.icaoId || '',\n              reportType: p.rptType || 'PIREP',\n              flightLevel: parseInt(p.flightLevel) || 0,\n              aircraft: p.acType || 'UNKNOWN',\n              skyCondition: p.skyCond || '',\n              visibility: p.vis || 10,\n              wxString: p.wxString || '',\n              turbulence: p.turbulence || 'NIL',\n              icing: p.icing || 'NIL',\n              temperature: parseInt(p.temp) || 0,\n              windDirection: parseInt(p.wdir) || 0,\n              windSpeed: parseInt(p.wspd) || 0,\n              time: p.time || '',\n              latitude: p.lat || 0,\n              longitude: p.lon || 0,\n              reportText: p.rawOb || ''\n            }));\n          }\n        }\n      } catch (error) {\n        console.log('PIREP API unavailable, using demo data');\n      }\n    }\n    \n    // If no data from API, use demo data\n    if (pireps.length === 0) {\n      // Filter demo data by bounds if provided\n      if (bounds) {\n        const [minLat, maxLat, minLon, maxLon] = bounds.split(',').map(Number);\n        pireps = demoPireps.filter(p => \n          p.latitude >= minLat && \n          p.latitude <= maxLat && \n          p.longitude >= minLon && \n          p.longitude <= maxLon\n        );\n      } else {\n        pireps = demoPireps;\n      }\n    }\n    \n    return NextResponse.json({\n      pireps,\n      count: pireps.length,\n      source,\n      timestamp: new Date().toISOString()\n    });\n    \n  } catch (error) {\n    console.error('PIREP API error:', error);\n    return NextResponse.json(\n      { error: 'Failed to fetch PIREPs' },\n      { status: 500 }\n    );\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\presence\\heartbeat\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":28,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[733,736],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[733,736],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth, prisma } from '@/lib/auth';\n\nexport async function POST() {\n  try {\n    const session = await auth();\n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Not authenticated' }, { status: 401 });\n    }\n\n    const userId = session.user.id;\n\n    // Try to upsert presence using Prisma\n    // This will fail gracefully if the table doesn't exist yet\n    try {\n      await prisma.userPresence.upsert({\n        where: { userId },\n        update: {\n          isOnline: true,\n          lastSeenAt: new Date(),\n        },\n        create: {\n          userId,\n          isOnline: true,\n          lastSeenAt: new Date(),\n        },\n      });\n    } catch (prismaError: any) {\n      // Table might not exist yet - that's ok, we'll create it manually\n      console.warn('UserPresence table not ready:', prismaError.message);\n    }\n\n    return NextResponse.json({ success: true });\n  } catch (error) {\n    console.error('Presence heartbeat failed', error);\n    return NextResponse.json({ error: 'Failed to update presence' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\profile\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\radar\\frames\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":21,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[644,647],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[644,647],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":22,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[696,699],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[696,699],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\n\nexport const runtime = 'nodejs';\n\nexport async function GET() {\n  try {\n    const res = await fetch('https://api.rainviewer.com/public/weather-maps.json', {\n      // Avoid caching issues across regions.\n      cache: 'no-store',\n    });\n\n    if (!res.ok) {\n      return NextResponse.json({ error: 'Upstream unavailable' }, { status: 502 });\n    }\n\n    const data = await res.json();\n    const past = Array.isArray(data?.radar?.past) ? data.radar.past : [];\n    const nowcast = Array.isArray(data?.radar?.nowcast) ? data.radar.nowcast : [];\n\n    const frames = [...past, ...nowcast]\n      .filter((t: any) => typeof t?.time === 'number')\n      .map((t: any) => ({ time: t.time as number }));\n\n    return NextResponse.json(\n      {\n        provider: 'rainviewer',\n        frames,\n      },\n      {\n        headers: {\n          'Cache-Control': 'public, s-maxage=300, stale-while-revalidate=3600',\n        },\n      }\n    );\n  } catch (error) {\n    console.error('Radar frames proxy failed', error);\n    return NextResponse.json({ error: 'Failed to load radar frames' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\radar\\tile\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\route-weather\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'sqlite3' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":15,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"sqlite3"},"fix":{"range":[58,90],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DB_PATH' is assigned a value but never used.","line":5,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":14},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":9,"column":48,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":9,"endColumn":64},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":9,"column":67,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":9,"endColumn":82},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[522,525],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[522,525],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'routePoints' is assigned a value but never used.","line":70,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":70,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'centerLat' is assigned a value but never used.","line":73,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":73,"endColumn":20},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":85,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3350,3353],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3350,3353],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":98,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3748,3751],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3748,3751],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":182,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":182,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7238,7241],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7238,7241],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport sqlite3 from 'sqlite3';\r\nimport path from 'path';\r\n\r\nconst DB_PATH = path.join(process.cwd(), 'data', 'aviation_hub.db');\r\n\r\nfunction httpGet(url: string): Promise<{ status: number; data: string }> {\r\n  return new Promise((resolve, reject) => {\r\n    const protocol = url.startsWith('https') ? require('https') : require('http');\r\n    const req = protocol.get(url, { \r\n      headers: { 'User-Agent': 'AviationHub/1.0' },\r\n      timeout: 15000 \r\n    }, (res: any) => {\n      let data = '';\n      res.on('data', (chunk: string) => data += chunk);\n      res.on('end', () => resolve({ status: res.statusCode || 500, data }));\r\n    });\r\n    req.on('error', reject);\r\n    req.setTimeout(15000, () => { req.destroy(); reject(new Error('Timeout')); });\r\n  });\r\n}\r\n\r\nfunction calculateDistance(lat1: number, lon1: number, lat2: number, lon2: number): number {\r\n  const R = 3440.065; // Earth radius in NM\r\n  const dLat = (lat2 - lat1) * Math.PI / 180;\r\n  const dLon = (lon2 - lon1) * Math.PI / 180;\r\n  const a = Math.sin(dLat/2) * Math.sin(dLat/2) +\r\n    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *\r\n    Math.sin(dLon/2) * Math.sin(dLon/2);\r\n  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));\r\n  return R * c;\r\n}\r\n\r\n// Interpolate waypoints along a route to get more weather data points\r\nfunction interpolateWaypoints(waypoints: { lat: number; lon: number }[], numPoints: number = 5): { lat: number; lon: number }[] {\r\n  if (waypoints.length < 2) return waypoints;\r\n  \r\n  const result: { lat: number; lon: number }[] = [];\r\n  \r\n  for (let i = 0; i < waypoints.length - 1; i++) {\r\n    const start = waypoints[i];\r\n    const end = waypoints[i + 1];\r\n    const segmentDist = calculateDistance(start.lat, start.lon, end.lat, end.lon);\r\n    const pointsForSegment = Math.max(1, Math.ceil((segmentDist / 50) * numPoints));\r\n    \r\n    for (let j = 0; j < pointsForSegment; j++) {\r\n      const fraction = j / pointsForSegment;\r\n      result.push({\r\n        lat: start.lat + (end.lat - start.lat) * fraction,\r\n        lon: start.lon + (end.lon - start.lon) * fraction\r\n      });\r\n    }\r\n  }\r\n  \r\n  // Add final point\r\n  result.push(waypoints[waypoints.length - 1]);\r\n  \r\n  return result;\r\n}\r\n\r\nexport async function POST(request: NextRequest): Promise<NextResponse> {\r\n  try {\r\n    const { waypoints, altitude = 34000, aircraftTAS = 120 } = await request.json();\r\n    \r\n    if (!waypoints || waypoints.length < 2) {\r\n      return NextResponse.json({ error: 'Need at least 2 waypoints' }, { status: 400 });\r\n    }\r\n\r\n    // Get interpolation points along route\r\n    const routePoints = interpolateWaypoints(waypoints, 5);\r\n    \r\n    // Fetch winds aloft for the region (using first and last waypoints to determine region)\r\n    const centerLat = (waypoints[0].lat + waypoints[waypoints.length - 1].lat) / 2;\r\n    const centerLon = (waypoints[0].lon + waypoints[waypoints.length - 1].lon) / 2;\r\n    \r\n    // Determine region code based on longitude\r\n    let region = 'chi'; // default\r\n    if (centerLon < -120) region = 'sfo';\r\n    else if (centerLon < -100) region = 'slc';\r\n    else if (centerLon < -90) region = 'dfw';\r\n    else if (centerLon < -80) region = 'mia';\r\n    else if (centerLon < -70) region = 'bos';\r\n    \r\n    // Try to get winds aloft data\r\n    let windData: any = null;\r\n    try {\r\n      const url = `https://aviationweather.gov/api/data/windtemp?region=${region}&format=json`;\r\n      const response = await httpGet(url);\r\n      \r\n      if (response.status === 200) {\r\n        windData = JSON.parse(response.data);\r\n      }\r\n    } catch (e) {\r\n      console.log('Wind data fetch error:', e);\r\n    }\r\n\r\n    // Calculate segment impacts\r\n    const segments: any[] = [];\r\n    let totalDistance = 0;\r\n    let totalTimeWithWind = 0;\r\n    let totalTimeStillAir = 0;\r\n    \r\n    for (let i = 0; i < waypoints.length - 1; i++) {\r\n      const from = waypoints[i];\r\n      const to = waypoints[i + 1];\r\n      const distance = calculateDistance(from.lat, from.lon, to.lat, to.lon);\r\n      \r\n      // Calculate heading\r\n      const heading = Math.atan2(\r\n        (to.lon - from.lon) * Math.cos(to.lat * Math.PI / 180),\r\n        to.lat - from.lat\r\n      ) * 180 / Math.PI;\r\n      \r\n      // Estimate wind (simplified - in real app would use actual winds aloft data)\r\n      // Use a simplified wind model based on latitude (typical jet stream patterns)\r\n      const avgLat = (from.lat + to.lat) / 2;\r\n      const windSpeed = Math.max(0, 30 - Math.abs(avgLat - 40) * 0.5); // Simplified model\r\n      const windFrom = 270 + (avgLat > 40 ? 20 : -20); // Generally from west\r\n      \r\n      // Calculate wind correction angle\r\n      const windRad = (windFrom - heading) * Math.PI / 180;\r\n      const headwind = windSpeed * Math.cos(windRad);\r\n      const crosswind = windSpeed * Math.sin(windRad);\r\n      \r\n      // Ground speed with wind\r\n      const groundSpeed = Math.sqrt(\r\n        Math.pow(aircraftTAS + headwind, 2) + Math.pow(crosswind, 2)\r\n      );\r\n      \r\n      // Time in still air vs with wind\r\n      const timeStillAir = distance / aircraftTAS;\r\n      const timeWithWind = distance / groundSpeed;\r\n      \r\n      // Fuel impact (based on time difference)\r\n      const fuelFlow = 8; // gallons per hour (typical GA jet)\r\n      const fuelDiff = (timeWithWind - timeStillAir) * fuelFlow;\r\n      const fuelImpactPercent = (fuelDiff / (timeStillAir * fuelFlow)) * 100;\r\n      \r\n      segments.push({\r\n        from: { icao: from.icao || `WP${i}`, lat: from.lat, lon: from.lon },\r\n        to: { icao: to.icao || `WP${i+1}`, lat: to.lat, lon: to.lon },\r\n        distance: Math.round(distance),\r\n        heading: Math.round(heading),\r\n        windFrom: Math.round(windFrom),\r\n        windSpeed: Math.round(windSpeed),\r\n        tas: aircraftTAS,\r\n        groundSpeed: Math.round(groundSpeed),\r\n        timeStillAir: Math.round(timeStillAir * 60), // minutes\r\n        timeWithWind: Math.round(timeWithWind * 60),\r\n        fuelImpact: Math.round(fuelDiff * 10) / 10,\r\n        fuelImpactPercent: Math.round(fuelImpactPercent * 10) / 10,\r\n        significant: Math.abs(fuelImpactPercent) >= 10\r\n      });\r\n      \r\n      totalDistance += distance;\r\n      totalTimeWithWind += timeWithWind;\r\n      totalTimeStillAir += timeStillAir;\r\n    }\r\n    \r\n    const totalFuelStillAir = totalTimeStillAir * 8;\r\n    const totalFuelWithWind = totalTimeWithWind * 8;\r\n    const overallFuelImpact = totalFuelWithWind - totalFuelStillAir;\r\n    const overallImpactPercent = (overallFuelImpact / totalFuelStillAir) * 100;\r\n    \r\n    return NextResponse.json({\r\n      segments,\r\n      summary: {\r\n        totalDistance: Math.round(totalDistance),\r\n        totalTimeStillAir: Math.round(totalTimeStillAir * 60),\r\n        totalTimeWithWind: Math.round(totalTimeWithWind * 60),\r\n        fuelStillAir: Math.round(totalFuelStillAir),\r\n        fuelWithWind: Math.round(totalFuelWithWind),\r\n        fuelImpact: Math.round(overallFuelImpact * 10) / 10,\r\n        fuelImpactPercent: Math.round(overallImpactPercent * 10) / 10,\r\n        significant: Math.abs(overallImpactPercent) >= 10\r\n      },\r\n      altitude,\r\n      region,\r\n      windDataAvailable: !!windData\r\n    });\r\n    \r\n  } catch (error: any) {\r\n    console.error('Route weather calculation error:', error);\r\n    return NextResponse.json({ error: error.message }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\search\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\sigmets\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SIGMET' is defined but never used.","line":75,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":75,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'request' is defined but never used.","line":89,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":89,"endColumn":34},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":112,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":112,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2942,2945],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2942,2945],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":126,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":126,"endColumn":19}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\n\n// Demo SIGMETs data - In production, fetch from aviationweather.gov\nconst demoSigmets = [\n  {\n    id: 'sigmet1',\n    type: 'SIGMET',\n    hazard: 'CONVECTIVE',\n    severity: 'SEVERE',\n    title: 'Severe Thunderstorm',\n    description: 'Severe thunderstorm extending from FL250 to FL450. Moving from 260 at 25 knots.',\n    area: 'CO, KS, NE',\n    validStart: '2026-02-18T18:00:00Z',\n    validEnd: '2026-02-18T22:00:00Z',\n    coordinates: [\n      { lat: 40.0, lon: -105.0 },\n      { lat: 40.0, lon: -100.0 },\n      { lat: 38.0, lon: -100.0 },\n      { lat: 38.0, lon: -105.0 }\n    ]\n  },\n  {\n    id: 'sigmet2',\n    type: 'SIGMET',\n    hazard: 'TURBULENCE',\n    severity: 'SEVERE',\n    title: 'Severe Turbulence',\n    description: 'Severe turbulence below FL350. Moving from 270 at 15 knots.',\n    area: 'IL, IN, OH',\n    validStart: '2026-02-18T16:00:00Z',\n    validEnd: '2026-02-18T20:00:00Z',\n    coordinates: [\n      { lat: 42.0, lon: -88.0 },\n      { lat: 42.0, lon: -82.0 },\n      { lat: 39.0, lon: -82.0 },\n      { lat: 39.0, lon: -88.0 }\n    ]\n  },\n  {\n    id: 'sigmet3',\n    type: 'AIRMET',\n    hazard: 'ICING',\n    severity: 'MODERATE',\n    title: 'Moderate Icing',\n    description: 'Moderate rime icing in clouds from FL180 to FL280. Temperature -8C to -15C.',\n    area: 'WA, OR, ID',\n    validStart: '2026-02-18T14:00:00Z',\n    validEnd: '2026-02-18T18:00:00Z',\n    coordinates: [\n      { lat: 49.0, lon: -125.0 },\n      { lat: 49.0, lon: -116.0 },\n      { lat: 44.0, lon: -116.0 },\n      { lat: 44.0, lon: -125.0 }\n    ]\n  },\n  {\n    id: 'sigmet4',\n    type: 'AIRMET',\n    hazard: 'IFR',\n    severity: 'MODERATE',\n    title: 'IFR Conditions',\n    description: 'MVFR to IFR conditions in rain. Ceiling 1000ft, visibility 3SM in moderate rain.',\n    area: 'FL, GA, SC',\n    validStart: '2026-02-18T12:00:00Z',\n    validEnd: '2026-02-18T18:00:00Z',\n    coordinates: [\n      { lat: 33.0, lon: -85.0 },\n      { lat: 33.0, lon: -79.0 },\n      { lat: 29.0, lon: -79.0 },\n      { lat: 29.0, lon: -85.0 }\n    ]\n  }\n];\n\ninterface SIGMET {\n  id: string;\n  type: string;\n  hazard: string;\n  severity: string;\n  title: string;\n  description: string;\n  area: string;\n  validStart: string;\n  validEnd: string;\n  coordinates: Array<{ lat: number; lon: number }>;\n}\n\n// GET /api/sigmets\nexport async function GET(request: Request) {\n  try {\n    let sigmets = [...demoSigmets];\n    \n    // Try to fetch from aviationweather.gov\n    let source = 'demo';\n    \n    try {\n      const response = await fetch(\n        'https://aviationweather.gov/api/data/gairmet?format=json',\n        {\n          headers: {\n            'Accept': 'application/json',\n          },\n          next: { revalidate: 300 }\n        }\n      );\n      \n      if (response.ok) {\n        const data = await response.json();\n        source = 'aviationweather.gov';\n        \n        if (Array.isArray(data)) {\n          sigmets = data.map((s: any) => ({\n            id: s.forecastId || Math.random().toString(36).substring(7),\n            type: 'AIRMET',\n            hazard: s.hazard || 'UNKNOWN',\n            severity: s.severity || 'MODERATE',\n            title: s.hazard || 'Weather Advisory',\n            description: s.rawBrie || s.hazard || '',\n            area: s.area || '',\n            validStart: s.validTimeStart || '',\n            validEnd: s.validTimeEnd || '',\n            coordinates: s.geometry?.features?.[0]?.geometry?.coordinates?.[0] || []\n          }));\n        }\n      }\n    } catch (error) {\n      console.log('SIGMET API unavailable, using demo data');\n    }\n    \n    // Filter out expired sigmets\n    const now = new Date();\n    sigmets = sigmets.filter(sig => {\n      const validEnd = new Date(sig.validEnd);\n      return validEnd > now;\n    });\n    \n    return NextResponse.json({\n      sigmets,\n      count: sigmets.length,\n      source,\n      timestamp: new Date().toISOString()\n    });\n    \n  } catch (error) {\n    console.error('SIGMET API error:', error);\n    return NextResponse.json(\n      { error: 'Failed to fetch SIGMETs' },\n      { status: 500 }\n    );\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\sync\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getModifiedField' is defined but never used.","line":40,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":40,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getIdField' is defined but never used.","line":56,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":56,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'userId' is assigned a value but never used.","line":87,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":87,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'localId' is assigned a value but never used.","line":134,"column":50,"nodeType":"Identifier","messageId":"unusedVar","endLine":134,"endColumn":57}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth } from '@/lib/auth';\nimport { prisma } from '@/lib/prisma';\n\ninterface SyncChange {\n  type: 'flight_log' | 'maintenance' | 'aircraft_status' | 'booking';\n  action: 'create' | 'update' | 'delete';\n  data: Record<string, unknown>;\n  localCreatedAt: string;\n  localLastSyncedAt?: string;\n  localId: string;\n}\n\ninterface SyncRequest {\n  changes: SyncChange[];\n  userId: string;\n}\n\ninterface ConflictResponse {\n  type: string;\n  action: string;\n  localId: string;\n  conflictType: 'modified' | 'deleted';\n  serverData: Record<string, unknown>;\n  serverModifiedAt: string;\n}\n\ninterface AppliedChange {\n  localId: string;\n  serverId: string;\n}\n\ninterface SyncResponse {\n  applied: AppliedChange[];\n  conflicts: ConflictResponse[];\n  errors: string[];\n}\n\n// Get the modification timestamp field for each type\nfunction getModifiedField(type: string): string {\n  switch (type) {\n    case 'flight_log':\n      return 'updatedAt';\n    case 'maintenance':\n      return 'updatedAt';\n    case 'aircraft_status':\n      return 'updatedAt';\n    case 'booking':\n      return 'updatedAt';\n    default:\n      return 'updatedAt';\n  }\n}\n\n// Get the ID field for each type\nfunction getIdField(type: string): string {\n  switch (type) {\n    case 'flight_log':\n      return 'id';\n    case 'maintenance':\n      return 'id';\n    case 'aircraft_status':\n      return 'id';\n    case 'booking':\n      return 'id';\n    default:\n      return 'id';\n  }\n}\n\nexport async function POST(request: Request) {\n  try {\n    const session = await auth();\n    if (!session?.user?.email) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const user = await prisma.user.findUnique({\n      where: { email: session.user.email },\n    });\n\n    if (!user) {\n      return NextResponse.json({ error: 'User not found' }, { status: 404 });\n    }\n\n    const body: SyncRequest = await request.json();\n    const { changes, userId } = body;\n\n    if (!changes || !Array.isArray(changes)) {\n      return NextResponse.json({ error: 'Invalid changes array' }, { status: 400 });\n    }\n\n    const response: SyncResponse = {\n      applied: [],\n      conflicts: [],\n      errors: [],\n    };\n\n    for (const change of changes) {\n      try {\n        const result = await processChange(change, user.id);\n        \n        if (result.conflict) {\n          response.conflicts.push({\n            type: change.type,\n            action: change.action,\n            localId: change.localId,\n            conflictType: result.conflict.type,\n            serverData: result.conflict.serverData,\n            serverModifiedAt: result.conflict.serverModifiedAt,\n          });\n        } else if (result.applied) {\n          response.applied.push({\n            localId: change.localId,\n            serverId: result.applied,\n          });\n        }\n      } catch (error) {\n        response.errors.push(`Error processing ${change.type} ${change.action}: ${String(error)}`);\n      }\n    }\n\n    return NextResponse.json(response);\n  } catch (error) {\n    console.error('Sync error:', error);\n    return NextResponse.json({ error: 'Sync failed: ' + String(error) }, { status: 500 });\n  }\n}\n\nasync function processChange(\n  change: SyncChange,\n  userId: string\n): Promise<{ conflict?: { type: 'modified' | 'deleted'; serverData: Record<string, unknown>; serverModifiedAt: string }; applied?: string }> {\n  const { type, action, data, localLastSyncedAt, localId } = change;\n\n  // If no last synced timestamp, just apply without conflict check\n  if (!localLastSyncedAt) {\n    const applied = await applyChange(type, action, data, userId);\n    return { applied };\n  }\n\n  // Check for conflicts based on type\n  const conflictCheck = await checkForConflict(type, data, localLastSyncedAt);\n  \n  if (conflictCheck.hasConflict) {\n    return {\n      conflict: {\n        type: conflictCheck.type!,\n        serverData: conflictCheck.serverData!,\n        serverModifiedAt: conflictCheck.serverModifiedAt!,\n      },\n    };\n  }\n\n  // No conflict, apply the change\n  const applied = await applyChange(type, action, data, userId);\n  return { applied };\n}\n\nasync function checkForConflict(\n  type: string,\n  data: Record<string, unknown>,\n  localLastSyncedAt: string\n): Promise<{\n  hasConflict: boolean;\n  type?: 'modified' | 'deleted';\n  serverData?: Record<string, unknown>;\n  serverModifiedAt?: string;\n}> {\n  const id = data.id as string;\n  \n  if (!id) {\n    return { hasConflict: false };\n  }\n\n  const lastSynced = new Date(localLastSyncedAt);\n\n  switch (type) {\n    case 'flight_log': {\n      const existing = await prisma.flightLog.findUnique({\n        where: { id },\n      });\n      \n      if (!existing) {\n        return { hasConflict: false }; // New item, not a conflict\n      }\n      \n      if (!existing.updatedAt) {\n        return { hasConflict: false };\n      }\n      \n      const modifiedAt = new Date(existing.updatedAt);\n      if (modifiedAt > lastSynced) {\n        return {\n          hasConflict: true,\n          type: 'modified',\n          serverData: existing,\n          serverModifiedAt: existing.updatedAt.toISOString(),\n        };\n      }\n      break;\n    }\n    \n    case 'maintenance': {\n      const existing = await prisma.maintenance.findUnique({\n        where: { id },\n      });\n      \n      if (!existing) {\n        return { hasConflict: false };\n      }\n      \n      if (!existing.updatedAt) {\n        return { hasConflict: false };\n      }\n      \n      const modifiedAt = new Date(existing.updatedAt);\n      if (modifiedAt > lastSynced) {\n        return {\n          hasConflict: true,\n          type: 'modified',\n          serverData: existing,\n          serverModifiedAt: existing.updatedAt.toISOString(),\n        };\n      }\n      break;\n    }\n    \n    case 'aircraft_status': {\n      const existing = await prisma.clubAircraft.findUnique({\n        where: { id },\n      });\n      \n      if (!existing) {\n        return { hasConflict: false };\n      }\n      \n      if (!existing.updatedAt) {\n        return { hasConflict: false };\n      }\n      \n      const modifiedAt = new Date(existing.updatedAt);\n      if (modifiedAt > lastSynced) {\n        return {\n          hasConflict: true,\n          type: 'modified',\n          serverData: { status: existing.status },\n          serverModifiedAt: existing.updatedAt.toISOString(),\n        };\n      }\n      break;\n    }\n    \n    case 'booking': {\n      const existing = await prisma.booking.findUnique({\n        where: { id },\n      });\n      \n      if (!existing) {\n        return { hasConflict: true, type: 'deleted' };\n      }\n      \n      if (!existing.updatedAt) {\n        return { hasConflict: false };\n      }\n      \n      const modifiedAt = new Date(existing.updatedAt);\n      if (modifiedAt > lastSynced) {\n        return {\n          hasConflict: true,\n          type: 'modified',\n          serverData: existing,\n          serverModifiedAt: existing.updatedAt.toISOString(),\n        };\n      }\n      break;\n    }\n  }\n\n  return { hasConflict: false };\n}\n\nasync function applyChange(\n  type: string,\n  action: 'create' | 'update' | 'delete',\n  data: Record<string, unknown>,\n  userId: string\n): Promise<string | undefined> {\n  switch (type) {\n    case 'flight_log': {\n      if (action === 'create') {\n        const flightLog = await prisma.flightLog.create({\n          data: {\n            aircraftId: data.aircraftId as string,\n            userId,\n            date: new Date(data.date as string),\n            tachTime: data.tachTime ? Number(data.tachTime) : null,\n            hobbsTime: data.hobbsTime ? Number(data.hobbsTime) : null,\n            notes: data.notes as string | null,\n          },\n        });\n        return flightLog.id;\n      }\n      \n      if (action === 'update') {\n        await prisma.flightLog.update({\n          where: { id: data.id as string },\n          data: {\n            date: data.date ? new Date(data.date as string) : undefined,\n            tachTime: data.tachTime !== undefined ? (data.tachTime ? Number(data.tachTime) : null) : undefined,\n            hobbsTime: data.hobbsTime !== undefined ? (data.hobbsTime ? Number(data.hobbsTime) : null) : undefined,\n            notes: data.notes !== undefined ? (data.notes as string | null) : undefined,\n          },\n        });\n        return data.id as string;\n      }\n      \n      if (action === 'delete') {\n        await prisma.flightLog.delete({\n          where: { id: data.id as string },\n        });\n        return data.id as string;\n      }\n      break;\n    }\n    \n    case 'maintenance': {\n      if (action === 'create') {\n        const maintenance = await prisma.maintenance.create({\n          data: {\n            aircraftId: data.aircraftId as string,\n            userId,\n            description: data.description as string,\n            notes: data.notes as string | null,\n            status: 'NEEDED',\n            isGrounded: data.isGrounded as boolean | false,\n            reportedDate: new Date(),\n          },\n        });\n        return maintenance.id;\n      }\n      \n      if (action === 'update') {\n        await prisma.maintenance.update({\n          where: { id: data.id as string },\n          data: {\n            status: data.status as string | undefined,\n            notes: data.notes !== undefined ? (data.notes as string | null) : undefined,\n            cost: data.cost !== undefined ? (data.cost ? Number(data.cost) : null) : undefined,\n            isGrounded: data.isGrounded !== undefined ? (data.isGrounded as boolean) : undefined,\n            resolvedDate: data.status === 'DONE' ? new Date() : undefined,\n          },\n        });\n        return data.id as string;\n      }\n      \n      if (action === 'delete') {\n        await prisma.maintenance.delete({\n          where: { id: data.id as string },\n        });\n        return data.id as string;\n      }\n      break;\n    }\n    \n    case 'aircraft_status': {\n      if (action === 'update') {\n        await prisma.clubAircraft.update({\n          where: { id: data.id as string },\n          data: {\n            status: data.status as string,\n          },\n        });\n        return data.id as string;\n      }\n      break;\n    }\n    \n    case 'booking': {\n      if (action === 'create') {\n        const booking = await prisma.booking.create({\n          data: {\n            aircraftId: data.aircraftId as string,\n            userId,\n            startTime: new Date(data.startTime as string),\n            endTime: new Date(data.endTime as string),\n            purpose: data.purpose as string | null,\n          },\n        });\n        return booking.id;\n      }\n      \n      if (action === 'update') {\n        await prisma.booking.update({\n          where: { id: data.id as string },\n          data: {\n            startTime: data.startTime ? new Date(data.startTime as string) : undefined,\n            endTime: data.endTime ? new Date(data.endTime as string) : undefined,\n            purpose: data.purpose !== undefined ? (data.purpose as string | null) : undefined,\n          },\n        });\n        return data.id as string;\n      }\n      \n      if (action === 'delete') {\n        await prisma.booking.delete({\n          where: { id: data.id as string },\n        });\n        return data.id as string;\n      }\n      break;\n    }\n  }\n\n  return undefined;\n}\n\n// GET endpoint to fetch sync status\nexport async function GET() {\n  try {\n    const session = await auth();\n    if (!session?.user?.email) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Return current server time for sync reference\n    return NextResponse.json({\n      serverTime: new Date().toISOString(),\n    });\n  } catch (error) {\n    console.error('Sync status error:', error);\n    return NextResponse.json({ error: 'Failed to get sync status' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\test-login\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[494,497],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[494,497],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\"\nimport { auth } from '@/lib/auth';\nimport { PrismaClient } from \"@prisma/client\"\nimport bcrypt from \"bcrypt\"\n\nconst prisma = new PrismaClient()\n\nexport const dynamic = 'force-dynamic'\nexport const runtime = 'nodejs'\n\nexport async function GET(request: Request) {\n  if (process.env.NODE_ENV === 'production') {\n    return NextResponse.json({ error: 'Not found' }, { status: 404 });\n  }\n\n  const session = await auth();\n  const role = (session?.user as any)?.role;\n  if (!session?.user?.id || (role !== 'owner' && role !== 'admin')) {\n    return NextResponse.json({ error: 'Not found' }, { status: 404 });\n  }\n\n  const { searchParams } = new URL(request.url)\n  const email = searchParams.get(\"email\") || \"demo@demo.com\"\n  const password = searchParams.get(\"password\") || \"password123\"\n  \n  try {\n    console.log(\"Test login for:\", email)\n    \n    const user = await prisma.user.findUnique({\n      where: { email: email.trim().toLowerCase() }\n    })\n    \n    if (!user) {\n      return NextResponse.json({ error: \"User not found\", searchedEmail: email.trim().toLowerCase() }, { status: 401 })\n    }\n    \n    if (!user.password) {\n      return NextResponse.json({ error: \"No password in DB\" }, { status: 401 })\n    }\n    \n    const isValid = await bcrypt.compare(password, user.password)\n    \n    return NextResponse.json({\n      success: true,\n      userFound: true,\n      hasPassword: true,\n      passwordValid: isValid,\n      userEmail: user.email,\n      storedPasswordLength: user.password.length\n    })\n  } catch (error) {\n    console.error(\"Test login error:\", error)\n    return NextResponse.json({ error: String(error) }, { status: 500 })\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\tfrs\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TFR' is defined but never used.","line":83,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":83,"endColumn":14}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\n\n// Demo TFRs data - In production, fetch from FAA API\nconst demoTfrs = [\n  {\n    id: 'tfr1',\n    icao: 'KJFK',\n    title: 'VIP Movement',\n    description: 'Temporary Flight Restriction - Presidential movement',\n    type: 'VIP',\n    facility: 'KJFK',\n    city: 'New York',\n    state: 'NY',\n    lowerAltitude: 'SURFACE',\n    upperAltitude: '10000ft MSL',\n    radius: 30,\n    latitude: 40.6413,\n    longitude: -73.7781,\n    startDate: '2026-02-22T14:00:00Z',\n    endDate: '2026-02-22T18:00:00Z',\n    hazard: true,\n    protection: true\n  },\n  {\n    id: 'tfr2',\n    icao: 'KLAX',\n    title: 'Space Operations',\n    description: 'Space vehicle launch/reentry operations',\n    type: 'SPACE OPS',\n    facility: 'KLAX',\n    city: 'Los Angeles',\n    state: 'CA',\n    lowerAltitude: 'SURFACE',\n    upperAltitude: 'UNLIMITED',\n    radius: 10,\n    latitude: 33.9425,\n    longitude: -118.4081,\n    startDate: '2026-02-20T10:00:00Z',\n    endDate: '2026-02-20T14:00:00Z',\n    hazard: true,\n    protection: true\n  },\n  {\n    id: 'tfr3',\n    icao: 'KMIA',\n    title: 'Stadium',\n    description: 'TFR - Special events at stadium',\n    type: 'STADIUM',\n    facility: 'KMIA',\n    city: 'Miami',\n    state: 'FL',\n    lowerAltitude: 'SURFACE',\n    upperAltitude: '3000ft AGL',\n    radius: 3,\n    latitude: 25.7959,\n    longitude: -80.2870,\n    startDate: '2026-02-21T18:00:00Z',\n    endDate: '2026-02-21T23:00:00Z',\n    hazard: false,\n    protection: true\n  },\n  {\n    id: 'tfr4',\n    icao: 'KDCA',\n    title: 'Military Operations',\n    description: 'U.S. Government/DoD flight operations',\n    type: 'MILITARY',\n    facility: 'KDCA',\n    city: 'Washington',\n    state: 'DC',\n    lowerAltitude: 'SURFACE',\n    upperAltitude: '15000ft MSL',\n    radius: 20,\n    latitude: 38.8512,\n    longitude: -77.0402,\n    startDate: '2026-02-19T12:00:00Z',\n    endDate: '2026-02-19T20:00:00Z',\n    hazard: true,\n    protection: true\n  }\n];\n\ninterface TFR {\n  id: string;\n  icao: string;\n  title: string;\n  description: string;\n  type: string;\n  facility: string;\n  city: string;\n  state: string;\n  lowerAltitude: string;\n  upperAltitude: string;\n  radius: number;\n  latitude: number;\n  longitude: number;\n  startDate: string;\n  endDate: string;\n  hazard: boolean;\n  protection: boolean;\n}\n\n// GET /api/tfrs?bounds=minLat,maxLat,minLon,maxLon\nexport async function GET(request: Request) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const bounds = searchParams.get('bounds');\n    \n    let filteredTfrs = [...demoTfrs];\n    \n    // Filter by bounds if provided\n    if (bounds) {\n      const [minLat, maxLat, minLon, maxLon] = bounds.split(',').map(Number);\n      \n      filteredTfrs = demoTfrs.filter(tfr => \n        tfr.latitude >= minLat && \n        tfr.latitude <= maxLat && \n        tfr.longitude >= minLon && \n        tfr.longitude <= maxLon\n      );\n    }\n    \n    // Filter out expired TFRs\n    const now = new Date();\n    filteredTfrs = filteredTfrs.filter(tfr => {\n      const endDate = new Date(tfr.endDate);\n      return endDate > now;\n    });\n    \n    return NextResponse.json({\n      tfrs: filteredTfrs,\n      count: filteredTfrs.length,\n      timestamp: new Date().toISOString()\n    });\n    \n  } catch (error) {\n    console.error('TFR API error:', error);\n    return NextResponse.json(\n      { error: 'Failed to fetch TFRs' },\n      { status: 500 }\n    );\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\training-progress\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\training\\financials\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\training\\goal\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\user-aircraft\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\user\\tier\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\users\\me\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\weather\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'forecastDate' is assigned a value but never used.","line":54,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":54,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":64,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2450,2453],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2450,2453],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":76,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2868,2871],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2868,2871],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":88,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":88,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":108,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3743,3746],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3743,3746],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":109,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":109,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3774,3777],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3774,3777],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":157,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":157,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5595,5598],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5595,5598],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":169,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":169,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5918,5921],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5918,5921],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":221,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":221,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7737,7740],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7737,7740],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Weather API - Cached weather data from aviationweather.gov\r\n * Supports tiered caching based on zoom level\r\n */\r\n\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport sqlite3 from 'sqlite3';\r\nimport https from 'https';\r\nimport http from 'http';\r\nimport path from 'path';\r\n\r\nconst DB_PATH = path.join(process.cwd(), 'data', 'aviation_hub.db');\r\n\r\n// Weather region mapping\r\nconst REGION_MAP: Record<string, { states: string[]; name: string }> = {\r\n  chi: { states: ['IL', 'IN', 'MI', 'OH', 'WI', 'IA', 'KS', 'MN', 'MO', 'ND', 'NE', 'SD'], name: 'Great Lakes/North Central' },\r\n  bos: { states: ['CT', 'ME', 'MA', 'NH', 'NJ', 'NY', 'PA', 'RI', 'VT'], name: 'Northeast' },\r\n  mia: { states: ['DE', 'FL', 'GA', 'MD', 'NC', 'SC', 'VA', 'WV', 'DC'], name: 'Southeast' },\r\n  dfw: { states: ['AL', 'AR', 'KY', 'LA', 'MS', 'OK', 'TN', 'TX'], name: 'South Central' },\r\n  sfo: { states: ['CA', 'OR', 'WA', 'AZ', 'NV', 'UT'], name: 'Pacific/Southwest' },\r\n  slc: { states: ['CO', 'MT', 'NM', 'WY'], name: 'Central/Rockies' },\r\n  alaska: { states: ['AK'], name: 'Alaska' },\r\n  hawaii: { states: ['HI'], name: 'Hawaii' }\r\n};\r\n\r\n// Cache durations (in hours)\r\nconst CACHE_DURATION = {\r\n  regional: 24,\r\n  metar: 6,\r\n  taf: 6\r\n};\r\n\r\nfunction httpGet(url: string): Promise<{ status: number; data: string }> {\r\n  return new Promise((resolve, reject) => {\r\n    const protocol = url.startsWith('https') ? https : http;\r\n    const req = protocol.get(url, { \r\n      headers: { 'User-Agent': 'AviationHub/1.0' },\r\n      timeout: 15000 \r\n    }, (res) => {\r\n      let data = '';\r\n      res.on('data', chunk => data += chunk);\r\n      res.on('end', () => resolve({ status: res.statusCode || 500, data }));\r\n    });\r\n    req.on('error', reject);\r\n    req.setTimeout(15000, () => { req.destroy(); reject(new Error('Timeout')); });\r\n  });\r\n}\r\n\r\nexport async function GET(request: NextRequest): Promise<NextResponse> {\r\n  const { searchParams } = new URL(request.url);\r\n  const icao = searchParams.get('icao');\r\n  const region = searchParams.get('region');\r\n  const forceRefresh = searchParams.get('forceRefresh') === 'true';\r\n  const forecastDate = searchParams.get('forecast'); // YYYY-MM-DD format\r\n\r\n  const db = new sqlite3.Database(DB_PATH);\r\n\r\n  // If icao provided, get airport weather\r\n  if (icao) {\r\n    const icaoUpper = icao.toUpperCase();\r\n    \r\n    // Check cache first for METAR\r\n    if (!forceRefresh) {\r\n      const cached = await new Promise<any>((resolve) => {\r\n        db.get(\r\n          `SELECT data, fetched_at, expires_at FROM weather_cache \r\n           WHERE icao = ? AND data_type = 'metar' AND expires_at > datetime('now')`,\r\n          [icaoUpper],\r\n          (err, row) => resolve(row)\r\n        );\r\n      });\r\n\r\n      if (cached) {\r\n        // Also try to get TAF if requested\r\n        let tafData = null;\r\n        const tafCached = await new Promise<any>((resolve) => {\r\n          db.get(\r\n            `SELECT data, fetched_at FROM weather_cache \r\n             WHERE icao = ? AND data_type = 'taf'`,\r\n            [icaoUpper],\r\n            (err, row) => resolve(row)\r\n          );\r\n        });\r\n        \r\n        if (tafCached) {\r\n          try {\r\n            tafData = JSON.parse(tafCached.data);\r\n          } catch (e) {}\r\n        }\r\n\r\n        db.close();\r\n        return NextResponse.json({\r\n          source: 'cache',\r\n          icao: icaoUpper,\r\n          data: JSON.parse(cached.data),\r\n          taf: tafData,\r\n          fetchedAt: cached.fetched_at,\r\n          expiresAt: cached.expires_at\r\n        });\r\n      }\r\n    }\r\n\r\n    // Fetch fresh METAR\r\n    try {\r\n      const url = `https://aviationweather.gov/api/data/metar?ids=${icaoUpper}&format=json`;\r\n      const response = await httpGet(url);\n\n      let metarData: any = null;\n      let tafData: any = null;\n\r\n      if (response.status === 200) {\r\n        metarData = JSON.parse(response.data);\r\n        \r\n        // Cache METAR\r\n        const expiresAt = new Date(Date.now() + CACHE_DURATION.metar * 60 * 60 * 1000);\r\n        await new Promise<void>((resolve) => {\r\n          db.run(\r\n            `INSERT OR REPLACE INTO weather_cache (id, region, icao, data_type, data, fetched_at, expires_at)\r\n             VALUES (?, NULL, ?, 'metar', ?, datetime('now'), ?)`,\r\n            [`metar-${icaoUpper}`, icaoUpper, JSON.stringify(metarData), expiresAt.toISOString()],\r\n            () => resolve()\r\n          );\r\n        });\r\n      }\r\n\r\n      // Fetch TAF (Terminal Area Forecast)\r\n      try {\r\n        const tafUrl = `https://aviationweather.gov/api/data/taf?ids=${icaoUpper}&format=json`;\r\n        const tafResponse = await httpGet(tafUrl);\r\n        \r\n        if (tafResponse.status === 200) {\r\n          tafData = JSON.parse(tafResponse.data);\r\n          \r\n          // Cache TAF\r\n          const tafExpiresAt = new Date(Date.now() + CACHE_DURATION.taf * 60 * 60 * 1000);\r\n          await new Promise<void>((resolve) => {\r\n            db.run(\r\n              `INSERT OR REPLACE INTO weather_cache (id, region, icao, data_type, data, fetched_at, expires_at)\r\n               VALUES (?, NULL, ?, 'taf', ?, datetime('now'), ?)`,\r\n              [`taf-${icaoUpper}`, icaoUpper, JSON.stringify(tafData), tafExpiresAt.toISOString()],\r\n              () => resolve()\r\n            );\r\n          });\r\n        }\r\n      } catch (tafError) {\r\n        console.log('TAF fetch error:', tafError);\r\n      }\r\n\r\n      db.close();\r\n      return NextResponse.json({\r\n        source: 'live',\r\n        icao: icaoUpper,\r\n        data: metarData,\r\n        taf: tafData,\r\n        fetchedAt: new Date().toISOString()\r\n      });\r\n    } catch (error: any) {\r\n      db.close();\r\n      return NextResponse.json({ error: error.message }, { status: 500 });\r\n    }\r\n  }\r\n\r\n  // If region provided, get regional winds/temps\r\n  if (region) {\r\n    const regionLower = region.toLowerCase();\r\n    \r\n    // Check cache\r\n    if (!forceRefresh) {\r\n      const cached = await new Promise<any>((resolve) => {\r\n        db.get(\r\n          `SELECT data, fetched_at, expires_at FROM weather_cache \r\n           WHERE region = ? AND data_type = 'windtemp' AND expires_at > datetime('now')`,\r\n          [regionLower],\r\n          (err, row) => resolve(row)\r\n        );\r\n      });\r\n\r\n      if (cached) {\r\n        db.close();\r\n        return NextResponse.json({\r\n          source: 'cache',\r\n          region: regionLower,\r\n          data: JSON.parse(cached.data),\r\n          fetchedAt: cached.fetched_at,\r\n          expiresAt: cached.expires_at\r\n        });\r\n      }\r\n    }\r\n\r\n    // Fetch fresh wind/temp data\r\n    try {\r\n      const url = `https://aviationweather.gov/api/data/windtemp?region=${regionLower}&format=json`;\r\n      const response = await httpGet(url);\r\n\r\n      if (response.status === 200) {\r\n        const windData = JSON.parse(response.data);\r\n        \r\n        // Cache it\r\n        const expiresAt = new Date(Date.now() + CACHE_DURATION.regional * 60 * 60 * 1000);\r\n        await new Promise<void>((resolve) => {\r\n          db.run(\r\n            `INSERT OR REPLACE INTO weather_cache (id, region, icao, data_type, data, fetched_at, expires_at)\r\n             VALUES (?, ?, NULL, 'windtemp', ?, datetime('now'), ?)`,\r\n            [`windtemp-${regionLower}`, regionLower, JSON.stringify(windData), expiresAt.toISOString()],\r\n            () => resolve()\r\n          );\r\n        });\r\n\r\n        db.close();\r\n        return NextResponse.json({\r\n          source: 'live',\r\n          region: regionLower,\r\n          data: windData,\r\n          fetchedAt: new Date().toISOString(),\r\n          expiresAt: expiresAt.toISOString()\r\n        });\r\n      } else {\r\n        db.close();\r\n        return NextResponse.json({ error: 'Failed to fetch wind data' }, { status: response.status });\r\n      }\r\n    } catch (error: any) {\r\n      db.close();\r\n      return NextResponse.json({ error: error.message }, { status: 500 });\r\n    }\r\n  }\r\n\r\n  // Return available regions\r\n  db.close();\r\n  return NextResponse.json({\r\n    regions: Object.entries(REGION_MAP).map(([code, info]) => ({\r\n      code,\r\n      name: info.name,\r\n      states: info.states\r\n    }))\r\n  });\r\n}\r\n\r\nexport async function POST(request: NextRequest): Promise<NextResponse> {\r\n  const { icao, region } = await request.json();\r\n  const db = new sqlite3.Database(DB_PATH);\r\n\r\n  // Clear cache for this item\r\n  if (icao) {\r\n    await new Promise<void>((resolve) => {\r\n      db.run('DELETE FROM weather_cache WHERE icao = ?', [icao.toUpperCase()], () => resolve());\r\n    });\r\n  }\r\n  if (region) {\r\n    await new Promise<void>((resolve) => {\r\n      db.run('DELETE FROM weather_cache WHERE region = ?', [region.toLowerCase()], () => resolve());\r\n    });\r\n  }\r\n\r\n  db.close();\r\n  return NextResponse.json({ message: 'Cache cleared', icao, region });\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\api\\weight-balance\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":19,"column":167,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":170,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[718,721],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[718,721],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":52,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1562,1565],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1562,1565],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Weight & Balance Calculator API\n * Calculate W&B and get aircraft specifications\n */\n\nimport { NextRequest, NextResponse } from 'next/server';\nimport sqlite3 from 'sqlite3';\nimport path from 'path';\n\nconst DB_PATH = path.join(process.cwd(), 'data', 'aviation_hub.db');\n\n// Standard passenger weights (including 10 lb allowance for clothing/baggage)\nconst DEFAULT_PASSENGER_WEIGHT = 170; // lbs\n\nexport async function GET(): Promise<NextResponse> {\n  const db = new sqlite3.Database(DB_PATH);\n  \n  return new Promise<NextResponse>((resolve) => {\n    db.all(\"SELECT make, model, empty_weight, empty_cg, max_weight, fuel_capacity, cruise_speed, fuel_burn FROM weight_balance ORDER BY make, model\", [], (err, rows: any[]) => {\n      db.close();\n      \n      if (err) {\n        console.error('Error:', err);\n        return resolve(NextResponse.json({ error: 'Database error' }, { status: 500 }));\n      }\n\n      resolve(NextResponse.json({ aircraft: rows }));\n    });\n  });\n}\n\nexport async function POST(request: NextRequest): Promise<NextResponse> {\n  try {\n    const { \n      aircraftId,\n      make,\n      model,\n      pilotWeight = DEFAULT_PASSENGER_WEIGHT,\n      passengers = 0,\n      passengerWeight = DEFAULT_PASSENGER_WEIGHT,\n      baggageWeight = 0,\n      fuelGallons = 0\n    } = await request.json();\n\n    if (!make && !model && !aircraftId) {\n      return NextResponse.json({ error: 'Aircraft required' }, { status: 400 });\n    }\n\n    const db = new sqlite3.Database(DB_PATH);\n    \n    // Get aircraft specs\n    const getAircraft = () => new Promise<any>((resolve, reject) => {\n      if (aircraftId) {\n        db.get(\"SELECT * FROM weight_balance WHERE id = ?\", [aircraftId], (err, row) => {\n          if (err) reject(err);\n          else resolve(row);\n        });\n      } else {\n        db.get(\"SELECT * FROM weight_balance WHERE make = ? AND model = ?\", [make, model], (err, row) => {\n          if (err) reject(err);\n          else resolve(row);\n        });\n      }\n    });\n\n    const aircraft = await getAircraft();\n    \n    if (!aircraft) {\n      db.close();\n      return NextResponse.json({ error: 'Aircraft not found in database' }, { status: 404 });\n    }\n\n    // Weight & Balance Calculations\n    const emptyWeight = aircraft.empty_weight;\n    const emptyCG = aircraft.empty_cg;\n    const maxWeight = aircraft.max_weight;\n    const armPilot = aircraft.arm_pilot;\n    const armPassenger = aircraft.arm_passenger;\n    const armBaggage = aircraft.arm_baggage;\n    const armFuel = aircraft.arm_fuel;\n    const unusableFuel = aircraft.unusable_fuel || 2;\n    const fuelDensity = 6.0; // lbs per gallon for 100LL\n\n    // Calculate loads\n    const pilotLoad = pilotWeight * armPilot;\n    const passengerLoad = (passengers * passengerWeight) * armPassenger;\n    const baggageLoad = baggageWeight * armBaggage;\n    const fuelWeight = (fuelGallons * fuelDensity);\n    const fuelLoad = fuelWeight * armFuel;\n\n    // Total weight\n    const totalWeight = emptyWeight + pilotLoad / armPilot + passengerLoad + baggageLoad + fuelWeight;\n\n    // Total moment\n    const totalMoment = emptyWeight * emptyCG + pilotLoad + passengerLoad + baggageLoad + fuelLoad;\n    \n    // Calculate CG\n    const cg = totalWeight > 0 ? totalMoment / totalWeight : emptyCG;\n\n    // Check if within limits\n    const cgMin = aircraft.cg_min || 78;\n    const cgMax = aircraft.cg_max || 93;\n    const isWithinCG = cg >= cgMin && cg <= cgMax;\n    const isWithinWeight = totalWeight <= maxWeight;\n\n    // Calculate fuel penalty if overweight\n    let fuelPenalty = 0;\n    let fuelPenaltyMessage = '';\n    \n    if (totalWeight > maxWeight) {\n      const overweightLbs = totalWeight - maxWeight;\n      fuelPenalty = Math.ceil(overweightLbs / fuelDensity);\n      fuelPenaltyMessage = `Reduce fuel by ${fuelPenalty} gallons to be within weight limits`;\n    }\n\n    // Calculate range with current fuel (reserve-adjusted)\n    const usableFuel = Math.max(0, fuelGallons - unusableFuel);\n    const cruiseSpeed = aircraft.cruise_speed;\n    const fuelBurn = aircraft.fuel_burn;\n    \n    // Range with reserves (1 hour reserve)\n    const reserveFuel = fuelBurn * 1;\n    const effectiveRange = usableFuel > reserveFuel \n      ? ((usableFuel - reserveFuel) / fuelBurn) * cruiseSpeed \n      : 0;\n\n    // Range without reserve\n    const maxRange = usableFuel > 0 \n      ? (usableFuel / fuelBurn) * cruiseSpeed \n      : 0;\n\n    db.close();\n\n    return NextResponse.json({\n      aircraft: {\n        make: aircraft.make,\n        model: aircraft.model,\n        emptyWeight,\n        emptyCG,\n        maxWeight,\n        cruiseSpeed,\n        fuelBurn\n      },\n      input: {\n        pilotWeight,\n        passengers,\n        passengerWeight,\n        baggageWeight,\n        fuelGallons,\n        actualPassengers: (passengerWeight > 0 ? passengers : 0) + (pilotWeight > 0 ? 1 : 0)\n      },\n      calculations: {\n        totalWeight: Math.round(totalWeight),\n        cg: Math.round(cg * 100) / 100,\n        maxWeight,\n        isWithinWeight,\n        isWithinCG,\n        cgMin,\n        cgMax,\n        overweightLbs: Math.max(0, totalWeight - maxWeight)\n      },\n      fuelPenalty: {\n        gallons: fuelPenalty,\n        message: fuelPenaltyMessage\n      },\n      range: {\n        withReserve: Math.round(effectiveRange),\n        max: Math.round(maxRange),\n        reserveFuel: Math.round(reserveFuel),\n        usableFuel: Math.round(usableFuel)\n      },\n      warning: !isWithinWeight || !isWithinCG \n        ? `âš ï¸ ${!isWithinWeight ? 'Overweight' : ''} ${!isWithinCG ? 'CG out of limits' : ''}`.trim()\n        : null,\n      disclaimer: 'âš ï¸ These are TYPICAL VALUES - verify with actual aircraft documents before flight'\n    });\n\n  } catch (error) {\n    console.error('Error:', error);\n    return NextResponse.json({ error: 'Calculation error' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\components\\AuthModalContext.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\components\\CurrencyTracker.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'session' is assigned a value but never used.","line":27,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":27,"endColumn":24},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'calculateCurrencies'. Either include it or remove the dependency array.","line":42,"column":6,"nodeType":"ArrayExpression","endLine":42,"endColumn":15,"suggestions":[{"desc":"Update the dependencies array to be: [calculateCurrencies, entries]","fix":{"range":[937,946],"text":"[calculateCurrencies, entries]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useEffect, useState } from 'react';\nimport { useSession } from 'next-auth/react';\n\ninterface LogbookEntry {\n  date: string;\n  totalTime: number;\n  soloTime: number;\n  nightTime: number;\n  instrumentTime: number;\n  dayLandings: number;\n  nightLandings: number;\n  dualReceived: number;\n}\n\ninterface CurrencyStatus {\n  name: string;\n  icon: string;\n  isCurrent: boolean;\n  expiresAt: Date | null;\n  daysRemaining: number;\n  description: string;\n}\n\nexport default function CurrencyTracker() {\n  const { data: session, status } = useSession();\n  const [entries, setEntries] = useState<LogbookEntry[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [currencies, setCurrencies] = useState<CurrencyStatus[]>([]);\n\n  useEffect(() => {\n    if (status === 'authenticated') {\n      fetchEntries();\n    }\n  }, [status]);\n\n  useEffect(() => {\n    if (entries.length > 0) {\n      calculateCurrencies();\n    }\n  }, [entries]);\n\n  const fetchEntries = async () => {\n    try {\n      const res = await fetch('/api/logbook');\n      if (!res.ok) {\n        setLoading(false);\n        return;\n      }\n      const data = await res.json();\n      setEntries(data.entries || []);\n    } catch (err) {\n      console.error('Failed to fetch entries:', err);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const calculateCurrencies = () => {\n    const now = new Date();\n    const calculated: CurrencyStatus[] = [];\n\n    // 1. BFR (Biennial Flight Review) - 24 months from last dual flight\n    const lastDualFlight = entries\n      .filter(e => e.dualReceived > 0)\n      .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime())[0];\n    \n    if (lastDualFlight) {\n      const lastDualDate = new Date(lastDualFlight.date);\n      const bfrExpires = new Date(lastDualDate);\n      bfrExpires.setMonth(bfrExpires.getMonth() + 24);\n      const daysUntilBFR = Math.floor((bfrExpires.getTime() - now.getTime()) / (1000 * 60 * 60 * 24));\n      \n      calculated.push({\n        name: 'BFR (Biennial Flight Review)',\n        icon: 'ðŸ“‹',\n        isCurrent: daysUntilBFR > 0,\n        expiresAt: bfrExpires,\n        daysRemaining: daysUntilBFR,\n        description: 'Required every 24 months',\n      });\n    } else {\n      calculated.push({\n        name: 'BFR (Biennial Flight Review)',\n        icon: 'ðŸ“‹',\n        isCurrent: false,\n        expiresAt: null,\n        daysRemaining: -999,\n        description: 'No dual instruction recorded',\n      });\n    }\n\n    // 2. Night Currency - 90 days from last night landing\n    const lastNightLanding = entries\n      .filter(e => e.nightLandings > 0)\n      .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime())[0];\n    \n    if (lastNightLanding) {\n      const lastNightDate = new Date(lastNightLanding.date);\n      const nightCurrencyExpires = new Date(lastNightDate);\n      nightCurrencyExpires.setDate(nightCurrencyExpires.getDate() + 90);\n      const daysUntilNight = Math.floor((nightCurrencyExpires.getTime() - now.getTime()) / (1000 * 60 * 60 * 24));\n      \n      calculated.push({\n        name: 'Night Landing Currency',\n        icon: 'ðŸŒ™',\n        isCurrent: daysUntilNight > 0,\n        expiresAt: nightCurrencyExpires,\n        daysRemaining: daysUntilNight,\n        description: 'Required every 90 days for night flights',\n      });\n    } else {\n      calculated.push({\n        name: 'Night Landing Currency',\n        icon: 'ðŸŒ™',\n        isCurrent: false,\n        expiresAt: null,\n        daysRemaining: -999,\n        description: 'No night landings recorded',\n      });\n    }\n\n    // 3. Instrument Currency - 6 months from last instrument time\n    const lastInstrument = entries\n      .filter(e => e.instrumentTime > 0)\n      .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime())[0];\n    \n    if (lastInstrument) {\n      const lastInstDate = new Date(lastInstrument.date);\n      const instrumentExpires = new Date(lastInstDate);\n      instrumentExpires.setMonth(instrumentExpires.getMonth() + 6);\n      const daysUntilInst = Math.floor((instrumentExpires.getTime() - now.getTime()) / (1000 * 60 * 60 * 24));\n      \n      calculated.push({\n        name: 'Instrument Currency',\n        icon: 'ðŸŒ«ï¸',\n        isCurrent: daysUntilInst > 0,\n        expiresAt: instrumentExpires,\n        daysRemaining: daysUntilInst,\n        description: 'Required every 6 months under IFR',\n      });\n    } else {\n      calculated.push({\n        name: 'Instrument Currency',\n        icon: 'ðŸŒ«ï¸',\n        isCurrent: false,\n        expiresAt: null,\n        daysRemaining: -999,\n        description: 'No instrument time recorded',\n      });\n    }\n\n    // 4. Passenger Carrying Currency (Day) - 90 days from 3 takeoffs/landings\n    const recentDayLandings = entries\n      .filter(e => new Date(e.date) > new Date(now.getTime() - 90 * 24 * 60 * 60 * 1000))\n      .reduce((sum, e) => sum + e.dayLandings, 0);\n    \n    const dayPassengerCurrent = recentDayLandings >= 3;\n    const dayExpires = dayPassengerCurrent \n      ? new Date(Math.min(...entries\n          .filter(e => e.dayLandings > 0)\n          .map(e => new Date(e.date).getTime())) + 90 * 24 * 60 * 60 * 1000)\n      : null;\n    \n    calculated.push({\n      name: 'Day Passenger Currency',\n      icon: 'ðŸ‘¥',\n      isCurrent: dayPassengerCurrent,\n      expiresAt: dayExpires,\n      daysRemaining: dayExpires ? Math.floor((dayExpires.getTime() - now.getTime()) / (1000 * 60 * 60 * 24)) : -999,\n      description: '3 takeoffs/landings in 90 days',\n    });\n\n    // 5. Passenger Carrying Currency (Night) - 90 days from 3 night takeoffs/landings\n    const recentNightLandings = entries\n      .filter(e => new Date(e.date) > new Date(now.getTime() - 90 * 24 * 60 * 60 * 1000))\n      .reduce((sum, e) => sum + e.nightLandings, 0);\n    \n    const nightPassengerCurrent = recentNightLandings >= 3;\n    const nightPassExpires = nightPassengerCurrent\n      ? new Date(Math.min(...entries\n          .filter(e => e.nightLandings > 0)\n          .map(e => new Date(e.date).getTime())) + 90 * 24 * 60 * 60 * 1000)\n      : null;\n    \n    calculated.push({\n      name: 'Night Passenger Currency',\n      icon: 'ðŸŒƒ',\n      isCurrent: nightPassengerCurrent,\n      expiresAt: nightPassExpires,\n      daysRemaining: nightPassExpires ? Math.floor((nightPassExpires.getTime() - now.getTime()) / (1000 * 60 * 60 * 24)) : -999,\n      description: '3 night takeoffs/landings in 90 days',\n    });\n\n    // 6. IPC (Instrument Proficiency Check) - 12 months\n    // This would need a specific IPC log entry type - for now estimate from last instrument training\n    const lastInstTraining = entries\n      .filter(e => e.instrumentTime > 0 && e.dualReceived > 0)\n      .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime())[0];\n    \n    if (lastInstTraining) {\n      const lastTrainingDate = new Date(lastInstTraining.date);\n      const ipcExpires = new Date(lastTrainingDate);\n      ipcExpires.setMonth(ipcExpires.getMonth() + 12);\n      const daysUntilIPC = Math.floor((ipcExpires.getTime() - now.getTime()) / (1000 * 60 * 60 * 24));\n      \n      calculated.push({\n        name: 'IPC (Instrument Proficiency)',\n        icon: 'âœˆï¸',\n        isCurrent: daysUntilIPC > 0,\n        expiresAt: ipcExpires,\n        daysRemaining: daysUntilIPC,\n        description: 'Required every 12 months (estimate)',\n      });\n    } else {\n      calculated.push({\n        name: 'IPC (Instrument Proficiency)',\n        icon: 'âœˆï¸',\n        isCurrent: false,\n        expiresAt: null,\n        daysRemaining: -999,\n        description: 'No instrument training recorded',\n      });\n    }\n\n    setCurrencies(calculated);\n  };\n\n  const getStatusColor = (currency: CurrencyStatus) => {\n    if (!currency.isCurrent) return 'bg-red-500/20 border-red-500/30 text-red-400';\n    if (currency.daysRemaining < 30) return 'bg-amber-500/20 border-amber-500/30 text-amber-400';\n    return 'bg-emerald-500/20 border-emerald-500/30 text-emerald-400';\n  };\n\n  const getStatusText = (currency: CurrencyStatus) => {\n    if (!currency.isCurrent) return 'EXPIRED';\n    if (currency.daysRemaining < 30) return `${currency.daysRemaining} days left`;\n    if (currency.daysRemaining < 90) return `${currency.daysRemaining} days left`;\n    return 'Current';\n  };\n\n  if (loading) {\n    return (\n      <div className=\"bg-slate-800 rounded-xl p-6\">\n        <h2 className=\"text-xl font-bold text-white mb-4\">ðŸ“‹ Currency Tracker</h2>\n        <p className=\"text-slate-400\">Loading...</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"bg-slate-800 rounded-xl p-6\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <div>\n          <h2 className=\"text-xl font-bold text-white\">ðŸ“‹ Currency Tracker</h2>\n          <p className=\"text-slate-400 text-sm\">Track your flight currency expiration dates</p>\n        </div>\n        <button\n          onClick={fetchEntries}\n          className=\"text-sm text-emerald-400 hover:text-emerald-300\"\n        >\n          Refresh\n        </button>\n      </div>\n\n      {entries.length === 0 ? (\n        <div className=\"text-center py-8\">\n          <p className=\"text-slate-400 mb-2\">No logbook entries found</p>\n          <p className=\"text-slate-500 text-sm\">\n            Add flights to your logbook to track currency\n          </p>\n        </div>\n      ) : (\n        <div className=\"space-y-3\">\n          {currencies.map((currency, i) => (\n            <div\n              key={i}\n              className={`rounded-lg border p-4 ${getStatusColor(currency)}`}\n            >\n              <div className=\"flex items-start justify-between\">\n                <div className=\"flex items-start gap-3\">\n                  <span className=\"text-2xl\">{currency.icon}</span>\n                  <div>\n                    <h3 className=\"font-semibold\">{currency.name}</h3>\n                    <p className=\"text-xs opacity-80\">{currency.description}</p>\n                    {currency.expiresAt && (\n                      <p className=\"text-xs mt-1\">\n                        Expires: {currency.expiresAt.toLocaleDateString()}\n                      </p>\n                    )}\n                  </div>\n                </div>\n                <div className=\"text-right\">\n                  <span className={`text-sm font-bold ${\n                    currency.isCurrent \n                      ? currency.daysRemaining < 30 ? 'text-amber-400' : 'text-emerald-400'\n                      : 'text-red-400'\n                  }`}>\n                    {getStatusText(currency)}\n                  </span>\n                </div>\n              </div>\n            </div>\n          ))}\n        </div>\n      )}\n\n      <div className=\"mt-6 pt-4 border-t border-slate-700\">\n        <p className=\"text-xs text-slate-500\">\n          ðŸ’¡ Tip: Currency is calculated from your logbook entries. \n          Keep your logbook up to date for accurate tracking.\n        </p>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\components\\ErrorBoundary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\components\\HourAnalytics.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'session' is assigned a value but never used.","line":27,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":27,"endColumn":24},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'calculateAnalytics'. Either include it or remove the dependency array.","line":51,"column":6,"nodeType":"ArrayExpression","endLine":51,"endColumn":15,"suggestions":[{"desc":"Update the dependencies array to be: [calculateAnalytics, entries]","fix":{"range":[1121,1130],"text":"[calculateAnalytics, entries]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useEffect, useState } from 'react';\nimport { useSession } from 'next-auth/react';\n\ninterface LogbookEntry {\n  date: string;\n  totalTime: number;\n  soloTime: number;\n  nightTime: number;\n  instrumentTime: number;\n  crossCountryTime: number;\n  dualReceived: number;\n}\n\ninterface MonthlyData {\n  month: string;\n  total: number;\n  solo: number;\n  night: number;\n  instrument: number;\n  crossCountry: number;\n  dual: number;\n}\n\nexport default function HourAnalytics() {\n  const { data: session, status } = useSession();\n  const [entries, setEntries] = useState<LogbookEntry[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [monthlyData, setMonthlyData] = useState<MonthlyData[]>([]);\n  const [totals, setTotals] = useState({\n    total: 0,\n    solo: 0,\n    night: 0,\n    instrument: 0,\n    crossCountry: 0,\n    dual: 0,\n  });\n  const [selectedType, setSelectedType] = useState<string>('total');\n\n  useEffect(() => {\n    if (status === 'authenticated') {\n      fetchEntries();\n    }\n  }, [status]);\n\n  useEffect(() => {\n    if (entries.length > 0) {\n      calculateAnalytics();\n    }\n  }, [entries]);\n\n  const fetchEntries = async () => {\n    try {\n      const res = await fetch('/api/logbook');\n      if (!res.ok) {\n        setLoading(false);\n        return;\n      }\n      const data = await res.json();\n      setEntries(data.entries || []);\n    } catch (err) {\n      console.error('Failed to fetch entries:', err);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const calculateAnalytics = () => {\n    // Calculate totals\n    const totals = entries.reduce((acc, entry) => ({\n      total: acc.total + entry.totalTime,\n      solo: acc.solo + entry.soloTime,\n      night: acc.night + entry.nightTime,\n      instrument: acc.instrument + entry.instrumentTime,\n      crossCountry: acc.crossCountry + entry.crossCountryTime,\n      dual: acc.dual + entry.dualReceived,\n    }), {\n      total: 0, solo: 0, night: 0, instrument: 0, crossCountry: 0, dual: 0,\n    });\n    setTotals(totals);\n\n    // Group by month (last 12 months)\n    const monthlyMap = new Map<string, MonthlyData>();\n    const now = new Date();\n    \n    // Initialize last 12 months with zeros\n    for (let i = 11; i >= 0; i--) {\n      const d = new Date(now.getFullYear(), now.getMonth() - i, 1);\n      const key = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}`;\n      monthlyMap.set(key, {\n        month: d.toLocaleDateString('en-US', { month: 'short', year: 'numeric' }),\n        total: 0, solo: 0, night: 0, instrument: 0, crossCountry: 0, dual: 0,\n      });\n    }\n\n    // Fill with actual data\n    entries.forEach(entry => {\n      const date = new Date(entry.date);\n      const key = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;\n      if (monthlyMap.has(key)) {\n        const existing = monthlyMap.get(key)!;\n        existing.total += entry.totalTime;\n        existing.solo += entry.soloTime;\n        existing.night += entry.nightTime;\n        existing.instrument += entry.instrumentTime;\n        existing.crossCountry += entry.crossCountryTime;\n        existing.dual += entry.dualReceived;\n      }\n    });\n\n    setMonthlyData(Array.from(monthlyMap.values()));\n  };\n\n  const getBarHeight = (value: number, max: number) => {\n    if (max === 0) return 0;\n    return Math.max((value / max) * 100, 4); // Minimum 4% height\n  };\n\n  const getMaxValue = () => {\n    if (monthlyData.length === 0) return 0;\n    return Math.max(...monthlyData.map(d => {\n      switch (selectedType) {\n        case 'solo': return d.solo;\n        case 'night': return d.night;\n        case 'instrument': return d.instrument;\n        case 'crossCountry': return d.crossCountry;\n        case 'dual': return d.dual;\n        default: return d.total;\n      }\n    }));\n  };\n\n  const getValue = (data: MonthlyData) => {\n    switch (selectedType) {\n      case 'solo': return data.solo;\n      case 'night': return data.night;\n      case 'instrument': return data.instrument;\n      case 'crossCountry': return data.crossCountry;\n      case 'dual': return data.dual;\n      default: return data.total;\n    }\n  };\n\n  const getTypeColor = () => {\n    switch (selectedType) {\n      case 'solo': return 'bg-emerald-500';\n      case 'night': return 'bg-purple-500';\n      case 'instrument': return 'bg-amber-500';\n      case 'crossCountry': return 'bg-sky-500';\n      case 'dual': return 'bg-pink-500';\n      default: return 'bg-emerald-500';\n    }\n  };\n\n  const getTypeLabel = () => {\n    switch (selectedType) {\n      case 'solo': return 'Solo Hours';\n      case 'night': return 'Night Hours';\n      case 'instrument': return 'Instrument Hours';\n      case 'crossCountry': return 'Cross Country';\n      case 'dual': return 'Dual Received';\n      default: return 'Total Hours';\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"bg-slate-800 rounded-xl p-6\">\n        <h2 className=\"text-xl font-bold text-white mb-4\">ðŸ“Š Hour Analytics</h2>\n        <p className=\"text-slate-400\">Loading...</p>\n      </div>\n    );\n  }\n\n  const maxValue = getMaxValue();\n\n  return (\n    <div className=\"bg-slate-800 rounded-xl p-6\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <div>\n          <h2 className=\"text-xl font-bold text-white\">ðŸ“Š Hour Analytics</h2>\n          <p className=\"text-slate-400 text-sm\">Visual breakdown of your flight hours</p>\n        </div>\n        <select\n          value={selectedType}\n          onChange={(e) => setSelectedType(e.target.value)}\n          className=\"bg-slate-700 border border-slate-600 rounded-lg px-3 py-1 text-white text-sm\"\n        >\n          <option value=\"total\">Total Hours</option>\n          <option value=\"solo\">Solo Hours</option>\n          <option value=\"night\">Night Hours</option>\n          <option value=\"instrument\">Instrument Hours</option>\n          <option value=\"crossCountry\">Cross Country</option>\n          <option value=\"dual\">Dual Received</option>\n        </select>\n      </div>\n\n      {entries.length === 0 ? (\n        <div className=\"text-center py-8\">\n          <p className=\"text-slate-400 mb-2\">No logbook entries found</p>\n          <p className=\"text-slate-500 text-sm\">\n            Add flights to see your analytics\n          </p>\n        </div>\n      ) : (\n        <>\n          {/* Summary Cards */}\n          <div className=\"grid grid-cols-3 md:grid-cols-6 gap-3 mb-6\">\n            <div \n              className={`rounded-lg p-3 cursor-pointer transition ${selectedType === 'total' ? 'bg-emerald-500/20 border border-emerald-500/30' : 'bg-slate-700/50'}`}\n              onClick={() => setSelectedType('total')}\n            >\n              <p className=\"text-xs text-slate-400\">Total</p>\n              <p className=\"text-lg font-bold text-white\">{totals.total.toFixed(1)}</p>\n            </div>\n            <div \n              className={`rounded-lg p-3 cursor-pointer transition ${selectedType === 'solo' ? 'bg-emerald-500/20 border border-emerald-500/30' : 'bg-slate-700/50'}`}\n              onClick={() => setSelectedType('solo')}\n            >\n              <p className=\"text-xs text-slate-400\">Solo</p>\n              <p className=\"text-lg font-bold text-emerald-400\">{totals.solo.toFixed(1)}</p>\n            </div>\n            <div \n              className={`rounded-lg p-3 cursor-pointer transition ${selectedType === 'night' ? 'bg-purple-500/20 border border-purple-500/30' : 'bg-slate-700/50'}`}\n              onClick={() => setSelectedType('night')}\n            >\n              <p className=\"text-xs text-slate-400\">Night</p>\n              <p className=\"text-lg font-bold text-purple-400\">{totals.night.toFixed(1)}</p>\n            </div>\n            <div \n              className={`rounded-lg p-3 cursor-pointer transition ${selectedType === 'instrument' ? 'bg-amber-500/20 border border-amber-500/30' : 'bg-slate-700/50'}`}\n              onClick={() => setSelectedType('instrument')}\n            >\n              <p className=\"text-xs text-slate-400\">Inst</p>\n              <p className=\"text-lg font-bold text-amber-400\">{totals.instrument.toFixed(1)}</p>\n            </div>\n            <div \n              className={`rounded-lg p-3 cursor-pointer transition ${selectedType === 'crossCountry' ? 'bg-sky-500/20 border border-sky-500/30' : 'bg-slate-700/50'}`}\n              onClick={() => setSelectedType('crossCountry')}\n            >\n              <p className=\"text-xs text-slate-400\">XC</p>\n              <p className=\"text-lg font-bold text-sky-400\">{totals.crossCountry.toFixed(1)}</p>\n            </div>\n            <div \n              className={`rounded-lg p-3 cursor-pointer transition ${selectedType === 'dual' ? 'bg-pink-500/20 border border-pink-500/30' : 'bg-slate-700/50'}`}\n              onClick={() => setSelectedType('dual')}\n            >\n              <p className=\"text-xs text-slate-400\">Dual</p>\n              <p className=\"text-lg font-bold text-pink-400\">{totals.dual.toFixed(1)}</p>\n            </div>\n          </div>\n\n          {/* Bar Chart */}\n          <div className=\"mb-4\">\n            <h3 className=\"text-sm font-medium text-slate-300 mb-3\">{getTypeLabel()} - Last 12 Months</h3>\n            <div className=\"h-48 flex items-end gap-2\">\n              {monthlyData.map((data, i) => {\n                const value = getValue(data);\n                const height = getBarHeight(value, maxValue);\n                return (\n                  <div key={i} className=\"flex-1 flex flex-col items-center\">\n                    <div className=\"w-full relative\" style={{ height: '160px' }}>\n                      <div\n                        className={`absolute bottom-0 w-full rounded-t ${getTypeColor()} transition-all duration-500`}\n                        style={{ height: `${height}%` }}\n                        title={`${data.month}: ${value.toFixed(1)} hours`}\n                      />\n                    </div>\n                    <p className=\"text-xs text-slate-500 mt-1 truncate w-full text-center\">\n                      {data.month.split(' ')[0]}\n                    </p>\n                  </div>\n                );\n              })}\n            </div>\n          </div>\n\n          {/* Recent Activity */}\n          <div className=\"mt-6 pt-6 border-t border-slate-700\">\n            <h3 className=\"text-sm font-medium text-slate-300 mb-3\">Recent Activity</h3>\n            <div className=\"space-y-2\">\n              {entries.slice(0, 5).map((entry, i) => (\n                <div key={i} className=\"flex items-center justify-between text-sm\">\n                  <span className=\"text-slate-400\">\n                    {new Date(entry.date).toLocaleDateString()}\n                  </span>\n                  <span className=\"text-slate-300\">{entry.totalTime.toFixed(1)} hrs</span>\n                </div>\n              ))}\n            </div>\n          </div>\n        </>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\components\\LoginModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'status' is assigned a value but never used.","line":28,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":28,"endColumn":32},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\David\\next-dashboard\\app\\components\\LoginModal.tsx:42:7\n  40 |   useEffect(() => {\n  41 |     if (isOpen) {\n> 42 |       setUsername('');\n     |       ^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  43 |       setEmail('');\n  44 |       setPassword('');\n  45 |       setName('');","line":42,"column":7,"nodeType":null,"endLine":42,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":125,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":125,"endColumn":19}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\n/**\n * LoginModal - The actual modal component for signing in or creating an account\n * \n * This component is rendered at the app level (in ClientLayout) and is hidden by default.\n * It shows/hides based on the AuthModalContext state.\n * \n * Features:\n * - Toggle between Sign In and Sign Up tabs\n * - Full form validation\n * - AJAX login (no page redirect) using NextAuth\n * - Auto-redirects after successful login if redirectTo is set\n * - \"Continue as Guest\" option\n * - \"Forgot password\" link\n * \n * Connected to: AuthModalContext for global state management\n */\n\nimport { useState, useEffect } from 'react';\nimport { useSession, signIn } from 'next-auth/react';\nimport { useRouter } from 'next/navigation';\nimport Link from 'next/link';\nimport { useAuthModal } from './AuthModalContext';\n\nexport default function LoginModal() {\n  const { isOpen, closeModal, redirectTo } = useAuthModal();\n  const { data: session, status } = useSession();\n  const router = useRouter();\n  \n  const [mode, setMode] = useState<'login' | 'signup'>('login');\n  const [username, setUsername] = useState('');\n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n  const [name, setName] = useState('');\n  const [error, setError] = useState('');\n  const [loading, setLoading] = useState(false);\n\n  // Reset form when modal opens/closes or mode changes\n  useEffect(() => {\n    if (isOpen) {\n      setUsername('');\n      setEmail('');\n      setPassword('');\n      setName('');\n      setError('');\n      setLoading(false);\n    }\n  }, [isOpen, mode]);\n\n  // Redirect if already logged in\n  useEffect(() => {\n    if (session?.user && isOpen) {\n      closeModal();\n      if (redirectTo) {\n        router.push(redirectTo);\n      }\n    }\n  }, [session, isOpen, redirectTo, closeModal, router]);\n\n  if (!isOpen) return null;\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError('');\n    setLoading(true);\n\n    if (mode === 'login') {\n      const result = await signIn('credentials', {\n        username,\n        password,\n        redirect: false,\n      });\n\n      setLoading(false);\n\n      if (result?.error) {\n        setError('Invalid username or password');\n      } else if (result?.ok) {\n        closeModal();\n        // Use window.location for guaranteed redirect\n        window.location.href = '/dashboard';\n      }\n    } else {\n      // Signup - validate required fields\n      if (!username || username.length < 3) {\n        setError('Username is required (min 3 characters)');\n        setLoading(false);\n        return;\n      }\n      if (!email) {\n        setError('Email is required');\n        setLoading(false);\n        return;\n      }\n      try {\n        const res = await fetch('/api/auth/signup', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({ username, email, password, name }),\n        });\n\n        const data = await res.json();\n        setLoading(false);\n\n        if (!res.ok) {\n          setError(data.error || 'Signup failed');\n        } else {\n          // Auto-login after signup - use username\n          const result = await signIn('credentials', {\n            username,\n            password,\n            redirect: false,\n          });\n\n          if (result?.ok) {\n            closeModal();\n            if (redirectTo) {\n              router.push(redirectTo);\n            } else {\n              router.refresh();\n            }\n          }\n        }\n      } catch (err) {\n        setLoading(false);\n        setError('Something went wrong');\n      }\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 z-[9999] flex items-center justify-center\">\n      {/* Backdrop */}\n      <div \n        className=\"absolute inset-0 bg-black/60 backdrop-blur-sm\"\n        onClick={closeModal}\n      />\n      \n      {/* Modal */}\n      <div className=\"relative bg-slate-800 rounded-2xl p-8 max-w-md w-full mx-4 shadow-2xl border border-slate-700\">\n        {/* Close button */}\n        <button\n          onClick={closeModal}\n          className=\"absolute top-4 right-4 text-slate-400 hover:text-white text-xl\"\n        >\n          âœ•\n        </button>\n\n        {/* Header */}\n        <div className=\"text-center mb-6\">\n          <h2 className=\"text-2xl font-bold text-white\">\n            {mode === 'login' ? 'Welcome Back' : 'Create Account'}\n          </h2>\n          <p className=\"text-slate-400 mt-1\">\n            {mode === 'login' ? 'Sign in to your account' : 'Start using AviationHub for free'}\n          </p>\n        </div>\n\n        {/* Toggle between login/signup */}\n        <div className=\"flex bg-slate-700 rounded-lg p-1 mb-6\">\n          <button\n            type=\"button\"\n            onClick={() => setMode('login')}\n            className={`flex-1 py-2 px-4 rounded-md text-sm font-medium transition ${\n              mode === 'login' \n                ? 'bg-slate-600 text-white' \n                : 'text-slate-400 hover:text-white'\n            }`}\n          >\n            Sign In\n          </button>\n          <button\n            type=\"button\"\n            onClick={() => setMode('signup')}\n            className={`flex-1 py-2 px-4 rounded-md text-sm font-medium transition ${\n              mode === 'signup' \n                ? 'bg-slate-600 text-white' \n                : 'text-slate-400 hover:text-white'\n            }`}\n          >\n            Sign Up\n          </button>\n        </div>\n\n        {/* Error */}\n        {error && (\n          <div className=\"mb-4 p-3 rounded-lg bg-red-500/10 border border-red-500/30 text-red-400 text-sm\">\n            {error}\n          </div>\n        )}\n\n        {/* Form */}\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\n          {mode === 'signup' && (\n            <div>\n              <label className=\"block text-sm font-medium text-slate-300 mb-1\">Name</label>\n              <input\n                type=\"text\"\n                value={name}\n                onChange={(e) => setName(e.target.value)}\n                className=\"w-full rounded-xl border border-slate-600 bg-slate-700 px-4 py-3 text-white placeholder-slate-500 focus:border-emerald-500 focus:outline-none\"\n                placeholder=\"Your name\"\n                required={mode === 'signup'}\n              />\n            </div>\n          )}\n\n          {mode === 'signup' && (\n            <div>\n              <label className=\"block text-sm font-medium text-slate-300 mb-1\">Username</label>\n              <input\n                type=\"text\"\n                value={username}\n                onChange={(e) => setUsername(e.target.value.toLowerCase().replace(/[^a-z0-9]/g, ''))}\n                className=\"w-full rounded-xl border border-slate-600 bg-slate-700 px-4 py-3 text-white placeholder-slate-500 focus:border-emerald-500 focus:outline-none\"\n                placeholder=\"johndoe123\"\n                required={mode === 'signup'}\n              />\n            </div>\n          )}\n\n          {mode === 'signup' && (\n            <div>\n              <label className=\"block text-sm font-medium text-slate-300 mb-1\">Email</label>\n              <input\n                type=\"email\"\n                value={email}\n                onChange={(e) => setEmail(e.target.value)}\n                className=\"w-full rounded-xl border border-slate-600 bg-slate-700 px-4 py-3 text-white placeholder-slate-500 focus:border-emerald-500 focus:outline-none\"\n                placeholder=\"you@example.com\"\n                required\n              />\n            </div>\n          )}\n\n          {mode === 'login' && (\n            <div>\n              <label className=\"block text-sm font-medium text-slate-300 mb-1\">Username</label>\n              <input\n                type=\"text\"\n                value={username}\n                onChange={(e) => setUsername(e.target.value)}\n                className=\"w-full rounded-xl border border-slate-600 bg-slate-700 px-4 py-3 text-white placeholder-slate-500 focus:border-emerald-500 focus:outline-none\"\n                placeholder=\"your username\"\n                required\n              />\n            </div>\n          )}\n\n          <div>\n            <label className=\"block text-sm font-medium text-slate-300 mb-1\">\n              {mode === 'login' ? 'Password' : 'Create Password'}\n            </label>\n            <input\n              type=\"password\"\n              value={password}\n              onChange={(e) => setPassword(e.target.value)}\n              className=\"w-full rounded-xl border border-slate-600 bg-slate-700 px-4 py-3 text-white placeholder-slate-500 focus:border-emerald-500 focus:outline-none\"\n              placeholder=\"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢\"\n              required\n              minLength={6}\n            />\n          </div>\n\n          {mode === 'login' && (\n            <div className=\"flex justify-end\">\n              <Link \n                href=\"/forgot-password\" \n                onClick={closeModal}\n                className=\"text-sm text-emerald-400 hover:text-emerald-300\"\n              >\n                Forgot password?\n              </Link>\n            </div>\n          )}\n\n          <button\n            type=\"submit\"\n            disabled={loading}\n            className=\"w-full rounded-xl bg-emerald-500 py-3 font-semibold text-white transition-all hover:bg-emerald-400 disabled:opacity-50\"\n          >\n            {loading \n              ? (mode === 'login' ? 'Signing in...' : 'Creating account...') \n              : (mode === 'login' ? 'Sign In' : 'Create Account')\n            }\n          </button>\n        </form>\n\n        {/* Divider */}\n        <div className=\"relative my-6\">\n          <div className=\"absolute inset-0 flex items-center\">\n            <div className=\"w-full border-t border-slate-700\"></div>\n          </div>\n          <div className=\"relative flex justify-center text-sm\">\n            <span className=\"px-2 bg-slate-800 text-slate-500\">or</span>\n          </div>\n        </div>\n\n        {/* Continue as guest */}\n        <button\n          onClick={closeModal}\n          className=\"w-full rounded-xl border border-slate-600 py-3 font-medium text-slate-300 transition-all hover:bg-slate-700\"\n        >\n          Continue as Guest\n        </button>\n\n        {/* Footer note */}\n        <p className=\"text-center text-xs text-slate-500 mt-4\">\n          By continuing, you agree to our{' '}\n          <Link href=\"/terms\" className=\"text-slate-300 hover:text-white underline underline-offset-2\">\n            Terms of Service\n          </Link>{' '}\n          and{' '}\n          <Link href=\"/privacy\" className=\"text-slate-300 hover:text-white underline underline-offset-2\">\n            Privacy Policy\n          </Link>.\n        </p>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\components\\VerificationBanner.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'update' is assigned a value but never used.","line":11,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":32},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":40,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":40,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState } from 'react';\nimport { useSession } from 'next-auth/react';\n\ninterface VerificationBannerProps {\n  email?: string | null;\n}\n\nexport default function VerificationBanner({ email: propEmail }: VerificationBannerProps) {\n  const { data: session, update } = useSession();\n  const [isSending, setIsSending] = useState(false);\n  const [sent, setSent] = useState(false);\n  const [error, setError] = useState('');\n\n  // Get email from session or props\n  const email = session?.user?.email || propEmail;\n\n  // Don't show if already verified or no email\n  if (session?.user?.emailVerified || !email) {\n    return null;\n  }\n\n  const handleResend = async () => {\n    setIsSending(true);\n    setError('');\n\n    try {\n      const res = await fetch('/api/auth/resend-verification', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ email }),\n      });\n\n      if (res.ok) {\n        setSent(true);\n      } else {\n        setError('Failed to send email. Please try again.');\n      }\n    } catch (err) {\n      setError('Something went wrong. Please try again.');\n    } finally {\n      setIsSending(false);\n    }\n  };\n\n  if (sent) {\n    return (\n      <div className=\"mb-4 rounded-xl border border-emerald-500/30 bg-emerald-500/10 p-4\">\n        <div className=\"flex items-center gap-3\">\n          <span className=\"text-2xl\">âœ…</span>\n          <div>\n            <p className=\"font-medium text-emerald-400\">Verification email sent!</p>\n            <p className=\"text-sm text-emerald-300/80\">\n              Check your inbox for the verification link.\n            </p>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"mb-4 rounded-xl border border-amber-500/30 bg-amber-500/10 p-4\">\n      <div className=\"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between\">\n        <div className=\"flex items-start gap-3\">\n          <span className=\"text-2xl\">ðŸ“§</span>\n          <div>\n            <p className=\"font-medium text-amber-400\">Please verify your email</p>\n            <p className=\"text-sm text-amber-200/80\">\n              You need to verify your email before you can save flight plans or training progress.\n            </p>\n          </div>\n        </div>\n        \n        <div className=\"flex flex-col items-start gap-2 sm:items-end\">\n          <button\n            onClick={handleResend}\n            disabled={isSending}\n            className=\"rounded-lg bg-amber-500/20 px-4 py-2 text-sm font-medium text-amber-400 transition hover:bg-amber-500/30 disabled:opacity-50\"\n          >\n            {isSending ? 'Sending...' : 'Resend Verification Email'}\n          </button>\n          \n          <a\n            href=\"https://mail.google.com\"\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n            className=\"text-xs text-amber-300/60 hover:text-amber-300\"\n          >\n            Open Gmail â†’\n          </a>\n        </div>\n      </div>\n      \n      {error && (\n        <p className=\"mt-3 text-sm text-red-400\">{error}</p>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\components\\app-switcher.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\components\\chat-widget.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":113,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":113,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3663,3666],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3663,3666],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'outgoingRequests' is assigned a value but never used.","line":114,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":114,"endColumn":26},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":114,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3735,3738],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3735,3738],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadConversations'. Either include it or remove the dependency array.","line":161,"column":6,"nodeType":"ArrayExpression","endLine":161,"endColumn":15,"suggestions":[{"desc":"Update the dependencies array to be: [loadConversations, session]","fix":{"range":[5576,5585],"text":"[loadConversations, session]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadConversations'. Either include it or remove the dependency array.","line":190,"column":6,"nodeType":"ArrayExpression","endLine":190,"endColumn":28,"suggestions":[{"desc":"Update the dependencies array to be: [activeConversationId, loadConversations]","fix":{"range":[6508,6530],"text":"[activeConversationId, loadConversations]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":345,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":345,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11849,11852],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11849,11852],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":345,"column":91,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":345,"endColumn":94,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11875,11878],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11875,11878],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":402,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":402,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13754,13757],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13754,13757],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":402,"column":95,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":402,"endColumn":98,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13780,13783],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13780,13783],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":553,"column":35,"nodeType":"JSXOpeningElement","endLine":557,"endColumn":37,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":615,"column":37,"nodeType":"JSXOpeningElement","endLine":619,"endColumn":39,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":6,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport Link from 'next/link';\nimport { useEffect, useMemo, useState } from 'react';\nimport { useSession } from 'next-auth/react';\nimport { getPusherClient } from '@/lib/pusher-client';\nimport { checkMessageSafety } from '@/lib/message-safety';\nimport { MessageSquare, X } from 'lucide-react';\n\r\ntype ConversationItem = {\r\n  id: string;\r\n  updatedAt: string;\r\n  listingId?: string | null;\r\n  listing?: { id: string; title: string; airportIcao: string } | null;\r\n  participants: { user: { id: string; name?: string | null; username?: string | null } }[];\r\n  messages: { id: string; body: string; createdAt: string; senderId: string }[];\r\n};\r\n\r\ntype MessageItem = {\r\n  id: string;\r\n  body: string;\r\n  createdAt: string;\r\n  senderId: string;\r\n  sender: { id: string; name?: string | null; username?: string | null };\r\n};\r\n\r\ntype InviteItem = {\r\n  id: string;\r\n  role: string;\r\n  createdAt: string;\r\n  group: { id: string; name: string; description?: string | null };\r\n};\r\n\r\ntype PilotProfile = {\r\n  id: string;\r\n  userId: string;\r\n  homeAirport?: string | null;\r\n  user?: { id: string; name?: string | null; username?: string | null; image?: string | null; age?: number | null } | null;\r\n};\r\n\r\ntype AirportDetails = {\r\n  icao?: string;\r\n  name?: string;\r\n  city?: string;\r\n  state?: string;\r\n};\r\n\r\ntype UserMeta = {\r\n  id: string;\r\n  displayName: string;\r\n  username?: string | null;\r\n  image?: string | null;\r\n  age?: number | null;\r\n  homeAirport?: string | null;\r\n  isOnline?: boolean;\r\n  lastSeenAt?: string | null;\r\n};\r\n\r\ntype FriendWithStatus = {\r\n  id: string;\r\n  name: string | null;\r\n  username: string | null;\r\n  image: string | null;\r\n  homeAirport: string | null;\r\n  isOnline: boolean;\r\n  lastSeenAt: string | null;\r\n};\r\n\r\nfunction initials(name?: string | null) {\r\n  const raw = (name || '').trim();\r\n  if (!raw) return '?';\r\n  const parts = raw.split(/\\s+/).filter(Boolean);\r\n  const first = parts[0]?.[0] || '?';\r\n  const last = parts.length > 1 ? parts[parts.length - 1]?.[0] : '';\r\n  return (first + last).toUpperCase();\r\n}\r\n\r\nfunction buildProfileHref(userId: string, username?: string | null) {\r\n  return `/pilots/${encodeURIComponent(username || userId)}`;\r\n}\r\n\r\nfunction formatLocation(homeAirport?: string | null, airport?: AirportDetails | null) {\r\n  const icao = (homeAirport || '').toString().trim().toUpperCase();\r\n  if (!icao) return 'No home airport';\r\n  if (!airport) return icao;\r\n  const place = [airport.city, airport.state].filter(Boolean).join(', ');\r\n  const name = airport.name ? `${airport.name}` : 'Airport';\r\n  return `${airport.state || 'â€”'} â€¢ ${name}${place ? ` (${place})` : ''} â€¢ ${icao}`;\r\n}\r\n\r\nfunction formatLastSeen(dateStr: string) {\r\n  const date = new Date(dateStr);\r\n  const now = new Date();\r\n  const diffMs = now.getTime() - date.getTime();\r\n  const diffMins = Math.floor(diffMs / 60000);\r\n  const diffHours = Math.floor(diffMins / 60);\r\n  const diffDays = Math.floor(diffHours / 24);\r\n\r\n  if (diffMins < 1) return 'just now';\r\n  if (diffMins < 60) return `${diffMins}m ago`;\r\n  if (diffHours < 24) return `${diffHours}h ago`;\r\n  if (diffDays < 7) return `${diffDays}d ago`;\r\n  return date.toLocaleDateString();\r\n}\r\n\r\nexport default function ChatWidget() {\r\n  const { data: session } = useSession();\r\n  const [open, setOpen] = useState(false);\r\n  const [view, setView] = useState<'list' | 'chat'>('list');\r\n  const [conversations, setConversations] = useState<ConversationItem[]>([]);\r\n  const [messages, setMessages] = useState<MessageItem[]>([]);\r\n  const [activeConversationId, setActiveConversationId] = useState<string | null>(null);\r\n  const [incomingRequests, setIncomingRequests] = useState<any[]>([]);\r\n  const [outgoingRequests, setOutgoingRequests] = useState<any[]>([]);\r\n  const [pendingInvites, setPendingInvites] = useState<InviteItem[]>([]);\r\n  const [messageInput, setMessageInput] = useState('');\n  const [userMeta, setUserMeta] = useState<Record<string, UserMeta>>({});\n  const [airportCache, setAirportCache] = useState<Record<string, AirportDetails>>({});\n  const [friends, setFriends] = useState<FriendWithStatus[]>([]);\n\n  const currentUserId = session?.user?.id;\n\r\n  const activeConversation = useMemo(\r\n    () => conversations.find((conversation) => conversation.id === activeConversationId) || null,\r\n    [conversations, activeConversationId]\r\n  );\r\n\r\n  const otherParticipant = useMemo(() => {\r\n    if (!activeConversation || !currentUserId) return null;\r\n    const participant = activeConversation.participants.find((p) => p.user.id !== currentUserId);\r\n    return participant?.user || null;\r\n  }, [activeConversation, currentUserId]);\r\n\r\n  useEffect(() => {\r\n    if (!session?.user?.id) return;\r\n    \r\n    // Check for newConversation query param to open a specific conversation\r\n    const urlParams = new URLSearchParams(window.location.search);\r\n    const newConversationId = urlParams.get('newConversation');\n    \n    loadConversations().then(() => {\n      // If there's a newConversation param, open that conversation\r\n      if (newConversationId) {\r\n        openConversation(newConversationId);\r\n        // Clean up the URL\r\n        window.history.replaceState({}, '', window.location.pathname);\r\n      }\r\n    });\r\n    loadRequests();\r\n    loadInvites();\r\n    loadFriends();\r\n\r\n    // Heartbeat every 30 seconds to maintain online presence\r\n    const heartbeat = () => {\r\n      fetch('/api/presence/heartbeat', { method: 'POST' }).catch(() => {});\r\n    };\r\n    heartbeat();\r\n    const interval = setInterval(heartbeat, 30000);\r\n\r\n    return () => clearInterval(interval);\r\n  }, [session]);\r\n\r\n  useEffect(() => {\r\n    const handler = (event: Event) => {\r\n      const detail = (event as CustomEvent).detail || {};\r\n      if (detail?.conversationId) {\r\n        setOpen(true);\r\n        openConversation(detail.conversationId);\r\n      }\r\n    };\r\n    window.addEventListener('open-chat', handler as EventListener);\r\n    return () => window.removeEventListener('open-chat', handler as EventListener);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!activeConversationId) return;\r\n    const client = getPusherClient();\r\n    if (!client) return;\r\n\r\n    const channel = client.subscribe(`conversation-${activeConversationId}`);\r\n    channel.bind('new-message', (data: { message: MessageItem }) => {\r\n      setMessages((prev) => [...prev, data.message]);\r\n      loadConversations();\r\n    });\r\n\r\n    return () => {\r\n      channel.unbind_all();\r\n      client.unsubscribe(`conversation-${activeConversationId}`);\r\n    };\r\n  }, [activeConversationId]);\r\n\r\n  async function loadConversations() {\r\n    try {\r\n      const res = await fetch('/api/conversations');\r\n      const data = await res.json();\r\n      const nextConversations: ConversationItem[] = data.conversations || [];\r\n      setConversations(nextConversations);\r\n      hydrateConversationMeta(nextConversations);\r\n    } catch (error) {\r\n      console.error('Failed to load conversations', error);\r\n    }\r\n  }\r\n\r\n  async function hydrateConversationMeta(nextConversations: ConversationItem[]) {\r\n    try {\r\n      const otherUsers = nextConversations\r\n        .map((c) => c.participants.map((p) => p.user))\r\n        .flat()\r\n        .filter((u) => u.id !== currentUserId);\r\n\r\n      const missingIds = Array.from(new Set(otherUsers.map((u) => u.id))).filter((id) => !userMeta[id]);\r\n      if (missingIds.length === 0) return;\r\n\r\n      const pilotsRes = await fetch('/api/pilots');\r\n      const pilotsData = await pilotsRes.json();\r\n      const profiles: PilotProfile[] = pilotsData.profiles || [];\r\n\r\n      const profileByUserId = new Map<string, PilotProfile>();\r\n      for (const p of profiles) {\r\n        const id = p.user?.id || p.userId;\r\n        if (id) profileByUserId.set(id, p);\r\n      }\r\n\r\n      const nextMeta: Record<string, UserMeta> = {};\r\n      const neededIcaos = new Set<string>();\r\n\r\n      for (const id of missingIds) {\r\n        const fallback = otherUsers.find((u) => u.id === id);\r\n        const profile = profileByUserId.get(id);\r\n        const displayName =\r\n          profile?.user?.name || profile?.user?.username || fallback?.name || fallback?.username || 'Pilot';\r\n        const homeAirport = profile?.homeAirport || null;\r\n        if (homeAirport) neededIcaos.add(homeAirport.toString().trim().toUpperCase());\r\n\r\n        nextMeta[id] = {\r\n          id,\r\n          displayName,\r\n          username: profile?.user?.username || fallback?.username || null,\r\n          image: profile?.user?.image || null,\r\n          age: typeof profile?.user?.age === 'number' ? profile.user.age : null,\r\n          homeAirport,\r\n        };\r\n      }\r\n\r\n      if (Object.keys(nextMeta).length) {\r\n        setUserMeta((prev) => ({ ...prev, ...nextMeta }));\r\n      }\r\n\r\n      const missingIcaos = Array.from(neededIcaos).filter((icao) => icao && !airportCache[icao]);\r\n      if (missingIcaos.length) {\r\n        const entries = await Promise.all(\r\n          missingIcaos.map(async (icao) => {\r\n            try {\r\n              const res = await fetch(`/api/airports/${encodeURIComponent(icao)}`);\r\n              if (!res.ok) return null;\r\n              const data = await res.json();\r\n              const details: AirportDetails = {\r\n                icao: data.icao || icao,\r\n                name: data.name,\r\n                city: data.city,\r\n                state: data.state,\r\n              };\r\n              return [icao, details] as const;\r\n            } catch {\r\n              return null;\r\n            }\r\n          }),\r\n        );\r\n\r\n        const nextAirports: Record<string, AirportDetails> = {};\r\n        for (const entry of entries) {\r\n          if (!entry) continue;\r\n          nextAirports[entry[0]] = entry[1];\r\n        }\r\n        if (Object.keys(nextAirports).length) {\r\n          setAirportCache((prev) => ({ ...prev, ...nextAirports }));\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to load participant metadata', error);\r\n    }\r\n  }\r\n\r\n  async function loadRequests() {\r\n    try {\r\n      const res = await fetch('/api/friends/requests');\r\n      const data = await res.json();\r\n      setIncomingRequests(data.incoming || []);\r\n      setOutgoingRequests(data.outgoing || []);\r\n    } catch (error) {\r\n      console.error('Failed to load requests', error);\r\n    }\r\n  }\r\n\r\n  async function loadInvites() {\r\n    try {\r\n      const res = await fetch('/api/invitations');\r\n      if (!res.ok) {\r\n        setPendingInvites([]);\r\n        return;\r\n      }\r\n      const data = await res.json();\r\n      setPendingInvites(Array.isArray(data) ? (data as InviteItem[]) : []);\r\n    } catch (error) {\r\n      console.error('Failed to load invites', error);\r\n      setPendingInvites([]);\r\n    }\r\n  }\r\n\r\n  async function loadFriends() {\r\n    try {\r\n      const res = await fetch('/api/friends/with-status');\r\n      const data = await res.json();\r\n      setFriends(data.friends || []);\r\n    } catch (error) {\r\n      console.error('Failed to load friends', error);\r\n      setFriends([]);\r\n    }\r\n  }\r\n\r\n  async function acceptInvite(inviteId: string) {\r\n    try {\r\n      const res = await fetch('/api/invitations', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ inviteId }),\r\n      });\r\n      const data = await res.json();\r\n      if (!res.ok) {\r\n        throw new Error(data.error || 'Failed to accept invitation');\r\n      }\r\n      setPendingInvites((prev) => prev.filter((i) => i.id !== inviteId));\r\n    } catch (error) {\r\n      console.error(error);\r\n    }\r\n  }\r\n\r\n  async function openConversation(conversationId: string) {\n    setActiveConversationId(conversationId);\n    setView('chat');\n    try {\n      const res = await fetch(`/api/conversations/${conversationId}/messages`);\n      const data = await res.json();\n      // Deduplicate by message ID\n      const uniqueMessages = (data.messages || []).filter((msg: any, index: number, self: any[]) => \n        index === self.findIndex((m) => m.id === msg.id)\n      );\n      setMessages(uniqueMessages);\n    } catch (error) {\n      console.error('Failed to load messages', error);\n    }\n  }\n\r\n  async function startConversation(userId: string) {\r\n    try {\r\n      const res = await fetch('/api/conversations', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ userId }),\r\n      });\r\n      const data = await res.json();\r\n      if (!res.ok) {\r\n        console.error('Failed to start conversation:', data.error);\r\n        return;\r\n      }\r\n      await loadConversations();\r\n      if (data.conversationId) {\r\n        await openConversation(data.conversationId);\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to start conversation', error);\r\n    }\r\n  }\r\n\r\n  async function sendMessage() {\n    if (!activeConversationId || !messageInput.trim()) return;\n    try {\n      const rawText = messageInput.trim();\n      if (!rawText) return;\n\n      const safety = checkMessageSafety(rawText);\n      if (!safety.ok) {\n        alert(safety.error);\n        return;\n      }\n\n      // Send plain text - server will encrypt it\n      const res = await fetch(`/api/conversations/${activeConversationId}/messages`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ body: rawText }),\n      });\n      const data = await res.json();\n      if (!res.ok) {\n        throw new Error(data.error || 'Failed to send message');\n      }\n      setMessageInput('');\n      // Refresh messages from server to avoid duplicates\n      const msgsRes = await fetch(`/api/conversations/${activeConversationId}/messages`);\n      const msgsData = await msgsRes.json();\n      // Deduplicate by message ID\n      const uniqueMessages = (msgsData.messages || []).filter((msg: any, index: number, self: any[]) => \n        index === self.findIndex((m) => m.id === msg.id)\n      );\n      setMessages(uniqueMessages);\n      loadConversations();\n    } catch (error) {\n      console.error(error);\n    }\n  }\n\n  async function respondToRequest(requestId: string, action: 'accept' | 'decline') {\n    try {\r\n      const res = await fetch(`/api/friends/requests/${requestId}`, {\r\n        method: 'PATCH',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ action, seedInitialMessage: action === 'accept' }),\r\n      });\r\n      const data = await res.json();\r\n      if (!res.ok) {\r\n        throw new Error(data.error || 'Failed to update request');\r\n      }\r\n      await loadRequests();\r\n      await loadConversations();\r\n\r\n      if (action === 'accept' && data?.conversationId) {\r\n        await openConversation(data.conversationId);\r\n      }\r\n    } catch (error) {\r\n      console.error(error);\r\n    }\r\n  }\r\n\r\n  if (!session?.user?.id) return null;\r\n\r\n  return (\n    <div className=\"fixed bottom-6 right-6 z-50\">\n      <button\n        onClick={() => setOpen((prev) => !prev)}\n        className=\"relative w-14 h-14 rounded-full bg-primary text-primary-foreground shadow-lg shadow-primary/25 flex items-center justify-center transition-all duration-300 hover:scale-105 hover:shadow-xl\"\n      >\n        {open ? <X className=\"w-5 h-5\" /> : <MessageSquare className=\"w-5 h-5\" />}\n      </button>\n\n      {open && (\n        <div className=\"mt-3 w-[320px] max-h-[70vh] bg-slate-900 border border-slate-700 rounded-2xl shadow-xl flex flex-col overflow-hidden\">\n          <div className=\"flex items-center justify-between px-4 py-3 border-b border-slate-700\">\n            <div className=\"flex items-center gap-2\">\n              <div className=\"text-white font-semibold\">Messages</div>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              {view === 'chat' && (\n                <button\n                  onClick={() => setView('list')}\n                  className=\"text-xs text-slate-400 hover:text-white\"\n                >\n                  Back\n                </button>\n              )}\n              <a\n                href=\"/messages\"\n                className=\"text-xs text-primary hover:underline\"\n              >\n                Expand\n              </a>\n            </div>\n          </div>\n\r\n          {view === 'list' && (\r\n            <div className=\"flex-1 overflow-y-auto\">\r\n              {pendingInvites.length > 0 && (\r\n                <div className=\"p-3 border-b border-slate-800\">\r\n                  <div className=\"text-xs uppercase text-slate-500 mb-2\">Invitations</div>\r\n                  <div className=\"space-y-2\">\r\n                    {pendingInvites.map((invite) => (\r\n                      <div key={invite.id} className=\"bg-slate-800 rounded-lg p-2\">\r\n                        <div className=\"text-sm text-white\">{invite.group?.name || 'Flying club'}</div>\r\n                        <div className=\"text-[11px] text-slate-400 mt-0.5\">\r\n                          Role: {invite.role}\r\n                        </div>\r\n                        <div className=\"flex gap-2 mt-2\">\r\n                          <button\r\n                            onClick={() => acceptInvite(invite.id)}\r\n                            className=\"flex-1 text-xs bg-emerald-500/20 border border-emerald-400 text-emerald-200 rounded-full py-1\"\r\n                          >\r\n                            Accept\r\n                          </button>\r\n                          <Link\n                            href=\"/modules/flying-club\"\n                            className=\"flex-1 text-center text-xs bg-slate-700 text-slate-300 rounded-full py-1\"\n                          >\n                            View\n                          </Link>\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              {incomingRequests.length > 0 && (\r\n                <div className=\"p-3 border-b border-slate-800\">\r\n                  <div className=\"text-xs uppercase text-slate-500 mb-2\">Requests</div>\r\n                  <div className=\"space-y-2\">\r\n                    {incomingRequests.map((req) => (\r\n                      <div key={req.id} className=\"bg-slate-800 rounded-lg p-2\">\r\n                        <div className=\"flex items-center justify-between gap-2\">\r\n                          <Link\r\n                            href={buildProfileHref(req.requester?.id, req.requester?.username)}\r\n                            className=\"text-sm text-white hover:underline\"\r\n                          >\r\n                            {req.requester?.name || req.requester?.username || 'Pilot'}\r\n                          </Link>\r\n                        </div>\r\n                        <div className=\"flex gap-2 mt-2\">\r\n                          <button\r\n                            onClick={() => respondToRequest(req.id, 'accept')}\r\n                            className=\"flex-1 text-xs bg-emerald-500/20 border border-emerald-400 text-emerald-200 rounded-full py-1\"\r\n                          >\r\n                            Accept\r\n                          </button>\r\n                          <button\r\n                            onClick={() => respondToRequest(req.id, 'decline')}\r\n                            className=\"flex-1 text-xs bg-slate-700 text-slate-300 rounded-full py-1\"\r\n                          >\r\n                            Decline\r\n                          </button>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              <div className=\"p-3\">\r\n                {friends.length > 0 && (\r\n                  <>\r\n                    <div className=\"text-xs uppercase text-slate-500 mb-2\">Friends</div>\r\n                    <div className=\"space-y-2 mb-4\">\r\n                      {friends.map((friend) => {\r\n                        const homeAirport = friend.homeAirport || null;\r\n                        const airport = homeAirport ? airportCache[homeAirport.toString().trim().toUpperCase()] : null;\r\n                        return (\r\n                          <button\r\n                            key={friend.id}\r\n                            onClick={() => startConversation(friend.id)}\r\n                            className=\"w-full text-left bg-slate-800 rounded-lg p-2 hover:bg-slate-700\"\r\n                          >\r\n                            <div className=\"flex items-center gap-2 min-w-0\">\r\n                              <div className=\"relative flex-shrink-0\">\r\n                                {friend.image ? (\r\n                                  // eslint-disable-next-line @next/next/no-img-element\r\n                                  <img\r\n                                    src={friend.image}\r\n                                    alt=\"\"\r\n                                    className=\"h-8 w-8 rounded-full border border-slate-700 object-cover\"\r\n                                  />\r\n                                ) : (\r\n                                  <div className=\"h-8 w-8 rounded-full bg-slate-700/70 border border-slate-600 flex items-center justify-center text-white text-xs font-semibold\">\r\n                                    {initials(friend.name || friend.username)}\r\n                                  </div>\r\n                                )}\r\n                                <div className={`absolute -bottom-0.5 -right-0.5 h-3 w-3 rounded-full border-2 border-slate-900 ${friend.isOnline ? 'bg-emerald-400' : 'bg-slate-500'}`} />\r\n                              </div>\r\n                              <div className=\"min-w-0\">\r\n                                <div className=\"text-sm text-white truncate\">\r\n                                  {friend.isOnline && <span className=\"text-emerald-400 mr-1\">â—</span>}\r\n                                  {friend.name || friend.username || 'Pilot'}\r\n                                </div>\r\n                                <div className=\"text-[11px] text-slate-400 truncate\">\r\n                                  {friend.isOnline ? 'Online' : friend.lastSeenAt ? `Last seen ${formatLastSeen(friend.lastSeenAt)}` : formatLocation(homeAirport, airport || null)}\r\n                                </div>\r\n                              </div>\r\n                            </div>\r\n                          </button>\r\n                        );\r\n                      })}\r\n                    </div>\r\n                  </>\r\n                )}\r\n\r\n                <div className=\"text-xs uppercase text-slate-500 mb-2\">Chats</div>\r\n                {conversations.length === 0 ? (\r\n                  <div className=\"text-sm text-slate-400\">No conversations yet.</div>\r\n                ) : (\r\n                  <div className=\"space-y-2\">\r\n                    {conversations.map((conversation) => {\r\n                      const participant = conversation.participants.find((p) => p.user.id !== currentUserId)?.user;\r\n                      const friendStatus = friends.find(f => f.id === participant?.id);\r\n                      const isOnline = friendStatus?.isOnline || false;\r\n                      const meta = participant?.id ? userMeta[participant.id] : null;\r\n                      const homeAirport = meta?.homeAirport || null;\r\n                      const airport = homeAirport ? airportCache[homeAirport.toString().trim().toUpperCase()] : null;\r\n                      const lastMessage = conversation.messages[0];\r\n                      const preview = !lastMessage\r\n                        ? 'No messages yet'\r\n                        : 'Encrypted message';\r\n                      const isMarketplace = !!conversation.listingId;\r\n                      return (\r\n                        <button\r\n                          key={conversation.id}\r\n                          onClick={() => openConversation(conversation.id)}\r\n                          className=\"w-full text-left bg-slate-800 rounded-lg p-2 hover:bg-slate-700\"\r\n                        >\r\n                          <div className=\"flex items-center justify-between gap-3\">\r\n                            <div className=\"flex items-center gap-2 min-w-0\">\r\n                              <Link\r\n                                href={buildProfileHref(participant?.id || '', meta?.username || participant?.username)}\r\n                                onClick={(e) => e.stopPropagation()}\r\n                                className=\"flex items-center gap-2 min-w-0\"\r\n                              >\r\n                                <div className=\"relative flex-shrink-0\">\r\n                                  {meta?.image ? (\r\n                                    // eslint-disable-next-line @next/next/no-img-element\r\n                                    <img\r\n                                      src={meta.image}\r\n                                      alt=\"\"\r\n                                      className=\"h-8 w-8 rounded-full border border-slate-700 object-cover flex-shrink-0\"\r\n                                    />\r\n                                  ) : (\r\n                                    <div className=\"h-8 w-8 rounded-full bg-slate-700/70 border border-slate-600 flex items-center justify-center text-white text-xs font-semibold flex-shrink-0\">\r\n                                        {initials(meta?.displayName || participant?.name || participant?.username)}\r\n                                    </div>\r\n                                  )}\r\n                                  <div className={`absolute -bottom-0.5 -right-0.5 h-3 w-3 rounded-full border-2 border-slate-900 ${isOnline ? 'bg-emerald-400' : 'bg-slate-500'}`} />\r\n                                </div>\r\n                                <div className=\"min-w-0\">\r\n                                  <div className=\"flex items-center gap-1\">\r\n                                    {isMarketplace && (\r\n                                      <span className=\"text-[10px] bg-primary/20 text-primary px-1.5 py-0.5 rounded\">Market</span>\r\n                                    )}\r\n                                    <span className=\"text-sm text-white truncate\">\r\n                                      {conversation.listing?.title || meta?.displayName || participant?.name || participant?.username || 'Pilot'}\r\n                                    </span>\r\n                                  </div>\r\n                                  <div className=\"text-[11px] text-slate-400 truncate\">\r\n                                    {isMarketplace \r\n                                      ? `Listing: ${conversation.listing?.title}`\r\n                                      : `${typeof meta?.age === 'number' ? `${meta.age} â€¢ ` : ''}${formatLocation(homeAirport, airport || null)}`\r\n                                    }\r\n                                  </div>\r\n                                </div>\r\n                              </Link>\r\n                            </div>\r\n                          </div>\r\n                          <div className=\"text-xs text-slate-400 truncate\">\r\n                            {preview}\r\n                          </div>\r\n                        </button>\r\n                      );\r\n                    })}\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {view === 'chat' && (\r\n            <div className=\"flex-1 flex flex-col\">\r\n              {/* Header with participant and optional listing info */}\r\n              <div className=\"px-4 py-2 border-b border-slate-800\">\r\n                {activeConversation?.listing && (\r\n                  <Link\r\n                    href={`/modules/marketplace/listing/${activeConversation.listing.id}`}\r\n                    className=\"flex items-center gap-2 text-xs text-primary hover:underline mb-1\"\r\n                  >\r\n                    <span className=\"bg-primary/10 px-2 py-0.5 rounded\">Listing</span>\r\n                    <span className=\"truncate\">{activeConversation.listing.title}</span>\r\n                  </Link>\r\n                )}\r\n                <div className=\"flex items-center justify-between gap-2\">\r\n                  {otherParticipant ? (\r\n                    <Link\r\n                      href={buildProfileHref(otherParticipant.id, otherParticipant.username)}\r\n                      className=\"hover:underline text-sm text-slate-300\"\r\n                    >\r\n                      {otherParticipant?.name || otherParticipant?.username || 'Conversation'}\r\n                    </Link>\r\n                  ) : (\r\n                    <span className=\"text-sm text-slate-300\">Conversation</span>\r\n                  )}\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <Link\n                      href={`/messages?newConversation=${activeConversationId}`}\n                      className=\"text-[10px] text-primary hover:underline\"\n                      target=\"_blank\"\n                    >\n                      Full Page\n                    </Link>\n                  </div>\r\n                </div>\r\n              </div>\n              <div className=\"flex-1 overflow-y-auto p-3 space-y-2\">\n                {messages.map((message) => {\n                    const msgDate = new Date(message.createdAt);\n                    const timeStr = msgDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\n                    return (\n                  <div\n                    key={message.id}\n                    className={`max-w-[80%] rounded-lg px-3 py-2 text-sm ${\n                      message.senderId === currentUserId\n                        ? 'ml-auto bg-emerald-500/20 text-emerald-100'\n                        : 'bg-slate-800 text-slate-100'\n                    }`}\n                  >\n                    <div>{message.body}</div>\n                    <div className={`text-[10px] mt-1 opacity-60 ${message.senderId === currentUserId ? 'text-right' : ''}`}>{timeStr}</div>\n                  </div>\n                );\n                  })}\n              </div>\r\n              <div className=\"border-t border-slate-800 p-2 flex gap-2\">\r\n                <input\r\n                  value={messageInput}\r\n                  onChange={(event) => setMessageInput(event.target.value)}\r\n                  placeholder=\"Type a message\"\r\n                  className=\"flex-1 bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-sm text-white\"\r\n                />\r\n                <button\r\n                  onClick={sendMessage}\r\n                  className=\"bg-emerald-500 hover:bg-emerald-400 text-white text-sm px-3 rounded-lg\"\r\n                >\r\n                  Send\r\n                </button>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\components\\client-layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\components\\conflicts-modal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useEffect' is defined but never used.","line":3,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":29,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"useEffect"},"fix":{"range":[32,43],"text":""},"desc":"Remove unused variable \"useEffect\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ConflictItem' is defined but never used.","line":5,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":27,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"ConflictItem"},"fix":{"range":[115,169],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'refresh' is assigned a value but never used.","line":14,"column":33,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":40},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":40,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1326,1329],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1326,1329],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":51,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1815,1818],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1815,1818],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":185,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":185,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7173,7176],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7173,7176],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":186,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":186,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7255,7258],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7255,7258],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect } from 'react';\nimport { useConflicts } from '@/hooks/useOfflineData';\nimport type { ConflictItem } from '@/lib/offline-db';\n\ninterface ConflictModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onResolved: () => void;\n}\n\nexport default function ConflictModal({ isOpen, onClose, onResolved }: ConflictModalProps) {\n  const { conflicts, isLoading, refresh } = useConflicts();\n  const [currentIndex, setCurrentIndex] = useState(0);\n  const [isResolving, setIsResolving] = useState(false);\n\n  const currentConflict = conflicts[currentIndex];\n\n  if (!isOpen) return null;\n\n  const handleResolve = async (resolution: 'mine' | 'server' | 'both') => {\n    if (!currentConflict?.id) return;\n    \n    setIsResolving(true);\n    \n    try {\n      const { resolveConflict: resolveInDB } = await import('@/lib/offline-db');\n      \n      if (resolution === 'server') {\n        // Just mark as resolved, server data wins\n        await resolveInDB(currentConflict.id);\n      } else if (resolution === 'mine') {\n        // Re-queue local data\n        const { queueChange } = await import('@/lib/offline-db');\n        await queueChange({\n          type: currentConflict.type,\n          action: 'create',\n          data: currentConflict.localData,\n          userId: (currentConflict.localData as any).userId || '',\n          localCreatedAt: new Date().toISOString(),\n        });\n        await resolveInDB(currentConflict.id);\n      } else if (resolution === 'both') {\n        // Create new entry with local data\n        const { queueChange } = await import('@/lib/offline-db');\n        await queueChange({\n          type: currentConflict.type,\n          action: 'create',\n          data: { ...currentConflict.localData, id: undefined },\n          userId: (currentConflict.localData as any).userId || '',\n          localCreatedAt: new Date().toISOString(),\n        });\n        await resolveInDB(currentConflict.id);\n      }\n\n      // Move to next conflict or close\n      if (currentIndex < conflicts.length - 1) {\n        setCurrentIndex(currentIndex + 1);\n      } else {\n        onResolved();\n        onClose();\n      }\n    } catch (err) {\n      console.error('Error resolving conflict:', err);\n    } finally {\n      setIsResolving(false);\n    }\n  };\n\n  const getTypeLabel = (type: string) => {\n    switch (type) {\n      case 'flight_log': return 'Flight Log';\n      case 'maintenance': return 'Maintenance';\n      case 'aircraft_status': return 'Aircraft Status';\n      case 'booking': return 'Booking';\n      default: return type;\n    }\n  };\n\n  const formatData = (data: Record<string, unknown>) => {\n    if (!data) return 'No data';\n    \n    const importantFields: string[] = [];\n    \n    if (data.date) importantFields.push(`Date: ${data.date}`);\n    if (data.tachTime) importantFields.push(`Tach: ${data.tachTime}`);\n    if (data.hobbsTime) importantFields.push(`Hobbs: ${data.hobbsTime}`);\n    if (data.nNumber) importantFields.push(`Aircraft: ${data.nNumber}`);\n    if (data.description) importantFields.push(`Description: ${data.description}`);\n    if (data.status) importantFields.push(`Status: ${data.status}`);\n    \n    return importantFields.length > 0 ? importantFields.join(', ') : JSON.stringify(data, null, 2);\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\n        <div className=\"bg-slate-800 rounded-xl p-8 text-white\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-sky-500 mx-auto\"></div>\n          <div className=\"mt-4 text-center\">Loading conflicts...</div>\n        </div>\n      </div>\n    );\n  }\n\n  if (conflicts.length === 0) {\n    return null;\n  }\n\n  return (\n    <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\n      <div className=\"bg-slate-800 rounded-xl max-w-2xl w-full max-h-[90vh] overflow-hidden border border-slate-700\">\n        {/* Header */}\n        <div className=\"p-6 border-b border-slate-700\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h2 className=\"text-xl font-bold text-white flex items-center gap-2\">\n                <span>âš ï¸</span>\n                Sync Conflict\n              </h2>\n              <p className=\"text-slate-400 text-sm mt-1\">\n                Conflict {currentIndex + 1} of {conflicts.length}\n              </p>\n            </div>\n            <button\n              onClick={onClose}\n              className=\"p-2 hover:bg-slate-700 rounded-lg transition-colors\"\n            >\n              <span className=\"text-2xl text-slate-400\">&times;</span>\n            </button>\n          </div>\n        </div>\n\n        {/* Content */}\n        <div className=\"p-6 overflow-y-auto max-h-[60vh]\">\n          {currentConflict && (\n            <>\n              <div className=\"mb-6\">\n                <div className=\"text-sm text-slate-400 uppercase tracking-wide mb-2\">\n                  Type\n                </div>\n                <div className=\"text-white font-medium\">\n                  {getTypeLabel(currentConflict.type)}\n                  {currentConflict.conflictType === 'deleted' && (\n                    <span className=\"ml-2 text-xs px-2 py-1 bg-red-500/20 text-red-400 rounded\">\n                      Deleted on server\n                    </span>\n                  )}\n                </div>\n              </div>\n\n              <div className=\"grid md:grid-cols-2 gap-6\">\n                {/* Your Entry */}\n                <div className=\"bg-sky-900/30 rounded-lg p-4 border border-sky-700/50\">\n                  <div className=\"flex items-center gap-2 mb-3\">\n                    <span className=\"text-xl\">ðŸ“±</span>\n                    <h3 className=\"font-semibold text-sky-400\">Your Entry (Offline)</h3>\n                  </div>\n                  <div className=\"text-sm text-slate-300 whitespace-pre-wrap\">\n                    {formatData(currentConflict.localData)}\n                  </div>\n                  <div className=\"text-xs text-slate-500 mt-2\">\n                    Created: {new Date(currentConflict.detectedAt).toLocaleString()}\n                  </div>\n                </div>\n\n                {/* Server Version */}\n                <div className=\"bg-slate-700/30 rounded-lg p-4 border border-slate-600/50\">\n                  <div className=\"flex items-center gap-2 mb-3\">\n                    <span className=\"text-xl\">â˜ï¸</span>\n                    <h3 className=\"font-semibold text-slate-300\">Server Version</h3>\n                  </div>\n                  {currentConflict.conflictType === 'deleted' ? (\n                    <div className=\"text-sm text-red-400\">\n                      This record was deleted from the server.\n                    </div>\n                  ) : (\n                    <div className=\"text-sm text-slate-300 whitespace-pre-wrap\">\n                      {formatData(currentConflict.serverData)}\n                    </div>\n                  )}\n                  {currentConflict.serverData && (\n                    <div className=\"text-xs text-slate-500 mt-2\">\n                      Last modified: {((currentConflict.serverData as any).updatedAt \n                        ? new Date((currentConflict.serverData as any).updatedAt).toLocaleString() \n                        : 'Unknown')}\n                    </div>\n                  )}\n                </div>\n              </div>\n            </>\n          )}\n        </div>\n\n        {/* Actions */}\n        <div className=\"p-6 border-t border-slate-700 bg-slate-800/50\">\n          <div className=\"flex flex-col sm:flex-row gap-3\">\n            <button\n              onClick={() => handleResolve('mine')}\n              disabled={isResolving}\n              className=\"flex-1 px-4 py-3 bg-sky-500 hover:bg-sky-400 disabled:opacity-50 rounded-lg font-medium transition-colors\"\n            >\n              Keep Mine\n            </button>\n            <button\n              onClick={() => handleResolve('server')}\n              disabled={isResolving}\n              className=\"flex-1 px-4 py-3 bg-slate-600 hover:bg-slate-500 disabled:opacity-50 rounded-lg font-medium transition-colors\"\n            >\n              Keep Server\n            </button>\n            <button\n              onClick={() => handleResolve('both')}\n              disabled={isResolving}\n              className=\"flex-1 px-4 py-3 bg-amber-600 hover:bg-amber-500 disabled:opacity-50 rounded-lg font-medium transition-colors\"\n            >\n              Keep Both\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\components\\global-header.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\components\\landing-page-client.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\components\\module-nav.tsx","messages":[{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"usePathname\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":16,"column":20,"nodeType":"Identifier","endLine":16,"endColumn":31}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport Link from \"next/link\";\nimport { usePathname } from \"next/navigation\";\nimport { AppModule } from \"@/lib/modules\";\n\ninterface ModuleNavProps {\n  module: AppModule;\n}\n\nexport function ModuleNav({ module }: ModuleNavProps) {\n  if (!module.menu || module.menu.length === 0) {\n    return null;\n  }\n\n  const pathname = usePathname();\n\n  return (\n    <div className=\"sticky top-16 z-40 mt-16 border-b border-border bg-background/80 backdrop-blur-xl\">\n      <div className=\"mx-auto flex max-w-7xl items-center gap-2 px-4 py-3 lg:px-8\">\n        <div className=\"flex items-center gap-2 text-sm font-medium text-muted-foreground\">\n          <span className=\"text-muted-foreground/70\">{module.icon}</span>\n          <span>{module.name}</span>\n        </div>\n        <span className=\"h-4 w-px bg-border/60\" aria-hidden=\"true\" />\n        <nav className=\"flex items-center gap-1 overflow-x-auto\">\n          {module.menu.map((item) => {\n            const isActive = pathname === item.href;\n            return (\n              <Link\n                key={item.href}\n                href={item.href}\n                className={`rounded-lg px-3.5 py-1.5 text-sm font-medium transition-colors ${\n                  isActive\n                    ? 'bg-primary text-primary-foreground shadow-sm'\n                    : 'text-muted-foreground hover:text-foreground hover:bg-secondary'\n                }`}\n              >\n                {item.label}\n              </Link>\n            );\n          })}\n        </nav>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\components\\navigation.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isHomeOrDashboard' is assigned a value but never used.","line":35,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":35,"endColumn":26}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport Link from 'next/link';\nimport { usePathname, useRouter } from 'next/navigation';\nimport { useState, useEffect, useRef } from 'react';\nimport { signOut, useSession } from 'next-auth/react';\nimport { useAuthModal } from './AuthModalContext';\n\nconst modules = [\n  { id: 'aircraft', label: 'Aircraft', href: '/modules/aircraft' },\n  { id: 'flying-club', label: 'Flying Club', href: '/modules/flying-club' },\n  { id: 'social', label: 'Social', href: '/modules/social' },\n  { id: 'fuel-saver', label: 'Fuel Saver', href: '/modules/fuel-saver' },\n  { id: 'e6b', label: 'E6B', href: '/modules/e6b' },\n  { id: 'weather-radar', label: 'Weather Radar', href: '/modules/weather-radar' },\n  { id: 'flight-playback', label: 'Flight Playback', href: '/modules/flight-playback', requiresProPlus: true },\n];\n\ninterface Invite {\n  id: string;\n  email: string;\n  group: {\n    id: string;\n    name: string;\n  };\n  role: string;\n  createdAt: string;\n}\n\nexport default function Navigation() {\n  const pathname = usePathname();\n  const router = useRouter();\n  const { data: session } = useSession();\n  const { openLoginModal } = useAuthModal();\n  const isHomeOrDashboard = pathname === '/' || pathname === '/dashboard';\n  \n  // Check if user has Pro+ access\n  const userTier = session?.user?.tier;\n  const userRole = session?.user?.role;\n  const isProPlus = userTier === 'proplus' || userRole === 'admin' || userRole === 'owner';\n  \n  // Filter modules based on tier\n  const availableModules = modules.filter(m => !m.requiresProPlus || isProPlus);\n  \n  const [showDropdown, setShowDropdown] = useState(false);\n  const [showInviteDropdown, setShowInviteDropdown] = useState(false);\n  const [pendingInvites, setPendingInvites] = useState<Invite[]>([]);\n  const [loadingInvites, setLoadingInvites] = useState(true);\n  const dropdownRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    // Close dropdown when clicking outside\n    const handleClickOutside = (event: MouseEvent) => {\n      if (dropdownRef.current && !dropdownRef.current.contains(event.target as Node)) {\n        setShowDropdown(false);\n        setShowInviteDropdown(false);\n      }\n    };\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, []);\n\n  useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if ((event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'k') {\n        event.preventDefault();\n        router.push('/search');\n      }\n    };\n    window.addEventListener('keydown', handleKeyDown);\n    return () => window.removeEventListener('keydown', handleKeyDown);\n  }, [router]);\n\n  useEffect(() => {\n    const fetchInvites = async () => {\n      try {\n        const res = await fetch('/api/invitations');\n        if (res.ok) {\n          const data = await res.json();\n          setPendingInvites(data);\n        }\n      } catch (e) {\n        console.error('Error fetching invites:', e);\n      }\n      setLoadingInvites(false);\n    };\n    fetchInvites();\n  }, []);\n\n  const handleAcceptInvite = async (inviteId: string) => {\n    try {\n      const res = await fetch('/api/invitations', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ inviteId }),\n      });\n      if (res.ok) {\n        setPendingInvites(prev => prev.filter(i => i.id !== inviteId));\n        alert('You have successfully joined the group!');\n      } else {\n        const data = await res.json();\n        alert(data.error || 'Failed to accept invitation');\n      }\n    } catch (e) {\n      console.error('Error accepting invite:', e);\n      alert('Failed to accept invitation');\n    }\n  };\n\n  const handleLogout = () => {\n    signOut({ callbackUrl: '/' });\n  };\n\n  return (\n    <nav className=\"fixed top-0 left-0 right-0 z-50 border-b border-slate-800/60 bg-slate-950/80 backdrop-blur-md\">\n      <div className=\"mx-auto flex max-w-7xl items-center justify-between px-4 py-3\">\n        {/* Logo / Home */}\n        <div className=\"flex items-center gap-4\">\n          <Link \n            href=\"/dashboard\" \n            className=\"text-2xl text-slate-100 hover:text-emerald-400 transition-colors\"\n          >\n            âœˆï¸\n          </Link>\n          <Link \n            href=\"/\" \n            className=\"text-lg font-semibold text-slate-100 hover:text-emerald-400 transition-colors\"\n          >\n            Aviation\n          </Link>\n        </div>\n\n        {/* Module Links */}\n        <div className=\"hidden md:flex items-center gap-1\">\n          {availableModules.map((module) => (\n            <Link\n              key={module.id}\n              href={module.href}\n              className={`rounded-lg px-4 py-2 text-sm font-medium transition-colors ${\n                pathname === module.href\n                  ? 'bg-emerald-500/20 text-emerald-400'\n                  : 'text-slate-300 hover:bg-slate-800 hover:text-slate-100'\n              }`}\n            >\n              {module.label}\n            </Link>\n          ))}\n        </div>\n\n        {/* Right side */}\n        <div className=\"flex items-center gap-3\">\n          <Link\n            href=\"/search\"\n            className=\"hidden md:flex items-center gap-2 rounded-lg border border-slate-700 px-3 py-2 text-sm text-slate-300 hover:border-emerald-400 hover:text-white transition-colors\"\n          >\n            <span className=\"text-base\">ðŸ”</span>\n            <span>Search</span>\n            <span className=\"text-xs text-slate-500 border border-slate-700 rounded px-1.5 py-0.5\">Ctrl+K</span>\n          </Link>\n          {/* Invitations Bell */}\n          <div className=\"relative\">\n            <button\n              onClick={() => { setShowInviteDropdown(!showInviteDropdown); setShowDropdown(false); }}\n              className=\"relative rounded-lg bg-slate-800 p-2 text-slate-200 hover:bg-slate-700 transition-colors\"\n            >\n              <svg className=\"h-5 w-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\" />\n              </svg>\n              {pendingInvites.length > 0 && (\n                <span className=\"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center\">\n                  {pendingInvites.length}\n                </span>\n              )}\n            </button>\n            \n            {showInviteDropdown && (\n              <div className=\"absolute right-0 mt-2 w-80 rounded-lg bg-slate-800 border border-slate-700 shadow-lg overflow-hidden z-50\">\n                <div className=\"px-4 py-3 border-b border-slate-700\">\n                  <h3 className=\"font-medium\">Invitations</h3>\n                </div>\n                {loadingInvites ? (\n                  <div className=\"p-4 text-center text-slate-400\">Loading...</div>\n                ) : pendingInvites.length === 0 ? (\n                  <div className=\"p-4 text-center text-slate-400\">No pending invitations</div>\n                ) : (\n                  <div className=\"max-h-80 overflow-y-auto\">\n                    {pendingInvites.map((invite) => (\n                      <div key={invite.id} className=\"p-4 border-b border-slate-700/50\">\n                        <div className=\"font-medium text-sm\">{invite.group.name}</div>\n                        <div className=\"text-xs text-slate-400 mt-1\">\n                          Invited as {invite.role} â€¢ {new Date(invite.createdAt).toLocaleDateString()}\n                        </div>\n                        <button\n                          onClick={() => handleAcceptInvite(invite.id)}\n                          className=\"mt-2 w-full bg-emerald-500 hover:bg-emerald-600 text-white text-sm py-1.5 rounded-lg transition-colors\"\n                        >\n                          Accept Invitation\n                        </button>\n                      </div>\n                    ))}\n                  </div>\n                )}\n              </div>\n            )}\n          </div>\n\n          {/* Mobile menu button */}\n          <div className=\"relative md:hidden\">\n            <button className=\"rounded-lg bg-slate-800 p-2 text-slate-300 hover:bg-slate-700\">\n              <svg className=\"h-5 w-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 6h16M4 12h16M4 18h16\" />\n              </svg>\n            </button>\n          </div>\n\n          {/* Profile Dropdown */}\n          {session ? (\n            <div className=\"relative\" ref={dropdownRef}>\n              <button\n                onClick={() => { setShowDropdown(!showDropdown); setShowInviteDropdown(false); }}\n                className=\"flex items-center gap-2 rounded-lg bg-slate-800 px-3 py-2 text-sm font-medium text-slate-200 hover:bg-slate-700 transition-colors\"\n              >\n                <svg className=\"h-5 w-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\" />\n                </svg>\n                <span className=\"hidden sm:inline\">{session.user?.name || session.user?.email?.split('@')[0]}</span>\n                <svg className=\"h-4 w-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n                </svg>\n              </button>\n              \n              {showDropdown && (\n                <div className=\"absolute right-0 mt-2 w-56 rounded-lg bg-slate-800 border border-slate-700 shadow-lg overflow-hidden z-50\">\n                  {/* User info */}\n                  <div className=\"px-4 py-3 border-b border-slate-700\">\n                    <div className=\"font-medium text-white\">{session.user?.name || 'User'}</div>\n                    <div className=\"text-xs text-slate-400\">{session.user?.email}</div>\n                  </div>\n                  \n                  {/* Menu items */}\n                  <div className=\"py-1\">\n                    <Link\n                      href=\"/profile\"\n                      className=\"flex items-center gap-3 px-4 py-2.5 text-sm text-slate-200 hover:bg-slate-700\"\n                      onClick={() => setShowDropdown(false)}\n                    >\n                      <svg className=\"h-4 w-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\" />\n                      </svg>\n                      Profile\n                    </Link>\n                    <Link\n                      href=\"/trips\"\n                      className=\"flex items-center gap-3 px-4 py-2.5 text-sm text-slate-200 hover:bg-slate-700\"\n                      onClick={() => setShowDropdown(false)}\n                    >\n                      <svg className=\"h-4 w-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7\" />\n                      </svg>\n                      My Trips\n                    </Link>\n                    <div className=\"border-t border-slate-700 my-1\"></div>\n                    <Link\n                      href=\"/settings\"\n                      className=\"flex items-center gap-3 px-4 py-2.5 text-sm text-slate-200 hover:bg-slate-700\"\n                      onClick={() => setShowDropdown(false)}\n                    >\n                      <svg className=\"h-4 w-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z\" />\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\" />\n                      </svg>\n                      Settings\n                    </Link>\n                    <Link\n                      href=\"/support\"\n                      className=\"flex items-center gap-3 px-4 py-2.5 text-sm text-slate-200 hover:bg-slate-700\"\n                      onClick={() => setShowDropdown(false)}\n                    >\n                      <svg className=\"h-4 w-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                      </svg>\n                      Support\n                    </Link>\n                    <div className=\"border-t border-slate-700 my-1\"></div>\n                    <button\n                      onClick={handleLogout}\n                      className=\"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-red-400 hover:bg-slate-700\"\n                    >\n                      <svg className=\"h-4 w-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1\" />\n                      </svg>\n                      Sign Out\n                    </button>\n                  </div>\n                </div>\n              )}\n            </div>\n          ) : (\n            <button\n              onClick={() => openLoginModal()}\n              className=\"bg-slate-600 hover:bg-slate-500 text-white px-3 py-1.5 rounded text-xs\"\n            >\n              Sign In\n            </button>\n          )}\n        </div>\n      </div>\n\n      {/* Mobile menu dropdown */}\n      <div className=\"border-t border-slate-800/60 md:hidden\">\n        <div className=\"flex overflow-x-auto px-4 py-2 gap-2\">\n          {availableModules.map((module) => (\n            <Link\n              key={module.id}\n              href={module.href}\n              className={`flex-shrink-0 rounded-lg px-4 py-2 text-sm font-medium whitespace-nowrap ${\n                pathname === module.href\n                  ? 'bg-emerald-500/20 text-emerald-400'\n                  : 'bg-slate-800 text-slate-300'\n              }`}\n            >\n              {module.label}\n            </Link>\n          ))}\n        </div>\n      </div>\n    </nav>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\components\\offline-banner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\components\\providers.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\components\\three\\aircraft-model.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Suspense' is defined but never used.","line":3,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":18,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Suspense"},"fix":{"range":[24,33],"text":""},"desc":"Remove unused variable \"Suspense\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'hasModel' is assigned a value but never used.","line":40,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":40,"endColumn":18},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\David\\next-dashboard\\app\\components\\three\\aircraft-model.tsx:48:7\n  46 |       // Check if model exists - in production, this would be an API call\n  47 |       // For now, we'll assume the model doesn't exist and use fallback\n> 48 |       setHasModel(false);\n     |       ^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  49 |     } else {\n  50 |       // No custom path, use procedural ghost\n  51 |       setHasModel(false);","line":48,"column":7,"nodeType":null,"endLine":48,"endColumn":18}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { Suspense, useState, useEffect } from 'react';\nimport { Canvas } from '@react-three/fiber';\nimport { OrbitControls, Environment, PerspectiveCamera } from '@react-three/drei';\nimport { GhostAircraft } from './ghost-aircraft';\n\ntype AircraftModelProps = {\n  /** Tail number / N-Number */\n  nNumber: string;\n  /** Aircraft length in feet (from specs) */\n  length?: number;\n  /** Wingspan in feet (from specs) */\n  wingspan?: number;\n  /** Number of engines */\n  engineCount?: number;\n  /** Aircraft manufacturer */\n  manufacturer?: string;\n  /** Aircraft model */\n  model?: string;\n  /** Optional custom .glb model path */\n  modelPath?: string;\n};\n\n/**\n * Aircraft Model Component with Fallback\n * \n * Tries to load a .glb file first.\n * If missing or on error, renders the procedural GhostAircraft.\n */\nexport function AircraftModel({\n  nNumber,\n  length,\n  wingspan,\n  engineCount = 1,\n  manufacturer = 'Unknown',\n  model = 'Unknown',\n  modelPath,\n}: AircraftModelProps) {\n  const [hasModel, setHasModel] = useState(false);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    // If a custom model path is provided, try to load it\n    if (modelPath) {\n      // Check if model exists - in production, this would be an API call\n      // For now, we'll assume the model doesn't exist and use fallback\n      setHasModel(false);\n    } else {\n      // No custom path, use procedural ghost\n      setHasModel(false);\n    }\n    setLoading(false);\n  }, [modelPath, nNumber]);\n\n  // Calculate specs from available data or use fallbacks\n  const specs = {\n    length: length || getDefaultLength(manufacturer, model),\n    wingspan: wingspan || getDefaultWingspan(manufacturer, model),\n    engineCount,\n    manufacturer,\n    model,\n  };\n\n  if (loading) {\n    return (\n      <div className=\"w-full h-full flex items-center justify-center bg-slate-900\">\n        <div className=\"text-slate-400\">Loading model...</div>\n      </div>\n    );\n  }\n\n  // If we have a real 3D model, render it\n  // For now, always use the procedural ghost\n  return (\n    <div className=\"w-full h-full\">\n      <Canvas>\n        <PerspectiveCamera makeDefault position={[3, 2, 5]} fov={50} />\n        <OrbitControls\n          enablePan={true}\n          enableZoom={true}\n          enableRotate={true}\n          autoRotate={false}\n          minDistance={1}\n          maxDistance={20}\n        />\n        \n        {/* Lighting */}\n        <ambientLight intensity={0.3} />\n        <pointLight position={[10, 10, 10]} intensity={1} color=\"#00aaff\" />\n        <pointLight position={[-10, -10, -10]} intensity={0.5} color=\"#ff6600\" />\n        \n        {/* Environment for reflections */}\n        <Environment preset=\"night\" />\n        \n        {/* The Ghost Aircraft */}\n        <GhostAircraft\n          length={specs.length}\n          wingspan={specs.wingspan}\n          engineCount={specs.engineCount}\n          manufacturer={specs.manufacturer}\n          model={specs.model}\n        />\n        \n        {/* Grid for reference */}\n        <gridHelper args={[10, 20, '#1a3a4a', '#0a1a2a']} position={[0, -0.5, 0]} />\n      </Canvas>\n    </div>\n  );\n}\n\n/**\n * Get default length based on manufacturer/model\n */\nfunction getDefaultLength(manufacturer: string, model: string): number {\n  const upperMfr = manufacturer.toUpperCase();\n  const upperModel = model.toUpperCase();\n  \n  // Commercial jets\n  if (upperMfr.includes('BOEING')) {\n    if (upperModel.includes('737')) return 117;\n    if (upperModel.includes('757')) return 155;\n    if (upperModel.includes('767')) return 180;\n    if (upperModel.includes('777')) return 209;\n    if (upperModel.includes('787')) return 186;\n  }\n  \n  if (upperMfr.includes('AIRBUS')) {\n    if (upperModel.includes('A320')) return 123;\n    if (upperModel.includes('A321')) return 145;\n    if (upperModel.includes('A330')) return 209;\n    if (upperModel.includes('A380')) return 239;\n  }\n  \n  // Default GA sizes\n  return 35; // ~Cessna 172 size\n}\n\n/**\n * Get default wingspan based on manufacturer/model\n */\nfunction getDefaultWingspan(manufacturer: string, model: string): number {\n  const upperMfr = manufacturer.toUpperCase();\n  const upperModel = model.toUpperCase();\n  \n  // Commercial jets\n  if (upperMfr.includes('BOEING')) {\n    if (upperModel.includes('737')) return 117;\n    if (upperModel.includes('757')) return 124;\n    if (upperModel.includes('767')) return 156;\n    if (upperModel.includes('777')) return 212;\n    if (upperModel.includes('787')) return 197;\n  }\n  \n  if (upperMfr.includes('AIRBUS')) {\n    if (upperModel.includes('A320')) return 117;\n    if (upperModel.includes('A321')) return 117;\n    if (upperModel.includes('A330')) return 197;\n    if (upperModel.includes('A380')) return 261;\n  }\n  \n  // Default GA\n  return 36; // ~Cessna 172\n}\n\nexport default AircraftModel;\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\components\\three\\ghost-aircraft.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\dashboard\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\dashboard\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'GraduationCap' is defined but never used.","line":34,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":34,"endColumn":16,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"GraduationCap"},"fix":{"range":[773,790],"text":""},"desc":"Remove unused variable \"GraduationCap\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'maintenanceItems' is assigned a value but never used.","line":91,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":91,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'upcomingFlights' is assigned a value but never used.","line":99,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":99,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'selectedFlightPlan' is assigned a value but never used.","line":129,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":129,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setSelectedFlightPlan' is assigned a value but never used.","line":129,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":129,"endColumn":51},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'selectedMaintenanceItem' is assigned a value but never used.","line":130,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":130,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setSelectedMaintenanceItem' is assigned a value but never used.","line":130,"column":35,"nodeType":"Identifier","messageId":"unusedVar","endLine":130,"endColumn":61},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'selectedCurrencyItem' is assigned a value but never used.","line":131,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":131,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setSelectedCurrencyItem' is assigned a value but never used.","line":131,"column":32,"nodeType":"Identifier","messageId":"unusedVar","endLine":131,"endColumn":55},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":136,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":136,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6056,6059],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6056,6059],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":144,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6612,6615],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6612,6615],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":147,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":147,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6828,6831],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6828,6831],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":152,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":152,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7178,7181],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7178,7181],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":168,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":168,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8309,8312],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8309,8312],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":168,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":168,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8323,8326],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8323,8326],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":210,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":210,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9545,9548],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9545,9548],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":212,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":212,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9640,9643],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9640,9643],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":342,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":342,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14123,14126],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14123,14126],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":446,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":446,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17795,17798],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17795,17798],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1135,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1135,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[47882,47885],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[47882,47885],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1141,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1141,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[48235,48238],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[48235,48238],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":12,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from \"react\"\nimport Link from \"next/link\"\nimport { useRouter } from \"next/navigation\"\nimport { useSession } from \"next-auth/react\"\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\"\nimport { Badge } from \"@/components/ui/badge\"\nimport { Button } from \"@/components/ui/button\"\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\"\nimport { FlightScheduler } from \"@/components/scheduler/FlightScheduler\"\nimport { Separator } from \"@/components/ui/separator\"\nimport { \n  Plane, \n  MapPin,\n  Wind,\n  Fuel,\n  Cloud,\n  Calendar,\n  AlertTriangle,\n  CheckCircle2,\n  Clock,\n  Settings,\n  Bell,\n  Search,\n  FileText,\n  Wrench,\n  GraduationCap,\n  Gauge,\n  ArrowRight,\n  Eye,\n  Edit,\n  Plus,\n  X,\n  LayoutDashboard,\n  EyeOff,\n  Loader2,\n  Navigation,\n  User,\n  ExternalLink,\n  Mail\n} from \"lucide-react\"\nimport { AreaChart, Area, ResponsiveContainer, XAxis, YAxis, CartesianGrid, Tooltip as RechartsTooltip } from \"recharts\"\nimport { FlightCompleteWizard } from \"@/components/flight-complete/FlightCompleteWizard\"\n\n// Demo data markers - TODO: Connect to real database tables\n// - LogbookEntry table for flight hours\n// - FlightPlan table for saved plans  \n// - UserAircraft table for maintenance\n// - PilotProfile for home airport\n// - NEW TABLE NEEDED: Credential tracking (medical, flight review, etc)\n// - NEW API NEEDED: Weather/METAR integration\n\n// Widget definitions\ntype WidgetType = \n  | 'airport-weather'\n  | 'quick-alerts'\n  | 'flight-hours'\n  | 'upcoming-flights'\n  | 'maintenance'\n  | 'currency'\n  | 'flight-plans'\n\nconst WIDGET_INFO: Record<WidgetType, { name: string; description: string }> = {\n  'airport-weather': { name: 'Home Airport Weather', description: 'Current conditions at your home airport' },\n  'quick-alerts': { name: 'Quick Alerts', description: 'Scheduled maintenance, next flight, and hours' },\n  'flight-hours': { name: 'Flight Hours Chart', description: 'Your flying activity over time' },\n  'upcoming-flights': { name: 'Upcoming Flights', description: 'Your scheduled flights and lessons' },\n  'maintenance': { name: 'Aircraft Maintenance', description: 'Due maintenance items' },\n  'currency': { name: 'Currency & Licenses', description: 'Credential expiration tracking' },\n  'flight-plans': { name: 'Saved Flight Plans', description: 'Quick access to your routes' },\n}\n\n// Flight hours data is computed from logbook entries\n\n// Demo currency - NOT IMPLEMENTED - needs new table\nconst currencyItems = [\n  { id: 1, type: \"Medical Certificate\", class: \"Class 2\", expiryDate: \"Dec 15, 2026\", daysRemaining: 297, status: \"ok\" },\n  { id: 2, type: \"Flight Review\", requirement: \"BFR\", expiryDate: \"May 8, 2026\", daysRemaining: 77, status: \"warning\" },\n  { id: 3, type: \"Night Currency\", requirement: \"3 T/O & Landings\", expiryDate: \"Apr 2, 2026\", daysRemaining: 41, status: \"warning\" },\n  { id: 4, type: \"IFR Currency\", requirement: \"6 Approaches\", expiryDate: \"Aug 22, 2026\", daysRemaining: 183, status: \"ok\" },\n]\n\n// Demo maintenance - CONNECT TO UserAircraft table\nconst maintenanceItems = [\n  { id: 1, item: \"100-Hour Inspection\", aircraft: \"N12345\", maintenanceType: \"CLUB\", dueDate: \"Mar 15, 2026\", hoursRemaining: 8.5, status: \"warning\" },\n  { id: 2, item: \"Annual Inspection\", aircraft: \"N12345\", maintenanceType: \"CLUB\", dueDate: \"Jun 20, 2026\", hoursRemaining: 98.2, status: \"ok\" },\n  { id: 3, item: \"Oil Change\", aircraft: \"N12345\", maintenanceType: \"CLUB\", dueDate: \"Mar 1, 2026\", hoursRemaining: 2.3, status: \"urgent\" },\n  { id: 4, item: \"ELT Battery\", aircraft: \"N111AA\", maintenanceType: \"PERSONAL\", dueDate: \"Aug 10, 2026\", hoursRemaining: 156.0, status: \"ok\" },\n]\n\n// Upcoming lessons/flights - CONNECT TO FlightPlan table\nconst upcomingFlights = [\n  { id: 1, type: \"lesson\", title: \"IFR Training - Approaches\", instructor: \"John Smith, CFI-I\", date: \"Feb 23, 2026\", time: \"14:00\", aircraft: \"N12345\" },\n  { id: 2, type: \"flight\", title: \"Cross Country - KBOS to KALB\", date: \"Feb 25, 2026\", time: \"09:00\", aircraft: \"N12345\" },\n  { id: 3, type: \"lesson\", title: \"Commercial Maneuvers\", instructor: \"Sarah Johnson, CFI\", date: \"Feb 28, 2026\", time: \"10:30\", aircraft: \"N12345\" },\n]\n\n// Saved flight plans - CONNECT TO FlightPlan table\nconst savedFlightPlans = [\n  { id: 1, name: \"Weekend Getaway - KBOS to KMVY\", distance: 68, duration: \"0:45\", route: \"Direct\", lastUpdated: \"2 days ago\" },\n  { id: 2, name: \"Cross Country - KBOS to KALB\", distance: 143, duration: \"1:15\", route: \"V3 ALB\", lastUpdated: \"1 week ago\" },\n  { id: 3, name: \"Practice Area - KBOS Local\", distance: 25, duration: \"1:30\", route: \"Local\", lastUpdated: \"3 days ago\" },\n]\n\nexport default function PilotDashboard() {\n  const { data: session, status } = useSession()\n  const router = useRouter()\n  const [groupId, setGroupId] = useState<string | null>(null)\n  const [groupIds, setGroupIds] = useState<string[]>([])\n  const [customizeMode, setCustomizeMode] = useState(false)\n  const [visibleWidgets, setVisibleWidgets] = useState<WidgetType[]>([\n    'airport-weather',\n    'quick-alerts',\n    'flight-hours',\n    'upcoming-flights',\n    'maintenance',\n    'currency',\n    'flight-plans',\n  ])\n\n  // Modal/selection state\n  const [selectedFlightPlan, setSelectedFlightPlan] = useState<typeof savedFlightPlans[0] | null>(null)\n  const [selectedMaintenanceItem, setSelectedMaintenanceItem] = useState<typeof maintenanceItems[0] | null>(null)\n  const [selectedCurrencyItem, setSelectedCurrencyItem] = useState<typeof currencyItems[0] | null>(null)\n  const [showFlightComplete, setShowFlightComplete] = useState(false)\n  const [activeFlight, setActiveFlight] = useState<{id: string; aircraftId: string; aircraftName: string; userId: string; userName: string; hobbsStart?: number} | null>(null)\n  const [showDemoNotice, setShowDemoNotice] = useState(true)\n  const [scheduledWindow, setScheduledWindow] = useState<'7' | '30' | 'all'>('7')\n  const [scheduledFlights, setScheduledFlights] = useState<any[]>([])\n  const [isScheduledLoading, setIsScheduledLoading] = useState(false)\n  const [scheduledError, setScheduledError] = useState<string | null>(null)\n  const [showScheduler, setShowScheduler] = useState(false)\n  const [scheduledRefreshKey, setScheduledRefreshKey] = useState(0)\n  const [showNextFlightModal, setShowNextFlightModal] = useState(false)\n  const [showMaintenanceModal, setShowMaintenanceModal] = useState(false)\n  const [showLogbookModal, setShowLogbookModal] = useState(false)\n  const [maintenanceItems, setMaintenanceItems] = useState<any[]>([])\n  const [maintenanceError, setMaintenanceError] = useState<string | null>(null)\n  const [maintenanceLoading, setMaintenanceLoading] = useState(false)\n  const [logbookEntries, setLogbookEntries] = useState<any[]>([])\n  const [logbookError, setLogbookError] = useState<string | null>(null)\n  const [logbookLoading, setLogbookLoading] = useState(false)\n  const [homeAirportIcao, setHomeAirportIcao] = useState<string | null>(null)\n  const [homeAirportName, setHomeAirportName] = useState<string | null>(null)\n  const [homeWeather, setHomeWeather] = useState<any | null>(null)\n  const [homeWeatherUpdatedAt, setHomeWeatherUpdatedAt] = useState<string | null>(null)\n  const [homeWeatherError, setHomeWeatherError] = useState<string | null>(null)\n  const [homeWeatherLoading, setHomeWeatherLoading] = useState(false)\n  const [fuelPrice, setFuelPrice] = useState<number | null>(null)\n  const [fuelPriceUpdatedAt, setFuelPriceUpdatedAt] = useState<string | null>(null)\n  const [fuelPriceError, setFuelPriceError] = useState<string | null>(null)\n  const [fuelPriceLoading, setFuelPriceLoading] = useState(false)\n  const [communityFuelPrice, setCommunityFuelPrice] = useState<number | null>(null)\n  const [communityFuelUpdatedAt, setCommunityFuelUpdatedAt] = useState<string | null>(null)\n  const [communityFuelError, setCommunityFuelError] = useState<string | null>(null)\n  const [communityFuelLoading, setCommunityFuelLoading] = useState(false)\n  const [mechanicUnread, setMechanicUnread] = useState(0)\n  const [showMechanicNotice, setShowMechanicNotice] = useState(false)\n  const [lastMechanicUnread, setLastMechanicUnread] = useState(0)\n\n  const flightHoursData = logbookEntries.reduce((acc: any[], entry: any) => {\n    const date = entry?.date ? new Date(entry.date) : null\n    if (!date || Number.isNaN(date.getTime())) return acc\n    const key = date.toLocaleString('en-US', { month: 'short' })\n    const existing = acc.find((item) => item.month === key)\n    const hours = Number(entry.totalTime || 0)\n    if (existing) {\n      existing.hours += hours\n    } else {\n      acc.push({ month: key, hours })\n    }\n    return acc\n  }, [])\n\n  // Load preferences from localStorage on mount\n  useEffect(() => {\n    const saved = localStorage.getItem('dashboard-widgets')\n    if (saved) {\n      try {\n        setVisibleWidgets(JSON.parse(saved))\n      } catch (e) {\n        console.error('[v0] Failed to parse saved widgets:', e)\n      }\n    }\n  }, [])\n\n  // Save preferences to localStorage\n  useEffect(() => {\n    localStorage.setItem('dashboard-widgets', JSON.stringify(visibleWidgets))\n  }, [visibleWidgets])\n\n  useEffect(() => {\n    let cancelled = false\n\n    async function loadGroups() {\n      try {\n        const res = await fetch('/api/groups')\n        if (!res.ok) return\n        const data = await res.json()\n        if (!Array.isArray(data) || data.length === 0) return\n\n        const adminGroup =\n          data.find((g: any) => g.role === 'ADMIN' || g.role === 'OWNER') ?? data[0]\n\n        const ids = data.map((g: any) => g.id).filter(Boolean)\n        setGroupIds(ids)\n\n        if (!adminGroup || cancelled) return\n        setGroupId(adminGroup.id)\n        setShowDemoNotice(false)\n      } catch (error) {\n        console.error('Failed to load groups for dashboard', error)\n      }\n    }\n\n    loadGroups()\n    return () => {\n      cancelled = true\n    }\n  }, [])\n\n  const handleOpenFlightComplete = async () => {\n    if (!groupId) {\n      alert('Please join or select a flying club to complete a flight')\n      return\n    }\n\n    try {\n      const res = await fetch(`/api/clubs/${groupId}/flights/active`)\n      if (!res.ok) {\n        const error = await res.json()\n        alert(error.error || 'Failed to load active flights')\n        return\n      }\n\n      const active = await res.json()\n      if (!Array.isArray(active) || active.length === 0) {\n        const now = new Date()\n        const upcoming = scheduledFlights.find((f) => {\n          if (!f?.startTime || !f?.endTime) return false\n          const start = new Date(f.startTime)\n          const end = new Date(f.endTime)\n          return start <= now && end >= now && f.groupId\n        })\n\n        if (!upcoming) {\n          const nextClub = scheduledFlights.find((f) => f?.groupId)\n          if (!nextClub) {\n            alert('No active flights found')\n            return\n          }\n\n          const hobbsStartInput = window.prompt('Enter Hobbs start time to check out this flight')\n          const hobbsStart = hobbsStartInput ? Number(hobbsStartInput) : NaN\n          if (!hobbsStart || Number.isNaN(hobbsStart)) {\n            alert('Valid Hobbs start time is required')\n            return\n          }\n\n          const checkoutRes = await fetch(`/api/clubs/${nextClub.groupId}/flights/checkout`, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              aircraftId: nextClub.aircraftId,\n              hobbsStart,\n              notes: nextClub.purpose || null,\n            }),\n          })\n\n          if (!checkoutRes.ok) {\n            const error = await checkoutRes.json()\n            alert(error.error || 'Failed to start flight')\n            return\n          }\n\n          const checkout = await checkoutRes.json()\n          const flight = checkout.flight\n\n          setActiveFlight({\n            id: flight.id,\n            aircraftId: flight.aircraftId,\n            aircraftName: flight.aircraft?.nNumber\n              ? `${flight.aircraft.nNumber}${flight.aircraft.name ? ` (${flight.aircraft.name})` : ''}`\n              : 'Unknown Aircraft',\n            userId: flight.user?.id ?? session?.user?.id ?? 'unknown',\n            userName: flight.user?.name ?? session?.user?.name ?? 'Pilot',\n            hobbsStart: flight.hobbsStart ? Number(flight.hobbsStart) : undefined,\n          })\n          setShowFlightComplete(true)\n          return\n        }\n\n        const hobbsStartInput = window.prompt('Enter Hobbs start time to check out this flight')\n        const hobbsStart = hobbsStartInput ? Number(hobbsStartInput) : NaN\n        if (!hobbsStart || Number.isNaN(hobbsStart)) {\n          alert('Valid Hobbs start time is required')\n          return\n        }\n\n        const checkoutRes = await fetch(`/api/clubs/${upcoming.groupId}/flights/checkout`, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            aircraftId: upcoming.aircraftId,\n            hobbsStart,\n            notes: upcoming.purpose || null,\n          }),\n        })\n\n        if (!checkoutRes.ok) {\n          const error = await checkoutRes.json()\n          alert(error.error || 'Failed to start flight')\n          return\n        }\n\n        const checkout = await checkoutRes.json()\n        const flight = checkout.flight\n\n        setActiveFlight({\n          id: flight.id,\n          aircraftId: flight.aircraftId,\n          aircraftName: flight.aircraft?.nNumber\n            ? `${flight.aircraft.nNumber}${flight.aircraft.name ? ` (${flight.aircraft.name})` : ''}`\n            : 'Unknown Aircraft',\n          userId: flight.user?.id ?? session?.user?.id ?? 'unknown',\n          userName: flight.user?.name ?? session?.user?.name ?? 'Pilot',\n          hobbsStart: flight.hobbsStart ? Number(flight.hobbsStart) : undefined,\n        })\n        setShowFlightComplete(true)\n        return\n      }\n\n      const sessionUserId = session?.user?.id\n      const myFlight = sessionUserId\n        ? active.find((f: any) => f.user?.id === sessionUserId || f.userId === sessionUserId)\n        : null\n\n      const flight = myFlight ?? active[0]\n\n      setActiveFlight({\n        id: flight.id,\n        aircraftId: flight.aircraftId,\n        aircraftName: flight.aircraft?.nNumber\n          ? `${flight.aircraft.nNumber}${flight.aircraft.name ? ` (${flight.aircraft.name})` : ''}`\n          : 'Unknown Aircraft',\n        userId: flight.user?.id ?? flight.userId ?? sessionUserId ?? 'unknown',\n        userName: flight.user?.name ?? session?.user?.name ?? 'Pilot',\n        hobbsStart: flight.hobbsStart ? Number(flight.hobbsStart) : undefined,\n      })\n      setShowFlightComplete(true)\n    } catch (error) {\n      console.error('Failed to open flight completion wizard', error)\n      alert('Failed to load active flights')\n    }\n  }\n\n  useEffect(() => {\n    if (!session?.user?.id) return\n    if (groupIds.length === 0) return\n    let cancelled = false\n\n    async function loadScheduled() {\n      try {\n        setIsScheduledLoading(true)\n        setScheduledError(null)\n        const res = await fetch(`/api/bookings?days=${scheduledWindow}`)\n        if (!res.ok) throw new Error('Failed to load bookings')\n        const data = await res.json()\n        if (cancelled) return\n\n        const bookings = Array.isArray(data) ? data : data.bookings || []\n        setScheduledFlights(bookings)\n      } catch (error) {\n        console.error('Failed to load scheduled flights', error)\n        if (!cancelled) setScheduledError('Failed to load scheduled flights')\n      } finally {\n        if (!cancelled) setIsScheduledLoading(false)\n      }\n    }\n\n    loadScheduled()\n    return () => {\n      cancelled = true\n    }\n  }, [session?.user?.id, groupIds, scheduledWindow, scheduledRefreshKey])\n\n  useEffect(() => {\n    if (!session?.user?.id) return\n    let cancelled = false\n\n    async function loadMaintenance() {\n      try {\n        setMaintenanceLoading(true)\n        setMaintenanceError(null)\n        const res = await fetch('/api/maintenance')\n        if (!res.ok) throw new Error('Failed to load maintenance')\n        const data = await res.json()\n        if (!cancelled) setMaintenanceItems(Array.isArray(data) ? data : data.items || [])\n      } catch (error) {\n        console.error('Failed to load maintenance', error)\n        if (!cancelled) setMaintenanceError('Failed to load maintenance')\n      } finally {\n        if (!cancelled) setMaintenanceLoading(false)\n      }\n    }\n\n    loadMaintenance()\n    return () => {\n      cancelled = true\n    }\n  }, [session?.user?.id])\n\n  useEffect(() => {\n    if (!homeAirportIcao) return\n    let cancelled = false\n\n    async function loadFuelPrice() {\n      try {\n        setFuelPriceLoading(true)\n        setFuelPriceError(null)\n        const communityRes = fetch(`/api/fuel-prices/community?icaos=${encodeURIComponent(homeAirportIcao ?? '')}`)\n        const priceRes = fetch(`/api/fuel-price?icao=${encodeURIComponent(homeAirportIcao ?? '')}`)\n\n        const [priceResponse, communityResponse] = await Promise.all([priceRes, communityRes])\n\n        if (priceResponse.ok) {\n          const data = await priceResponse.json()\n          if (!cancelled) {\n            setFuelPrice(typeof data?.price100ll === 'number' ? data.price100ll : null)\n            setFuelPriceUpdatedAt(data?.lastReported || data?.updatedAt || null)\n          }\n        } else if (!cancelled) {\n          setFuelPriceError('Failed to load airport fuel price')\n        }\n\n        if (communityResponse.ok) {\n          const communityData = await communityResponse.json()\n          const community = Array.isArray(communityData?.prices)\n            ? communityData.prices.find((p: any) => p.icao === homeAirportIcao && p.fuelType === '100LL')\n            : null\n          if (!cancelled) {\n            setCommunityFuelPrice(typeof community?.price === 'number' ? community.price : null)\n            setCommunityFuelUpdatedAt(community?.purchaseDate || null)\n          }\n        } else if (!cancelled) {\n          setCommunityFuelError('Failed to load community price')\n        }\n      } catch (error) {\n        console.error('Failed to load fuel price', error)\n        if (!cancelled) {\n          setFuelPriceError('Failed to load fuel price')\n          setCommunityFuelError('Failed to load community price')\n        }\n      } finally {\n        if (!cancelled) setFuelPriceLoading(false)\n        if (!cancelled) setCommunityFuelLoading(false)\n      }\n    }\n\n    loadFuelPrice()\n    return () => {\n      cancelled = true\n    }\n  }, [homeAirportIcao])\n\n  useEffect(() => {\n    let cancelled = false\n\n    async function loadUnread() {\n      try {\n        const res = await fetch('/api/mechanics/quotes/unread')\n        if (!res.ok) return\n        const data = await res.json()\n        if (!cancelled) {\n          const unread = typeof data?.unread === 'number' ? data.unread : 0\n          setMechanicUnread(unread)\n          if (unread > lastMechanicUnread) {\n            setShowMechanicNotice(true)\n          }\n          setLastMechanicUnread(unread)\n        }\n      } catch (error) {\n        console.error('Failed to load mechanic unread count', error)\n      }\n    }\n\n    loadUnread()\n    const interval = setInterval(loadUnread, 60000)\n    return () => {\n      cancelled = true\n      clearInterval(interval)\n    }\n  }, [lastMechanicUnread])\n\n  useEffect(() => {\n    if (!session?.user?.id) return\n    let cancelled = false\n\n    async function loadHomeAirport() {\n      try {\n        setHomeWeatherLoading(true)\n        setHomeWeatherError(null)\n\n        const profileRes = await fetch('/api/profile')\n        if (!profileRes.ok) throw new Error('Failed to load profile')\n        const profileData = await profileRes.json()\n        const profile = profileData?.profile\n\n        const icao = profile?.homeAirport || null\n        const name = profile?.homeAirportName || null\n\n        if (!icao) {\n          if (!cancelled) {\n            setHomeAirportIcao(null)\n            setHomeAirportName(null)\n            setHomeWeather(null)\n            setHomeWeatherUpdatedAt(null)\n          }\n          return\n        }\n\n        if (!cancelled) {\n          setHomeAirportIcao(icao)\n          setHomeAirportName(name)\n        }\n\n        const weatherRes = await fetch(`/api/weather?icao=${encodeURIComponent(icao)}`)\n        if (!weatherRes.ok) throw new Error('Failed to load weather')\n        const weatherData = await weatherRes.json()\n        const metar = Array.isArray(weatherData?.data) ? weatherData.data[0] : weatherData?.data\n\n        if (!cancelled) {\n          setHomeWeather(metar || null)\n          setHomeWeatherUpdatedAt(weatherData?.fetchedAt || null)\n        }\n      } catch (error) {\n        console.error('Failed to load home airport weather', error)\n        if (!cancelled) setHomeWeatherError('Failed to load home airport')\n      } finally {\n        if (!cancelled) setHomeWeatherLoading(false)\n      }\n    }\n\n    loadHomeAirport()\n    return () => {\n      cancelled = true\n    }\n  }, [session?.user?.id])\n\n  useEffect(() => {\n    if (!session?.user?.id) return\n    let cancelled = false\n\n    async function loadLogbook() {\n      try {\n        setLogbookLoading(true)\n        setLogbookError(null)\n        const res = await fetch('/api/logbook')\n        if (!res.ok) throw new Error('Failed to load logbook')\n        const data = await res.json()\n        const entries = Array.isArray(data) ? data : data.entries || []\n        if (!cancelled) setLogbookEntries(entries)\n      } catch (error) {\n        console.error('Failed to load logbook', error)\n        if (!cancelled) setLogbookError('Failed to load logbook')\n      } finally {\n        if (!cancelled) setLogbookLoading(false)\n      }\n    }\n\n    loadLogbook()\n    return () => {\n      cancelled = true\n    }\n  }, [session?.user?.id])\n\n  const toggleWidget = (widget: WidgetType) => {\n    setVisibleWidgets(prev => \n      prev.includes(widget) \n        ? prev.filter(w => w !== widget)\n        : [...prev, widget]\n    )\n  }\n\n  const isWidgetVisible = (widget: WidgetType) => visibleWidgets.includes(widget)\n\n  // Demo notice - shows what data needs real implementation\n  const DemoNotice = () => (\n    <div className=\"mb-4 rounded-lg bg-amber-500/10 border border-amber-500/30 px-4 py-3 text-sm\">\n      <strong className=\"text-amber-600\">Demo Data Notice:</strong>\n      <span className=\"text-amber-600/80 ml-2\">\n        This dashboard shows demo data. To connect: LogbookEntry, FlightPlan, UserAircraft tables need API routes. \n        Currency/credentials need new table. Weather needs METAR integration.\n      </span>\n    </div>\n  )\n\n  if (status === 'loading') {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n      </div>\n    )\n  }\n\n  if (status === 'unauthenticated') {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <Card className=\"max-w-md\">\n          <CardHeader>\n            <CardTitle>Sign In Required</CardTitle>\n            <CardDescription>Please sign in to view your pilot dashboard</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Button asChild>\n              <Link href=\"/api/auth/signin\">Sign In</Link>\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Header */}\n      <header className=\"sticky top-16 z-40 border-b border-border bg-card/95 shadow-sm backdrop-blur supports-[backdrop-filter]:bg-card/60\">\n        <div className=\"flex h-16 items-center gap-4 px-6\">\n          <div className=\"flex items-center gap-2\">\n            <div className=\"flex h-8 w-8 items-center justify-center rounded-lg bg-primary\">\n              <Plane className=\"h-5 w-5 text-primary-foreground\" />\n            </div>\n            <span className=\"text-lg font-semibold\">Pilot Dashboard</span>\n          </div>\n          \n          <div className=\"ml-auto flex items-center gap-4\">\n            <div className=\"relative hidden md:block\">\n              <Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground\" />\n              <input\n                type=\"search\"\n                placeholder=\"Search flights, plans...\"\n                className=\"h-9 w-64 rounded-lg border border-input bg-background pl-9 pr-3 text-sm outline-none placeholder:text-muted-foreground focus:ring-2 focus:ring-ring\"\n              />\n            </div>\n            <Button \n              variant={customizeMode ? \"default\" : \"ghost\"} \n              size=\"sm\"\n              onClick={() => setCustomizeMode(!customizeMode)}\n              className=\"gap-2\"\n            >\n              <LayoutDashboard className=\"h-4 w-4\" />\n              <span className=\"hidden md:inline\">\n                {customizeMode ? 'Done' : 'Customize'}\n              </span>\n            </Button>\n            <Button variant=\"ghost\" size=\"icon\" className=\"relative\">\n              <Bell className=\"h-5 w-5\" />\n              {mechanicUnread > 0 && (\n                <span className=\"absolute right-1.5 top-1.5 h-2 w-2 rounded-full bg-destructive\" />\n              )}\n            </Button>\n            <Button variant=\"ghost\" size=\"sm\" asChild>\n              <Link href=\"/profile\" className=\"gap-2\">\n                <User className=\"h-4 w-4\" />\n                <span className=\"hidden md:inline\">Profile</span>\n              </Link>\n            </Button>\n            <Button variant=\"ghost\" size=\"icon\" asChild>\n              <Link href=\"/settings\">\n                <Settings className=\"h-5 w-5\" />\n              </Link>\n            </Button>\n          </div>\n        </div>\n      </header>\n\n      {/* Main Content */}\n      <main className=\"p-6\">\n        <div className=\"mx-auto max-w-[1600px] space-y-6\">\n          {/* Welcome Section */}\n          <div className=\"flex flex-col gap-2\">\n            <h1 className=\"text-3xl font-bold tracking-tight\">Welcome back, Captain!</h1>\n            <p className=\"text-muted-foreground\">\n              {\"Here's your flight status and what needs your attention.\"}\n            </p>\n          </div>\n\n          {showMechanicNotice && mechanicUnread > 0 && (\n            <Card className=\"border-primary/40 bg-primary/5\">\n              <CardHeader className=\"pb-3\">\n                <div className=\"flex items-start justify-between\">\n                  <div>\n                    <CardTitle className=\"text-sm\">New mechanic responses</CardTitle>\n                    <CardDescription>\n                      You have {mechanicUnread} unread response{mechanicUnread > 1 ? 's' : ''}.\n                    </CardDescription>\n                  </div>\n                  <Button variant=\"ghost\" size=\"icon\" onClick={() => setShowMechanicNotice(false)}>\n                    <X className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <Button size=\"sm\" onClick={() => router.push('/mechanics/inbox')}>Open Inbox</Button>\n              </CardContent>\n            </Card>\n          )}\n\n          {/* Demo Data Notice */}\n          {showDemoNotice && <DemoNotice />}\n\n          {/* Customize Mode Panel */}\n          {customizeMode && (\n            <Card className=\"border-primary\">\n              <CardHeader>\n                <div className=\"flex items-start justify-between\">\n                  <div className=\"space-y-1\">\n                    <CardTitle className=\"flex items-center gap-2\">\n                      <LayoutDashboard className=\"h-5 w-5 text-primary\" />\n                      Customize Dashboard\n                    </CardTitle>\n                    <CardDescription>\n                      Show or hide widgets to personalize your dashboard\n                    </CardDescription>\n                  </div>\n                  <Button \n                    variant=\"ghost\" \n                    size=\"icon\"\n                    onClick={() => setCustomizeMode(false)}\n                  >\n                    <X className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <div className=\"grid gap-3 md:grid-cols-2 lg:grid-cols-3\">\n                  {(Object.keys(WIDGET_INFO) as WidgetType[]).map((widget) => {\n                    const info = WIDGET_INFO[widget]\n                    const visible = isWidgetVisible(widget)\n                    return (\n                      <button\n                        key={widget}\n                        onClick={() => toggleWidget(widget)}\n                        className={`flex items-start gap-3 rounded-lg border p-4 text-left transition-all hover:bg-muted/50 ${\n                          visible \n                            ? 'border-primary bg-primary/5' \n                            : 'border-border bg-background opacity-60'\n                        }`}\n                      >\n                        <div className={`mt-1 rounded-md p-1.5 ${\n                          visible ? 'bg-primary text-primary-foreground' : 'bg-muted'\n                        }`}>\n                          {visible ? (\n                            <CheckCircle2 className=\"h-4 w-4\" />\n                          ) : (\n                            <EyeOff className=\"h-4 w-4\" />\n                          )}\n                        </div>\n                        <div className=\"flex-1 space-y-1\">\n                          <p className=\"text-sm font-medium leading-none\">{info.name}</p>\n                          <p className=\"text-xs text-muted-foreground\">{info.description}</p>\n                        </div>\n                      </button>\n                    )\n                  })}\n                </div>\n              </CardContent>\n            </Card>\n          )}\n\n          {/* Home Airport Weather & Info */}\n          {isWidgetVisible('airport-weather') && (\n          <Card className=\"border-primary/50\">\n            <CardHeader>\n              <div className=\"flex items-start justify-between\">\n                <div className=\"space-y-1\">\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <MapPin className=\"h-5 w-5 text-primary\" />\n                    {homeAirportIcao ? `Home Airport - ${homeAirportIcao}${homeAirportName ? ` (${homeAirportName})` : ''}` : 'Home Airport not set'}\n                  </CardTitle>\n                  <CardDescription>\n                    Current conditions and information\n                    {homeWeatherError && <span className=\"ml-2 text-destructive\">{homeWeatherError}</span>}\n                    {homeWeatherLoading && !homeWeatherError && <span className=\"ml-2 text-muted-foreground\">Loadingâ€¦</span>}\n                  </CardDescription>\n                </div>\n                <Badge variant=\"secondary\" className=\"text-xs\">\n                  {homeWeatherUpdatedAt ? `Updated ${new Date(homeWeatherUpdatedAt).toLocaleTimeString()}` : 'â€”'}\n                </Badge>\n              </div>\n            </CardHeader>\n            <CardContent>\n              <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\n                <div className=\"space-y-2\">\n                  <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                    <Cloud className=\"h-4 w-4\" />\n                    Weather\n                  </div>\n                  <div className=\"space-y-1\">\n                    <div className=\"text-2xl font-bold\">\n                      {typeof homeWeather?.temp === 'number'\n                        ? `${Math.round((homeWeather.temp * 9) / 5 + 32)}Â°F`\n                        : 'â€”'}\n                    </div>\n                    <p className=\"text-xs text-muted-foreground\">\n                      {homeWeather?.wxString\n                        || (homeWeather?.clouds?.[0]?.cover && homeWeather?.clouds?.[0]?.base\n                          ? `${homeWeather.clouds[0].cover} clouds at ${homeWeather.clouds[0].base}ft`\n                          : homeWeather?.rawOb || 'No METAR data')}\n                    </p>\n                  </div>\n                </div>\n                \n                <div className=\"space-y-2\">\n                  <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                    <Wind className=\"h-4 w-4\" />\n                    Winds\n                  </div>\n                  <div className=\"space-y-1\">\n                    <div className=\"text-2xl font-bold\">\n                      {homeWeatherLoading\n                        ? 'â€”'\n                        : homeWeather?.windDir && homeWeather?.windSpeed\n                          ? `${homeWeather.windDir}Â° @ ${homeWeather.windSpeed}kt`\n                          : homeWeatherError ? 'â€”' : 'No wind data'}\n                    </div>\n                    <p className=\"text-xs text-muted-foreground\">\n                      {homeWeather?.windGust ? `Gusting to ${homeWeather.windGust}kt` : ' '}\n                    </p>\n                  </div>\n                </div>\n                \n                <div className=\"space-y-2\">\n                  <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                    <Gauge className=\"h-4 w-4\" />\n                    Altimeter\n                  </div>\n                  <div className=\"space-y-1\">\n                    <div className=\"text-2xl font-bold\">\n                      {homeWeather?.altim ? Number(homeWeather.altim).toFixed(2) : 'â€”'}\n                    </div>\n                    <p className=\"text-xs text-muted-foreground\">inHg</p>\n                  </div>\n                </div>\n                \n                <div className=\"space-y-2\">\n                  <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                    <Fuel className=\"h-4 w-4\" />\n                    Fuel Price (100LL)\n                  </div>\n                  <div className=\"space-y-1\">\n                    <div className=\"space-y-1\">\n                      <div className=\"text-2xl font-bold\">\n                        {fuelPriceLoading\n                          ? 'â€”'\n                          : typeof fuelPrice === 'number'\n                            ? `$${fuelPrice.toFixed(2)}`\n                            : 'â€”'}\n                      </div>\n                      <p className=\"text-[11px] text-muted-foreground\">\n                        Airport price {fuelPriceUpdatedAt ? `â€¢ ${new Date(fuelPriceUpdatedAt).toLocaleDateString()}` : 'â€¢ No airport price'}\n                      </p>\n                      <div className=\"text-sm font-medium\">\n                        {communityFuelLoading\n                          ? 'â€”'\n                          : typeof communityFuelPrice === 'number'\n                            ? `$${communityFuelPrice.toFixed(2)}`\n                            : 'â€”'}\n                      </div>\n                      <p className=\"text-[11px] text-muted-foreground\">\n                        Community price {communityFuelUpdatedAt ? `â€¢ ${new Date(communityFuelUpdatedAt).toLocaleDateString()}` : 'â€¢ No community price'}\n                      </p>\n                      {fuelPriceError && <p className=\"text-[11px] text-destructive\">{fuelPriceError}</p>}\n                      {communityFuelError && <p className=\"text-[11px] text-destructive\">{communityFuelError}</p>}\n                    </div>\n                  </div>\n                </div>\n              </div>\n              {!homeAirportIcao && (\n                <div className=\"mt-4 rounded-lg border border-dashed border-border p-3 text-xs text-muted-foreground\">\n                  Set your home airport in your profile to see live METAR data.\n                </div>\n              )}\n            </CardContent>\n          </Card>\n          )}\n\n          {/* Alerts & Important Items */}\n          {isWidgetVisible('quick-alerts') && (\n          <div className=\"grid gap-4 lg:grid-cols-3\">\n            {maintenanceItems.length > 0 && (\n            <Card className=\"border-destructive/50 bg-destructive/5\">\n              <CardHeader className=\"pb-3\">\n                <div className=\"flex items-start justify-between\">\n                  <div className=\"flex items-center gap-2\">\n                    <AlertTriangle className=\"h-5 w-5 text-destructive\" />\n                    <CardTitle className=\"text-base\">Scheduled Maintenance</CardTitle>\n                  </div>\n                  <div className=\"flex items-center gap-1\">\n                    <Button size=\"icon\" variant=\"ghost\" className=\"h-7 w-7\" onClick={() => setShowMaintenanceModal(true)}>\n                      <Search className=\"h-4 w-4\" />\n                    </Button>\n                    <Button size=\"icon\" variant=\"ghost\" className=\"h-7 w-7\" onClick={() => router.push('/modules/flying-club?tab=maintenance')}>\n                      <ExternalLink className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-2\">\n                  {maintenanceLoading ? (\n                    <p className=\"text-xs text-muted-foreground\">Loading maintenanceâ€¦</p>\n                  ) : maintenanceError ? (\n                    <p className=\"text-xs text-destructive\">{maintenanceError}</p>\n                  ) : (\n                    <>\n                      <p className=\"text-sm font-medium\">{maintenanceItems[0]?.description || 'Maintenance needed'}</p>\n                      <p className=\"text-xs text-muted-foreground\">\n                        {maintenanceItems[0]?.nNumber || 'Aircraft'}\n                      </p>\n                    </>\n                  )}\n                  <div className=\"text-xs text-muted-foreground\">\n                    Use the icons above to view details or open full page.\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n            )}\n            \n            <Card className=\"border-chart-3/50 bg-chart-3/5\">\n              <CardHeader className=\"pb-3\">\n                <div className=\"flex items-start justify-between\">\n                  <div className=\"flex items-center gap-2\">\n                    <Clock className=\"h-5 w-5 text-chart-3\" />\n                    <CardTitle className=\"text-base\">Next Flight</CardTitle>\n                  </div>\n                  <div className=\"flex items-center gap-1\">\n                    <Button size=\"icon\" variant=\"ghost\" className=\"h-7 w-7\" onClick={() => setShowNextFlightModal(true)}>\n                      <Search className=\"h-4 w-4\" />\n                    </Button>\n                    <Button size=\"icon\" variant=\"ghost\" className=\"h-7 w-7\" onClick={() => router.push('/modules/flying-club?tab=scheduled')}>\n                      <ExternalLink className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-2\">\n                  {scheduledFlights.length > 0 ? (\n                    <>\n                      <p className=\"text-sm font-medium\">\n                        {scheduledFlights[0]?.aircraft?.nNumber || 'Upcoming flight'}\n                      </p>\n                      <p className=\"text-xs text-muted-foreground\">\n                        {new Date(scheduledFlights[0].startTime).toLocaleString()}\n                      </p>\n                    </>\n                  ) : (\n                    <p className=\"text-xs text-muted-foreground\">No upcoming flights</p>\n                  )}\n                  <div className=\"text-xs text-muted-foreground\">\n                    Use the icons above to view details or open full page.\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card className=\"border-primary/40 bg-primary/5\">\n              <CardHeader className=\"pb-3\">\n                <div className=\"flex items-start justify-between\">\n                  <div className=\"flex items-center gap-2\">\n                    <Mail className=\"h-5 w-5 text-primary\" />\n                    <CardTitle className=\"text-base\">Mechanic Inbox</CardTitle>\n                    {mechanicUnread > 0 && (\n                      <Badge variant=\"destructive\" className=\"text-[10px]\">\n                        {mechanicUnread} new\n                      </Badge>\n                    )}\n                  </div>\n                  <div className=\"flex items-center gap-1\">\n                    <Button size=\"icon\" variant=\"ghost\" className=\"h-7 w-7\" onClick={() => router.push('/mechanics/inbox')}>\n                      <ExternalLink className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-2\">\n                  <p className=\"text-sm\">Review mechanic quotes and messages.</p>\n                  <p className=\"text-xs text-muted-foreground\">Accept or decline responses from mechanics.</p>\n                  <Button size=\"sm\" variant=\"outline\" className=\"w-full\" onClick={() => router.push('/mechanics/inbox')}>\n                    Open Inbox\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Complete Flight Button */}\n            <Card className=\"border-emerald-500/50 bg-emerald-500/10\">\n              <CardHeader className=\"pb-3\">\n                <div className=\"flex items-center gap-2\">\n                  <Plane className=\"h-5 w-5 text-emerald-500\" />\n                  <CardTitle className=\"text-base\">Complete Flight</CardTitle>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-2\">\n                  <p className=\"text-sm\">Just finished flying?</p>\n                  <p className=\"text-xs text-muted-foreground\">Log your flight, add fuel expenses, and report any issues</p>\n                  <Button \n                    size=\"sm\" \n                    className=\"w-full bg-emerald-500 hover:bg-emerald-600\" \n                    onClick={handleOpenFlightComplete}\n                  >\n                    Complete Flight\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n            \n            <Card className=\"border-chart-2/50 bg-chart-2/5\">\n              <CardHeader className=\"pb-3\">\n                <div className=\"flex items-start justify-between\">\n                  <div className=\"flex items-center gap-2\">\n                    <CheckCircle2 className=\"h-5 w-5 text-chart-2\" />\n                    <CardTitle className=\"text-base\">Flight Hours</CardTitle>\n                  </div>\n                  <div className=\"flex items-center gap-1\">\n                    <Button size=\"icon\" variant=\"ghost\" className=\"h-7 w-7\" onClick={() => setShowLogbookModal(true)}>\n                      <Search className=\"h-4 w-4\" />\n                    </Button>\n                    <Button size=\"icon\" variant=\"ghost\" className=\"h-7 w-7\" onClick={() => router.push('/modules/logbook')}>\n                      <ExternalLink className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-2\">\n                  {logbookLoading ? (\n                    <p className=\"text-xs text-muted-foreground\">Loading logbookâ€¦</p>\n                  ) : logbookError ? (\n                    <p className=\"text-xs text-destructive\">{logbookError}</p>\n                  ) : logbookEntries.length > 0 ? (\n                    <>\n                      <p className=\"text-2xl font-bold\">\n                        {Number(logbookEntries[0]?.totalTime || 0).toFixed(1)} hrs\n                      </p>\n                      <p className=\"text-xs text-muted-foreground\">\n                        Last flight on {new Date(logbookEntries[0].date).toLocaleDateString()}\n                      </p>\n                    </>\n                  ) : (\n                    <p className=\"text-xs text-muted-foreground\">No logbook entries</p>\n                  )}\n                  <div className=\"text-xs text-muted-foreground\">\n                    Use the icons above to view details or open full page.\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n          )}\n\n          {/* Flight Hours & Upcoming Items */}\n          <div className=\"grid gap-4 lg:grid-cols-7\">\n            {isWidgetVisible('flight-hours') && (\n            <Card className=\"lg:col-span-4\">\n              <CardHeader>\n                <CardTitle>Flight Hours</CardTitle>\n                <CardDescription>Your flying activity over the past 6 months</CardDescription>\n              </CardHeader>\n              <CardContent className=\"pl-2\">\n                <div className=\"min-h-[300px]\">\n                  {logbookEntries.length === 0 ? (\n                    <div className=\"flex h-[300px] flex-col items-center justify-center gap-3 rounded-lg border border-dashed border-border text-sm text-muted-foreground\">\n                      <span>No flying? :( schedule now!</span>\n                      <Button size=\"sm\" variant=\"outline\" onClick={() => setShowScheduler(true)}>\n                        Open Scheduler\n                      </Button>\n                    </div>\n                  ) : (\n                    <ResponsiveContainer width=\"100%\" height={300}>\n                      <AreaChart data={flightHoursData}>\n                        <defs>\n                          <linearGradient id=\"colorHours\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                            <stop offset=\"5%\" stopColor=\"#3b82f6\" stopOpacity={0.4}/>\n                            <stop offset=\"95%\" stopColor=\"#3b82f6\" stopOpacity={0.05}/>\n                          </linearGradient>\n                        </defs>\n                        <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#334155\" opacity={0.3} />\n                        <XAxis \n                          dataKey=\"month\" \n                          tick={{ fill: '#94a3b8', fontSize: 12 }}\n                          stroke=\"#475569\"\n                        />\n                        <YAxis \n                          tick={{ fill: '#94a3b8', fontSize: 12 }}\n                          stroke=\"#475569\"\n                          label={{ value: 'Hours', angle: -90, position: 'insideLeft', fill: '#94a3b8' }}\n                        />\n                        <RechartsTooltip \n                          contentStyle={{ \n                            backgroundColor: '#1e293b',\n                            border: '1px solid #334155',\n                            borderRadius: '8px',\n                            color: '#f1f5f9'\n                          }}\n                        />\n                        <Area \n                          type=\"monotone\" \n                          dataKey=\"hours\" \n                          stroke=\"#3b82f6\" \n                          strokeWidth={2}\n                          fillOpacity={1} \n                          fill=\"url(#colorHours)\" \n                        />\n                      </AreaChart>\n                    </ResponsiveContainer>\n                  )}\n                </div>\n                {logbookEntries.length > 0 && (\n                  <div className=\"mt-4 flex items-center justify-between rounded-lg bg-muted/50 p-4\">\n                    <div>\n                      <p className=\"text-sm text-muted-foreground\">Total Hours (Last 6 months)</p>\n                      <p className=\"text-2xl font-bold\">\n                        {flightHoursData.reduce((sum: number, item: any) => sum + Number(item.hours || 0), 0).toFixed(1)} hrs\n                      </p>\n                    </div>\n                    <div>\n                      <p className=\"text-sm text-muted-foreground\">Average per Month</p>\n                      <p className=\"text-2xl font-bold\">\n                        {(flightHoursData.reduce((sum: number, item: any) => sum + Number(item.hours || 0), 0) / Math.max(flightHoursData.length, 1)).toFixed(1)} hrs\n                      </p>\n                    </div>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n            )}\n\n            {isWidgetVisible('upcoming-flights') && (\n            <Card className=\"lg:col-span-3\">\n              <CardHeader>\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <CardTitle>Upcoming Flights</CardTitle>\n                    <CardDescription>\n                      Your schedule\n                      {scheduledError && <span className=\"ml-2 text-destructive\">{scheduledError}</span>}\n                      {isScheduledLoading && !scheduledError && <span className=\"ml-2 text-muted-foreground\">Loadingâ€¦</span>}\n                    </CardDescription>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <select\n                      className=\"h-8 rounded-md border border-input bg-background px-2 text-xs\"\n                      value={scheduledWindow}\n                      onChange={(e) => setScheduledWindow(e.target.value as '7' | '30' | 'all')}\n                    >\n                      <option value=\"7\">Next 7 days</option>\n                      <option value=\"30\">Next 30 days</option>\n                      <option value=\"all\">All upcoming</option>\n                    </select>\n                    <Button size=\"sm\" variant=\"outline\" onClick={() => setShowScheduler(true)}>\n                      <Plus className=\"mr-1 h-4 w-4\" />\n                      Add\n                    </Button>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4\">\n                  {scheduledFlights.length === 0 && !isScheduledLoading ? (\n                    <div className=\"rounded-lg border border-dashed border-border p-4 text-sm text-muted-foreground\">\n                      No upcoming flights scheduled\n                    </div>\n                  ) : (\n                    scheduledFlights.map((flight) => (\n                      <div key={flight.id} className=\"space-y-2 rounded-lg border border-border p-3\">\n                        <div className=\"flex items-start justify-between\">\n                          <div className=\"flex items-center gap-2\">\n                            <Plane className=\"h-4 w-4 text-chart-2\" />\n                            <div>\n                              <p className=\"text-sm font-medium leading-none\">\n                                {flight.aircraft?.nNumber || 'Aircraft'}\n                                {flight.aircraft?.nickname ? ` (${flight.aircraft.nickname})` : ''}\n                              </p>\n                              <p className=\"mt-1 text-xs text-muted-foreground\">{flight.purpose || 'Scheduled flight'}</p>\n                            </div>\n                          </div>\n                          <Badge variant=\"outline\" className=\"text-[10px]\">\n                            {flight.groupName ? `Club: ${flight.groupName}` : 'Personal'}\n                          </Badge>\n                        </div>\n                        <div className=\"flex items-center gap-4 text-xs text-muted-foreground\">\n                          <div className=\"flex items-center gap-1\">\n                            <Calendar className=\"h-3 w-3\" />\n                            {new Date(flight.startTime).toLocaleDateString()}\n                          </div>\n                          <div className=\"flex items-center gap-1\">\n                            <Clock className=\"h-3 w-3\" />\n                            {new Date(flight.startTime).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\n                            {' â€“ '}\n                            {new Date(flight.endTime).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\n                          </div>\n                        </div>\n                        <Badge variant=\"outline\" className=\"text-xs\">{flight.aircraft?.nNumber || 'Aircraft'}</Badge>\n                      </div>\n                    ))\n                  )}\n                </div>\n              </CardContent>\n            </Card>\n            )}\n          </div>\n\n          <Dialog open={showScheduler} onOpenChange={setShowScheduler}>\n            <DialogContent>\n              <DialogHeader>\n                <DialogTitle>Schedule a Flight</DialogTitle>\n                <DialogDescription>\n                  Choose personal or flying club scheduling. Availability updates automatically.\n                </DialogDescription>\n              </DialogHeader>\n              <FlightScheduler onSuccess={() => {\n                setShowScheduler(false)\n                setScheduledRefreshKey((prev) => prev + 1)\n              }} />\n            </DialogContent>\n          </Dialog>\n\n          {maintenanceItems.length > 0 && (\n          <Dialog open={showMaintenanceModal} onOpenChange={setShowMaintenanceModal}>\n            <DialogContent>\n              <DialogHeader>\n                <DialogTitle>Scheduled Maintenance</DialogTitle>\n                <DialogDescription>Review scheduled maintenance items.</DialogDescription>\n              </DialogHeader>\n              <div className=\"space-y-3\">\n                {maintenanceLoading ? (\n                  <p className=\"text-sm text-muted-foreground\">Loading maintenanceâ€¦</p>\n                ) : maintenanceError ? (\n                  <p className=\"text-sm text-destructive\">{maintenanceError}</p>\n                ) : maintenanceItems.length === 0 ? (\n                  <p className=\"text-sm text-muted-foreground\">No urgent maintenance items.</p>\n                ) : (\n                  maintenanceItems.slice(0, 5).map((item) => (\n                    <div key={item.id} className=\"rounded-md border border-border p-3\">\n                      <div className=\"flex items-center justify-between\">\n                        <div>\n                          <p className=\"text-sm font-medium\">{item.description || 'Maintenance item'}</p>\n                          <p className=\"text-xs text-muted-foreground\">{item.nNumber || 'Aircraft'}</p>\n                        </div>\n                        <Badge variant=\"outline\" className=\"text-[10px]\">{item.status || 'NEEDED'}</Badge>\n                      </div>\n                    </div>\n                  ))\n                )}\n              </div>\n            </DialogContent>\n          </Dialog>\n          )}\n\n          <Dialog open={showNextFlightModal} onOpenChange={setShowNextFlightModal}>\n            <DialogContent>\n              <DialogHeader>\n                <DialogTitle>Next Flight</DialogTitle>\n                <DialogDescription>Review your upcoming flight details.</DialogDescription>\n              </DialogHeader>\n              <div className=\"space-y-3\">\n                {scheduledFlights.length === 0 ? (\n                  <p className=\"text-sm text-muted-foreground\">No upcoming flights scheduled.</p>\n                ) : (\n                  scheduledFlights.slice(0, 5).map((flight) => (\n                    <div key={flight.id} className=\"rounded-md border border-border p-3\">\n                      <div className=\"flex items-center justify-between\">\n                        <div>\n                          <p className=\"text-sm font-medium\">\n                            {flight.aircraft?.nNumber || 'Aircraft'}\n                          </p>\n                          <p className=\"text-xs text-muted-foreground\">\n                            {new Date(flight.startTime).toLocaleString()} â€” {new Date(flight.endTime).toLocaleString()}\n                          </p>\n                        </div>\n                        <Badge variant=\"outline\" className=\"text-[10px]\">\n                          {flight.groupName ? `Club: ${flight.groupName}` : 'Personal'}\n                        </Badge>\n                      </div>\n                    </div>\n                  ))\n                )}\n              </div>\n            </DialogContent>\n          </Dialog>\n\n          <Dialog open={showLogbookModal} onOpenChange={setShowLogbookModal}>\n            <DialogContent>\n              <DialogHeader>\n                <DialogTitle>Logbook</DialogTitle>\n                <DialogDescription>Recent logbook entries.</DialogDescription>\n              </DialogHeader>\n              <div className=\"space-y-3\">\n                {logbookLoading ? (\n                  <p className=\"text-sm text-muted-foreground\">Loading logbookâ€¦</p>\n                ) : logbookError ? (\n                  <p className=\"text-sm text-destructive\">{logbookError}</p>\n                ) : logbookEntries.length === 0 ? (\n                  <p className=\"text-sm text-muted-foreground\">No logbook entries yet.</p>\n                ) : (\n                  logbookEntries.slice(0, 5).map((entry) => (\n                    <div key={entry.id} className=\"rounded-md border border-border p-3\">\n                      <div className=\"flex items-center justify-between\">\n                        <div>\n                          <p className=\"text-sm font-medium\">\n                            {entry.aircraft || 'Flight'}\n                          </p>\n                          <p className=\"text-xs text-muted-foreground\">\n                            {new Date(entry.date).toLocaleDateString()} â€¢ {Number(entry.totalTime || 0).toFixed(1)} hrs\n                          </p>\n                        </div>\n                        <Badge variant=\"outline\" className=\"text-[10px]\">Logbook</Badge>\n                      </div>\n                    </div>\n                  ))\n                )}\n              </div>\n            </DialogContent>\n          </Dialog>\n\n          {/* Maintenance & Currency */}\n          <div className=\"grid gap-4 lg:grid-cols-2\">\n            {isWidgetVisible('maintenance') && (\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <CardTitle>Aircraft Maintenance</CardTitle>\n                    <CardDescription>Due items for N12345</CardDescription>\n                  </div>\n                  <Button size=\"sm\" variant=\"outline\" onClick={() => router.push('/modules/flying-club?tab=maintenance')}>\n                    <Wrench className=\"mr-1 h-4 w-4\" />\n                    Manage\n                  </Button>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-3\">\n                  {maintenanceItems.map((item, index) => (\n                    <div key={item.id}>\n                      <div className=\"space-y-2 rounded-lg border border-border p-3\">\n                        <div className=\"flex items-start justify-between\">\n                          <div className=\"flex-1\">\n                            <div className=\"flex items-center gap-2\">\n                              <p className=\"text-sm font-medium\">{item.item}</p>\n                              <Badge variant=\"outline\" className={item.maintenanceType === 'CLUB' ? 'border-blue-500/50 text-blue-600 text-xs' : 'border-purple-500/50 text-purple-600 text-xs'}>\n                                {item.maintenanceType === 'CLUB' ? 'Club' : 'Personal'}\n                              </Badge>\n                              <Badge \n                                variant={item.status === 'urgent' ? 'destructive' : item.status === 'warning' ? 'default' : 'secondary'}\n                                className=\"text-xs\"\n                              >\n                                {item.status === 'urgent' ? 'Urgent' : item.status === 'warning' ? 'Soon' : 'OK'}\n                              </Badge>\n                            </div>\n                            <p className=\"mt-1 text-xs text-muted-foreground\">Due: {item.dueDate}</p>\n                          </div>\n                        </div>\n                        <div className=\"flex items-center justify-between\">\n                          <p className=\"text-xs text-muted-foreground\">\n                            {typeof item.hoursRemaining === 'number'\n                              ? `${item.hoursRemaining.toFixed(1)} hours remaining`\n                              : 'Hours remaining unavailable'}\n                          </p>\n                          <Button size=\"sm\" variant=\"ghost\" className=\"h-7 text-xs\" onClick={() => router.push('/modules/flying-club?tab=maintenance')}>\n                            Details\n                            <ArrowRight className=\"ml-1 h-3 w-3\" />\n                          </Button>\n                        </div>\n                      </div>\n                      {index < maintenanceItems.length - 1 && <Separator className=\"my-3\" />}\n                    </div>\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n            )}\n\n            {isWidgetVisible('currency') && (\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <CardTitle>Currency & Licenses</CardTitle>\n                    <CardDescription>Keep your credentials current</CardDescription>\n                  </div>\n                  <Button size=\"sm\" variant=\"outline\" onClick={() => router.push('/profile')}>\n                    <FileText className=\"mr-1 h-4 w-4\" />\n                    View All\n                  </Button>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-3\">\n                  {currencyItems.map((item, index) => (\n                    <div key={item.id}>\n                      <div className=\"space-y-2 rounded-lg border border-border p-3\">\n                        <div className=\"flex items-start justify-between\">\n                          <div className=\"flex-1\">\n                            <div className=\"flex items-center gap-2\">\n                              <p className=\"text-sm font-medium\">{item.type}</p>\n                              <Badge \n                                variant={item.status === 'warning' ? 'default' : 'secondary'}\n                                className=\"text-xs\"\n                              >\n                                {item.status === 'warning' ? 'Expiring Soon' : 'Current'}\n                              </Badge>\n                            </div>\n                            {item.class && <p className=\"mt-1 text-xs text-muted-foreground\">{item.class}</p>}\n                            {item.requirement && <p className=\"mt-1 text-xs text-muted-foreground\">{item.requirement}</p>}\n                          </div>\n                        </div>\n                        <div className=\"flex items-center justify-between\">\n                          <p className=\"text-xs text-muted-foreground\">Expires: {item.expiryDate} ({item.daysRemaining} days)</p>\n                          <Button size=\"sm\" variant=\"ghost\" className=\"h-7 text-xs\" onClick={() => router.push('/profile')}>\n                            Renew\n                            <ArrowRight className=\"ml-1 h-3 w-3\" />\n                          </Button>\n                        </div>\n                      </div>\n                      {index < currencyItems.length - 1 && <Separator className=\"my-3\" />}\n                    </div>\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n            )}\n          </div>\n\n          {/* Saved Flight Plans */}\n          {isWidgetVisible('flight-plans') && (\n          <Card>\n            <CardHeader>\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <CardTitle>Saved Flight Plans</CardTitle>\n                    <CardDescription>Quick access to your routes</CardDescription>\n                  </div>\n                  <Button size=\"sm\" variant=\"default\" onClick={() => router.push('/modules/fuel-saver')}>\n                    <Plus className=\"mr-1 h-4 w-4\" />\n                    New Plan\n                  </Button>\n                </div>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-3\">\n                {savedFlightPlans.map((plan) => (\n                  <div key={plan.id} className=\"flex items-center justify-between rounded-lg border border-border p-4 transition-colors hover:bg-muted/50\">\n                    <div className=\"flex items-start gap-3\">\n                      <div className=\"mt-1 rounded-lg bg-primary/10 p-2\">\n                        <Navigation className=\"h-5 w-5 text-primary\" />\n                      </div>\n                      <div className=\"space-y-1\">\n                        <p className=\"text-sm font-medium leading-none\">{plan.name}</p>\n                        <div className=\"flex items-center gap-4 text-xs text-muted-foreground\">\n                          <span>{plan.distance} nm</span>\n                          <span>{plan.duration}</span>\n                          <span>{plan.route}</span>\n                        </div>\n                        <p className=\"text-xs text-muted-foreground\">Updated {plan.lastUpdated}</p>\n                      </div>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      <Button size=\"sm\" variant=\"ghost\" onClick={() => router.push(`/modules/fuel-saver/view/${plan.id}`)}>\n                        <Eye className=\"h-4 w-4\" />\n                      </Button>\n                      <Button size=\"sm\" variant=\"ghost\" onClick={() => router.push(`/modules/fuel-saver?edit=${plan.id}`)}>\n                        <Edit className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n          )}\n        </div>\n\n        {/* Flight Completion Wizard */}\n          {activeFlight && (\n            <FlightCompleteWizard\n              open={showFlightComplete}\n              onOpenChange={setShowFlightComplete}\n              flight={activeFlight}\n              onComplete={async (data) => {\n                if (!groupId) {\n                  alert('Please join or select a flying club to complete a flight')\n                  return\n                }\n\n                try {\n                  const res = await fetch(`/api/clubs/${groupId}/flights/complete`, {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({\n                      flightLogId: data.flightId,\n                      hobbsEnd: data.hobbsEnd,\n                      notes: data.notes || null,\n                    }),\n                  })\n\n                  if (!res.ok) {\n                    const error = await res.json()\n                    alert(error.error || 'Failed to complete flight')\n                    return\n                  }\n\n                  const result = await res.json()\n                  const flight = result.flight\n                  if (flight?.hobbsTime && flight?.calculatedCost) {\n                    alert(`Flight complete! Hobbs: ${Number(flight.hobbsTime).toFixed(1)}, Cost: $${Number(flight.calculatedCost).toFixed(2)}`)\n                  } else {\n                    alert('Flight complete!')\n                  }\n                  setActiveFlight(null)\n                } catch (error) {\n                  console.error('Failed to complete flight', error)\n                  alert('Failed to complete flight')\n                }\n              }}\n            />\n          )}\n      </main>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\data-status\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\data-status\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\faq\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Plane' is defined but never used.","line":4,"column":46,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":51,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Plane"},"fix":{"range":[92,99],"text":""},"desc":"Remove unused variable \"Plane\"."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":108,"column":16,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[5519,5604],"text":"\n            Can&apos;t find the answer you're looking for? We're here to help.\n          "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[5519,5604],"text":"\n            Can&lsquo;t find the answer you're looking for? We're here to help.\n          "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[5519,5604],"text":"\n            Can&#39;t find the answer you're looking for? We're here to help.\n          "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[5519,5604],"text":"\n            Can&rsquo;t find the answer you're looking for? We're here to help.\n          "},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":108,"column":38,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[5519,5604],"text":"\n            Can't find the answer you&apos;re looking for? We're here to help.\n          "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[5519,5604],"text":"\n            Can't find the answer you&lsquo;re looking for? We're here to help.\n          "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[5519,5604],"text":"\n            Can't find the answer you&#39;re looking for? We're here to help.\n          "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[5519,5604],"text":"\n            Can't find the answer you&rsquo;re looking for? We're here to help.\n          "},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":108,"column":57,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[5519,5604],"text":"\n            Can't find the answer you're looking for? We&apos;re here to help.\n          "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[5519,5604],"text":"\n            Can't find the answer you're looking for? We&lsquo;re here to help.\n          "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[5519,5604],"text":"\n            Can't find the answer you're looking for? We&#39;re here to help.\n          "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[5519,5604],"text":"\n            Can't find the answer you're looking for? We&rsquo;re here to help.\n          "},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"@next/next/no-html-link-for-pages","severity":2,"message":"Do not use an `<a>` element to navigate to `/`. Use `<Link />` from `next/link` instead. See: https://nextjs.org/docs/messages/no-html-link-for-pages","line":120,"column":11,"nodeType":"JSXOpeningElement","endLine":120,"endColumn":87}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState } from 'react';\nimport { ChevronDown, ChevronUp, HelpCircle, Plane, Mail } from 'lucide-react';\n\nconst faqs = [\n  {\n    question: \"What is AviationHub?\",\n    answer: \"AviationHub is a comprehensive flight planning and management platform designed for pilots. It provides tools for route planning, fuel tracking, aircraft management, flight logging, and more.\"\n  },\n  {\n    question: \"Is AviationHub free to use?\",\n    answer: \"AviationHub offers both free and premium tiers. The free tier includes basic flight planning features, while Pro members get access to advanced features like real-time fuel prices, weather overlays, and unlimited flight logging.\"\n  },\n  {\n    question: \"How do I create a flight plan?\",\n    answer: \"Navigate to the Flight Planner module, search for your departure and arrival airports, add them to your route, and customize settings like cruise altitude and aircraft type. You can then save or export your flight plan.\"\n  },\n  {\n    question: \"Can I import flight plans from other apps?\",\n    answer: \"Yes! AviationHub supports importing flight plans in GPX, FPL, and JSON formats from popular apps like ForeFlight, Garmin Pilot, and flightplandatabase.com.\"\n  },\n  {\n    question: \"How do I track my flight hours?\",\n    answer: \"Use the Logbook module to log your flights manually, or connect your account to sync with supported flight tracking services. All logged hours are automatically saved and can be exported for FAA record-keeping.\"\n  },\n  {\n    question: \"What aircraft types are supported?\",\n    answer: \"AviationHub supports a wide variety of general aviation aircraft including Cessna, Piper, Diamond, Cirrus, and Beechcraft models. You can also create custom aircraft profiles with specific performance data.\"\n  },\n  {\n    question: \"How accurate are the fuel prices?\",\n    answer: \"Fuel prices are sourced from multiple providers and updated regularly. However, we always recommend verifying fuel prices with official FBO sources before your flight, as prices can change frequently.\"\n  },\n  {\n    question: \"Can I use AviationHub offline?\",\n    answer: \"Some features like saved flight plans and aircraft profiles work offline. However, features requiring live data (weather, fuel prices, NOTAMs) need an active internet connection.\"\n  },\n  {\n    question: \"How do I join a Flying Club?\",\n    answer: \"Flying Clubs can invite members via email. If you've received an invitation, check your email for a signup link, or ask the club administrator to send you an invite.\"\n  },\n  {\n    question: \"Is my data secure?\",\n    answer: \"Yes, we take data security seriously. All data is encrypted in transit and at rest. We never share your personal flight data with third parties without your explicit consent.\"\n  },\n  {\n    question: \"How do I report a bug or request a feature?\",\n    answer: \"Go to the Support page to submit a bug report or feature request. You can also email us directly at support@aviationhub.com.\"\n  },\n  {\n    question: \"What's the difference between Free and Pro?\",\n    answer: \"Pro members get: unlimited flight logging, real-time fuel prices, weather overlays on maps, priority support, and early access to new features. Free users get essential flight planning tools with basic functionality.\"\n  }\n];\n\nexport default function FAQPage() {\n  const [openIndex, setOpenIndex] = useState<number | null>(0);\n\n  return (\n    <div className=\"min-h-screen bg-background text-foreground p-4 md:p-8\">\n      <div className=\"max-w-3xl mx-auto\">\n        {/* Header */}\n        <div className=\"text-center mb-12\">\n          <div className=\"inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-primary/10 mb-4\">\n            <HelpCircle className=\"w-8 h-8 text-primary\" />\n          </div>\n          <h1 className=\"text-3xl font-bold\">Frequently Asked Questions</h1>\n          <p className=\"mt-2 text-muted-foreground\">\n            Find answers to common questions about AviationHub\n          </p>\n        </div>\n\n        {/* FAQ List */}\n        <div className=\"space-y-3\">\n          {faqs.map((faq, index) => (\n            <div\n              key={index}\n              className=\"rounded-xl border border-border bg-card overflow-hidden\"\n            >\n              <button\n                onClick={() => setOpenIndex(openIndex === index ? null : index)}\n                className=\"w-full flex items-center justify-between p-4 text-left hover:bg-muted/50 transition-colors\"\n              >\n                <span className=\"font-medium pr-4\">{faq.question}</span>\n                {openIndex === index ? (\n                  <ChevronUp className=\"w-5 h-5 text-muted-foreground flex-shrink-0\" />\n                ) : (\n                  <ChevronDown className=\"w-5 h-5 text-muted-foreground flex-shrink-0\" />\n                )}\n              </button>\n              {openIndex === index && (\n                <div className=\"px-4 pb-4 pt-0\">\n                  <p className=\"text-muted-foreground\">{faq.answer}</p>\n                </div>\n              )}\n            </div>\n          ))}\n        </div>\n\n        {/* Contact Section */}\n        <div className=\"mt-12 rounded-2xl border border-border bg-card p-6 text-center\">\n          <div className=\"inline-flex items-center justify-center w-12 h-12 rounded-xl bg-primary/10 mb-4\">\n            <Mail className=\"w-6 h-6 text-primary\" />\n          </div>\n          <h2 className=\"text-lg font-semibold\">Still have questions?</h2>\n          <p className=\"mt-1 text-muted-foreground mb-4\">\n            Can't find the answer you're looking for? We're here to help.\n          </p>\n          <a\n            href=\"/support\"\n            className=\"inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-primary text-primary-foreground hover:bg-primary/90 transition-colors\"\n          >\n            Contact Support\n          </a>\n        </div>\n\n        {/* Back to Home */}\n        <div className=\"mt-8 text-center\">\n          <a href=\"/\" className=\"text-sm text-muted-foreground hover:text-foreground\">\n            â† Back to Home\n          </a>\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\flying-club\\admin\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\flying-club\\admin\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Separator' is defined but never used.","line":9,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":19,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Separator"},"fix":{"range":[346,400],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CheckCircle2' is defined but never used.","line":12,"column":59,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":71,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"CheckCircle2"},"fix":{"range":[574,588],"text":""},"desc":"Remove unused variable \"CheckCircle2\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Settings' is defined but never used.","line":13,"column":41,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":49,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Settings"},"fix":{"range":[628,638],"text":""},"desc":"Remove unused variable \"Settings\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FileText' is defined but never used.","line":14,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":21,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"FileText"},"fix":{"range":[664,674],"text":""},"desc":"Remove unused variable \"FileText\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'BarChart3' is defined but never used.","line":14,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":32,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"BarChart3"},"fix":{"range":[674,685],"text":""},"desc":"Remove unused variable \"BarChart3\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'BookOpen' is defined but never used.","line":14,"column":34,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":42,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"BookOpen"},"fix":{"range":[685,695],"text":""},"desc":"Remove unused variable \"BookOpen\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CreditCard' is defined but never used.","line":14,"column":58,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":68,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"CreditCard"},"fix":{"range":[709,721],"text":""},"desc":"Remove unused variable \"CreditCard\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'UserX' is defined but never used.","line":15,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":19,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"UserX"},"fix":{"range":[734,741],"text":""},"desc":"Remove unused variable \"UserX\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ToggleLeft' is defined but never used.","line":15,"column":21,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":31,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"ToggleLeft"},"fix":{"range":[741,753],"text":""},"desc":"Remove unused variable \"ToggleLeft\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Megaphone' is defined but never used.","line":15,"column":33,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":42,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Megaphone"},"fix":{"range":[753,764],"text":""},"desc":"Remove unused variable \"Megaphone\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Lock' is defined but never used.","line":15,"column":44,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":48,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Lock"},"fix":{"range":[764,770],"text":""},"desc":"Remove unused variable \"Lock\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Sliders' is defined but never used.","line":15,"column":50,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":57,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Sliders"},"fix":{"range":[770,779],"text":""},"desc":"Remove unused variable \"Sliders\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Mail' is defined but never used.","line":15,"column":59,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":63,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Mail"},"fix":{"range":[779,785],"text":""},"desc":"Remove unused variable \"Mail\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'RefreshCw' is defined but never used.","line":16,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":12,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"RefreshCw"},"fix":{"range":[785,798],"text":""},"desc":"Remove unused variable \"RefreshCw\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MoreHorizontal' is defined but never used.","line":16,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":28,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"MoreHorizontal"},"fix":{"range":[798,814],"text":""},"desc":"Remove unused variable \"MoreHorizontal\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrendingDown' is defined but never used.","line":16,"column":42,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":54,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"TrendingDown"},"fix":{"range":[826,840],"text":""},"desc":"Remove unused variable \"TrendingDown\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Activity' is defined but never used.","line":16,"column":56,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":64,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Activity"},"fix":{"range":[840,850],"text":""},"desc":"Remove unused variable \"Activity\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'mockMaintenance' is assigned a value but never used.","line":66,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":66,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'session' is assigned a value but never used.","line":272,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":272,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":278,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":278,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15429,15432],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15429,15432],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":284,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":284,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15698,15701],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15698,15701],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":285,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":285,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15761,15764],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15761,15764],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":286,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":286,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15841,15844],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15841,15844],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":287,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":287,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15917,15920],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15917,15920],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":288,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":288,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15989,15992],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15989,15992],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":289,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":289,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16054,16057],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16054,16057],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":290,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":290,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16125,16128],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16125,16128],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":291,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":291,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16218,16221],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16218,16221],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":292,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":292,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16333,16336],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16333,16336],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":292,"column":113,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":292,"endColumn":116,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16367,16370],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16367,16370],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":329,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":329,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17871,17874],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17871,17874],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":339,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":339,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18266,18269],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18266,18269],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":384,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":384,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19422,19425],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19422,19425],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1210,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1210,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[54526,54529],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[54526,54529],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1210,"column":86,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1210,"endColumn":89,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[54563,54566],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[54563,54566],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1242,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1242,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[56311,56314],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[56311,56314],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1242,"column":96,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1242,"endColumn":99,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[56359,56362],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[56359,56362],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1252,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1252,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[56884,56887],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[56884,56887],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1262,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1262,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[57412,57415],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[57412,57415],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1262,"column":107,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1262,"endColumn":110,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[57460,57463],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[57460,57463],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1262,"column":158,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1262,"endColumn":161,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[57511,57514],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[57511,57514],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":1292,"column":74,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[58963,58964],"text":"&quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[58963,58964],"text":"&ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[58963,58964],"text":"&#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[58963,58964],"text":"&rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":1292,"column":88,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[58977,58978],"text":"&quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[58977,58978],"text":"&ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[58977,58978],"text":"&#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[58977,58978],"text":"&rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":1704,"column":99,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[81365,81784],"text":"\n                        When pilots report issues during flight completion, they can mark them as &quot;Plane-Specific\" (affecting only that aircraft) \n                        or \"Generic\" (could apply to any aircraft). Plane-specific issues require admin review and may generate work orders. \n                        Generic issues are logged for general tracking but don't require immediate action.\n                      "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[81365,81784],"text":"\n                        When pilots report issues during flight completion, they can mark them as &ldquo;Plane-Specific\" (affecting only that aircraft) \n                        or \"Generic\" (could apply to any aircraft). Plane-specific issues require admin review and may generate work orders. \n                        Generic issues are logged for general tracking but don't require immediate action.\n                      "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[81365,81784],"text":"\n                        When pilots report issues during flight completion, they can mark them as &#34;Plane-Specific\" (affecting only that aircraft) \n                        or \"Generic\" (could apply to any aircraft). Plane-specific issues require admin review and may generate work orders. \n                        Generic issues are logged for general tracking but don't require immediate action.\n                      "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[81365,81784],"text":"\n                        When pilots report issues during flight completion, they can mark them as &rdquo;Plane-Specific\" (affecting only that aircraft) \n                        or \"Generic\" (could apply to any aircraft). Plane-specific issues require admin review and may generate work orders. \n                        Generic issues are logged for general tracking but don't require immediate action.\n                      "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":1704,"column":114,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[81365,81784],"text":"\n                        When pilots report issues during flight completion, they can mark them as \"Plane-Specific&quot; (affecting only that aircraft) \n                        or \"Generic\" (could apply to any aircraft). Plane-specific issues require admin review and may generate work orders. \n                        Generic issues are logged for general tracking but don't require immediate action.\n                      "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[81365,81784],"text":"\n                        When pilots report issues during flight completion, they can mark them as \"Plane-Specific&ldquo; (affecting only that aircraft) \n                        or \"Generic\" (could apply to any aircraft). Plane-specific issues require admin review and may generate work orders. \n                        Generic issues are logged for general tracking but don't require immediate action.\n                      "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[81365,81784],"text":"\n                        When pilots report issues during flight completion, they can mark them as \"Plane-Specific&#34; (affecting only that aircraft) \n                        or \"Generic\" (could apply to any aircraft). Plane-specific issues require admin review and may generate work orders. \n                        Generic issues are logged for general tracking but don't require immediate action.\n                      "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[81365,81784],"text":"\n                        When pilots report issues during flight completion, they can mark them as \"Plane-Specific&rdquo; (affecting only that aircraft) \n                        or \"Generic\" (could apply to any aircraft). Plane-specific issues require admin review and may generate work orders. \n                        Generic issues are logged for general tracking but don't require immediate action.\n                      "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":1705,"column":28,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[81365,81784],"text":"\n                        When pilots report issues during flight completion, they can mark them as \"Plane-Specific\" (affecting only that aircraft) \n                        or &quot;Generic\" (could apply to any aircraft). Plane-specific issues require admin review and may generate work orders. \n                        Generic issues are logged for general tracking but don't require immediate action.\n                      "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[81365,81784],"text":"\n                        When pilots report issues during flight completion, they can mark them as \"Plane-Specific\" (affecting only that aircraft) \n                        or &ldquo;Generic\" (could apply to any aircraft). Plane-specific issues require admin review and may generate work orders. \n                        Generic issues are logged for general tracking but don't require immediate action.\n                      "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[81365,81784],"text":"\n                        When pilots report issues during flight completion, they can mark them as \"Plane-Specific\" (affecting only that aircraft) \n                        or &#34;Generic\" (could apply to any aircraft). Plane-specific issues require admin review and may generate work orders. \n                        Generic issues are logged for general tracking but don't require immediate action.\n                      "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[81365,81784],"text":"\n                        When pilots report issues during flight completion, they can mark them as \"Plane-Specific\" (affecting only that aircraft) \n                        or &rdquo;Generic\" (could apply to any aircraft). Plane-specific issues require admin review and may generate work orders. \n                        Generic issues are logged for general tracking but don't require immediate action.\n                      "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":1705,"column":36,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[81365,81784],"text":"\n                        When pilots report issues during flight completion, they can mark them as \"Plane-Specific\" (affecting only that aircraft) \n                        or \"Generic&quot; (could apply to any aircraft). Plane-specific issues require admin review and may generate work orders. \n                        Generic issues are logged for general tracking but don't require immediate action.\n                      "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[81365,81784],"text":"\n                        When pilots report issues during flight completion, they can mark them as \"Plane-Specific\" (affecting only that aircraft) \n                        or \"Generic&ldquo; (could apply to any aircraft). Plane-specific issues require admin review and may generate work orders. \n                        Generic issues are logged for general tracking but don't require immediate action.\n                      "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[81365,81784],"text":"\n                        When pilots report issues during flight completion, they can mark them as \"Plane-Specific\" (affecting only that aircraft) \n                        or \"Generic&#34; (could apply to any aircraft). Plane-specific issues require admin review and may generate work orders. \n                        Generic issues are logged for general tracking but don't require immediate action.\n                      "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[81365,81784],"text":"\n                        When pilots report issues during flight completion, they can mark them as \"Plane-Specific\" (affecting only that aircraft) \n                        or \"Generic&rdquo; (could apply to any aircraft). Plane-specific issues require admin review and may generate work orders. \n                        Generic issues are logged for general tracking but don't require immediate action.\n                      "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":1706,"column":79,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[81365,81784],"text":"\n                        When pilots report issues during flight completion, they can mark them as \"Plane-Specific\" (affecting only that aircraft) \n                        or \"Generic\" (could apply to any aircraft). Plane-specific issues require admin review and may generate work orders. \n                        Generic issues are logged for general tracking but don&apos;t require immediate action.\n                      "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[81365,81784],"text":"\n                        When pilots report issues during flight completion, they can mark them as \"Plane-Specific\" (affecting only that aircraft) \n                        or \"Generic\" (could apply to any aircraft). Plane-specific issues require admin review and may generate work orders. \n                        Generic issues are logged for general tracking but don&lsquo;t require immediate action.\n                      "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[81365,81784],"text":"\n                        When pilots report issues during flight completion, they can mark them as \"Plane-Specific\" (affecting only that aircraft) \n                        or \"Generic\" (could apply to any aircraft). Plane-specific issues require admin review and may generate work orders. \n                        Generic issues are logged for general tracking but don&#39;t require immediate action.\n                      "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[81365,81784],"text":"\n                        When pilots report issues during flight completion, they can mark them as \"Plane-Specific\" (affecting only that aircraft) \n                        or \"Generic\" (could apply to any aircraft). Plane-specific issues require admin review and may generate work orders. \n                        Generic issues are logged for general tracking but don&rsquo;t require immediate action.\n                      "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":29,"fatalErrorCount":0,"warningCount":19,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { useSession } from 'next-auth/react'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\"\nimport { Badge } from \"@/components/ui/badge\"\nimport { Button } from \"@/components/ui/button\"\nimport { Progress } from \"@/components/ui/progress\"\nimport { Separator } from \"@/components/ui/separator\"\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle } from \"@/components/ui/dialog\"\nimport {\n  Plane, Users, Wrench, DollarSign, Clock, AlertTriangle, CheckCircle2,\n  ChevronRight, Search, Download, Plus, Settings, Bell, Shield,\n  Calendar, FileText, BarChart3, BookOpen, Fuel, MapPin, CreditCard,\n  UserCheck, UserX, ToggleLeft, Megaphone, Lock, Sliders, Mail,\n  RefreshCw, MoreHorizontal, TrendingUp, TrendingDown, Activity\n} from \"lucide-react\"\nimport { AreaChart, Area, BarChart, Bar, ResponsiveContainer, XAxis, YAxis, CartesianGrid, Tooltip } from \"recharts\"\n\n// â”€â”€ Mock data (used as fallback until APIs wired) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\nconst mockClub = {\n  name: \"Sky High Flying Club\",\n  icao: \"KBOS\",\n  founded: \"2018\",\n  members: 24,\n  aircraft: 4,\n  plan: \"Pro\",\n}\n\nconst mockMembers = [\n  { id: 1, name: \"James Carter\",    email: \"james@example.com\",  role: \"Owner\",   status: \"Active\",    hours: 412.3, balance: 0,     joined: \"Jan 2020\", medical: \"May 2025\" },\n  { id: 2, name: \"Sarah Johnson\",   email: \"sarah@example.com\",  role: \"Instructor\", status: \"Active\", hours: 890.1, balance: -120,  joined: \"Mar 2020\", medical: \"Aug 2025\" },\n  { id: 3, name: \"Mike Wilson\",     email: \"mike@example.com\",   role: \"Member\",  status: \"Active\",    hours: 67.4,  balance: 240,   joined: \"Jun 2021\", medical: \"Oct 2024\" },\n  { id: 4, name: \"Emily Davis\",     email: \"emily@example.com\",  role: \"Member\",  status: \"Active\",    hours: 134.8, balance: 0,     joined: \"Sep 2021\", medical: \"Dec 2024\" },\n  { id: 5, name: \"Tom Reynolds\",    email: \"tom@example.com\",    role: \"Member\",  status: \"Suspended\", hours: 22.1,  balance: -480,  joined: \"Feb 2022\", medical: \"Mar 2025\" },\n  { id: 6, name: \"Lisa Park\",       email: \"lisa@example.com\",   role: \"Admin\",   status: \"Active\",    hours: 203.5, balance: 60,    joined: \"Apr 2022\", medical: \"Jun 2025\" },\n  { id: 7, name: \"Dan Ortega\",      email: \"dan@example.com\",    role: \"Member\",  status: \"Pending\",   hours: 0,     balance: 0,     joined: \"Feb 2024\", medical: \"â€”\" },\n]\n\nconst mockAircraft = [\n  { id: \"a1\", nNumber: \"N172SP\", nickname: \"Skyhawk\",  make: \"Cessna\",  model: \"172S\",       year: 2021, status: \"Available\",   rate: 165, hobbs: 98.2,   nextMx: \"Mar 15, 2024\", mxHours: 8.5 },\n  { id: \"a2\", nNumber: \"N9876P\", nickname: \"Warrior\",  make: \"Piper\",   model: \"PA-28-161\",  year: 2019, status: \"Maintenance\", rate: 145, hobbs: 1842.3, nextMx: \"Now\",          mxHours: 0 },\n  { id: \"a3\", nNumber: \"N345AB\", nickname: \"Cherokee\", make: \"Piper\",   model: \"PA-32-300\",  year: 1978, status: \"Available\",   rate: 135, hobbs: 4890.5, nextMx: \"Jun 20, 2024\", mxHours: 98.2 },\n  { id: \"a4\", nNumber: \"N5501X\", nickname: \"Arrow\",    make: \"Piper\",   model: \"PA-28R-201\", year: 2003, status: \"Reserved\",    rate: 175, hobbs: 2201.7, nextMx: \"Aug 10, 2024\", mxHours: 156 },\n]\n\nconst mockDispatched = [\n  { id: \"d1\", pilot: \"Sarah Johnson\", aircraft: \"N172SP\", departed: \"14:02\",  eta: \"16:30\", route: \"KBOS â†’ KALB â†’ KBOS\", fuel: 28, status: \"Airborne\" },\n  { id: \"d2\", pilot: \"Emily Davis\",   aircraft: \"N5501X\", departed: \"13:45\",  eta: \"15:45\", route: \"KBOS â†’ KMVY\",         fuel: 18, status: \"Airborne\" },\n]\n\nconst mockAwaitingDispatch = [\n  { id: \"w1\", pilot: \"Mike Wilson\",  aircraft: \"N345AB\", plannedDep: \"17:30\", route: \"KBOS â†’ KACK\",  filed: \"10:22 AM\" },\n  { id: \"w2\", pilot: \"Dan Ortega\",   aircraft: \"N172SP\", plannedDep: \"18:00\", route: \"KBOS Local\",   filed: \"12:55 PM\" },\n]\n\nconst mockPastFlights = [\n  { id: \"f1\", pilot: \"James Carter\",  aircraft: \"N172SP\", date: \"Feb 22\", hobbs: 1.8,  route: \"KBOS â†’ KEDU â†’ KBOS\",  cost: 297 },\n  { id: \"f2\", pilot: \"Sarah Johnson\", aircraft: \"N345AB\", date: \"Feb 21\", hobbs: 2.5,  route: \"KBOS â†’ KALB â†’ KBOS\",  cost: 338 },\n  { id: \"f3\", pilot: \"Lisa Park\",     aircraft: \"N172SP\", date: \"Feb 20\", hobbs: 1.2,  route: \"KBOS Local\",           cost: 198 },\n  { id: \"f4\", pilot: \"Emily Davis\",   aircraft: \"N5501X\", date: \"Feb 19\", hobbs: 3.1,  route: \"KBOS â†’ KPVD â†’ KBOS\",  cost: 543 },\n  { id: \"f5\", pilot: \"Mike Wilson\",   aircraft: \"N172SP\", date: \"Feb 18\", hobbs: 1.0,  route: \"KBOS Local\",           cost: 165 },\n]\n\nconst mockMaintenance = [\n  { id: \"m1\", aircraft: \"N9876P\", item: \"Annual Inspection\",   status: \"In Progress\", due: \"Mar 15\", priority: \"high\",   shop: \"Boston Avionics\" },\n  { id: \"m2\", aircraft: \"N172SP\", item: \"Oil Change\",          status: \"Due\",         due: \"Mar 1\",  priority: \"urgent\", shop: \"â€”\" },\n  { id: \"m3\", aircraft: \"N345AB\", item: \"100-Hour Inspection\", status: \"Scheduled\",   due: \"Jun 20\", priority: \"medium\", shop: \"Logan FBO\" },\n  { id: \"m4\", aircraft: \"N5501X\", item: \"ELT Battery\",         status: \"OK\",          due: \"Aug 10\", priority: \"low\",    shop: \"â€”\" },\n]\n\nconst mockPendingFuelExpenses = [\n  { id: \"f1\", pilot: \"Sarah Johnson\", aircraft: \"N172SP\", date: \"Feb 22\", gallons: 18.5, pricePerGal: 5.89, total: 108.97, status: \"PENDING\", submittedAt: \"Feb 22, 2026 4:30 PM\" },\n  { id: \"f2\", pilot: \"Mike Wilson\", aircraft: \"N345AB\", date: \"Feb 21\", gallons: 22.3, pricePerGal: 5.75, total: 128.23, status: \"PENDING\", submittedAt: \"Feb 21, 2026 6:15 PM\" },\n  { id: \"f3\", pilot: \"Emily Davis\", aircraft: \"N5501X\", date: \"Feb 19\", gallons: 35.0, pricePerGal: 5.95, total: 208.25, status: \"PENDING\", submittedAt: \"Feb 19, 2026 8:45 PM\" },\n  { id: \"f4\", pilot: \"James Carter\", aircraft: \"N172SP\", date: \"Feb 18\", gallons: 16.2, pricePerGal: 5.89, total: 95.42, status: \"APPROVED\", submittedAt: \"Feb 18, 2026 3:20 PM\" },\n]\n\nconst mockPendingMaintenanceIssues = [\n  { id: \"mx1\", pilot: \"Sarah Johnson\", aircraft: \"N172SP\", date: \"Feb 22\", issue: \"Low oil pressure indication during climb\", category: \"Engine\", isPlaneSpecific: true, severity: \"high\", status: \"Pending Review\", flightId: \"flt-001\" },\n  { id: \"mx2\", pilot: \"Mike Wilson\", aircraft: \"N345AB\", date: \"Feb 20\", issue: \"Landing gear retract light intermittent\", category: \"Avionics\", isPlaneSpecific: true, severity: \"medium\", status: \"Pending Review\", flightId: \"flt-002\" },\n  { id: \"mx3\", pilot: \"Emily Davis\", aircraft: \"N172SP\", date: \"Feb 18\", issue: \"Flap actuator making noise\", category: \"Airframe\", isPlaneSpecific: false, severity: \"low\", status: \"Pending Review\", flightId: \"flt-003\" },\n]\n\n// Maintenance history for each aircraft\nconst mockMaintenanceHistory = {\n  \"N172SP\": [\n    { id: \"h1\", date: \"Feb 15, 2026\", item: \"Oil Change\", type: \"Scheduled\", status: \"Completed\", cost: 150, hobbs: 1250.0, shop: \"Self\" },\n    { id: \"h2\", date: \"Jan 20, 2026\", item: \"Annual Inspection\", type: \"Scheduled\", status: \"Completed\", cost: 2800, hobbs: 1200.5, shop: \"Boston Avionics\" },\n    { id: \"h3\", date: \"Dec 5, 2025\", item: \"Altimeter Calibration\", type: \"AD Compliance\", status: \"Completed\", cost: 450, hobbs: 1150.2, shop: \"Boston Avionics\" },\n    { id: \"h4\", date: \"Oct 18, 2025\", item: \"Brake Pad Replacement\", type: \"Unscheduled\", status: \"Completed\", cost: 380, hobbs: 1100.0, shop: \"Logan FBO\" },\n    { id: \"h5\", date: \"Aug 22, 2025\", item: \"100-Hour Inspection\", type: \"Scheduled\", status: \"Completed\", cost: 1850, hobbs: 1000.3, shop: \"Boston Avionics\" },\n  ],\n  \"N345AB\": [\n    { id: \"h1\", date: \"Jan 10, 2026\", item: \"Annual Inspection\", type: \"Scheduled\", status: \"Completed\", cost: 3200, hobbs: 4890.5, shop: \"Pittsburgh Aviation\" },\n    { id: \"h2\", date: \"Nov 15, 2025\", item: \"Engine Overhaul\", type: \"Major\", status: \"Completed\", cost: 18500, hobbs: 4500.0, shop: \"Continental Motors\" },\n    { id: \"h3\", date: \"Sep 3, 2025\", item: \"Fuel Selector Repair\", type: \"Unscheduled\", status: \"Completed\", cost: 275, hobbs: 4200.2, shop: \"Pittsburgh Aviation\" },\n  ],\n  \"N9876P\": [\n    { id: \"h1\", date: \"Mar 1, 2026\", item: \"Annual Inspection\", type: \"Scheduled\", status: \"In Progress\", cost: 0, hobbs: 1842.3, shop: \"Boston Avionics\" },\n    { id: \"h2\", date: \"Aug 15, 2025\", item: \"100-Hour Inspection\", type: \"Scheduled\", status: \"Completed\", cost: 1650, hobbs: 1700.0, shop: \"Boston Avionics\" },\n    { id: \"h3\", date: \"Jun 20, 2025\", item: \"New Tires\", type: \"Scheduled\", status: \"Completed\", cost: 320, hobbs: 1600.5, shop: \"Logan FBO\" },\n  ],\n  \"N5501X\": [\n    { id: \"h1\", date: \"Dec 10, 2025\", item: \"Annual Inspection\", type: \"Scheduled\", status: \"Completed\", cost: 3500, hobbs: 2201.7, shop: \"Garmin Service\" },\n    { id: \"h2\", date: \"Jul 22, 2025\", item: \"GPS Update\", type: \"AD Compliance\", status: \"Completed\", cost: 850, hobbs: 2000.0, shop: \"Garmin Service\" },\n  ],\n}\n\nconst mockBilling = [\n  { id: \"b1\", member: \"Mike Wilson\",   type: \"Flight\",          aircraft: \"N172SP\", date: \"Feb 22\", amount: 297,  status: \"Paid\" },\n  { id: \"b2\", member: \"Tom Reynolds\",  type: \"Monthly Dues\",    aircraft: \"â€”\",      date: \"Feb 1\",  amount: 120,  status: \"Overdue\" },\n  { id: \"b3\", member: \"Emily Davis\",   type: \"Flight\",          aircraft: \"N5501X\", date: \"Feb 19\", amount: 543,  status: \"Paid\" },\n  { id: \"b4\", member: \"Dan Ortega\",    type: \"Joining Fee\",     aircraft: \"â€”\",      date: \"Feb 10\", amount: 500,  status: \"Paid\" },\n  { id: \"b5\", member: \"Tom Reynolds\",  type: \"Flight\",          aircraft: \"N172SP\", date: \"Jan 28\", amount: 198,  status: \"Overdue\" },\n]\n\nconst flightHoursData = [\n  { month: \"Sep\", hours: 42 }, { month: \"Oct\", hours: 56 }, { month: \"Nov\", hours: 38 },\n  { month: \"Dec\", hours: 61 }, { month: \"Jan\", hours: 49 }, { month: \"Feb\", hours: 58 },\n]\n\nconst revenueData = [\n  { month: \"Sep\", revenue: 6800 }, { month: \"Oct\", revenue: 8900 }, { month: \"Nov\", revenue: 6100 },\n  { month: \"Dec\", revenue: 9600 }, { month: \"Jan\", revenue: 7400 }, { month: \"Feb\", revenue: 9200 },\n]\n\n// â”€â”€ Types â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\ntype Tab =\n  | \"overview\"\n  | \"awaiting-dispatch\" | \"currently-dispatched\" | \"past-flights\"\n  | \"members\" | \"instructors\" | \"administrators\" | \"groups\"\n  | \"aircraft\" | \"items\" | \"adjustments\" | \"forms\"\n  | \"billing\" | \"invoices\"\n  | \"fuel-approvals\" | \"maintenance-reviews\"\n  | \"general-settings\" | \"member-settings\" | \"schedule-settings\"\n  | \"notification-settings\" | \"add-ons\"\n\ntype NavItem  = { id: Tab; label: string }\ntype NavGroup = { label: string; items: NavItem[] }\n\nconst NAV_GROUPS: NavGroup[] = [\n  {\n    label: \"Flights\",\n    items: [\n      { id: \"overview\",              label: \"Overview\" },\n      { id: \"awaiting-dispatch\",     label: \"Awaiting Dispatch\" },\n      { id: \"currently-dispatched\",  label: \"Currently Dispatched\" },\n      { id: \"past-flights\",          label: \"Past Flights\" },\n    ],\n  },\n  {\n    label: \"Approvals\",\n    items: [\n      { id: \"fuel-approvals\",        label: \"Fuel Expenses\" },\n      { id: \"maintenance-reviews\",   label: \"Maintenance Issues\" },\n    ],\n  },\n  {\n    label: \"People\",\n    items: [\n      { id: \"members\",        label: \"Members\" },\n      { id: \"instructors\",    label: \"Instructors\" },\n      { id: \"administrators\", label: \"Administrators\" },\n      { id: \"groups\",         label: \"Groups\" },\n    ],\n  },\n  {\n    label: \"Resources\",\n    items: [\n      { id: \"aircraft\",    label: \"Aircraft\" },\n      { id: \"items\",       label: \"Items\" },\n      { id: \"adjustments\", label: \"Adjustments\" },\n      { id: \"forms\",       label: \"Forms\" },\n    ],\n  },\n  {\n    label: \"Billing\",\n    items: [\n      { id: \"billing\",  label: \"Transactions\" },\n      { id: \"invoices\", label: \"Invoices\" },\n    ],\n  },\n  {\n    label: \"Settings\",\n    items: [\n      { id: \"general-settings\",      label: \"General Settings\" },\n      { id: \"member-settings\",       label: \"Member Settings\" },\n      { id: \"schedule-settings\",     label: \"Schedule Settings\" },\n      { id: \"notification-settings\", label: \"Notification Settings\" },\n      { id: \"add-ons\",               label: \"Add-ons\" },\n    ],\n  },\n]\n\n// â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\nfunction StatusBadge({ status }: { status: string }) {\n  const map: Record<string, string> = {\n    Active:      \"bg-chart-2/10 text-chart-2 border-chart-2/30\",\n    Available:   \"bg-chart-2/10 text-chart-2 border-chart-2/30\",\n    Airborne:    \"bg-primary/10  text-primary  border-primary/30\",\n    Paid:        \"bg-chart-2/10 text-chart-2 border-chart-2/30\",\n    Maintenance: \"bg-chart-3/10 text-chart-3 border-chart-3/30\",\n    \"In Progress\":\"bg-chart-3/10 text-chart-3 border-chart-3/30\",\n    Reserved:    \"bg-chart-4/10 text-chart-4 border-chart-4/30\",\n    Scheduled:   \"bg-chart-4/10 text-chart-4 border-chart-4/30\",\n    Suspended:   \"bg-destructive/10 text-destructive border-destructive/30\",\n    Overdue:     \"bg-destructive/10 text-destructive border-destructive/30\",\n    Due:         \"bg-destructive/10 text-destructive border-destructive/30\",\n    urgent:      \"bg-destructive/10 text-destructive border-destructive/30\",\n    Pending:     \"bg-muted text-muted-foreground border-border\",\n    OK:          \"bg-chart-2/10 text-chart-2 border-chart-2/30\",\n    low:         \"bg-muted text-muted-foreground border-border\",\n    medium:      \"bg-chart-3/10 text-chart-3 border-chart-3/30\",\n    high:        \"bg-destructive/10 text-destructive border-destructive/30\",\n  }\n  return (\n    <span className={`inline-flex items-center rounded-full border px-2 py-0.5 text-[11px] font-medium ${map[status] ?? \"bg-muted text-muted-foreground border-border\"}`}>\n      {status}\n    </span>\n  )\n}\n\nfunction PipelineStage({\n  label,\n  value,\n  sublabel,\n  progress,\n}: {\n  label: string\n  value: string\n  sublabel: string\n  progress: number\n}) {\n  return (\n    <div className=\"rounded-md border border-border p-3\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <p className=\"text-xs font-semibold uppercase tracking-wider text-muted-foreground\">{label}</p>\n          <p className=\"text-sm font-medium\">{value}</p>\n          <p className=\"text-[11px] text-muted-foreground\">{sublabel}</p>\n        </div>\n        <div className=\"h-2 w-14 rounded-full bg-muted/50 overflow-hidden\">\n          <div\n            className=\"h-full rounded-full bg-primary animate-pulse\"\n            style={{ width: `${progress}%` }}\n          />\n        </div>\n      </div>\n      <div className=\"mt-2\">\n        <Progress value={progress} className=\"h-1.5\" />\n      </div>\n    </div>\n  )\n}\n\nfunction PlaceholderPanel({ title, description }: { title: string; description: string }) {\n  return (\n    <div className=\"flex flex-col items-center justify-center rounded-xl border border-dashed border-border bg-muted/30 py-24 text-center\">\n      <p className=\"text-sm font-semibold text-foreground\">{title}</p>\n      <p className=\"mt-1 max-w-xs text-xs text-muted-foreground\">{description}</p>\n    </div>\n  )\n}\n\n// â”€â”€ Component â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\nexport default function ClubAdminPage() {\n  const { data: session } = useSession()\n\n  const [activeTab, setActiveTab] = useState<Tab>(\"overview\")\n  const [memberSearch, setMemberSearch] = useState(\"\")\n  const [selectedAircraft, setSelectedAircraft] = useState<string | null>(null)\n  const [groupId, setGroupId] = useState<string | null>(null)\n  const [adminGroups, setAdminGroups] = useState<any[]>([])\n  const [showGroupPicker, setShowGroupPicker] = useState(false)\n  const [isGroupsLoading, setIsGroupsLoading] = useState(false)\n\n  // Live data state (with mock fallbacks)\n  const [club, setClub] = useState(mockClub)\n  const [members, setMembers] = useState<any[]>(mockMembers)\n  const [aircraft, setAircraft] = useState<any[]>(mockAircraft)\n  const [awaitingDispatch, setAwaitingDispatch] = useState<any[]>(mockAwaitingDispatch)\n  const [dispatched, setDispatched] = useState<any[]>(mockDispatched)\n  const [pastFlights, setPastFlights] = useState<any[]>(mockPastFlights)\n  const [billing, setBilling] = useState<any[]>(mockBilling)\n  const [fuelExpenses, setFuelExpenses] = useState<any[]>(mockPendingFuelExpenses)\n  const [maintenanceIssues, setMaintenanceIssues] = useState<any[]>(mockPendingMaintenanceIssues)\n  const [maintenanceHistory, setMaintenanceHistory] = useState<Record<string, any[]>>(mockMaintenanceHistory as any)\n\n  // Loading / error flags\n  const [isMembersLoading, setIsMembersLoading] = useState(false)\n  const [membersError, setMembersError] = useState<string | null>(null)\n\n  const [isFuelLoading, setIsFuelLoading] = useState(false)\n  const [fuelError, setFuelError] = useState<string | null>(null)\n  const [fuelActionId, setFuelActionId] = useState<string | null>(null)\n\n  const [isIssuesLoading, setIsIssuesLoading] = useState(false)\n  const [issuesError, setIssuesError] = useState<string | null>(null)\n  const [maintenanceActionId, setMaintenanceActionId] = useState<string | null>(null)\n\n  const [isBillingLoading, setIsBillingLoading] = useState(false)\n  const [billingError, setBillingError] = useState<string | null>(null)\n\n  const [isFlightsLoading, setIsFlightsLoading] = useState(false)\n  const [flightsError, setFlightsError] = useState<string | null>(null)\n\n  const [isHistoryLoading, setIsHistoryLoading] = useState(false)\n  const [historyError, setHistoryError] = useState<string | null>(null)\n  const [pipelineTick, setPipelineTick] = useState(0)\n\n  // Determine admin group\n  useEffect(() => {\n    let cancelled = false\n\n    async function loadGroups() {\n      try {\n        setIsGroupsLoading(true)\n        const res = await fetch(\"/api/groups\")\n        if (!res.ok) return\n        const data = await res.json()\n        const groups = Array.isArray(data) ? data : data?.groups\n        if (!Array.isArray(groups) || groups.length === 0) return\n\n        const eligible = groups.filter((g: any) => g.role === \"ADMIN\" || g.role === \"OWNER\")\n        const candidates = eligible.length > 0 ? eligible : groups\n        if (cancelled) return\n\n        setAdminGroups(candidates)\n\n        const storedGroupId = typeof window !== 'undefined'\n          ? window.localStorage.getItem('clubAdminGroupId')\n          : null\n        const storedGroup = storedGroupId\n          ? candidates.find((g: any) => g.id === storedGroupId)\n          : null\n\n        if (storedGroup) {\n          setGroupId(storedGroup.id)\n          setClub(prev => ({\n            ...prev,\n            name: storedGroup.name ?? prev.name,\n          }))\n          return\n        }\n\n        if (candidates.length === 1) {\n          const selected = candidates[0]\n          setGroupId(selected.id)\n          setClub(prev => ({\n            ...prev,\n            name: selected.name ?? prev.name,\n          }))\n          if (typeof window !== 'undefined') {\n            window.localStorage.setItem('clubAdminGroupId', selected.id)\n          }\n        } else if (candidates.length > 1) {\n          setShowGroupPicker(true)\n        }\n      } catch (err) {\n        console.error(\"Failed to load groups for admin page\", err)\n      } finally {\n        if (!cancelled) setIsGroupsLoading(false)\n      }\n    }\n\n    loadGroups()\n    return () => {\n      cancelled = true\n    }\n  }, [])\n\n  useEffect(() => {\n    const interval = setInterval(() => {\n      setPipelineTick(prev => (prev + 7) % 100)\n    }, 1200)\n    return () => clearInterval(interval)\n  }, [])\n\n  function handleSelectGroup(group: any) {\n    setGroupId(group.id)\n    setClub(prev => ({\n      ...prev,\n      name: group.name ?? prev.name,\n    }))\n    if (typeof window !== 'undefined') {\n      window.localStorage.setItem('clubAdminGroupId', group.id)\n    }\n    setShowGroupPicker(false)\n  }\n\n  // Members\n  useEffect(() => {\n    if (!groupId) return\n    let cancelled = false\n\n    async function loadMembers() {\n      try {\n        setIsMembersLoading(true)\n        setMembersError(null)\n\n        const res = await fetch(`/api/admin/members?groupId=${groupId}`)\n        if (!res.ok) throw new Error(`Failed to fetch members: ${res.status}`)\n        const data = await res.json()\n        const nextMembers = Array.isArray(data) ? data : data.members ?? []\n        if (!cancelled) setMembers(nextMembers)\n      } catch (err) {\n        console.error(\"Failed to load members\", err)\n        if (!cancelled) {\n          setMembersError(\"Failed to load members. Showing sample data.\")\n          setMembers(mockMembers)\n        }\n      } finally {\n        if (!cancelled) setIsMembersLoading(false)\n      }\n    }\n\n    loadMembers()\n    return () => {\n      cancelled = true\n    }\n  }, [groupId])\n\n  // Aircraft\n  useEffect(() => {\n    if (!groupId) return\n    let cancelled = false\n\n    async function loadAircraft() {\n      try {\n        const res = await fetch(`/api/admin/aircraft?groupId=${groupId}`)\n        if (!res.ok) throw new Error(`Failed to fetch aircraft: ${res.status}`)\n        const data = await res.json()\n        if (!cancelled) setAircraft(data)\n      } catch (err) {\n        console.error(\"Failed to load aircraft\", err)\n        if (!cancelled) setAircraft(mockAircraft)\n      }\n    }\n\n    loadAircraft()\n    return () => {\n      cancelled = true\n    }\n  }, [groupId])\n\n  // Flights (awaiting, dispatched, past)\n  useEffect(() => {\n    if (!groupId) return\n    let cancelled = false\n\n    async function loadFlights() {\n      try {\n        setIsFlightsLoading(true)\n        setFlightsError(null)\n\n        const [pastRes, dispatchedRes, awaitingRes] = await Promise.all([\n          fetch(`/api/admin/flights?groupId=${groupId}&type=past`),\n          fetch(`/api/admin/flights?groupId=${groupId}&type=dispatched`),\n          fetch(`/api/admin/flights?groupId=${groupId}&type=awaiting`),\n        ])\n\n        if (!pastRes.ok || !dispatchedRes.ok || !awaitingRes.ok) {\n          throw new Error(\"Failed to fetch flights\")\n        }\n\n        const [pastData, dispatchedData, awaitingData] = await Promise.all([\n          pastRes.json(),\n          dispatchedRes.json(),\n          awaitingRes.json(),\n        ])\n\n        if (cancelled) return\n        setPastFlights(Array.isArray(pastData) ? pastData : pastData.flights ?? [])\n        setDispatched(Array.isArray(dispatchedData) ? dispatchedData : dispatchedData.flights ?? [])\n        setAwaitingDispatch(Array.isArray(awaitingData) ? awaitingData : awaitingData.flights ?? [])\n      } catch (err) {\n        console.error(\"Failed to load flights\", err)\n        if (!cancelled) {\n          setFlightsError(\"Failed to load flights. Showing sample data.\")\n          setPastFlights(mockPastFlights)\n          setDispatched(mockDispatched)\n          setAwaitingDispatch(mockAwaitingDispatch)\n        }\n      } finally {\n        if (!cancelled) setIsFlightsLoading(false)\n      }\n    }\n\n    loadFlights()\n    return () => {\n      cancelled = true\n    }\n  }, [groupId])\n\n  // Billing\n  useEffect(() => {\n    if (!groupId) return\n    let cancelled = false\n\n    async function loadBilling() {\n      try {\n        setIsBillingLoading(true)\n        setBillingError(null)\n\n        const res = await fetch(`/api/admin/billing?groupId=${groupId}`)\n        if (!res.ok) throw new Error(`Failed to fetch billing: ${res.status}`)\n        const data = await res.json()\n        if (!cancelled) {\n          const tx = Array.isArray(data) ? data : data.transactions ?? []\n          setBilling(tx)\n        }\n      } catch (err) {\n        console.error(\"Failed to load billing\", err)\n        if (!cancelled) {\n          setBillingError(\"Failed to load billing. Showing sample data.\")\n          setBilling(mockBilling)\n        }\n      } finally {\n        if (!cancelled) setIsBillingLoading(false)\n      }\n    }\n\n    loadBilling()\n    return () => {\n      cancelled = true\n    }\n  }, [groupId])\n\n  // Fuel expenses\n  useEffect(() => {\n    if (!groupId) return\n    let cancelled = false\n\n    async function loadFuelExpenses() {\n      try {\n        setIsFuelLoading(true)\n        setFuelError(null)\n\n        const res = await fetch(`/api/admin/fuel-expenses?groupId=${groupId}`)\n        if (!res.ok) throw new Error(`Failed to fetch fuel expenses: ${res.status}`)\n        const data = await res.json()\n        const expenses = Array.isArray(data) ? data : data.expenses ?? []\n        if (!cancelled) setFuelExpenses(expenses)\n      } catch (err) {\n        console.error(\"Failed to load fuel expenses\", err)\n        if (!cancelled) {\n          setFuelError(\"Failed to load fuel expenses. Showing sample data.\")\n          setFuelExpenses(mockPendingFuelExpenses)\n        }\n      } finally {\n        if (!cancelled) setIsFuelLoading(false)\n      }\n    }\n\n    loadFuelExpenses()\n    return () => {\n      cancelled = true\n    }\n  }, [groupId])\n\n  // Maintenance issues\n  useEffect(() => {\n    if (!groupId) return\n    let cancelled = false\n\n    async function loadIssues() {\n      try {\n        setIsIssuesLoading(true)\n        setIssuesError(null)\n\n        const res = await fetch(`/api/admin/maintenance/issues?groupId=${groupId}`)\n        if (!res.ok) throw new Error(`Failed to fetch maintenance issues: ${res.status}`)\n        const data = await res.json()\n        const issues = Array.isArray(data) ? data : data.issues ?? []\n        if (!cancelled) setMaintenanceIssues(issues)\n      } catch (err) {\n        console.error(\"Failed to load maintenance issues\", err)\n        if (!cancelled) {\n          setIssuesError(\"Failed to load maintenance issues. Showing sample data.\")\n          setMaintenanceIssues(mockPendingMaintenanceIssues)\n        }\n      } finally {\n        if (!cancelled) setIsIssuesLoading(false)\n      }\n    }\n\n    loadIssues()\n    return () => {\n      cancelled = true\n    }\n  }, [groupId])\n\n  // Maintenance history for selected aircraft\n  useEffect(() => {\n    if (!selectedAircraft) return\n    const nNumber = selectedAircraft\n    let cancelled = false\n\n    async function loadHistory() {\n      try {\n        setIsHistoryLoading(true)\n        setHistoryError(null)\n\n        const res = await fetch(\n          `/api/admin/maintenance/history?nNumber=${encodeURIComponent(nNumber)}`\n        )\n        if (!res.ok) throw new Error(`Failed to fetch history: ${res.status}`)\n        const data = await res.json()\n        const history = Array.isArray(data) ? data : data.history ?? []\n\n        if (!cancelled) {\n          setMaintenanceHistory(prev => ({\n            ...prev,\n            [nNumber]: history,\n          }))\n        }\n      } catch (err) {\n        console.error(\"Failed to load maintenance history\", err)\n        if (!cancelled) {\n          setHistoryError(\"Failed to load maintenance history. Showing sample data if available.\")\n        }\n      } finally {\n        if (!cancelled) setIsHistoryLoading(false)\n      }\n    }\n\n    loadHistory()\n    return () => {\n      cancelled = true\n    }\n  }, [selectedAircraft])\n\n  async function handleFuelAction(id: string, action: \"approve\" | \"deny\") {\n    try {\n      setFuelActionId(id)\n      setFuelError(null)\n\n      const res = await fetch(`/api/admin/fuel-expenses/${id}`, {\n        method: \"PATCH\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ action }),\n      })\n      if (!res.ok) throw new Error(`Failed to ${action} fuel expense`)\n\n      setFuelExpenses(prev =>\n        prev.map(f =>\n          f.id === id\n            ? {\n                ...f,\n                status: action === \"approve\" ? \"APPROVED\" : \"DENIED\",\n                approvedAt:\n                  action === \"approve\" ? new Date().toISOString() : f.approvedAt,\n              }\n            : f,\n        ),\n      )\n    } catch (err) {\n      console.error(\"Fuel approval action failed\", err)\n      setFuelError(\"Action failed. Please try again.\")\n    } finally {\n      setFuelActionId(null)\n    }\n  }\n\n  async function handleMaintenanceAction(\n    id: string,\n    action: \"dismiss\" | \"create-work-order\",\n  ) {\n    try {\n      setMaintenanceActionId(id)\n      setIssuesError(null)\n\n      const res = await fetch(`/api/admin/maintenance/issues/${id}`, {\n        method: \"PATCH\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ action }),\n      })\n      if (!res.ok) throw new Error(`Failed to ${action} maintenance issue`)\n\n      const updated = await res.json()\n      const issue = updated.issue ?? updated\n\n      setMaintenanceIssues(prev =>\n        prev.map(i => (i.id === id ? { ...i, ...issue } : i)),\n      )\n    } catch (err) {\n      console.error(\"Maintenance action failed\", err)\n      setIssuesError(\"Action failed. Please try again.\")\n    } finally {\n      setMaintenanceActionId(null)\n    }\n  }\n\n  const filteredMembers = members.filter(m =>\n    m.name.toLowerCase().includes(memberSearch.toLowerCase()) ||\n    m.email.toLowerCase().includes(memberSearch.toLowerCase())\n  )\n\n  const activeLabel = NAV_GROUPS.flatMap(g => g.items).find(i => i.id === activeTab)?.label ?? \"\"\n\n  return (\n    <div className=\"flex min-h-screen bg-background pt-[44px]\">\n\n      <Dialog\n        open={showGroupPicker}\n        onOpenChange={(open) => {\n          if (!open && !groupId) return\n          setShowGroupPicker(open)\n        }}\n      >\n        <DialogContent showCloseButton={false}>\n          <DialogHeader>\n            <DialogTitle>Select a club to manage</DialogTitle>\n            <DialogDescription>\n              You have admin access to multiple clubs. Choose the one you want to manage.\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-2\">\n            {adminGroups.map((group) => (\n              <button\n                key={group.id}\n                onClick={() => handleSelectGroup(group)}\n                className=\"flex w-full items-center justify-between rounded-md border border-border px-3 py-2 text-left text-sm transition-colors hover:bg-muted\"\n              >\n                <span className=\"font-medium\">{group.name}</span>\n                <Badge variant=\"outline\" className=\"text-[10px]\">{group.role}</Badge>\n              </button>\n            ))}\n            {isGroupsLoading && (\n              <p className=\"text-xs text-muted-foreground\">Loading clubsâ€¦</p>\n            )}\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* â”€â”€ SIDEBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}\n      <aside className=\"fixed top-[44px] left-0 h-[calc(100vh-44px)] w-56 shrink-0 overflow-y-auto border-r border-border bg-card\">\n        {/* Club identity */}\n        <div className=\"border-b border-border px-4 py-3\">\n          <div className=\"flex items-center gap-2\">\n            <div className=\"flex h-7 w-7 items-center justify-center rounded bg-primary\">\n              <Shield className=\"h-4 w-4 text-primary-foreground\" />\n            </div>\n            <div className=\"min-w-0\">\n              <p className=\"truncate text-xs font-semibold leading-tight\">{club.name}</p>\n              <p className=\"text-[10px] text-muted-foreground\">Club Admin</p>\n            </div>\n          </div>\n        </div>\n\n        {/* Nav */}\n        <nav className=\"py-1\">\n          {NAV_GROUPS.map((group, gi) => (\n            <div key={group.label} className={gi > 0 ? \"mt-0.5 border-t border-border pt-0.5\" : \"\"}>\n              <p className=\"px-4 pb-1 pt-2 text-[10px] font-semibold uppercase tracking-wider text-muted-foreground/50\">\n                {group.label}\n              </p>\n              {group.items.map((item) => {\n                const isActive = activeTab === item.id\n                return (\n                  <button\n                    key={item.id}\n                    onClick={() => setActiveTab(item.id)}\n                    className={`flex w-full items-center justify-between px-4 py-2.5 text-xs font-medium transition-colors ${\n                      isActive\n                        ? \"bg-primary text-primary-foreground\"\n                        : \"text-foreground hover:bg-muted\"\n                    }`}\n                  >\n                    {item.label}\n                    <ChevronRight className={`h-3.5 w-3.5 shrink-0 ${isActive ? \"text-primary-foreground/60\" : \"text-muted-foreground/40\"}`} />\n                  </button>\n                )\n              })}\n            </div>\n          ))}\n        </nav>\n      </aside>\n\n      {/* â”€â”€ MAIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}\n      <div className=\"flex-1 overflow-auto ml-[224px]\">\n\n        {/* Top bar */}\n        <div className=\"sticky top-0 z-30 flex h-11 items-center justify-between border-b border-border bg-card/95 px-6 backdrop-blur\">\n          <h1 className=\"text-sm font-semibold\">{activeLabel}</h1>\n          <div className=\"flex items-center gap-2\">\n            <Button size=\"sm\" variant=\"outline\" className=\"h-7 gap-1.5 text-xs\">\n              <Download className=\"h-3 w-3\" /> Export\n            </Button>\n            <Button size=\"sm\" className=\"h-7 gap-1.5 text-xs\">\n              <Plus className=\"h-3 w-3\" /> Add New\n            </Button>\n          </div>\n        </div>\n\n        <div className=\"p-6 space-y-6\">\n\n          {/* â”€â”€ OVERVIEW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}\n          {activeTab === \"overview\" && (\n            <>\n              {/* KPI row */}\n              <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-4\">\n                {[\n                  { label: \"Total Members\", value: \"24\", sub: \"+2 this month\",   icon: Users,       trend: \"up\" },\n                  { label: \"Aircraft\",      value: \"4\",  sub: \"1 in maintenance\", icon: Plane,       trend: \"neutral\" },\n                  { label: \"Hours Flown\",   value: \"58\", sub: \"this month\",       icon: Clock,       trend: \"up\" },\n                  { label: \"Revenue\",       value: \"$9,200\", sub: \"+12% vs last month\", icon: DollarSign, trend: \"up\" },\n                ].map((kpi) => (\n                  <Card key={kpi.label}>\n                    <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\n                      <CardTitle className=\"text-xs font-medium text-muted-foreground\">{kpi.label}</CardTitle>\n                      <kpi.icon className=\"h-4 w-4 text-muted-foreground\" />\n                    </CardHeader>\n                    <CardContent>\n                      <p className=\"text-2xl font-bold\">{kpi.value}</p>\n                      <p className={`mt-0.5 flex items-center gap-1 text-xs ${kpi.trend === \"up\" ? \"text-chart-2\" : \"text-muted-foreground\"}`}>\n                        {kpi.trend === \"up\" && <TrendingUp className=\"h-3 w-3\" />}\n                        {kpi.sub}\n                      </p>\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n\n              {/* Charts */}\n              <div className=\"grid gap-4 lg:grid-cols-2\">\n                <Card>\n                  <CardHeader>\n                    <CardTitle className=\"text-sm\">Flight Hours â€” Last 6 Months</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"min-h-[200px]\">\n                    <ResponsiveContainer width=\"100%\" height={200}>\n                      <AreaChart data={flightHoursData}>\n                        <defs>\n                          <linearGradient id=\"gh\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                            <stop offset=\"5%\"  stopColor=\"#3b82f6\" stopOpacity={0.4} />\n                            <stop offset=\"95%\" stopColor=\"#3b82f6\" stopOpacity={0.05} />\n                          </linearGradient>\n                        </defs>\n                        <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#334155\" opacity={0.3} />\n                        <XAxis dataKey=\"month\" tick={{ fill: \"#94a3b8\", fontSize: 11 }} axisLine={false} tickLine={false} />\n                        <YAxis tick={{ fill: \"#94a3b8\", fontSize: 11 }} axisLine={false} tickLine={false} />\n                        <Tooltip contentStyle={{ background: \"#1e293b\", border: \"1px solid #334155\", borderRadius: 8, color: \"#f1f5f9\" }} />\n                        <Area type=\"monotone\" dataKey=\"hours\" stroke=\"#3b82f6\" strokeWidth={2} fill=\"url(#gh)\" />\n                      </AreaChart>\n                    </ResponsiveContainer>\n                    </div>\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardHeader>\n                    <CardTitle className=\"text-sm\">Club Revenue â€” Last 6 Months</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"min-h-[200px]\">\n                    <ResponsiveContainer width=\"100%\" height={200}>\n                      <BarChart data={revenueData}>\n                        <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#334155\" opacity={0.3} />\n                        <XAxis dataKey=\"month\" tick={{ fill: \"#94a3b8\", fontSize: 11 }} axisLine={false} tickLine={false} />\n                        <YAxis tick={{ fill: \"#94a3b8\", fontSize: 11 }} axisLine={false} tickLine={false} />\n                        <Tooltip contentStyle={{ background: \"#1e293b\", border: \"1px solid #334155\", borderRadius: 8, color: \"#f1f5f9\" }} />\n                        <Bar dataKey=\"revenue\" fill=\"#10b981\" radius={[4, 4, 0, 0]} />\n                      </BarChart>\n                    </ResponsiveContainer>\n                    </div>\n                  </CardContent>\n                </Card>\n              </div>\n\n              {/* Pipeline visualization */}\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"text-sm\">Data Pipeline</CardTitle>\n                  <CardDescription>Live processing across ingestion â†’ validation â†’ storage â†’ analytics â†’ export</CardDescription>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"grid gap-4 lg:grid-cols-5\">\n                    <PipelineStage\n                      label=\"Ingestion\"\n                      value={`${members.length} events/min`}\n                      sublabel=\"source: logbook + club\"\n                      progress={(pipelineTick + 10) % 100}\n                    />\n                    <PipelineStage\n                      label=\"Validation\"\n                      value={`${Math.max(1, Math.floor(members.length * 0.9))} checks`}\n                      sublabel=\"schema + compliance\"\n                      progress={(pipelineTick + 30) % 100}\n                    />\n                    <PipelineStage\n                      label=\"Storage\"\n                      value={`${aircraft.length} tables`}\n                      sublabel=\"SQL + object store\"\n                      progress={(pipelineTick + 50) % 100}\n                    />\n                    <PipelineStage\n                      label=\"Analytics\"\n                      value={`${pastFlights.length} reports`}\n                      sublabel=\"totals + trends\"\n                      progress={(pipelineTick + 70) % 100}\n                    />\n                    <PipelineStage\n                      label=\"Export\"\n                      value={`${billing.length} feeds`}\n                      sublabel=\"PDF + CSV + API\"\n                      progress={(pipelineTick + 90) % 100}\n                    />\n                  </div>\n\n                  <div className=\"mt-4 rounded-md border border-border bg-muted/30 px-4 py-3 text-xs text-muted-foreground\">\n                    Animated pipeline reflects current club activity. Values update as live data loads.\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Alerts */}\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"text-sm\">Attention Required</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-2\">\n                  {[\n                    { icon: AlertTriangle, color: \"text-destructive\", msg: \"N172SP oil change overdue â€” 2.3 hrs remaining\" },\n                    { icon: AlertTriangle, color: \"text-chart-3\",     msg: \"Tom Reynolds account suspended â€” $480 overdue balance\" },\n                    { icon: Bell,          color: \"text-primary\",     msg: \"2 flights awaiting dispatch approval\" },\n                    { icon: UserCheck,     color: \"text-chart-2\",     msg: \"Dan Ortega membership pending approval\" },\n                  ].map((a, i) => (\n                    <div key={i} className=\"flex items-center gap-3 rounded-lg border border-border p-3\">\n                      <a.icon className={`h-4 w-4 shrink-0 ${a.color}`} />\n                      <p className=\"text-xs\">{a.msg}</p>\n                      <Button size=\"sm\" variant=\"ghost\" className=\"ml-auto h-6 text-xs\">Review</Button>\n                    </div>\n                  ))}\n                </CardContent>\n              </Card>\n            </>\n          )}\n\n          {/* â”€â”€ AWAITING DISPATCH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}\n          {activeTab === \"awaiting-dispatch\" && (\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <CardTitle className=\"text-sm\">Awaiting Dispatch ({awaitingDispatch.length})</CardTitle>\n                    <CardDescription className=\"text-xs\">\n                      Flights filed and pending release by a dispatcher\n                      {flightsError && (\n                        <span className=\"ml-2 text-destructive\">{flightsError}</span>\n                      )}\n                      {isFlightsLoading && !flightsError && (\n                        <span className=\"ml-2 text-muted-foreground\">Loadingâ€¦</span>\n                      )}\n                    </CardDescription>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-3\">\n                  {awaitingDispatch.map((f) => (\n                    <div key={f.id} className=\"flex items-center justify-between rounded-lg border border-border p-4\">\n                      <div className=\"space-y-1\">\n                        <div className=\"flex items-center gap-2\">\n                          <p className=\"text-sm font-medium\">{f.pilot}</p>\n                          <Badge variant=\"outline\" className=\"text-xs\">{f.aircraft}</Badge>\n                        </div>\n                        <div className=\"flex items-center gap-4 text-xs text-muted-foreground\">\n                          <span className=\"flex items-center gap-1\"><MapPin className=\"h-3 w-3\" />{f.route}</span>\n                          <span className=\"flex items-center gap-1\"><Clock className=\"h-3 w-3\" />Dep: {f.plannedDep}</span>\n                          <span>Filed: {f.filed}</span>\n                        </div>\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        <Button size=\"sm\" variant=\"outline\" className=\"h-7 text-xs\">Deny</Button>\n                        <Button size=\"sm\" className=\"h-7 text-xs\">Dispatch</Button>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n          )}\n\n          {/* â”€â”€ CURRENTLY DISPATCHED â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}\n          {activeTab === \"currently-dispatched\" && (\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <CardTitle className=\"text-sm\">Currently Dispatched ({dispatched.length})</CardTitle>\n                    <CardDescription className=\"text-xs\">\n                      Flights currently airborne with an active dispatch release\n                      {flightsError && (\n                        <span className=\"ml-2 text-destructive\">{flightsError}</span>\n                      )}\n                      {isFlightsLoading && !flightsError && (\n                        <span className=\"ml-2 text-muted-foreground\">Loadingâ€¦</span>\n                      )}\n                    </CardDescription>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-3\">\n                  {dispatched.map((f) => (\n                    <div key={f.id} className=\"flex items-center justify-between rounded-lg border border-primary/30 bg-primary/5 p-4\">\n                      <div className=\"space-y-1\">\n                        <div className=\"flex items-center gap-2\">\n                          <div className=\"h-2 w-2 animate-pulse rounded-full bg-chart-2\" />\n                          <p className=\"text-sm font-medium\">{f.pilot}</p>\n                          <Badge variant=\"outline\" className=\"text-xs\">{f.aircraft}</Badge>\n                          <StatusBadge status={f.status} />\n                        </div>\n                        <div className=\"flex items-center gap-4 text-xs text-muted-foreground\">\n                          <span className=\"flex items-center gap-1\"><MapPin className=\"h-3 w-3\" />{f.route}</span>\n                          <span className=\"flex items-center gap-1\"><Clock className=\"h-3 w-3\" />Dep: {f.departed}</span>\n                          <span>ETA: {f.eta}</span>\n                          <span className=\"flex items-center gap-1\"><Fuel className=\"h-3 w-3\" />{f.fuel} gal planned</span>\n                        </div>\n                      </div>\n                      <Button size=\"sm\" variant=\"outline\" className=\"h-7 text-xs\">Close Out</Button>\n                    </div>\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n          )}\n\n          {/* â”€â”€ PAST FLIGHTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}\n          {activeTab === \"past-flights\" && (\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <CardTitle className=\"text-sm\">Past Flights</CardTitle>\n                    <CardDescription className=\"text-xs\">\n                      Complete flight history for the club\n                      {flightsError && (\n                        <span className=\"ml-2 text-destructive\">{flightsError}</span>\n                      )}\n                      {isFlightsLoading && !flightsError && (\n                        <span className=\"ml-2 text-muted-foreground\">Loadingâ€¦</span>\n                      )}\n                    </CardDescription>\n                  </div>\n                  <Button size=\"sm\" variant=\"outline\" className=\"h-7 gap-1.5 text-xs\">\n                    <Download className=\"h-3 w-3\" /> Export CSV\n                  </Button>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <div className=\"overflow-x-auto\">\n                  <table className=\"w-full text-xs\">\n                    <thead>\n                      <tr className=\"border-b border-border\">\n                        {[\"Pilot\", \"Aircraft\", \"Date\", \"Hobbs\", \"Route\", \"Cost\", \"\"].map(h => (\n                          <th key={h} className=\"pb-2 pr-4 text-left text-[11px] font-semibold uppercase tracking-wide text-muted-foreground\">{h}</th>\n                        ))}\n                      </tr>\n                    </thead>\n                    <tbody>\n                      {pastFlights.map((f) => (\n                        <tr key={f.id} className=\"border-b border-border/50 last:border-0\">\n                          <td className=\"py-2.5 pr-4 font-medium\">{f.pilot}</td>\n                          <td className=\"py-2.5 pr-4\"><Badge variant=\"outline\" className=\"text-xs\">{f.aircraft}</Badge></td>\n                          <td className=\"py-2.5 pr-4 text-muted-foreground\">{f.date}</td>\n                          <td className=\"py-2.5 pr-4\">{f.hobbs} hrs</td>\n                          <td className=\"py-2.5 pr-4 text-muted-foreground\">{f.route}</td>\n                          <td className=\"py-2.5 pr-4 font-medium\">${f.cost}</td>\n                          <td className=\"py-2.5\">\n                            <Button size=\"sm\" variant=\"ghost\" className=\"h-6 text-xs\">View</Button>\n                          </td>\n                        </tr>\n                      ))}\n                    </tbody>\n                  </table>\n                </div>\n              </CardContent>\n            </Card>\n          )}\n\n          {/* â”€â”€ MEMBERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}\n          {activeTab === \"members\" && (\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <CardTitle className=\"text-sm\">Members ({members.length})</CardTitle>\n                    <CardDescription className=\"text-xs\">\n                      All club members and their standing\n                      {membersError && (\n                        <span className=\"ml-2 text-destructive\">{membersError}</span>\n                      )}\n                      {isMembersLoading && !membersError && (\n                        <span className=\"ml-2 text-muted-foreground\">Loadingâ€¦</span>\n                      )}\n                    </CardDescription>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <div className=\"relative\">\n                      <Search className=\"absolute left-2.5 top-1/2 h-3.5 w-3.5 -translate-y-1/2 text-muted-foreground\" />\n                      <input\n                        value={memberSearch}\n                        onChange={e => setMemberSearch(e.target.value)}\n                        placeholder=\"Search members...\"\n                        className=\"h-7 w-48 rounded-md border border-input bg-background pl-8 pr-3 text-xs outline-none focus:ring-1 focus:ring-ring\"\n                      />\n                    </div>\n                    <Button size=\"sm\" className=\"h-7 gap-1.5 text-xs\">\n                      <Plus className=\"h-3 w-3\" /> Invite\n                    </Button>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <div className=\"overflow-x-auto\">\n                  <table className=\"w-full text-xs\">\n                    <thead>\n                      <tr className=\"border-b border-border\">\n                        {[\"Name\", \"Role\", \"Status\", \"Hours\", \"Balance\", \"Medical\", \"Joined\", \"\"].map(h => (\n                          <th key={h} className=\"pb-2 pr-4 text-left text-[11px] font-semibold uppercase tracking-wide text-muted-foreground\">{h}</th>\n                        ))}\n                      </tr>\n                    </thead>\n                    <tbody>\n                      {filteredMembers.map((m) => (\n                        <tr key={m.id} className=\"border-b border-border/50 last:border-0\">\n                          <td className=\"py-2.5 pr-4\">\n                            <div>\n                              <p className=\"font-medium\">{m.name}</p>\n                              <p className=\"text-muted-foreground\">{m.email}</p>\n                            </div>\n                          </td>\n                          <td className=\"py-2.5 pr-4\"><StatusBadge status={m.role} /></td>\n                          <td className=\"py-2.5 pr-4\"><StatusBadge status={m.status} /></td>\n                          <td className=\"py-2.5 pr-4\">{m.hours} hrs</td>\n                          <td className={`py-2.5 pr-4 font-medium ${m.balance < 0 ? \"text-destructive\" : m.balance > 0 ? \"text-chart-2\" : \"\"}`}>\n                            {m.balance < 0 ? `-$${Math.abs(m.balance)}` : m.balance > 0 ? `+$${m.balance}` : \"$0\"}\n                          </td>\n                          <td className=\"py-2.5 pr-4 text-muted-foreground\">{m.medical}</td>\n                          <td className=\"py-2.5 pr-4 text-muted-foreground\">{m.joined}</td>\n                          <td className=\"py-2.5\">\n                            <Button size=\"sm\" variant=\"ghost\" className=\"h-6 text-xs\">Manage</Button>\n                          </td>\n                        </tr>\n                      ))}\n                    </tbody>\n                  </table>\n                </div>\n              </CardContent>\n            </Card>\n          )}\n\n          {/* â”€â”€ AIRCRAFT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}\n          {activeTab === \"aircraft\" && selectedAircraft && (\n            <>\n              {/* Back button */}\n              <Button \n                variant=\"ghost\" \n                size=\"sm\" \n                onClick={() => setSelectedAircraft(null)}\n                className=\"mb-4\"\n              >\n                <ChevronRight className=\"h-4 w-4 rotate-180 mr-1\" />\n                Back to Aircraft List\n              </Button>\n\n              {/* Maintenance History for selected aircraft */}\n              <Card>\n                <CardHeader>\n                  <div className=\"flex items-center justify-between\">\n                    <div>\n                      <CardTitle className=\"text-sm flex items-center gap-2\">\n                        <Wrench className=\"h-4 w-4\" />\n                        Maintenance History: {selectedAircraft}\n                      </CardTitle>\n                      <CardDescription className=\"text-xs\">\n                        Complete maintenance records for this aircraft\n                        {historyError && (\n                          <span className=\"ml-2 text-destructive\">{historyError}</span>\n                        )}\n                        {isHistoryLoading && !historyError && (\n                          <span className=\"ml-2 text-muted-foreground\">Loadingâ€¦</span>\n                        )}\n                      </CardDescription>\n                    </div>\n                    <Button size=\"sm\" variant=\"outline\" className=\"h-7 gap-1.5 text-xs\">\n                      <Download className=\"h-3 w-3\" /> Export\n                    </Button>\n                  </div>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"overflow-x-auto\">\n                    <table className=\"w-full text-xs\">\n                      <thead>\n                        <tr className=\"border-b border-border\">\n                          {[\"Date\", \"Item\", \"Type\", \"Status\", \"Hobbs\", \"Shop\", \"Cost\", \"\"].map(h => (\n                            <th key={h} className=\"pb-2 pr-4 text-left text-[11px] font-semibold uppercase tracking-wide text-muted-foreground\">{h}</th>\n                          ))}\n                        </tr>\n                      </thead>\n                      <tbody>\n                        {(maintenanceHistory as any)[selectedAircraft]?.map((record: any) => (\n                          <tr key={record.id} className=\"border-b border-border/50 last:border-0\">\n                            <td className=\"py-2.5 pr-4\">{record.date}</td>\n                            <td className=\"py-2.5 pr-4 font-medium\">{record.item}</td>\n                            <td className=\"py-2.5 pr-4\">\n                              <Badge variant=\"outline\" className=\"text-xs\">{record.type}</Badge>\n                            </td>\n                            <td className=\"py-2.5 pr-4\">\n                              <StatusBadge status={record.status} />\n                            </td>\n                            <td className=\"py-2.5 pr-4 text-muted-foreground\">{record.hobbs}</td>\n                            <td className=\"py-2.5 pr-4 text-muted-foreground\">{record.shop}</td>\n                            <td className=\"py-2.5 pr-4 font-medium\">${record.cost.toLocaleString()}</td>\n                            <td className=\"py-2.5\">\n                              <Button size=\"sm\" variant=\"ghost\" className=\"h-6 text-xs\">Details</Button>\n                            </td>\n                          </tr>\n                        ))}\n                      </tbody>\n                    </table>\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Summary stats */}\n              <div className=\"grid gap-4 sm:grid-cols-3\">\n                <Card>\n                  <CardHeader className=\"pb-2\">\n                    <CardTitle className=\"text-xs text-muted-foreground\">Total Maintenance Cost</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <p className=\"text-2xl font-bold\">\n                      ${(maintenanceHistory as any)[selectedAircraft]?.reduce((sum: number, r: any) => sum + r.cost, 0).toLocaleString() || 0}\n                    </p>\n                    <p className=\"text-xs text-muted-foreground\">All time</p>\n                  </CardContent>\n                </Card>\n                <Card>\n                  <CardHeader className=\"pb-2\">\n                    <CardTitle className=\"text-xs text-muted-foreground\">Maintenance Events</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <p className=\"text-2xl font-bold\">{(maintenanceHistory as any)[selectedAircraft]?.length || 0}</p>\n                    <p className=\"text-xs text-muted-foreground\">Recorded</p>\n                  </CardContent>\n                </Card>\n                <Card>\n                  <CardHeader className=\"pb-2\">\n                    <CardTitle className=\"text-xs text-muted-foreground\">Average Cost/Event</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <p className=\"text-2xl font-bold\">\n                      ${Math.round((maintenanceHistory as any)[selectedAircraft]?.reduce((sum: number, r: any) => sum + r.cost, 0) / ((maintenanceHistory as any)[selectedAircraft]?.length || 1)) || 0}\n                    </p>\n                    <p className=\"text-xs text-muted-foreground\">Per event</p>\n                  </CardContent>\n                </Card>\n              </div>\n            </>\n          )}\n\n          {activeTab === \"aircraft\" && !selectedAircraft && (\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <CardTitle className=\"text-sm\">Club Aircraft ({aircraft.length})</CardTitle>\n                    <CardDescription className=\"text-xs\">Fleet management and status overview</CardDescription>\n                  </div>\n                  <Button size=\"sm\" className=\"h-7 gap-1.5 text-xs\">\n                    <Plus className=\"h-3 w-3\" /> Add Aircraft\n                  </Button>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <div className=\"grid gap-4 md:grid-cols-2\">\n                  {aircraft.map((ac) => (\n                    <div key={ac.id} className=\"rounded-lg border border-border p-4 space-y-3\">\n                      <div className=\"flex items-start justify-between\">\n                        <div>\n                          <div className=\"flex items-center gap-2\">\n                            <p className=\"text-sm font-semibold\">{ac.nNumber}</p>\n                            <p className=\"text-sm text-muted-foreground\">\"{ac.nickname}\"</p>\n                          </div>\n                          <p className=\"text-xs text-muted-foreground\">{ac.year} {ac.make} {ac.model}</p>\n                        </div>\n                        <StatusBadge status={ac.status} />\n                      </div>\n                      <div className=\"grid grid-cols-3 gap-2 text-xs\">\n                        <div className=\"rounded-md bg-muted/50 p-2\">\n                          <p className=\"text-muted-foreground\">Rate</p>\n                          <p className=\"font-semibold\">${ac.rate}/hr</p>\n                        </div>\n                        <div className=\"rounded-md bg-muted/50 p-2\">\n                          <p className=\"text-muted-foreground\">Hobbs</p>\n                          <p className=\"font-semibold\">{ac.hobbs} hrs</p>\n                        </div>\n                        <div className={`rounded-md p-2 ${ac.mxHours < 10 ? \"bg-destructive/10\" : \"bg-muted/50\"}`}>\n                          <p className=\"text-muted-foreground\">Next MX</p>\n                          <p className={`font-semibold ${ac.mxHours < 10 ? \"text-destructive\" : \"\"}`}>{ac.nextMx}</p>\n                        </div>\n                      </div>\n                      <div className=\"flex gap-2\">\n                        <Button size=\"sm\" variant=\"outline\" className=\"h-7 flex-1 text-xs\">Edit</Button>\n                        <Button \n                          size=\"sm\" \n                          variant=\"outline\" \n                          className=\"h-7 flex-1 text-xs\"\n                          onClick={() => setSelectedAircraft(ac.nNumber)}\n                        >\n                          <Wrench className=\"h-3 w-3 mr-1\" />\n                          History\n                        </Button>\n                        <Button size=\"sm\" variant=\"outline\" className=\"h-7 flex-1 text-xs\">Logbook</Button>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n          )}\n\n          {/* â”€â”€ BILLING / TRANSACTIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}\n          {activeTab === \"billing\" && (\n            <>\n          <div className=\"grid gap-4 sm:grid-cols-3\">\n            {[\n              { label: \"Outstanding Balance\", value: \"-$600\", sub: \"2 members overdue\", color: \"text-destructive\" },\n              { label: \"Collected This Month\", value: \"$9,200\", sub: \"from flights & dues\", color: \"text-chart-2\" },\n              { label: \"Pending Invoices\", value: \"3\", sub: \"awaiting payment\", color: \"text-chart-3\" },\n            ].map((s) => (\n                  <Card key={s.label}>\n                    <CardHeader className=\"pb-2\">\n                      <CardTitle className=\"text-xs text-muted-foreground\">{s.label}</CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <p className={`text-2xl font-bold ${s.color}`}>{s.value}</p>\n                      <p className=\"text-xs text-muted-foreground\">{s.sub}</p>\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n\n              <Card>\n              <CardHeader>\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <CardTitle className=\"text-sm\">Recent Transactions</CardTitle>\n                    <CardDescription className=\"text-xs\">\n                      {billingError && (\n                        <span className=\"text-destructive\">{billingError}</span>\n                      )}\n                      {isBillingLoading && !billingError && (\n                        <span className=\"text-muted-foreground\">Loadingâ€¦</span>\n                      )}\n                    </CardDescription>\n                  </div>\n                </div>\n              </CardHeader>\n                <CardContent>\n                  <div className=\"overflow-x-auto\">\n                    <table className=\"w-full text-xs\">\n                      <thead>\n                        <tr className=\"border-b border-border\">\n                          {[\"Member\", \"Type\", \"Aircraft\", \"Date\", \"Amount\", \"Status\", \"\"].map(h => (\n                            <th key={h} className=\"pb-2 pr-4 text-left text-[11px] font-semibold uppercase tracking-wide text-muted-foreground\">{h}</th>\n                          ))}\n                        </tr>\n                      </thead>\n                      <tbody>\n                        {billing.map((t) => (\n                          <tr key={t.id} className=\"border-b border-border/50 last:border-0\">\n                            <td className=\"py-2.5 pr-4 font-medium\">{t.member}</td>\n                            <td className=\"py-2.5 pr-4 text-muted-foreground\">{t.type}</td>\n                            <td className=\"py-2.5 pr-4\">{t.aircraft !== \"â€”\" ? <Badge variant=\"outline\" className=\"text-xs\">{t.aircraft}</Badge> : \"â€”\"}</td>\n                            <td className=\"py-2.5 pr-4 text-muted-foreground\">{t.date}</td>\n                            <td className=\"py-2.5 pr-4 font-medium\">${t.amount}</td>\n                            <td className=\"py-2.5 pr-4\"><StatusBadge status={t.status} /></td>\n                            <td className=\"py-2.5\">\n                              <Button size=\"sm\" variant=\"ghost\" className=\"h-6 text-xs\">View</Button>\n                            </td>\n                          </tr>\n                        ))}\n                      </tbody>\n                    </table>\n                  </div>\n                </CardContent>\n              </Card>\n            </>\n          )}\n\n          {/* â”€â”€ GENERAL SETTINGS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}\n          {activeTab === \"general-settings\" && (\n            <div className=\"space-y-4\">\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"text-sm\">Club Information</CardTitle>\n                  <CardDescription className=\"text-xs\">Basic details visible to all members</CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  {[\n                    { label: \"Club Name\",        value: club.name,   type: \"text\" },\n                    { label: \"Home Airport ICAO\", value: club.icao,   type: \"text\" },\n                    { label: \"Founded\",           value: club.founded, type: \"text\" },\n                  ].map((f) => (\n                    <div key={f.label} className=\"grid grid-cols-3 items-center gap-4\">\n                      <label className=\"text-xs font-medium text-muted-foreground\">{f.label}</label>\n                      <input defaultValue={f.value} className=\"col-span-2 h-8 rounded-md border border-input bg-background px-3 text-xs outline-none focus:ring-1 focus:ring-ring\" />\n                    </div>\n                  ))}\n                  <div className=\"flex justify-end pt-2\">\n                    <Button size=\"sm\" className=\"h-7 text-xs\">Save Changes</Button>\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"text-sm\">Booking Rules</CardTitle>\n                  <CardDescription className=\"text-xs\">Control how members can schedule aircraft</CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-3\">\n                  {[\n                    { label: \"Max advance booking (days)\", value: \"30\" },\n                    { label: \"Min notice required (hours)\", value: \"2\" },\n                    { label: \"Max booking duration (hours)\", value: \"8\" },\n                    { label: \"Max bookings per member per week\", value: \"5\" },\n                  ].map((r) => (\n                    <div key={r.label} className=\"grid grid-cols-3 items-center gap-4\">\n                      <label className=\"col-span-2 text-xs font-medium text-muted-foreground\">{r.label}</label>\n                      <input defaultValue={r.value} type=\"number\" className=\"h-8 rounded-md border border-input bg-background px-3 text-xs outline-none focus:ring-1 focus:ring-ring\" />\n                    </div>\n                  ))}\n                  <div className=\"flex justify-end pt-2\">\n                    <Button size=\"sm\" className=\"h-7 text-xs\">Save Changes</Button>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          )}\n\n          {/* â”€â”€ FUEL APPROVALS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}\n          {activeTab === \"fuel-approvals\" && (\n            <>\n              {/* Summary cards */}\n              <div className=\"grid gap-4 sm:grid-cols-3\">\n                <Card>\n                  <CardHeader className=\"pb-2\">\n                    <CardTitle className=\"text-xs text-muted-foreground\">Pending Approval</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <p className=\"text-2xl font-bold text-chart-3\">{fuelExpenses.filter(f => f.status === \"PENDING\").length}</p>\n                    <p className=\"text-xs text-muted-foreground\">expenses waiting</p>\n                  </CardContent>\n                </Card>\n                <Card>\n                  <CardHeader className=\"pb-2\">\n                    <CardTitle className=\"text-xs text-muted-foreground\">Total Pending</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <p className=\"text-2xl font-bold\">${fuelExpenses.filter(f => f.status === \"PENDING\").reduce((sum, f) => sum + f.total, 0).toFixed(2)}</p>\n                    <p className=\"text-xs text-muted-foreground\">fuel expenses</p>\n                  </CardContent>\n                </Card>\n                <Card>\n                  <CardHeader className=\"pb-2\">\n                    <CardTitle className=\"text-xs text-muted-foreground\">This Month</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    {/* TODO: Replace with real month stats from API */}\n                    <p className=\"text-2xl font-bold text-chart-2\">$540.87</p>\n                    <p className=\"text-xs text-muted-foreground\">approved fuel</p>\n                  </CardContent>\n                </Card>\n              </div>\n\n              {/* Pending expenses list */}\n              <Card>\n                <CardHeader>\n                  <div className=\"flex items-center justify-between\">\n                    <div>\n                      <CardTitle className=\"text-sm\">Pending Fuel Expenses</CardTitle>\n                      <CardDescription className=\"text-xs\">\n                        Review and approve fuel expenses submitted after flights\n                        {fuelError && (\n                          <span className=\"ml-2 text-destructive\">{fuelError}</span>\n                        )}\n                        {isFuelLoading && !fuelError && (\n                          <span className=\"ml-2 text-muted-foreground\">Loading\u001a\u001a\u001a</span>\n                        )}\n                      </CardDescription>\n                    </div>\n                    <Button size=\"sm\" variant=\"outline\" className=\"h-7 gap-1.5 text-xs\">\n                      <Download className=\"h-3 w-3\" /> Export\n                    </Button>\n                  </div>\n                </CardHeader>\n                  <CardContent>\n                    <div className=\"space-y-3\">\n                    {fuelExpenses.filter(f => f.status === \"PENDING\").map((fuel) => (\n                      <div key={fuel.id} className=\"flex items-center justify-between rounded-lg border border-border p-4\">\n                        <div className=\"space-y-1\">\n                          <div className=\"flex items-center gap-2\">\n                            <p className=\"text-sm font-medium\">{fuel.pilot}</p>\n                            <Badge variant=\"outline\" className=\"text-xs\">{fuel.aircraft}</Badge>\n                            <StatusBadge status=\"Pending\" />\n                          </div>\n                          <div className=\"flex items-center gap-4 text-xs text-muted-foreground\">\n                            <span className=\"flex items-center gap-1\"><Calendar className=\"h-3 w-3\" />{fuel.date}</span>\n                            <span className=\"flex items-center gap-1\"><Fuel className=\"h-3 w-3\" />{fuel.gallons} gal @ ${fuel.pricePerGal}/gal</span>\n                            <span>Submitted: {fuel.submittedAt}</span>\n                          </div>\n                        </div>\n                        <div className=\"flex items-center gap-4\">\n                          <div className=\"text-right\">\n                            <p className=\"text-sm font-bold\">${fuel.total.toFixed(2)}</p>\n                          </div>\n                        <div className=\"flex items-center gap-2\">\n                            <Button\n                              size=\"sm\"\n                              variant=\"outline\"\n                              className=\"h-7 text-xs\"\n                              disabled={isFuelLoading || fuelActionId === fuel.id}\n                              onClick={() => handleFuelAction(fuel.id, 'deny')}\n                            >\n                              Deny\n                            </Button>\n                            <Button\n                              size=\"sm\"\n                              className=\"h-7 text-xs\"\n                              disabled={isFuelLoading || fuelActionId === fuel.id}\n                              onClick={() => handleFuelAction(fuel.id, 'approve')}\n                            >\n                              Approve\n                            </Button>\n                          </div>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Approved history */}\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"text-sm\">Recently Approved</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"overflow-x-auto\">\n                    <table className=\"w-full text-xs\">\n                      <thead>\n                        <tr className=\"border-b border-border\">\n                          {[\"Pilot\", \"Aircraft\", \"Date\", \"Gallons\", \"Rate\", \"Total\", \"Status\", \"Approved\"].map(h => (\n                            <th key={h} className=\"pb-2 pr-4 text-left text-[11px] font-semibold uppercase tracking-wide text-muted-foreground\">{h}</th>\n                          ))}\n                        </tr>\n                      </thead>\n                      <tbody>\n                        {fuelExpenses.filter(f => f.status === \"APPROVED\").map((fuel) => (\n                          <tr key={fuel.id} className=\"border-b border-border/50 last:border-0\">\n                            <td className=\"py-2.5 pr-4 font-medium\">{fuel.pilot}</td>\n                            <td className=\"py-2.5 pr-4\"><Badge variant=\"outline\" className=\"text-xs\">{fuel.aircraft}</Badge></td>\n                            <td className=\"py-2.5 pr-4 text-muted-foreground\">{fuel.date}</td>\n                            <td className=\"py-2.5 pr-4\">{fuel.gallons}</td>\n                            <td className=\"py-2.5 pr-4 text-muted-foreground\">${fuel.pricePerGal}</td>\n                            <td className=\"py-2.5 pr-4 font-medium\">${fuel.total.toFixed(2)}</td>\n                            <td className=\"py-2.5 pr-4\"><StatusBadge status=\"Approved\" /></td>\n                            <td className=\"py-2.5 pr-4 text-muted-foreground\">{fuel.approvedAt ? new Date(fuel.approvedAt).toLocaleDateString() : '-'}</td>\n                          </tr>\n                        ))}\n                      </tbody>\n                    </table>\n                  </div>\n                </CardContent>\n              </Card>\n            </>\n          )}\n\n          {/* â”€â”€ MAINTENANCE REVIEWS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}\n          {activeTab === \"maintenance-reviews\" && (\n            <>\n              {/* Summary cards */}\n              <div className=\"grid gap-4 sm:grid-cols-3\">\n                <Card>\n                  <CardHeader className=\"pb-2\">\n                    <CardTitle className=\"text-xs text-muted-foreground\">Pending Review</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <p className=\"text-2xl font-bold text-chart-3\">{maintenanceIssues.length}</p>\n                    <p className=\"text-xs text-muted-foreground\">issues reported</p>\n                  </CardContent>\n                </Card>\n                <Card>\n                  <CardHeader className=\"pb-2\">\n                    <CardTitle className=\"text-xs text-muted-foreground\">High Priority</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <p className=\"text-2xl font-bold text-destructive\">{maintenanceIssues.filter(m => m.severity === \"high\").length}</p>\n                    <p className=\"text-xs text-muted-foreground\">require attention</p>\n                  </CardContent>\n                </Card>\n                <Card>\n                  <CardHeader className=\"pb-2\">\n                    <CardTitle className=\"text-xs text-muted-foreground\">Plane-Specific</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <p className=\"text-2xl font-bold text-chart-4\">{maintenanceIssues.filter(m => m.isPlaneSpecific).length}</p>\n                    <p className=\"text-xs text-muted-foreground\">need inspection</p>\n                  </CardContent>\n                </Card>\n              </div>\n\n              {/* Pending issues list */}\n              <Card>\n                <CardHeader>\n                  <div className=\"flex items-center justify-between\">\n                      <div>\n                        <CardTitle className=\"text-sm\">Maintenance Issues Requiring Review</CardTitle>\n                        <CardDescription className=\"text-xs\">\n                          Plane-specific issues reported by pilots after flights\n                          {issuesError && (\n                            <span className=\"ml-2 text-destructive\">{issuesError}</span>\n                          )}\n                          {isIssuesLoading && !issuesError && (\n                            <span className=\"ml-2 text-muted-foreground\">Loadingâ€¦</span>\n                          )}\n                        </CardDescription>\n                      </div>\n                    <Button size=\"sm\" variant=\"outline\" className=\"h-7 gap-1.5 text-xs\">\n                      <Download className=\"h-3 w-3\" /> Export\n                    </Button>\n                  </div>\n                </CardHeader>\n                  <CardContent>\n                  <div className=\"space-y-3\">\n                    {maintenanceIssues.map((issue) => (\n                      <div key={issue.id} className={`flex items-center justify-between rounded-lg border p-4 ${issue.severity === \"high\" ? \"border-destructive/50 bg-destructive/5\" : \"border-border\"}`}>\n                        <div className=\"space-y-1\">\n                          <div className=\"flex items-center gap-2\">\n                            <p className=\"text-sm font-medium\">{issue.pilot}</p>\n                            <Badge variant=\"outline\" className=\"text-xs\">{issue.aircraft}</Badge>\n                            <Badge variant={issue.severity === \"high\" ? \"destructive\" : issue.severity === \"medium\" ? \"default\" : \"secondary\"} className=\"text-xs\">\n                              {issue.severity === \"high\" ? \"High\" : issue.severity === \"medium\" ? \"Medium\" : \"Low\"}\n                            </Badge>\n                            {issue.isPlaneSpecific && (\n                              <Badge variant=\"outline\" className=\"border-chart-4/50 text-chart-4 text-xs\">Plane-Specific</Badge>\n                            )}\n                            {!issue.isPlaneSpecific && (\n                              <Badge variant=\"outline\" className=\"border-muted-foreground/30 text-muted-foreground text-xs\">Generic</Badge>\n                            )}\n                          </div>\n                          <p className=\"text-sm\">{issue.issue}</p>\n                          <div className=\"flex items-center gap-4 text-xs text-muted-foreground\">\n                            <span className=\"flex items-center gap-1\"><Calendar className=\"h-3 w-3\" />{issue.date}</span>\n                            <span className=\"flex items-center gap-1\"><Wrench className=\"h-3 w-3\" />{issue.category}</span>\n                            <span>Flight: {issue.flightId}</span>\n                          </div>\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                          <Button\n                            size=\"sm\"\n                            variant=\"outline\"\n                            className=\"h-7 text-xs\"\n                            disabled={isIssuesLoading || maintenanceActionId === issue.id}\n                            onClick={() => handleMaintenanceAction(issue.id, \"dismiss\")}\n                          >\n                            Dismiss\n                          </Button>\n                          <Button\n                            size=\"sm\"\n                            className=\"h-7 text-xs\"\n                            disabled={isIssuesLoading || maintenanceActionId === issue.id}\n                            onClick={() => handleMaintenanceAction(issue.id, \"create-work-order\")}\n                          >\n                            Create Work Order\n                          </Button>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Info card */}\n              <Card className=\"border-primary/30 bg-primary/5\">\n                <CardContent className=\"pt-6\">\n                  <div className=\"flex items-start gap-4\">\n                    <div className=\"rounded-full bg-primary/10 p-2\">\n                      <Wrench className=\"h-5 w-5 text-primary\" />\n                    </div>\n                    <div>\n                      <h4 className=\"text-sm font-semibold\">How Maintenance Reviews Work</h4>\n                      <p className=\"mt-1 text-xs text-muted-foreground\">\n                        When pilots report issues during flight completion, they can mark them as \"Plane-Specific\" (affecting only that aircraft) \n                        or \"Generic\" (could apply to any aircraft). Plane-specific issues require admin review and may generate work orders. \n                        Generic issues are logged for general tracking but don't require immediate action.\n                      </p>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            </>\n          )}\n\n          {/* â”€â”€ PLACEHOLDER SECTIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}\n          {activeTab === \"instructors\" && <PlaceholderPanel title=\"Instructors\" description=\"Manage CFIs and CFIIs who can log dual instruction in club aircraft.\" />}\n          {activeTab === \"administrators\" && <PlaceholderPanel title=\"Administrators\" description=\"Manage club admins, owners, and dispatch roles.\" />}\n          {activeTab === \"groups\" && <PlaceholderPanel title=\"Groups\" description=\"Segment members into groups for permissions, rates, and access rules.\" />}\n          {activeTab === \"items\" && <PlaceholderPanel title=\"Items\" description=\"Billable line items such as fuel, instruction charges, and add-ons.\" />}\n          {activeTab === \"adjustments\" && <PlaceholderPanel title=\"Adjustments\" description=\"Manual credits and debits applied to member account balances.\" />}\n          {activeTab === \"forms\" && <PlaceholderPanel title=\"Forms\" description=\"Pre-flight and post-flight forms required for dispatch and closeout.\" />}\n          {activeTab === \"invoices\" && <PlaceholderPanel title=\"Invoices\" description=\"Generate and send invoices to members for dues, flights, and fees.\" />}\n          {activeTab === \"member-settings\" && <PlaceholderPanel title=\"Member Settings\" description=\"Configure self-registration, required documents, and profile fields.\" />}\n          {activeTab === \"schedule-settings\" && <PlaceholderPanel title=\"Schedule Settings\" description=\"Set operating hours, blackout dates, and scheduling constraints.\" />}\n\n          {/* â”€â”€ NOTIFICATION SETTINGS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}\n          {activeTab === \"notification-settings\" && (\n            <div className=\"space-y-6\">\n              {/* Email Notifications */}\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"text-sm\">Email Notifications</CardTitle>\n                  <CardDescription className=\"text-xs\">Configure what email alerts members receive</CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  {[\n                    { id: \"booking-confirmed\", label: \"Booking Confirmed\", description: \"When a flight is booked\", enabled: true },\n                    { id: \"booking-reminder\", label: \"Flight Reminder\", description: \"24 hours before scheduled flight\", enabled: true },\n                    { id: \"maintenance-alert\", label: \"Maintenance Alerts\", description: \"When aircraft maintenance is due\", enabled: true },\n                    { id: \"billing-reminder\", label: \"Billing Reminders\", description: \"Due invoices and overdue balances\", enabled: true },\n                    { id: \"club-announcements\", label: \"Club Announcements\", description: \"News and updates from club admins\", enabled: false },\n                    { id: \"weather-alerts\", label: \"Weather Alerts\", description: \"METAR/TAF changes at home airport\", enabled: false },\n                  ].map((item) => (\n                    <div key={item.id} className=\"flex items-center justify-between rounded-lg border border-border p-3\">\n                      <div className=\"space-y-0.5\">\n                        <p className=\"text-sm font-medium\">{item.label}</p>\n                        <p className=\"text-xs text-muted-foreground\">{item.description}</p>\n                      </div>\n                      <button \n                        className={`relative h-6 w-11 rounded-full transition-colors ${item.enabled ? 'bg-primary' : 'bg-muted'}`}\n                        onClick={() => alert(`Toggle ${item.label} - Demo only`)}\n                      >\n                        <span className={`absolute top-1 h-4 w-4 rounded-full bg-white transition-transform ${item.enabled ? 'left-6' : 'left-1'}`} />\n                      </button>\n                    </div>\n                  ))}\n                </CardContent>\n              </Card>\n\n              {/* Push Notifications */}\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"text-sm\">Push Notifications</CardTitle>\n                  <CardDescription className=\"text-xs\">Mobile app push notification preferences</CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  {[\n                    { id: \"flight-dispatched\", label: \"Flight Dispatched\", description: \"When your flight is released\", enabled: true },\n                    { id: \"flight-landing\", label: \"Flight Completed\", description: \"When aircraft lands\", enabled: true },\n                    { id: \"maintenance-grounded\", label: \"Aircraft Grounded\", description: \"When aircraft becomes unavailable\", enabled: true },\n                    { id: \"schedule-changes\", label: \"Schedule Changes\", description: \"When bookings are modified\", enabled: false },\n                  ].map((item) => (\n                    <div key={item.id} className=\"flex items-center justify-between rounded-lg border border-border p-3\">\n                      <div className=\"space-y-0.5\">\n                        <p className=\"text-sm font-medium\">{item.label}</p>\n                        <p className=\"text-xs text-muted-foreground\">{item.description}</p>\n                      </div>\n                      <button \n                        className={`relative h-6 w-11 rounded-full transition-colors ${item.enabled ? 'bg-primary' : 'bg-muted'}`}\n                        onClick={() => alert(`Toggle ${item.label} - Demo only`)}\n                      >\n                        <span className={`absolute top-1 h-4 w-4 rounded-full bg-white transition-transform ${item.enabled ? 'left-6' : 'left-1'}`} />\n                      </button>\n                    </div>\n                  ))}\n                </CardContent>\n              </Card>\n\n              {/* Notification Timing */}\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"text-sm\">Notification Timing</CardTitle>\n                  <CardDescription className=\"text-xs\">When to send daily/weekly summaries</CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"grid gap-4 md:grid-cols-2\">\n                    <div className=\"space-y-2\">\n                      <label className=\"text-xs font-medium\">Daily Summary Time</label>\n                      <select className=\"h-8 w-full rounded-md border border-input bg-background px-3 text-xs\">\n                        <option>6:00 AM</option>\n                        <option>7:00 AM</option>\n                        <option selected>8:00 AM</option>\n                        <option>9:00 AM</option>\n                      </select>\n                    </div>\n                    <div className=\"space-y-2\">\n                      <label className=\"text-xs font-medium\">Weekly Report Day</label>\n                      <select className=\"h-8 w-full rounded-md border border-input bg-background px-3 text-xs\">\n                        <option>Monday</option>\n                        <option selected>Wednesday</option>\n                        <option>Friday</option>\n                        <option>Saturday</option>\n                      </select>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center justify-between rounded-lg border border-border p-3\">\n                    <div className=\"space-y-0.5\">\n                      <p className=\"text-sm font-medium\">Weekly Flight Summary</p>\n                      <p className=\"text-xs text-muted-foreground\">Send weekly recap of flight hours and expenses</p>\n                    </div>\n                    <button className=\"relative h-6 w-11 rounded-full bg-primary\">\n                      <span className=\"absolute top-1 left-6 h-4 w-4 rounded-full bg-white\" />\n                    </button>\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Save Button */}\n              <div className=\"flex justify-end\">\n                <Button size=\"sm\" className=\"h-8 text-xs\">Save Notification Settings</Button>\n              </div>\n            </div>\n          )}\n\n          {activeTab === \"add-ons\" && <PlaceholderPanel title=\"Add-ons\" description=\"Enable premium features: weather briefings, ATIS, fuel ordering, and more.\" />}\n\n        </div>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\flying-club\\billing\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Calendar' is defined but never used.","line":14,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":11,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Calendar"},"fix":{"range":[428,440],"text":""},"desc":"Remove unused variable \"Calendar\"."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\David\\next-dashboard\\app\\flying-club\\billing\\page.tsx:80:5\n  78 |\n  79 |   useEffect(() => {\n> 80 |     setBillingRuns(demoBillingRuns)\n     |     ^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  81 |     setInvoices(demoInvoices)\n  82 |     setAircraftStats(demoAircraftStats)\n  83 |     setLoading(false)","line":80,"column":5,"nodeType":null,"endLine":80,"endColumn":19}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { useSession } from 'next-auth/react'\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Badge } from '@/components/ui/badge'\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'\nimport { \n  DollarSign,\n  Receipt,\n  Play,\n  RefreshCw,\n  Calendar,\n  Plane,\n  CheckCircle,\n  XCircle,\n  AlertCircle,\n  Eye,\n  Clock,\n} from 'lucide-react'\n\ninterface BillingRun {\n  id: string\n  startedAt: string\n  completedAt: string | null\n  status: 'running' | 'completed' | 'failed'\n  totalAmount: number | null\n  successCount: number | null\n  failureCount: number | null\n}\n\ninterface Invoice {\n  id: string\n  userId: string\n  userName: string\n  userEmail: string\n  totalAmount: number\n  status: 'pending' | 'paid' | 'failed'\n  createdAt: string\n}\n\ninterface AircraftStats {\n  id: string\n  name: string\n  totalHobbs: number\n  totalRevenue: number\n  flightCount: number\n}\n\n// Demo data\nconst demoBillingRuns: BillingRun[] = [\n  { id: '1', startedAt: '2024-02-01T00:00:00Z', completedAt: '2024-02-01T00:05:00Z', status: 'completed', totalAmount: 4250.00, successCount: 12, failureCount: 0 },\n  { id: '2', startedAt: '2024-01-01T00:00:00Z', completedAt: '2024-01-01T00:03:00Z', status: 'completed', totalAmount: 3890.50, successCount: 11, failureCount: 1 },\n  { id: '3', startedAt: '2023-12-01T00:00:00Z', completedAt: '2023-12-01T00:04:00Z', status: 'completed', totalAmount: 5120.00, successCount: 15, failureCount: 0 },\n]\n\nconst demoInvoices: Invoice[] = [\n  { id: 'inv-001', userId: 'user-1', userName: 'John Smith', userEmail: 'john@example.com', totalAmount: 485.50, status: 'pending', createdAt: '2024-02-01T00:00:00Z' },\n  { id: 'inv-002', userId: 'user-2', userName: 'Sarah Johnson', userEmail: 'sarah@example.com', totalAmount: 320.00, status: 'paid', createdAt: '2024-02-01T00:00:00Z' },\n  { id: 'inv-003', userId: 'user-3', userName: 'Mike Davis', userEmail: 'mike@example.com', totalAmount: 675.25, status: 'pending', createdAt: '2024-02-01T00:00:00Z' },\n  { id: 'inv-004', userId: 'user-4', userName: 'Emily Chen', userEmail: 'emily@example.com', totalAmount: 210.00, status: 'paid', createdAt: '2024-01-01T00:00:00Z' },\n]\n\nconst demoAircraftStats: AircraftStats[] = [\n  { id: '1', name: 'N123AB (C172)', totalHobbs: 145.5, totalRevenue: 7275.00, flightCount: 28 },\n  { id: '2', name: 'N456CD (C182)', totalHobbs: 98.2, totalRevenue: 9810.00, flightCount: 15 },\n  { id: '3', name: 'N789EF (PA28)', totalHobbs: 210.8, totalRevenue: 8420.00, flightCount: 35 },\n]\n\nexport default function BillingDashboardPage() {\n  const { data: session, status } = useSession()\n  const [loading, setLoading] = useState(true)\n  const [running, setRunning] = useState(false)\n  const [billingRuns, setBillingRuns] = useState<BillingRun[]>([])\n  const [invoices, setInvoices] = useState<Invoice[]>([])\n  const [aircraftStats, setAircraftStats] = useState<AircraftStats[]>([])\n\n  useEffect(() => {\n    setBillingRuns(demoBillingRuns)\n    setInvoices(demoInvoices)\n    setAircraftStats(demoAircraftStats)\n    setLoading(false)\n  }, [session])\n\n  const handleRunBilling = async () => {\n    setRunning(true)\n    await new Promise(resolve => setTimeout(resolve, 2000))\n    const newRun: BillingRun = {\n      id: crypto.randomUUID(),\n      startedAt: new Date().toISOString(),\n      completedAt: new Date().toISOString(),\n      status: 'completed',\n      totalAmount: 4560.75,\n      successCount: 13,\n      failureCount: 0,\n    }\n    setBillingRuns([newRun, ...billingRuns])\n    setRunning(false)\n  }\n\n  const formatCurrency = (amount: number) => new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(amount)\n  const formatDate = (dateString: string) => new Date(dateString).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' })\n\n  const getStatusIcon = (status: string) => {\n    switch (status) {\n      case 'completed': return <CheckCircle className=\"h-4 w-4 text-green-500\" />\n      case 'running': return <RefreshCw className=\"h-4 w-4 text-blue-500 animate-spin\" />\n      case 'failed': return <XCircle className=\"h-4 w-4 text-red-500\" />\n      default: return <AlertCircle className=\"h-4 w-4 text-muted-foreground\" />\n    }\n  }\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case 'completed': return 'bg-green-500/10 text-green-600 border-green-500/30'\n      case 'running': return 'bg-blue-500/10 text-blue-600 border-blue-500/30'\n      case 'failed': return 'bg-red-500/10 text-red-600 border-red-500/30'\n      default: return ''\n    }\n  }\n\n  const stats = {\n    totalRevenue: billingRuns.reduce((sum, run) => sum + (run.totalAmount || 0), 0),\n    pendingAmount: invoices.filter(i => i.status === 'pending').reduce((sum, i) => sum + i.totalAmount, 0),\n    collectedAmount: invoices.filter(i => i.status === 'paid').reduce((sum, i) => sum + i.totalAmount, 0),\n  }\n\n  if (status === 'loading' || loading) {\n    return <div className=\"min-h-screen bg-background flex items-center justify-center\"><RefreshCw className=\"h-8 w-8 animate-spin text-primary\" /></div>\n  }\n\n  if (!session) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center p-4\">\n        <Card className=\"max-w-md w-full\">\n          <CardContent className=\"pt-6 text-center\">\n            <DollarSign className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground\" />\n            <h2 className=\"text-xl font-bold mb-2\">Hobbs Billing Dashboard</h2>\n            <p className=\"text-muted-foreground mb-4\">Sign in to manage club billing</p>\n            <Button asChild><a href=\"/login\">Sign In</a></Button>\n          </CardContent>\n        </Card>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background p-4 md:p-8 pt-16\">\n      <div className=\"max-w-7xl mx-auto space-y-6\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold flex items-center gap-2\">\n              <DollarSign className=\"h-8 w-8\" />\n              Hobbs Billing\n            </h1>\n            <p className=\"text-muted-foreground\">Automated hourly billing based on aircraft hobbs time</p>\n          </div>\n          <Button onClick={handleRunBilling} disabled={running} className=\"gap-2\">\n            {running ? <RefreshCw className=\"h-4 w-4 animate-spin\" /> : <Play className=\"h-4 w-4\" />}\n            {running ? 'Running Billing...' : 'Run Monthly Billing'}\n          </Button>\n        </div>\n\n        {/* Summary Cards */}\n        <div className=\"grid gap-4 md:grid-cols-4\">\n          <Card>\n            <CardContent className=\"pt-4\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Total Revenue (YTD)</p>\n                  <p className=\"text-2xl font-bold\">{formatCurrency(stats.totalRevenue)}</p>\n                </div>\n                <DollarSign className=\"h-8 w-8 text-muted-foreground\" />\n              </div>\n            </CardContent>\n          </Card>\n          <Card className=\"border-amber-500/30\">\n            <CardContent className=\"pt-4\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Pending</p>\n                  <p className=\"text-2xl font-bold text-amber-600\">{formatCurrency(stats.pendingAmount)}</p>\n                </div>\n                <Clock className=\"h-8 w-8 text-amber-500\" />\n              </div>\n            </CardContent>\n          </Card>\n          <Card className=\"border-green-500/30\">\n            <CardContent className=\"pt-4\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Collected</p>\n                  <p className=\"text-2xl font-bold text-green-600\">{formatCurrency(stats.collectedAmount)}</p>\n                </div>\n                <CheckCircle className=\"h-8 w-8 text-green-500\" />\n              </div>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardContent className=\"pt-4\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Total Invoices</p>\n                  <p className=\"text-2xl font-bold\">{invoices.length}</p>\n                </div>\n                <Receipt className=\"h-8 w-8 text-muted-foreground\" />\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Aircraft Revenue */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\"><Plane className=\"h-5 w-5\" />Aircraft Revenue</CardTitle>\n            <CardDescription>Hobbs hours and revenue by aircraft</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid gap-4 md:grid-cols-3\">\n              {aircraftStats.map((aircraft) => (\n                <div key={aircraft.id} className=\"p-4 rounded-lg border bg-card\">\n                  <div className=\"flex items-center justify-between mb-3\">\n                    <h3 className=\"font-semibold\">{aircraft.name}</h3>\n                    <Badge variant=\"outline\">{aircraft.flightCount} flights</Badge>\n                  </div>\n                  <div className=\"grid grid-cols-2 gap-3 text-sm\">\n                    <div>\n                      <p className=\"text-muted-foreground\">Total Hobbs</p>\n                      <p className=\"font-medium\">{aircraft.totalHobbs.toFixed(1)} hrs</p>\n                    </div>\n                    <div>\n                      <p className=\"text-muted-foreground\">Revenue</p>\n                      <p className=\"font-medium text-green-600\">{formatCurrency(aircraft.totalRevenue)}</p>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Tabs */}\n        <Tabs defaultValue=\"runs\">\n          <TabsList>\n            <TabsTrigger value=\"runs\">Billing Runs</TabsTrigger>\n            <TabsTrigger value=\"invoices\">Invoices</TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"runs\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Billing History</CardTitle>\n                <CardDescription>Previous billing cycles and results</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <table className=\"w-full\">\n                  <thead>\n                    <tr className=\"border-b\">\n                      <th className=\"text-left p-3 font-medium\">Date</th>\n                      <th className=\"text-center p-3 font-medium\">Status</th>\n                      <th className=\"text-right p-3 font-medium\">Amount</th>\n                      <th className=\"text-center p-3 font-medium\">Success</th>\n                      <th className=\"text-center p-3 font-medium\">Failed</th>\n                      <th className=\"text-right p-3 font-medium\">Actions</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    {billingRuns.map((run) => (\n                      <tr key={run.id} className=\"border-b hover:bg-muted/50\">\n                        <td className=\"p-3\"><span>{formatDate(run.startedAt)}</span></td>\n                        <td className=\"p-3\"><Badge className={getStatusColor(run.status)}>{getStatusIcon(run.status)}<span className=\"ml-1 capitalize\">{run.status}</span></Badge></td>\n                        <td className=\"p-3 text-right font-medium\">{run.totalAmount ? formatCurrency(run.totalAmount) : '-'}</td>\n                        <td className=\"p-3 text-center text-green-600\">{run.successCount ?? '-'}</td>\n                        <td className=\"p-3 text-center\">{run.failureCount ?? '-'}</td>\n                        <td className=\"p-3 text-right\"><Button variant=\"ghost\" size=\"sm\"><Eye className=\"h-4 w-4 mr-1\" />View</Button></td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"invoices\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Invoice Management</CardTitle>\n                <CardDescription>View and manage member invoices</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <table className=\"w-full\">\n                  <thead>\n                    <tr className=\"border-b\">\n                      <th className=\"text-left p-3 font-medium\">Member</th>\n                      <th className=\"text-left p-3 font-medium\">Date</th>\n                      <th className=\"text-right p-3 font-medium\">Amount</th>\n                      <th className=\"text-center p-3 font-medium\">Status</th>\n                      <th className=\"text-right p-3 font-medium\">Actions</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    {invoices.map((invoice) => (\n                      <tr key={invoice.id} className=\"border-b hover:bg-muted/50\">\n                        <td className=\"p-3\">\n                          <div>\n                            <p className=\"font-medium\">{invoice.userName}</p>\n                            <p className=\"text-sm text-muted-foreground\">{invoice.userEmail}</p>\n                          </div>\n                        </td>\n                        <td className=\"p-3\">{formatDate(invoice.createdAt)}</td>\n                        <td className=\"p-3 text-right font-medium\">{formatCurrency(invoice.totalAmount)}</td>\n                        <td className=\"p-3 text-center\">\n                          <Badge className={invoice.status === 'paid' ? 'bg-green-500/10 text-green-600' : invoice.status === 'pending' ? 'bg-amber-500/10 text-amber-600' : 'bg-red-500/10 text-red-600'}>\n                            {invoice.status}\n                          </Badge>\n                        </td>\n                        <td className=\"p-3 text-right\"><Button variant=\"ghost\" size=\"sm\"><Eye className=\"h-4 w-4 mr-1\" />View</Button></td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </CardContent>\n            </Card>\n          </TabsContent>\n        </Tabs>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\flying-club\\calendar-sync\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Input' is defined but never used.","line":8,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":15,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Input"},"fix":{"range":[294,340],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Link2' is defined but never used.","line":10,"column":31,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":36,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Link2"},"fix":{"range":[414,421],"text":""},"desc":"Remove unused variable \"Link2\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AlertTriangle' is defined but never used.","line":10,"column":69,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":82,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"AlertTriangle"},"fix":{"range":[452,467],"text":""},"desc":"Remove unused variable \"AlertTriangle\"."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\David\\next-dashboard\\app\\flying-club\\calendar-sync\\page.tsx:48:5\n  46 |\n  47 |   useEffect(() => {\n> 48 |     setIntegrations(demoIntegrations)\n     |     ^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  49 |     setLoading(false)\n  50 |   }, [session])\n  51 |","line":48,"column":5,"nodeType":null,"endLine":48,"endColumn":20}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { useSession } from 'next-auth/react'\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Badge } from '@/components/ui/badge'\nimport { Input } from '@/components/ui/input'\nimport { Label } from '@/components/ui/label'\nimport { RefreshCw, Calendar, Link2, Download, ExternalLink, Check, AlertTriangle, Trash2, Plus } from 'lucide-react'\n\ninterface CalendarIntegration {\n  id: string\n  type: 'google' | 'ical'\n  name: string\n  enabled: boolean\n  lastSync: string | null\n  aircraftId: string | null\n  aircraftName: string | null\n}\n\ninterface ClubAircraft {\n  id: string\n  nNumber: string\n  customName: string\n}\n\nconst demoIntegrations: CalendarIntegration[] = [\n  { id: '1', type: 'google', name: 'Google Calendar - N123AB', enabled: true, lastSync: '2024-02-20T10:00:00Z', aircraftId: '1', aircraftName: 'N123AB (C172)' },\n  { id: '2', type: 'ical', name: 'Outlook - N456CD', enabled: true, lastSync: '2024-02-19T15:30:00Z', aircraftId: '2', aircraftName: 'N456CD (C182)' },\n]\n\nconst demoAircraft: ClubAircraft[] = [\n  { id: '1', nNumber: 'N123AB', customName: 'Cessna 172' },\n  { id: '2', nNumber: 'N456CD', customName: 'Cessna 182' },\n  { id: '3', nNumber: 'N789EF', customName: 'Piper Archer' },\n]\n\nexport default function CalendarSyncPage() {\n  const { data: session, status } = useSession()\n  const [loading, setLoading] = useState(true)\n  const [integrations, setIntegrations] = useState<CalendarIntegration[]>([])\n  const [syncing, setSyncing] = useState<string | null>(null)\n  const [showAddModal, setShowAddModal] = useState(false)\n  const [newIntegration, setNewIntegration] = useState({ type: 'google' as 'google' | 'ical', aircraftId: '' })\n\n  useEffect(() => {\n    setIntegrations(demoIntegrations)\n    setLoading(false)\n  }, [session])\n\n  const handleConnectGoogle = (aircraftId: string) => {\n    // In production, this would redirect to OAuth\n    const aircraft = demoAircraft.find(a => a.id === aircraftId)\n    const newInt: CalendarIntegration = {\n      id: crypto.randomUUID(),\n      type: 'google',\n      name: `Google Calendar - ${aircraft?.nNumber}`,\n      enabled: true,\n      lastSync: new Date().toISOString(),\n      aircraftId,\n      aircraftName: aircraft?.customName || aircraft?.nNumber || null,\n    }\n    setIntegrations([...integrations, newInt])\n    setShowAddModal(false)\n  }\n\n  const handleGenerateICal = (aircraftId: string) => {\n    const aircraft = demoAircraft.find(a => a.id === aircraftId)\n    const icalContent = `BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//AviationHub//Club Calendar//EN\nBEGIN:VEVENT\nUID:${crypto.randomUUID()}@aviationhub.com\nDTSTAMP:${new Date().toISOString().replace(/[-:]/g, '').split('.')[0]}Z\nSUMMARY:Flight - ${aircraft?.nNumber}\nDESCRIPTION:Aircraft: ${aircraft?.customName}\nBEGIN:VALARM\nTRIGGER:-PT1H\nACTION:DISPLAY\nDESCRIPTION:Flight reminder\nEND:VALARM\nEND:VEVENT\nEND:VCALENDAR`\n\n    const blob = new Blob([icalContent], { type: 'text/calendar' })\n    const url = URL.createObjectURL(blob)\n    const a = document.createElement('a')\n    a.href = url\n    a.download = `calendar-${aircraft?.nNumber}.ics`\n    a.click()\n    URL.revokeObjectURL(url)\n\n    const newInt: CalendarIntegration = {\n      id: crypto.randomUUID(),\n      type: 'ical',\n      name: `iCal Export - ${aircraft?.nNumber}`,\n      enabled: true,\n      lastSync: new Date().toISOString(),\n      aircraftId,\n      aircraftName: aircraft?.customName || aircraft?.nNumber || null,\n    }\n    setIntegrations([...integrations, newInt])\n    setShowAddModal(false)\n  }\n\n  const handleSync = async (id: string) => {\n    setSyncing(id)\n    await new Promise(r => setTimeout(r, 2000))\n    setIntegrations(integrations.map(i => i.id === id ? { ...i, lastSync: new Date().toISOString() } : i))\n    setSyncing(null)\n  }\n\n  const handleDelete = (id: string) => {\n    setIntegrations(integrations.filter(i => i.id !== id))\n  }\n\n  const formatDate = (d: string | null) => d ? new Date(d).toLocaleString() : 'Never'\n\n  if (status === 'loading' || loading) return <div className=\"min-h-screen bg-background flex items-center justify-center\"><RefreshCw className=\"h-8 w-8 animate-spin text-primary\" /></div>\n  if (!session) return <div className=\"min-h-screen bg-background flex items-center justify-center p-4\"><Card className=\"max-w-md w-full\"><CardContent className=\"pt-6 text-center\"><Calendar className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground\" /><h2 className=\"text-xl font-bold mb-2\">Calendar Sync</h2><p className=\"text-muted-foreground mb-4\">Sign in to sync your club calendar</p><Button asChild><a href=\"/login\">Sign In</a></Button></CardContent></Card></div>\n\n  return (\n    <div className=\"min-h-screen bg-background p-4 md:p-8 pt-16\">\n      <div className=\"max-w-7xl mx-auto space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div><h1 className=\"text-3xl font-bold flex items-center gap-2\"><Calendar className=\"h-8 w-8\" />Calendar Sync</h1><p className=\"text-muted-foreground\">Sync club bookings with Google Calendar or export iCal files</p></div>\n          <Button className=\"gap-2\" onClick={() => setShowAddModal(true)}><Plus className=\"h-4 w-4\" />Add Integration</Button>\n        </div>\n\n        {/* How it works */}\n        <Card>\n          <CardHeader><CardTitle>How It Works</CardTitle></CardHeader>\n          <CardContent>\n            <div className=\"grid gap-4 md:grid-cols-2\">\n              <div className=\"p-4 rounded-lg border\">\n                <div className=\"flex items-center gap-2 mb-2\"><ExternalLink className=\"h-5 w-5 text-blue-500\" /><h3 className=\"font-semibold\">Google Calendar</h3></div>\n                <p className=\"text-sm text-muted-foreground\">Connect your Google Calendar to automatically sync aircraft bookings. New bookings appear in your calendar automatically.</p>\n              </div>\n              <div className=\"p-4 rounded-lg border\">\n                <div className=\"flex items-center gap-2 mb-2\"><Download className=\"h-5 w-5 text-green-500\" /><h3 className=\"font-semibold\">iCal Export</h3></div>\n                <p className=\"text-sm text-muted-foreground\">Download an .ics file to import into Apple Calendar, Outlook, or any calendar app that supports iCal format.</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Integrations */}\n        <Card>\n          <CardHeader><CardTitle>Active Integrations</CardTitle><CardDescription>Manage your calendar connections</CardDescription></CardHeader>\n          <CardContent>\n            {integrations.length === 0 ? (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                <Calendar className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                <p>No calendar integrations yet</p>\n                <Button className=\"mt-4\" onClick={() => setShowAddModal(true)}>Add Integration</Button>\n              </div>\n            ) : (\n              <div className=\"space-y-3\">\n                {integrations.map((int) => (\n                  <div key={int.id} className=\"p-4 rounded-lg border flex items-center justify-between\">\n                    <div className=\"flex items-center gap-4\">\n                      <div className={`p-2 rounded-lg ${int.type === 'google' ? 'bg-blue-100' : 'bg-green-100'}`}>\n                        {int.type === 'google' ? <ExternalLink className=\"h-5 w-5 text-blue-600\" /> : <Download className=\"h-5 w-5 text-green-600\" />}\n                      </div>\n                      <div>\n                        <div className=\"flex items-center gap-2\">\n                          <h3 className=\"font-medium\">{int.name}</h3>\n                          {int.enabled && <Badge variant=\"outline\" className=\"text-xs\"><Check className=\"h-3 w-3 mr-1\" />Active</Badge>}\n                        </div>\n                        <p className=\"text-sm text-muted-foreground\">Last synced: {formatDate(int.lastSync)}</p>\n                      </div>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      <Button variant=\"outline\" size=\"sm\" onClick={() => handleSync(int.id)} disabled={syncing === int.id}>\n                        <RefreshCw className={`h-4 w-4 mr-1 ${syncing === int.id ? 'animate-spin' : ''}`} />\n                        Sync\n                      </Button>\n                      {int.type === 'ical' && (\n                        <Button variant=\"outline\" size=\"sm\" onClick={() => handleGenerateICal(int.aircraftId!)}>\n                          <Download className=\"h-4 w-4 mr-1\" />\n                          Re-export\n                        </Button>\n                      )}\n                      <Button variant=\"ghost\" size=\"sm\" onClick={() => handleDelete(int.id)}>\n                        <Trash2 className=\"h-4 w-4 text-destructive\" />\n                      </Button>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Add Modal */}\n        {showAddModal && (\n          <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\">\n            <Card className=\"w-full max-w-md m-4\">\n              <CardHeader><CardTitle>Add Calendar Integration</CardTitle><CardDescription>Connect a calendar for aircraft bookings</CardDescription></CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div><Label>Calendar Type</Label>\n                  <div className=\"flex gap-2 mt-2\">\n                    <Button variant={newIntegration.type === 'google' ? 'default' : 'outline'} onClick={() => setNewIntegration({ ...newIntegration, type: 'google' })} className=\"flex-1\"><ExternalLink className=\"h-4 w-4 mr-2\" />Google</Button>\n                    <Button variant={newIntegration.type === 'ical' ? 'default' : 'outline'} onClick={() => setNewIntegration({ ...newIntegration, type: 'ical' })} className=\"flex-1\"><Download className=\"h-4 w-4 mr-2\" />iCal</Button>\n                  </div>\n                </div>\n                <div><Label>Aircraft</Label>\n                  <select className=\"w-full mt-1 p-2 border rounded-md\" value={newIntegration.aircraftId} onChange={(e) => setNewIntegration({ ...newIntegration, aircraftId: e.target.value })}>\n                    <option value=\"\">Select aircraft...</option>\n                    {demoAircraft.map(a => <option key={a.id} value={a.id}>{a.nNumber} - {a.customName}</option>)}\n                  </select>\n                </div>\n                <div className=\"flex gap-2\">\n                  <Button variant=\"outline\" className=\"flex-1\" onClick={() => setShowAddModal(false)}>Cancel</Button>\n                  <Button className=\"flex-1\" disabled={!newIntegration.aircraftId} onClick={() => newIntegration.type === 'google' ? handleConnectGoogle(newIntegration.aircraftId) : handleGenerateICal(newIntegration.aircraftId)}>\n                    {newIntegration.type === 'google' ? 'Connect' : 'Export'}\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        )}\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\flying-club\\currency\\auto-update\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Input' is defined but never used.","line":8,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":15,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Input"},"fix":{"range":[294,340],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Label' is defined but never used.","line":9,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":15,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Label"},"fix":{"range":[340,386],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Play' is defined but never used.","line":11,"column":78,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":82,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Play"},"fix":{"range":[509,515],"text":""},"desc":"Remove unused variable \"Play\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Pause' is defined but never used.","line":11,"column":84,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":89,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Pause"},"fix":{"range":[515,522],"text":""},"desc":"Remove unused variable \"Pause\"."}]},{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Date.now` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nC:\\Users\\David\\next-dashboard\\app\\flying-club\\currency\\auto-update\\page.tsx:73:55\n  71 |\n  72 |   const getDayStatus = () => {\n> 73 |     const daysSince = settings.lastSync ? Math.floor((Date.now() - new Date(settings.lastSync).getTime()) / (1000*60*60*24)) : 999\n     |                                                       ^^^^^^^^^^ Cannot call impure function\n  74 |     if (status_.dayLandings >= 3) return { status: 'current', color: 'text-green-500', icon: <Check className=\"h-4 w-4\" /> }\n  75 |     if (daysSince > 60) return { status: 'expired', color: 'text-red-500', icon: <AlertTriangle className=\"h-4 w-4\" /> }\n  76 |     return { status: 'expiring', color: 'text-amber-500', icon: <AlertTriangle className=\"h-4 w-4\" /> }","line":73,"column":55,"nodeType":null,"endLine":73,"endColumn":65}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { useSession } from 'next-auth/react'\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Badge } from '@/components/ui/badge'\nimport { Input } from '@/components/ui/input'\nimport { Label } from '@/components/ui/label'\nimport { Switch } from '@/components/ui/switch'\nimport { RefreshCw, Gauge, Sun, Moon, Plane, Check, AlertTriangle, Settings, Play, Pause } from 'lucide-react'\n\ninterface CurrencySettings {\n  autoUpdate: boolean\n  dayLandings: boolean\n  nightLandings: boolean\n  instrumentApproaches: boolean\n  lastSync: string | null\n  syncFrequency: 'daily' | 'weekly'\n}\n\ninterface CurrencyStatus {\n  dayLandings: number\n  dayLandingsDate: string | null\n  nightLandings: number\n  nightLandingsDate: string | null\n  approaches: number\n  instrumentTime: number\n  instrumentCurrencyDate: string | null\n}\n\nexport default function CurrencyAutoUpdatePage() {\n  const { data: session, status } = useSession()\n  const [loading, setLoading] = useState(true)\n  const [settings, setSettings] = useState<CurrencySettings>({\n    autoUpdate: true,\n    dayLandings: true,\n    nightLandings: true,\n    instrumentApproaches: true,\n    lastSync: '2024-02-20T10:00:00Z',\n    syncFrequency: 'daily',\n  })\n  const [status_, setStatus] = useState<CurrencyStatus>({\n    dayLandings: 5,\n    dayLandingsDate: '2024-02-15',\n    nightLandings: 3,\n    nightLandingsDate: '2024-02-10',\n    approaches: 8,\n    instrumentTime: 15.5,\n    instrumentCurrencyDate: '2024-02-01',\n  })\n  const [syncing, setSyncing] = useState(false)\n\n  useEffect(() => { setLoading(false) }, [session])\n\n  const handleSync = async () => {\n    setSyncing(true)\n    await new Promise(r => setTimeout(r, 2000))\n    setStatus({\n      dayLandings: 6,\n      dayLandingsDate: new Date().toISOString(),\n      nightLandings: 3,\n      nightLandingsDate: new Date().toISOString(),\n      approaches: 9,\n      instrumentTime: 16.0,\n      instrumentCurrencyDate: new Date().toISOString(),\n    })\n    setSettings({ ...settings, lastSync: new Date().toISOString() })\n    setSyncing(false)\n  }\n\n  const getDayStatus = () => {\n    const daysSince = settings.lastSync ? Math.floor((Date.now() - new Date(settings.lastSync).getTime()) / (1000*60*60*24)) : 999\n    if (status_.dayLandings >= 3) return { status: 'current', color: 'text-green-500', icon: <Check className=\"h-4 w-4\" /> }\n    if (daysSince > 60) return { status: 'expired', color: 'text-red-500', icon: <AlertTriangle className=\"h-4 w-4\" /> }\n    return { status: 'expiring', color: 'text-amber-500', icon: <AlertTriangle className=\"h-4 w-4\" /> }\n  }\n\n  const getNightStatus = () => {\n    if (status_.nightLandings >= 3) return { status: 'current', color: 'text-green-500', icon: <Check className=\"h-4 w-4\" /> }\n    return { status: 'expired', color: 'text-red-500', icon: <AlertTriangle className=\"h-4 w-4\" /> }\n  }\n\n  const getInstrumentStatus = () => {\n    if (status_.approaches >= 6) return { status: 'current', color: 'text-green-500', icon: <Check className=\"h-4 w-4\" /> }\n    return { status: 'expiring', color: 'text-amber-500', icon: <AlertTriangle className=\"h-4 w-4\" /> }\n  }\n\n  if (status === 'loading' || loading) return <div className=\"min-h-screen bg-background flex items-center justify-center\"><RefreshCw className=\"h-8 w-8 animate-spin text-primary\" /></div>\n  if (!session) return <div className=\"min-h-screen bg-background flex items-center justify-center p-4\"><Card className=\"max-w-md w-full\"><CardContent className=\"pt-6 text-center\"><Gauge className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground\" /><h2 className=\"text-xl font-bold mb-2\">Currency Auto-Update</h2><p className=\"text-muted-foreground mb-4\">Sign in to configure currency sync</p><Button asChild><a href=\"/login\">Sign In</a></Button></CardContent></Card></div>\n\n  return (\n    <div className=\"min-h-screen bg-background p-4 md:p-8 pt-16\">\n      <div className=\"max-w-7xl mx-auto space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div><h1 className=\"text-3xl font-bold flex items-center gap-2\"><Gauge className=\"h-8 w-8\" />Currency Auto-Update</h1><p className=\"text-muted-foreground\">Automatically sync your currency from logbook entries</p></div>\n          <Button className=\"gap-2\" onClick={handleSync} disabled={syncing}><RefreshCw className={`h-4 w-4 ${syncing ? 'animate-spin' : ''}`} />{syncing ? 'Syncing...' : 'Sync Now'}</Button>\n        </div>\n\n        {/* Current Status */}\n        <div className=\"grid gap-4 md:grid-cols-3\">\n          <Card className=\"border-green-500/30\">\n            <CardContent className=\"pt-4\">\n              <div className=\"flex items-center gap-2 mb-2\"><Sun className=\"h-5 w-5 text-amber-500\" /><h3 className=\"font-semibold\">Day Currency</h3></div>\n              <p className=\"text-3xl font-bold\">{status_.dayLandings}<span className=\"text-sm font-normal text-muted-foreground\">/3 landings</span></p>\n              <p className=\"text-sm text-muted-foreground mt-1\">{status_.dayLandingsDate ? `Last: ${new Date(status_.dayLandingsDate).toLocaleDateString()}` : 'No flights'}</p>\n              <Badge className=\"mt-2 bg-green-500/10 text-green-600\">{getDayStatus().icon}<span className=\"ml-1\">Current</span></Badge>\n            </CardContent>\n          </Card>\n          <Card className=\"border-green-500/30\">\n            <CardContent className=\"pt-4\">\n              <div className=\"flex items-center gap-2 mb-2\"><Moon className=\"h-5 w-5 text-blue-500\" /><h3 className=\"font-semibold\">Night Currency</h3></div>\n              <p className=\"text-3xl font-bold\">{status_.nightLandings}<span className=\"text-sm font-normal text-muted-foreground\">/3 landings</span></p>\n              <p className=\"text-sm text-muted-foreground mt-1\">{status_.nightLandingsDate ? `Last: ${new Date(status_.nightLandingsDate).toLocaleDateString()}` : 'No flights'}</p>\n              <Badge className=\"mt-2 bg-green-500/10 text-green-600\">{getNightStatus().icon}<span className=\"ml-1\">Current</span></Badge>\n            </CardContent>\n          </Card>\n          <Card className=\"border-green-500/30\">\n            <CardContent className=\"pt-4\">\n              <div className=\"flex items-center gap-2 mb-2\"><Plane className=\"h-5 w-5 text-purple-500\" /><h3 className=\"font-semibold\">Instrument Currency</h3></div>\n              <p className=\"text-3xl font-bold\">{status_.approaches}<span className=\"text-sm font-normal text-muted-foreground\">/6 approaches</span></p>\n              <p className=\"text-sm text-muted-foreground mt-1\">{status_.instrumentTime.toFixed(1)} hrs instrument time</p>\n              <Badge className=\"mt-2 bg-green-500/10 text-green-600\">{getInstrumentStatus().icon}<span className=\"ml-1\">Current</span></Badge>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Settings */}\n        <Card>\n          <CardHeader><CardTitle className=\"flex items-center gap-2\"><Settings className=\"h-5 w-5\" />Auto-Update Settings</CardTitle><CardDescription>Configure how currency is synced from your logbook</CardDescription></CardHeader>\n          <CardContent className=\"space-y-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <h3 className=\"font-medium\">Enable Auto-Update</h3>\n                <p className=\"text-sm text-muted-foreground\">Automatically sync currency from logbook</p>\n              </div>\n              <Switch checked={settings.autoUpdate} onCheckedChange={(c) => setSettings({ ...settings, autoUpdate: c })} />\n            </div>\n\n            <div className=\"border-t pt-4\">\n              <h3 className=\"font-medium mb-4\">Currency Types to Track</h3>\n              <div className=\"space-y-3\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-2\"><Sun className=\"h-4 w-4 text-amber-500\" /><span>Day Landings (3 in 90 days)</span></div>\n                  <Switch checked={settings.dayLandings} onCheckedChange={(c) => setSettings({ ...settings, dayLandings: c })} disabled={!settings.autoUpdate} />\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-2\"><Moon className=\"h-4 w-4 text-blue-500\" /><span>Night Landings (3 in 90 days)</span></div>\n                  <Switch checked={settings.nightLandings} onCheckedChange={(c) => setSettings({ ...settings, nightLandings: c })} disabled={!settings.autoUpdate} />\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-2\"><Plane className=\"h-4 w-4 text-purple-500\" /><span>Instrument Approaches (6 in 6 months)</span></div>\n                  <Switch checked={settings.instrumentApproaches} onCheckedChange={(c) => setSettings({ ...settings, instrumentApproaches: c })} disabled={!settings.autoUpdate} />\n                </div>\n              </div>\n            </div>\n\n            <div className=\"border-t pt-4\">\n              <h3 className=\"font-medium mb-4\">Sync Frequency</h3>\n              <div className=\"flex gap-2\">\n                <Button variant={settings.syncFrequency === 'daily' ? 'default' : 'outline'} onClick={() => setSettings({ ...settings, syncFrequency: 'daily' })} disabled={!settings.autoUpdate}><RefreshCw className=\"h-4 w-4 mr-2\" />Daily</Button>\n                <Button variant={settings.syncFrequency === 'weekly' ? 'default' : 'outline'} onClick={() => setSettings({ ...settings, syncFrequency: 'weekly' })} disabled={!settings.autoUpdate}><RefreshCw className=\"h-4 w-4 mr-2\" />Weekly</Button>\n              </div>\n            </div>\n\n            <div className=\"border-t pt-4\">\n              <p className=\"text-sm text-muted-foreground\">Last synchronized: {settings.lastSync ? new Date(settings.lastSync).toLocaleString() : 'Never'}</p>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Info */}\n        <Card>\n          <CardContent className=\"pt-4\">\n            <h3 className=\"font-medium mb-2\">How It Works</h3>\n            <p className=\"text-sm text-muted-foreground\">Currency is automatically calculated from your logbook entries. Day and night landings are counted from flights with the appropriate conditions. Instrument approaches are counted from logged instrument time and approaches.</p>\n            <div className=\"mt-4 grid gap-2 text-sm\">\n              <div className=\"flex items-center gap-2\"><Check className=\"h-4 w-4 text-green-500\" /><span>Day Currency: 3 takeoffs/landings in last 90 days</span></div>\n              <div className=\"flex items-center gap-2\"><Check className=\"h-4 w-4 text-green-500\" /><span>Night Currency: 3 takeoffs/landings in last 90 days</span></div>\n              <div className=\"flex items-center gap-2\"><Check className=\"h-4 w-4 text-green-500\" /><span>Instrument Currency: 6 approaches + holds + intercepting in last 6 months</span></div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\flying-club\\currency\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Tabs' is defined but never used.","line":8,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":14,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Tabs"},"fix":{"range":[303,308],"text":""},"desc":"Remove unused variable \"Tabs\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TabsContent' is defined but never used.","line":8,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":27,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"TabsContent"},"fix":{"range":[307,320],"text":""},"desc":"Remove unused variable \"TabsContent\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TabsList' is defined but never used.","line":8,"column":29,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":37,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"TabsList"},"fix":{"range":[320,330],"text":""},"desc":"Remove unused variable \"TabsList\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TabsTrigger' is defined but never used.","line":8,"column":39,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":50,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"TabsTrigger"},"fix":{"range":[294,374],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Plane' is defined but never used.","line":10,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":8,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Plane"},"fix":{"range":[386,392],"text":""},"desc":"Remove unused variable \"Plane\"."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\David\\next-dashboard\\app\\flying-club\\currency\\page.tsx:116:5\n  114 |     // In real app, fetch from API\n  115 |     // For demo, using static data\n> 116 |     setMembers(demoMembers)\n      |     ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  117 |     setLoading(false)\n  118 |   }, [session])\n  119 |","line":116,"column":5,"nodeType":null,"endLine":116,"endColumn":15}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { useSession } from 'next-auth/react'\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Badge } from '@/components/ui/badge'\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'\nimport { \n  Plane,\n  Sun,\n  Moon,\n  Gauge,\n  AlertTriangle,\n  CheckCircle,\n  XCircle,\n  RefreshCw,\n  User,\n  Users,\n  Filter,\n  Download\n} from 'lucide-react'\n\ninterface MemberCurrency {\n  id: string\n  userId: string\n  userName: string\n  userEmail: string\n  // Day currency\n  dayLandings: number\n  dayLandingsDate: string | null\n  dayCurrencyStatus: 'current' | 'expiring' | 'expired'\n  // Night currency\n  nightLandings: number\n  nightLandingsDate: string | null\n  nightCurrencyStatus: 'current' | 'expiring' | 'expired'\n  // Instrument currency\n  approaches: number\n  instrumentTime: number\n  instrumentCurrencyStatus: 'current' | 'expiring' | 'expired'\n}\n\n// Demo data for display\nconst demoMembers: MemberCurrency[] = [\n  {\n    id: '1',\n    userId: '1',\n    userName: 'John Smith',\n    userEmail: 'john@example.com',\n    dayLandings: 5,\n    dayLandingsDate: '2024-02-15',\n    dayCurrencyStatus: 'current',\n    nightLandings: 3,\n    nightLandingsDate: '2024-02-10',\n    nightCurrencyStatus: 'current',\n    approaches: 8,\n    instrumentTime: 15.5,\n    instrumentCurrencyStatus: 'current',\n  },\n  {\n    id: '2',\n    userId: '2',\n    userName: 'Sarah Johnson',\n    userEmail: 'sarah@example.com',\n    dayLandings: 2,\n    dayLandingsDate: '2024-01-20',\n    dayCurrencyStatus: 'expired',\n    nightLandings: 1,\n    nightLandingsDate: '2024-01-15',\n    nightCurrencyStatus: 'expired',\n    approaches: 3,\n    instrumentTime: 8.0,\n    instrumentCurrencyStatus: 'expiring',\n  },\n  {\n    id: '3',\n    userId: '3',\n    userName: 'Mike Davis',\n    userEmail: 'mike@example.com',\n    dayLandings: 4,\n    dayLandingsDate: '2024-02-01',\n    dayCurrencyStatus: 'current',\n    nightLandings: 0,\n    nightLandingsDate: null,\n    nightCurrencyStatus: 'expired',\n    approaches: 10,\n    instrumentTime: 22.0,\n    instrumentCurrencyStatus: 'current',\n  },\n  {\n    id: '4',\n    userId: '4',\n    userName: 'Emily Chen',\n    userEmail: 'emily@example.com',\n    dayLandings: 3,\n    dayLandingsDate: '2024-02-18',\n    dayCurrencyStatus: 'current',\n    nightLandings: 3,\n    nightLandingsDate: '2024-02-18',\n    nightCurrencyStatus: 'current',\n    approaches: 6,\n    instrumentTime: 12.0,\n    instrumentCurrencyStatus: 'current',\n  },\n]\n\nexport default function CurrencyDashboardPage() {\n  const { data: session, status } = useSession()\n  const [loading, setLoading] = useState(true)\n  const [members, setMembers] = useState<MemberCurrency[]>([])\n  const [filter, setFilter] = useState<'all' | 'current' | 'expiring' | 'expired'>('all')\n\n  useEffect(() => {\n    // In real app, fetch from API\n    // For demo, using static data\n    setMembers(demoMembers)\n    setLoading(false)\n  }, [session])\n\n  const getStatusIcon = (status: string) => {\n    switch (status) {\n      case 'current':\n        return <CheckCircle className=\"h-4 w-4 text-green-500\" />\n      case 'expiring':\n        return <AlertTriangle className=\"h-4 w-4 text-amber-500\" />\n      case 'expired':\n        return <XCircle className=\"h-4 w-4 text-red-500\" />\n      default:\n        return null\n    }\n  }\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case 'current':\n        return 'bg-green-500/10 text-green-600 border-green-500/30'\n      case 'expiring':\n        return 'bg-amber-500/10 text-amber-600 border-amber-500/30'\n      case 'expired':\n        return 'bg-red-500/10 text-red-600 border-red-500/30'\n      default:\n        return ''\n    }\n  }\n\n  const getMemberStatus = (member: MemberCurrency): 'current' | 'expiring' | 'expired' => {\n    if (member.dayCurrencyStatus === 'expired' || member.nightCurrencyStatus === 'expired' || member.instrumentCurrencyStatus === 'expired') {\n      return 'expired'\n    }\n    if (member.dayCurrencyStatus === 'expiring' || member.nightCurrencyStatus === 'expiring' || member.instrumentCurrencyStatus === 'expiring') {\n      return 'expiring'\n    }\n    return 'current'\n  }\n\n  const filteredMembers = members.filter(member => {\n    if (filter === 'all') return true\n    return getMemberStatus(member) === filter\n  })\n\n  const stats = {\n    total: members.length,\n    current: members.filter(m => getMemberStatus(m) === 'current').length,\n    expiring: members.filter(m => getMemberStatus(m) === 'expiring').length,\n    expired: members.filter(m => getMemberStatus(m) === 'expired').length,\n  }\n\n  if (status === 'loading' || loading) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <RefreshCw className=\"h-8 w-8 animate-spin text-primary\" />\n      </div>\n    )\n  }\n\n  if (!session) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center p-4\">\n        <Card className=\"max-w-md w-full\">\n          <CardContent className=\"pt-6 text-center\">\n            <Users className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground\" />\n            <h2 className=\"text-xl font-bold mb-2\">Member Currency Dashboard</h2>\n            <p className=\"text-muted-foreground mb-4\">\n              Sign in to view club member currency status\n            </p>\n            <Button asChild>\n              <a href=\"/login\">Sign In</a>\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background p-4 md:p-8\">\n      <div className=\"max-w-7xl mx-auto space-y-6\">\n        \n        {/* Header */}\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold flex items-center gap-2\">\n              <Gauge className=\"h-8 w-8\" />\n              Member Currency Dashboard\n            </h1>\n            <p className=\"text-muted-foreground\">\n              FAA currency status for all club members at a glance\n            </p>\n          </div>\n          <div className=\"flex gap-2\">\n            <Button variant=\"outline\">\n              <Download className=\"h-4 w-4 mr-2\" />\n              Export\n            </Button>\n            <Button variant=\"outline\" onClick={() => setLoading(true)}>\n              <RefreshCw className={`h-4 w-4 mr-2 ${loading ? 'animate-spin' : ''}`} />\n              Refresh\n            </Button>\n          </div>\n        </div>\n\n        {/* Summary Cards */}\n        <div className=\"grid gap-4 md:grid-cols-4\">\n          <Card>\n            <CardContent className=\"pt-4\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Total Members</p>\n                  <p className=\"text-2xl font-bold\">{stats.total}</p>\n                </div>\n                <Users className=\"h-8 w-8 text-muted-foreground\" />\n              </div>\n            </CardContent>\n          </Card>\n          \n          <Card className=\"border-green-500/30\">\n            <CardContent className=\"pt-4\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Current</p>\n                  <p className=\"text-2xl font-bold text-green-600\">{stats.current}</p>\n                </div>\n                <CheckCircle className=\"h-8 w-8 text-green-500\" />\n              </div>\n            </CardContent>\n          </Card>\n          \n          <Card className=\"border-amber-500/30\">\n            <CardContent className=\"pt-4\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Expiring Soon</p>\n                  <p className=\"text-2xl font-bold text-amber-600\">{stats.expiring}</p>\n                </div>\n                <AlertTriangle className=\"h-8 w-8 text-amber-500\" />\n              </div>\n            </CardContent>\n          </Card>\n          \n          <Card className=\"border-red-500/30\">\n            <CardContent className=\"pt-4\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Not Current</p>\n                  <p className=\"text-2xl font-bold text-red-600\">{stats.expired}</p>\n                </div>\n                <XCircle className=\"h-8 w-8 text-red-500\" />\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Filters */}\n        <div className=\"flex items-center gap-2\">\n          <Filter className=\"h-4 w-4 text-muted-foreground\" />\n          <span className=\"text-sm text-muted-foreground\">Filter:</span>\n          <Button \n            variant={filter === 'all' ? 'default' : 'outline'} \n            size=\"sm\"\n            onClick={() => setFilter('all')}\n          >\n            All ({stats.total})\n          </Button>\n          <Button \n            variant={filter === 'current' ? 'default' : 'outline'} \n            size=\"sm\"\n            onClick={() => setFilter('current')}\n          >\n            Current ({stats.current})\n          </Button>\n          <Button \n            variant={filter === 'expiring' ? 'default' : 'outline'} \n            size=\"sm\"\n            onClick={() => setFilter('expiring')}\n          >\n            Expiring ({stats.expiring})\n          </Button>\n          <Button \n            variant={filter === 'expired' ? 'default' : 'outline'} \n            size=\"sm\"\n            onClick={() => setFilter('expired')}\n          >\n            Not Current ({stats.expired})\n          </Button>\n        </div>\n\n        {/* Members Table */}\n        <Card>\n          <CardHeader>\n            <CardTitle>Member Currency Status</CardTitle>\n            <CardDescription>\n              FAA currency requirements: 3 takeoffs/landings in 90 days (day/night), 6 approaches + holds + intercepting in 6 months (instrument)\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"overflow-x-auto\">\n              <table className=\"w-full\">\n                <thead>\n                  <tr className=\"border-b\">\n                    <th className=\"text-left p-3 font-medium\">Member</th>\n                    <th className=\"text-center p-3 font-medium\">\n                      <div className=\"flex items-center justify-center gap-1\">\n                        <Sun className=\"h-4 w-4\" />\n                        Day (3 in 90 days)\n                      </div>\n                    </th>\n                    <th className=\"text-center p-3 font-medium\">\n                      <div className=\"flex items-center justify-center gap-1\">\n                        <Moon className=\"h-4 w-4\" />\n                        Night (3 in 90 days)\n                      </div>\n                    </th>\n                    <th className=\"text-center p-3 font-medium\">\n                      <div className=\"flex items-center justify-center gap-1\">\n                        <Gauge className=\"h-4 w-4\" />\n                        Instrument (6mo)\n                      </div>\n                    </th>\n                    <th className=\"text-center p-3 font-medium\">Overall</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {filteredMembers.map((member) => (\n                    <tr key={member.id} className=\"border-b hover:bg-muted/50\">\n                      <td className=\"p-3\">\n                        <div className=\"flex items-center gap-2\">\n                          <User className=\"h-4 w-4 text-muted-foreground\" />\n                          <div>\n                            <p className=\"font-medium\">{member.userName}</p>\n                            <p className=\"text-sm text-muted-foreground\">{member.userEmail}</p>\n                          </div>\n                        </div>\n                      </td>\n                      <td className=\"p-3\">\n                        <div className=\"flex flex-col items-center\">\n                          <span className=\"text-lg font-medium\">{member.dayLandings}</span>\n                          <Badge className={`text-xs ${getStatusColor(member.dayCurrencyStatus)}`}>\n                            {getStatusIcon(member.dayCurrencyStatus)}\n                            <span className=\"ml-1\">\n                              {member.dayLandings >= 3 ? 'Current' : member.dayLandings > 0 ? `${3 - member.dayLandings} more` : 'Expired'}\n                            </span>\n                          </Badge>\n                        </div>\n                      </td>\n                      <td className=\"p-3\">\n                        <div className=\"flex flex-col items-center\">\n                          <span className=\"text-lg font-medium\">{member.nightLandings}</span>\n                          <Badge className={`text-xs ${getStatusColor(member.nightCurrencyStatus)}`}>\n                            {getStatusIcon(member.nightCurrencyStatus)}\n                            <span className=\"ml-1\">\n                              {member.nightLandings >= 3 ? 'Current' : member.nightLandings > 0 ? `${3 - member.nightLandings} more` : 'Expired'}\n                            </span>\n                          </Badge>\n                        </div>\n                      </td>\n                      <td className=\"p-3\">\n                        <div className=\"flex flex-col items-center\">\n                          <span className=\"text-lg font-medium\">{member.approaches}</span>\n                          <span className=\"text-xs text-muted-foreground\">{member.instrumentTime.toFixed(1)} hrs</span>\n                          <Badge className={`text-xs ${getStatusColor(member.instrumentCurrencyStatus)}`}>\n                            {getStatusIcon(member.instrumentCurrencyStatus)}\n                            <span className=\"ml-1\">\n                              {member.approaches >= 6 ? 'Current' : `${6 - member.approaches} more`}\n                            </span>\n                          </Badge>\n                        </div>\n                      </td>\n                      <td className=\"p-3\">\n                        <Badge className={`${getStatusColor(getMemberStatus(member))} px-3 py-1`}>\n                          {getStatusIcon(getMemberStatus(member))}\n                          <span className=\"ml-1 capitalize\">{getMemberStatus(member)}</span>\n                        </Badge>\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Legend */}\n        <Card>\n          <CardContent className=\"pt-4\">\n            <div className=\"flex flex-wrap gap-4 text-sm text-muted-foreground\">\n              <div className=\"flex items-center gap-1\">\n                <CheckCircle className=\"h-4 w-4 text-green-500\" />\n                <span>Current - Meets requirements</span>\n              </div>\n              <div className=\"flex items-center gap-1\">\n                <AlertTriangle className=\"h-4 w-4 text-amber-500\" />\n                <span>Expiring Soon - Will expire within 30 days</span>\n              </div>\n              <div className=\"flex items-center gap-1\">\n                <XCircle className=\"h-4 w-4 text-red-500\" />\n                <span>Not Current - Does not meet requirements</span>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\flying-club\\maintenance-requests\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":22,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[695,698],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[695,698],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useEffect, useState } from 'react'\nimport { useSession } from 'next-auth/react'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Badge } from '@/components/ui/badge'\nimport { Label } from '@/components/ui/label'\n\ntype QueueItem = {\n  id: string\n  description: string\n  notes?: string | null\n  isGrounded?: boolean\n  reportedDate?: string\n}\n\nexport default function ClubMaintenanceRequestsPage() {\n  const { data: session, status } = useSession()\n  const [queue, setQueue] = useState<QueueItem[]>([])\n  const [groupId, setGroupId] = useState('')\n  const [groups, setGroups] = useState<any[]>([])\n  const [loading, setLoading] = useState(false)\n\n  useEffect(() => {\n    async function loadGroups() {\n      const res = await fetch('/api/groups')\n      if (res.ok) {\n        const data = await res.json()\n        setGroups(Array.isArray(data) ? data : [])\n      }\n    }\n    if (session?.user) loadGroups()\n  }, [session?.user])\n\n  useEffect(() => {\n    if (!groupId) return\n    let active = true\n    async function load() {\n      setLoading(true)\n      const res = await fetch(`/api/flying-club/maintenance/queue?groupId=${groupId}`)\n      if (res.ok) {\n        const data = await res.json()\n        if (active) setQueue(Array.isArray(data.queue) ? data.queue : [])\n      }\n      setLoading(false)\n    }\n    load()\n    return () => {\n      active = false\n    }\n  }, [groupId])\n\n  const postToServiceBay = async (item: QueueItem) => {\n    await fetch('/api/mechanics/listings', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        title: item.description.slice(0, 120),\n        description: item.description,\n        category: 'OTHER',\n        urgency: item.isGrounded ? 'URGENT' : 'NORMAL',\n        source: 'squawk',\n        anonymous: true,\n        jobSize: 'MEDIUM',\n        neededBy: null,\n        groupId,\n      }),\n    })\n  }\n\n  if (status === 'loading') {\n    return <div className=\"min-h-screen bg-background p-6\">Loadingâ€¦</div>\n  }\n\n  if (!session?.user) {\n    return <div className=\"min-h-screen bg-background p-6\">Please sign in.</div>\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background p-6 pt-12\">\n      <div className=\"mx-auto max-w-5xl space-y-6\">\n        <div>\n          <h1 className=\"text-2xl font-bold\">Club Maintenance Queue</h1>\n          <p className=\"text-sm text-muted-foreground\">Review squawks before posting to Service Bay.</p>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-sm\">Select Club</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <Label className=\"text-xs text-muted-foreground\">Club</Label>\n            <select\n              className=\"mt-1 h-10 w-full rounded-md border border-input bg-background px-3 text-sm\"\n              value={groupId}\n              onChange={(e) => setGroupId(e.target.value)}\n            >\n              <option value=\"\">Select club...</option>\n              {groups.map((group) => (\n                <option key={group.id} value={group.id}>{group.name}</option>\n              ))}\n            </select>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-sm\">Pending Squawks</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            {loading && <p className=\"text-sm text-muted-foreground\">Loading queueâ€¦</p>}\n            {!loading && queue.length === 0 && (\n              <p className=\"text-sm text-muted-foreground\">No queued squawks.</p>\n            )}\n            {queue.map((item) => (\n              <div key={item.id} className=\"rounded-lg border border-border p-4\">\n                <p className=\"font-medium\">{item.description}</p>\n                <div className=\"mt-2 flex flex-wrap gap-2\">\n                  {item.isGrounded && <Badge variant=\"destructive\" className=\"text-[10px]\">Grounded</Badge>}\n                </div>\n                <div className=\"mt-3\">\n                  <Button size=\"sm\" variant=\"outline\" onClick={() => postToServiceBay(item)}>\n                    Post to Service Bay\n                  </Button>\n                </div>\n              </div>\n            ))}\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\flying-club\\notifications\\page.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\David\\next-dashboard\\app\\flying-club\\notifications\\page.tsx:30:21\n  28 |   })\n  29 |\n> 30 |   useEffect(() => { setLoading(false) }, [session])\n     |                     ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  31 |\n  32 |   const handleSave = async () => {\n  33 |     setSaving(true)","line":30,"column":21,"nodeType":null,"endLine":30,"endColumn":31}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { useSession } from 'next-auth/react'\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Badge } from '@/components/ui/badge'\nimport { Input } from '@/components/ui/input'\nimport { Label } from '@/components/ui/label'\nimport { Switch } from '@/components/ui/switch'\nimport { RefreshCw, Bell, Mail, MessageSquare, Phone, Save, Check, AlertTriangle } from 'lucide-react'\n\ninterface NotificationSettings {\n  email: { bookingConfirm: boolean; bookingReminder: boolean; maintenanceAlert: boolean; billingRun: boolean; currencyExpiry: boolean }\n  sms: { bookingConfirm: boolean; bookingReminder: boolean; maintenanceAlert: boolean; urgent: boolean }\n  phone: string\n}\n\nexport default function NotificationsPage() {\n  const { data: session, status } = useSession()\n  const [loading, setLoading] = useState(true)\n  const [saving, setSaving] = useState(false)\n  const [saved, setSaved] = useState(false)\n  const [settings, setSettings] = useState<NotificationSettings>({\n    email: { bookingConfirm: true, bookingReminder: true, maintenanceAlert: true, billingRun: true, currencyExpiry: true },\n    sms: { bookingConfirm: false, bookingReminder: false, maintenanceAlert: false, urgent: true },\n    phone: '',\n  })\n\n  useEffect(() => { setLoading(false) }, [session])\n\n  const handleSave = async () => {\n    setSaving(true)\n    await new Promise(r => setTimeout(r, 1000))\n    setSaving(false)\n    setSaved(true)\n    setTimeout(() => setSaved(false), 3000)\n  }\n\n  if (status === 'loading' || loading) return <div className=\"min-h-screen bg-background flex items-center justify-center\"><RefreshCw className=\"h-8 w-8 animate-spin text-primary\" /></div>\n  if (!session) return <div className=\"min-h-screen bg-background flex items-center justify-center p-4\"><Card className=\"max-w-md w-full\"><CardContent className=\"pt-6 text-center\"><Bell className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground\" /><h2 className=\"text-xl font-bold mb-2\">Notification Settings</h2><p className=\"text-muted-foreground mb-4\">Sign in to manage notifications</p><Button asChild><a href=\"/login\">Sign In</a></Button></CardContent></Card></div>\n\n  return (\n    <div className=\"min-h-screen bg-background p-4 md:p-8 pt-16\">\n      <div className=\"max-w-3xl mx-auto space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div><h1 className=\"text-3xl font-bold flex items-center gap-2\"><Bell className=\"h-8 w-8\" />Notifications</h1><p className=\"text-muted-foreground\">Manage your email and SMS notification preferences</p></div>\n          <Button onClick={handleSave} disabled={saving} className=\"gap-2\">{saving ? <RefreshCw className=\"h-4 w-4 animate-spin\" /> : saved ? <Check className=\"h-4 w-4\" /> : <Save className=\"h-4 w-4\" />}{saving ? 'Saving...' : saved ? 'Saved!' : 'Save Changes'}</Button>\n        </div>\n\n        {/* Email Notifications */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\"><Mail className=\"h-5 w-5\" />Email Notifications</CardTitle>\n            <CardDescription>Receive updates via email</CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"flex items-center justify-between\">\n              <div><p className=\"font-medium\">Booking Confirmations</p><p className=\"text-sm text-muted-foreground\">Get emailed when a booking is confirmed</p></div>\n              <Switch checked={settings.email.bookingConfirm} onCheckedChange={(c) => setSettings({ ...settings, email: { ...settings.email, bookingConfirm: c } })} />\n            </div>\n            <div className=\"flex items-center justify-between\">\n              <div><p className=\"font-medium\">Booking Reminders</p><p className=\"text-sm text-muted-foreground\">Reminder before your scheduled flight</p></div>\n              <Switch checked={settings.email.bookingReminder} onCheckedChange={(c) => setSettings({ ...settings, email: { ...settings.email, bookingReminder: c } })} />\n            </div>\n            <div className=\"flex items-center justify-between\">\n              <div><p className=\"font-medium\">Maintenance Alerts</p><p className=\"text-sm text-muted-foreground\">Notify when aircraft issues are reported</p></div>\n              <Switch checked={settings.email.maintenanceAlert} onCheckedChange={(c) => setSettings({ ...settings, email: { ...settings.email, maintenanceAlert: c } })} />\n            </div>\n            <div className=\"flex items-center justify-between\">\n              <div><p className=\"font-medium\">Billing Notifications</p><p className=\"text-sm text-muted-foreground\">Monthly invoice and payment updates</p></div>\n              <Switch checked={settings.email.billingRun} onCheckedChange={(c) => setSettings({ ...settings, email: { ...settings.email, billingRun: c } })} />\n            </div>\n            <div className=\"flex items-center justify-between\">\n              <div><p className=\"font-medium\">Currency Expiry</p><p className=\"text-sm text-muted-foreground\">Warning when your currency is about to expire</p></div>\n              <Switch checked={settings.email.currencyExpiry} onCheckedChange={(c) => setSettings({ ...settings, email: { ...settings.email, currencyExpiry: c } })} />\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* SMS Notifications */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\"><MessageSquare className=\"h-5 w-5\" />SMS Notifications</CardTitle>\n            <CardDescription>Receive text messages (requires phone number)</CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div><Label>Phone Number</Label>\n              <div className=\"flex gap-2 mt-1\">\n                <Phone className=\"h-4 w-4 mt-3 text-muted-foreground\" />\n                <Input placeholder=\"+1 (555) 123-4567\" value={settings.phone} onChange={(e) => setSettings({ ...settings, phone: e.target.value })} />\n              </div>\n            </div>\n            <div className=\"flex items-center justify-between\">\n              <div><p className=\"font-medium\">Booking Confirmations</p><p className=\"text-sm text-muted-foreground\">Text when booking is confirmed</p></div>\n              <Switch checked={settings.sms.bookingConfirm} onCheckedChange={(c) => setSettings({ ...settings, sms: { ...settings.sms, bookingConfirm: c } })} disabled={!settings.phone} />\n            </div>\n            <div className=\"flex items-center justify-between\">\n              <div><p className=\"font-medium\">Booking Reminders</p><p className=\"text-sm text-muted-foreground\">Text reminder before flight</p></div>\n              <Switch checked={settings.sms.bookingReminder} onCheckedChange={(c) => setSettings({ ...settings, sms: { ...settings.sms, bookingReminder: c } })} disabled={!settings.phone} />\n            </div>\n            <div className=\"flex items-center justify-between\">\n              <div><p className=\"font-medium\">Maintenance Alerts</p><p className=\"text-sm text-muted-foreground\">Text when issues reported</p></div>\n              <Switch checked={settings.sms.maintenanceAlert} onCheckedChange={(c) => setSettings({ ...settings, sms: { ...settings.sms, maintenanceAlert: c } })} disabled={!settings.phone} />\n            </div>\n            <div className=\"flex items-center justify-between\">\n              <div><p className=\"font-medium\">Urgent Notifications</p><p className=\"text-sm text-muted-foreground\">Critical alerts (aircraft grounded, etc.)</p></div>\n              <Switch checked={settings.sms.urgent} onCheckedChange={(c) => setSettings({ ...settings, sms: { ...settings.sms, urgent: c } })} disabled={!settings.phone} />\n            </div>\n            {!settings.phone && <div className=\"flex items-center gap-2 text-amber-600 text-sm\"><AlertTriangle className=\"h-4 w-4\" />Add a phone number to enable SMS notifications</div>}\n          </CardContent>\n        </Card>\n\n        {/* Summary */}\n        <Card>\n          <CardContent className=\"pt-4\">\n            <h3 className=\"font-medium mb-2\">Notification Summary</h3>\n            <div className=\"flex gap-4 text-sm\">\n              <Badge variant=\"outline\" className=\"gap-1\"><Mail className=\"h-3 w-3\" />{Object.values(settings.email).filter(Boolean).length} email</Badge>\n              <Badge variant=\"outline\" className=\"gap-1\"><MessageSquare className=\"h-3 w-3\" />{settings.phone ? Object.values(settings.sms).filter(Boolean).length : 0} SMS</Badge>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\flying-club\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Tabs' is defined but never used.","line":7,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":14,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Tabs"},"fix":{"range":[247,252],"text":""},"desc":"Remove unused variable \"Tabs\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TabsContent' is defined but never used.","line":7,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":27,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"TabsContent"},"fix":{"range":[251,264],"text":""},"desc":"Remove unused variable \"TabsContent\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TabsList' is defined but never used.","line":7,"column":29,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":37,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"TabsList"},"fix":{"range":[264,274],"text":""},"desc":"Remove unused variable \"TabsList\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TabsTrigger' is defined but never used.","line":7,"column":39,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":50,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"TabsTrigger"},"fix":{"range":[238,318],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CheckCircle2' is defined but never used.","line":18,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":18,"endColumn":15,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"CheckCircle2"},"fix":{"range":[509,525],"text":""},"desc":"Remove unused variable \"CheckCircle2\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Search' is defined but never used.","line":22,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":22,"endColumn":9,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Search"},"fix":{"range":[564,574],"text":""},"desc":"Remove unused variable \"Search\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Download' is defined but never used.","line":24,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":24,"endColumn":11,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Download"},"fix":{"range":[584,596],"text":""},"desc":"Remove unused variable \"Download\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MapPin' is defined but never used.","line":26,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":26,"endColumn":9,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"MapPin"},"fix":{"range":[612,622],"text":""},"desc":"Remove unused variable \"MapPin\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Fuel' is defined but never used.","line":27,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":27,"endColumn":7,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Fuel"},"fix":{"range":[622,630],"text":""},"desc":"Remove unused variable \"Fuel\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'viewingGroupDetails' is assigned a value but never used.","line":101,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":101,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState } from 'react'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\"\nimport { Badge } from \"@/components/ui/badge\"\nimport { Button } from \"@/components/ui/button\"\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\"\nimport { Progress } from \"@/components/ui/progress\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Plane,\n  Calendar,\n  Users,\n  Wrench,\n  DollarSign,\n  Clock,\n  AlertCircle,\n  CheckCircle2,\n  Plus,\n  ChevronLeft,\n  ChevronRight,\n  Search,\n  Filter,\n  Download,\n  MoreVertical,\n  MapPin,\n  Fuel,\n  BookOpen,\n  Settings\n} from \"lucide-react\"\nimport { FlightCompleteWizard } from \"@/components/flight-complete/FlightCompleteWizard\"\n\n// Mock data structure\nconst mockGroups = [\n  {\n    id: '1',\n    name: 'Sky High Flying Club',\n    description: 'A welcoming club for pilots of all experience levels',\n    aircraft: [\n      {\n        id: 'a1',\n        nNumber: 'N172SP',\n        nickname: 'Skyhawk',\n        make: 'Cessna',\n        model: '172S',\n        year: 2025,\n        status: 'Available',\n        hourlyRate: 165,\n        hobbsHours: 98.2\n      },\n      {\n        id: 'a2',\n        nNumber: 'N9876P',\n        nickname: 'Warrior',\n        make: 'Piper',\n        model: 'PA-28-161',\n        year: 2019,\n        status: 'Maintenance',\n        hourlyRate: 145,\n        hobbsHours: 1842.3\n      }\n    ],\n    members: 5\n  },\n  {\n    id: '2',\n    name: 'Weekend Warriors',\n    description: 'Casual flying group for weekend adventures',\n    aircraft: [\n      {\n        id: 'a3',\n        nNumber: 'N345AB',\n        nickname: 'Cherokee',\n        make: 'Piper',\n        model: 'PA-32-300',\n        year: 1978,\n        status: 'Available',\n        hourlyRate: 135,\n        hobbsHours: 4890.5\n      }\n    ],\n    members: 2\n  }\n]\n\nconst mockBookings = [\n  { id: 'b1', aircraft: 'N172SP', pilot: 'Demo Admin', date: '2024-02-23', time: '14:00 - 16:00', purpose: 'Local practice' },\n  { id: 'b2', aircraft: 'N345AB', pilot: 'Mike Wilson', date: '2024-02-24', time: '09:00 - 12:00', purpose: 'Cross country' },\n  { id: 'b3', aircraft: 'N172SP', pilot: 'Sarah Johnson', date: '2024-02-25', time: '10:30 - 13:30', purpose: 'IFR practice' }\n]\n\nconst mockMaintenance = [\n  { id: 'm1', aircraft: 'N9876P', description: 'Annual inspection', status: 'In Progress', dueDate: '2024-08-20', priority: 'high' },\n  { id: 'm2', aircraft: 'N172SP', description: 'Oil change', status: 'Needed', dueDate: '2024-03-01', priority: 'medium' }\n]\n\nexport default function FlyingClubPage() {\n  const [activeTab, setActiveTab] = useState('dashboard')\n  const [currentMonth, setCurrentMonth] = useState(new Date())\n  const [selectedGroup, setSelectedGroup] = useState('all')\n  const [viewingGroupDetails, setViewingGroupDetails] = useState<string | null>(null)\n  \n  // Flight completion wizard state\n  const [showFlightComplete, setShowFlightComplete] = useState(false)\n  const [activeFlight, setActiveFlight] = useState<{id: string; aircraftId: string; aircraftName: string; userId: string; userName: string; hobbsStart?: number} | null>(null)\n\n  const DAYS = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat']\n  const MONTHS = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December']\n\n  const getDaysInMonth = () => {\n    const year = currentMonth.getFullYear()\n    const month = currentMonth.getMonth()\n    const firstDay = new Date(year, month, 1)\n    const lastDay = new Date(year, month + 1, 0)\n    const daysInMonth = lastDay.getDate()\n    const startingDay = firstDay.getDay()\n    \n    const days: (number | null)[] = []\n    for (let i = 0; i < startingDay; i++) {\n      days.push(null)\n    }\n    for (let i = 1; i <= daysInMonth; i++) {\n      days.push(i)\n    }\n    return days\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background pt-[44px]\">\n      {/* Main Content */}\n      <main className=\"mx-auto max-w-[1600px] p-6\">\n        <div className=\"flex flex-col gap-4 pb-4\">\n          <div className=\"flex flex-col gap-3 md:flex-row md:items-center md:justify-between\">\n            <h1 className=\"text-xl font-semibold\">Flying Club</h1>\n            <div className=\"flex flex-wrap items-center gap-3\">\n              {mockGroups.length > 1 && (\n                <select\n                  value={selectedGroup}\n                  onChange={(e) => setSelectedGroup(e.target.value)}\n                  className=\"h-8 rounded-md border border-input bg-background px-3 text-sm\"\n                >\n                  <option value=\"all\">All Groups</option>\n                  {mockGroups.map(group => (\n                    <option key={group.id} value={group.id}>{group.name}</option>\n                  ))}\n                </select>\n              )}\n              <Button size=\"sm\" variant=\"outline\" onClick={() => window.location.href = '/flying-club/admin'}>\n                <Settings className=\"mr-2 h-4 w-4\" />\n                Club Admin\n              </Button>\n              <Button \n                size=\"sm\"\n                onClick={() => alert('Create new group functionality - Coming soon!')}\n              >\n                <Plus className=\"mr-2 h-4 w-4\" />\n                New Group\n              </Button>\n            </div>\n          </div>\n          <div className=\"flex gap-0 overflow-x-auto rounded-md border border-border bg-card\">\n            {(['dashboard', 'calendar', 'bookings', 'aircraft', 'flights', 'maintenance', 'billing', 'members'] as const).map((tab) => (\n              <button\n                key={tab}\n                onClick={() => setActiveTab(tab)}\n                className={`relative shrink-0 px-4 py-2.5 text-xs font-medium whitespace-nowrap transition-colors border-b-2 ${\n                  activeTab === tab\n                    ? 'border-primary text-foreground'\n                    : 'border-transparent text-muted-foreground hover:text-foreground'\n                }`}\n              >\n                {tab.charAt(0).toUpperCase() + tab.slice(1)}\n              </button>\n            ))}\n          </div>\n        </div>\n        {activeTab === 'dashboard' && (\n          <div className=\"space-y-6\">\n            {/* Stats Overview */}\n            <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\n              <Card>\n                <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                  <CardTitle className=\"text-sm font-medium\">Total Aircraft</CardTitle>\n                  <Plane className=\"h-4 w-4 text-muted-foreground\" />\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold\">3</div>\n                  <p className=\"text-xs text-muted-foreground mt-1\">2 available, 1 maintenance</p>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                  <CardTitle className=\"text-sm font-medium\">Upcoming Bookings</CardTitle>\n                  <Calendar className=\"h-4 w-4 text-muted-foreground\" />\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold\">{mockBookings.length}</div>\n                  <p className=\"text-xs text-muted-foreground mt-1\">Next: Today at 14:00</p>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                  <CardTitle className=\"text-sm font-medium\">Active Members</CardTitle>\n                  <Users className=\"h-4 w-4 text-muted-foreground\" />\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold\">7</div>\n                  <p className=\"text-xs text-muted-foreground mt-1\">Across 2 groups</p>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                  <CardTitle className=\"text-sm font-medium\">Maintenance Items</CardTitle>\n                  <Wrench className=\"h-4 w-4 text-muted-foreground\" />\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold text-destructive\">{mockMaintenance.length}</div>\n                  <p className=\"text-xs text-muted-foreground mt-1\">1 high priority</p>\n                </CardContent>\n              </Card>\n            </div>\n\n            {/* Groups Overview */}\n            <div className=\"grid gap-6 lg:grid-cols-2\">\n              {mockGroups.map((group) => (\n                <Card key={group.id} className=\"flex flex-col\">\n                  <CardHeader>\n                    <div className=\"flex items-start justify-between\">\n                      <div>\n                        <CardTitle>{group.name}</CardTitle>\n                        <CardDescription className=\"mt-1\">{group.description}</CardDescription>\n                      </div>\n                      <Button variant=\"ghost\" size=\"icon\">\n                        <MoreVertical className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  </CardHeader>\n                  <CardContent className=\"flex-1 flex flex-col space-y-4\">\n                    <div className=\"flex items-center gap-4 text-sm\">\n                      <div className=\"flex items-center gap-1.5 text-muted-foreground\">\n                        <Plane className=\"h-4 w-4\" />\n                        <span>{group.aircraft.length} aircraft</span>\n                      </div>\n                      <div className=\"flex items-center gap-1.5 text-muted-foreground\">\n                        <Users className=\"h-4 w-4\" />\n                        <span>{group.members} members</span>\n                      </div>\n                    </div>\n\n                    <Separator />\n\n                    <div className=\"flex-1 space-y-3\">\n                      <p className=\"text-sm font-medium\">Aircraft</p>\n                      {group.aircraft.map((aircraft) => (\n                        <div key={aircraft.id} className=\"flex items-center justify-between rounded-lg border border-border p-3\">\n                          <div className=\"space-y-1\">\n                            <div className=\"flex items-center gap-2\">\n                              <p className=\"font-medium text-sm\">{aircraft.nNumber}</p>\n                              <Badge variant={aircraft.status === 'Available' ? 'secondary' : 'destructive'} className=\"text-xs\">\n                                {aircraft.status}\n                              </Badge>\n                            </div>\n                            <p className=\"text-xs text-muted-foreground\">\n                              {aircraft.year} {aircraft.make} {aircraft.model}\n                            </p>\n                          </div>\n                          <div className=\"text-right\">\n                            <p className=\"text-sm font-semibold\">${aircraft.hourlyRate}/hr</p>\n                            <p className=\"text-xs text-muted-foreground\">{aircraft.hobbsHours} hrs</p>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n\n                    <div className=\"mt-auto pt-4\">\n                      <Button \n                        variant=\"outline\" \n                        className=\"w-full\"\n                        onClick={() => setViewingGroupDetails(group.id)}\n                      >\n                        View Group Details\n                      </Button>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n\n            {/* Upcoming Bookings & Maintenance */}\n            <div className=\"grid gap-6 lg:grid-cols-2\">\n              <Card>\n                <CardHeader>\n                  <div className=\"flex items-center justify-between\">\n                    <CardTitle>Upcoming Bookings</CardTitle>\n                    <Button \n                      variant=\"ghost\" \n                      size=\"sm\"\n                      onClick={() => setActiveTab('bookings')}\n                    >\n                      View All\n                    </Button>\n                  </div>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-3\">\n                    {mockBookings.map((booking) => (\n                      <div key={booking.id} className=\"flex items-center justify-between rounded-lg border border-border p-3\">\n                        <div className=\"space-y-1\">\n                          <div className=\"flex items-center gap-2\">\n                            <p className=\"font-medium text-sm\">{booking.aircraft}</p>\n                            <span className=\"text-xs text-muted-foreground\">â€¢</span>\n                            <p className=\"text-sm text-muted-foreground\">{booking.pilot}</p>\n                          </div>\n                          <p className=\"text-xs text-muted-foreground\">{booking.purpose}</p>\n                        </div>\n                        <div className=\"text-right\">\n                          <p className=\"text-sm font-medium\">{booking.date}</p>\n                          <p className=\"text-xs text-muted-foreground\">{booking.time}</p>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader>\n                  <div className=\"flex items-center justify-between\">\n                    <CardTitle>Maintenance Status</CardTitle>\n                    <Button \n                      variant=\"ghost\" \n                      size=\"sm\"\n                      onClick={() => setActiveTab('maintenance')}\n                    >\n                      View All\n                    </Button>\n                  </div>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-3\">\n                    {mockMaintenance.map((item) => (\n                      <div key={item.id} className=\"flex items-center justify-between rounded-lg border border-border p-3\">\n                        <div className=\"space-y-1\">\n                          <div className=\"flex items-center gap-2\">\n                            <p className=\"font-medium text-sm\">{item.aircraft}</p>\n                            <Badge variant={item.status === 'In Progress' ? 'default' : 'secondary'} className=\"text-xs\">\n                              {item.status}\n                            </Badge>\n                          </div>\n                          <p className=\"text-xs text-muted-foreground\">{item.description}</p>\n                        </div>\n                        <div className=\"text-right\">\n                          <p className=\"text-sm font-medium\">Due: {item.dueDate}</p>\n                          {item.priority === 'high' && (\n                            <div className=\"flex items-center justify-end gap-1 mt-1\">\n                              <AlertCircle className=\"h-3 w-3 text-destructive\" />\n                              <p className=\"text-xs text-destructive\">High Priority</p>\n                            </div>\n                          )}\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          </div>\n        )}\n\n        {activeTab === 'calendar' && (\n          <Card>\n            <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                <CardTitle>Flight Schedule</CardTitle>\n                <div className=\"flex items-center gap-2\">\n                  <Button \n                    variant=\"outline\" \n                    size=\"icon\"\n                    onClick={() => setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() - 1, 1))}\n                  >\n                    <ChevronLeft className=\"h-4 w-4\" />\n                  </Button>\n                  <span className=\"text-sm font-medium w-32 text-center\">\n                    {MONTHS[currentMonth.getMonth()]} {currentMonth.getFullYear()}\n                  </span>\n                  <Button \n                    variant=\"outline\" \n                    size=\"icon\"\n                    onClick={() => setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1, 1))}\n                  >\n                    <ChevronRight className=\"h-4 w-4\" />\n                  </Button>\n                  <Button \n                    className=\"ml-2 bg-emerald-500 hover:bg-emerald-600\"\n                    size=\"sm\"\n                    onClick={() => {\n                      setActiveFlight({\n                        id: 'calendar-flight-1',\n                        aircraftId: 'aircraft-1',\n                        aircraftName: 'N172SP (C172)',\n                        userId: 'user-1',\n                        userName: 'John Doe',\n                        hobbsStart: 1250.5\n                      });\n                      setShowFlightComplete(true);\n                    }}\n                  >\n                    <Plane className=\"mr-2 h-4 w-4\" />\n                    Complete Flight\n                  </Button>\n                </div>\n              </div>\n            </CardHeader>\n            <CardContent>\n              {/* Calendar Grid */}\n              <div className=\"space-y-2\">\n                {/* Day headers */}\n                <div className=\"grid grid-cols-7 gap-px bg-border rounded-lg overflow-hidden\">\n                  {DAYS.map(day => (\n                    <div key={day} className=\"bg-card p-3 text-center\">\n                      <span className=\"text-xs font-medium text-muted-foreground\">{day}</span>\n                    </div>\n                  ))}\n                </div>\n\n                {/* Calendar days */}\n                <div className=\"grid grid-cols-7 gap-px bg-border rounded-lg overflow-hidden\">\n                  {getDaysInMonth().map((day, index) => (\n                    <div\n                      key={index}\n                      className={`bg-card min-h-[100px] p-2 ${\n                        day ? 'hover:bg-muted/50 cursor-pointer transition-colors' : ''\n                      }`}\n                    >\n                      {day && (\n                        <>\n                          <span className=\"text-sm font-medium\">{day}</span>\n                          {/* Show bookings on certain days */}\n                          {(day === 23 || day === 24 || day === 25) && (\n                            <div className=\"mt-2 space-y-1\">\n                              <div className=\"rounded bg-primary/10 border border-primary/20 px-2 py-1\">\n                                <p className=\"text-xs font-medium text-primary\">N172SP</p>\n                                <p className=\"text-xs text-muted-foreground\">14:00</p>\n                              </div>\n                            </div>\n                          )}\n                        </>\n                      )}\n                    </div>\n                  ))}\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {activeTab === 'aircraft' && (\n          <div className=\"grid gap-6 md:grid-cols-2 lg:grid-cols-3\">\n            {mockGroups.flatMap(group => group.aircraft).map((aircraft) => (\n              <Card key={aircraft.id}>\n                <CardHeader>\n                  <div className=\"flex items-start justify-between\">\n                    <div>\n                      <CardTitle className=\"flex items-center gap-2\">\n                        {aircraft.nNumber}\n                        <Badge variant={aircraft.status === 'Available' ? 'secondary' : 'destructive'}>\n                          {aircraft.status}\n                        </Badge>\n                      </CardTitle>\n                      <CardDescription className=\"mt-1\">\n                        {aircraft.year} {aircraft.make} {aircraft.model}\n                      </CardDescription>\n                    </div>\n                  </div>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"flex items-center gap-4 text-sm\">\n                    <div className=\"flex items-center gap-1.5\">\n                      <DollarSign className=\"h-4 w-4 text-muted-foreground\" />\n                      <span>${aircraft.hourlyRate}/hr</span>\n                    </div>\n                    <div className=\"flex items-center gap-1.5\">\n                      <Clock className=\"h-4 w-4 text-muted-foreground\" />\n                      <span>{aircraft.hobbsHours} hrs</span>\n                    </div>\n                  </div>\n\n                  <Separator />\n\n                  <div className=\"space-y-2\">\n                    <div className=\"flex items-center justify-between text-sm\">\n                      <span className=\"text-muted-foreground\">Next Maintenance</span>\n                      <span className=\"font-medium\">250 hrs</span>\n                    </div>\n                    <Progress value={75} className=\"h-2\" />\n                  </div>\n\n                  <div className=\"flex gap-2\">\n                    <Button \n                      variant=\"outline\" \n                      className=\"flex-1\"\n                      onClick={() => {\n                        setActiveTab('calendar')\n                        alert(`Booking ${aircraft.nNumber} - Calendar view opened`)\n                      }}\n                    >\n                      <Calendar className=\"mr-2 h-4 w-4\" />\n                      Book\n                    </Button>\n                    <Button variant=\"outline\" size=\"icon\">\n                      <MoreVertical className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        )}\n\n        {activeTab === 'bookings' && (\n          <Card>\n            <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                <CardTitle>All Bookings</CardTitle>\n                <div className=\"flex items-center gap-2\">\n                  <Button variant=\"outline\" size=\"sm\">\n                    <Filter className=\"mr-2 h-4 w-4\" />\n                    Filter\n                  </Button>\n                  <Button \n                    size=\"sm\"\n                    onClick={() => alert('New booking form - Coming soon!')}\n                  >\n                    <Plus className=\"mr-2 h-4 w-4\" />\n                    New Booking\n                  </Button>\n                </div>\n              </div>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-2\">\n                {mockBookings.map((booking) => (\n                  <div key={booking.id} className=\"flex items-center justify-between rounded-lg border border-border p-4\">\n                    <div className=\"flex items-center gap-4\">\n                      <div className=\"flex h-10 w-10 items-center justify-center rounded-lg bg-primary/10\">\n                        <Plane className=\"h-5 w-5 text-primary\" />\n                      </div>\n                      <div className=\"space-y-1\">\n                        <p className=\"font-medium text-sm\">{booking.aircraft}</p>\n                        <p className=\"text-xs text-muted-foreground\">{booking.purpose}</p>\n                      </div>\n                    </div>\n                    <div className=\"flex items-center gap-6\">\n                      <div className=\"text-right\">\n                        <p className=\"text-sm font-medium\">{booking.pilot}</p>\n                        <p className=\"text-xs text-muted-foreground\">{booking.date} â€¢ {booking.time}</p>\n                      </div>\n                      <Button variant=\"ghost\" size=\"icon\">\n                        <MoreVertical className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {activeTab === 'maintenance' && (\n          <Card>\n            <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                <CardTitle>Maintenance Tracking</CardTitle>\n                <Button \n                  size=\"sm\"\n                  onClick={() => alert('Report maintenance issue - Coming soon!')}\n                >\n                  <Plus className=\"mr-2 h-4 w-4\" />\n                  Report Issue\n                </Button>\n              </div>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-2\">\n                {mockMaintenance.map((item) => (\n                  <div key={item.id} className=\"flex items-center justify-between rounded-lg border border-border p-4\">\n                    <div className=\"flex items-center gap-4\">\n                      <div className={`flex h-10 w-10 items-center justify-center rounded-lg ${\n                        item.priority === 'high' ? 'bg-destructive/10' : 'bg-muted'\n                      }`}>\n                        <Wrench className={`h-5 w-5 ${item.priority === 'high' ? 'text-destructive' : 'text-muted-foreground'}`} />\n                      </div>\n                      <div className=\"space-y-1\">\n                        <div className=\"flex items-center gap-2\">\n                          <p className=\"font-medium text-sm\">{item.aircraft}</p>\n                          <Badge variant={item.status === 'In Progress' ? 'default' : 'secondary'}>\n                            {item.status}\n                          </Badge>\n                        </div>\n                        <p className=\"text-xs text-muted-foreground\">{item.description}</p>\n                      </div>\n                    </div>\n                    <div className=\"flex items-center gap-6\">\n                      <div className=\"text-right\">\n                        <p className=\"text-sm font-medium\">Due: {item.dueDate}</p>\n                        {item.priority === 'high' && (\n                          <div className=\"flex items-center justify-end gap-1 mt-1\">\n                            <AlertCircle className=\"h-3 w-3 text-destructive\" />\n                            <p className=\"text-xs text-destructive\">High Priority</p>\n                          </div>\n                        )}\n                      </div>\n                      <Button variant=\"ghost\" size=\"icon\">\n                        <MoreVertical className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {['flights', 'billing', 'members'].includes(activeTab) && (\n          <Card>\n            <CardHeader>\n              <CardTitle>{activeTab.charAt(0).toUpperCase() + activeTab.slice(1)}</CardTitle>\n              <CardDescription>Manage your {activeTab} here</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"flex flex-col items-center justify-center py-12 text-center\">\n                <div className=\"rounded-full bg-muted p-4 mb-4\">\n                  {activeTab === 'flights' && <BookOpen className=\"h-8 w-8 text-muted-foreground\" />}\n                  {activeTab === 'billing' && <DollarSign className=\"h-8 w-8 text-muted-foreground\" />}\n                  {activeTab === 'members' && <Users className=\"h-8 w-8 text-muted-foreground\" />}\n                </div>\n                <h3 className=\"text-lg font-semibold mb-2\">No {activeTab} yet</h3>\n                <p className=\"text-sm text-muted-foreground mb-4\">Get started by adding your first {activeTab.slice(0, -1)}</p>\n                <Button\n                  onClick={() => alert(`Add ${activeTab.slice(0, -1)} - Coming soon!`)}\n                >\n                  <Plus className=\"mr-2 h-4 w-4\" />\n                  Add {activeTab.charAt(0).toUpperCase() + activeTab.slice(1, -1)}\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {/* Flight Completion Wizard */}\n        {activeFlight && (\n          <FlightCompleteWizard\n            open={showFlightComplete}\n            onOpenChange={setShowFlightComplete}\n            flight={activeFlight}\n            onComplete={async (data) => {\n              console.log('Flight completed:', data);\n              alert('Flight logged! (Demo - API not connected yet)');\n            }}\n          />\n        )}\n      </main>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\flying-club\\squawks\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardDescription' is defined but never used.","line":5,"column":52,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":67,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"CardDescription"},"fix":{"range":[152,169],"text":""},"desc":"Remove unused variable \"CardDescription\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'XCircle' is defined but never used.","line":12,"column":85,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":92,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"XCircle"},"fix":{"range":[625,634],"text":""},"desc":"Remove unused variable \"XCircle\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DollarSign' is defined but never used.","line":12,"column":94,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":104,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"DollarSign"},"fix":{"range":[634,646],"text":""},"desc":"Remove unused variable \"DollarSign\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":55,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2879,2882],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2879,2882],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\David\\next-dashboard\\app\\flying-club\\squawks\\page.tsx:57:21\n  55 |   const [groups, setGroups] = useState<any[]>([])\n  56 |\n> 57 |   useEffect(() => { setSquawks(demoSquawks); setLoading(false) }, [session])\n     |                     ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  58 |\n  59 |   useEffect(() => {\n  60 |     async function loadGroups() {","line":57,"column":21,"nodeType":null,"endLine":57,"endColumn":31},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":245,"column":193,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":245,"endColumn":196,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16507,16510],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16507,16510],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { useSession } from 'next-auth/react'\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Badge } from '@/components/ui/badge'\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog'\nimport { Input } from '@/components/ui/input'\nimport { Textarea } from '@/components/ui/textarea'\nimport { Label } from '@/components/ui/label'\nimport { Wrench, Plus, RefreshCw, AlertTriangle, CheckCircle, Clock, Plane, Search, XCircle, DollarSign } from 'lucide-react'\n\ninterface Squawk {\n  id: string\n  aircraftName: string\n  description: string\n  status: 'NEEDED' | 'IN_PROGRESS' | 'COMPLETED'\n  maintenanceType: 'PERSONAL' | 'CLUB'\n  isGrounded: boolean\n  reportedDate: string\n  resolvedDate: string | null\n  cost: number | null\n  reportedBy: string\n}\n\nconst demoSquawks: Squawk[] = [\n  { id: '1', aircraftName: 'N123AB (C172)', description: 'Left mag dropping on runup', status: 'NEEDED', maintenanceType: 'CLUB', isGrounded: true, reportedDate: '2024-02-15', resolvedDate: null, cost: null, reportedBy: 'John Smith' },\n  { id: '2', aircraftName: 'N456CD (C182)', description: 'Annual inspection due', status: 'IN_PROGRESS', maintenanceType: 'CLUB', isGrounded: true, reportedDate: '2024-02-01', resolvedDate: null, cost: null, reportedBy: 'Sarah Johnson' },\n  { id: '3', aircraftName: 'N123AB (C172)', description: 'Nav lights not working', status: 'COMPLETED', maintenanceType: 'CLUB', isGrounded: false, reportedDate: '2024-01-20', resolvedDate: '2024-01-22', cost: 150, reportedBy: 'Mike Davis' },\n  { id: '4', aircraftName: 'N789EF (PA28)', description: 'Oil change needed', status: 'NEEDED', maintenanceType: 'CLUB', isGrounded: false, reportedDate: '2024-02-18', resolvedDate: null, cost: null, reportedBy: 'Emily Chen' },\n  { id: '5', aircraftName: 'N111AA (C150)', description: 'Annual inspection due', status: 'NEEDED', maintenanceType: 'PERSONAL', isGrounded: true, reportedDate: '2024-02-10', resolvedDate: null, cost: null, reportedBy: 'John Smith' },\n]\n\nexport default function SquawkLogPage() {\n  const { data: session, status } = useSession()\n  const [loading, setLoading] = useState(true)\n  const [squawks, setSquawks] = useState<Squawk[]>([])\n  const [filter, setFilter] = useState<string>('all')\n  const [searchQuery, setSearchQuery] = useState('')\n  const [isDialogOpen, setIsDialogOpen] = useState(false)\n  const [newSquawk, setNewSquawk] = useState({\n    aircraft: '',\n    description: '',\n    isGrounded: false,\n    maintenanceType: 'CLUB' as 'PERSONAL' | 'CLUB',\n    postToMarketplace: false,\n    postAnonymously: true,\n    neededBy: '',\n    jobSize: 'MEDIUM',\n    allowTailNumber: false,\n    groupId: '',\n  })\n\n  const [groups, setGroups] = useState<any[]>([])\n\n  useEffect(() => { setSquawks(demoSquawks); setLoading(false) }, [session])\n\n  useEffect(() => {\n    async function loadGroups() {\n      const res = await fetch('/api/groups')\n      if (res.ok) {\n        const data = await res.json()\n        setGroups(Array.isArray(data) ? data : [])\n      }\n    }\n    if (session) loadGroups()\n  }, [session])\n\n  const handleAddSquawk = async () => {\n    const squawk: Squawk = { \n      id: crypto.randomUUID(), \n      aircraftName: newSquawk.aircraft, \n      description: newSquawk.description, \n      status: 'NEEDED', \n      maintenanceType: newSquawk.maintenanceType,\n      isGrounded: newSquawk.isGrounded, \n      reportedDate: new Date().toISOString(), \n      resolvedDate: null, \n      cost: null, \n      reportedBy: session?.user?.name || 'You' \n    }\n    setSquawks([squawk, ...squawks])\n    setIsDialogOpen(false)\n    setNewSquawk({ aircraft: '', description: '', isGrounded: false, maintenanceType: 'CLUB', postToMarketplace: false, postAnonymously: true, neededBy: '', jobSize: 'MEDIUM', allowTailNumber: false, groupId: '' })\n\n    if (newSquawk.postToMarketplace && newSquawk.maintenanceType === 'PERSONAL') {\n      const aircraftTypeMatch = newSquawk.aircraft.match(/\\(([^)]+)\\)/)\n      const aircraftType = aircraftTypeMatch ? aircraftTypeMatch[1] : null\n      try {\n        const normalizedSize = newSquawk.jobSize || (newSquawk.description.toLowerCase().includes('overhaul') || newSquawk.description.toLowerCase().includes('rebuild') ? 'LARGE' : 'MEDIUM')\n        await fetch('/api/mechanics/listings', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            title: newSquawk.description.slice(0, 120),\n            description: newSquawk.description,\n            category: 'OTHER',\n            urgency: newSquawk.isGrounded ? 'URGENT' : 'NORMAL',\n            aircraftType,\n            source: 'squawk',\n            anonymous: newSquawk.postAnonymously,\n            neededBy: newSquawk.neededBy || null,\n            jobSize: normalizedSize,\n            allowTailNumber: newSquawk.allowTailNumber,\n          }),\n        })\n      } catch (error) {\n        console.error('Failed to post squawk to marketplace', error)\n      }\n    }\n\n    if (newSquawk.postToMarketplace && newSquawk.maintenanceType === 'CLUB') {\n      try {\n        await fetch('/api/flying-club/maintenance/queue', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            description: newSquawk.description,\n            aircraftLabel: newSquawk.aircraft,\n            isGrounded: newSquawk.isGrounded,\n            neededBy: newSquawk.neededBy || null,\n            jobSize: newSquawk.jobSize,\n            allowTailNumber: newSquawk.allowTailNumber,\n            groupId: newSquawk.groupId || null,\n          }),\n        })\n      } catch (error) {\n        console.error('Failed to send squawk to club queue', error)\n      }\n    }\n  }\n\n  const handleStatusChange = (id: string, newStatus: 'NEEDED' | 'IN_PROGRESS' | 'COMPLETED') => {\n    setSquawks(squawks.map(s => s.id === id ? { ...s, status: newStatus, resolvedDate: newStatus === 'COMPLETED' ? new Date().toISOString() : null } : s))\n  }\n\n  const formatDate = (d: string) => new Date(d).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })\n\n  const filteredSquawks = squawks.filter(sq => filter === 'all' || sq.status === filter).filter(sq => !searchQuery || sq.description.toLowerCase().includes(searchQuery.toLowerCase()))\n\n  const stats = { total: squawks.length, needed: squawks.filter(s => s.status === 'NEEDED').length, inProgress: squawks.filter(s => s.status === 'IN_PROGRESS').length, grounded: squawks.filter(s => s.isGrounded && s.status !== 'COMPLETED').length, totalCost: squawks.reduce((sum, s) => sum + (s.cost || 0), 0) }\n\n  const getStatusIcon = (s: string) => s === 'NEEDED' ? <AlertTriangle className=\"h-4 w-4 text-amber-500\" /> : s === 'IN_PROGRESS' ? <Clock className=\"h-4 w-4 text-blue-500\" /> : <CheckCircle className=\"h-4 w-4 text-green-500\" />\n  const getStatusColor = (s: string) => s === 'NEEDED' ? 'bg-amber-500/10 text-amber-600' : s === 'IN_PROGRESS' ? 'bg-blue-500/10 text-blue-600' : 'bg-green-500/10 text-green-600'\n\n  if (status === 'loading' || loading) return <div className=\"min-h-screen bg-background flex items-center justify-center\"><RefreshCw className=\"h-8 w-8 animate-spin text-primary\" /></div>\n  if (!session) return <div className=\"min-h-screen bg-background flex items-center justify-center p-4\"><Card className=\"max-w-md w-full\"><CardContent className=\"pt-6 text-center\"><Wrench className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground\" /><h2 className=\"text-xl font-bold mb-2\">Maintenance Squawk Log</h2><p className=\"text-muted-foreground mb-4\">Sign in to report issues</p><Button asChild><a href=\"/login\">Sign In</a></Button></CardContent></Card></div>\n\n  return (\n    <div className=\"min-h-screen bg-background p-4 md:p-8 pt-10\">\n      <div className=\"max-w-7xl mx-auto space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div><h1 className=\"text-3xl font-bold flex items-center gap-2\"><Wrench className=\"h-8 w-8\" />Maintenance Squawk Log</h1><p className=\"text-muted-foreground\">Report and track aircraft issues</p></div>\n          <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n            <DialogTrigger asChild><Button className=\"gap-2\"><Plus className=\"h-4 w-4\" />Report Issue</Button></DialogTrigger>\n            <DialogContent><DialogHeader><DialogTitle>Report New Squawk</DialogTitle></DialogHeader>\n              <div className=\"space-y-4 pt-4\">\n                <div><Label>Type</Label>\n                  <select className=\"w-full mt-1 p-2 border rounded-md\" value={newSquawk.maintenanceType} onChange={(e) => setNewSquawk({ ...newSquawk, maintenanceType: e.target.value as 'PERSONAL' | 'CLUB' })}>\n                    <option value=\"CLUB\">Club Aircraft</option>\n                    <option value=\"PERSONAL\">Personal Aircraft</option>\n                  </select>\n                </div>\n                {newSquawk.maintenanceType === 'CLUB' && (\n                  <div>\n                    <Label>Club</Label>\n                    <select className=\"w-full mt-1 p-2 border rounded-md\" value={newSquawk.groupId} onChange={(e) => setNewSquawk({ ...newSquawk, groupId: e.target.value })}>\n                      <option value=\"\">Select club...</option>\n                      {groups.map((group) => (\n                        <option key={group.id} value={group.id}>{group.name}</option>\n                      ))}\n                    </select>\n                  </div>\n                )}\n                <div><Label>Aircraft</Label><select className=\"w-full mt-1 p-2 border rounded-md\" value={newSquawk.aircraft} onChange={(e) => setNewSquawk({ ...newSquawk, aircraft: e.target.value })}><option value=\"\">Select...</option><option>N123AB (C172)</option><option>N456CD (C182)</option><option>N789EF (PA28)</option></select></div>\n                <div><Label>Description</Label><Textarea placeholder=\"Describe...\" value={newSquawk.description} onChange={(e) => setNewSquawk({ ...newSquawk, description: e.target.value })} /></div>\n                <div className=\"flex items-center gap-2\"><input type=\"checkbox\" checked={newSquawk.isGrounded} onChange={(e) => setNewSquawk({ ...newSquawk, isGrounded: e.target.checked })} /><Label>Ground aircraft</Label></div>\n                <div className=\"flex items-center gap-2\"><input type=\"checkbox\" checked={newSquawk.postToMarketplace} onChange={(e) => setNewSquawk({ ...newSquawk, postToMarketplace: e.target.checked })} /><Label>Post to Service Bay</Label></div>\n                {newSquawk.postToMarketplace && (\n                  <div className=\"flex items-center gap-2 pl-6\">\n                    <input type=\"checkbox\" checked={newSquawk.postAnonymously} onChange={(e) => setNewSquawk({ ...newSquawk, postAnonymously: e.target.checked })} />\n                    <Label>Hide my identity</Label>\n                  </div>\n                )}\n                {newSquawk.postToMarketplace && (\n                  <div className=\"space-y-3 pl-6\">\n                    <div>\n                      <Label className=\"text-xs\">Needed by</Label>\n                      <Input type=\"date\" value={newSquawk.neededBy} onChange={(e) => setNewSquawk({ ...newSquawk, neededBy: e.target.value })} />\n                    </div>\n                    <div>\n                      <Label className=\"text-xs\">Job size</Label>\n                      <select className=\"w-full mt-1 p-2 border rounded-md\" value={newSquawk.jobSize} onChange={(e) => setNewSquawk({ ...newSquawk, jobSize: e.target.value })}>\n                        <option value=\"SMALL\">Small</option>\n                        <option value=\"MEDIUM\">Medium</option>\n                        <option value=\"LARGE\">Large</option>\n                      </select>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      <input type=\"checkbox\" checked={newSquawk.allowTailNumber} onChange={(e) => setNewSquawk({ ...newSquawk, allowTailNumber: e.target.checked })} />\n                      <Label>Share tail number with mechanics</Label>\n                    </div>\n                    {newSquawk.maintenanceType === 'CLUB' && (\n                      <p className=\"text-xs text-muted-foreground\">Club squawks are sent to the admin queue for approval.</p>\n                    )}\n                  </div>\n                )}\n                <Button onClick={handleAddSquawk} className=\"w-full\">Submit</Button>\n              </div>\n            </DialogContent>\n          </Dialog>\n        </div>\n\n        <div className=\"grid gap-4 md:grid-cols-5\">\n          <Card><CardContent className=\"pt-4\"><div><p className=\"text-sm text-muted-foreground\">Total</p><p className=\"text-2xl font-bold\">{stats.total}</p></div></CardContent></Card>\n          <Card className=\"border-amber-500/30\"><CardContent className=\"pt-4\"><div><p className=\"text-sm text-muted-foreground\">Needed</p><p className=\"text-2xl font-bold text-amber-600\">{stats.needed}</p></div></CardContent></Card>\n          <Card className=\"border-blue-500/30\"><CardContent className=\"pt-4\"><div><p className=\"text-sm text-muted-foreground\">In Progress</p><p className=\"text-2xl font-bold text-blue-600\">{stats.inProgress}</p></div></CardContent></Card>\n          <Card className=\"border-red-500/30\"><CardContent className=\"pt-4\"><div><p className=\"text-sm text-muted-foreground\">Grounded</p><p className=\"text-2xl font-bold text-red-600\">{stats.grounded}</p></div></CardContent></Card>\n          <Card className=\"border-green-500/30\"><CardContent className=\"pt-4\"><div><p className=\"text-sm text-muted-foreground\">Cost</p><p className=\"text-2xl font-bold text-green-600\">${stats.totalCost}</p></div></CardContent></Card>\n        </div>\n\n        <div className=\"flex flex-wrap items-center gap-3\">\n          <div className=\"relative flex-1 min-w-[200px] max-w-md\"><Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" /><Input placeholder=\"Search...\" className=\"pl-9\" value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)} /></div>\n          <div className=\"flex gap-2\"><Button variant={filter === 'all' ? 'default' : 'outline'} size=\"sm\" onClick={() => setFilter('all')}>All</Button><Button variant={filter === 'NEEDED' ? 'default' : 'outline'} size=\"sm\" onClick={() => setFilter('NEEDED')}>Needed</Button><Button variant={filter === 'IN_PROGRESS' ? 'default' : 'outline'} size=\"sm\" onClick={() => setFilter('IN_PROGRESS')}>In Progress</Button><Button variant={filter === 'COMPLETED' ? 'default' : 'outline'} size=\"sm\" onClick={() => setFilter('COMPLETED')}>Done</Button></div>\n        </div>\n\n        <Card><CardHeader><CardTitle>Maintenance Items</CardTitle></CardHeader><CardContent>\n          <div className=\"space-y-3\">{filteredSquawks.map((squawk) => (\n            <div key={squawk.id} className={`p-4 rounded-lg border ${squawk.isGrounded && squawk.status !== 'COMPLETED' ? 'border-red-500/50 bg-red-500/5' : 'bg-card'}`}>\n              <div className=\"flex items-start justify-between gap-4\">\n                <div className=\"flex-1\">\n                  <div className=\"flex items-center gap-2 mb-1\">\n                    <Plane className=\"h-4 w-4\" />\n                    <span className=\"font-medium\">{squawk.aircraftName}</span>\n                    <Badge variant=\"outline\" className={squawk.maintenanceType === 'CLUB' ? 'border-blue-500/50 text-blue-600' : 'border-purple-500/50 text-purple-600'}>\n                      {squawk.maintenanceType === 'CLUB' ? 'Club' : 'Personal'}\n                    </Badge>\n                    {squawk.isGrounded && squawk.status !== 'COMPLETED' && <Badge variant=\"destructive\">GROUNDED</Badge>}\n                  </div>\n                  <p className=\"text-sm\">{squawk.description}</p>\n                  <div className=\"flex gap-4 mt-2 text-xs text-muted-foreground\"><span>{squawk.reportedBy}</span><span>{formatDate(squawk.reportedDate)}</span>{squawk.cost && <span className=\"text-green-600\">${squawk.cost}</span>}</div>\n                </div>\n                <div className=\"flex items-center gap-2\"><Badge className={getStatusColor(squawk.status)}>{getStatusIcon(squawk.status)}<span className=\"ml-1\">{squawk.status}</span></Badge>\n                  {squawk.status !== 'COMPLETED' && <select className=\"text-xs border rounded px-2 py-1\" value={squawk.status} onChange={(e) => handleStatusChange(squawk.id, e.target.value as any)}><option value=\"NEEDED\">Needed</option><option value=\"IN_PROGRESS\">In Progress</option><option value=\"COMPLETED\">Done</option></select>}\n                </div>\n              </div>\n            </div>\n          ))}</div>\n        </CardContent></Card>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\forgot-password\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useRouter' is defined but never used.","line":5,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":19,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"useRouter"},"fix":{"range":[79,124],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":36,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":36,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState } from 'react';\nimport Link from 'next/link';\nimport { useRouter } from 'next/navigation';\n\nexport default function ForgotPasswordPage() {\n  const [email, setEmail] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const [message, setMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);\n  const [resetUrl, setResetUrl] = useState<string | null>(null);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsLoading(true);\n    setMessage(null);\n    setResetUrl(null);\n\n    try {\n      const res = await fetch('/api/auth/forgot-password', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ email })\n      });\n\n      const data = await res.json();\n\n      if (res.ok) {\n        setMessage({ type: 'success', text: data.message });\n        if (data.resetUrl) {\n          setResetUrl(data.resetUrl);\n        }\n      } else {\n        setMessage({ type: 'error', text: data.error || 'Failed to process request' });\n      }\n    } catch (error) {\n      setMessage({ type: 'error', text: 'An error occurred. Please try again.' });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-b from-slate-950 via-slate-900 to-slate-800 flex items-center justify-center px-4\">\n      <div className=\"w-full max-w-md\">\n        <div className=\"text-center mb-8\">\n          <Link href=\"/\" className=\"inline-flex items-center gap-2 text-2xl font-bold text-white\">\n            <span>âœˆï¸</span>\n            <span>Aviation</span>\n          </Link>\n        </div>\n\n        <div className=\"rounded-2xl border border-slate-800 bg-slate-900/70 p-8\">\n          <h1 className=\"text-2xl font-bold text-white mb-2\">Forgot Password</h1>\n          <p className=\"text-slate-400 mb-6\">\n            Enter your email address and we&apos;ll send you a link to reset your password.\n          </p>\n\n          <form \n            onSubmit={handleSubmit} \n            className=\"space-y-4\"\n            autoComplete=\"on\"\n          >\n            <div>\n              <label \n                htmlFor=\"email\" \n                className=\"block text-sm font-medium text-slate-300 mb-1\"\n              >\n                Email Address\n              </label>\n              <input\n                id=\"email\"\n                name=\"email\"\n                type=\"email\"\n                value={email}\n                onChange={(e) => setEmail(e.target.value)}\n                required\n                autoComplete=\"email\"\n                autoFocus\n                aria-required=\"true\"\n                aria-label=\"Email address for password reset\"\n                inputMode=\"email\"\n                className=\"w-full rounded-xl border border-slate-700 bg-slate-800 px-4 py-3 text-slate-100 placeholder-slate-500 focus:border-emerald-500 focus:outline-none\"\n                placeholder=\"you@example.com\"\n              />\n            </div>\n\n            {message && (\n              <div \n                className={`p-3 rounded-lg text-sm ${\n                  message.type === 'success' \n                    ? 'bg-emerald-500/20 text-emerald-400 border border-emerald-500/30' \n                    : 'bg-red-500/20 text-red-400 border border-red-500/30'\n                }`}\n                role=\"alert\"\n                aria-live=\"polite\"\n              >\n                {message.text}\n              </div>\n            )}\n\n            {resetUrl && (\n              <div className=\"p-3 rounded-lg text-sm bg-blue-500/20 text-blue-400 border border-blue-500/30\">\n                <p className=\"font-medium mb-1\">Demo Mode - Reset Link:</p>\n                <a \n                  href={resetUrl} \n                  className=\"text-blue-300 underline break-all text-xs\"\n                  target=\"_blank\"\n                  rel=\"noopener noreferrer\"\n                >\n                  {resetUrl}\n                </a>\n              </div>\n            )}\n\n            <button\n              type=\"submit\"\n              disabled={isLoading}\n              className=\"w-full rounded-xl bg-emerald-500 py-3 font-semibold text-emerald-950 hover:bg-emerald-400 disabled:opacity-50 transition-colors\"\n              aria-label={isLoading ? \"Sending reset link\" : \"Send password reset link\"}\n              aria-busy={isLoading}\n            >\n              {isLoading ? 'Sending...' : 'Send Reset Link'}\n            </button>\n          </form>\n\n          <div className=\"mt-6 text-center\">\n            <Link \n              href=\"/login\" \n              className=\"text-sm text-slate-400 hover:text-slate-300\"\n            >\n              â† Back to Login\n            </Link>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\fuel-saver\\AuthModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useCallback' is defined but never used.","line":3,"column":31,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":42,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"useCallback"},"fix":{"range":[43,56],"text":""},"desc":"Remove unused variable \"useCallback\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'signOut' is defined but never used.","line":4,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":37,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"signOut"},"fix":{"range":[100,109],"text":""},"desc":"Remove unused variable \"signOut\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'session' is assigned a value but never used.","line":15,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'mode' is assigned a value but never used.","line":17,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":17,"endColumn":14},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\David\\next-dashboard\\app\\fuel-saver\\AuthModal.tsx:22:7\n  20 |   useEffect(() => {\n  21 |     if (isOpen) {\n> 22 |       setMode('select');\n     |       ^^^^^^^ Avoid calling setState() directly within an effect\n  23 |     }\n  24 |   }, [isOpen]);\n  25 |","line":22,"column":7,"nodeType":null,"endLine":22,"endColumn":14}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect, useCallback } from 'react';\nimport { useSession, signIn, signOut } from 'next-auth/react';\nimport { useRouter } from 'next/navigation';\n\ninterface AuthModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  action: 'save' | 'load' | 'export';\n  onConfirm?: () => void;\n}\n\nexport default function AuthModal({ isOpen, onClose, action, onConfirm }: AuthModalProps) {\n  const { data: session, status } = useSession();\n  const router = useRouter();\n  const [mode, setMode] = useState<'select' | 'confirm'>('select');\n\n  // Reset mode when modal opens\n  useEffect(() => {\n    if (isOpen) {\n      setMode('select');\n    }\n  }, [isOpen]);\n\n  if (!isOpen) return null;\n\n  const handleCreateAccount = () => {\n    onClose();\n    router.push('/signup');\n  };\n\n  const handleContinue = () => {\n    if (onConfirm) {\n      onConfirm();\n    }\n    onClose();\n  };\n\n  return (\n    <div className=\"fixed inset-0 z-[9999] flex items-center justify-center\">\n      {/* Backdrop */}\n      <div \n        className=\"absolute inset-0 bg-black/60 backdrop-blur-sm\"\n        onClick={onClose}\n      />\n      \n      {/* Modal */}\n      <div className=\"relative bg-slate-800 rounded-xl p-6 max-w-sm w-full mx-4 shadow-2xl border border-slate-700\">\n        {/* Icon */}\n        <div className=\"text-4xl text-center mb-4\">\n          {action === 'save' ? 'ðŸ’¾' : action === 'load' ? 'ðŸ“‚' : 'ðŸ“¤'}\n        </div>\n\n        {/* Title */}\n        <h3 className=\"text-xl font-bold text-white text-center mb-2\">\n          {action === 'save' ? 'Save requires an account' : \n           action === 'load' ? 'Load requires an account' : \n           'Export requires an account'}\n        </h3>\n\n        {/* Description */}\n        <p className=\"text-slate-400 text-center mb-6\">\n          Create one to save your plans and access from any device. \n          Or continue without an account (saved locally only).\n        </p>\n\n        {/* Buttons */}\n        <div className=\"flex flex-col gap-3\">\n          <button\n            onClick={handleCreateAccount}\n            className=\"w-full bg-emerald-500 hover:bg-emerald-400 text-white font-semibold py-3 px-4 rounded-lg transition\"\n          >\n            Create Free Account\n          </button>\n          \n          <button\n            onClick={handleContinue}\n            className=\"w-full bg-slate-700 hover:bg-slate-600 text-white font-medium py-3 px-4 rounded-lg transition\"\n          >\n            Continue Without Account\n          </button>\n          \n          <button\n            onClick={onClose}\n            className=\"w-full text-slate-500 hover:text-white text-sm py-2 transition\"\n          >\n            Cancel\n          </button>\n        </div>\n\n        {/* Already have account */}\n        {status !== 'authenticated' && (\n          <p className=\"text-center text-sm text-slate-500 mt-4\">\n            Already have an account?{' '}\n            <button \n              onClick={() => { onClose(); signIn(); }}\n              className=\"text-sky-400 hover:underline\"\n            >\n              Sign in\n            </button>\n          </p>\n        )}\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\fuel-saver\\FlightPlayback.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useRef' is defined but never used.","line":3,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":26,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"useRef"},"fix":{"range":[32,40],"text":""},"desc":"Remove unused variable \"useRef\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useRef } from 'react';\n\ninterface TrackPoint {\n  timestamp: string;\n  lat: number;\n  lon: number;\n  alt?: number;\n  speed?: number;\n  heading?: number;\n  vs?: number;\n}\n\ninterface FlightRecording {\n  id: string;\n  filename: string;\n  fileType: string;\n  flightDate?: string;\n  departure?: string;\n  arrival?: string;\n  duration?: number;\n  track: TrackPoint[];\n}\n\nexport default function FlightPlayback() {\n  const [recording, setRecording] = useState<FlightRecording | null>(null);\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [playbackSpeed, setPlaybackSpeed] = useState(1);\n  const [currentIndex, setCurrentIndex] = useState(0);\n  const [error, setError] = useState<string | null>(null);\n\n  // Parse GPX file\n  const parseGPX = (content: string): TrackPoint[] => {\n    const parser = new DOMParser();\n    const doc = parser.parseFromString(content, 'text/xml');\n    const trkpts = doc.querySelectorAll('trkpt');\n    \n    const points: TrackPoint[] = [];\n    trkpts.forEach((pt) => {\n      const lat = parseFloat(pt.getAttribute('lat') || '0');\n      const lon = parseFloat(pt.getAttribute('lon') || '0');\n      const ele = pt.querySelector('ele')?.textContent;\n      const time = pt.querySelector('time')?.textContent;\n      \n      if (lat && lon) {\n        points.push({\n          timestamp: time || new Date().toISOString(),\n          lat,\n          lon,\n          alt: ele ? parseFloat(ele) : undefined,\n        });\n      }\n    });\n    \n    return points;\n  };\n\n  // Parse CSV file (simple format)\n  const parseCSV = (content: string): TrackPoint[] => {\n    const lines = content.split('\\n');\n    const points: TrackPoint[] = [];\n    \n    for (const line of lines) {\n      const parts = line.split(',').map(p => p.trim());\n      if (parts.length >= 2) {\n        const lat = parseFloat(parts[0]);\n        const lon = parseFloat(parts[1]);\n        if (!isNaN(lat) && !isNaN(lon)) {\n          points.push({\n            timestamp: parts[2] || new Date().toISOString(),\n            lat,\n            lon,\n            alt: parts[3] ? parseFloat(parts[3]) : undefined,\n            speed: parts[4] ? parseFloat(parts[4]) : undefined,\n          });\n        }\n      }\n    }\n    \n    return points;\n  };\n\n  // Handle file upload\n  const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    setError(null);\n    const reader = new FileReader();\n    \n    reader.onload = (event) => {\n      try {\n        const content = event.target?.result as string;\n        const ext = file.name.toLowerCase();\n        let track: TrackPoint[] = [];\n        let fileType = '';\n\n        if (ext.endsWith('.gpx')) {\n          track = parseGPX(content);\n          fileType = 'GPX';\n        } else if (ext.endsWith('.csv') || ext.endsWith('.igc')) {\n          track = parseCSV(content);\n          fileType = ext.endsWith('.igc') ? 'IGC' : 'CSV';\n        } else {\n          setError('Unsupported file format. Please upload GPX, CSV, or IGC files.');\n          return;\n        }\n\n        if (track.length === 0) {\n          setError('No valid track points found in file.');\n          return;\n        }\n\n        // Calculate duration\n        const startTime = new Date(track[0].timestamp).getTime();\n        const endTime = new Date(track[track.length - 1].timestamp).getTime();\n        const duration = Math.round((endTime - startTime) / 60000); // minutes\n\n        // Try to extract departure/arrival from filename\n        const filenameMatch = file.name.match(/([A-Z]{4})[-_]([A-Z]{4})/);\n        \n        const newRecording: FlightRecording = {\n          id: crypto.randomUUID(),\n          filename: file.name,\n          fileType,\n          flightDate: track[0]?.timestamp.split('T')[0],\n          departure: filenameMatch?.[1],\n          arrival: filenameMatch?.[2],\n          duration,\n          track,\n        };\n\n        setRecording(newRecording);\n        setCurrentIndex(0);\n        setIsPlaying(false);\n      } catch (err) {\n        setError('Error parsing file. Please check the format.');\n        console.error(err);\n      }\n    };\n\n    reader.readAsText(file);\n  };\n\n  // Playback control\n  const togglePlayback = () => {\n    if (!recording) return;\n    setIsPlaying(!isPlaying);\n    \n    if (!isPlaying) {\n      // Start playing\n      const interval = setInterval(() => {\n        setCurrentIndex((prev) => {\n          if (prev >= recording.track.length - 1) {\n            setIsPlaying(false);\n            clearInterval(interval);\n            return prev;\n          }\n          return prev + 1;\n        });\n      }, 1000 / playbackSpeed);\n    }\n  };\n\n  const resetPlayback = () => {\n    setIsPlaying(false);\n    setCurrentIndex(0);\n  };\n\n  const currentPoint = recording?.track[currentIndex];\n\n  return (\n    <div className=\"bg-slate-800 rounded-lg p-4 space-y-4\">\n      <h3 className=\"font-semibold text-white flex items-center gap-2\">\n        <span>ðŸ›«</span> Flight Playback\n      </h3>\n\n      {/* File Upload */}\n      <div>\n        <label className=\"block text-xs text-slate-400 mb-1\">Import Flight (GPX, CSV, IGC)</label>\n        <input\n          type=\"file\"\n          accept=\".gpx,.csv,.igc\"\n          onChange={handleFileUpload}\n          className=\"w-full bg-slate-700 border border-slate-600 rounded px-3 py-2 text-white text-sm file:mr-2 file:py-1 file:px-3 file:rounded file:border-0 file:bg-sky-500 file:text-white file:cursor-pointer\"\n        />\n        <p className=\"text-xs text-slate-500 mt-1\">Import from ForeFlight, Garmin, CloudAhoy, etc.</p>\n      </div>\n\n      {error && (\n        <div className=\"bg-red-500/20 text-red-400 p-2 rounded text-sm\">{error}</div>\n      )}\n\n      {/* Recording Info */}\n      {recording && (\n        <>\n          <div className=\"bg-slate-700 rounded p-3 space-y-2\">\n            <div className=\"flex justify-between text-sm\">\n              <span className=\"text-slate-400\">File:</span>\n              <span className=\"text-white\">{recording.filename}</span>\n            </div>\n            <div className=\"flex justify-between text-sm\">\n              <span className=\"text-slate-400\">Format:</span>\n              <span className=\"text-white\">{recording.fileType}</span>\n            </div>\n            <div className=\"flex justify-between text-sm\">\n              <span className=\"text-slate-400\">Duration:</span>\n              <span className=\"text-white\">{recording.duration} min</span>\n            </div>\n            <div className=\"flex justify-between text-sm\">\n              <span className=\"text-slate-400\">Track Points:</span>\n              <span className=\"text-white\">{recording.track.length}</span>\n            </div>\n            {recording.departure && recording.arrival && (\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"text-slate-400\">Route:</span>\n                <span className=\"text-white\">{recording.departure} â†’ {recording.arrival}</span>\n              </div>\n            )}\n          </div>\n\n          {/* Playback Controls */}\n          <div className=\"space-y-3\">\n            {/* Progress */}\n            <div className=\"relative\">\n              <input\n                type=\"range\"\n                min={0}\n                max={recording.track.length - 1}\n                value={currentIndex}\n                onChange={(e) => setCurrentIndex(parseInt(e.target.value))}\n                className=\"w-full\"\n              />\n              <div className=\"flex justify-between text-xs text-slate-500 mt-1\">\n                <span>Start</span>\n                <span>{currentIndex + 1} / {recording.track.length}</span>\n                <span>End</span>\n              </div>\n            </div>\n\n            {/* Controls */}\n            <div className=\"flex items-center gap-2\">\n              <button\n                onClick={togglePlayback}\n                className=\"bg-sky-500 hover:bg-sky-600 text-white px-4 py-2 rounded font-medium flex items-center gap-2\"\n              >\n                {isPlaying ? 'â¸ Pause' : 'â–¶ Play'}\n              </button>\n              <button\n                onClick={resetPlayback}\n                className=\"bg-slate-700 hover:bg-slate-600 text-white px-3 py-2 rounded\"\n              >\n                â¹ Reset\n              </button>\n              \n              {/* Speed */}\n              <div className=\"flex items-center gap-1 ml-auto\">\n                <span className=\"text-xs text-slate-400\">Speed:</span>\n                {[1, 2, 5, 10].map((speed) => (\n                  <button\n                    key={speed}\n                    onClick={() => setPlaybackSpeed(speed)}\n                    className={`px-2 py-1 rounded text-xs ${\n                      playbackSpeed === speed \n                        ? 'bg-sky-500 text-white' \n                        : 'bg-slate-700 text-slate-300'\n                    }`}\n                  >\n                    {speed}x\n                  </button>\n                ))}\n              </div>\n            </div>\n\n            {/* Current Point Info */}\n            {currentPoint && (\n              <div className=\"bg-slate-700 rounded p-2 grid grid-cols-2 gap-2 text-xs\">\n                <div>\n                  <span className=\"text-slate-400\">Position:</span>\n                  <span className=\"text-white ml-1\">\n                    {currentPoint.lat.toFixed(4)}, {currentPoint.lon.toFixed(4)}\n                  </span>\n                </div>\n                {currentPoint.alt && (\n                  <div>\n                    <span className=\"text-slate-400\">Altitude:</span>\n                    <span className=\"text-white ml-1\">{currentPoint.alt} ft</span>\n                  </div>\n                )}\n                {currentPoint.speed && (\n                  <div>\n                    <span className=\"text-slate-400\">Speed:</span>\n                    <span className=\"text-white ml-1\">{currentPoint.speed} kts</span>\n                  </div>\n                )}\n                <div>\n                  <span className=\"text-slate-400\">Time:</span>\n                  <span className=\"text-white ml-1\">\n                    {new Date(currentPoint.timestamp).toLocaleTimeString()}\n                  </span>\n                </div>\n              </div>\n            )}\n          </div>\n        </>\n      )}\n\n      {/* Tips */}\n      {!recording && (\n        <div className=\"text-xs text-slate-500 space-y-1\">\n          <p>Export your flight track from:</p>\n          <ul className=\"list-disc list-inside\">\n            <li>ForeFlight: More â†’ Track Logs â†’ Export</li>\n            <li>Garmin Pilot: My Flights â†’ Export</li>\n            <li>CloudAhoy: Import/Export â†’ Download</li>\n            <li>X-Plane: Track logs folder</li>\n          </ul>\n        </div>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\fuel-saver\\LeafletMap.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":104,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":104,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2476,2479],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2476,2479],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":111,"column":85,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":88,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2772,2775],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2772,2775],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":113,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":113,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2871,2874],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2871,2874],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":205,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":205,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7220,7223],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7220,7223],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleViewStateInfo' is assigned a value but never used.","line":228,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":228,"endColumn":28},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":426,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":426,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17366,17369],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17366,17369],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'showAirspaces' is assigned a value but never used.","line":536,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":536,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'showStateOverlay' is assigned a value but never used.","line":537,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":537,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'showNotams' is assigned a value but never used.","line":538,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":538,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'onStateClick' is defined but never used.","line":541,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":541,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'performanceMode' is assigned a value but never used.","line":544,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":544,"endColumn":18},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":547,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":547,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21753,21756],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21753,21756],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":548,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":548,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21804,21807],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21804,21807],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'notams' is assigned a value but never used.","line":549,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":549,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setNotams' is assigned a value but never used.","line":549,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":549,"endColumn":27},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":549,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":549,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21855,21858],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21855,21858],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleMoveEnd' is assigned a value but never used.","line":592,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":592,"endColumn":24}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[376,379],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[376,379],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":8,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect, useRef, useMemo, useCallback } from 'react';\nimport { MapContainer, TileLayer, Popup, Polyline, CircleMarker, useMapEvents } from 'react-leaflet';\nimport 'leaflet/dist/leaflet.css';\n\n// Fix Leaflet icon issue\nif (typeof window !== 'undefined') {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  delete (window as any).L?.Icon?.Default?.prototype?._getIconUrl;\n}\n\ninterface Airport {\n  icao: string;\n  iata?: string;\n  name: string;\n  city?: string;\n  latitude: number;\n  longitude: number;\n  type?: string;\n}\n\ninterface Waypoint {\n  id: string;\n  icao: string;\n  name: string;\n  latitude: number;\n  longitude: number;\n}\n\ninterface FuelPrice {\n  icao: string;\n  price100ll: number | null;\n  priceJetA?: number | null;\n  source?: string;\n  sourceUrl?: string;\n  lastReported?: string;\n  attribution?: {\n    name: string;\n    url: string;\n    airbossUrl: string;\n  };\n}\n\ninterface AirportDetails {\n  icao: string;\n  name: string;\n  type?: string;\n  elevation_ft?: number;\n  city?: string;\n  state?: string;\n  runways?: { length_ft: number; surface: string; he_ident: string }[];\n  frequencies?: { frequency_mhz: number; description: string; type: string }[];\n  fuel?: { \n    price100ll: number; \n    priceJetA?: number;\n    source: string;\n    sourceUrl?: string;\n    lastReported?: string;\n    providerName?: string;\n    providerPhone?: string;\n    community100ll?: {\n      price: number;\n      fbo: string | null;\n      date: string;\n      reportedAt: string;\n      daysAgo: number;\n    } | null;\n    communityJetA?: {\n      price: number;\n      fbo: string | null;\n      date: string;\n      reportedAt: string;\n      daysAgo: number;\n    } | null;\n    priceDivergence?: {\n      type: string;\n      airnavPrice: number;\n      communityPrice: number;\n      difference: string;\n    } | null;\n  };\n  landingFee?: { amount: number };\n  hasTower?: boolean;\n  attendance?: string;\n  phone?: string;\n  manager?: string;\n}\n\ninterface LeafletMapProps {\n  airports: Airport[];\n  waypoints: Waypoint[];\n  fuelPrices: Record<string, FuelPrice>;\n  onBoundsChange: (bounds: { minLat: number; maxLat: number; minLon: number; maxLon: number }) => void;\n  onAirportClick: (airport: Airport) => void;\n  mapCenter: [number, number];\n  mapZoom: number;\n  showTerrain?: boolean;\n  showAirspaces?: boolean;\n  showStateOverlay?: boolean;\n  showNotams?: boolean;\n  showTfrs?: boolean;\n  showPireps?: boolean;\n  onStateClick?: (stateInfo: any) => void;\n  baseLayer?: 'osm' | 'satellite' | 'terrain' | 'dark';\n  onViewStateInfo?: (stateCode: string) => void;\n  performanceMode?: boolean;\n}\n\n// Component to handle map move events and get map reference\nfunction MapEventHandler({ onBoundsChange, onMapReady }: { onBoundsChange: (bounds: any) => void; onMapReady?: (map: L.Map) => void }) {\n  const map = useMapEvents({\n    moveend: (e: any) => {\n      const bounds = e.target.getBounds();\n      onBoundsChange({\n        minLat: bounds.getSouth(),\n        maxLat: bounds.getNorth(),\n        minLon: bounds.getWest(),\n        maxLon: bounds.getEast()\n      });\n    }\n  });\n  \n  useEffect(() => {\n    if (onMapReady) {\n      onMapReady(map);\n    }\n  }, [map, onMapReady]);\n  \n  return null;\n}\n\nfunction getMarkerColor(type?: string) {\n  switch (type) {\n    case 'large_airport': return '#ef4444';\n    case 'medium_airport': return '#f59e0b';\n    case 'small_airport': return '#22c55e';\n    default: return '#6b7280';\n  }\n}\n\n// Simple state inference from coordinates\nfunction inferStateFromCoords(lat: number, lon: number): string | null {\n  if (lat >= 41.7 && lon >= -90.4 && lon <= -82.1) return 'MI';\n  if (lat >= 40.5 && lon >= -79.8 && lon <= -71.8) return 'NY';\n  if (lat >= 30.4 && lon >= -85.6 && lon <= -80.8) return 'GA';\n  if (lat >= 35 && lon >= -90.3 && lon <= -81.6) return 'TN';\n  if (lat >= 37 && lon >= -91.5 && lon <= -87) return 'IL';\n  if (lat >= 38 && lon >= -88.1 && lon <= -84.8) return 'IN';\n  if (lat >= 38.4 && lon >= -84.8 && lon <= -80.5) return 'OH';\n  if (lat >= 29 && lon >= -95 && lon <= -81) return 'FL';\n  if (lat >= 30 && lon >= -90 && lon <= -85) return 'MS';\n  if (lat >= 29 && lon >= -94.1 && lon <= -88.8) return 'LA';\n  if (lat >= 33 && lon >= -106.7 && lon <= -93.5) return 'TX';\n  if (lat >= 31.3 && lon >= -114.7 && lon <= -109) return 'AZ';\n  if (lat >= 32.5 && lon >= -124.4 && lon <= -114.6) return 'CA';\n  if (lat >= 45.5 && lon >= -124.8 && lon <= -116.9) return 'WA';\n  if (lat >= 42 && lon >= -124.6 && lon <= -116.5) return 'OR';\n  if (lat >= 43 && lon >= -117 && lon <= -111) return 'ID';\n  if (lat >= 37 && lon >= -109.1 && lon <= -102) return 'CO';\n  if (lat >= 35 && lon >= -120 && lon <= -114) return 'NV';\n  if (lat >= 37 && lon >= -114.1 && lon <= -109) return 'UT';\n  if (lat >= 41 && lon >= -111.1 && lon <= -104.1) return 'WY';\n  if (lat >= 44.4 && lon >= -116 && lon <= -104) return 'MT';\n  if (lat >= 45.9 && lon >= -104.1 && lon <= -96.6) return 'ND';\n  if (lat >= 42.5 && lon >= -104.1 && lon <= -96.4) return 'SD';\n  if (lat >= 38 && lon >= -104.1 && lon <= -94.3) return 'NE';\n  if (lat >= 37 && lon >= -102.1 && lon <= -94.6) return 'KS';\n  if (lat >= 33.6 && lon >= -103 && lon <= -94.4) return 'OK';\n  if (lat >= 33.8 && lon >= -84.3 && lon <= -75.4) return 'NC';\n  if (lat >= 32 && lon >= -83.4 && lon <= -78.5) return 'SC';\n  if (lat >= 36.5 && lon >= -83.7 && lon <= -75.2) return 'VA';\n  if (lat >= 36.5 && lon >= -89.6 && lon <= -81.9) return 'KY';\n  if (lat >= 37.2 && lon >= -82.6 && lon <= -77.7) return 'WV';\n  if (lat >= 39.7 && lon >= -80.5 && lon <= -74.7) return 'PA';\n  if (lat >= 41 && lon >= -73.7 && lon <= -71.8) return 'CT';\n  if (lat >= 41.2 && lon >= -73.5 && lon <= -69.9) return 'MA';\n  if (lat >= 42.7 && lon >= -72.6 && lon <= -70.7) return 'NH';\n  if (lat >= 43.1 && lon >= -71.1 && lon <= -66.9) return 'ME';\n  if (lat >= 42.7 && lon >= -73.5 && lon <= -71.5) return 'VT';\n  if (lat >= 38.9 && lon >= -75.6 && lon <= -73.9) return 'NJ';\n  if (lat >= 41.1 && lon >= -71.9 && lon <= -71.1) return 'RI';\n  if (lat >= 38.5 && lon >= -75.8 && lon <= -75) return 'DE';\n  if (lat >= 37.9 && lon >= -79.5 && lon <= -75) return 'MD';\n  if (lat >= 38.79 && lon >= -77.119 && lon <= -76.909) return 'DC';\n  if (lat >= 30.2 && lon >= -88.5 && lon <= -84.9) return 'AL';\n  if (lat >= 33 && lon >= -94.6 && lon <= -89.6) return 'AR';\n  if (lat >= 40.4 && lon >= -96.6 && lon <= -90.1) return 'IA';\n  if (lat >= 36 && lon >= -95.8 && lon <= -89.1) return 'MO';\n  if (lat >= 31.3 && lon >= -109.1 && lon <= -103) return 'NM';\n  if (lat >= 42.5 && lon >= -92.9 && lon <= -86.8) return 'WI';\n  if (lat >= 43.5 && lon >= -97.2 && lon <= -89.5) return 'MN';\n  if (lat >= 51.8 && lon >= -180 && lon <= -130) return 'AK';\n  if (lat >= 18.9 && lon >= -160.2 && lon <= -154.7) return 'HI';\n  return null;\n}\n\nfunction AirportPopup({ airport, onAddToRoute, onViewStateInfo }: { airport: Airport; onAddToRoute: () => void; onViewStateInfo?: (stateCode: string) => void }) {\n  const [details, setDetails] = useState<AirportDetails | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [refreshKey, setRefreshKey] = useState(0);\n\n  // Expose refresh function globally\n  useEffect(() => {\n    (window as any).refreshAirportDetails = (icao: string) => {\n      if (icao === airport.icao) {\n        setRefreshKey(k => k + 1);\n      }\n    };\n  }, [airport.icao]);\n\n  useEffect(() => {\n    async function fetchDetails() {\n      try {\n        const res = await fetch(`/api/airports/${airport.icao}`);\n        if (res.ok) {\n          const data = await res.json();\n          setDetails(data);\n        }\n      } catch (e) {\n        console.error('Error fetching airport details:', e);\n      }\n      setLoading(false);\n    }\n    fetchDetails();\n  }, [airport.icao, refreshKey]);\n\n  const handleViewStateInfo = () => {\n    if (onViewStateInfo) {\n      const stateCode = details?.state || inferStateFromCoords(airport.latitude, airport.longitude);\n      if (stateCode) {\n        onViewStateInfo(stateCode);\n      }\n    }\n  };\n\n  return (\n    <div className=\"min-w-[150px] max-w-[180px] text-slate-900 relative\">\n      {/* Close button */}\n      <button\n        onClick={(e) => { e.stopPropagation(); }}\n        className=\"absolute -top-1 -right-1 w-5 h-5 bg-slate-200 hover:bg-slate-300 rounded-full text-xs flex items-center justify-center\"\n        title=\"Close\"\n      >\n        Ã—\n      </button>\n      <strong className=\"text-lg\">{airport.icao}</strong>\n      {airport.iata && <span className=\"ml-2 text-slate-500\">({airport.iata})</span>}\n      <div className=\"font-medium\">{airport.name}</div>\n      {details?.city && (\n        <div className=\"text-sm text-slate-600\">\n          {details.city}{details.state && `, ${details.state}`}\n        </div>\n      )}\n      \n      {details && (\n        <>\n          {details.elevation_ft && (\n            <div className=\"text-sm mt-2\">\n              <span className=\"font-medium\">Elevation:</span> {details.elevation_ft} ft\n            </div>\n          )}\n          \n          {details.runways && details.runways.length > 0 && (\n            <div className=\"text-sm mt-1\">\n              <span className=\"font-medium\">Runways:</span>{' '}\n              {details.runways.slice(0, 2).map((r, i) => (\n                <span key={i} className=\"mr-2\">\n                  {r.he_ident} ({r.length_ft?.toLocaleString()}ft {r.surface})\n                </span>\n              ))}\n            </div>\n          )}\n          \n          {details.frequencies && details.frequencies.length > 0 && (\n            <div className=\"text-sm mt-2\">\n              <span className=\"font-medium\">Freqs:</span>\n              <div className=\"max-h-20 overflow-y-auto mt-1\">\n                {details.frequencies.slice(0, 5).map((f, i) => (\n                  <div key={i} className=\"text-xs\">\n                    {f.frequency_mhz.toFixed(3)} {f.type} - {f.description}\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n          \n          {details.fuel && (\n            <div className=\"mt-2\">\n              <div className=\"text-emerald-600 font-medium\">\n                100LL: ${details.fuel.price100ll.toFixed(2)}/gal\n                {details.fuel.priceJetA && (\n                  <span className=\"ml-2\">JetA: ${details.fuel.priceJetA.toFixed(2)}/gal</span>\n                )}\n              </div>\n              \n              {/* Community-reported price (shown alongside AirNav if available) */}\n              {(details.fuel.community100ll || details.fuel.communityJetA) && (\n                <div className=\"mt-1 space-y-1\">\n                  {details.fuel.community100ll && (\n                    <div className={`text-sm ${details.fuel.community100ll.daysAgo <= 30 ? 'text-green-600 font-medium' : 'text-slate-500'}`}>\n                      <span className=\"text-green-600\">â—</span> ${details.fuel.community100ll.price.toFixed(2)}/gal community\n                      <span className=\"text-xs text-slate-400 ml-1\">Â· {details.fuel.community100ll.daysAgo === 0 ? 'today' : `${details.fuel.community100ll.daysAgo}d ago`}</span>\n                      {details.fuel.community100ll.fbo && (\n                        <span className=\"text-xs text-slate-400\"> @ {details.fuel.community100ll.fbo}</span>\n                      )}\n                    </div>\n                  )}\n                  {details.fuel.communityJetA && (\n                    <div className={`text-sm ${details.fuel.communityJetA.daysAgo <= 30 ? 'text-green-600 font-medium' : 'text-slate-500'}`}>\n                      <span className=\"text-green-600\">â—</span> ${details.fuel.communityJetA.price.toFixed(2)}/gal JetA community\n                      <span className=\"text-xs text-slate-400 ml-1\">Â· {details.fuel.communityJetA.daysAgo === 0 ? 'today' : `${details.fuel.communityJetA.daysAgo}d ago`}</span>\n                    </div>\n                  )}\n                </div>\n              )}\n              \n              {/* Price divergence warning */}\n              {details.fuel.priceDivergence && (\n                <div className=\"mt-1 text-xs text-amber-600 bg-amber-50 px-2 py-1 rounded\">\n                  âš ï¸ Community price is {details.fuel.priceDivergence.difference}\n                </div>\n              )}\n              \n              {details.fuel.lastReported && (\n                <div className=\"text-xs text-slate-400\">\n                  AirNav: {details.fuel.lastReported}\n                </div>\n              )}\n              {/* AirNav Attribution */}\n              {details.fuel.source === 'airnav' && (\n                <a \n                  href={details.fuel.sourceUrl || 'https://www.airnav.com'} \n                  target=\"_blank\" \n                  rel=\"noopener noreferrer\"\n                  className=\"text-xs text-slate-500 hover:text-sky-500 block mt-1\"\n                >\n                  Source: AirNav.com\n                </a>\n              )}\n              {/* Tower & Landing Fee - Important Info */}\n              {(details.hasTower !== undefined || details.landingFee) && (\n                <div className=\"mt-2 flex gap-2 flex-wrap\">\n                  {details.hasTower !== undefined && (\n                    <span className={`text-xs px-2 py-1 rounded ${details.hasTower ? 'bg-green-500/20 text-green-400' : 'bg-red-500/20 text-red-400'}`}>\n                      {details.hasTower ? 'âœ“ Tower' : 'âœ— No Tower'}\n                    </span>\n                  )}\n                  {details.landingFee && (\n                    <span className=\"text-xs px-2 py-1 rounded bg-amber-500/20 text-amber-400\">\n                      Landing: ${details.landingFee.amount}\n                    </span>\n                  )}\n                </div>\n              )}\n              {/* More Details Dropdown */}\n              <details className=\"mt-2\">\n                <summary className=\"text-xs text-slate-500 cursor-pointer hover:text-sky-400\">\n                  More details\n                </summary>\n                <div className=\"mt-2 space-y-1 text-xs bg-slate-100 p-2 rounded\">\n                  {details.manager && (\n                    <div><span className=\"font-medium\">Manager:</span> {details.manager}</div>\n                  )}\n                  {/* Manager/Airport Phone */}\n                  {details.phone && (\n                    <div>\n                      <span className=\"font-medium\">Airport Phone:</span>{' '}\n                      <a href={`tel:${details.phone}`} className=\"text-sky-600 hover:underline\">{details.phone}</a>\n                    </div>\n                  )}\n                  {/* Fuel Provider Info */}\n                  {details.fuel?.providerName && (\n                    <div>\n                      <span className=\"font-medium\">Fuel Provider:</span> {details.fuel.providerName}\n                      {details.fuel.providerPhone && (\n                        <span className=\"ml-1\">\n                          (<a href={`tel:${details.fuel.providerPhone}`} className=\"text-sky-600 hover:underline\">{details.fuel.providerPhone}</a>)\n                        </span>\n                      )}\n                    </div>\n                  )}\n                  {details.attendance && (\n                    <div><span className=\"font-medium\">Attendance:</span> {details.attendance}</div>\n                  )}\n                  <a \n                    href={`https://www.airnav.com/airport/${airport.icao}`}\n                    target=\"_blank\" \n                    rel=\"noopener noreferrer\"\n                    className=\"text-sky-500 hover:underline block mt-2\"\n                  >\n                    View full details on AirNav â†’\n                  </a>\n                </div>\n              </details>\n              {/* Submit price button */}\n              <details className=\"mt-2\">\n                <summary className=\"text-xs text-sky-500 cursor-pointer hover:text-sky-400\">\n                  Paid a different price? Submit it\n                </summary>\n                <form \n                  onSubmit={async (e) => {\n                    e.preventDefault();\n                    const form = e.target as HTMLFormElement;\n                    const price = parseFloat((form.elements.namedItem('price') as HTMLInputElement).value);\n                    const fuelType = (form.elements.namedItem('fuelType') as HTMLSelectElement).value;\n                    const fbo = (form.elements.namedItem('fbo') as HTMLInputElement).value;\n                    const purchaseDate = (form.elements.namedItem('purchaseDate') as HTMLInputElement).value;\n                    \n                    if (price > 0 && purchaseDate) {\n                      try {\n                        const res = await fetch('/api/fuel-prices/community', {\n                          method: 'POST',\n                          headers: { 'Content-Type': 'application/json' },\n                          body: JSON.stringify({\n                            icao: details.icao,\n                            price,\n                            fuelType,\n                            fbo: fbo || null,\n                            purchaseDate\n                          })\n                        });\n                        if (res.ok) {\n                          alert('Thanks! Price submitted. Other pilots will see your community price.');\n                          // Refresh the airport details\n                          (window as any).refreshAirportDetails?.(details.icao);\n                        } else {\n                          const err = await res.json();\n                          alert(err.error || 'Failed to submit price');\n                        }\n                      } catch (err) {\n                        console.error('Error submitting price:', err);\n                        alert('Failed to submit price. Please try again.');\n                      }\n                    }\n                  }}\n                  className=\"mt-2 p-2 bg-slate-700 rounded\"\n                >\n                  <div className=\"text-xs mb-2 text-slate-300\">Submit your actual price (per gallon)</div>\n                  <div className=\"space-y-2\">\n                    <div className=\"flex gap-2\">\n                      <select \n                        name=\"fuelType\" \n                        className=\"bg-slate-600 text-white text-xs px-2 py-1 rounded\"\n                      >\n                        <option value=\"100LL\">100LL</option>\n                        <option value=\"JetA\">Jet A</option>\n                      </select>\n                      <input \n                        type=\"number\" \n                        name=\"price\" \n                        step=\"0.01\" \n                        min=\"0\" \n                        max=\"20\"\n                        placeholder=\"$0.00\"\n                        className=\"bg-slate-600 text-white text-xs px-2 py-1 rounded w-20\"\n                        required\n                      />\n                    </div>\n                    <div className=\"flex gap-2\">\n                      <input \n                        type=\"text\" \n                        name=\"fbo\" \n                        placeholder=\"FBO name (optional)\"\n                        className=\"bg-slate-600 text-white text-xs px-2 py-1 rounded flex-1\"\n                      />\n                      <input \n                        type=\"date\" \n                        name=\"purchaseDate\" \n                        max={new Date().toISOString().split('T')[0]}\n                        className=\"bg-slate-600 text-white text-xs px-2 py-1 rounded w-28\"\n                        required\n                      />\n                    </div>\n                    <button \n                      type=\"submit\"\n                      className=\"w-full bg-sky-500 hover:bg-sky-600 text-white text-xs px-2 py-2 rounded\"\n                    >\n                      Submit Price\n                    </button>\n                  </div>\n                  <div className=\"text-xs text-slate-400 mt-1\">\n                    Help other pilots know real prices!\n                  </div>\n                </form>\n              </details>\n            </div>\n          )}\n          \n          {details.landingFee && (\n            <div className=\"text-sm text-amber-600\">\n              Landing: ${details.landingFee.amount.toFixed(2)}\n            </div>\n          )}\n        </>\n      )}\n      \n      {loading && <div className=\"text-sm text-slate-400 mt-2\">Loading details...</div>}\n      \n      <button\n        onClick={onAddToRoute}\n        className=\"mt-3 w-full bg-sky-500 hover:bg-sky-600 text-white px-3 py-2 rounded text-sm font-medium\"\n      >\n        Add to Route\n      </button>\n      \n      {/* View State Info button - always show */}\n      <button\n        onClick={() => {\n          // Use state from details or infer from coordinates\n          let stateCode: string | undefined = details?.state;\n          if (!stateCode) {\n            stateCode = inferStateFromCoords(airport.latitude, airport.longitude) ?? undefined;\n          }\n          if (stateCode && onViewStateInfo) {\n            onViewStateInfo(stateCode);\n          }\n        }}\n        className=\"mt-2 w-full bg-purple-500 hover:bg-purple-600 text-white px-3 py-2 rounded text-sm font-medium\"\n      >\n        View State Info\n      </button>\n    </div>\n  );\n}\n\nexport default function LeafletMap({ \n  airports, \n  waypoints, \n  fuelPrices, \n  onBoundsChange, \n  onAirportClick, \n  mapCenter, \n  mapZoom,\n  showTerrain = false,\n  showAirspaces = false,\n  showStateOverlay = false,\n  showNotams = false,\n  showTfrs = false,\n  showPireps = false,\n  onStateClick,\n  baseLayer = 'osm',\n  onViewStateInfo,\n  performanceMode = false\n}: LeafletMapProps) {\n  const [terrainLayer, setTerrainLayer] = useState<L.TileLayer | null>(null);\n  const [tfrs, setTfrs] = useState<any[]>([]);\n  const [pireps, setPireps] = useState<any[]>([]);\n  const [notams, setNotams] = useState<any[]>([]);\n  const mapRef = useRef<L.Map | null>(null);\n  const [currentZoom, setCurrentZoom] = useState(mapZoom);\n  const boundsRef = useRef<{ minLat: number; maxLat: number; minLon: number; maxLon: number } | null>(null);\n  const fetchTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const isFetchingRef = useRef(false);\n  const lastFailedRef = useRef<{ tfrs?: number; pireps?: number }>({});\n  \n  // Base layer URLs\n  const baseLayers = {\n    osm: { url: 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', attribution: '&copy; OpenStreetMap' },\n    satellite: { url: 'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', attribution: '&copy; Esri' },\n    terrain: { url: 'https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', attribution: '&copy; OpenTopoMap' },\n    dark: { url: 'https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', attribution: '&copy; CartoDB' }\n  };\n  \n  // Filter out seaplanes automatically\n  const filteredAirports = useMemo(() => {\n    return airports.filter(a => a.type !== 'seaplane_base');\n  }, [airports]);\n  \n  // Calculate marker size based on zoom - smaller airports stay small when zoomed out\n  const getMarkerRadius = (type?: string) => {\n    const zoomScale = Math.max(1, (currentZoom - 4) * 0.5);\n    if (type === 'large_airport') {\n      return 6 + zoomScale;\n    } else if (type === 'medium_airport') {\n      // Medium airports: smaller when zoomed out, larger when zoomed in\n      return currentZoom < 7 ? 3 : 3 + (zoomScale * 0.7);\n    } else {\n      // Small airports: stay small when zoomed out, only grow when very zoomed in\n      return currentZoom < 8 ? 1.5 : 1.5 + ((currentZoom - 7) * 0.8);\n    }\n  };\n  \n  // Update zoom level and respond to center/zoom changes from parent\n  useEffect(() => {\n    if (!mapRef.current) return;\n    \n    const handleZoom = () => setCurrentZoom(mapRef.current!.getZoom());\n    mapRef.current.on('zoomend', handleZoom);\n    \n    // Watch for center/zoom prop changes and update map view\n    const handleMoveEnd = () => {\n      const map = mapRef.current;\n      if (!map) return;\n      const newCenter = map.getCenter();\n      const newZoom = map.getZoom();\n      // Only update if significantly different to avoid loops\n      if (Math.abs(newCenter.lat - mapCenter[0]) > 0.001 || \n          Math.abs(newCenter.lng - mapCenter[1]) > 0.001 ||\n          newZoom !== mapZoom) {\n        map.setView(mapCenter as [number, number], mapZoom, { animate: true });\n      }\n    };\n    \n    // Apply the center/zoom from props\n    mapRef.current.setView(mapCenter as [number, number], mapZoom, { animate: true });\n    \n    return () => {\n      mapRef.current?.off('zoomend', handleZoom);\n    };\n  }, [mapCenter, mapZoom]);\n  \n  // Toggle terrain layer based on setting\n  useEffect(() => {\n    if (typeof window === 'undefined') return;\n    \n    // Import Leaflet dynamically\n    import('leaflet').then((L) => {\n      if (showTerrain && !terrainLayer) {\n        // Add OpenTopoMap terrain layer\n        const terrain = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {\n          attribution: 'Map data: &copy; <a href=\"https://opentopomap.org\">OpenTopoMap</a>',\n          maxZoom: 17,\n        });\n        terrain.addTo(mapRef.current!);\n        setTerrainLayer(terrain);\n      } else if (!showTerrain && terrainLayer) {\n        // Remove terrain layer\n        terrainLayer.remove();\n        setTerrainLayer(null);\n      }\n    });\n  }, [showTerrain, terrainLayer]);\n  \n  // Track bounds changes and update ref\n  const handleBoundsChange = useCallback((bounds: { minLat: number; maxLat: number; minLon: number; maxLon: number }) => {\n    boundsRef.current = bounds;\n    onBoundsChange(bounds);\n    \n    // Debounce TFR/PIREP fetches - wait 500ms after map stops moving\n    if (fetchTimeoutRef.current) {\n      clearTimeout(fetchTimeoutRef.current);\n    }\n    \n    fetchTimeoutRef.current = setTimeout(() => {\n      // Don't fetch if already fetching or recently failed\n      if (isFetchingRef.current) return;\n      const now = Date.now();\n      if (lastFailedRef.current.tfrs && now - lastFailedRef.current.tfrs < 30000) return;\n      if (lastFailedRef.current.pireps && now - lastFailedRef.current.pireps < 30000) return;\n      \n      if (showTfrs && boundsRef.current && !lastFailedRef.current.tfrs) {\n        isFetchingRef.current = true;\n        const boundsParam = `${bounds.minLat},${bounds.maxLat},${bounds.minLon},${bounds.maxLon}`;\n        fetch(`/api/tfrs?bounds=${boundsParam}`)\n          .then(res => {\n            if (!res.ok) throw new Error('API unavailable');\n            return res.json();\n          })\n          .then(data => setTfrs(data.tfrs || []))\n          .catch(() => { lastFailedRef.current.tfrs = Date.now(); })\n          .finally(() => { isFetchingRef.current = false; });\n      }\n      if (showPireps && boundsRef.current && !lastFailedRef.current.pireps) {\n        isFetchingRef.current = true;\n        const boundsParam = `${bounds.minLat},${bounds.maxLat},${bounds.minLon},${bounds.maxLon}`;\n        fetch(`/api/pireps?bounds=${boundsParam}`)\n          .then(res => {\n            if (!res.ok) throw new Error('API unavailable');\n            return res.json();\n          })\n          .then(data => setPireps(data.pireps || []))\n          .catch(() => { lastFailedRef.current.pireps = Date.now(); })\n          .finally(() => { isFetchingRef.current = false; });\n      }\n    }, 500);\n  }, [onBoundsChange, showTfrs, showPireps]);\n\n  // Initial fetch when toggled ON\n  useEffect(() => {\n    if (!showTfrs) return;\n    if (!boundsRef.current) return;\n    \n    const bounds = boundsRef.current;\n    const boundsParam = `${bounds.minLat},${bounds.maxLat},${bounds.minLon},${bounds.maxLon}`;\n    \n    fetch(`/api/tfrs?bounds=${boundsParam}`)\n      .then(res => res.json())\n      .then(data => setTfrs(data.tfrs || []))\n      .catch(console.error);\n  }, [showTfrs]);\n\n  // Initial fetch when toggled ON  \n  useEffect(() => {\n    if (!showPireps) return;\n    if (!boundsRef.current) return;\n    \n    const bounds = boundsRef.current;\n    const boundsParam = `${bounds.minLat},${bounds.maxLat},${bounds.minLon},${bounds.maxLon}`;\n    \n    fetch(`/api/pireps?bounds=${boundsParam}`)\n      .then(res => res.json())\n      .then(data => setPireps(data.pireps || []))\n      .catch(console.error);\n  }, [showPireps]);\n \n  return (\n    <MapContainer\n      center={mapCenter}\n      zoom={mapZoom}\n      style={{ height: '100%', width: '100%', zIndex: 0 }}\n    >\n      <TileLayer\n        attribution={baseLayers[baseLayer].attribution}\n        url={baseLayers[baseLayer].url}\n      />\n      \n      <MapEventHandler onBoundsChange={handleBoundsChange} onMapReady={(map) => { mapRef.current = map; }} />\n      \n      {/* Airport markers - filtered and zoom-based sizing */}\n      {filteredAirports.map(airport => (\n        <CircleMarker\n          key={airport.icao}\n          center={[airport.latitude, airport.longitude]}\n          radius={getMarkerRadius(airport.type)}\n          pathOptions={{\n            color: getMarkerColor(airport.type),\n            fillColor: getMarkerColor(airport.type),\n            fillOpacity: 0.7,\n            weight: 1\n          }}\n        >\n          <Popup>\n            <AirportPopup airport={airport} onAddToRoute={() => onAirportClick(airport)} onViewStateInfo={onViewStateInfo} />\n          </Popup>\n        </CircleMarker>\n      ))}\n      \n      {/* Route line */}\n      {waypoints.length > 1 && (\n        <Polyline\n          positions={waypoints.map(w => [w.latitude, w.longitude])}\n          pathOptions={{ color: '#38bdf8', weight: 3, dashArray: '10, 5' }}\n        />\n      )}\n      \n      {/* TFR markers */}\n      {showTfrs && tfrs.map(tfr => (\n        <CircleMarker\n          key={tfr.id}\n          center={[tfr.latitude, tfr.longitude]}\n          radius={8}\n          pathOptions={{\n            color: '#ef4444',\n            fillColor: '#ef4444',\n            fillOpacity: 0.4,\n            weight: 2,\n            dashArray: '5, 5'\n          }}\n        >\n          <Popup>\n            <div className=\"text-slate-900 min-w-[150px]\">\n              <strong className=\"text-red-600\">ðŸ”´ TFR</strong>\n              <div className=\"font-medium\">{tfr.title}</div>\n              <div className=\"text-sm\">{tfr.description}</div>\n              <div className=\"text-xs text-slate-500 mt-1\">\n                {tfr.type} - {tfr.facility}\n              </div>\n              <div className=\"text-xs text-slate-500\">\n                Alt: {tfr.lowerAltitude} to {tfr.upperAltitude}\n              </div>\n              <div className=\"text-xs text-slate-500\">\n                Radius: {tfr.radius} NM\n              </div>\n            </div>\n          </Popup>\n        </CircleMarker>\n      ))}\n      \n      {/* PIREP markers */}\n      {showPireps && pireps.map(pirep => (\n        <CircleMarker\n          key={pirep.id}\n          center={[pirep.latitude, pirep.longitude]}\n          radius={6}\n          pathOptions={{\n            color: pirep.turbulence !== 'NIL' ? '#f59e0b' : pirep.icing !== 'NIL' ? '#8b5cf6' : '#22c55e',\n            fillColor: pirep.turbulence !== 'NIL' ? '#f59e0b' : pirep.icing !== 'NIL' ? '#8b5cf6' : '#22c55e',\n            fillOpacity: 0.7,\n            weight: 2\n          }}\n        >\n          <Popup>\n            <div className=\"text-slate-900 min-w-[150px]\">\n              <strong className=\"text-purple-600\">ðŸ›©ï¸ PIREP</strong>\n              <div className=\"text-sm font-medium\">{pirep.aircraft} FL{pirep.flightLevel}</div>\n              {pirep.turbulence !== 'NIL' && (\n                <div className=\"text-amber-600\">Turbulence: {pirep.turbulence}</div>\n              )}\n              {pirep.icing !== 'NIL' && (\n                <div className=\"text-purple-600\">Icing: {pirep.icing}</div>\n              )}\n              <div className=\"text-xs text-slate-500 mt-1\">\n                {pirep.windDirection}Â° @ {pirep.windSpeed} kts\n              </div>\n              <div className=\"text-xs text-slate-500\">\n                Temp: {pirep.temperature}Â°C\n              </div>\n            </div>\n          </Popup>\n        </CircleMarker>\n      ))}\n      \n      {/* Waypoint markers */}\n      {waypoints.map((wp, i) => (\n        <CircleMarker\n          key={wp.id}\n          center={[wp.latitude, wp.longitude]}\n          radius={8}\n          pathOptions={{\n            color: i === 0 ? '#22c55e' : i === waypoints.length - 1 ? '#ef4444' : '#f59e0b',\n            fillColor: i === 0 ? '#22c55e' : i === waypoints.length - 1 ? '#ef4444' : '#f59e0b',\n            fillOpacity: 1,\n            weight: 2\n          }}\n        >\n          <Popup>\n            <div className=\"text-slate-900\">\n              <strong>{wp.icao}</strong>\n              <br />\n              {wp.name}\n              <br />\n              <span className=\"text-sm\">Position: {i + 1} of {waypoints.length}</span>\n              <br />\n              {fuelPrices[wp.icao] && (\n                <span className=\"text-emerald-600 font-medium\">\n                  ${fuelPrices[wp.icao].price100ll}/gal\n                </span>\n              )}\n            </div>\n          </Popup>\n        </CircleMarker>\n      ))}\n    </MapContainer>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\fuel-saver\\MapControls.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useEffect' is defined but never used.","line":3,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":29,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"useEffect"},"fix":{"range":[34,45],"text":""},"desc":"Remove unused variable \"useEffect\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'LayersControl' is defined but never used.","line":4,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":23,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"LayersControl"},"fix":{"range":[72,86],"text":""},"desc":"Remove unused variable \"LayersControl\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useMap' is defined but never used.","line":4,"column":36,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":42,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"useMap"},"fix":{"range":[96,104],"text":""},"desc":"Remove unused variable \"useMap\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { LayersControl, TileLayer, useMap } from 'react-leaflet';\r\nimport 'leaflet/dist/leaflet.css';\r\n\r\nexport interface MapLayerOptions {\n  baseLayer: 'osm' | 'satellite' | 'terrain' | 'dark';\n  showLarge: boolean;\n  showMedium: boolean;\n  showSmall: boolean;\n  showSeaplane: boolean;\n  showTerrain: boolean;\n  showAirspaces: boolean;\n  showFuelPrices: boolean;\n  showStatePrices: boolean;\n  showTfrs: boolean;\n  showPireps: boolean;\n  performanceMode: boolean;\n}\n\r\ninterface MapControlsProps {\n  options: MapLayerOptions;\n  onOptionsChange: (options: MapLayerOptions) => void;\n}\n\r\n// Layer configuration\r\nconst LAYERS = {\r\n  osm: {\r\n    name: 'OSM',\r\n    url: 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',\r\n    attribution: '&copy; OpenStreetMap contributors'\r\n  },\r\n  satellite: {\r\n    name: 'Sat',\r\n    url: 'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',\r\n    attribution: '&copy; Esri'\r\n  },\r\n  terrain: {\r\n    name: 'Terrain',\r\n    url: 'https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png',\r\n    attribution: '&copy; OpenTopoMap'\r\n  },\r\n  dark: {\r\n    name: 'Dark',\r\n    url: 'https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png',\r\n    attribution: '&copy; CartoDB'\r\n  }\r\n};\r\n\r\nexport function MapControls({ options, onOptionsChange }: MapControlsProps) {\n  const [isCollapsed, setIsCollapsed] = useState(true);\n\r\n  const toggleOption = (key: keyof MapLayerOptions) => {\r\n    if (key === 'baseLayer') return;\r\n    onOptionsChange({\r\n      ...options,\r\n      [key]: !options[key as keyof MapLayerOptions]\r\n    });\r\n  };\r\n\r\n  const setBaseLayer = (layer: MapLayerOptions['baseLayer']) => {\r\n    onOptionsChange({ ...options, baseLayer: layer });\r\n  };\r\n\r\n  return (\r\n    <div className={`absolute bottom-4 right-4 z-[1000] transition-all`}>\r\n      {/* Toggle Button */}\r\n      <button\r\n        onClick={() => setIsCollapsed(!isCollapsed)}\r\n        className=\"bg-slate-800/95 hover:bg-slate-700 text-white p-2 rounded-lg shadow-xl border border-slate-700 mb-2\"\r\n        title={isCollapsed ? 'Show Map Controls' : 'Hide Map Controls'}\r\n      >\r\n        {isCollapsed ? 'â˜°' : 'âœ•'}\r\n      </button>\r\n\r\n      {!isCollapsed && (\r\n        <div className=\"bg-slate-800/95 backdrop-blur rounded-lg shadow-xl border border-slate-700 w-48 max-h-[60vh] overflow-y-auto\">\r\n          {/* Layer Selector */}\r\n          <div className=\"p-3 border-b border-slate-700\">\r\n            <div className=\"text-xs font-medium text-slate-400 mb-2 uppercase tracking-wide\">Map Layer</div>\r\n            <div className=\"grid grid-cols-2 gap-1\">\r\n              {(Object.keys(LAYERS) as MapLayerOptions['baseLayer'][]).map((layer) => (\r\n                <button\r\n                  key={layer}\r\n                  onClick={() => setBaseLayer(layer)}\r\n                  className={`px-2 py-1.5 text-xs rounded transition-colors ${\r\n                    options.baseLayer === layer\r\n                      ? 'bg-sky-500 text-white'\r\n                      : 'bg-slate-700 text-slate-300 hover:bg-slate-600'\r\n                  }`}\r\n                >\r\n                  {LAYERS[layer].name}\r\n                </button>\r\n              ))}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Airport Filters */}\r\n          <div className=\"p-3 border-b border-slate-700\">\r\n            <div className=\"text-xs font-medium text-slate-400 mb-2 uppercase tracking-wide\">Airports</div>\r\n            <div className=\"space-y-1.5\">\r\n              <label className=\"flex items-center gap-2 cursor-pointer\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  checked={options.showLarge}\r\n                  onChange={() => toggleOption('showLarge')}\r\n                  className=\"w-4 h-4 rounded bg-slate-700 border-slate-600 text-sky-500\"\r\n                />\r\n                <span className=\"text-sm\">\r\n                  <span className=\"inline-block w-2 h-2 rounded-full bg-red-500 mr-1\"></span>\r\n                  Large\r\n                </span>\r\n              </label>\r\n              <label className=\"flex items-center gap-2 cursor-pointer\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  checked={options.showMedium}\r\n                  onChange={() => toggleOption('showMedium')}\r\n                  className=\"w-4 h-4 rounded bg-slate-700 border-slate-600 text-sky-500\"\r\n                />\r\n                <span className=\"text-sm\">\r\n                  <span className=\"inline-block w-2 h-2 rounded-full bg-amber-500 mr-1\"></span>\r\n                  Medium\r\n                </span>\r\n              </label>\r\n              <label className=\"flex items-center gap-2 cursor-pointer\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  checked={options.showSmall}\r\n                  onChange={() => toggleOption('showSmall')}\r\n                  className=\"w-4 h-4 rounded bg-slate-700 border-slate-600 text-sky-500\"\r\n                />\r\n                <span className=\"text-sm\">\r\n                  <span className=\"inline-block w-2 h-2 rounded-full bg-green-500 mr-1\"></span>\r\n                  Small\r\n                </span>\r\n              </label>\r\n              <label className=\"flex items-center gap-2 cursor-pointer\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  checked={options.showSeaplane}\r\n                  onChange={() => toggleOption('showSeaplane')}\r\n                  className=\"w-4 h-4 rounded bg-slate-700 border-slate-600 text-sky-500\"\r\n                />\r\n                <span className=\"text-sm\">\r\n                  <span className=\"inline-block w-2 h-2 rounded-full bg-blue-500 mr-1\"></span>\r\n                  Seaplane\r\n                </span>\r\n              </label>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Overlays */}\r\n          <div className=\"p-3\">\r\n            <div className=\"text-xs font-medium text-slate-400 mb-2 uppercase tracking-wide\">Overlays</div>\r\n            <div className=\"space-y-1.5\">\r\n              <label className=\"flex items-center gap-2 cursor-pointer\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  checked={options.showFuelPrices}\r\n                  onChange={() => toggleOption('showFuelPrices')}\r\n                  className=\"w-4 h-4 rounded bg-slate-700 border-slate-600 text-sky-500\"\r\n                />\r\n                <span className=\"text-sm\">ðŸ’° Fuel Prices</span>\r\n              </label>\r\n              <label className=\"flex items-center gap-2 cursor-pointer\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  checked={options.showStatePrices}\r\n                  onChange={() => toggleOption('showStatePrices')}\r\n                  className=\"w-4 h-4 rounded bg-slate-700 border-slate-600 text-sky-500\"\r\n                />\r\n                <span className=\"text-sm\">ðŸ—ºï¸ State Prices</span>\r\n              </label>\r\n              <label className=\"flex items-center gap-2 cursor-pointer\">\n                <input\n                  type=\"checkbox\"\n                  checked={options.showTerrain}\n                  onChange={() => toggleOption('showTerrain')}\n                  className=\"w-4 h-4 rounded bg-slate-700 border-slate-600 text-sky-500\"\n                />\n                <span className=\"text-sm\">ðŸ”ï¸ Terrain</span>\n              </label>\n              <label className=\"flex items-center gap-2 cursor-pointer\">\n                <input\n                  type=\"checkbox\"\n                  checked={options.showTfrs}\n                  onChange={() => toggleOption('showTfrs')}\n                  className=\"w-4 h-4 rounded bg-slate-700 border-slate-600 text-red-500\"\n                />\n                <span className=\"text-sm\">ðŸ”´ TFRs</span>\n              </label>\n              <label className=\"flex items-center gap-2 cursor-pointer\">\n                <input\n                  type=\"checkbox\"\n                  checked={options.showPireps}\n                  onChange={() => toggleOption('showPireps')}\n                  className=\"w-4 h-4 rounded bg-slate-700 border-slate-600 text-purple-500\"\n                />\n                <span className=\"text-sm\">ðŸ›©ï¸ PIREPs</span>\n              </label>\n              <label className=\"flex items-center gap-2 cursor-pointer\">\n                <input\n                  type=\"checkbox\"\n                  checked={options.performanceMode}\n                  onChange={() => toggleOption('performanceMode')}\n                  className=\"w-4 h-4 rounded bg-slate-700 border-slate-600 text-green-500\"\n                />\n                <span className=\"text-sm\">âš¡ Performance Mode</span>\n              </label>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\r\n// Default options\nexport const DEFAULT_MAP_OPTIONS: MapLayerOptions = {\n  baseLayer: 'osm',\n  showLarge: true,\n  showMedium: true,\n  showSmall: true,\n  showSeaplane: false,\n  showTerrain: false,\n  showAirspaces: false,\n  showFuelPrices: true,\n  showStatePrices: true,\n  showTfrs: true,\n  showPireps: true,\n  performanceMode: false\n};\n\r\n// Tile layer component for the map\r\nexport function MapTileLayer({ baseLayer }: { baseLayer: MapLayerOptions['baseLayer'] }) {\r\n  const layer = LAYERS[baseLayer];\r\n  return (\r\n    <TileLayer\r\n      key={baseLayer}\r\n      url={layer.url}\r\n      attribution={layer.attribution}\r\n    />\r\n  );\r\n}\r\n\r\nexport { LAYERS };\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\fuel-saver\\PerformanceSettings.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\David\\next-dashboard\\app\\fuel-saver\\PerformanceSettings.tsx:40:11\n  38 |         try {\n  39 |           const parsed = JSON.parse(saved);\n> 40 |           setSettings(parsed);\n     |           ^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  41 |           onSettingsChange?.(parsed);\n  42 |         } catch (e) {\n  43 |           console.error('Error loading settings:', e);","line":40,"column":11,"nodeType":null,"endLine":40,"endColumn":22},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'onSettingsChange'. Either include it or remove the dependency array. If 'onSettingsChange' changes too often, find the parent component that defines it and wrap that definition in useCallback.","line":47,"column":6,"nodeType":"ArrayExpression","endLine":47,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [onSettingsChange]","fix":{"range":[1247,1249],"text":"[onSettingsChange]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect } from 'react';\n\ninterface PerformanceSettings {\n  threeDMode: boolean;\n  weatherPlayback: boolean;\n  animations: boolean;\n  liveWeather: boolean;\n  autoWeatherZoom: boolean;\n  showAirspaces: boolean;\n  showTerrain: boolean;\n}\n\ninterface PerformanceSettingsPanelProps {\n  onSettingsChange?: (settings: PerformanceSettings) => void;\n}\n\nconst DEFAULT_SETTINGS: PerformanceSettings = {\n  threeDMode: true,\n  weatherPlayback: true,\n  animations: true,\n  liveWeather: true,\n  autoWeatherZoom: true,\n  showAirspaces: false,\n  showTerrain: false,\n};\n\nexport default function PerformanceSettingsPanel({ onSettingsChange }: PerformanceSettingsPanelProps) {\n  const [settings, setSettings] = useState<PerformanceSettings>(DEFAULT_SETTINGS);\n  const [isOpen, setIsOpen] = useState(false);\n\n  // Load settings from localStorage on mount\n  useEffect(() => {\n    if (typeof window !== 'undefined') {\n      const saved = localStorage.getItem('performanceSettings');\n      if (saved) {\n        try {\n          const parsed = JSON.parse(saved);\n          setSettings(parsed);\n          onSettingsChange?.(parsed);\n        } catch (e) {\n          console.error('Error loading settings:', e);\n        }\n      }\n    }\n  }, []);\n\n  // Save settings when they change\n  const updateSettings = (newSettings: Partial<PerformanceSettings>) => {\n    const updated = { ...settings, ...newSettings };\n    setSettings(updated);\n    if (typeof window !== 'undefined') {\n      localStorage.setItem('performanceSettings', JSON.stringify(updated));\n    }\n    onSettingsChange?.(updated);\n  };\n\n  return (\n    <>\n      {/* Toggle Button */}\n      <button\n        onClick={() => setIsOpen(!isOpen)}\n        className=\"fixed bottom-4 right-4 z-[1001] bg-slate-800 hover:bg-slate-700 text-white p-3 rounded-full shadow-lg border border-slate-600\"\n        title=\"Performance Settings\"\n      >\n        âš™ï¸\n      </button>\n\n      {/* Panel */}\n      {isOpen && (\n        <div className=\"fixed bottom-16 right-4 z-[1000] bg-slate-800 rounded-lg shadow-xl border border-slate-700 w-72 p-4\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <h3 className=\"font-semibold text-white\">Performance</h3>\n            <button\n              onClick={() => setIsOpen(false)}\n              className=\"text-slate-400 hover:text-white\"\n            >\n              âœ•\n            </button>\n          </div>\n\n          <p className=\"text-xs text-slate-400 mb-4\">\n            Toggle features to improve performance on slower devices.\n          </p>\n\n          <div className=\"space-y-3\">\n            {/* 3D Mode */}\n            <label className=\"flex items-center justify-between cursor-pointer\">\n              <span className=\"text-sm text-slate-300\">3D Map Mode</span>\n              <input\n                type=\"checkbox\"\n                checked={settings.threeDMode}\n                onChange={(e) => updateSettings({ threeDMode: e.target.checked })}\n                className=\"w-5 h-5 rounded bg-slate-700 border-slate-600 text-sky-500\"\n              />\n            </label>\n\n            {/* Weather Playback */}\n            <label className=\"flex items-center justify-between cursor-pointer\">\n              <span className=\"text-sm text-slate-300\">Weather Playback</span>\n              <input\n                type=\"checkbox\"\n                checked={settings.weatherPlayback}\n                onChange={(e) => updateSettings({ weatherPlayback: e.target.checked })}\n                className=\"w-5 h-5 rounded bg-slate-700 border-slate-600 text-sky-500\"\n              />\n            </label>\n\n            {/* Animations */}\n            <label className=\"flex items-center justify-between cursor-pointer\">\n              <span className=\"text-sm text-slate-300\">Smooth Animations</span>\n              <input\n                type=\"checkbox\"\n                checked={settings.animations}\n                onChange={(e) => updateSettings({ animations: e.target.checked })}\n                className=\"w-5 h-5 rounded bg-slate-700 border-slate-600 text-sky-500\"\n              />\n            </label>\n\n            {/* Live Weather */}\n            <label className=\"flex items-center justify-between cursor-pointer\">\n              <span className=\"text-sm text-slate-300\">Live Weather</span>\n              <input\n                type=\"checkbox\"\n                checked={settings.liveWeather}\n                onChange={(e) => updateSettings({ liveWeather: e.target.checked })}\n                className=\"w-5 h-5 rounded bg-slate-700 border-slate-600 text-sky-500\"\n              />\n            </label>\n\n            {/* Auto Weather Zoom */}\n            <label className=\"flex items-center justify-between cursor-pointer\">\n              <span className=\"text-sm text-slate-300\">Auto Weather Zoom</span>\n              <input\n                type=\"checkbox\"\n                checked={settings.autoWeatherZoom}\n                onChange={(e) => updateSettings({ autoWeatherZoom: e.target.checked })}\n                className=\"w-5 h-5 rounded bg-slate-700 border-slate-600 text-sky-500\"\n              />\n            </label>\n\n            {/* Show Airspaces */}\n            <label className=\"flex items-center justify-between cursor-pointer\">\n              <span className=\"text-sm text-slate-300\">Show Airspaces</span>\n              <input\n                type=\"checkbox\"\n                checked={settings.showAirspaces}\n                onChange={(e) => updateSettings({ showAirspaces: e.target.checked })}\n                className=\"w-5 h-5 rounded bg-slate-700 border-slate-600 text-sky-500\"\n              />\n            </label>\n\n            {/* Show Terrain */}\n            <label className=\"flex items-center justify-between cursor-pointer\">\n              <span className=\"text-sm text-slate-300\">Show Terrain</span>\n              <input\n                type=\"checkbox\"\n                checked={settings.showTerrain}\n                onChange={(e) => updateSettings({ showTerrain: e.target.checked })}\n                className=\"w-5 h-5 rounded bg-slate-700 border-slate-600 text-sky-500\"\n              />\n            </label>\n          </div>\n\n          {/* Reset Button */}\n          <button\n            onClick={() => updateSettings(DEFAULT_SETTINGS)}\n            className=\"mt-4 w-full bg-slate-700 hover:bg-slate-600 text-white py-2 rounded text-sm\"\n          >\n            Reset to Defaults\n          </button>\n        </div>\n      )}\n    </>\n  );\n}\n\nexport { DEFAULT_SETTINGS, type PerformanceSettings };\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\fuel-saver\\RangeRing.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'RangeRingProps' is defined but never used.","line":5,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setCenter' is assigned a value but never used.","line":75,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":75,"endColumn":27},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\David\\next-dashboard\\app\\fuel-saver\\RangeRing.tsx:80:5\n  78 |   useEffect(() => {\n  79 |     const result = calculateRange(fuelCapacity, burnRate, cruiseSpeed, currentFuel, unusableFuel);\n> 80 |     setRange(result);\n     |     ^^^^^^^^ Avoid calling setState() directly within an effect\n  81 |     onRangeChange(result, center);\n  82 |   }, [fuelCapacity, burnRate, cruiseSpeed, currentFuel, unusableFuel, center]);\n  83 |","line":80,"column":5,"nodeType":null,"endLine":80,"endColumn":13},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'onRangeChange'. Either include it or remove the dependency array. If 'onRangeChange' changes too often, find the parent component that defines it and wrap that definition in useCallback.","line":82,"column":6,"nodeType":"ArrayExpression","endLine":82,"endColumn":78,"suggestions":[{"desc":"Update the dependencies array to be: [fuelCapacity, burnRate, cruiseSpeed, currentFuel, unusableFuel, center, onRangeChange]","fix":{"range":[2414,2486],"text":"[fuelCapacity, burnRate, cruiseSpeed, currentFuel, unusableFuel, center, onRangeChange]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect } from 'react';\n\ninterface RangeRingProps {\n  center: [number, number];\n  aircraft?: {\n    fuelCapacity: number;\n    burnRate: number;\n    cruiseSpeed: number;\n    unusableFuel?: number;\n  };\n  currentFuel?: number; // percentage or gallons\n}\n\ninterface RangeRingResult {\n  maxRangeNm: number;\n  usableFuel: number;\n  reserveFuel: number;\n  withReserve: number;\n}\n\n/**\n * Calculate range ring parameters\n * Default: 45 min + 1 hour reserve = 1.75 hours\n */\nexport function calculateRange(\n  fuelCapacity: number,\n  burnRate: number,\n  cruiseSpeed: number,\n  currentFuelPercent: number = 100,\n  unusableFuel: number = 2\n): RangeRingResult {\n  const currentFuel = (fuelCapacity * currentFuelPercent / 100) - unusableFuel;\n  \n  // Reserve: 45 min + 1 hour = 1.75 hours\n  const reserveHours = 1.75;\n  const reserveFuel = burnRate * reserveHours;\n  \n  // Usable fuel after reserves\n  const usableFuel = Math.max(0, currentFuel - reserveFuel);\n  \n  // Range without reserve\n  const maxRangeNm = (usableFuel / burnRate) * cruiseSpeed;\n  \n  // Range with reserve (what you can actually use)\n  const withReserve = ((currentFuel - unusableFuel) / burnRate) * cruiseSpeed;\n  \n  return {\n    maxRangeNm: Math.round(maxRangeNm),\n    usableFuel: Math.round(usableFuel * 10) / 10,\n    reserveFuel: Math.round(reserveFuel * 10) / 10,\n    withReserve: Math.round(withReserve)\n  };\n}\n\n/**\n * Range Ring Calculator Component\n */\nexport function RangeRingCalculator({ \n  onRangeChange, \n  initialCenter \n}: { \n  onRangeChange: (range: RangeRingResult, center: [number, number]) => void;\n  initialCenter?: [number, number];\n}) {\n  const [fuelCapacity, setFuelCapacity] = useState(56); // gallons\n  const [burnRate, setBurnRate] = useState(9.5); // gph\n  const [cruiseSpeed, setCruiseSpeed] = useState(120); // kts\n  const [currentFuel, setCurrentFuel] = useState(100); // percentage\n  const [unusableFuel, setUnusableFuel] = useState(2); // gallons\n  const [range, setRange] = useState<RangeRingResult | null>(null);\n\n  // Use selected airport as center when available\n  const [center, setCenter] = useState<[number, number]>(initialCenter || [39.8283, -98.5795]);\n\n  // Calculate range whenever inputs change\n  useEffect(() => {\n    const result = calculateRange(fuelCapacity, burnRate, cruiseSpeed, currentFuel, unusableFuel);\n    setRange(result);\n    onRangeChange(result, center);\n  }, [fuelCapacity, burnRate, cruiseSpeed, currentFuel, unusableFuel, center]);\n\n  return (\n    <div className=\"bg-slate-800 rounded-lg p-4 space-y-4\">\n      <h3 className=\"font-semibold text-white flex items-center gap-2\">\n        <span>â›½</span> Range Calculator\n      </h3>\n      \n      {/* Quick Aircraft Select */}\n      <div>\n        <label className=\"block text-xs text-slate-400 mb-1\">Quick Select</label>\n        <select\n          onChange={(e) => {\n            const presets: Record<string, { fuel: number; burn: number; speed: number }> = {\n              '172s': { fuel: 56, burn: 9.5, speed: 122 },\n              '182t': { fuel: 87, burn: 13.5, speed: 150 },\n              'pa28': { fuel: 48, burn: 8.5, speed: 120 },\n              'sr22': { fuel: 92, burn: 12.5, speed: 180 },\n              'bonanza': { fuel: 102, burn: 14, speed: 155 }\n            };\n            const preset = presets[e.target.value];\n            if (preset) {\n              setFuelCapacity(preset.fuel);\n              setBurnRate(preset.burn);\n              setCruiseSpeed(preset.speed);\n            }\n          }}\n          className=\"w-full bg-slate-700 border border-slate-600 rounded px-3 py-2 text-white text-sm\"\n        >\n          <option value=\"\">Custom</option>\n          <option value=\"172s\">Cessna 172S</option>\n          <option value=\"182t\">Cessna 182T</option>\n          <option value=\"pa28\">Piper Archer</option>\n          <option value=\"sr22\">Cirrus SR22</option>\n          <option value=\"bonanza\">Beechcraft Bonanza</option>\n        </select>\n      </div>\n\n      {/* Manual Inputs */}\n      <div className=\"grid grid-cols-2 gap-3\">\n        <div>\n          <label className=\"block text-xs text-slate-400 mb-1\">Fuel (gal)</label>\n          <input\n            type=\"number\"\n            value={fuelCapacity}\n            onChange={(e) => setFuelCapacity(Number(e.target.value))}\n            min=\"1\"\n            max=\"500\"\n            className=\"w-full bg-slate-700 border border-slate-600 rounded px-3 py-2 text-white text-sm\"\n          />\n        </div>\n        <div>\n          <label className=\"block text-xs text-slate-400 mb-1\">Fuel on Board</label>\n          <div className=\"flex items-center gap-2\">\n            <input\n              type=\"range\"\n              value={currentFuel}\n              onChange={(e) => setCurrentFuel(Number(e.target.value))}\n              min=\"10\"\n              max=\"100\"\n              className=\"flex-1\"\n            />\n            <span className=\"text-white text-sm w-12 text-right\">{currentFuel}%</span>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-2 gap-3\">\n        <div>\n          <label className=\"block text-xs text-slate-400 mb-1\">Burn Rate (gph)</label>\n          <input\n            type=\"number\"\n            value={burnRate}\n            onChange={(e) => setBurnRate(Number(e.target.value))}\n            min=\"1\"\n            max=\"50\"\n            step=\"0.5\"\n            className=\"w-full bg-slate-700 border border-slate-600 rounded px-3 py-2 text-white text-sm\"\n          />\n        </div>\n        <div>\n          <label className=\"block text-xs text-slate-400 mb-1\">Cruise Speed (kts)</label>\n          <input\n            type=\"number\"\n            value={cruiseSpeed}\n            onChange={(e) => setCruiseSpeed(Number(e.target.value))}\n            min=\"50\"\n            max=\"500\"\n            className=\"w-full bg-slate-700 border border-slate-600 rounded px-3 py-2 text-white text-sm\"\n          />\n        </div>\n      </div>\n\n      <div>\n        <label className=\"block text-xs text-slate-400 mb-1\">Unusable Fuel (gal)</label>\n        <input\n          type=\"number\"\n          value={unusableFuel}\n          onChange={(e) => setUnusableFuel(Number(e.target.value))}\n          min=\"0\"\n          max=\"10\"\n          className=\"w-full bg-slate-700 border border-slate-600 rounded px-3 py-2 text-white text-sm\"\n        />\n      </div>\n\n      {/* Results */}\n      {range && (\n        <div className=\"bg-slate-700 rounded-lg p-3 space-y-2\">\n          <div className=\"flex justify-between items-center\">\n            <span className=\"text-slate-400 text-sm\">Max Range:</span>\n            <span className=\"text-green-400 font-bold text-lg\">{range.maxRangeNm} nm</span>\n          </div>\n          <div className=\"flex justify-between items-center\">\n            <span className=\"text-slate-400 text-sm\">With 1.75hr Reserve:</span>\n            <span className=\"text-yellow-400 font-semibold\">{range.withReserve} nm</span>\n          </div>\n          <div className=\"flex justify-between items-center text-xs\">\n            <span className=\"text-slate-500\">Usable Fuel:</span>\n            <span className=\"text-slate-300\">{range.usableFuel} gal</span>\n          </div>\n          <div className=\"flex justify-between items-center text-xs\">\n            <span className=\"text-slate-500\">Reserve Required:</span>\n            <span className=\"text-slate-300\">{range.reserveFuel} gal</span>\n          </div>\n        </div>\n      )}\n\n      <button\n        onClick={() => center && onRangeChange(range!, center)}\n        className=\"w-full bg-sky-500 hover:bg-sky-600 text-white rounded-lg py-2 text-sm font-medium\"\n      >\n        Show on Map\n      </button>\n    </div>\n  );\n}\n\nexport default RangeRingCalculator;\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\fuel-saver\\StateInfoPanel.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useState' is defined but never used.","line":3,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":18,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"useState"},"fix":{"range":[24,33],"text":""},"desc":"Remove unused variable \"useState\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useEffect' is defined but never used.","line":3,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":29,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"useEffect"},"fix":{"range":[15,60],"text":""},"desc":"Remove unused import declaration."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect } from 'react';\n\ninterface StateInfo {\n  state: string;\n  stateName: string;\n  nickname: string;\n  capital: string;\n  region: string;\n  bio: string;\n  terrain: string;\n  majorAirports: string[];\n  attractions: string[];\n  funFact: string;\n  avgElevation: number;\n  climate: string;\n  medianPrice?: number;\n  sampleCount?: number;\n}\n\ninterface StateInfoPanelProps {\n  stateInfo: StateInfo | null;\n  onClose: () => void;\n  onAirportClick?: (icao: string) => void;\n}\n\nexport default function StateInfoPanel({ stateInfo, onClose, onAirportClick }: StateInfoPanelProps) {\n  if (!stateInfo) return null;\n\n  // Get region color\n  const getRegionColor = (region: string) => {\n    switch (region) {\n      case 'Northeast': return 'from-blue-500 to-cyan-500';\n      case 'South': return 'from-red-500 to-orange-500';\n      case 'Midwest': return 'from-green-500 to-emerald-500';\n      case 'West': return 'from-purple-500 to-pink-500';\n      default: return 'from-slate-500 to-slate-600';\n    }\n  };\n\n  return (\n    <div className=\"absolute top-4 left-4 z-[1000] w-80 animate-in slide-in-from-left duration-300\">\n      {/* Main Card */}\n      <div className=\"bg-slate-900/95 backdrop-blur-xl rounded-2xl border border-slate-700/50 shadow-2xl overflow-hidden\">\n        \n        {/* Header with gradient */}\n        <div className={`bg-gradient-to-r ${getRegionColor(stateInfo.region)} p-4 relative overflow-hidden`}>\n          {/* Decorative elements */}\n          <div className=\"absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -mr-16 -mt-16 blur-2xl\"></div>\n          <div className=\"absolute bottom-0 left-0 w-20 h-20 bg-white/10 rounded-full -ml-10 -mb-10 blur-xl\"></div>\n          \n          <div className=\"relative z-10\">\n            <button\n              onClick={onClose}\n              className=\"absolute top-0 right-0 w-7 h-7 bg-white/20 hover:bg-white/30 rounded-full flex items-center justify-center text-white text-lg font-bold transition-colors\"\n            >\n              Ã—\n            </button>\n            <div className=\"flex items-center gap-3\">\n              <div className=\"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center backdrop-blur\">\n                <span className=\"text-2xl font-bold text-white\">{stateInfo.state}</span>\n              </div>\n              <div>\n                <h2 className=\"text-xl font-bold text-white\">{stateInfo.stateName}</h2>\n                <p className=\"text-white/80 text-sm\">The {stateInfo.nickname}</p>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Content */}\n        <div className=\"p-4 space-y-4\">\n          \n          {/* Quick Stats Grid */}\n          <div className=\"grid grid-cols-2 gap-2\">\n            <div className=\"bg-slate-800/50 rounded-xl p-3 text-center\">\n              <div className=\"text-2xl font-bold text-sky-400\">${stateInfo.medianPrice?.toFixed(2) || '--'}</div>\n              <div className=\"text-xs text-slate-400\">Avg Fuel Price</div>\n              {stateInfo.sampleCount && (\n                <div className=\"text-xs text-slate-500\">{stateInfo.sampleCount} airports</div>\n              )}\n            </div>\n            <div className=\"bg-slate-800/50 rounded-xl p-3 text-center\">\n              <div className=\"text-2xl font-bold text-emerald-400\">{stateInfo.avgElevation.toLocaleString()}</div>\n              <div className=\"text-xs text-slate-400\">Avg Elevation</div>\n              <div className=\"text-xs text-slate-500\">ft</div>\n            </div>\n          </div>\n\n          {/* Bio */}\n          <div className=\"bg-slate-800/30 rounded-xl p-3\">\n            <p className=\"text-sm text-slate-300 leading-relaxed\">{stateInfo.bio}</p>\n          </div>\n\n          {/* Quick Facts */}\n          <div className=\"grid grid-cols-2 gap-2 text-sm\">\n            <div className=\"flex items-center gap-2\">\n              <span className=\"text-slate-500\">ðŸ“</span>\n              <span className=\"text-slate-300\">Capital: <strong>{stateInfo.capital}</strong></span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <span className=\"text-slate-500\">ðŸŒ¡ï¸</span>\n              <span className=\"text-slate-300\">{stateInfo.climate}</span>\n            </div>\n          </div>\n\n          {/* Terrain */}\n          <div className=\"bg-gradient-to-r from-amber-900/30 to-orange-900/30 rounded-xl p-3 border border-amber-700/30\">\n            <div className=\"flex items-center gap-2 mb-1\">\n              <span className=\"text-amber-400\">ðŸ”ï¸</span>\n              <span className=\"text-sm font-medium text-amber-200\">Terrain</span>\n            </div>\n            <p className=\"text-xs text-slate-300\">{stateInfo.terrain}</p>\n          </div>\n\n          {/* Attractions */}\n          <div>\n            <div className=\"flex items-center gap-2 mb-2\">\n              <span className=\"text-pink-400\">ðŸŽ¯</span>\n              <span className=\"text-sm font-medium text-slate-300\">Top Attractions</span>\n            </div>\n            <div className=\"flex flex-wrap gap-1.5\">\n              {stateInfo.attractions.slice(0, 3).map((attraction, i) => (\n                <span \n                  key={i} \n                  className=\"text-xs bg-slate-800/60 text-slate-300 px-2 py-1 rounded-lg border border-slate-700/50\"\n                >\n                  {attraction}\n                </span>\n              ))}\n            </div>\n          </div>\n\n          {/* Major Airports */}\n          {stateInfo.majorAirports.length > 0 && (\n            <div>\n              <div className=\"flex items-center gap-2 mb-2\">\n                <span className=\"text-sky-400\">âœˆï¸</span>\n                <span className=\"text-sm font-medium text-slate-300\">Major Airports</span>\n              </div>\n              <div className=\"flex flex-wrap gap-1.5\">\n                {stateInfo.majorAirports.map((icao, i) => (\n                  <button\n                    key={i}\n                    onClick={() => onAirportClick?.(icao)}\n                    className=\"text-xs bg-sky-900/40 hover:bg-sky-800/60 text-sky-300 px-2 py-1 rounded-lg border border-sky-700/30 hover:border-sky-500/50 transition-colors\"\n                  >\n                    {icao}\n                  </button>\n                ))}\n              </div>\n            </div>\n          )}\n\n          {/* Fun Fact */}\n          <div className=\"bg-gradient-to-r from-violet-900/30 to-purple-900/30 rounded-xl p-3 border border-violet-700/30\">\n            <div className=\"flex items-center gap-2 mb-1\">\n              <span className=\"text-violet-400\">ðŸ’¡</span>\n              <span className=\"text-sm font-medium text-violet-200\">Fun Fact</span>\n            </div>\n            <p className=\"text-xs text-slate-300\">{stateInfo.funFact}</p>\n          </div>\n\n        </div>\n      </div>\n\n      {/* Decorative corner */}\n      <div className=\"absolute -bottom-2 -right-2 w-8 h-8 bg-gradient-to-tl from-sky-500/30 to-transparent rounded-bl-2xl\"></div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\fuel-saver\\TierExplainerModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'session' is assigned a value but never used.","line":12,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":24},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\David\\next-dashboard\\app\\fuel-saver\\TierExplainerModal.tsx:20:9\n  18 |       const seen = localStorage.getItem('hasSeenTierExplainer');\n  19 |       if (seen) {\n> 20 |         setHasSeenExplainer(true);\n     |         ^^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  21 |       }\n  22 |     }\n  23 |   }, []);","line":20,"column":9,"nodeType":null,"endLine":20,"endColumn":28}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect } from 'react';\nimport { useSession } from 'next-auth/react';\n\ninterface TierExplainerModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nexport default function TierExplainerModal({ isOpen, onClose }: TierExplainerModalProps) {\n  const { data: session } = useSession();\n  const [hasSeenExplainer, setHasSeenExplainer] = useState(false);\n\n  useEffect(() => {\n    // Check if user has seen the explainer before\n    if (typeof window !== 'undefined') {\n      const seen = localStorage.getItem('hasSeenTierExplainer');\n      if (seen) {\n        setHasSeenExplainer(true);\n      }\n    }\n  }, []);\n\n  const handleClose = () => {\n    // Mark as seen\n    if (typeof window !== 'undefined') {\n      localStorage.setItem('hasSeenTierExplainer', 'true');\n    }\n    setHasSeenExplainer(true);\n    onClose();\n  };\n\n  if (!isOpen || hasSeenExplainer) return null;\n\n  return (\n    <div className=\"fixed inset-0 z-[9998] flex items-center justify-center\">\n      {/* Backdrop */}\n      <div \n        className=\"absolute inset-0 bg-black/70 backdrop-blur-sm\"\n        onClick={handleClose}\n      />\n      \n      {/* Modal */}\n      <div className=\"relative bg-slate-800 rounded-2xl p-8 max-w-lg w-full mx-4 shadow-2xl border border-slate-700\">\n        {/* Header with plane animation */}\n        <div className=\"text-center mb-6\">\n          <div className=\"text-5xl mb-4\">âœˆï¸</div>\n          <h2 className=\"text-2xl font-bold text-white\">\n            Welcome to Signal Desk! \n          </h2>\n          <p className=\"text-slate-400 mt-2\">\n            Your free flight planning & fuel saver tool\n          </p>\n        </div>\n\n        {/* Free vs Pro comparison */}\n        <div className=\"space-y-4 mb-6\">\n          {/* Free Tier */}\n          <div className=\"bg-slate-700/50 rounded-xl p-4 border border-slate-600\">\n            <div className=\"flex items-center justify-between mb-3\">\n              <span className=\"text-lg font-semibold text-white\">Free</span>\n              <span className=\"text-slate-400\">$0 forever</span>\n            </div>\n            <ul className=\"space-y-2 text-sm text-slate-300\">\n              <li className=\"flex items-center gap-2\">\n                <span className=\"text-emerald-400\">âœ“</span> Up to 6 waypoints per flight\n              </li>\n              <li className=\"flex items-center gap-2\">\n                <span className=\"text-emerald-400\">âœ“</span> Up to 5 saved flight plans\n              </li>\n              <li className=\"flex items-center gap-2\">\n                <span className=\"text-emerald-400\">âœ“</span> 1 Flying Club\n              </li>\n              <li className=\"flex items-center gap-2\">\n                <span className=\"text-emerald-400\">âœ“</span> 3 Aircraft profiles\n              </li>\n              <li className=\"flex items-center gap-2\">\n                <span className=\"text-emerald-400\">âœ“</span> Home state fuel prices\n              </li>\n            </ul>\n          </div>\n\n          {/* Pro Tier */}\n          <div className=\"bg-gradient-to-br from-emerald-500/10 to-emerald-600/10 rounded-xl p-4 border-2 border-emerald-500/50\">\n            <div className=\"flex items-center justify-between mb-3\">\n              <span className=\"text-lg font-semibold text-emerald-400\">Pro</span>\n              <div className=\"text-right\">\n                <span className=\"text-2xl font-bold text-white\">$3.99</span>\n                <span className=\"text-slate-400 text-sm\">/mo</span>\n              </div>\n            </div>\n            <ul className=\"space-y-2 text-sm text-slate-300\">\n              <li className=\"flex items-center gap-2\">\n                <span className=\"text-emerald-400\">âœ“</span> <strong className=\"text-white\">Unlimited</strong> waypoints\n              </li>\n              <li className=\"flex items-center gap-2\">\n                <span className=\"text-emerald-400\">âœ“</span> <strong className=\"text-white\">Unlimited</strong> flight plans\n              </li>\n              <li className=\"flex items-center gap-2\">\n                <span className=\"text-emerald-400\">âœ“</span> <strong className=\"text-white\">Unlimited</strong> Flying Clubs\n              </li>\n              <li className=\"flex items-center gap-2\">\n                <span className=\"text-emerald-400\">âœ“</span> <strong className=\"text-white\">Unlimited</strong> Aircraft\n              </li>\n              <li className=\"flex items-center gap-2\">\n                <span className=\"text-emerald-400\">âœ“</span> All 50 states fuel prices\n              </li>\n              <li className=\"flex items-center gap-2\">\n                <span className=\"text-emerald-400\">âœ“</span> Document storage (POH, insurance)\n              </li>\n              <li className=\"flex items-center gap-2\">\n                <span className=\"text-emerald-400\">âœ“</span> Export to ForeFlight & Garmin\n              </li>\n            </ul>\n          </div>\n        </div>\n\n        {/* Early bird pricing */}\n        <div className=\"bg-amber-500/10 border border-amber-500/30 rounded-lg p-3 mb-6 text-center\">\n          <p className=\"text-amber-400 font-semibold\">\n            ðŸŽ‰ Early Bird Pricing: $39.99/year (save 17%)\n          </p>\n          <p className=\"text-xs text-slate-400 mt-1\">\n            Lock in this rate for life when you sign up now!\n          </p>\n        </div>\n\n        {/* Buttons */}\n        <div className=\"flex flex-col gap-3\">\n          <button\n            onClick={handleClose}\n            className=\"w-full bg-emerald-500 hover:bg-emerald-400 text-white font-semibold py-3 px-4 rounded-lg transition\"\n          >\n            Got it, thanks!\n          </button>\n        </div>\n\n        {/* Privacy note */}\n        <p className=\"text-xs text-slate-500 text-center mt-4\">\n          ðŸ”’ We never sell your data. No ads. Built by a pilot, for pilots.\n        </p>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\fuel-saver\\UpgradeModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'session' is assigned a value but never used.","line":22,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":22,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'status' is assigned a value but never used.","line":22,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":22,"endColumn":32},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\David\\next-dashboard\\app\\fuel-saver\\UpgradeModal.tsx:29:7\n  27 |   useEffect(() => {\n  28 |     if (isOpen) {\n> 29 |       setLoading(false);\n     |       ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  30 |     }\n  31 |   }, [isOpen]);\n  32 |","line":29,"column":7,"nodeType":null,"endLine":29,"endColumn":17}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect } from 'react';\nimport { useSession } from 'next-auth/react';\nimport { useRouter } from 'next/navigation';\n\ninterface UpgradeModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  title?: string;\n  message?: string;\n  feature?: string;\n}\n\nexport default function UpgradeModal({ \n  isOpen, \n  onClose, \n  title = 'Upgrade to Pro',\n  message = 'You\\'ve reached the free tier limit. Upgrade to Pro to unlock unlimited features!',\n  feature\n}: UpgradeModalProps) {\n  const { data: session, status } = useSession();\n  const router = useRouter();\n  const [loading, setLoading] = useState(false);\n\n  // Reset state when modal opens\n  useEffect(() => {\n    if (isOpen) {\n      setLoading(false);\n    }\n  }, [isOpen]);\n\n  if (!isOpen) return null;\n\n  const handleUpgrade = async () => {\n    setLoading(true);\n    // Redirect to billing/upgrade page\n    router.push('/billing?upgrade=true');\n    onClose();\n  };\n\n  const handleContinueFree = () => {\n    // User chooses to continue with free tier limits\n    onClose();\n  };\n\n  return (\n    <div className=\"fixed inset-0 z-[9999] flex items-center justify-center\">\n      {/* Backdrop */}\n      <div \n        className=\"absolute inset-0 bg-black/60 backdrop-blur-sm\"\n        onClick={onClose}\n      />\n      \n      {/* Modal */}\n      <div className=\"relative bg-slate-800 rounded-xl p-6 max-w-sm w-full mx-4 shadow-2xl border border-slate-700\">\n        {/* Icon */}\n        <div className=\"text-4xl text-center mb-4\">\n          ðŸš€\n        </div>\n\n        {/* Title */}\n        <h3 className=\"text-xl font-bold text-white text-center mb-2\">\n          {title}\n        </h3>\n\n        {/* Feature-specific message */}\n        {feature && (\n          <div className=\"mb-4 p-3 bg-amber-500/10 border border-amber-500/30 rounded-lg\">\n            <p className=\"text-amber-400 text-sm text-center\">\n              <span className=\"font-semibold\">{feature}</span> is available on Pro\n            </p>\n          </div>\n        )}\n\n        {/* Description */}\n        <p className=\"text-slate-400 text-center mb-6\">\n          {message}\n        </p>\n\n        {/* Pricing */}\n        <div className=\"flex gap-3 mb-6\">\n          <div className=\"flex-1 bg-slate-700 rounded-lg p-3 text-center\">\n            <div className=\"text-2xl font-bold text-white\">$3.99</div>\n            <div className=\"text-xs text-slate-400\">per month</div>\n          </div>\n          <div className=\"flex-1 bg-gradient-to-br from-emerald-500/20 to-emerald-600/20 rounded-lg p-3 text-center border border-emerald-500/30\">\n            <div className=\"text-2xl font-bold text-emerald-400\">$39.99</div>\n            <div className=\"text-xs text-emerald-300\">per year</div>\n            <div className=\"text-[10px] text-emerald-300\">Save 17%</div>\n          </div>\n        </div>\n\n        {/* Buttons */}\n        <div className=\"flex flex-col gap-3\">\n          <button\n            onClick={handleUpgrade}\n            disabled={loading}\n            className=\"w-full bg-emerald-500 hover:bg-emerald-400 disabled:bg-slate-600 text-white font-semibold py-3 px-4 rounded-lg transition\"\n          >\n            {loading ? 'Redirecting...' : 'Upgrade to Pro'}\n          </button>\n          \n          <button\n            onClick={handleContinueFree}\n            className=\"w-full bg-slate-700 hover:bg-slate-600 text-white font-medium py-3 px-4 rounded-lg transition\"\n          >\n            Continue with Free\n          </button>\n        </div>\n\n        {/* Features list */}\n        <div className=\"mt-6 pt-4 border-t border-slate-700\">\n          <p className=\"text-xs text-slate-500 mb-2 text-center\">Pro includes:</p>\n          <div className=\"grid grid-cols-2 gap-1 text-xs text-slate-400\">\n            <div className=\"flex items-center gap-1\">âœ“ Unlimited flight plans</div>\n            <div className=\"flex items-center gap-1\">âœ“ Unlimited waypoints</div>\n            <div className=\"flex items-center gap-1\">âœ“ Multiple clubs</div>\n            <div className=\"flex items-center gap-1\">âœ“ Document storage</div>\n            <div className=\"flex items-center gap-1\">âœ“ All US fuel prices</div>\n            <div className=\"flex items-center gap-1\">âœ“ Export toForeFlight</div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\fuel-saver\\WindImpactGraph.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\David\\next-dashboard\\app\\fuel-saver\\WindImpactGraph.tsx:37:5\n  35 |     const length = path.getTotalLength?.() || 1000;\n  36 |     \n> 37 |     setDashOffset(length * (1 - progress));\n     |     ^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  38 |   }, [progress, points]);\n  39 |   \n  40 |   return (","line":37,"column":5,"nodeType":null,"endLine":37,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'hoveredPoint' is assigned a value but never used.","line":64,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":64,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setHoveredPoint' is assigned a value but never used.","line":64,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":64,"endColumn":39},{"ruleId":"react-hooks/preserve-manual-memoization","severity":2,"message":"Compilation Skipped: Existing memoization could not be preserved\n\nReact Compiler has skipped optimizing this component because the existing manual memoization could not be preserved. The inferred dependencies did not match the manually specified dependencies, which could cause the value to change more or less frequently than expected. The inferred dependency was `xScale`, but the source dependencies were [data, maxDistance, maxImpact]. Inferred different dependency than source.\n\nC:\\Users\\David\\next-dashboard\\app\\fuel-saver\\WindImpactGraph.tsx:87:28\n  85 |   \n  86 |   // Generate path\n> 87 |   const linePath = useMemo(() => {\n     |                            ^^^^^^^\n> 88 |     if (data.length === 0) return '';\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 89 |     \n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 90 |     return data.map((point, i) => {\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 91 |       const x = xScale(point.distanceNm);\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 92 |       const y = yScale(point.cumulativeImpactGallons);\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 93 |       return i === 0 ? `M ${x} ${y}` : `L ${x} ${y}`;\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 94 |     }).join(' ');\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 95 |   }, [data, maxDistance, maxImpact]);\n     | ^^^^ Could not preserve existing manual memoization\n  96 |   \n  97 |   // Current progress (0-1)\n  98 |   const currentProgress = maxDistance > 0 ? currentDistanceNm / maxDistance : 0;","line":87,"column":28,"nodeType":null,"endLine":95,"endColumn":4},{"ruleId":"react-hooks/preserve-manual-memoization","severity":2,"message":"Compilation Skipped: Existing memoization could not be preserved\n\nReact Compiler has skipped optimizing this component because the existing manual memoization could not be preserved. The inferred dependencies did not match the manually specified dependencies, which could cause the value to change more or less frequently than expected. The inferred dependency was `yScale`, but the source dependencies were [data, maxDistance, maxImpact]. Inferred different dependency than source.\n\nC:\\Users\\David\\next-dashboard\\app\\fuel-saver\\WindImpactGraph.tsx:87:28\n  85 |   \n  86 |   // Generate path\n> 87 |   const linePath = useMemo(() => {\n     |                            ^^^^^^^\n> 88 |     if (data.length === 0) return '';\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 89 |     \n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 90 |     return data.map((point, i) => {\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 91 |       const x = xScale(point.distanceNm);\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 92 |       const y = yScale(point.cumulativeImpactGallons);\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 93 |       return i === 0 ? `M ${x} ${y}` : `L ${x} ${y}`;\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 94 |     }).join(' ');\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 95 |   }, [data, maxDistance, maxImpact]);\n     | ^^^^ Could not preserve existing manual memoization\n  96 |   \n  97 |   // Current progress (0-1)\n  98 |   const currentProgress = maxDistance > 0 ? currentDistanceNm / maxDistance : 0;","line":87,"column":28,"nodeType":null,"endLine":95,"endColumn":4},{"ruleId":"react-hooks/preserve-manual-memoization","severity":2,"message":"Compilation Skipped: Existing memoization could not be preserved\n\nReact Compiler has skipped optimizing this component because the existing manual memoization could not be preserved. The inferred dependencies did not match the manually specified dependencies, which could cause the value to change more or less frequently than expected. The inferred dependency was `xScale`, but the source dependencies were [data, maxDistance, maxImpact]. Inferred different dependency than source.\n\nC:\\Users\\David\\next-dashboard\\app\\fuel-saver\\WindImpactGraph.tsx:87:28\n  85 |   \n  86 |   // Generate path\n> 87 |   const linePath = useMemo(() => {\n     |                            ^^^^^^^\n> 88 |     if (data.length === 0) return '';\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 89 |     \n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 90 |     return data.map((point, i) => {\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 91 |       const x = xScale(point.distanceNm);\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 92 |       const y = yScale(point.cumulativeImpactGallons);\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 93 |       return i === 0 ? `M ${x} ${y}` : `L ${x} ${y}`;\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 94 |     }).join(' ');\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 95 |   }, [data, maxDistance, maxImpact]);\n     | ^^^^ Could not preserve existing manual memoization\n  96 |   \n  97 |   // Current progress (0-1)\n  98 |   const currentProgress = maxDistance > 0 ? currentDistanceNm / maxDistance : 0;","line":87,"column":28,"nodeType":null,"endLine":95,"endColumn":4},{"ruleId":"react-hooks/preserve-manual-memoization","severity":2,"message":"Compilation Skipped: Existing memoization could not be preserved\n\nReact Compiler has skipped optimizing this component because the existing manual memoization could not be preserved. The inferred dependencies did not match the manually specified dependencies, which could cause the value to change more or less frequently than expected. The inferred dependency was `yScale`, but the source dependencies were [data, maxDistance, maxImpact]. Inferred different dependency than source.\n\nC:\\Users\\David\\next-dashboard\\app\\fuel-saver\\WindImpactGraph.tsx:87:28\n  85 |   \n  86 |   // Generate path\n> 87 |   const linePath = useMemo(() => {\n     |                            ^^^^^^^\n> 88 |     if (data.length === 0) return '';\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 89 |     \n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 90 |     return data.map((point, i) => {\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 91 |       const x = xScale(point.distanceNm);\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 92 |       const y = yScale(point.cumulativeImpactGallons);\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 93 |       return i === 0 ? `M ${x} ${y}` : `L ${x} ${y}`;\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 94 |     }).join(' ');\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 95 |   }, [data, maxDistance, maxImpact]);\n     | ^^^^ Could not preserve existing manual memoization\n  96 |   \n  97 |   // Current progress (0-1)\n  98 |   const currentProgress = maxDistance > 0 ? currentDistanceNm / maxDistance : 0;","line":87,"column":28,"nodeType":null,"endLine":95,"endColumn":4},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has missing dependencies: 'xScale' and 'yScale'. Either include them or remove the dependency array.","line":95,"column":6,"nodeType":"ArrayExpression","endLine":95,"endColumn":36,"suggestions":[{"desc":"Update the dependencies array to be: [data, xScale, yScale]","fix":{"range":[2616,2646],"text":"[data, xScale, yScale]"}}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\David\\next-dashboard\\app\\fuel-saver\\WindImpactGraph.tsx:114:7\n  112 |       animationRef.current = requestAnimationFrame(animate);\n  113 |     } else {\n> 114 |       setAnimatedProgress(currentProgress);\n      |       ^^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  115 |     }\n  116 |     \n  117 |     return () => {","line":114,"column":7,"nodeType":null,"endLine":114,"endColumn":26}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect, useRef, useMemo } from 'react';\n\ninterface WindImpactPoint {\n  distanceNm: number;\n  cumulativeImpactGallons: number;\n  impactDollars?: number;\n}\n\ninterface WindImpactGraphProps {\n  data: WindImpactPoint[];\n  currentDistanceNm: number;\n  isPlaying: boolean;\n  onPlayPause: () => void;\n  fuelPricePerGallon?: number;\n}\n\n// Animated path component\nfunction AnimatedLine({ \n  points, \n  progress, \n  color \n}: { \n  points: string; \n  progress: number; \n  color: string;\n}) {\n  const [dashOffset, setDashOffset] = useState(0);\n  \n  useEffect(() => {\n    // Calculate path length\n    const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n    path.setAttribute('d', points);\n    const length = path.getTotalLength?.() || 1000;\n    \n    setDashOffset(length * (1 - progress));\n  }, [progress, points]);\n  \n  return (\n    <path\n      d={points}\n      fill=\"none\"\n      stroke={color}\n      strokeWidth=\"2\"\n      strokeLinecap=\"round\"\n      strokeLinejoin=\"round\"\n      style={{\n        strokeDasharray: '1000',\n        strokeDashoffset: dashOffset,\n        transition: 'stroke-dashoffset 0.1s ease-out'\n      }}\n    />\n  );\n}\n\nexport default function WindImpactGraph({\n  data,\n  currentDistanceNm,\n  isPlaying,\n  onPlayPause,\n  fuelPricePerGallon = 6.0\n}: WindImpactGraphProps) {\n  const [hoveredPoint, setHoveredPoint] = useState<WindImpactPoint | null>(null);\n  const [animatedProgress, setAnimatedProgress] = useState(0);\n  const animationRef = useRef<number | null>(null);\n  \n  // Calculate graph dimensions\n  const width = 280;\n  const height = 100;\n  const padding = { top: 10, right: 10, bottom: 25, left: 10 };\n  const graphWidth = width - padding.left - padding.right;\n  const graphHeight = height - padding.top - padding.bottom;\n  \n  // Calculate scales\n  const maxDistance = useMemo(() => Math.max(...data.map(d => d.distanceNm), 100), [data]);\n  const maxImpact = useMemo(() => {\n    const max = Math.max(...data.map(d => Math.abs(d.cumulativeImpactGallons)));\n    return Math.max(max, 1); // Minimum 1 gallon range\n  }, [data]);\n  \n  // Scale functions\n  const xScale = (d: number) => padding.left + (d / maxDistance) * graphWidth;\n  const yScale = (g: number) => padding.top + graphHeight / 2 - (g / maxImpact) * (graphHeight / 2);\n  \n  // Generate path\n  const linePath = useMemo(() => {\n    if (data.length === 0) return '';\n    \n    return data.map((point, i) => {\n      const x = xScale(point.distanceNm);\n      const y = yScale(point.cumulativeImpactGallons);\n      return i === 0 ? `M ${x} ${y}` : `L ${x} ${y}`;\n    }).join(' ');\n  }, [data, maxDistance, maxImpact]);\n  \n  // Current progress (0-1)\n  const currentProgress = maxDistance > 0 ? currentDistanceNm / maxDistance : 0;\n  \n  // Animate the line drawing when playing\n  useEffect(() => {\n    if (isPlaying) {\n      const animate = () => {\n        setAnimatedProgress(prev => {\n          if (prev >= currentProgress) {\n            return prev;\n          }\n          return Math.min(prev + 0.02, currentProgress);\n        });\n        animationRef.current = requestAnimationFrame(animate);\n      };\n      animationRef.current = requestAnimationFrame(animate);\n    } else {\n      setAnimatedProgress(currentProgress);\n    }\n    \n    return () => {\n      if (animationRef.current) {\n        cancelAnimationFrame(animationRef.current);\n      }\n    };\n  }, [isPlaying, currentProgress]);\n  \n  // Current impact value\n  const currentImpact = useMemo(() => {\n    const point = data.find(d => d.distanceNm >= currentDistanceNm);\n    return point || data[data.length - 1] || { distanceNm: 0, cumulativeImpactGallons: 0 };\n  }, [data, currentDistanceNm]);\n  \n  // Color based on impact\n  const impactColor = currentImpact.cumulativeImpactGallons >= 0 \n    ? '#ef4444' // Red for negative (headwind = more fuel)\n    : '#22c55e'; // Green for positive (tailwind = less fuel)\n  \n  // Calculate zero line Y position\n  const zeroY = yScale(0);\n  \n  return (\n    <div className=\"bg-slate-800/90 rounded-lg p-3 space-y-2\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div className=\"text-xs font-medium text-slate-300\">ðŸ’¨ Wind Impact</div>\n        <button\n          onClick={onPlayPause}\n          className=\"bg-sky-500 hover:bg-sky-600 text-white text-xs px-2 py-1 rounded flex items-center gap-1\"\n        >\n          {isPlaying ? 'â¸ Pause' : 'â–¶ Play'}\n        </button>\n      </div>\n      \n      {/* Graph */}\n      <div className=\"relative\" style={{ width, height }}>\n        <svg width={width} height={height} className=\"overflow-visible\">\n          {/* Zero line (expected) */}\n          <line\n            x1={padding.left}\n            y1={zeroY}\n            x2={width - padding.right}\n            y2={zeroY}\n            stroke=\"#475569\"\n            strokeWidth=\"1\"\n            strokeDasharray=\"4 4\"\n          />\n          \n          {/* Impact line */}\n          {linePath && (\n            <AnimatedLine\n              points={linePath}\n              progress={animatedProgress}\n              color={impactColor}\n            />\n          )}\n          \n          {/* Current position dot */}\n          {animatedProgress > 0 && (\n            <circle\n              cx={xScale(currentDistanceNm)}\n              cy={yScale(currentImpact.cumulativeImpactGallons)}\n              r=\"4\"\n              fill={impactColor}\n              stroke=\"white\"\n              strokeWidth=\"2\"\n            />\n          )}\n          \n          {/* X-axis labels */}\n          <text x={padding.left} y={height - 5} fill=\"#64748b\" fontSize=\"8\">0 NM</text>\n          <text x={width / 2} y={height - 5} fill=\"#64748b\" fontSize=\"8\" textAnchor=\"middle\">{Math.round(maxDistance / 2)} NM</text>\n          <text x={width - padding.right} y={height - 5} fill=\"#64748b\" fontSize=\"8\" textAnchor=\"end\">{Math.round(maxDistance)} NM</text>\n          \n          {/* Y-axis label */}\n          <text x={padding.left + 5} y={padding.top + 8} fill=\"#64748b\" fontSize=\"7\">+</text>\n          <text x={padding.left + 5} y={zeroY - 5} fill=\"#64748b\" fontSize=\"7\" textAnchor=\"middle\">0</text>\n          <text x={padding.left + 5} y={height - padding.bottom - 5} fill=\"#64748b\" fontSize=\"7\">-</text>\n        </svg>\n      </div>\n      \n      {/* Stats */}\n      <div className=\"flex justify-between text-xs\">\n        <div>\n          <span className=\"text-slate-400\">Distance: </span>\n          <span className=\"text-white font-medium\">{Math.round(currentDistanceNm)} NM</span>\n        </div>\n        <div>\n          <span className=\"text-slate-400\">Impact: </span>\n          <span \n            className=\"font-medium\"\n            style={{ color: impactColor }}\n          >\n            {currentImpact.cumulativeImpactGallons >= 0 ? '+' : ''}\n            {currentImpact.cumulativeImpactGallons.toFixed(1)} gal\n          </span>\n        </div>\n        <div>\n          <span className=\"text-slate-400\">$ </span>\n          <span \n            className=\"font-medium\"\n            style={{ color: impactColor }}\n          >\n            {currentImpact.cumulativeImpactGallons >= 0 ? '+' : ''}\n            ${(currentImpact.cumulativeImpactGallons * fuelPricePerGallon).toFixed(0)}\n          </span>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n// Helper function to generate mock wind impact data\nexport function generateWindImpactData(\n  trackPoints: { lat: number; lon: number }[],\n  averageWind: number = 0 // knots headwind (+), tailwind (-)\n): WindImpactPoint[] {\n  if (trackPoints.length < 2) return [];\n  \n  const data: WindImpactPoint[] = [];\n  let totalDistance = 0;\n  let cumulativeImpact = 0;\n  \n  // Simple distance calculation (Haversine would be better but this works for demo)\n  for (let i = 1; i < trackPoints.length; i++) {\n    const lat1 = trackPoints[i - 1].lat;\n    const lon1 = trackPoints[i - 1].lon;\n    const lat2 = trackPoints[i].lat;\n    const lon2 = trackPoints[i].lon;\n    \n    // Simple approximate distance\n    const dLat = lat2 - lat1;\n    const dLon = (lon2 - lon1) * Math.cos((lat1 + lat2) / 2 * Math.PI / 180);\n    const distanceNm = Math.sqrt(dLat * dLat + dLon * dLon) * 60; // Rough conversion\n    \n    totalDistance += distanceNm;\n    \n    // Wind impact: headwind increases fuel burn, tailwind decreases\n    // Assume 10 gallons/hour per 10 knots wind difference\n    const windImpactPerNm = averageWind / 60; // Simplified\n    cumulativeImpact += windImpactPerNm * distanceNm;\n    \n    data.push({\n      distanceNm: Math.round(totalDistance),\n      cumulativeImpactGallons: Math.round(cumulativeImpact * 10) / 10\n    });\n  }\n  \n  return data;\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\fuel-saver\\airport-lookup\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\fuel-saver\\components\\ExportDropdown.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'navLogDetail' is assigned a value but never used.","line":31,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":31,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setNavLogDetail' is assigned a value but never used.","line":31,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":31,"endColumn":39}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useRef, useEffect } from 'react';\nimport { Waypoint, downloadGPX, downloadFPL, downloadJSON, downloadNavLog, downloadNavLogPdf, FlightPlanData, generateForeFlightDeepLink, generateGarminDeepLink } from '../lib/exportUtils';\n\ninterface ExportDropdownProps {\n  waypoints: Waypoint[];\n  flightPlanName?: string;\n  aircraftType?: string;\n  cruisingAltitude?: number;\n  isPro?: boolean;\n  aircraft?: {\n    name: string;\n    speed: number;\n    burnRate: number;\n    fuelCapacity: number;\n  };\n  fuelPrices?: Record<string, { price100ll: number | null }>;\n}\n\nexport default function ExportDropdown({ \n  waypoints, \n  flightPlanName, \n  aircraftType, \n  cruisingAltitude,\n  isPro = false,\n  aircraft,\n  fuelPrices = {}\n}: ExportDropdownProps) {\n  const [isOpen, setIsOpen] = useState(false);\n  const [navLogDetail, setNavLogDetail] = useState<'basic' | 'detailed' | null>(null);\n  const [copied, setCopied] = useState(false);\n  const [deepLinkNotice, setDeepLinkNotice] = useState<string | null>(null);\n  const dropdownRef = useRef<HTMLDivElement>(null);\n\n  // Close dropdown when clicking outside\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (dropdownRef.current && !dropdownRef.current.contains(event.target as Node)) {\n        setIsOpen(false);\n      }\n    };\n    \n    document.addEventListener('mousedown', handleClickOutside);\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, []);\n\n  const handleCopyLink = () => {\n    const planData: FlightPlanData = {\n      name: flightPlanName,\n      waypoints,\n      aircraftType,\n      cruisingAltitude\n    };\n    \n    // Encode to base64 for URL sharing\n    const encoded = btoa(encodeURIComponent(JSON.stringify(planData)));\n    const shareUrl = `${window.location.origin}/modules/fuel-saver?plan=${encoded}`;\n    \n    navigator.clipboard.writeText(shareUrl).then(() => {\n      setCopied(true);\n      setTimeout(() => setCopied(false), 2000);\n    });\n  };\n\n  const handleExportGPX = () => {\n    const planData: FlightPlanData = {\n      name: flightPlanName,\n      waypoints,\n      aircraftType,\n      cruisingAltitude\n    };\n    downloadGPX(planData);\n    setIsOpen(false);\n  };\n\n  const handleExportFPL = () => {\n    downloadFPL(waypoints);\n    setIsOpen(false);\n  };\n\n  const handleExportJSON = () => {\n    const planData: FlightPlanData = {\n      name: flightPlanName,\n      waypoints,\n      aircraftType,\n      cruisingAltitude\n    };\n    downloadJSON(planData);\n    setIsOpen(false);\n  };\n\n  const handleExportNavLog = (detailed: boolean) => {\n    if (!aircraft || waypoints.length < 2) return;\n    downloadNavLog(\n      waypoints,\n      {\n        name: aircraftType || aircraft.name,\n        speed: aircraft.speed,\n        burnRate: aircraft.burnRate,\n        fuelCapacity: aircraft.fuelCapacity\n      },\n      cruisingAltitude || 5500,\n      fuelPrices,\n      detailed,\n      flightPlanName\n    );\n    setIsOpen(false);\n  };\n\n  const handleExportNavLogPdf = (detailed: boolean) => {\n    if (!aircraft || waypoints.length < 2) return;\n    downloadNavLogPdf(\n      waypoints,\n      {\n        name: aircraftType || aircraft.name,\n        speed: aircraft.speed,\n        burnRate: aircraft.burnRate,\n        fuelCapacity: aircraft.fuelCapacity\n      },\n      cruisingAltitude || 5500,\n      fuelPrices,\n      {\n        detailed,\n        planName: flightPlanName\n      }\n    );\n    setIsOpen(false);\n  };\n\n  const attemptDeepLink = (scheme: string, fallback?: string, label?: string) => {\n    if (typeof window === 'undefined') return;\n    try {\n      const ua = window.navigator.userAgent.toLowerCase();\n      const isMobile = /iphone|ipad|android/.test(ua);\n      if (isMobile) {\n        // Try iOS/Safari-friendly approach with a transient iframe.\n        const iframe = document.createElement('iframe');\n        iframe.style.display = 'none';\n        iframe.src = scheme;\n        document.body.appendChild(iframe);\n        setTimeout(() => {\n          try {\n            document.body.removeChild(iframe);\n          } catch {}\n        }, 800);\n        // Fallback attempt as well.\n        window.location.href = scheme;\n        setDeepLinkNotice(null);\n        return;\n      }\n\n      // Desktop: copy the deep link and show instructions.\n      if (navigator?.clipboard) {\n        navigator.clipboard.writeText(scheme);\n      }\n      if (fallback) {\n        window.open(fallback, '_blank', 'noopener');\n      }\n      setDeepLinkNotice(`${label || 'Link'} copied. On mobile, paste into Safari address bar to open the EFB app. You can also import via GPX.`);\n    } catch (error) {\n      console.error('Deep link failed', error);\n      if (fallback) {\n        window.open(fallback, '_blank', 'noopener');\n      }\n    }\n  };\n\n  const handleOpenForeFlight = () => {\n    const link = generateForeFlightDeepLink(waypoints, {\n      planName: flightPlanName || 'Flight Plan',\n      altitude: cruisingAltitude || 5500,\n    });\n    if (!link) return;\n    attemptDeepLink(link.scheme, link.fallback, 'ForeFlight link');\n  };\n\n  const handleOpenGarmin = () => {\n    const link = generateGarminDeepLink(waypoints, {\n      planName: flightPlanName || 'Flight Plan',\n    });\n    if (!link) return;\n    attemptDeepLink(link.scheme, link.fallback, 'Garmin Pilot link');\n  };\n\n  const showNavLogTooltip = (detailed: boolean) => {\n    if (detailed) {\n      return 'Includes magnetic variation, wind correction, VOR info, groundspeed - for serious IFR planning';\n    }\n    return 'Simple format with course, distance, time, fuel, cost - quick reference';\n  };\n\n  if (waypoints.length === 0) {\n    return null;\n  }\n\n  return (\n    <div className=\"relative\" ref={dropdownRef}>\n      <button\n        onClick={() => setIsOpen(!isOpen)}\n        className=\"flex items-center gap-1 px-3 py-1.5 bg-slate-700 hover:bg-slate-600 text-white text-sm rounded transition-colors\"\n      >\n        <span>ðŸ“¤</span>\n        <span>Export</span>\n        <span className={`transform transition-transform ${isOpen ? 'rotate-180' : ''}`}>\n          â–¼\n        </span>\n      </button>\n\n      {isOpen && (\n        <div className=\"absolute right-0 mt-2 w-56 bg-slate-800 border border-slate-700 rounded-lg shadow-xl z-50\">\n          <div className=\"py-1\">\n            {deepLinkNotice && (\n              <div className=\"px-4 pt-3 pb-2 text-xs text-slate-300\">\n                <div className=\"rounded-md border border-slate-700 bg-slate-900/40 p-2\">\n                  {deepLinkNotice}\n                </div>\n              </div>\n            )}\n            {/* Copy Shareable Link */}\n            <button\n              onClick={handleCopyLink}\n              className=\"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-slate-200 hover:bg-slate-700 transition-colors\"\n            >\n              <span className=\"text-lg\">ðŸ”—</span>\n              <div className=\"flex-1 text-left\">\n                <div>{copied ? 'âœ… Copied!' : 'Copy Shareable Link'}</div>\n                <div className=\"text-xs text-slate-400\">\n                  {isPro ? 'Unlimited' : 'Free: 3 days'}\n                </div>\n              </div>\n            </button>\n\n            <div className=\"border-t border-slate-700 my-1\" />\n\n            {/* GPX Export */}\n            <button\n              onClick={handleExportGPX}\n              className=\"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-slate-200 hover:bg-slate-700 transition-colors\"\n            >\n              <span className=\"text-lg\">ðŸ—ºï¸</span>\n              <div className=\"flex-1 text-left\">\n                <div>Export GPX</div>\n                <div className=\"text-xs text-slate-400\">ForeFlight, Garmin, SkyDemon</div>\n              </div>\n            </button>\n\n            {/* FPL Export */}\n            <button\n              onClick={handleExportFPL}\n              className=\"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-slate-200 hover:bg-slate-700 transition-colors\"\n            >\n              <span className=\"text-lg\">ðŸ“‹</span>\n              <div className=\"flex-1 text-left\">\n                <div>Export FPL</div>\n                <div className=\"text-xs text-slate-400\">Garmin 430/530/G1000</div>\n              </div>\n            </button>\n\n            {/* JSON Export */}\n            <button\n              onClick={handleExportJSON}\n              className=\"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-slate-200 hover:bg-slate-700 transition-colors\"\n            >\n              <span className=\"text-lg\">{'{ }'}</span>\n              <div className=\"flex-1 text-left\">\n                <div>Export JSON</div>\n                <div className=\"text-xs text-slate-400\">Backup & custom use</div>\n              </div>\n            </button>\n\n            <div className=\"border-t border-slate-700 my-1\" />\n            <div className=\"px-4 py-1 text-xs uppercase tracking-wide text-slate-500\">Send to EFB</div>\n\n            <button\n              onClick={handleOpenForeFlight}\n              disabled={waypoints.length < 2}\n              className=\"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-slate-200 hover:bg-slate-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              <span className=\"text-lg\">ðŸ›©ï¸</span>\n              <div className=\"flex-1 text-left\">\n                <div>Open in ForeFlight</div>\n                <div className=\"text-xs text-slate-400\">Mobile devices launch automatically</div>\n              </div>\n            </button>\n\n            <button\n              onClick={handleOpenGarmin}\n              disabled={waypoints.length < 2}\n              className=\"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-slate-200 hover:bg-slate-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              <span className=\"text-lg\">ðŸ§­</span>\n              <div className=\"flex-1 text-left\">\n                <div>Open in Garmin Pilot</div>\n                <div className=\"text-xs text-slate-400\">Copies link on desktop</div>\n              </div>\n            </button>\n\n            <div className=\"border-t border-slate-700 my-1\" />\n\n            {/* Nav Log - Basic */}\n            <button\n              onClick={() => handleExportNavLog(false)}\n              disabled={waypoints.length < 2}\n              className=\"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-slate-200 hover:bg-slate-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n              title={showNavLogTooltip(false)}\n            >\n              <span className=\"text-lg\">ðŸ“„</span>\n              <div className=\"flex-1 text-left\">\n                <div>Nav Log (Basic)</div>\n                <div className=\"text-xs text-slate-400\">Simple format</div>\n              </div>\n            </button>\n\n            {/* Nav Log - Detailed */}\n            <button\n              onClick={() => handleExportNavLog(true)}\n              disabled={waypoints.length < 2}\n              className=\"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-slate-200 hover:bg-slate-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n              title={showNavLogTooltip(true)}\n            >\n              <span className=\"text-lg\">ðŸ“Š</span>\n              <div className=\"flex-1 text-left\">\n                <div>Nav Log (Detailed)</div>\n                <div className=\"text-xs text-slate-400\">Wind, mag var, headings</div>\n              </div>\n            </button>\n\n            <div className=\"border-t border-slate-700 my-1\" />\n\n            {/* Nav Log PDF - Basic */}\n            <button\n              onClick={() => handleExportNavLogPdf(false)}\n              disabled={waypoints.length < 2}\n              className=\"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-slate-200 hover:bg-slate-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              <span className=\"text-lg\">ðŸ–¨ï¸</span>\n              <div className=\"flex-1 text-left\">\n                <div>Nav Log PDF</div>\n                <div className=\"text-xs text-slate-400\">Shareable PDF export</div>\n              </div>\n            </button>\n\n            {/* Nav Log PDF - Detailed */}\n            <button\n              onClick={() => handleExportNavLogPdf(true)}\n              disabled={waypoints.length < 2}\n              className=\"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-slate-200 hover:bg-slate-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              <span className=\"text-lg\">ðŸ§¾</span>\n              <div className=\"flex-1 text-left\">\n                <div>Nav Log PDF (Detailed)</div>\n                <div className=\"text-xs text-slate-400\">Headings, winds, costs</div>\n              </div>\n            </button>\n\n            {/* Pro Features Preview */}\n            {!isPro && (\n              <>\n                <div className=\"border-t border-slate-700 my-1\" />\n                <div className=\"px-4 py-2 text-xs text-purple-300 bg-purple-500/10\">\n                  ðŸ”’ Pro: Unlimited sharing, more export formats\n                </div>\n              </>\n            )}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\fuel-saver\\components\\NOTAMsPanel.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'groupedNotams' is assigned a value but never used.","line":95,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":95,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect, useCallback } from 'react';\n\ninterface Notam {\n  id: string;\n  icao: string;\n  category: 'TFR' | 'RUNWAY' | 'NAVAID' | 'OBSTACLE' | 'AIRSPACE' | 'GENERAL';\n  title: string;\n  description: string;\n  startDate: string;\n  endDate: string;\n  location: string;\n  coordinates?: {\n    lat: number;\n    lon: number;\n  };\n}\n\ninterface NotamsPanelProps {\n  waypoints: Array<{ icao: string; latitude: number; longitude: number }>;\n  isPro?: boolean;\n}\n\nconst categoryColors: Record<Notam['category'], { bg: string; text: string; icon: string }> = {\n  TFR: { bg: 'bg-red-500/20', text: 'text-red-400', icon: 'ðŸ”´' },\n  RUNWAY: { bg: 'bg-orange-500/20', text: 'text-orange-400', icon: 'ðŸŸ¡' },\n  NAVAID: { bg: 'bg-gray-500/20', text: 'text-gray-400', icon: 'âšª' },\n  OBSTACLE: { bg: 'bg-amber-500/20', text: 'text-amber-400', icon: 'ðŸŸ ' },\n  AIRSPACE: { bg: 'bg-blue-500/20', text: 'text-blue-400', icon: 'ðŸ”µ' },\n  GENERAL: { bg: 'bg-slate-500/20', text: 'text-slate-400', icon: 'âšª' },\n};\n\nexport default function NotamsPanel({ waypoints, isPro = false }: NotamsPanelProps) {\n  const [notams, setNotams] = useState<Notam[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [expanded, setExpanded] = useState(false);\n  const [filter, setFilter] = useState<Notam['category'] | 'ALL'>('ALL');\n  const [lastFetched, setLastFetched] = useState<Date | null>(null);\n\n  const fetchNotams = useCallback(async () => {\n    if (waypoints.length === 0) {\n      setNotams([]);\n      return;\n    }\n\n    setLoading(true);\n    setError(null);\n\n    try {\n      // Only fetch NOTAMs for real US airports (starting with K)\n      const airportIcaos = waypoints\n        .map(w => w.icao)\n        .filter(icao => icao && icao.startsWith('K'))\n        .join(',');\n      \n      if (!airportIcaos) {\n        setNotams([]);\n        setLoading(false);\n        return;\n      }\n      \n      const res = await fetch(`/api/notams?icaos=${airportIcaos}`);\n      \n      if (!res.ok) {\n        throw new Error('Failed to fetch NOTAMs');\n      }\n      \n      const data = await res.json();\n      setNotams(data.notams || []);\n      setLastFetched(new Date());\n    } catch (err) {\n      console.error('NOTAM fetch error:', err);\n      setError('Unable to load NOTAMs');\n    } finally {\n      setLoading(false);\n    }\n  }, [waypoints]);\n\n  // Fetch NOTAMs when waypoints change\n  useEffect(() => {\n    fetchNotams();\n    \n    // Auto-refresh every 5 minutes\n    const interval = setInterval(fetchNotams, 5 * 60 * 1000);\n    return () => clearInterval(interval);\n  }, [fetchNotams]);\n\n  const filteredNotams = filter === 'ALL' \n    ? notams \n    : notams.filter(n => n.category === filter);\n\n  // Group NOTAMs by category\n  const groupedNotams = filteredNotams.reduce((acc, notam) => {\n    if (!acc[notam.category]) acc[notam.category] = [];\n    acc[notam.category].push(notam);\n    return acc;\n  }, {} as Record<Notam['category'], Notam[]>);\n\n  const formatDate = (dateStr: string) => {\n    if (!dateStr) return '';\n    try {\n      return new Date(dateStr).toLocaleDateString('en-US', {\n        month: 'short',\n        day: 'numeric',\n        hour: '2-digit',\n        minute: '2-digit'\n      });\n    } catch {\n      return dateStr;\n    }\n  };\n\n  if (waypoints.length === 0) {\n    return null;\n  }\n\n  return (\n    <div className=\"bg-slate-800 rounded-lg border border-slate-700\">\n      {/* Header */}\n      <button\n        onClick={() => setExpanded(!expanded)}\n        className=\"w-full px-4 py-3 flex items-center justify-between hover:bg-slate-700/50 transition-colors\"\n      >\n        <div className=\"flex items-center gap-2\">\n          <span className=\"text-lg\">ðŸ“‹</span>\n          <span className=\"font-semibold text-white\">NOTAMs</span>\n          {notams.length > 0 && (\n            <span className={`px-2 py-0.5 rounded-full text-xs font-medium ${\n              notams.some(n => n.category === 'TFR') \n                ? 'bg-red-500/30 text-red-300' \n                : 'bg-slate-600 text-slate-300'\n            }`}>\n              {notams.length}\n            </span>\n          )}\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <button\n            onClick={(e) => {\n              e.stopPropagation();\n              fetchNotams();\n            }}\n            disabled={loading}\n            className=\"p-1 hover:bg-slate-600 rounded disabled:opacity-50\"\n            title=\"Refresh\"\n          >\n            <svg className={`w-4 h-4 text-slate-400 ${loading ? 'animate-spin' : ''}`} fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\" />\n            </svg>\n          </button>\n          <span className={`transform transition-transform ${expanded ? 'rotate-180' : ''}`}>\n            â–¼\n          </span>\n        </div>\n      </button>\n\n      {/* Filters - Pro feature preview */}\n      <div className=\"px-4 py-2 border-b border-slate-700 flex gap-2 flex-wrap\">\n        <button\n          onClick={() => setFilter('ALL')}\n          className={`px-2 py-1 rounded text-xs ${\n            filter === 'ALL' ? 'bg-sky-500 text-white' : 'bg-slate-700 text-slate-300 hover:bg-slate-600'\n          }`}\n        >\n          All\n        </button>\n        {(['TFR', 'RUNWAY', 'OBSTACLE', 'AIRSPACE', 'NAVAID'] as const).map(cat => (\n          <button\n            key={cat}\n            onClick={() => {\n              if (!isPro && cat !== 'TFR' && cat !== 'RUNWAY') {\n                // Show preview mode for non-Pro\n                return;\n              }\n              setFilter(cat);\n            }}\n            disabled={!isPro && cat !== 'TFR' && cat !== 'RUNWAY'}\n            className={`px-2 py-1 rounded text-xs ${\n              filter === cat \n                ? 'bg-sky-500 text-white' \n                : isPro || cat === 'TFR' || cat === 'RUNWAY'\n                  ? 'bg-slate-700 text-slate-300 hover:bg-slate-600'\n                  : 'bg-slate-700/50 text-slate-500 cursor-not-allowed'\n            }`}\n          >\n            {cat === 'TFR' ? 'ðŸ”´' : cat === 'RUNWAY' ? 'ðŸŸ¡' : cat === 'OBSTACLE' ? 'ðŸŸ ' : cat === 'AIRSPACE' ? 'ðŸ”µ' : 'âšª'} {cat}\n            {!isPro && cat !== 'TFR' && cat !== 'RUNWAY' && ' ðŸ”’'}\n          </button>\n        ))}\n      </div>\n\n      {/* Content */}\n      {expanded && (\n        <div className=\"p-4 max-h-96 overflow-y-auto\">\n          {loading && notams.length === 0 && (\n            <div className=\"text-center text-slate-400 py-4\">\n              Loading NOTAMs...\n            </div>\n          )}\n\n          {error && (\n            <div className=\"text-center text-red-400 py-4\">\n              {error}\n            </div>\n          )}\n\n          {!loading && !error && filteredNotams.length === 0 && (\n            <div className=\"text-center text-slate-400 py-4\">\n              No {filter === 'ALL' ? '' : filter.toLowerCase()} NOTAMs found\n            </div>\n          )}\n\n          {/* Show preview warning for non-Pro */}\n          {!isPro && notams.length > 3 && filter === 'ALL' && (\n            <div className=\"mb-4 p-2 bg-purple-500/20 border border-purple-500/30 rounded text-xs text-purple-300\">\n              ðŸ”’ Pro: Filter & sort NOTAMs â€¢ {notams.length - 3} more available\n            </div>\n          )}\n\n          {/* NOTAM List */}\n          {filteredNotams.slice(0, isPro ? undefined : 3).map((notam, idx) => {\n            const colors = categoryColors[notam.category];\n            return (\n              <div\n                key={notam.id || idx}\n                className={`mb-3 p-3 rounded-lg ${colors.bg} border border-slate-600`}\n              >\n                <div className=\"flex items-start gap-2\">\n                  <span className=\"text-lg\">{colors.icon}</span>\n                  <div className=\"flex-1 min-w-0\">\n                    <div className=\"flex items-center gap-2\">\n                      <span className={`font-medium ${colors.text}`}>\n                        {notam.category}\n                      </span>\n                      <span className=\"text-slate-400 text-sm\">\n                        {notam.icao}\n                      </span>\n                    </div>\n                    <div className=\"text-sm text-slate-200 mt-1\">\n                      {notam.title || notam.description.substring(0, 60)}\n                    </div>\n                    {notam.description && (\n                      <details className=\"mt-2\">\n                        <summary className=\"text-xs text-slate-400 cursor-pointer hover:text-slate-300\">\n                          Show more\n                        </summary>\n                        <p className=\"text-xs text-slate-300 mt-1 font-mono whitespace-pre-wrap\">\n                          {notam.description}\n                        </p>\n                      </details>\n                    )}\n                    <div className=\"flex gap-4 mt-2 text-xs text-slate-400\">\n                      {notam.startDate && (\n                        <span>From: {formatDate(notam.startDate)}</span>\n                      )}\n                      {notam.endDate && (\n                        <span>Until: {formatDate(notam.endDate)}</span>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              </div>\n            );\n          })}\n\n          {/* Load more for Pro */}\n          {isPro && filteredNotams.length > 10 && (\n            <div className=\"text-center text-slate-400 text-sm py-2\">\n              Showing 10 of {filteredNotams.length} NOTAMs\n            </div>\n          )}\n\n          {/* Last updated */}\n          {lastFetched && (\n            <div className=\"text-xs text-slate-500 text-center mt-4\">\n              Last updated: {lastFetched.toLocaleTimeString()}\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\fuel-saver\\components\\TripFinder.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'fetchFuelPrice' is defined but never used.","line":26,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":26,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'onClearWaypoints' is defined but never used.","line":54,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":54,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setIsOpen' is assigned a value but never used.","line":56,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":56,"endColumn":27},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":72,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2012,2015],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2012,2015],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'gs' is assigned a value but never used.","line":106,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":106,"endColumn":13},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":112,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":112,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3323,3326],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3323,3326],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'gs' is assigned a value but never used.","line":203,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":203,"endColumn":13},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":215,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":215,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7062,7065],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7062,7065],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":283,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":283,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9767,9770],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9767,9770],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":284,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":284,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9800,9803],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9800,9803],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":284,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":284,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9808,9811],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9808,9811],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":287,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":287,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9926,9929],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9926,9929],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'hasValidRoute' is assigned a value but never used.","line":329,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":329,"endColumn":22},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":495,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":495,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18660,18663],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18660,18663],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":571,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":571,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22384,22387],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22384,22387],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useMemo } from 'react';\nimport { Airport } from '../page';\n\ninterface TripFinderProps {\n  airports: Airport[];\n  waypoints: {\n    icao: string;\n    latitude: number;\n    longitude: number;\n    name?: string;\n  }[];\n  aircraft?: {\n    name: string;\n    speed: number;\n    burnRate: number;\n    fuelCapacity: number;\n  };\n  fuelPrices: Record<string, { price100ll: number | null }>;\n  onAddWaypoint: (airport: Airport) => void;\n  onClearWaypoints?: () => void;\n}\n\n// Fetch fuel price for an airport\nasync function fetchFuelPrice(icao: string): Promise<number | null> {\n  try {\n    const res = await fetch(`/api/fuel?icao=${icao}`);\n    if (res.ok) {\n      const data = await res.json();\n      return data.average?.['100LL'] ? parseFloat(data.average['100LL']) : null;\n    }\n  } catch { /* ignore */ }\n  return null;\n}\n\n// Airport size classifications\nconst AIRPORT_SIZES = {\n  large: { label: 'ðŸ™ï¸ Large', fee: 75 },\n  medium: { label: 'ðŸ˜ï¸ Medium', fee: 35 },\n  small: { label: 'ðŸšï¸ Small', fee: 15 }\n};\n\ntype AirportSize = 'large' | 'medium' | 'small';\ntype TimeMode = 'per_leg' | 'per_day';\ntype FinderMode = 'plan' | 'find' | 'cheapest';\n\nexport default function TripFinder({\n  airports,\n  waypoints,\n  aircraft,\n  fuelPrices,\n  onAddWaypoint,\n  onClearWaypoints\n}: TripFinderProps) {\n  const [isOpen, setIsOpen] = useState(true);\n  const [mode, setMode] = useState<FinderMode>('plan');\n  \n  // Plan mode settings\n  const [maxHours, setMaxHours] = useState(4);\n  const [timeMode, setTimeMode] = useState<TimeMode>('per_leg');\n  const [airportSize, setAirportSize] = useState<AirportSize>('medium');\n  \n  // Find mode settings\n  const [findBudget, setFindBudget] = useState(150);\n  const [findMaxHours, setFindMaxHours] = useState(2);\n  \n  // Cheapest mode settings\n  const [maxDetour, setMaxDetour] = useState(30); // max nm off route\n  const [fuelPriceThreshold, setFuelPriceThreshold] = useState(0.50); // save at least this much\n  \n  const [results, setResults] = useState<any[]>([]);\n  const [isCalculating, setIsCalculating] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  // ==================== PLAN MODE ====================\n  const tripStats = useMemo(() => {\n    if (waypoints.length < 2 || !aircraft) return null;\n    \n    let totalDist = 0;\n    for (let i = 1; i < waypoints.length; i++) {\n      totalDist += calculateDistance(\n        waypoints[i-1].latitude, waypoints[i-1].longitude,\n        waypoints[i].latitude, waypoints[i].longitude\n      );\n    }\n    \n    const gs = aircraft.speed * 0.8;\n    const totalTime = totalDist / gs;\n    const fuelNeeded = (totalDist / aircraft.speed) * aircraft.burnRate * 1.25;\n    \n    return {\n      totalDistance: totalDist,\n      totalTime,\n      fuelNeeded,\n      legsNeeded: Math.ceil(totalTime / maxHours)\n    };\n  }, [waypoints, aircraft, maxHours]);\n\n  const handlePlanTrip = () => {\n    if (!aircraft || waypoints.length < 2 || !tripStats) return;\n    \n    setIsCalculating(true);\n    setError(null);\n    \n    const gs = aircraft.speed * 0.8;\n    const departure = waypoints[0];\n    const arrival = waypoints[waypoints.length - 1];\n    const stopsNeeded = Math.ceil(tripStats.totalTime / maxHours);\n    const depFuelPrice = fuelPrices[departure.icao]?.price100ll || 6.50;\n    \n    const stops: any[] = [];\n    \n    for (let stopNum = 1; stopNum <= stopsNeeded; stopNum++) {\n      const fraction = stopNum / (stopsNeeded + 1);\n      const routeLat = departure.latitude + (arrival.latitude - departure.latitude) * fraction;\n      const routeLon = departure.longitude + (arrival.longitude - departure.longitude) * fraction;\n      \n      const candidates = airports\n        .filter(a => {\n          if (a.icao === departure.icao || a.icao === arrival.icao) return false;\n          if (!a.latitude || !a.longitude) return false;\n          if (airportSize === 'large' && a.type !== 'large_airport') return false;\n          if (airportSize === 'medium' && a.type === 'small_airport') return false;\n          return true;\n        })\n        .map(a => ({\n          airport: a,\n          distFromRoute: calculateDistance(routeLat, routeLon, a.latitude, a.longitude)\n        }))\n        .filter(a => a.distFromRoute < 30)\n        .sort((a, b) => a.distFromRoute - b.distFromRoute)\n        .slice(0, 5);\n      \n      if (candidates.length > 0) {\n        const best = candidates[0];\n        const fuelPrice = fuelPrices[best.airport.icao]?.price100ll || depFuelPrice;\n        const fuelForLeg = (best.distFromRoute / aircraft.speed) * aircraft.burnRate * 1.25;\n        \n        stops.push({\n          airport: best.airport,\n          distanceFromPrevious: best.distFromRoute,\n          fuelCost: fuelForLeg * fuelPrice,\n          landingFee: AIRPORT_SIZES[airportSize].fee\n        });\n      }\n    }\n    \n    setResults(stops);\n    setIsCalculating(false);\n  };\n\n  // ==================== FIND MODE ====================\n  const handleFindDestinations = () => {\n    if (!aircraft || !waypoints[0]) return;\n    \n    setIsCalculating(true);\n    setError(null);\n    \n    const departure = waypoints[0];\n    const gs = aircraft.speed * 0.8;\n    const maxDist = findMaxHours * gs;\n    const depFuelPrice = fuelPrices[departure.icao]?.price100ll || 6.50;\n    \n    const destinations = airports\n      .filter(a => a.icao !== departure.icao && a.latitude && a.longitude)\n      .map(airport => {\n        const dist = calculateDistance(\n          departure.latitude, departure.longitude,\n          airport.latitude, airport.longitude\n        );\n        const fuelNeeded = (dist / aircraft.speed) * aircraft.burnRate * 1.25;\n        const fuelCost = fuelNeeded * (fuelPrices[airport.icao]?.price100ll || depFuelPrice);\n        const landingFee = AIRPORT_SIZES.medium.fee;\n        \n        return {\n          airport,\n          distance: dist,\n          timeHours: dist / gs,\n          fuelCost,\n          landingFee,\n          totalCost: fuelCost + landingFee\n        };\n      })\n      .filter(d => d.distance <= maxDist * 1.1)\n      .filter(d => d.totalCost <= findBudget * 1.2)\n      .sort((a, b) => a.totalCost - b.totalCost)\n      .slice(0, 15);\n    \n    setResults(destinations);\n    setIsCalculating(false);\n  };\n\n  // ==================== CHEAPEST MODE ====================\n  const handleFindCheapestFuel = async () => {\n    if (!aircraft || waypoints.length < 2) return;\n    \n    setIsCalculating(true);\n    setError(null);\n    \n    const departure = waypoints[0];\n    const arrival = waypoints[waypoints.length - 1];\n    const gs = aircraft.speed * 0.8;\n    const depFuelPrice = fuelPrices[departure.icao]?.price100ll || 6.50;\n    \n    // Calculate direct route distance\n    const directDistance = calculateDistance(\n      departure.latitude, departure.longitude,\n      arrival.latitude, arrival.longitude\n    );\n    const directFuelNeeded = (directDistance / aircraft.speed) * aircraft.burnRate * 1.25;\n    const directFuelCost = directFuelNeeded * depFuelPrice;\n    \n    // Find all airports within maxDetour of the route\n    const candidateStops: any[] = [];\n    \n    // Sample points along the route\n    const samplePoints = 10;\n    for (let i = 1; i < samplePoints; i++) {\n      const fraction = i / samplePoints;\n      const routeLat = departure.latitude + (arrival.latitude - departure.latitude) * fraction;\n      const routeLon = departure.longitude + (arrival.longitude - departure.longitude) * fraction;\n      \n      // Find airports near this point\n      airports\n        .filter(a => {\n          if (a.icao === departure.icao || a.icao === arrival.icao) return false;\n          if (!a.latitude || !a.longitude) return false;\n          return true;\n        })\n        .forEach(airport => {\n          const distFromRoute = calculateDistance(routeLat, routeLon, airport.latitude, airport.longitude);\n          if (distFromRoute <= maxDetour) {\n            // Try to get fuel price from prop, or fetch it\n            let fuelPrice = fuelPrices[airport.icao]?.price100ll;\n            \n            // Check if we already have this price cached\n            const cached = localStorage.getItem(`fuel_${airport.icao}`);\n            if (!fuelPrice && cached) {\n              fuelPrice = JSON.parse(cached).price100ll;\n            }\n            \n            if (fuelPrice) {\n              candidateStops.push({\n                airport,\n                detourDistance: distFromRoute,\n                fuelPrice\n              });\n            }\n          }\n        });\n    }\n    \n    // Find unique airports with fuel prices\n    type CandidateStop = { airport: Airport; detourDistance: number; fuelPrice: number };\n    const uniqueStops = candidateStops.reduce((acc: CandidateStop[], stop: CandidateStop) => {\n      const existing = acc.find((s: CandidateStop) => s.airport.icao === stop.airport.icao);\n      if (!existing || stop.detourDistance < existing.detourDistance) {\n        const idx = acc.findIndex((s: CandidateStop) => s.airport.icao === stop.airport.icao);\n        if (idx >= 0) acc[idx] = stop;\n        else acc.push(stop);\n      }\n      return acc;\n    }, [] as CandidateStop[]);\n    \n    // Calculate savings for each potential stop\n    const withSavings = uniqueStops.map((stop: CandidateStop) => {\n      const detourFuel = (stop.detourDistance / aircraft.speed) * aircraft.burnRate * 1.25;\n      const detourCost = detourFuel * depFuelPrice;\n      const fuelAtStop = directFuelNeeded * stop.fuelPrice;\n      \n      // Extra cost to divert vs fuel cost savings\n      const savings = (directFuelCost - fuelAtStop) - detourCost;\n      \n      return {\n        ...stop,\n        detourFuel,\n        detourCost,\n        savings,\n        worthIt: savings > fuelPriceThreshold * 10 // At least save $X to be worth it\n      };\n    })\n    .filter((s: any) => s.worthIt)\n    .sort((a: any, b: any) => b.savings - a.savings);\n    \n    // Calculate total potential savings with best stops\n    const optimalStops: any[] = [];\n    let remainingFuel = directFuelNeeded;\n    let currentPos = { lat: departure.latitude, lon: departure.longitude };\n    let totalSavings = 0;\n    \n    // Greedy: take stops that save money until no more savings\n    for (const stop of withSavings) {\n      const distToStop = calculateDistance(\n        currentPos.lat, currentPos.lon,\n        stop.airport.latitude, stop.airport.longitude\n      );\n      \n      // Check if we can reach it with remaining fuel\n      const fuelToStop = (distToStop / aircraft.speed) * aircraft.burnRate * 1.25;\n      if (fuelToStop < remainingFuel * 0.9) {\n        optimalStops.push({\n          airport: stop.airport,\n          detourDistance: stop.detourDistance,\n          fuelPrice: stop.fuelPrice,\n          savings: stop.savings,\n          fuelAtStop: directFuelNeeded * stop.fuelPrice\n        });\n        totalSavings += stop.savings;\n        remainingFuel = remainingFuel - fuelToStop + (aircraft.fuelCapacity * 0.5);\n        currentPos = { lat: stop.airport.latitude, lon: stop.airport.longitude };\n      }\n    }\n    \n    const directCost = directFuelCost + AIRPORT_SIZES.medium.fee;\n    const optimizedCost = directCost - totalSavings;\n    \n    setResults([{\n      type: 'summary',\n      directDistance,\n      directCost,\n      optimizedCost,\n      totalSavings,\n      stops: optimalStops\n    }]);\n    setIsCalculating(false);\n  };\n\n  const hasValidRoute = waypoints.length >= 2 && aircraft;\n\n  return (\n    <div className=\"bg-background border-t border-border\">\n      {/* Mode Tabs */}\n      <div className=\"flex border-b border-border\">\n        {[\n          { id: 'plan', label: 'ðŸ—ºï¸ Plan' },\n          { id: 'find', label: 'ðŸ” Find' },\n          { id: 'cheapest', label: 'â›½ Cheapest' }\n        ].map(tab => (\n          <button\n            key={tab.id}\n            onClick={() => { setMode(tab.id as FinderMode); setResults([]); }}\n            className={`flex-1 py-2 text-xs font-medium transition-colors ${\n              mode === tab.id \n                ? 'bg-secondary text-foreground' \n                : 'text-muted-foreground hover:text-foreground'\n            }`}\n          >\n            {tab.label}\n          </button>\n        ))}\n      </div>\n\n      {/* Content */}\n      {isOpen && (\n        <div className=\"p-3 space-y-3\">\n          {/* Error message */}\n          {error && (\n            <div className=\"text-red-400 text-xs bg-red-900/30 p-2 rounded\">\n              {error}\n            </div>\n          )}\n\n          {waypoints[0] && aircraft && mode === 'plan' ? (\n            // ==================== PLAN MODE ====================\n            <>\n              {tripStats && (\n                <div className=\"bg-secondary/50 rounded p-2 text-xs space-y-1\">\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-muted-foreground\">Distance:</span>\n                    <span className=\"text-foreground\">{tripStats.totalDistance.toFixed(0)} NM</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-muted-foreground\">Time:</span>\n                    <span className=\"text-foreground\">{tripStats.totalTime.toFixed(1)} hrs</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-muted-foreground\">Stops needed:</span>\n                    <span className=\"text-amber-400\">~{tripStats.legsNeeded}</span>\n                  </div>\n                </div>\n              )}\n\n              <div className=\"space-y-2\">\n                <div className=\"flex gap-1 text-xs\">\n                  <button\n                    onClick={() => setTimeMode('per_leg')}\n                    className={`flex-1 py-1.5 rounded ${timeMode === 'per_leg' ? 'bg-sky-600 text-foreground' : 'bg-secondary text-slate-300'}`}\n                  >\n                    Per Leg\n                  </button>\n                  <button\n                    onClick={() => setTimeMode('per_day')}\n                    className={`flex-1 py-1.5 rounded ${timeMode === 'per_day' ? 'bg-sky-600 text-foreground' : 'bg-secondary text-slate-300'}`}\n                  >\n                    Per Day\n                  </button>\n                </div>\n\n                <div>\n                  <label className=\"block text-xs text-muted-foreground mb-1\">Max hours</label>\n                  <input\n                    type=\"number\"\n                    value={maxHours}\n                    onChange={(e) => setMaxHours(Number(e.target.value))}\n                    min={1}\n                    max={12}\n                    className=\"w-full bg-secondary border border-border rounded px-2 py-1.5 text-foreground text-sm\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-xs text-muted-foreground mb-1\">Stop at</label>\n                  <select\n                    value={airportSize}\n                    onChange={(e) => setAirportSize(e.target.value as AirportSize)}\n                    className=\"w-full bg-secondary border border-border rounded px-2 py-1.5 text-foreground text-sm\"\n                  >\n                    <option value=\"large\">{AIRPORT_SIZES.large.label}</option>\n                    <option value=\"medium\">{AIRPORT_SIZES.medium.label}</option>\n                    <option value=\"small\">{AIRPORT_SIZES.small.label}</option>\n                  </select>\n                </div>\n\n                <button\n                  onClick={handlePlanTrip}\n                  disabled={isCalculating || waypoints.length < 2}\n                  className=\"w-full bg-sky-600 hover:bg-sky-500 disabled:bg-muted text-foreground py-2 rounded text-sm font-medium\"\n                >\n                  {isCalculating ? 'Finding...' : 'ðŸ›« Find Stops'}\n                </button>\n              </div>\n\n              {results.length > 0 && (\n                <div className=\"space-y-2\">\n                  {results.map((stop, i) => (\n                    <button\n                      key={i}\n                      onClick={() => onAddWaypoint(stop.airport)}\n                      className=\"w-full bg-secondary hover:bg-slate-600 rounded p-2 text-left\"\n                    >\n                      <div className=\"flex justify-between items-center\">\n                        <div>\n                          <span className=\"font-medium text-foreground\">{stop.airport.icao}</span>\n                          <span className=\"text-muted-foreground ml-2 text-xs\">{stop.airport.name?.substring(0, 15)}</span>\n                        </div>\n                        <div className=\"text-right text-xs\">\n                          <div className=\"text-muted-foreground\">{stop.distanceFromPrevious.toFixed(0)} NM</div>\n                          <div className=\"text-amber-400\">${(stop.fuelCost + stop.landingFee).toFixed(0)}</div>\n                        </div>\n                      </div>\n                    </button>\n                  ))}\n                </div>\n              )}\n            </>\n          ) : mode === 'find' ? (\n            // ==================== FIND MODE ====================\n            <>\n              <div className=\"space-y-2\">\n                <div>\n                  <label className=\"block text-xs text-muted-foreground mb-1\">Budget ($)</label>\n                  <input\n                    type=\"number\"\n                    value={findBudget}\n                    onChange={(e) => setFindBudget(Number(e.target.value))}\n                    min={50}\n                    className=\"w-full bg-secondary border border-border rounded px-2 py-1.5 text-foreground text-sm\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-xs text-muted-foreground mb-1\">Max hours</label>\n                  <input\n                    type=\"number\"\n                    value={findMaxHours}\n                    onChange={(e) => setFindMaxHours(Number(e.target.value))}\n                    min={0.5}\n                    step={0.5}\n                    className=\"w-full bg-secondary border border-border rounded px-2 py-1.5 text-foreground text-sm\"\n                  />\n                </div>\n\n                <button\n                  onClick={handleFindDestinations}\n                  disabled={isCalculating}\n                  className=\"w-full bg-sky-600 hover:bg-sky-500 disabled:bg-muted text-foreground py-2 rounded text-sm font-medium\"\n                >\n                  {isCalculating ? 'Searching...' : 'ðŸ” Find Destinations'}\n                </button>\n              </div>\n\n              {results.length > 0 && (\n                <div className=\"space-y-2 max-h-48 overflow-y-auto\">\n                  {results.map((r: any, i: number) => (\n                    <button\n                      key={i}\n                      onClick={() => onAddWaypoint(r.airport)}\n                      className=\"w-full bg-secondary hover:bg-slate-600 rounded p-2 text-left\"\n                    >\n                      <div className=\"flex justify-between\">\n                        <div>\n                          <span className=\"font-medium text-foreground\">{r.airport.icao}</span>\n                          <span className=\"text-muted-foreground ml-2 text-xs\">{r.airport.name?.substring(0, 12)}</span>\n                        </div>\n                        <div className=\"text-right\">\n                          <div className=\"text-amber-400\">${r.totalCost.toFixed(0)}</div>\n                          <div className=\"text-muted-foreground text-xs\">{r.distance.toFixed(0)} NM</div>\n                        </div>\n                      </div>\n                    </button>\n                  ))}\n                </div>\n              )}\n            </>\n          ) : mode === 'cheapest' ? (\n            // ==================== CHEAPEST MODE ====================\n            <>\n              <div className=\"text-xs text-muted-foreground bg-secondary/50 rounded p-2\">\n                Find cheapest fuel stops, even if it means a slight detour. Optimizes total trip cost.\n              </div>\n\n              <div className=\"space-y-2\">\n                <div>\n                  <label className=\"block text-xs text-muted-foreground mb-1\">Max detour (NM)</label>\n                  <input\n                    type=\"number\"\n                    value={maxDetour}\n                    onChange={(e) => setMaxDetour(Number(e.target.value))}\n                    min={5}\n                    max={50}\n                    className=\"w-full bg-secondary border border-border rounded px-2 py-1.5 text-foreground text-sm\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-xs text-muted-foreground mb-1\">Min savings to worth it ($)</label>\n                  <input\n                    type=\"number\"\n                    value={fuelPriceThreshold}\n                    onChange={(e) => setFuelPriceThreshold(Number(e.target.value))}\n                    min={5}\n                    max={100}\n                    className=\"w-full bg-secondary border border-border rounded px-2 py-1.5 text-foreground text-sm\"\n                  />\n                </div>\n\n                <button\n                  onClick={handleFindCheapestFuel}\n                  disabled={isCalculating || waypoints.length < 2}\n                  className=\"w-full bg-emerald-600 hover:bg-emerald-500 disabled:bg-muted text-foreground py-2 rounded text-sm font-medium\"\n                >\n                  {isCalculating ? 'Optimizing...' : 'â›½ Find Cheapest Fuel'}\n                </button>\n              </div>\n\n              {results.length > 0 && results[0]?.type === 'summary' && (\n                <div className=\"space-y-2\">\n                  <div className=\"bg-emerald-900/30 border border-emerald-700 rounded p-2 text-center\">\n                    <div className=\"text-emerald-400 font-bold text-lg\">\n                      Save ${results[0].totalSavings.toFixed(0)}\n                    </div>\n                    <div className=\"text-muted-foreground text-xs\">\n                      Direct: ${results[0].directCost.toFixed(0)} â†’ Optimized: ${results[0].optimizedCost.toFixed(0)}\n                    </div>\n                  </div>\n\n                  {results[0].stops.length > 0 ? (\n                    <>\n                      <div className=\"text-xs text-muted-foreground\">Suggested stops:</div>\n                      {results[0].stops.map((stop: any, i: number) => (\n                        <button\n                          key={i}\n                          onClick={() => onAddWaypoint(stop.airport)}\n                          className=\"w-full bg-secondary hover:bg-slate-600 rounded p-2 text-left\"\n                        >\n                          <div className=\"flex justify-between items-center\">\n                            <div>\n                              <span className=\"font-medium text-foreground\">{stop.airport.icao}</span>\n                              <span className=\"text-muted-foreground ml-2 text-xs\">${stop.fuelPrice.toFixed(2)}/gal</span>\n                            </div>\n                            <div className=\"text-right text-xs\">\n                              <div className=\"text-emerald-400\">Save ${stop.savings.toFixed(0)}</div>\n                              <div className=\"text-muted-foreground\">+{stop.detourDistance.toFixed(0)} NM</div>\n                            </div>\n                          </div>\n                        </button>\n                      ))}\n                    </>\n                  ) : (\n                    <div className=\"text-center py-2 text-muted-foreground text-xs\">\n                      No cheaper fuel stops found on this route\n                    </div>\n                  )}\n                </div>\n              )}\n            </>\n          ) : null}\n        </div>\n      )}\n    </div>\n  );\n}\n\n// Haversine distance\nfunction calculateDistance(lat1: number, lon1: number, lat2: number, lon2: number): number {\n  const R = 3440.065;\n  const dLat = (lat2 - lat1) * Math.PI / 180;\n  const dLon = (lon2 - lon1) * Math.PI / 180;\n  const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *\n    Math.sin(dLon / 2) * Math.sin(dLon / 2);\n  return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\fuel-saver\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\fuel-saver\\lib\\exportUtils.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'filename' is assigned a value but never used.","line":673,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":673,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":795,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":795,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25144,25147],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25144,25147],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Magnetic variation utility\n */\nimport { calculateMagneticVariation, trueToMagnetic } from './magneticVariation';\nimport jsPDF from 'jspdf';\nimport autoTable from 'jspdf-autotable';\n\n/**\n * Calculate great circle distance in nautical miles\n */\nfunction calculateDistance(lat1: number, lon1: number, lat2: number, lon2: number): number {\n  const R = 3440.065; // Earth radius in NM\n  const dLat = (lat2 - lat1) * Math.PI / 180;\n  const dLon = (lon2 - lon1) * Math.PI / 180;\n  const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *\n    Math.sin(dLon / 2) * Math.sin(dLon / 2);\n  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n  return R * c;\n}\n\n/*\n * GPX Export - Generate GPX 1.1 format for flight plans\n * Compatible with ForeFlight, Garmin Pilot, SkyDemon, OpenCPN, etc.\n */\n\nexport interface Waypoint {\n  icao: string;\n  name?: string;\n  latitude: number;\n  longitude: number;\n}\n\nexport interface FlightPlanData {\n  name?: string;\n  waypoints: Waypoint[];\n  aircraftType?: string;\n  cruisingAltitude?: number;\n  departureTime?: string;\n  fuelCapacity?: number;\n  fuelBurnRate?: number;\n}\n\nexport function generateGPX(plan: FlightPlanData): string {\n  const { name = 'Flight Plan', waypoints, aircraftType, cruisingAltitude } = plan;\n  \n  const gpxHeader = `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<gpx version=\"1.1\" \n     creator=\"FuelSaver - Flight Planning Tool\"\n     xmlns=\"http://www.topografix.com/GPX/1/1\"\n     xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n     xsi:schemaLocation=\"http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd\">\n  <metadata>\n    <name>${escapeXML(name)}</name>\n    <desc>Flight plan created with FuelSaver</desc>\n    <time>${new Date().toISOString()}</time>\n  </metadata>\n  <rte>\n    <name>${escapeXML(name)}</name>`;\n  \n  const gpxFooter = `\n  </rte>\n</gpx>`;\n  \n  const routePoints = waypoints.map((wp, idx) => {\n    const isDeparture = idx === 0;\n    const isArrival = idx === waypoints.length - 1;\n    let type = 'AIRPORT';\n    \n    if (isDeparture) type = 'DEPARTURE';\n    else if (isArrival) type = 'ARRIVAL';\n    else type = 'WAYPOINT';\n    \n    return `\n    <rtept lat=\"${wp.latitude.toFixed(6)}\" lon=\"${wp.longitude.toFixed(6)}\">\n      <name>${escapeXML(wp.icao)}</name>\n      <type>${type}</type>\n      <extensions>\n        <waypointType>${type}</waypointType>\n        ${wp.name ? `<waypointName>${escapeXML(wp.name)}</waypointName>` : ''}\n        ${aircraftType ? `<aircraftType>${escapeXML(aircraftType)}</aircraftType>` : ''}\n        ${cruisingAltitude ? `<cruisingAltitude>${cruisingAltitude}</cruisingAltitude>` : ''}\n      </extensions>\n    </rtept>`;\n  }).join('');\n  \n  return gpxHeader + routePoints + gpxFooter;\n}\n\nexport function downloadGPX(plan: FlightPlanData): void {\n  const gpx = generateGPX(plan);\n  const filename = (plan.name || 'flight-plan').replace(/[^a-z0-9]/gi, '-').toLowerCase();\n  \n  downloadFile(gpx, `${filename}.gpx`, 'application/gpx+xml');\n}\n\n/**\n * FPL Format - Simple text format for Garmin 430/530/G1000\n * One ICAO code per line\n */\nexport function generateFPL(waypoints: Waypoint[]): string {\n  return waypoints.map(wp => wp.icao).join('\\n');\n}\n\nexport function downloadFPL(waypoints: Waypoint[]): void {\n  const fpl = generateFPL(waypoints);\n  const filename = 'flight-plan';\n  \n  downloadFile(fpl, `${filename}.fpl`, 'text/plain');\n}\n\n/**\n * JSON Export - Full flight plan data\n */\nexport function downloadJSON(plan: FlightPlanData): void {\n  const json = JSON.stringify(plan, null, 2);\n  const filename = (plan.name || 'flight-plan').replace(/[^a-z0-9]/gi, '-').toLowerCase();\n  \n  downloadFile(json, `${filename}.json`, 'application/json');\n}\n\n// Helper function to escape XML special characters\nfunction escapeXML(str: string): string {\n  return str\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&apos;');\n}\n\n// Helper function to trigger file download\nfunction downloadFile(content: string, filename: string, mimeType: string): void {\n  const blob = new Blob([content], { type: mimeType });\n  const url = URL.createObjectURL(blob);\n  \n  const a = document.createElement('a');\n  a.href = url;\n  a.download = filename;\n  a.style.display = 'none';\n  \n  document.body.appendChild(a);\n  a.click();\n  \n  // Clean up\n  setTimeout(() => {\n    document.body.removeChild(a);\n    URL.revokeObjectURL(url);\n  }, 100);\n}\n\n// ============================================\n// NAV LOG EXPORT\n// ============================================\n\nexport interface NavLogLeg {\n  from: Waypoint;\n  to: Waypoint;\n  course: number;           // True course (degrees)\n  distance: number;         // Nautical miles\n  tas: number;              // True airspeed (knots)\n  windDirection: number;    // Wind from direction (degrees)\n  windSpeed: number;        // Wind speed (knots)\n  groundspeed: number;      // Groundspeed (knots)\n  windCorrection: number;   // Wind correction angle (degrees)\n  magneticVariation: number; // Magnetic variation at midpoint (degrees)\n  trueHeading: number;      // True heading\n  magneticHeading: number;  // Magnetic heading\n  time: number;             // Time enroute (minutes)\n  fuelNeeded: number;       // Fuel needed (gallons)\n  fuelWithReserves: number; // Fuel with 25% reserves\n  cost: number;             // Cost for this leg\n}\n\nexport interface NavLogData {\n  name?: string;\n  aircraft: string;\n  departure: string;\n  arrival: string;\n  cruisingAltitude: number;\n  date: string;\n  legs: NavLogLeg[];\n  totalDistance: number;\n  totalTime: number;\n  totalFuel: number;\n  totalCost: number;\n}\n\nexport interface StoredNavLogExport {\n  id: string;\n  name: string;\n  createdAt: string;\n  detailed: boolean;\n  navLogData: NavLogData;\n}\n\nconst NAV_LOG_EXPORTS_KEY = 'navLogExports';\n\n/**\n * Calculate great circle true course between two points\n */\nfunction calculateTrueCourse(lat1: number, lon1: number, lat2: number, lon2: number): number {\n  const dLon = ((lon2 - lon1) * Math.PI) / 180;\n  const lat1Rad = (lat1 * Math.PI) / 180;\n  const lat2Rad = (lat2 * Math.PI) / 180;\n  \n  const x = Math.sin(dLon) * Math.cos(lat2Rad);\n  const y = Math.cos(lat1Rad) * Math.sin(lat2Rad) - Math.sin(lat1Rad) * Math.cos(lat2Rad) * Math.cos(dLon);\n  \n  let course = (Math.atan2(x, y) * 180) / Math.PI;\n  course = ((course % 360) + 360) % 360; // Normalize to 0-360\n  return Math.round(course);\n}\n\n/**\n * Calculate wind correction angle and groundspeed using E6B formula\n */\nfunction calculateWindEffect(\n  trueCourse: number,\n  tas: number,\n  windDirection: number,\n  windSpeed: number\n): { groundspeed: number; windCorrection: number } {\n  const headingRad = (trueCourse * Math.PI) / 180;\n  const windRad = (windDirection * Math.PI) / 180;\n  \n  // Wind components (wind FROM direction)\n  const wx = windSpeed * Math.cos(windRad + Math.PI);\n  const wy = windSpeed * Math.sin(windRad + Math.PI);\n  \n  // Ground speed vector\n  const gsx = tas * Math.cos(headingRad) - wx;\n  const gsy = tas * Math.sin(headingRad) - wy;\n  \n  const groundspeed = Math.sqrt(gsx * gsx + gsy * gsy);\n  const track = ((Math.atan2(gsy, gsx) * 180) / Math.PI + 360) % 360;\n  const windCorrection = track - trueCourse;\n  \n  return {\n    groundspeed: Math.round(groundspeed),\n    windCorrection: Math.round(windCorrection)\n  };\n}\n\n/**\n * Generate Basic Nav Log (simple format)\n */\nexport function generateBasicNavLog(data: NavLogData): string {\n  const { name, aircraft, departure, arrival, date, legs, totalDistance, totalTime, totalFuel, totalCost } = data;\n  \n  const html = `\n<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"UTF-8\">\n  <title>Nav Log - ${name || 'Flight Plan'}</title>\n  <style>\n    @media print {\n      body { font-size: 10pt; }\n      .page-break { page-break-before: always; }\n    }\n    body { \n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      font-size: 11pt;\n      line-height: 1.3;\n      max-width: 800px;\n      margin: 0 auto;\n      padding: 20px;\n      color: #333;\n    }\n    h1 { font-size: 18pt; margin-bottom: 5px; }\n    .header { margin-bottom: 20px; border-bottom: 2px solid #333; padding-bottom: 10px; }\n    .meta { display: flex; gap: 30px; flex-wrap: wrap; font-size: 10pt; color: #666; }\n    .meta-item { }\n    .meta-label { font-weight: bold; color: #333; }\n    table { \n      width: 100%; \n      border-collapse: collapse; \n      margin-top: 15px;\n      font-size: 10pt;\n    }\n    th, td { \n      border: 1px solid #ddd; \n      padding: 6px 8px; \n      text-align: center;\n    }\n    th { background: #f5f5f5; font-weight: bold; }\n    .waypoint-col { text-align: left; }\n    .total-row { background: #f9f9f9; font-weight: bold; }\n    .summary { \n      margin-top: 20px; \n      padding: 15px; \n      background: #f5f5f5; \n      border-radius: 5px;\n      display: flex;\n      gap: 40px;\n      flex-wrap: wrap;\n    }\n    .summary-item { }\n    .summary-value { font-size: 16pt; font-weight: bold; color: #333; }\n    .summary-label { font-size: 9pt; color: #666; text-transform: uppercase; }\n    .footer { \n      margin-top: 30px; \n      font-size: 9pt; \n      color: #999; \n      text-align: center;\n      border-top: 1px solid #eee;\n      padding-top: 10px;\n    }\n  </style>\n</head>\n<body>\n  <div class=\"header\">\n    <h1>${name || 'Flight Plan'}</h1>\n    <div class=\"meta\">\n      <div class=\"meta-item\"><span class=\"meta-label\">Aircraft:</span> ${aircraft}</div>\n      <div class=\"meta-item\"><span class=\"meta-label\">Departure:</span> ${departure}</div>\n      <div class=\"meta-item\"><span class=\"meta-label\">Arrival:</span> ${arrival}</div>\n      <div class=\"meta-item\"><span class=\"meta-label\">Date:</span> ${date}</div>\n    </div>\n  </div>\n\n  <table>\n    <thead>\n      <tr>\n        <th>From</th>\n        <th>To</th>\n        <th>Course</th>\n        <th>Dist</th>\n        <th>Time</th>\n        <th>Fuel</th>\n        <th>Cost</th>\n      </tr>\n    </thead>\n    <tbody>\n      ${legs.map(leg => `\n        <tr>\n          <td class=\"waypoint-col\"><strong>${leg.from.icao}</strong><br><small>${leg.from.name || ''}</small></td>\n          <td class=\"waypoint-col\"><strong>${leg.to.icao}</strong><br><small>${leg.to.name || ''}</small></td>\n          <td>${leg.trueHeading}Â°</td>\n          <td>${leg.distance} NM</td>\n          <td>${Math.floor(leg.time)}:${((leg.time % 1) * 60).toFixed(0).padStart(2, '0')}</td>\n          <td>${leg.fuelWithReserves.toFixed(1)} gal</td>\n          <td>$${leg.cost.toFixed(0)}</td>\n        </tr>\n      `).join('')}\n      <tr class=\"total-row\">\n        <td colspan=\"2\"><strong>TOTAL</strong></td>\n        <td></td>\n        <td><strong>${totalDistance} NM</strong></td>\n        <td><strong>${Math.floor(totalTime)}:${((totalTime % 1) * 60).toFixed(0).padStart(2, '0')}</strong></td>\n        <td><strong>${totalFuel.toFixed(1)} gal</strong></td>\n        <td><strong>$${totalCost.toFixed(0)}</strong></td>\n      </tr>\n    </tbody>\n  </table>\n\n  <div class=\"summary\">\n    <div class=\"summary-item\">\n      <div class=\"summary-value\">${totalDistance}</div>\n      <div class=\"summary-label\">Total Distance (NM)</div>\n    </div>\n    <div class=\"summary-item\">\n      <div class=\"summary-value\">${Math.floor(totalTime)}h ${((totalTime % 1) * 60).toFixed(0)}m</div>\n      <div class=\"summary-label\">Estimated Time</div>\n    </div>\n    <div class=\"summary-item\">\n      <div class=\"summary-value\">${totalFuel.toFixed(1)}</div>\n      <div class=\"summary-label\">Fuel Required (gal)</div>\n    </div>\n    <div class=\"summary-item\">\n      <div class=\"summary-value\">$${totalCost.toFixed(0)}</div>\n      <div class=\"summary-label\">Estimated Cost</div>\n    </div>\n  </div>\n\n  <div class=\"footer\">\n    Generated by FuelSaver - Flight Planning Tool<br>\n    For planning purposes only. Not for navigation.\n  </div>\n</body>\n</html>\n  `.trim();\n  \n  return html;\n}\n\n/**\n * Generate Detailed Nav Log (comprehensive format)\n */\nexport function generateDetailedNavLog(data: NavLogData): string {\n  const { name, aircraft, departure, arrival, date, legs, totalDistance, totalTime, totalFuel, totalCost } = data;\n  \n  const html = `\n<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"UTF-8\">\n  <title>Nav Log - ${name || 'Flight Plan'} (Detailed)</title>\n  <style>\n    @media print {\n      body { font-size: 9pt; }\n      .page-break { page-break-before: always; }\n    }\n    body { \n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      font-size: 10pt;\n      line-height: 1.3;\n      max-width: 900px;\n      margin: 0 auto;\n      padding: 15px;\n      color: #333;\n    }\n    h1 { font-size: 16pt; margin-bottom: 5px; }\n    .header { margin-bottom: 15px; border-bottom: 2px solid #333; padding-bottom: 10px; }\n    .meta { display: flex; gap: 25px; flex-wrap: wrap; font-size: 9pt; color: #666; }\n    .meta-item { }\n    .meta-label { font-weight: bold; color: #333; }\n    table { \n      width: 100%; \n      border-collapse: collapse; \n      margin-top: 12px;\n      font-size: 9pt;\n    }\n    th, td { \n      border: 1px solid #ddd; \n      padding: 4px 6px; \n      text-align: center;\n    }\n    th { background: #f0f0f0; font-weight: bold; font-size: 8pt; }\n    .waypoint-col { text-align: left; }\n    .small { font-size: 8pt; color: #666; }\n    .total-row { background: #f5f5f5; font-weight: bold; }\n    .summary { \n      margin-top: 15px; \n      padding: 12px; \n      background: #f5f5f5; \n      border-radius: 5px;\n      display: flex;\n      gap: 30px;\n      flex-wrap: wrap;\n    }\n    .summary-item { }\n    .summary-value { font-size: 14pt; font-weight: bold; color: #333; }\n    .summary-label { font-size: 8pt; color: #666; text-transform: uppercase; }\n    .footer { \n      margin-top: 20px; \n      font-size: 8pt; \n      color: #999; \n      text-align: center;\n      border-top: 1px solid #eee;\n      padding-top: 8px;\n    }\n    .wind-info { font-size: 8pt; color: #888; }\n  </style>\n</head>\n<body>\n  <div class=\"header\">\n    <h1>${name || 'Flight Plan'} - Detailed Nav Log</h1>\n    <div class=\"meta\">\n      <div class=\"meta-item\"><span class=\"meta-label\">Aircraft:</span> ${aircraft}</div>\n      <div class=\"meta-item\"><span class=\"meta-label\">Departure:</span> ${departure}</div>\n      <div class=\"meta-item\"><span class=\"meta-label\">Arrival:</span> ${arrival}</div>\n      <div class=\"meta-item\"><span class=\"meta-label\">Alt:</span> ${data.cruisingAltitude}ft</div>\n      <div class=\"meta-item\"><span class=\"meta-label\">Date:</span> ${date}</div>\n    </div>\n  </div>\n\n  <table>\n    <thead>\n      <tr>\n        <th rowspan=\"2\">From</th>\n        <th rowspan=\"2\">To</th>\n        <th colspan=\"3\">Course (Â°)</th>\n        <th colspan=\"2\">Speed (kts)</th>\n        <th rowspan=\"2\">Dist</th>\n        <th rowspan=\"2\">Time</th>\n        <th colspan=\"2\">Fuel (gal)</th>\n        <th rowspan=\"2\">Wind</th>\n        <th rowspan=\"2\">Cost</th>\n      </tr>\n      <tr>\n        <th>True</th>\n        <th>Mag Var</th>\n        <th>Mag</th>\n        <th>TAS</th>\n        <th>GS</th>\n        <th>Burn</th>\n        <th>+Res</th>\n      </tr>\n    </thead>\n    <tbody>\n      ${legs.map(leg => `\n        <tr>\n          <td class=\"waypoint-col\"><strong>${leg.from.icao}</strong><br><span class=\"small\">${(leg.from.name || '').substring(0, 20)}</span></td>\n          <td class=\"waypoint-col\"><strong>${leg.to.icao}</strong><br><span class=\"small\">${(leg.to.name || '').substring(0, 20)}</span></td>\n          <td>${leg.trueHeading}Â°</td>\n          <td>${leg.magneticVariation > 0 ? 'E' + leg.magneticVariation : leg.magneticVariation < 0 ? 'W' + Math.abs(leg.magneticVariation) : '0'}</td>\n          <td><strong>${leg.magneticHeading}Â°</strong></td>\n          <td>${leg.tas}</td>\n          <td><strong>${leg.groundspeed}</strong></td>\n          <td>${leg.distance}</td>\n          <td>${Math.floor(leg.time)}:${((leg.time % 1) * 60).toFixed(0).padStart(2, '0')}</td>\n          <td>${leg.fuelNeeded.toFixed(1)}</td>\n          <td><strong>${leg.fuelWithReserves.toFixed(1)}</strong></td>\n          <td class=\"wind-info\">${leg.windDirection}Â°/${leg.windSpeed}</td>\n          <td>$${leg.cost.toFixed(0)}</td>\n        </tr>\n      `).join('')}\n      <tr class=\"total-row\">\n        <td colspan=\"7\"><strong>TOTAL</strong></td>\n        <td><strong>${totalDistance}</strong></td>\n        <td><strong>${Math.floor(totalTime)}:${((totalTime % 1) * 60).toFixed(0).padStart(2, '0')}</strong></td>\n        <td>${(totalFuel - totalFuel * 0.2).toFixed(1)}</td>\n        <td><strong>${totalFuel.toFixed(1)}</strong></td>\n        <td></td>\n        <td><strong>$${totalCost.toFixed(0)}</strong></td>\n      </tr>\n    </tbody>\n  </table>\n\n  <div class=\"summary\">\n    <div class=\"summary-item\">\n      <div class=\"summary-value\">${totalDistance} NM</div>\n      <div class=\"summary-label\">Total Distance</div>\n    </div>\n    <div class=\"summary-item\">\n      <div class=\"summary-value\">${Math.floor(totalTime)}h ${((totalTime % 1) * 60).toFixed(0)}m</div>\n      <div class=\"summary-label\">Est. Time</div>\n    </div>\n    <div class=\"summary-item\">\n      <div class=\"summary-value\">${totalFuel.toFixed(1)} gal</div>\n      <div class=\"summary-label\">Fuel +25%</div>\n    </div>\n    <div class=\"summary-item\">\n      <div class=\"summary-value\">$${totalCost.toFixed(0)}</div>\n      <div class=\"summary-label\">Est. Cost</div>\n    </div>\n  </div>\n\n  <div class=\"footer\">\n    Generated by FuelSaver - Flight Planning Tool | For planning purposes only | Not for navigation\n  </div>\n</body>\n</html>\n  `.trim();\n  \n  return html;\n}\n\n/**\n * Create NavLog data from flight plan\n */\nexport function createNavLogData(\n  waypoints: Waypoint[],\n  aircraft: { name: string; speed: number; burnRate: number; fuelCapacity: number },\n  cruisingAltitude: number,\n  fuelPrices: Record<string, { price100ll: number | null }>,\n  windData: Record<string, { direction: number; speed: number }> = {}, // Optional wind by waypoint\n  planName?: string\n): NavLogData | null {\n  if (waypoints.length < 2) return null;\n\n  const derivedName = `Flight ${waypoints[0].icao} to ${waypoints[waypoints.length - 1].icao}`;\n  const name = planName?.trim()?.length ? planName.trim() : derivedName;\n  const date = new Date().toLocaleDateString('en-US', { \n    year: 'numeric', \n    month: 'numeric', \n    day: 'numeric' \n  });\n\n  const legs: NavLogLeg[] = [];\n  let totalDistance = 0;\n  let totalTime = 0;\n  let totalFuel = 0;\n  let totalCost = 0;\n\n  for (let i = 1; i < waypoints.length; i++) {\n    const from = waypoints[i - 1];\n    const to = waypoints[i];\n    \n    // Calculate distance\n    const distance = calculateDistance(from.latitude, from.longitude, to.latitude, to.longitude);\n    totalDistance += distance;\n    \n    // Get magnetic variation at midpoint\n    const midLat = (from.latitude + to.latitude) / 2;\n    const midLon = (from.longitude + to.longitude) / 2;\n    const magneticVariation = calculateMagneticVariation(midLat, midLon);\n    \n    // Get wind data (default if not provided)\n    const wind = windData[from.icao] || { direction: 270, speed: 10 }; // Default: wind from west at 10kts\n    \n    // Calculate true course\n    const trueCourse = calculateTrueCourse(from.latitude, from.longitude, to.latitude, to.longitude);\n    \n    // Calculate wind effects\n    const { groundspeed, windCorrection } = calculateWindEffect(\n      trueCourse,\n      aircraft.speed,\n      wind.direction,\n      wind.speed\n    );\n    \n    // Calculate headings\n    const magneticHeading = trueToMagnetic(trueCourse, magneticVariation);\n    const trueHeading = trueCourse;\n    \n    // Calculate time\n    const time = groundspeed > 0 ? distance / groundspeed * 60 : 0; // minutes\n    totalTime += time;\n    \n    // Calculate fuel\n    const fuelNeeded = (distance / aircraft.speed) * aircraft.burnRate;\n    const fuelWithReserves = fuelNeeded * 1.25;\n    totalFuel += fuelWithReserves;\n    \n    // Calculate cost\n    const fuelPrice = fuelPrices[from.icao]?.price100ll || 6.50;\n    const legCost = fuelWithReserves * fuelPrice;\n    totalCost += legCost;\n    \n    legs.push({\n      from,\n      to,\n      course: trueCourse,\n      distance,\n      tas: aircraft.speed,\n      windDirection: wind.direction,\n      windSpeed: wind.speed,\n      groundspeed,\n      windCorrection,\n      magneticVariation,\n      trueHeading,\n      magneticHeading,\n      time,\n      fuelNeeded,\n      fuelWithReserves,\n      cost: legCost\n    });\n  }\n\n  return {\n    name,\n    aircraft: aircraft.name,\n    departure: waypoints[0].icao,\n    arrival: waypoints[waypoints.length - 1].icao,\n    cruisingAltitude,\n    date,\n    legs,\n    totalDistance,\n    totalTime,\n    totalFuel,\n    totalCost\n  };\n}\n\n/**\n * Download Basic or Detailed Nav Log\n */\nexport function downloadNavLog(\n  waypoints: Waypoint[],\n  aircraft: { name: string; speed: number; burnRate: number; fuelCapacity: number },\n  cruisingAltitude: number,\n  fuelPrices: Record<string, { price100ll: number | null }>,\n  detailed: boolean = false,\n  planName?: string\n): void {\n  const navLogData = createNavLogData(waypoints, aircraft, cruisingAltitude, fuelPrices, undefined, planName);\n  if (!navLogData) return;\n\n  const html = detailed ? generateDetailedNavLog(navLogData) : generateBasicNavLog(navLogData);\n  const filename = `${navLogData.name?.replace(/[^a-z0-9]/gi, '-').toLowerCase() || 'flight-plan'}-${detailed ? 'detailed' : 'basic'}-navlog`;\n\n  // Open in new window for printing without document.write\n  const blob = new Blob([html], { type: 'text/html' });\n  const url = URL.createObjectURL(blob);\n  const printWindow = window.open(url, '_blank', 'noopener');\n  if (printWindow) {\n    const tryPrint = () => {\n      try {\n        printWindow.focus();\n        printWindow.print();\n      } catch {}\n    };\n    printWindow.addEventListener('load', tryPrint, { once: true });\n    setTimeout(tryPrint, 800);\n  }\n  setTimeout(() => URL.revokeObjectURL(url), 30_000);\n}\n\n/**\n * Download Nav Log as a styled PDF\n */\nexport function downloadNavLogPdf(\n  waypoints: Waypoint[],\n  aircraft: { name: string; speed: number; burnRate: number; fuelCapacity: number },\n  cruisingAltitude: number,\n  fuelPrices: Record<string, { price100ll: number | null }>,\n  options?: { detailed?: boolean; planName?: string }\n): void {\n  const navLogData = createNavLogData(\n    waypoints,\n    aircraft,\n    cruisingAltitude,\n    fuelPrices,\n    undefined,\n    options?.planName\n  );\n\n  if (!navLogData) return;\n\n  const detailed = options?.detailed ?? false;\n  const doc = createNavLogPdfDoc(navLogData, { detailed, cruisingAltitude });\n  const filenameBase = navLogData.name?.replace(/[^a-z0-9]/gi, '-').toLowerCase() || 'flight-plan';\n  doc.save(`${filenameBase}-navlog.pdf`);\n\n  persistNavLogExport(navLogData, detailed);\n}\n\nexport function createNavLogPdfDoc(\n  navLogData: NavLogData,\n  options?: { detailed?: boolean; cruisingAltitude?: number }\n): jsPDF {\n  const detailed = options?.detailed ?? false;\n  const doc = new jsPDF({ orientation: 'landscape', unit: 'mm', format: 'letter' });\n  const margin = 14;\n  const lineHeight = 6;\n  const headingY = margin + 4;\n\n  doc.setFont('helvetica', 'bold');\n  doc.setFontSize(18);\n  doc.text(navLogData.name || 'Flight Plan Nav Log', margin, headingY);\n\n  doc.setFontSize(10);\n  doc.setFont('helvetica', 'normal');\n  const metaLines = [\n    `Aircraft: ${navLogData.aircraft}`,\n    `Route: ${navLogData.departure} â†’ ${navLogData.arrival}`,\n    `Altitude: ${(options?.cruisingAltitude ?? navLogData.cruisingAltitude).toLocaleString()} ft`,\n    `Date: ${navLogData.date}`\n  ];\n  metaLines.forEach((line, idx) => {\n    doc.text(line, margin, headingY + 10 + idx * lineHeight);\n  });\n\n  const tableHead = detailed\n    ? [['Leg', 'CourseÂ°', 'True HDGÂ°', 'Mag HDGÂ°', 'GS (kt)', 'Dist (NM)', 'Time', 'Fuel (gal)', 'Cost ($)']]\n    : [['Leg', 'CourseÂ°', 'Dist (NM)', 'Time', 'Fuel (gal)', 'Cost ($)']];\n\n  const formatTime = (timeMinutes: number) => {\n    const hours = Math.floor(timeMinutes / 60);\n    const minutes = Math.round(timeMinutes % 60);\n    return `${hours}h ${minutes.toString().padStart(2, '0')}m`;\n  };\n\n  const tableBody = navLogData.legs.map((leg, index) => {\n    const legLabel = `${index + 1}. ${leg.from.icao} â†’ ${leg.to.icao}`;\n    if (detailed) {\n      return [\n        legLabel,\n        `${leg.course.toFixed(0)}`,\n        `${leg.trueHeading.toFixed(0)}`,\n        `${leg.magneticHeading.toFixed(0)}`,\n        `${leg.groundspeed.toFixed(0)}`,\n        `${leg.distance.toFixed(1)}`,\n        formatTime(leg.time),\n        `${leg.fuelWithReserves.toFixed(1)}`,\n        `$${leg.cost.toFixed(0)}`\n      ];\n    }\n\n    return [\n      legLabel,\n      `${leg.course.toFixed(0)}`,\n      `${leg.distance.toFixed(1)}`,\n      formatTime(leg.time),\n      `${leg.fuelWithReserves.toFixed(1)}`,\n      `$${leg.cost.toFixed(0)}`\n    ];\n  });\n\n  autoTable(doc, {\n    head: tableHead,\n    body: tableBody,\n    startY: headingY + 10 + metaLines.length * lineHeight + 4,\n    styles: { fontSize: 9, cellPadding: 3 },\n    headStyles: { fillColor: [15, 23, 42], textColor: 255, fontStyle: 'bold' },\n    alternateRowStyles: { fillColor: [248, 250, 252] },\n    columnStyles: {\n      0: { halign: 'left' }\n    }\n  });\n\n  const tableY = (doc as any).lastAutoTable?.finalY || 0;\n  const summaryY = tableY + 8;\n  doc.setFont('helvetica', 'bold');\n  doc.setFontSize(12);\n  doc.text('Summary', margin, summaryY);\n  doc.setFont('helvetica', 'normal');\n  doc.setFontSize(10);\n\n  const summaryLines = [\n    `Total Distance: ${navLogData.totalDistance.toFixed(1)} NM`,\n    `Estimated Time: ${formatTime(navLogData.totalTime)}`,\n    `Fuel Required: ${navLogData.totalFuel.toFixed(1)} gal`,\n    `Estimated Cost: $${navLogData.totalCost.toFixed(0)}`\n  ];\n\n  summaryLines.forEach((line, idx) => {\n    doc.text(line, margin, summaryY + 6 + idx * lineHeight);\n  });\n\n  doc.setFontSize(8);\n  doc.setTextColor(120);\n  doc.text('Generated by FuelSaver â€” For planning purposes only', margin, doc.internal.pageSize.getHeight() - margin);\n\n  return doc;\n}\n\nfunction persistNavLogExport(navLogData: NavLogData, detailed: boolean) {\n  if (typeof window === 'undefined') return;\n  try {\n    const existingRaw = localStorage.getItem(NAV_LOG_EXPORTS_KEY);\n    const existing: StoredNavLogExport[] = existingRaw ? JSON.parse(existingRaw) : [];\n    const entry: StoredNavLogExport = {\n      id: crypto.randomUUID ? crypto.randomUUID() : Date.now().toString(),\n      name: navLogData.name || `${navLogData.departure} â†’ ${navLogData.arrival}`,\n      createdAt: new Date().toISOString(),\n      detailed,\n      navLogData\n    };\n    const next = [entry, ...existing].slice(0, 20);\n    localStorage.setItem(NAV_LOG_EXPORTS_KEY, JSON.stringify(next));\n    window.dispatchEvent(new CustomEvent('navlog-exports-updated'));\n  } catch (error) {\n    console.error('Failed to persist nav log export', error);\n  }\n}\n\nexport function getNavLogExportHistory(): StoredNavLogExport[] {\n  if (typeof window === 'undefined') return [];\n  try {\n    const existingRaw = localStorage.getItem(NAV_LOG_EXPORTS_KEY);\n    return existingRaw ? JSON.parse(existingRaw) : [];\n  } catch (error) {\n    console.error('Failed to load nav log exports', error);\n    return [];\n  }\n}\n\nexport interface DeepLinkResult {\n  scheme: string;\n  fallback?: string;\n}\n\nexport function generateForeFlightDeepLink(\n  waypoints: Waypoint[],\n  options?: { planName?: string; altitude?: number }\n): DeepLinkResult | null {\n  const route = waypoints\n    .filter((wp) => wp?.icao)\n    .map((wp) => ({ ...wp, icao: (wp.icao || '').toUpperCase() }));\n  if (route.length < 2) return null;\n\n  const origin = route[0].icao;\n  const destination = route[route.length - 1].icao;\n  const intermediate = route.slice(1, -1).map((wp) => wp.icao).join('+');\n  const params = new URLSearchParams({\n    name: options?.planName || `${origin}-${destination}`,\n    origin,\n    destination,\n  });\n  if (intermediate) params.set('waypoints', intermediate);\n  if (options?.altitude) params.set('altitude', options.altitude.toString());\n\n  const scheme = `foreflight://route?${params.toString()}`;\n  const fallbackRoute = route.map((wp) => wp.icao).join('.');\n  const fallback = `https://plan.foreflight.com/plan?route=${encodeURIComponent(fallbackRoute)}`;\n  return { scheme, fallback };\n}\n\nexport function generateGarminDeepLink(\n  waypoints: Waypoint[],\n  options?: { planName?: string }\n): DeepLinkResult | null {\n  const route = waypoints\n    .filter((wp) => wp?.icao)\n    .map((wp) => ({ ...wp, icao: (wp.icao || '').toUpperCase() }));\n  if (route.length < 2) return null;\n\n  const routeDots = route.map((wp) => wp.icao).join('..');\n  const schemeParams = new URLSearchParams({\n    route: routeDots,\n  });\n  if (options?.planName) {\n    schemeParams.set('name', options.planName);\n  }\n  const scheme = `garminpilot://flightPlan?${schemeParams.toString()}`;\n  const fallback = `https://fly.garmin.com/fpl/application?plan=${route.map((wp) => wp.icao).join(',')}`;\n  return { scheme, fallback };\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\fuel-saver\\lib\\magneticVariation.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'angle' is assigned a value but never used.","line":41,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":41,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'r' is assigned a value but never used.","line":50,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":50,"endColumn":10}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Magnetic Variation Calculator\n * Uses World Magnetic Model (WMM) simplified approximation\n * Accurate enough for flight planning purposes (Â±1-2 degrees)\n * \n * For more accurate values, use NOAA's WMM calculator:\n * https://www.ngdc.noaa.gov/geomag/calculators/magcalc.shtml\n */\n\n/**\n * Calculate magnetic variation for a given latitude/longitude\n * Uses simplified dipole model approximation\n * \n * @param latitude - in degrees (positive = north)\n * @param longitude - in degrees (positive = east)\n * @param year - year for calculation (defaults to current year)\n * @returns magnetic variation in degrees (positive = east variation, negative = west)\n */\nexport function calculateMagneticVariation(\n  latitude: number, \n  longitude: number, \n  year: number = new Date().getFullYear()\n): number {\n  // Reference year for WMM 2020-2025 model\n  const referenceYear = 2022.5;\n  const yearsFromReference = year - referenceYear;\n\n  // Earth's magnetic pole positions (approximate)\n  const magneticNorthLat = 86.5;   // Magnetic north pole latitude\n  const magneticNorthLon = 172.4;   // Magnetic north pole longitude (west)\n\n  // Convert to radians\n  const latRad = (latitude * Math.PI) / 180;\n  const lonRad = (longitude * Math.PI) / 180;\n  const magLatRad = (magneticNorthLat * Math.PI) / 180;\n  const magLonRad = (magneticNorthLon * Math.PI) / 180;\n\n  // Calculate great circle distance from magnetic pole\n  const cosAngle = Math.sin(latRad) * Math.sin(magLatRad) + \n                   Math.cos(latRad) * Math.cos(magLatRad) * Math.cos(lonRad - magLonRad);\n  const angle = Math.acos(Math.max(-1, Math.min(1, cosAngle)));\n  \n  // Calculate magnetic dipole longitude\n  const dipoleLon = Math.atan2(\n    Math.sin(lonRad - magLonRad) * Math.cos(magLatRad),\n    Math.cos(latRad) * Math.sin(magLatRad) - Math.sin(latRad) * Math.cos(magLatRad) * Math.cos(lonRad - magLonRad)\n  );\n\n  // Simplified magnetic field components\n  const r = 6371.2; // Earth radius in km\n  const a = 6378.137; // WGS84 equatorial radius\n  const b = 6356.752; // WGS84 polar radius\n  \n  // Convert geodetic to geocentric\n  const latGeocentric = Math.atan(\n    (b * b / (a * a)) * Math.tan(latRad)\n  );\n\n  // Simplified dipole field strength (approximation)\n  const colat = Math.acos(\n    Math.sin(latGeocentric) * Math.sin(magLatRad) + \n    Math.cos(latGeocentric) * Math.cos(magLatRad) * Math.cos(dipoleLon)\n  );\n  \n  // Calculate variation using dipole approximation\n  // This gives a reasonable approximation for planning purposes\n  const sinVar = Math.sin(dipoleLon) * Math.cos(latGeocentric) / Math.sin(colat);\n  const cosVar = (Math.sin(magLatRad) - Math.sin(latGeocentric) * Math.cos(colat)) / \n                 (Math.cos(latGeocentric) * Math.sin(colat));\n  \n  let variation = Math.atan2(sinVar, cosVar) * (180 / Math.PI);\n  \n  // Add annual drift (magnetic poles are moving ~40-50km/year)\n  // Eastern drift in North America\n  const annualDrift = 0.15; // degrees per year (approximate)\n  variation += yearsFromReference * annualDrift;\n\n  return Math.round(variation * 10) / 10; // Round to 1 decimal\n}\n\n/**\n * Get variation for multiple waypoints\n */\nexport function getVariationsForRoute(\n  waypoints: { latitude: number; longitude: number }[]\n): number[] {\n  return waypoints.map(wp => calculateMagneticVariation(wp.latitude, wp.longitude));\n}\n\n/**\n * Apply magnetic variation to get heading components\n */\nexport function trueToMagnetic(trueHeading: number, variation: number): number {\n  let magHeading = trueHeading + variation;\n  if (magHeading < 0) magHeading += 360;\n  if (magHeading >= 360) magHeading -= 360;\n  return Math.round(magHeading);\n}\n\nexport function magneticToTrue(magneticHeading: number, variation: number): number {\n  let trueHeading = magneticHeading - variation;\n  if (trueHeading < 0) trueHeading += 360;\n  if (trueHeading >= 360) trueHeading -= 360;\n  return Math.round(trueHeading);\n}\n\n/**\n * Get compass rose directions\n */\nexport function getCompassDirections(): { direction: string; degrees: number }[] {\n  return [\n    { direction: 'N', degrees: 0 },\n    { direction: 'NNE', degrees: 22.5 },\n    { direction: 'NE', degrees: 45 },\n    { direction: 'ENE', degrees: 67.5 },\n    { direction: 'E', degrees: 90 },\n    { direction: 'ESE', degrees: 112.5 },\n    { direction: 'SE', degrees: 135 },\n    { direction: 'SSE', degrees: 157.5 },\n    { direction: 'S', degrees: 180 },\n    { direction: 'SSW', degrees: 202.5 },\n    { direction: 'SW', degrees: 225 },\n    { direction: 'WSW', degrees: 247.5 },\n    { direction: 'W', degrees: 270 },\n    { direction: 'WNW', degrees: 292.5 },\n    { direction: 'NW', degrees: 315 },\n    { direction: 'NNW', degrees: 337.5 },\n  ];\n}\n\n/**\n * Get cardinal direction for a heading\n */\nexport function getCardinalDirection(heading: number): string {\n  const directions = getCompassDirections();\n  const normalized = ((heading % 360) + 360) % 360;\n  \n  for (let i = directions.length - 1; i >= 0; i--) {\n    if (normalized >= directions[i].degrees) {\n      return directions[i].direction;\n    }\n  }\n  return 'N';\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\fuel-saver\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MapTileLayer' is defined but never used.","line":14,"column":44,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":56,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"MapTileLayer"},"fix":{"range":[777,791],"text":""},"desc":"Remove unused variable \"MapTileLayer\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FlightPlayback' is defined but never used.","line":15,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":22,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"FlightPlayback"},"fix":{"range":[834,882],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'RangeRingCalculator' is defined but never used.","line":16,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":27,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"RangeRingCalculator"},"fix":{"range":[882,930],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'VerificationBanner' is defined but never used.","line":21,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":26,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"VerificationBanner"},"fix":{"range":[1172,1239],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'loadingAirports' is assigned a value but never used.","line":272,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":272,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setShowAllAirports' is assigned a value but never used.","line":274,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":274,"endColumn":45},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":300,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":300,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13787,13790],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13787,13790],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":303,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":303,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13914,13917],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13914,13917],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-const","severity":2,"message":"'newOrder' is never reassigned. Use 'const' instead.","line":333,"column":11,"nodeType":"Identifier","messageId":"useConst","endLine":333,"endColumn":19,"fix":{"range":[14948,14984],"text":"const newOrder = [...stateCacheOrder];"}},{"ruleId":"prefer-const","severity":2,"message":"'newCache' is never reassigned. Use 'const' instead.","line":334,"column":11,"nodeType":"Identifier","messageId":"useConst","endLine":334,"endColumn":19,"fix":{"range":[14992,15025],"text":"const newCache = { ...stateCache };"}},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'mapHeightPercent' is assigned a value but never used.","line":354,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":354,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setMapHeightPercent' is assigned a value but never used.","line":354,"column":28,"nodeType":"Identifier","messageId":"unusedVar","endLine":354,"endColumn":47},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":382,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":382,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16895,16898],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16895,16898],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'showWeatherMap' is assigned a value but never used.","line":398,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":398,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setShowWeatherMap' is assigned a value but never used.","line":398,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":398,"endColumn":43},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'segmentWeather' is assigned a value but never used.","line":399,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":399,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setSegmentWeather' is assigned a value but never used.","line":399,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":399,"endColumn":43},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":400,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":400,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17800,17803],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17800,17803],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":402,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":402,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17959,17962],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17959,17962],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":411,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":411,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18357,18360],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18357,18360],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":412,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":412,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18407,18410],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18407,18410],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":467,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":467,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20181,20184],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20181,20184],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":492,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":492,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20952,20955],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20952,20955],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":509,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":509,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21569,21572],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21569,21572],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":525,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":525,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22223,22226],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22223,22226],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":527,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":527,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22355,22358],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22355,22358],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":540,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":540,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23112,23115],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23112,23115],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'DEMO_FLIGHT_PLANS'. Either include it or remove the dependency array.","line":626,"column":6,"nodeType":"ArrayExpression","endLine":626,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [DEMO_FLIGHT_PLANS, demoPlansLoaded]","fix":{"range":[26017,26034],"text":"[DEMO_FLIGHT_PLANS, demoPlansLoaded]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":629,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":629,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26119,26122],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26119,26122],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fuelPrices'. Either include it or remove the dependency array.","line":923,"column":6,"nodeType":"ArrayExpression","endLine":923,"endColumn":17,"suggestions":[{"desc":"Update the dependencies array to be: [fuelPrices, waypoints]","fix":{"range":[37484,37495],"text":"[fuelPrices, waypoints]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'isNorthAmerica'. Either include it or remove the dependency array.","line":1016,"column":6,"nodeType":"ArrayExpression","endLine":1016,"endColumn":51,"suggestions":[{"desc":"Update the dependencies array to be: [airports, cachedAirports, isNorthAmerica, showInternational]","fix":{"range":[40884,40929],"text":"[airports, cachedAirports, isNorthAmerica, showInternational]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1070,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1070,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[42516,42519],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[42516,42519],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-const","severity":2,"message":"'airport' is never reassigned. Use 'const' instead.","line":1289,"column":13,"nodeType":"Identifier","messageId":"useConst","endLine":1289,"endColumn":20,"fix":{"range":[49732,49804],"text":"const airport = DEMO_AIRPORTS.find(a => a.icao === icao?.substring(0, 4));"}},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'importFromFPDB' is assigned a value but never used.","line":1371,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":1371,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'parseRouteString' is assigned a value but never used.","line":1430,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":1430,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'parseFMS' is assigned a value but never used.","line":1464,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":1464,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'parseVATSIM' is assigned a value but never used.","line":1505,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":1505,"endColumn":20},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1585,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1585,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[59943,59946],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[59943,59946],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":1613,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":1613,"endColumn":17},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'fboFeesData'. Either include it or remove the dependency array.","line":1749,"column":6,"nodeType":"ArrayExpression","endLine":1749,"endColumn":112,"suggestions":[{"desc":"Update the dependencies array to be: [waypoints, selectedAircraft.speed, selectedAircraft.burnRate, selectedAircraft.fuelCapacity, includeLandingFees, includeFboFees, soulsOnBoard, departureFuel, fuelPrices, fboFeesData]","fix":{"range":[65369,65475],"text":"[waypoints, selectedAircraft.speed, selectedAircraft.burnRate, selectedAircraft.fuelCapacity, includeLandingFees, includeFboFees, soulsOnBoard, departureFuel, fuelPrices, fboFeesData]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1802,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1802,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[67207,67210],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[67207,67210],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1854,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1854,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[69397,69400],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[69397,69400],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1856,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1856,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[69559,69562],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[69559,69562],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1897,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1897,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[70951,70954],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[70951,70954],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1924,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1924,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[71996,71999],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[71996,71999],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1965,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1965,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[73405,73408],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[73405,73408],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getMarkerColor' is assigned a value but never used.","line":1988,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":1988,"endColumn":23},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":2481,"column":113,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[100525,100526],"text":"&quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[100525,100526],"text":"&ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[100525,100526],"text":"&#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[100525,100526],"text":"&rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":2493,"column":67,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[101513,101514],"text":"&quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[101513,101514],"text":"&ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[101513,101514],"text":"&#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[101513,101514],"text":"&rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":2497,"column":65,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[101812,101813],"text":"&quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[101812,101813],"text":"&ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[101812,101813],"text":"&#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[101812,101813],"text":"&rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":2719,"column":126,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[114896,114897],"text":"&quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[114896,114897],"text":"&ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[114896,114897],"text":"&#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[114896,114897],"text":"&rdquo;"},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":29,"fatalErrorCount":0,"warningCount":22,"fixableErrorCount":3,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useMemo, useEffect, useRef, useCallback, Suspense } from 'react';\r\nimport { useSession, signIn, signOut } from 'next-auth/react';\r\nimport { useSearchParams } from 'next/navigation';\r\nimport dynamic from 'next/dynamic';\r\n\r\n// Dynamic imports for Leaflet components (no SSR)\r\nconst LeafletMap = dynamic(() => import('./LeafletMap'), { ssr: false });\r\nconst StateInfoPanel = dynamic(() => import('./StateInfoPanel'), { ssr: false });\r\nconst NotamsPanel = dynamic(() => import('./components/NOTAMsPanel'), { ssr: false });\r\nconst ExportDropdown = dynamic(() => import('./components/ExportDropdown'), { ssr: false });\r\nconst TripFinder = dynamic(() => import('./components/TripFinder'), { ssr: false });\r\nimport { MapControls, DEFAULT_MAP_OPTIONS, MapTileLayer, MapLayerOptions } from './MapControls';\r\nimport FlightPlayback from './FlightPlayback';\r\nimport RangeRingCalculator from './RangeRing';\r\nimport PerformanceSettingsPanel, { PerformanceSettings, DEFAULT_SETTINGS } from './PerformanceSettings';\r\nimport AuthModal from './AuthModal';\r\nimport UpgradeModal from './UpgradeModal';\nimport TierExplainerModal from './TierExplainerModal';\nimport VerificationBanner from '../components/VerificationBanner';\n\r\n// Types\r\nexport interface Airport {\r\n  icao: string;\r\n  iata?: string;\r\n  name: string;\r\n  city?: string;\r\n  country?: string;\r\n  latitude: number;\r\n  longitude: number;\r\n  type?: string;\r\n  elevation_ft?: number;\r\n}\r\n\r\ninterface Waypoint {\r\n  id: string;\r\n  icao: string;\r\n  name: string;\r\n  city?: string;\r\n  state?: string;\r\n  latitude: number;\r\n  longitude: number;\r\n  altitude?: number;\r\n  sequence: number;\r\n  type?: string;\r\n}\r\n\r\ninterface FuelPrice {\r\n  icao: string;\r\n  price100ll: number | null;\r\n  priceJetA: number | null;\r\n  lastUpdated: string;\r\n  source?: string;\r\n  sourceUrl?: string;\r\n  lastReported?: string;\r\n}\r\n\r\n// Inner component that uses useSearchParams\r\n// function FuelSaverContent() {\r\n// \r\n// Demo airports (fallback)\r\nconst DEMO_AIRPORTS: Airport[] = [\r\n  { icao: 'KORD', iata: 'ORD', name: \"Chicago O'Hare International\", city: 'Chicago', latitude: 41.9742, longitude: -87.9073, type: 'large_airport' },\r\n  { icao: 'KLAX', iata: 'LAX', name: 'Los Angeles International', city: 'Los Angeles', latitude: 33.9425, longitude: -118.4081, type: 'large_airport' },\r\n  { icao: 'KJFK', iata: 'JFK', name: 'John F. Kennedy International', city: 'New York', latitude: 40.6413, longitude: -73.7781, type: 'large_airport' },\r\n  { icao: 'KATL', iata: 'ATL', name: 'Hartsfield-Jackson Atlanta', city: 'Atlanta', latitude: 33.6407, longitude: -84.4277, type: 'large_airport' },\r\n  { icao: 'KDEN', iata: 'DEN', name: 'Denver International', city: 'Denver', latitude: 39.8561, longitude: -104.6737, type: 'large_airport' },\r\n  { icao: 'KSFO', iata: 'SFO', name: 'San Francisco International', city: 'San Francisco', latitude: 37.6213, longitude: -122.379, type: 'large_airport' },\r\n  { icao: 'KLAS', iata: 'LAS', name: 'Harry Reid International', city: 'Las Vegas', latitude: 36.084, longitude: -115.1537, type: 'large_airport' },\r\n  { icao: 'KSEA', iata: 'SEA', name: 'Seattle-Tacoma International', city: 'Seattle', latitude: 47.4502, longitude: -122.3088, type: 'large_airport' },\r\n  { icao: 'KMIA', iata: 'MIA', name: 'Miami International', city: 'Miami', latitude: 25.7959, longitude: -80.287, type: 'large_airport' },\r\n  { icao: 'KDFW', iata: 'DFW', name: 'Dallas/Fort Worth International', city: 'Dallas', latitude: 32.8998, longitude: -97.0403, type: 'large_airport' },\r\n  { icao: 'KPHX', iata: 'PHX', name: 'Phoenix Sky Harbor', city: 'Phoenix', latitude: 33.4352, longitude: -112.0101, type: 'large_airport' },\r\n  { icao: 'KIAH', iata: 'IAH', name: 'George Bush Intercontinental', city: 'Houston', latitude: 29.9902, longitude: -95.3368, type: 'large_airport' },\r\n  { icao: 'KBOS', iata: 'BOS', name: 'Boston Logan International', city: 'Boston', latitude: 42.3656, longitude: -71.0096, type: 'large_airport' },\r\n  { icao: 'KMSP', iata: 'MSP', name: 'Minneapolis-St Paul International', city: 'Minneapolis', latitude: 44.882, longitude: -93.2218, type: 'large_airport' },\r\n  { icao: 'KCLT', iata: 'CLT', name: 'Charlotte Douglas International', city: 'Charlotte', latitude: 35.2144, longitude: -80.9473, type: 'large_airport' },\r\n  { icao: 'KSTL', iata: 'STL', name: 'St. Louis Lambert International', city: 'St. Louis', latitude: 38.7499, longitude: -90.3742, type: 'large_airport' },\r\n  { icao: 'KPDX', iata: 'PDX', name: 'Portland International', city: 'Portland', latitude: 45.5898, longitude: -122.5951, type: 'large_airport' },\r\n  { icao: 'KRDU', iata: 'RDU', name: 'Raleigh-Durham International', city: 'Raleigh', latitude: 35.8801, longitude: -78.788, type: 'large_airport' },\r\n  { icao: 'KSMF', iata: 'SMF', name: 'Sacramento International', city: 'Sacramento', latitude: 38.6954, longitude: -121.5908, type: 'medium_airport' },\r\n  { icao: 'KVNY', iata: 'VNY', name: 'Van Nuys Airport', city: 'Van Nuys', latitude: 34.2098, longitude: -118.4895, type: 'medium_airport' },\r\n];\r\n\r\n// Demo fuel prices\r\nconst DEMO_FUEL_PRICES: FuelPrice[] = [\r\n  { icao: 'KORD', price100ll: 9.58, priceJetA: 9.58, lastUpdated: '2026-02-15' },\r\n  { icao: 'KLAX', price100ll: 10.65, priceJetA: 10.65, lastUpdated: '2026-02-15' },\r\n  { icao: 'KVNY', price100ll: 8.32, priceJetA: 8.32, lastUpdated: '2026-02-15' },\r\n  { icao: 'KPDK', price100ll: 8.67, priceJetA: 8.67, lastUpdated: '2026-02-15' },\r\n];\r\n\r\n// Calculate distance (NM)\r\nfunction calculateDistance(lat1: number, lon1: number, lat2: number, lon2: number): number {\r\n  const R = 3440.065;\r\n  const dLat = (lat2 - lat1) * Math.PI / 180;\r\n  const dLon = (lon2 - lon1) * Math.PI / 180;\r\n  const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +\r\n    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *\r\n    Math.sin(dLon / 2) * Math.sin(dLon / 2);\r\n  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n  return R * c;\r\n}\r\n\r\n// Persistent cache with localStorage\r\nconst CACHE_EXPIRY = 7 * 24 * 60 * 60 * 1000; // 7 days\r\n\r\nfunction getCachedData<T>(key: string): T | null {\r\n  if (typeof window === 'undefined') return null;\r\n  try {\r\n    const cached = localStorage.getItem(key);\r\n    if (!cached) return null;\r\n    const { data, timestamp } = JSON.parse(cached);\r\n    if (Date.now() - timestamp > CACHE_EXPIRY) {\r\n      localStorage.removeItem(key);\r\n      return null;\r\n    }\r\n    return data as T;\r\n  } catch { return null; }\r\n}\r\n\r\nfunction setCachedData<T>(key: string, data: T): void {\r\n  if (typeof window === 'undefined') return;\r\n  try {\r\n    localStorage.setItem(key, JSON.stringify({ data, timestamp: Date.now() }));\r\n  } catch { /* ignore */ }\r\n}\r\n\r\n// Fuel price cache (in-memory + localStorage)\r\nconst fuelPriceCache: Record<string, FuelPrice> = {};\r\n\r\nasync function getFuelPrice(icao: string): Promise<FuelPrice | undefined> {\r\n  if (fuelPriceCache[icao]) return fuelPriceCache[icao];\r\n  \r\n  // Check localStorage cache first\r\n  const cachedPrices = getCachedData<Record<string, FuelPrice>>('fuelPricesCache');\r\n  if (cachedPrices?.[icao]) {\r\n    fuelPriceCache[icao] = cachedPrices[icao];\r\n    return cachedPrices[icao];\r\n  }\r\n  \r\n  // Check demo prices\r\n  const demo = DEMO_FUEL_PRICES.find(f => f.icao === icao);\r\n  if (demo) {\r\n    fuelPriceCache[icao] = demo;\r\n    return demo;\r\n  }\r\n  \r\n  // Try API\n  try {\n    const res = await fetch(`/api/fuel-price?icao=${icao.toUpperCase()}`);\n    if (res.ok) {\n      const data = await res.json();\n      // Fallback to old format\n      if (typeof data?.price100ll === 'number' || typeof data?.priceJetA === 'number') {\n        const fp: FuelPrice = {\n          icao: data.icao,\n          price100ll: data.price100ll ?? null,\n          priceJetA: data.priceJetA ?? null,\n          lastUpdated: data.updatedAt || data.lastReported || '',\n          source: data.source,\n          sourceUrl: data.sourceUrl,\n          lastReported: data.lastReported\n        };\n        fuelPriceCache[icao] = fp;\n        return fp;\n      }\r\n    }\r\n  } catch (e) { console.error('Error fetching fuel:', e); }\r\n  \r\n  return undefined;\r\n}\r\n\r\n// Aircraft profiles with W&B data (arms in inches, weights in lbs)\r\nconst AIRCRAFT_PROFILES = [\r\n  // Cessna\r\n  { \r\n    name: 'Cessna 172S (2022)', manufacturer: 'Cessna', year: 2022, \r\n    fuelCapacity: 56, burnRate: 9.9, speed: 122, type: '100LL',\r\n    emptyWeight: 1689, emptyCG: 39.1, maxWeight: 2550,\r\n    arms: { frontSeats: 37.0, rearSeats: 73.0, baggage1: 95.0, baggage2: 123.0, fuel: 48.0 },\r\n    cgLimits: { forward: 35.0, aft: 47.3 }\r\n  },\r\n  { \r\n    name: 'Cessna 182T (2020)', manufacturer: 'Cessna', year: 2020, \r\n    fuelCapacity: 92, burnRate: 12.5, speed: 140, type: '100LL',\r\n    emptyWeight: 1710, emptyCG: 39.0, maxWeight: 3100,\r\n    arms: { frontSeats: 37.0, rearSeats: 73.0, baggage1: 95.0, baggage2: 123.0, fuel: 48.0 },\r\n    cgLimits: { forward: 35.0, aft: 47.3 }\r\n  },\r\n  { \r\n    name: 'Cessna 208 Caravan (2020)', manufacturer: 'Cessna', year: 2020, \r\n    fuelCapacity: 335, burnRate: 55, speed: 180, type: 'JET-A',\r\n    emptyWeight: 4520, emptyCG: 90.0, maxWeight: 8800,\r\n    arms: { frontSeats: 82.0, rearSeats: 118.0, baggage1: 150.0, fuel: 95.0 },\r\n    cgLimits: { forward: 75.0, aft: 120.0 }\r\n  },\r\n  // Piper\r\n  { \r\n    name: 'Piper Cherokee Six (2015)', manufacturer: 'Piper', year: 2015, \r\n    fuelCapacity: 84, burnRate: 11, speed: 130, type: '100LL',\r\n    emptyWeight: 1520, emptyCG: 35.5, maxWeight: 2800,\r\n    arms: { frontSeats: 32.5, rearSeats: 75.0, baggage1: 95.0, baggage2: 123.0, fuel: 47.0 },\r\n    cgLimits: { forward: 31.0, aft: 47.3 }\r\n  },\r\n  { \r\n    name: 'Piper Cherokee Six (2020)', manufacturer: 'Piper', year: 2020, \r\n    fuelCapacity: 84, burnRate: 10.5, speed: 132, type: '100LL',\r\n    emptyWeight: 1530, emptyCG: 35.5, maxWeight: 2800,\r\n    arms: { frontSeats: 32.5, rearSeats: 75.0, baggage1: 95.0, baggage2: 123.0, fuel: 47.0 },\r\n    cgLimits: { forward: 31.0, aft: 47.3 }\r\n  },\r\n  { \r\n    name: 'Piper Meridian (2021)', manufacturer: 'Piper', year: 2021, \r\n    fuelCapacity: 242, burnRate: 40, speed: 240, type: 'JET-A',\r\n    emptyWeight: 3200, emptyCG: 85.0, maxWeight: 5200,\r\n    arms: { frontSeats: 80.5, rearSeats: 118.0, baggage1: 150.0, fuel: 95.0 },\r\n    cgLimits: { forward: 75.0, aft: 93.0 }\r\n  },\r\n  // Beechcraft\r\n  { \r\n    name: 'Beechcraft Bonanza A36 (2018)', manufacturer: 'Beechcraft', year: 2018, \r\n    fuelCapacity: 102, burnRate: 14, speed: 155, type: '100LL',\r\n    emptyWeight: 2550, emptyCG: 82.0, maxWeight: 3600,\r\n    arms: { frontSeats: 82.5, rearSeats: 95.0, baggage1: 122.0, fuel: 95.0 },\r\n    cgLimits: { forward: 77.0, aft: 93.0 }\r\n  },\r\n  { \r\n    name: 'Beechcraft Bonanza A36 (2024)', manufacturer: 'Beechcraft', year: 2024, \r\n    fuelCapacity: 102, burnRate: 13.5, speed: 158, type: '100LL',\r\n    emptyWeight: 2560, emptyCG: 82.0, maxWeight: 3600,\r\n    arms: { frontSeats: 82.5, rearSeats: 95.0, baggage1: 122.0, fuel: 95.0 },\r\n    cgLimits: { forward: 77.0, aft: 93.0 }\r\n  },\r\n  // Diamond\r\n  { \r\n    name: 'Diamond DA40 (2020)', manufacturer: 'Diamond', year: 2020, \r\n    fuelCapacity: 58, burnRate: 9, speed: 140, type: '100LL',\r\n    emptyWeight: 1650, emptyCG: 93.0, maxWeight: 2700,\r\n    arms: { frontSeats: 85.0, rearSeats: 85.0, baggage1: 90.0, fuel: 90.0 },\r\n    cgLimits: { forward: 82.0, aft: 96.0 }\r\n  },\r\n  { \r\n    name: 'Diamond DA40 (2024)', manufacturer: 'Diamond', year: 2024, \r\n    fuelCapacity: 58, burnRate: 8.8, speed: 142, type: '100LL',\r\n    emptyWeight: 1660, emptyCG: 93.0, maxWeight: 2700,\r\n    arms: { frontSeats: 85.0, rearSeats: 85.0, baggage1: 90.0, fuel: 90.0 },\r\n    cgLimits: { forward: 82.0, aft: 96.0 }\r\n  },\r\n  // Cirrus\r\n  { \r\n    name: 'Cirrus SR22 (2019)', manufacturer: 'Cirrus', year: 2019, \r\n    fuelCapacity: 92, burnRate: 13, speed: 155, type: '100LL',\r\n    emptyWeight: 3400, emptyCG: 35.0, maxWeight: 3600,\r\n    arms: { frontSeats: 35.0, rearSeats: 66.0, baggage1: 86.0, baggage2: 86.0, fuel: 48.0 },\r\n    cgLimits: { forward: 33.0, aft: 47.3 }\r\n  },\r\n  { \r\n    name: 'Cirrus SR22 (2024)', manufacturer: 'Cirrus', year: 2024, \r\n    fuelCapacity: 92, burnRate: 12.5, speed: 158, type: '100LL',\r\n    emptyWeight: 3410, emptyCG: 35.0, maxWeight: 3600,\r\n    arms: { frontSeats: 35.0, rearSeats: 66.0, baggage1: 86.0, baggage2: 86.0, fuel: 48.0 },\r\n    cgLimits: { forward: 33.0, aft: 47.3 }\r\n  },\r\n];\r\n\r\nfunction FuelSaverContent() {\r\n  // Core state\r\n  const [mapLoaded, setMapLoaded] = useState(true);\r\n  const [airports, setAirports] = useState<Airport[]>([]);\r\n  const [loadingAirports, setLoadingAirports] = useState(false);\r\n  const [mapBounds, setMapBounds] = useState({ minLat: 25, maxLat: 50, minLon: -130, maxLon: -65 });\r\n  const [showAllAirports, setShowAllAirports] = useState(false);\r\n  const [showInternational, setShowInternational] = useState(false); // Show Canada/Mexico airports\r\n  const [mapCenter, setMapCenter] = useState<[number, number]>([39.8283, -98.5795]);\r\n  const [mapZoom, setMapZoom] = useState(5);\r\n  \r\n  // Geographic bounds for USA/Canada/Mexico (default restricted area)\r\n  const NORTH_AMERICA_BOUNDS = {\r\n    minLat: 15, maxLat: 72,  // Mexico to northern Canada\r\n    minLon: -180, maxLon: -50 // Include Alaska\r\n  };\r\n  \r\n  // Check if airport is in North America (USA, Canada, Mexico)\r\n  const isNorthAmerica = (airport: Airport) => {\r\n    const { latitude, longitude } = airport;\r\n    return (\r\n      latitude >= NORTH_AMERICA_BOUNDS.minLat &&\r\n      latitude <= NORTH_AMERICA_BOUNDS.maxLat &&\r\n      longitude >= NORTH_AMERICA_BOUNDS.minLon &&\r\n      longitude <= NORTH_AMERICA_BOUNDS.maxLon\r\n    );\r\n  };\r\n  \r\n  // Map layer options\r\n  const [mapOptions, setMapOptions] = useState<MapLayerOptions>(DEFAULT_MAP_OPTIONS);\r\n  \r\n  // State info panel\r\n  const [selectedStateInfo, setSelectedStateInfo] = useState<any>(null);\r\n  \r\n  // LRU cache for state info (last 4 clicked)\r\n  const [stateCache, setStateCache] = useState<Record<string, any>>({});\r\n  const [stateCacheOrder, setStateCacheOrder] = useState<string[]>([]);\r\n  \r\n  // Handle view state info - lazy loads and caches\r\n  const handleViewStateInfo = useCallback(async (stateCode: string) => {\r\n    if (!stateCode) return;\r\n    \r\n    // Only accept valid US state codes (2-letter abbreviations)\r\n    if (stateCode.length !== 2 || !/^[A-Z]{2}$/.test(stateCode)) {\r\n      console.log('Skipping non-US state:', stateCode);\r\n      return;\r\n    }\r\n    \r\n    console.log('handleViewStateInfo called with:', stateCode);\r\n    \r\n    // Check cache first\r\n    if (stateCache[stateCode]) {\r\n      console.log('Using cached state info for:', stateCode);\r\n      setSelectedStateInfo(stateCache[stateCode]);\r\n      return;\r\n    }\r\n    \r\n    // Lazy load state data\r\n    const mod = await import('@/lib/stateData');\r\n    const info = mod.stateData[stateCode];\r\n    \r\n    console.log('Loaded state info:', stateCode, info ? 'found' : 'not found');\r\n    \r\n    if (info) {\r\n      // Manage cache: remove oldest if we have 4\r\n      let newOrder = [...stateCacheOrder];\r\n      let newCache = { ...stateCache };\r\n      \r\n      if (newOrder.length >= 4) {\r\n        const oldest = newOrder.shift();\r\n        if (oldest) delete newCache[oldest];\r\n      }\r\n      \r\n      newOrder.push(stateCode);\r\n      newCache[stateCode] = info;\r\n      \r\n      setStateCacheOrder(newOrder);\r\n      setStateCache(newCache);\r\n      setSelectedStateInfo(info);\r\n    }\r\n  }, [stateCache, stateCacheOrder]);\r\n  \r\n  // Performance settings\r\n  const [performanceSettings, setPerformanceSettings] = useState<PerformanceSettings>(DEFAULT_SETTINGS);\r\n  \r\n  // Map height control (percentage)\r\n  const [mapHeightPercent, setMapHeightPercent] = useState(60);\r\n   \r\n  // Flight plan state\r\n  const [flightPlanName, setFlightPlanName] = useState('');\r\n  const [callsign, setCallsign] = useState('');\r\n  const [aircraftType, setAircraftType] = useState('');\r\n  const [pilotName, setPilotName] = useState('');\r\n  const [departureTime, setDepartureTime] = useState('');\r\n  const [cruisingAlt, setCruisingAlt] = useState(5500);\r\n  const [alternateIcao, setAlternateIcao] = useState('');\r\n  const [remarks, setRemarks] = useState('');\r\n  const [soulsOnBoard, setSoulsOnBoard] = useState(1);\r\n  \r\n  // Route waypoints\r\n  const [waypoints, setWaypoints] = useState<Waypoint[]>([]);\r\n  const [departureFuel, setDepartureFuel] = useState(100);\r\n  const [selectedAircraft, setSelectedAircraft] = useState(AIRCRAFT_PROFILES[0]);\r\n  \r\n  // Drag and drop for leg reordering\r\n  const [draggedLegIndex, setDraggedLegIndex] = useState<number | null>(null);\r\n  \r\n  // Fuel data\r\n  const [fuelPrices, setFuelPrices] = useState<Record<string, FuelPrice>>({});\r\n  const [fboFeesData, setFboFeesData] = useState<Record<string, { fee25?: number; fee100?: number; landingFee?: number }>>({});\r\n  \r\n  // State prices will be calculated in LeafletMap component\r\n  \r\n  // Saved flight plans\r\n  const [savedPlans, setSavedPlans] = useState<any[]>([]);\r\n  const [showPlanList, setShowPlanList] = useState(false);\r\n  \r\n  // Auth Modal\r\n  const [authModalOpen, setAuthModalOpen] = useState(false);\r\n  const [authModalAction, setAuthModalAction] = useState<'save' | 'load' | 'export'>('save');\r\n    \r\n  // Upgrade Modal\r\n  const [upgradeModalOpen, setUpgradeModalOpen] = useState(false);\r\n  const [upgradeFeature, setUpgradeFeature] = useState<string>('');\r\n    \r\n  // Tier Explainer Modal (shown on first visit for free users)\r\n  const [showTierExplainer, setShowTierExplainer] = useState(false);\r\n\r\n  // Weather for waypoints\r\n  const [showWeather, setShowWeather] = useState(false);\r\n  const [showWeatherMap, setShowWeatherMap] = useState(false);\r\n  const [segmentWeather, setSegmentWeather] = useState<Record<number, { windSpeed: number; windDir: number; temp: number; impact: number }>>({});\r\n  const [routeWeather, setRouteWeather] = useState<any>(null);\r\n  const [loadingRouteWeather, setLoadingRouteWeather] = useState(false);\r\n  const [waypointWeather, setWaypointWeather] = useState<Record<string, any>>({});\r\n  const [weatherLoading, setWeatherLoading] = useState(false);\r\n\r\n  // Auth\r\n  const { data: session, status } = useSession();\r\n  const [syncOffered, setSyncOffered] = useState(false);\r\n  const [currentPlanId, setCurrentPlanId] = useState<string | null>(null);\r\n  \r\n  // User tier and role - check session for pro/owner, default to free for guests\r\n  const userRole = (session?.user as any)?.role;\r\n  const userTier = (session?.user as any)?.tier || 'free';\r\n\r\n  // Free tier limits\r\n  const FREE_TIER_LIMITS = {\r\n    maxWaypoints: 6,\r\n    maxSavedPlans: 5,\r\n    maxClubs: 1,\r\n    maxAircraft: 3,\r\n  };\r\n\r\n  // Owner or Pro users don't see ads\r\n  const isOwner = userRole === 'owner';\r\n  const isPro = userTier === 'pro' || isOwner;\r\n  const isGuest = status === 'unauthenticated';\r\n\r\n  // Validation for save button\r\n  const canSave = waypoints.length >= 2 && \r\n    (flightPlanName.trim() || \r\n     callsign.trim() || \r\n     pilotName.trim() || \r\n     waypoints[0]?.icao);\r\n\r\n  // Check if we should show the tier explainer on mount\r\n  // Only show for guests (not logged in), not for free/pro/owner users\r\n  useEffect(() => {\r\n    if (typeof window !== 'undefined' && isGuest && !isPro) {\r\n      const seen = localStorage.getItem('hasSeenTierExplainer');\r\n      if (!seen) {\r\n        // Show after a short delay to let the page load\r\n        setTimeout(() => setShowTierExplainer(true), 1500);\r\n      }\r\n    }\r\n  }, [isGuest, isPro]);\r\n  \r\n  // Demo plans flag\r\n  const [demoPlansLoaded, setDemoPlansLoaded] = useState(false);\r\n\r\n  const CURRENT_PLAN_STORAGE_KEY = 'fuelSaverCurrentPlan';\r\n  \r\n  // Get URL params for loading a plan\r\n  const searchParams = useSearchParams();\r\n  \r\n  // Load plan from URL param (shared link)\r\n  useEffect(() => {\r\n    if (typeof window === 'undefined') return;\r\n    \r\n    const urlParams = new URLSearchParams(window.location.search);\r\n    const planParam = urlParams.get('plan');\r\n    \r\n    if (planParam) {\r\n      try {\r\n        const decoded = decodeURIComponent(atob(planParam));\r\n        const planData = JSON.parse(decoded);\r\n        \r\n        if (planData.waypoints && Array.isArray(planData.waypoints)) {\r\n          const loadedWaypoints = planData.waypoints.map((w: any, i: number) => ({\r\n            ...w,\r\n            id: `shared-${i}`,\r\n            sequence: i\r\n          }));\r\n          setWaypoints(loadedWaypoints);\r\n          \r\n          if (loadedWaypoints.length > 0) {\r\n            setMapCenter([loadedWaypoints[0].latitude, loadedWaypoints[0].longitude]);\r\n          }\r\n          \r\n          if (planData.name) {\r\n            setFlightPlanName(planData.name);\r\n          }\r\n        }\r\n      } catch (e) {\r\n        console.error('Error loading shared plan:', e);\r\n      }\r\n    }\r\n  }, []);\r\n   \r\n  // Load plan from URL param when plans are loaded (for database plans)\r\n  useEffect(() => {\r\n    const loadId = searchParams?.get('load');\r\n    if (loadId && savedPlans.length > 0) {\r\n      const planToLoad = savedPlans.find((p: any) => p.id === loadId);\r\n      if (planToLoad) {\r\n        setCurrentPlanId(loadId);\r\n        loadFlightPlan(planToLoad);\r\n      }\r\n    }\r\n  }, [searchParams, savedPlans]);\r\n  \r\n  // Load saved flight plans - localStorage first, then database\r\n  useEffect(() => {\r\n    // Always load from localStorage first (works offline)\r\n    if (typeof window !== 'undefined') {\r\n      const localPlans = localStorage.getItem('savedFlightPlans');\r\n      if (localPlans) {\r\n        try {\r\n          const parsed = JSON.parse(localPlans);\r\n          // Mark local plans with a flag\r\n          const localOnlyPlans = parsed.map((p: any) => ({ ...p, fromLocal: true }));\r\n          setSavedPlans(localOnlyPlans);\r\n        } catch (e) { \r\n          console.error('Error loading local plans:', e); \r\n        }\r\n      }\r\n    }\r\n    \r\n    // If authenticated, load from database and offer to sync\r\n    if (status === 'authenticated' && session?.user?.id) {\r\n      fetch('/api/flight-plans')\r\n        .then(res => res.json())\r\n        .then(data => {\r\n          if (data.flightPlans && data.flightPlans.length > 0) {\r\n            // Merge with local plans (database takes precedence for same plans)\r\n            setSavedPlans(prev => {\r\n              const dbPlans = data.flightPlans.map((p: any) => ({ ...p, fromLocal: false }));\r\n              // Keep any local-only plans\r\n              const localOnly = prev.filter((p: any) => p.fromLocal === true);\r\n              return [...localOnly, ...dbPlans];\r\n            });\r\n            \r\n            // Offer to import local plans if there are any\r\n            const localPlans = typeof window !== 'undefined' ? localStorage.getItem('savedFlightPlans') : null;\r\n            if (localPlans && !syncOffered) {\r\n              const parsed = JSON.parse(localPlans);\r\n              if (parsed.length > 0) {\r\n                // Ask user if they want to import\r\n                const importConfirm = confirm(`You have ${parsed.length} flight plan(s) saved locally. Import them to your account?`);\r\n                if (importConfirm) {\r\n                  // Import each local plan to database\r\n                  parsed.forEach(async (plan: any) => {\r\n                    await fetch('/api/flight-plans', {\r\n                      method: 'POST',\r\n                      headers: { 'Content-Type': 'application/json' },\r\n                      body: JSON.stringify(plan)\r\n                    });\r\n                  });\r\n                  // Clear local storage after import\r\n                  localStorage.removeItem('savedFlightPlans');\r\n                  setSyncOffered(true);\r\n                  // Reload from database\r\n                  window.location.reload();\r\n                }\r\n              }\r\n              setSyncOffered(true);\r\n            }\r\n          }\r\n        })\r\n        .catch(err => console.error('Error loading plans:', err));\r\n    }\r\n  }, [status, session, syncOffered]);\r\n  \r\n  // Load fuel prices from localStorage on mount\r\n  useEffect(() => {\r\n    if (typeof window !== 'undefined') {\r\n      const saved = localStorage.getItem('fuelPrices');\r\n      if (saved) {\r\n        try {\r\n          setFuelPrices(JSON.parse(saved));\r\n        } catch (e) { console.error('Error loading fuel prices:', e); }\r\n      }\r\n      \r\n      // Load FBO fees from localStorage\r\n      const savedFbo = localStorage.getItem('fboFees');\r\n      if (savedFbo) {\r\n        try {\r\n          setFboFeesData(JSON.parse(savedFbo));\r\n        } catch (e) { console.error('Error loading FBO fees:', e); }\r\n      }\r\n    }\r\n  }, []);\r\n  \r\n  // Save fuel prices to localStorage when they change\r\n  useEffect(() => {\r\n    if (typeof window !== 'undefined' && Object.keys(fuelPrices).length > 0) {\r\n      localStorage.setItem('fuelPrices', JSON.stringify(fuelPrices));\r\n    }\r\n  }, [fuelPrices]);\r\n  \r\n  // Save FBO fees to localStorage when they change\r\n  useEffect(() => {\r\n    if (typeof window !== 'undefined' && Object.keys(fboFeesData).length > 0) {\r\n      localStorage.setItem('fboFees', JSON.stringify(fboFeesData));\r\n    }\r\n  }, [fboFeesData]);\r\n  \r\n  // Load saved flight plans from localStorage on mount\r\n  useEffect(() => {\r\n    if (typeof window !== 'undefined') {\r\n      const saved = localStorage.getItem('savedFlightPlans');\r\n      if (saved) {\r\n        try {\r\n          const parsed = JSON.parse(saved);\r\n          // Add demo plans if no saved plans exist\r\n          if (parsed.length === 0 && !demoPlansLoaded) {\r\n            setSavedPlans(DEMO_FLIGHT_PLANS);\r\n            setDemoPlansLoaded(true);\r\n          } else {\r\n            setSavedPlans(parsed);\r\n          }\r\n        } catch (e) { \r\n          console.error('Error loading flight plans:', e); \r\n          // Show demo plans on error\r\n          if (!demoPlansLoaded) {\r\n            setSavedPlans(DEMO_FLIGHT_PLANS);\r\n            setDemoPlansLoaded(true);\r\n          }\r\n        }\r\n      } else {\r\n        // No saved plans - show demo plans\r\n        if (!demoPlansLoaded) {\r\n          setSavedPlans(DEMO_FLIGHT_PLANS);\r\n          setDemoPlansLoaded(true);\r\n        }\r\n      }\r\n    }\r\n  }, [demoPlansLoaded]);\r\n  \r\n  // Save flight plans to localStorage\r\n  const saveToLocalStorage = (plans: any[]) => {\r\n    if (typeof window !== 'undefined') {\r\n      localStorage.setItem('savedFlightPlans', JSON.stringify(plans));\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (typeof window === 'undefined') return;\r\n\r\n    if (waypoints.length < 2) {\r\n      localStorage.removeItem(CURRENT_PLAN_STORAGE_KEY);\r\n      window.dispatchEvent(new CustomEvent('fuel-saver-plan-updated'));\r\n      return;\r\n    }\r\n\r\n    const relevantFuelPrices: Record<string, FuelPrice> = {};\r\n    waypoints.forEach((wp) => {\r\n      if (wp?.icao && fuelPrices[wp.icao]) {\r\n        relevantFuelPrices[wp.icao] = fuelPrices[wp.icao];\r\n      }\r\n    });\r\n\r\n    const currentPlan = {\r\n      name: flightPlanName?.trim() || undefined,\r\n      waypoints: waypoints.map((wp) => ({\r\n        icao: wp.icao,\r\n        name: wp.name,\r\n        latitude: wp.latitude,\r\n        longitude: wp.longitude,\r\n      })),\r\n      aircraft: {\r\n        name: selectedAircraft.name,\r\n        speed: selectedAircraft.speed,\r\n        burnRate: selectedAircraft.burnRate,\r\n        fuelCapacity: selectedAircraft.fuelCapacity,\r\n      },\r\n      cruisingAltitude: cruisingAlt,\r\n      fuelPrices: relevantFuelPrices,\r\n      updatedAt: new Date().toISOString(),\r\n    };\r\n\r\n    localStorage.setItem(CURRENT_PLAN_STORAGE_KEY, JSON.stringify(currentPlan));\r\n    window.dispatchEvent(new CustomEvent('fuel-saver-plan-updated'));\r\n  }, [waypoints, selectedAircraft, cruisingAlt, fuelPrices, flightPlanName]);\r\n\r\n  // Demo flight plans for users who want to try it out\r\n  const DEMO_FLIGHT_PLANS = [\r\n    {\r\n      id: 'demo-1',\r\n      name: 'California Coast Hop',\r\n      callsign: 'N12345',\r\n      aircraftType: 'Cessna 172S (2022)',\r\n      pilotName: 'Demo Pilot',\r\n      departureTime: '2026-02-20T08:00',\r\n      cruisingAlt: 5500,\r\n      alternateIcao: 'KSMO',\r\n      remarks: 'Scenic coastal flight',\r\n      soulsOnBoard: 2,\r\n      departureFuel: 100,\r\n      departureIcao: 'KVNY',\r\n      arrivalIcao: 'KSFO',\r\n      waypoints: [\r\n        { icao: 'KVNY', name: 'Van Nuys Airport', city: 'Van Nuys', latitude: 34.2098, longitude: -118.4895, sequence: 0 },\r\n        { icao: 'KLAX', name: 'Los Angeles International', city: 'Los Angeles', latitude: 33.9425, longitude: -118.4081, sequence: 1 },\r\n        { icao: 'KSMF', name: 'Sacramento International', city: 'Sacramento', latitude: 38.6954, longitude: -121.5908, sequence: 2 },\r\n        { icao: 'KSFO', name: 'San Francisco International', city: 'San Francisco', latitude: 37.6213, longitude: -122.379, sequence: 3 },\r\n      ],\r\n      isDemo: true,\r\n      createdAt: '2026-01-15T10:00:00Z'\r\n    },\r\n    {\r\n      id: 'demo-2',\r\n      name: 'Texas Cross Country',\r\n      callsign: 'N98765',\r\n      aircraftType: 'Cessna 182T (2020)',\r\n      pilotName: 'Demo Pilot',\r\n      departureTime: '2026-02-21T09:00',\r\n      cruisingAlt: 6500,\r\n      alternateIcao: 'KDTO',\r\n      remarks: 'Austin to Dallas',\r\n      soulsOnBoard: 3,\r\n      departureFuel: 100,\r\n      departureIcao: 'KAUS',\r\n      arrivalIcao: 'KDFW',\r\n      waypoints: [\r\n        { icao: 'KAUS', name: 'Austin-Bergstrom International', city: 'Austin', latitude: 30.1945, longitude: -97.6699, sequence: 0 },\r\n        { icao: 'KTIW', name: 'Tulip Field', city: 'Cameron', latitude: 30.8791, longitude: -96.9769, sequence: 1 },\r\n        { icao: 'KCFD', name: 'Caddo Mills Municipal', city: 'Caddo Mills', latitude: 33.0362, longitude: -96.2414, sequence: 2 },\r\n        { icao: 'KDFW', name: 'Dallas/Fort Worth International', city: 'Dallas', latitude: 32.8998, longitude: -97.0403, sequence: 3 },\r\n      ],\r\n      isDemo: true,\r\n      createdAt: '2026-01-20T14:30:00Z'\r\n    },\r\n    {\r\n      id: 'demo-3',\r\n      name: 'Florida Fun',\r\n      callsign: 'N11111',\r\n      aircraftType: 'Piper Cherokee Six (2020)',\r\n      pilotName: 'Demo Pilot',\r\n      departureTime: '2026-02-22T07:30',\r\n      cruisingAlt: 4500,\r\n      alternateIcao: 'KMIA',\r\n      remarks: 'Tampa to Miami scenic',\r\n      soulsOnBoard: 4,\r\n      departureFuel: 100,\r\n      departureIcao: 'KTPA',\r\n      arrivalIcao: 'KMIA',\r\n      waypoints: [\r\n        { icao: 'KTPA', name: 'Tampa International', city: 'Tampa', latitude: 27.9755, longitude: -82.5332, sequence: 0 },\r\n        { icao: 'KOPF', name: 'Opa Locka Executive', city: 'Miami', latitude: 25.907, longitude: -80.2586, sequence: 1 },\r\n        { icao: 'KMIA', name: 'Miami International', city: 'Miami', latitude: 25.7959, longitude: -80.287, sequence: 2 },\r\n      ],\r\n      isDemo: true,\r\n      createdAt: '2026-01-25T09:15:00Z'\r\n    }\r\n  ];\r\n\r\n  // Search state\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [searchResults, setSearchResults] = useState<Airport[]>([]);\r\n  const [showSearchResults, setShowSearchResults] = useState(false);\r\n  \r\n  // Panel visibility\r\n  const [showPanel, setShowPanel] = useState(true);\r\n  const [showOrientationWarning, setShowOrientationWarning] = useState(false);\r\n  const [orientationDismissed, setOrientationDismissed] = useState(false);\r\n  const [activeTab, setActiveTab] = useState<'details' | 'waypoints' | 'wb' | 'info' | 'e6b'>('details');\r\n  const [tabIndex, setTabIndex] = useState(0);\r\n  \r\n  // E6B Calculator state\r\n  const [e6bHeading, setE6bHeading] = useState(360);\r\n  const [e6bWindspeed, setE6bWindspeed] = useState(15);\r\n  const [e6bWindDir, setE6bWindDir] = useState(270);\r\n  const [e6bTAS, setE6bTAS] = useState(120);\r\n  const [e6bResult, setE6bResult] = useState<{ groundSpeed: number; windCorrection: number; track: number } | null>(null);\r\n  \r\n  // Weight & Balance state\r\n  const [wbFrontPax, setWbFrontPax] = useState(170);\r\n  const [wbRearPax1, setWbRearPax1] = useState(170);\r\n  const [wbRearPax2, setWbRearPax2] = useState(0);\r\n  const [wbBaggage1, setWbBaggage1] = useState(0);\r\n  const [wbBaggage2, setWbBaggage2] = useState(0);\r\n  const [wbFuel, setWbFuel] = useState(40);\r\n  \r\n  // Total trip cost settings\r\n  const [includeLandingFees, setIncludeLandingFees] = useState(true);\r\n  const [includeFboFees, setIncludeFboFees] = useState(true);\r\n  \r\n  const tabs = [\r\n    { id: 'details', label: 'ðŸ“‹ Details' },\r\n    { id: 'waypoints', label: 'ðŸ“ Route' },\r\n    { id: 'wb', label: 'âš–ï¸ W&B' },\r\n    { id: 'e6b', label: 'ðŸ”§ Tools' },\r\n    { id: 'info', label: 'ðŸŒ¤ Weather' }\r\n  ];\r\n  \r\n  // E6B Wind Correction calculation\r\n  const calculateE6B = () => {\r\n    const headingRad = (e6bHeading * Math.PI) / 180;\r\n    const windRad = (e6bWindDir * Math.PI) / 180;\r\n    const ws = e6bWindspeed;\r\n    const tas = e6bTAS;\r\n    \r\n    // Wind components\r\n    const windFrom = (windRad + Math.PI); // wind FROM direction\r\n    const wx = ws * Math.cos(windFrom);\r\n    const wy = ws * Math.sin(windFrom);\r\n    \r\n    // Ground speed vector\r\n    const gsx = tas * Math.cos(headingRad) - wx;\r\n    const gsy = tas * Math.sin(headingRad) - wy;\r\n    \r\n    const groundSpeed = Math.sqrt(gsx * gsx + gsy * gsy);\r\n    const track = ((Math.atan2(gsy, gsx) * 180) / Math.PI + 360) % 360;\r\n    const windCorrection = track - e6bHeading;\r\n    \r\n    setE6bResult({\r\n      groundSpeed: Math.round(groundSpeed),\r\n      windCorrection: Math.round(windCorrection),\r\n      track: Math.round(track)\r\n    });\r\n  };\r\n  \r\n  // Cached airports - accumulates as user pans around\r\n  const [cachedAirports, setCachedAirports] = useState<Airport[]>([]);\r\n  const [allUSAirportsLoaded, setAllUSAirportsLoaded] = useState(false);\r\n  \r\n  // Pre-load all US airports on first load\r\n  useEffect(() => {\r\n    if (allUSAirportsLoaded) return;\r\n    \r\n    const cached = getCachedData<Airport[]>('allUSAirports');\r\n    if (cached && cached.length > 0) {\r\n      setCachedAirports(cached);\r\n      // Load more airports initially so they're visible\r\n      setAirports(cached.slice(0, 300));\r\n      setAllUSAirportsLoaded(true);\r\n      // Fit to show all airports\r\n      if (cached.length > 0) {\r\n        const lats = cached.slice(0, 300).map(a => a.latitude).filter(Boolean);\r\n        const lons = cached.slice(0, 300).map(a => a.longitude).filter(Boolean);\r\n        if (lats.length > 0) {\r\n          const minLat = Math.min(...lats);\r\n          const maxLat = Math.max(...lats);\r\n          const minLon = Math.min(...lons);\r\n          const maxLon = Math.max(...lons);\r\n          setMapCenter([(minLat + maxLat) / 2, (minLon + maxLon) / 2]);\r\n          setMapZoom(5);\r\n        }\r\n      }\r\n      return;\r\n    }\r\n    \r\n    // Fetch all US airports (large + medium)\r\n    fetch('/api/airports?country=US&limit=10000')\r\n      .then(r => r.json())\r\n      .then(data => {\r\n        if (data.airports) {\r\n          const all = data.airports as Airport[];\r\n          setCachedAirports(all);\r\n          setAirports(all.slice(0, 300));\r\n          setCachedData('allUSAirports', all);\r\n          setAllUSAirportsLoaded(true);\r\n          // Fit to show airports\r\n          const lats = all.slice(0, 300).map(a => a.latitude).filter(Boolean);\r\n          const lons = all.slice(0, 300).map(a => a.longitude).filter(Boolean);\r\n          if (lats.length > 0) {\r\n            const minLat = Math.min(...lats);\r\n            const maxLat = Math.max(...lats);\r\n            const minLon = Math.min(...lons);\r\n            const maxLon = Math.max(...lons);\r\n            setMapCenter([(minLat + maxLat) / 2, (minLon + maxLon) / 2]);\r\n            setMapZoom(5);\r\n          }\r\n        }\r\n      })\r\n      .catch(console.error);\r\n  }, [allUSAirportsLoaded]);\r\n  \r\n  // Fetch airports when map bounds change - with caching\r\n  useEffect(() => {\r\n    if (!mapLoaded) return;\r\n    \r\n    const fetchAirports = async () => {\r\n      setLoadingAirports(true);\r\n      try {\r\n        const sizeParam = showAllAirports ? 'seaplane' : 'medium';\r\n        const res = await fetch(\r\n          `/api/airports/bounds?minLat=${mapBounds.minLat}&maxLat=${mapBounds.maxLat}&minLon=${mapBounds.minLon}&maxLon=${mapBounds.maxLon}&minSize=${sizeParam}&limit=100&country=US`\r\n        );\r\n        const data = await res.json();\r\n        if (data.airports && data.airports.length > 0) {\r\n          // Merge with cached airports (avoid duplicates)\r\n          setCachedAirports(prev => {\r\n            const existing = new Set(prev.map(a => a.icao));\r\n            const newOnes = data.airports.filter((a: Airport) => !existing.has(a.icao));\r\n            const allAirports = [...prev, ...newOnes];\r\n            // Show airports in current view\r\n            const inView = allAirports.filter(a => \r\n              a.latitude >= mapBounds.minLat - 2 && \r\n              a.latitude <= mapBounds.maxLat + 2 &&\r\n              a.longitude >= mapBounds.minLon - 2 && \r\n              a.longitude <= mapBounds.maxLon + 2\r\n            );\r\n            setAirports(inView);\r\n            return allAirports;\r\n          });\r\n        }\r\n      } catch (e) {\r\n        console.error('Error fetching airports:', e);\r\n        // Fallback to demo airports\r\n        setAirports(DEMO_AIRPORTS.slice(0, 20));\r\n      }\r\n      setLoadingAirports(false);\r\n    };\r\n    \r\n    fetchAirports();\r\n  }, [mapBounds, showAllAirports, mapLoaded]);\r\n\r\n  // Fetch fuel prices for waypoints\r\n  useEffect(() => {\r\n    const fetchPrices = async () => {\r\n      for (const wp of waypoints) {\r\n        if (!fuelPrices[wp.icao]) {\r\n          const price = await getFuelPrice(wp.icao);\r\n          if (price) {\r\n            setFuelPrices(prev => ({ ...prev, [wp.icao]: price }));\r\n          }\r\n        }\r\n      }\r\n    };\r\n    if (waypoints.length > 0) {\r\n      fetchPrices();\r\n    }\r\n  }, [waypoints]);\r\n\r\n  // Handle user fuel price submissions\r\n  useEffect(() => {\r\n    const handleSubmitFuelPrice = async (event: Event) => {\r\n      const customEvent = event as CustomEvent;\r\n      const { icao, price, fuelType } = customEvent.detail;\r\n      \r\n      try {\r\n        const res = await fetch('/api/fuel', {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({\r\n            icao,\r\n            fuelType,\r\n            price,\r\n            source: 'user'\r\n          })\r\n        });\r\n        \r\n        if (res.ok) {\r\n          // Update local state\r\n          setFuelPrices(prev => ({\r\n            ...prev,\r\n            [icao]: {\r\n              ...prev[icao],\r\n              icao,\r\n              price100ll: fuelType === '100LL' ? price : (prev[icao]?.price100ll || null),\r\n              priceJetA: fuelType === 'JetA' ? price : (prev[icao]?.priceJetA || null),\r\n              lastUpdated: new Date().toISOString(),\r\n              source: 'user'\r\n            }\r\n          }));\r\n        }\r\n      } catch (e) {\r\n        console.error('Error submitting fuel price:', e);\r\n      }\r\n    };\r\n    \r\n    window.addEventListener('submitFuelPrice', handleSubmitFuelPrice);\r\n    return () => window.removeEventListener('submitFuelPrice', handleSubmitFuelPrice);\r\n  }, []);\r\n\r\n  // Debounced search ref\r\n  const searchTimeoutRef = useRef<NodeJS.Timeout | null>(null);\r\n\r\n  // Search airports - searches demo + loaded + cached airports\r\n  const handleSearch = useCallback((query: string) => {\r\n    setSearchQuery(query);\r\n    \r\n    // Clear previous timeout\r\n    if (searchTimeoutRef.current) {\r\n      clearTimeout(searchTimeoutRef.current);\r\n    }\r\n    \r\n    if (query.length >= 2) {\r\n      // Debounce search by 150ms\r\n      searchTimeoutRef.current = setTimeout(() => {\r\n        const q = query.toUpperCase();\r\n        // Search demo airports\r\n        const demoResults = DEMO_AIRPORTS.filter(a =>\r\n          a.icao.includes(q) || a.iata?.includes(q) || \r\n          a.name.toUpperCase().includes(q) || a.city?.toUpperCase().includes(q)\r\n        );\r\n        // Search current airports from map\r\n        const mapResults = airports.filter(a =>\r\n          a.icao.toUpperCase().includes(q) || a.iata?.toUpperCase().includes(q) || \r\n          a.name.toUpperCase().includes(q) || a.city?.toUpperCase().includes(q)\r\n        );\r\n        // Search cached airports (accumulated from panning)\r\n        const cachedResults = cachedAirports.filter(a =>\r\n          a.icao.toUpperCase().includes(q) || a.iata?.toUpperCase().includes(q) || \r\n          a.name.toUpperCase().includes(q) || a.city?.toUpperCase().includes(q)\r\n        );\r\n        // Combine and dedupe, then filter by region if international is disabled\r\n        const combined = [...demoResults];\r\n        const seen = new Set(combined.map(a => a.icao));\r\n        for (const a of [...mapResults, ...cachedResults]) {\r\n          if (!seen.has(a.icao)) {\r\n            // Only include if in North America or international is enabled\r\n            if (showInternational || isNorthAmerica(a)) {\r\n              seen.add(a.icao);\r\n              combined.push(a);\r\n            }\r\n          }\r\n        }\r\n        setSearchResults(combined.slice(0, 10));\r\n        setShowSearchResults(true);\r\n      }, 150);\r\n    } else {\r\n      setSearchResults([]);\r\n      setShowSearchResults(false);\r\n    }\r\n  }, [airports, cachedAirports, showInternational]);\r\n\r\n  // Cleanup timeout on unmount\r\n  useEffect(() => {\r\n    return () => {\r\n      if (searchTimeoutRef.current) {\r\n        clearTimeout(searchTimeoutRef.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  // Check for mobile and orientation\r\n  useEffect(() => {\r\n    const checkOrientation = () => {\r\n      const isMobile = window.innerWidth < 768;\r\n      const isPortrait = window.innerHeight > window.innerWidth;\r\n      \r\n      if (isMobile && isPortrait && !orientationDismissed) {\r\n        setShowOrientationWarning(true);\r\n      } else {\r\n        setShowOrientationWarning(false);\r\n      }\r\n    };\r\n\r\n    checkOrientation();\r\n    window.addEventListener('resize', checkOrientation);\r\n    window.addEventListener('orientationchange', checkOrientation);\r\n    \r\n    return () => {\r\n      window.removeEventListener('resize', checkOrientation);\r\n      window.removeEventListener('orientationchange', checkOrientation);\r\n    };\r\n  }, [orientationDismissed]);\r\n\r\n  // Add waypoint\r\n  const addWaypoint = (airport: Airport, index?: number) => {\r\n    // Check if already in route\r\n    if (waypoints.find(w => w.icao === airport.icao)) {\r\n      alert('Airport already in route');\r\n      return;\r\n    }\r\n\r\n    // Check free tier limit for waypoints\r\n    if (!isPro && waypoints.length >= FREE_TIER_LIMITS.maxWaypoints) {\r\n      setUpgradeFeature('More than 6 waypoints');\r\n      setUpgradeModalOpen(true);\r\n      return;\r\n    }\r\n\r\n    const wp: Waypoint = {\r\n      id: crypto.randomUUID(),\r\n      icao: airport.icao,\r\n      name: airport.name,\r\n      city: airport.city,\r\n      state: (airport as any).state,\r\n      latitude: airport.latitude,\r\n      longitude: airport.longitude,\r\n      sequence: index ?? waypoints.length,\r\n      type: airport.type\r\n    };\r\n    \r\n    if (index !== undefined) {\r\n      const newWaypoints = [...waypoints];\r\n      newWaypoints.splice(index, 0, wp);\r\n      setWaypoints(newWaypoints.map((w, i) => ({ ...w, sequence: i })));\r\n    } else {\r\n      setWaypoints([...waypoints, wp]);\r\n    }\r\n    \r\n    // Center map on new waypoint\r\n    setMapCenter([airport.latitude, airport.longitude]);\r\n    setMapZoom(8);\r\n    setSearchQuery('');\r\n    setShowSearchResults(false);\r\n  };\r\n\r\n  // Remove waypoint\r\n  const removeWaypoint = (id: string) => {\r\n    setWaypoints(waypoints.filter(w => w.id !== id).map((w, i) => ({ ...w, sequence: i })));\r\n  };\r\n\r\n  // Optimize route for shortest total distance (simple nearest neighbor)\r\n  const optimizeRoute = () => {\r\n    if (waypoints.length <= 2) return;\r\n    \r\n    const unvisited = waypoints.slice(1, waypoints.length - 1); // Keep first and last\r\n    const optimized: Waypoint[] = [waypoints[0]];\r\n    \r\n    let current = waypoints[0];\r\n    while (unvisited.length > 0) {\r\n      let nearestIdx = 0;\r\n      let nearestDist = Infinity;\r\n      \r\n      unvisited.forEach((wp, idx) => {\r\n        const dist = calculateDistance(current.latitude, current.longitude, wp.latitude, wp.longitude);\r\n        if (dist < nearestDist) {\r\n          nearestDist = dist;\r\n          nearestIdx = idx;\r\n        }\r\n      });\r\n      \r\n      const nearest = unvisited.splice(nearestIdx, 1)[0];\r\n      optimized.push(nearest);\r\n      current = nearest;\r\n    }\r\n    \r\n    optimized.push(waypoints[waypoints.length - 1]); // Add last\r\n    \r\n    setWaypoints(optimized.map((w, i) => ({ ...w, sequence: i })));\r\n  };\r\n\r\n  // Toggle round trip (add first airport to end, or remove if already there)\r\n  const toggleRoundTrip = () => {\r\n    const first = waypoints[0];\r\n    const last = waypoints[waypoints.length - 1];\r\n    \r\n    if (first.icao === last.icao) {\r\n      // Already round trip - remove duplicate\r\n      setWaypoints(waypoints.slice(0, -1).map((w, i) => ({ ...w, sequence: i })));\r\n    } else {\r\n      // Add first airport to end\r\n      const returnWp: Waypoint = {\r\n        ...first,\r\n        id: crypto.randomUUID(),\r\n        sequence: waypoints.length\r\n      };\r\n      setWaypoints([...waypoints, returnWp]);\r\n    }\r\n  };\r\n\r\n  // Fit map to show all waypoints\r\n  const fitMapToWaypoints = () => {\r\n    if (waypoints.length === 0) return;\r\n    if (waypoints.length === 1) {\r\n      setMapCenter([waypoints[0].latitude, waypoints[0].longitude]);\r\n      setMapZoom(10);\r\n      return;\r\n    }\r\n    \r\n    let minLat = Infinity, maxLat = -Infinity;\r\n    let minLon = Infinity, maxLon = -Infinity;\r\n    \r\n    waypoints.forEach(wp => {\r\n      minLat = Math.min(minLat, wp.latitude);\r\n      maxLat = Math.max(maxLat, wp.latitude);\r\n      minLon = Math.min(minLon, wp.longitude);\r\n      maxLon = Math.max(maxLon, wp.longitude);\r\n    });\r\n    \r\n    const centerLat = (minLat + maxLat) / 2;\r\n    const centerLon = (minLon + maxLon) / 2;\r\n    \r\n    setMapCenter([centerLat, centerLon]);\r\n    \r\n    // Calculate zoom to fit\r\n    const latDiff = maxLat - minLat;\r\n    const lonDiff = maxLon - minLon;\r\n    const maxDiff = Math.max(latDiff, lonDiff);\r\n    \r\n    let zoom = 8;\r\n    if (maxDiff < 0.5) zoom = 12;\r\n    else if (maxDiff < 1) zoom = 10;\r\n    else if (maxDiff < 2) zoom = 9;\r\n    else if (maxDiff < 5) zoom = 7;\r\n    else if (maxDiff < 10) zoom = 6;\r\n    else zoom = 5;\r\n    \r\n    setMapZoom(zoom);\r\n  };\r\n\r\n  // Move waypoint\r\n  const moveWaypoint = (id: string, direction: 'up' | 'down') => {\r\n    const index = waypoints.findIndex(w => w.id === id);\r\n    if (index < 0) return;\r\n    \r\n    const newIndex = direction === 'up' ? index - 1 : index + 1;\r\n    if (newIndex < 0 || newIndex >= waypoints.length) return;\r\n    \r\n    const newWaypoints = [...waypoints];\r\n    [newWaypoints[index], newWaypoints[newIndex]] = [newWaypoints[newIndex], newWaypoints[index]];\r\n    setWaypoints(newWaypoints.map((w, i) => ({ ...w, sequence: i })));\r\n  };\r\n\r\n  // Parse GPX file\r\n  const parseGPX = (content: string) => {\r\n    const parser = new DOMParser();\r\n    const doc = parser.parseFromString(content, 'text/xml');\r\n    const wpts = doc.querySelectorAll('wpt');\r\n    \r\n    const newWaypoints: Waypoint[] = [];\r\n    wpts.forEach((wpt, i) => {\r\n      const lat = parseFloat(wpt.getAttribute('lat') || '0');\r\n      const lon = parseFloat(wpt.getAttribute('lon') || '0');\r\n      const name = wpt.querySelector('name')?.textContent || `WPT${i + 1}`;\r\n      const ele = wpt.querySelector('ele')?.textContent;\r\n      \r\n      // Try to find matching airport in our DB\r\n      const matchingAirport = DEMO_AIRPORTS.find(a => \r\n        a.icao.toUpperCase() === name.toUpperCase().substring(0, 4)\r\n      );\r\n      \r\n      newWaypoints.push({\r\n        id: crypto.randomUUID(),\r\n        icao: matchingAirport?.icao || name.substring(0, 4),\r\n        name: matchingAirport?.name || name,\r\n        latitude: matchingAirport?.latitude || lat,\r\n        longitude: matchingAirport?.longitude || lon,\r\n        altitude: ele ? parseInt(ele) : undefined,\r\n        sequence: i\r\n      });\r\n    });\r\n    \r\n    if (newWaypoints.length > 0) {\r\n      setWaypoints(newWaypoints);\r\n      // Center on first waypoint\r\n      setMapCenter([newWaypoints[0].latitude, newWaypoints[0].longitude]);\r\n      setMapZoom(8);\r\n    }\r\n  };\r\n\r\n  // Parse FPL file (simple parsing)\r\n  const parseFPL = (content: string) => {\r\n    const lines = content.split('\\n');\r\n    const newWaypoints: Waypoint[] = [];\r\n    let seq = 0;\r\n    \r\n    for (const line of lines) {\r\n      // Look for waypoint patterns (5-letter names or airport codes)\r\n      const match = line.match(/([A-Z]{4,5})/g);\r\n      if (match) {\r\n        for (const wpId of match) {\r\n          const airport = DEMO_AIRPORTS.find(a => \r\n            a.icao === wpId || a.iata === wpId\r\n          );\r\n          if (airport) {\r\n            newWaypoints.push({\r\n              id: crypto.randomUUID(),\r\n              icao: airport.icao,\r\n              name: airport.name,\r\n              city: airport.city,\r\n              latitude: airport.latitude,\r\n              longitude: airport.longitude,\r\n              sequence: seq++\r\n            });\r\n          }\r\n        }\r\n      }\r\n    }\r\n    \r\n    if (newWaypoints.length > 0) {\r\n      setWaypoints(newWaypoints);\r\n      setMapCenter([newWaypoints[0].latitude, newWaypoints[0].longitude]);\r\n      setMapZoom(8);\r\n    }\r\n  };\r\n\r\n  // Parse flightplandatabase.com JSON format\r\n  const parseFPDBJson = async (content: string) => {\r\n    try {\r\n      const data = JSON.parse(content);\r\n      const newWaypoints: Waypoint[] = [];\r\n      \r\n      // Handle flightplandatabase.com JSON format\r\n      // The route is in data.route as array of waypoints\r\n      const route = data.route || data.plan?.route || [];\r\n      \r\n      for (const wp of route) {\r\n        // Each waypoint can have: id, name, type, lat, lon, airway\r\n        const lat = wp.lat || wp.latitude;\r\n        const lon = wp.lon || wp.longitude;\r\n        const icao = wp.id || wp.icao || wp.name;\r\n        \r\n        // Try to find airport in our database\r\n        let airport = DEMO_AIRPORTS.find(a => a.icao === icao?.substring(0, 4));\r\n        \r\n        if (airport || (lat && lon)) {\r\n          newWaypoints.push({\r\n            id: crypto.randomUUID(),\r\n            icao: airport?.icao || icao?.substring(0, 4) || 'WAYPT',\r\n            name: airport?.name || icao || 'Waypoint',\r\n            city: airport?.city,\r\n            latitude: airport?.latitude || lat,\r\n            longitude: airport?.longitude || lon,\r\n            sequence: newWaypoints.length\r\n          });\r\n        }\r\n      }\r\n      \r\n      if (newWaypoints.length > 0) {\r\n        setWaypoints(newWaypoints);\r\n        setMapCenter([newWaypoints[0].latitude, newWaypoints[0].longitude]);\r\n        setMapZoom(6);\r\n        return true;\r\n      }\r\n    } catch (e) {\r\n      console.error('Error parsing FPDB JSON:', e);\r\n    }\r\n    return false;\r\n  };\r\n\r\n  // Parse flightplandatabase.com CSV format\r\n  const parseFPDBCSV = (content: string) => {\r\n    try {\r\n      const lines = content.split('\\n');\r\n      const newWaypoints: Waypoint[] = [];\r\n      \r\n      // Skip header if present, find waypoint data\r\n      for (const line of lines) {\r\n        const parts = line.split(',').map(p => p.trim().replace(/\"/g, ''));\r\n        if (parts.length < 3) continue;\r\n        \r\n        // Try to extract waypoint info - format varies\r\n        // Could be: id,type,lat,lon,airway or waypoint,lat,lon,alt,etc.\r\n        let lat: number | undefined, lon: number | undefined, icao: string | undefined;\r\n        \r\n        // Try to find lat/lon in the line\r\n        for (let i = 0; i < parts.length; i++) {\r\n          const val = parseFloat(parts[i]);\r\n          if (!isNaN(val)) {\r\n            if (val >= -90 && val <= 90 && !lat) lat = val;\r\n            else if (val >= -180 && val <= 180 && !lon) lon = val;\r\n          }\r\n          // Look for 4-letter ICAO codes\r\n          if (parts[i].match(/^[A-Z]{4}$/)) {\r\n            icao = parts[i];\r\n          }\r\n        }\r\n        \r\n        if (lat && lon) {\r\n          const airport = DEMO_AIRPORTS.find(a => a.icao === icao);\r\n          newWaypoints.push({\r\n            id: crypto.randomUUID(),\r\n            icao: airport?.icao || icao || `WPT${newWaypoints.length}`,\r\n            name: airport?.name || icao || 'Waypoint',\r\n            city: airport?.city,\r\n            latitude: airport?.latitude || lat,\r\n            longitude: airport?.longitude || lon,\r\n            sequence: newWaypoints.length\r\n          });\r\n        }\r\n      }\r\n      \r\n      if (newWaypoints.length > 0) {\r\n        setWaypoints(newWaypoints);\r\n        setMapCenter([newWaypoints[0].latitude, newWaypoints[0].longitude]);\r\n        setMapZoom(6);\r\n        return true;\r\n      }\r\n    } catch (e) {\r\n      console.error('Error parsing FPDB CSV:', e);\r\n    }\r\n    return false;\r\n  };\r\n\r\n  // Import from flightplandatabase.com by plan ID\r\n  const importFromFPDB = async (planId: string) => {\r\n    try {\r\n      // Fetch from flightplandatabase.com API (public endpoint)\r\n      const res = await fetch(`https://flightplandatabase.com/api/plan/${planId}?format=json`);\r\n      if (!res.ok) {\r\n        alert('Plan not found. Check the plan ID.');\r\n        return;\r\n      }\r\n      const data = await res.json();\r\n      \r\n      // Parse the route from FPDB format\r\n      const newWaypoints: Waypoint[] = [];\r\n      const route = data.route || [];\r\n      \r\n      for (const wp of route) {\r\n        const lat = wp.lat;\r\n        const lon = wp.lon;\r\n        const waypointId = wp.id;\r\n        \r\n        // Try to find airport in our database\r\n        const airport = DEMO_AIRPORTS.find(a => a.icao === waypointId?.substring(0, 4));\r\n        \r\n        if (airport || (lat && lon)) {\r\n          newWaypoints.push({\r\n            id: crypto.randomUUID(),\r\n            icao: airport?.icao || waypointId?.substring(0, 4) || 'WAYPT',\r\n            name: airport?.name || waypointId || 'Waypoint',\r\n            city: airport?.city,\r\n            latitude: airport?.latitude || lat,\r\n            longitude: airport?.longitude || lon,\r\n            sequence: newWaypoints.length\r\n          });\r\n        }\r\n      }\r\n      \r\n      if (newWaypoints.length > 0) {\r\n        setWaypoints(newWaypoints);\r\n        setMapCenter([newWaypoints[0].latitude, newWaypoints[0].longitude]);\r\n        setMapZoom(6);\r\n        \r\n        // Also fill in flight plan details if available\r\n        if (data.origin) {\r\n          setDepartureTime(data.departureTime || '');\r\n        }\r\n        if (data.altitude) {\r\n          setCruisingAlt(data.altitude);\r\n        }\r\n        \r\n        alert(`Imported ${newWaypoints.length} waypoints from flightplandatabase.com!`);\r\n      } else {\r\n        alert('No waypoints found in this plan.');\r\n      }\r\n    } catch (e) {\r\n      console.error('Error importing from FPDB:', e);\r\n      alert('Failed to import plan. Make sure the plan ID is correct.');\r\n    }\r\n  };\r\n\r\n  // Parse simple route string (comma or space separated ICAOs)\r\n  const parseRouteString = (content: string) => {\r\n    const newWaypoints: Waypoint[] = [];\r\n    \r\n    // Split by comma, space, or newline\r\n    const tokens = content.split(/[,\\s\\n]+/).filter(t => t.length >= 3 && t.length <= 5);\r\n    \r\n    for (const token of tokens) {\r\n      const icao = token.toUpperCase().replace(/[^A-Z]/g, '').substring(0, 4);\r\n      if (icao.length < 3) continue;\r\n      \r\n      const airport = DEMO_AIRPORTS.find(a => a.icao === icao || a.iata === icao);\r\n      if (airport) {\r\n        newWaypoints.push({\r\n          id: crypto.randomUUID(),\r\n          icao: airport.icao,\r\n          name: airport.name,\r\n          city: airport.city,\r\n          latitude: airport.latitude,\r\n          longitude: airport.longitude,\r\n          sequence: newWaypoints.length\r\n        });\r\n      }\r\n    }\r\n    \r\n    if (newWaypoints.length > 0) {\r\n      setWaypoints(newWaypoints);\r\n      setMapCenter([newWaypoints[0].latitude, newWaypoints[0].longitude]);\r\n      setMapZoom(6);\r\n      return true;\r\n    }\r\n    return false;\r\n  };\r\n\r\n  // Parse X-Plane FMS format\r\n  const parseFMS = (content: string) => {\r\n    const lines = content.split('\\n');\r\n    const newWaypoints: Waypoint[] = [];\r\n    \r\n    for (const line of lines) {\r\n      // FMS format: 5 WAYPOINT_NAME lat lon alt (approximate)\r\n      // Or: I waypoint lat lon altitude airWay\r\n      const parts = line.trim().split(/[\\s,]+/);\r\n      if (parts.length < 4) continue;\r\n      \r\n      // Check if it's a valid line (starts with number or I)\r\n      if (!parts[0].match(/^[0-9I]/)) continue;\r\n      \r\n      const waypointName = parts[1] || parts[0];\r\n      const lat = parseFloat(parts[parts.length - 3]);\r\n      const lon = parseFloat(parts[parts.length - 2]);\r\n      \r\n      if (!isNaN(lat) && !isNaN(lon)) {\r\n        const airport = DEMO_AIRPORTS.find(a => a.icao === waypointName.substring(0, 4));\r\n        newWaypoints.push({\r\n          id: crypto.randomUUID(),\r\n          icao: airport?.icao || waypointName.substring(0, 4),\r\n          name: airport?.name || waypointName,\r\n          city: airport?.city,\r\n          latitude: airport?.latitude || lat,\r\n          longitude: airport?.longitude || lon,\r\n          sequence: newWaypoints.length\r\n        });\r\n      }\r\n    }\r\n    \r\n    if (newWaypoints.length > 0) {\r\n      setWaypoints(newWaypoints);\r\n      setMapCenter([newWaypoints[0].latitude, newWaypoints[0].longitude]);\r\n      setMapZoom(6);\r\n      return true;\r\n    }\r\n    return false;\r\n  };\r\n\r\n  // Parse VATSIM/IVAO flight plan (plain text)\r\n  const parseVATSIM = (content: string) => {\r\n    const lines = content.split('\\n');\r\n    const newWaypoints: Waypoint[] = [];\r\n    let foundRoute = false;\r\n    \r\n    for (const line of lines) {\r\n      const upperLine = line.toUpperCase();\r\n      \r\n      // Look for ROUTE: or similar markers\r\n      if (upperLine.includes('ROUTE:') || upperLine.includes('SID') || upperLine.includes('STAR')) {\r\n        foundRoute = true;\r\n      }\r\n      \r\n      if (foundRoute) {\r\n        // Extract ICAO codes (4 letters)\r\n        const matches = line.match(/[A-Z]{4}/g);\r\n        if (matches) {\r\n          for (const icao of matches) {\r\n            const airport = DEMO_AIRPORTS.find(a => a.icao === icao);\r\n            if (airport && !newWaypoints.find(w => w.icao === icao)) {\r\n              newWaypoints.push({\r\n                id: crypto.randomUUID(),\r\n                icao: airport.icao,\r\n                name: airport.name,\r\n                city: airport.city,\r\n                latitude: airport.latitude,\r\n                longitude: airport.longitude,\r\n                sequence: newWaypoints.length\r\n              });\r\n            }\r\n          }\r\n        }\r\n        \r\n        // Stop at next section\r\n        if (upperLine.includes('REMARKS:') || upperLine.includes('NOTES:')) {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    \r\n    if (newWaypoints.length > 0) {\r\n      setWaypoints(newWaypoints);\r\n      setMapCenter([newWaypoints[0].latitude, newWaypoints[0].longitude]);\r\n      setMapZoom(6);\r\n      return true;\r\n    }\r\n    return false;\r\n  };\r\n\r\n  // Handle file upload\r\n  const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (!file) return;\r\n    \r\n    const reader = new FileReader();\r\n    reader.onload = async (event) => {\r\n      const content = event.target?.result as string;\r\n      const ext = file.name.toLowerCase();\r\n      \r\n      if (ext.endsWith('.gpx')) {\r\n        parseGPX(content);\r\n      } else if (ext.endsWith('.fpl')) {\r\n        parseFPL(content);\r\n      } else if (ext.endsWith('.json')) {\r\n        const success = await parseFPDBJson(content);\r\n        if (!success) alert('Could not parse JSON file. Make sure it\\'s from flightplandatabase.com');\r\n      } else if (ext.endsWith('.csv')) {\r\n        const success = parseFPDBCSV(content);\r\n        if (!success) alert('Could not parse CSV file. Make sure it\\'s from flightplandatabase.com');\r\n      } else {\r\n        alert('Please upload a .gpx, .fpl, .json, or .csv file');\r\n      }\r\n    };\r\n    reader.readAsText(file);\r\n  };\r\n\r\n  // Fetch weather for all waypoints\r\n  const fetchWaypointWeather = async () => {\r\n    if (waypoints.length === 0) return;\r\n    setWeatherLoading(true);\r\n    const weatherData: Record<string, any> = {};\r\n    \r\n    // Determine if we should get forecast (TAF) or current (METAR)\r\n    const isForecast = departureTime && new Date(departureTime) > new Date();\r\n    const forecastDate = departureTime ? new Date(departureTime).toISOString().split('T')[0] : null;\r\n    \r\n    for (const wp of waypoints) {\r\n      try {\r\n        // If departure time is in the future, get TAF forecast\r\n        let url = `/api/weather?icao=${wp.icao}`;\r\n        if (isForecast && forecastDate) {\r\n          url += `&forecast=${forecastDate}`;\r\n        }\r\n        \r\n        const res = await fetch(url);\r\n        if (res.ok) {\r\n          const data = await res.json();\r\n          // Get TAF forecast if available, otherwise METAR\r\n          const tafData = data.taf?.[0];\r\n          const metarData = data.data?.[0];\r\n          \r\n          // Use forecast if departure is in future, otherwise current\r\n          weatherData[wp.icao] = isForecast && tafData ? {\r\n            ...tafData,\r\n            isForecast: true,\r\n            forecastFor: forecastDate\r\n          } : (metarData || null);\r\n        }\r\n      } catch (e) {\r\n        weatherData[wp.icao] = null;\r\n      }\r\n    }\r\n    \r\n    setWaypointWeather(weatherData);\r\n    setWeatherLoading(false);\r\n  };\r\n\r\n  // Fetch route weather with segment calculations\r\n  const fetchRouteWeather = async () => {\r\n    if (waypoints.length < 2) return;\r\n    setLoadingRouteWeather(true);\r\n    \r\n    try {\r\n      const routePoints = waypoints.map(wp => ({\r\n        icao: wp.icao,\r\n        lat: wp.latitude,\r\n        lon: wp.longitude\r\n      }));\r\n      \r\n      const res = await fetch('/api/route-weather', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          waypoints: routePoints,\r\n          altitude: cruisingAlt,\r\n          aircraftTAS: selectedAircraft.speed\r\n        })\r\n      });\r\n      \r\n      if (res.ok) {\r\n        const data = await res.json();\r\n        setRouteWeather(data);\r\n      }\r\n    } catch (e) {\r\n      console.error('Route weather error:', e);\r\n    }\r\n    \r\n    setLoadingRouteWeather(false);\r\n  };\r\n\r\n  // Calculate route statistics\r\n  const routeStats = useMemo(() => {\r\n    if (waypoints.length < 2) return null;\r\n    \r\n    let totalDist = 0;\r\n    const segments: number[] = [];\r\n    const legs: { from: Waypoint; to: Waypoint; distance: number; fuelNeeded: number; cost: number }[] = [];\r\n    \r\n    for (let i = 1; i < waypoints.length; i++) {\r\n      const dist = calculateDistance(\r\n        waypoints[i - 1].latitude, waypoints[i - 1].longitude,\r\n        waypoints[i].latitude, waypoints[i].longitude\r\n      );\r\n      totalDist += dist;\r\n      segments.push(dist);\r\n      \r\n      // Calculate fuel and cost for this leg\r\n      const legFuel = (dist / selectedAircraft.speed) * selectedAircraft.burnRate * 1.25; // with reserves\r\n      const fuelPrice = fuelPrices[waypoints[i].icao]?.price100ll || 6.50;\r\n      const legCost = legFuel * fuelPrice;\r\n      \r\n      legs.push({\r\n        from: waypoints[i - 1],\r\n        to: waypoints[i],\r\n        distance: dist,\r\n        fuelNeeded: legFuel,\r\n        cost: legCost\r\n      });\r\n    }\r\n    \r\n    // Estimate total fuel needed with reserves\r\n    const flightHours = totalDist / selectedAircraft.speed;\r\n    const fuelNeeded = flightHours * selectedAircraft.burnRate;\r\n    const fuelWithReserves = fuelNeeded * 1.25; // 25% reserves\r\n    \r\n    // Calculate estimated cost - fuel only\r\n    let fuelCost = 0;\r\n    for (const wp of waypoints) {\r\n      const price = fuelPrices[wp.icao]?.price100ll || 6.50;\r\n      fuelCost += price * (fuelWithReserves / waypoints.length);\r\n    }\r\n    \r\n    // Calculate landing fees (based on airport size)\r\n    let landingFees = 0;\r\n    if (includeLandingFees) {\r\n      for (let i = 1; i < waypoints.length; i++) {\r\n        const wp = waypoints[i];\r\n        // Large airports: $50, Medium: $30, Small: $15\r\n        if (wp.type === 'large_airport') landingFees += 50;\r\n        else if (wp.type === 'medium_airport') landingFees += 30;\r\n        else landingFees += 15;\r\n      }\r\n    }\r\n    \r\n    // Calculate FBO fees (if enabled and available)\r\n    let fboFees = 0;\r\n    if (includeFboFees) {\r\n      for (let i = 1; i < waypoints.length; i++) {\r\n        const wp = waypoints[i];\r\n        if (fboFeesData[wp.icao]) {\r\n          fboFees += fboFeesData[wp.icao].fee25 || 0; // Use typical fee\r\n        }\r\n      }\r\n    }\r\n    \r\n    const totalCost = fuelCost + landingFees + fboFees;\r\n    const costPerPerson = soulsOnBoard > 1 ? totalCost / soulsOnBoard : totalCost;\r\n    \r\n    // Determine if fuel stops needed\r\n    const fuelStops: Waypoint[] = [];\r\n    const fuelCapacity = selectedAircraft.fuelCapacity * (departureFuel / 100);\r\n    let accumulatedDist = 0;\r\n    \r\n    for (let i = 1; i < waypoints.length; i++) {\r\n      accumulatedDist += segments[i - 1];\r\n      if (accumulatedDist > fuelCapacity * 0.6) { // Refuel at 60% capacity\r\n        fuelStops.push(waypoints[i]);\r\n        accumulatedDist = 0;\r\n      }\r\n    }\r\n    \r\n    return {\r\n      totalDistance: totalDist,\r\n      flightHours: flightHours.toFixed(1),\r\n      fuelNeeded: fuelWithReserves.toFixed(1),\r\n      estimatedCost: totalCost.toFixed(0),\r\n      fuelCost: fuelCost.toFixed(0),\r\n      landingFees: landingFees,\r\n      fboFees: fboFees.toFixed(0),\r\n      costPerPerson: costPerPerson.toFixed(0),\r\n      fuelStops,\r\n      segments,\r\n      legs\r\n    };\r\n  }, [waypoints, selectedAircraft, departureFuel, fuelPrices, includeLandingFees, includeFboFees, soulsOnBoard]);\r\n\r\n  // Save flight plan\r\n  const saveFlightPlan = async () => {\r\n    if (waypoints.length < 2) {\r\n      alert('Please add at least departure and destination');\r\n      return;\r\n    }\r\n\r\n    // Check free tier limit for saved plans\r\n    if (!isPro && savedPlans.filter(p => !p.isDemo).length >= FREE_TIER_LIMITS.maxSavedPlans) {\r\n      setUpgradeFeature('More than 5 saved flight plans');\r\n      setUpgradeModalOpen(true);\r\n      return;\r\n    }\r\n    \r\n    const planName = flightPlanName || `Flight Plan ${new Date().toLocaleDateString()}`;\r\n    \r\n    const plan = {\r\n      name: planName,\r\n      callsign,\r\n      aircraftType: aircraftType || selectedAircraft.name,\r\n      aircraftSpeed: selectedAircraft.speed,\r\n      aircraftBurnRate: selectedAircraft.burnRate,\r\n      aircraftFuelCapacity: selectedAircraft.fuelCapacity,\r\n      pilotName,\r\n      departureTime,\r\n      cruisingAlt,\r\n      alternateIcao,\r\n      remarks,\r\n      soulsOnBoard,\r\n      departureFuel,\r\n      departureIcao: waypoints[0]?.icao,\r\n      arrivalIcao: waypoints[waypoints.length - 1]?.icao,\r\n      waypoints: waypoints.map(w => ({\r\n        icao: w.icao,\r\n        name: w.name,\r\n        city: w.city,\r\n        latitude: w.latitude,\r\n        longitude: w.longitude,\r\n        altitude: w.altitude,\r\n        sequence: w.sequence\r\n      })),\r\n      createdAt: new Date().toISOString()\r\n    };\r\n    \r\n    // If logged in, save to database\r\n    if (status === 'authenticated') {\r\n      try {\r\n        // If we have a current plan loaded, update it\r\n        // Only create new if name changed OR no current plan\r\n        if (currentPlanId) {\r\n          // Check if name changed - if so, create new plan instead\r\n          const currentPlan = savedPlans.find((p: any) => p.id === currentPlanId);\r\n          if (currentPlan && currentPlan.name !== planName) {\r\n            // Name changed - create new plan\r\n            console.log('Name changed, creating new plan');\r\n          } else {\r\n            // Same name or no current plan found - update existing\r\n            console.log('Updating existing plan:', currentPlanId);\r\n            const res = await fetch(`/api/flight-plans?id=${currentPlanId}`, {\r\n              method: 'PUT',\r\n              headers: { 'Content-Type': 'application/json' },\r\n              body: JSON.stringify(plan)\r\n            });\r\n            \r\n            if (res.ok) {\r\n              const data = await res.json();\r\n              setSavedPlans(prev => prev.map(p => p.id === currentPlanId ? data.flightPlan : p));\r\n              alert('Flight plan updated!');\r\n              return;\r\n            } else {\r\n              const errData = await res.json();\r\n              console.error('Update failed:', errData);\r\n              alert('Failed to update flight plan: ' + (errData.error || 'Unknown error'));\r\n              return;\r\n            }\r\n          }\r\n        }\r\n        \r\n        // Either no current plan or name changed - create new\r\n        console.log('Creating new plan');\r\n        const res = await fetch('/api/flight-plans', {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify(plan)\r\n        });\r\n        \r\n        if (res.ok) {\r\n          const data = await res.json();\r\n          setSavedPlans(prev => [data.flightPlan, ...prev]);\r\n          setCurrentPlanId(data.flightPlan.id);\r\n          alert('Flight plan saved!');\r\n        } else {\r\n          const errData = await res.json();\r\n          console.error('Save failed:', errData);\r\n          alert('Failed to save flight plan: ' + (errData.error || 'Unknown error'));\r\n        }\r\n      } catch (e) {\r\n        console.error('Error saving:', e);\r\n        alert('Error saving flight plan');\r\n      }\r\n    } else {\r\n      // Save to localStorage only (when not logged in)\r\n      // If we have a current local plan with same name, update it\r\n      const currentLocalPlan = savedPlans.find((p: any) => p.fromLocal && p.id === currentPlanId);\r\n      if (currentLocalPlan && currentLocalPlan.name === planName) {\r\n        const newPlans = savedPlans.map((p: any) => \r\n          (p.fromLocal && p.id === currentPlanId) ? { ...plan, id: currentPlanId, fromLocal: true } : p\r\n        );\r\n        setSavedPlans(newPlans);\r\n        saveToLocalStorage(newPlans);\r\n        alert('Flight plan updated!');\r\n        return;\r\n      }\r\n      \r\n      // Name changed or new - create new\r\n      const newPlans = [...savedPlans.filter(p => !p.id || !p.fromLocal), { ...plan, id: Date.now(), fromLocal: true }];\r\n      setSavedPlans(newPlans);\r\n      saveToLocalStorage(newPlans);\r\n      alert('Flight plan saved locally (log in to save to your account)');\r\n    }\r\n  };\r\n  \r\n  // Delete flight plan\r\n  const deleteFlightPlan = async (planId: string | number) => {\r\n    const plan = savedPlans.find((p, i) => (p.id || i) === planId);\r\n    \r\n    if (plan?.id) {\r\n      // Database plan - delete from API\r\n      try {\r\n        await fetch(`/api/flight-plans?id=${plan.id}`, { method: 'DELETE' });\r\n      } catch (e) {\r\n        console.error('Error deleting:', e);\r\n      }\r\n    }\r\n    \r\n    // Remove from local state\r\n    const newPlans = savedPlans.filter((p, i) => (p.id || i) !== planId);\r\n    setSavedPlans(newPlans);\r\n    \r\n    // If it was a local-only plan, update localStorage\r\n    if (!plan?.id && typeof planId === 'number') {\r\n      saveToLocalStorage(newPlans.filter(p => !p.id));\r\n    }\r\n  };\r\n  \r\n  // Load a flight plan\r\n  const loadFlightPlan = (plan: any) => {\r\n    setFlightPlanName(plan.name || '');\r\n    setCallsign(plan.callsign || '');\r\n    setAircraftType(plan.aircraftType || '');\r\n    setPilotName(plan.pilotName || '');\r\n    setDepartureTime(plan.departureTime || '');\r\n    setCruisingAlt(plan.cruisingAlt || 5500);\r\n    setAlternateIcao(plan.alternateIcao || '');\r\n    setRemarks(plan.remarks || '');\r\n    setSoulsOnBoard(plan.soulsOnBoard || 1);\r\n    setDepartureFuel(plan.departureFuel || 100);\r\n    \r\n    // Mark this plan as loaded so future saves update it\r\n    if (plan.id) {\r\n      setCurrentPlanId(plan.id);\r\n    }\r\n    \r\n    // Set aircraft if it matches one of our profiles\r\n    if (plan.aircraftType) {\r\n      const ac = AIRCRAFT_PROFILES.find(p => p.name === plan.aircraftType);\r\n      if (ac) setSelectedAircraft(ac);\r\n    }\r\n    \r\n    // Handle both array waypoints and relation waypoints\r\n    const waypointsData = plan.waypoints || (plan.waypoints === undefined ? [] : []);\r\n    \r\n    if (waypointsData.length > 0) {\r\n      const loadedWaypoints = waypointsData.map((w: any, i: number) => ({\r\n        id: crypto.randomUUID(),\r\n        icao: w.icao,\r\n        name: w.name || w.icao,\r\n        city: w.city,\r\n        latitude: w.latitude,\r\n        longitude: w.longitude,\r\n        altitude: w.altitude,\r\n        sequence: i\r\n      }));\r\n      setWaypoints(loadedWaypoints);\r\n      \r\n      // Center map on first waypoint\r\n      if (loadedWaypoints.length > 0) {\r\n        setMapCenter([loadedWaypoints[0].latitude, loadedWaypoints[0].longitude]);\r\n        setMapZoom(8);\r\n      }\r\n    }\r\n    \r\n    setShowPlanList(false);\r\n  };\r\n  \r\n  // Marker click handler - for popup Add to Route button\r\n  const handleAirportAdd = (airport: Airport) => {\r\n    addWaypoint(airport);\r\n    // Center map on airport and zoom out to see area (not filling screen)\r\n    setMapCenter([airport.latitude, airport.longitude]);\r\n    setMapZoom(6); // Zoom out more so airport doesn't fill screen\r\n  };\r\n\r\n  // Find nearest cheap fuel\r\n  const findNearestFuel = async () => {\r\n    // Use first waypoint as center, or ask user\r\n    const centerIcao = waypoints[0]?.icao || 'KORD'; // Default to ORD\r\n    const radius = 50; // nautical miles\r\n    \r\n    try {\r\n      const res = await fetch(`/api/fuel/nearest?icao=${centerIcao}&radius=${radius}`);\r\n      const data = await res.json();\r\n      \r\n      if (data.results && data.results.length > 0) {\r\n        const resultsText = data.results.slice(0, 5).map((r: any) => \r\n          `${r.icao} - $${r.price100ll}/gal (${r.distanceNm}nm ${r.direction})`\r\n        ).join('\\n');\r\n        alert(`Nearest Cheap Fuel within ${radius}nm of ${centerIcao}:\\n\\n${resultsText}`);\r\n        \r\n        // Add cheapest to route\r\n        if (confirm('Add cheapest to route?')) {\r\n          const cheapest = data.results[0];\r\n          const airport = airports.find(a => a.icao === cheapest.icao);\r\n          if (airport) {\r\n            addWaypoint(airport);\r\n          }\r\n        }\r\n      } else {\r\n        alert(`No fuel prices found within ${radius}nm of ${centerIcao}`);\r\n      }\r\n    } catch (e) {\r\n      console.error('Error finding fuel:', e);\r\n      alert('Error finding fuel prices. Make sure you have an airport in your route.');\r\n    }\r\n  };\r\n\r\n  // Get marker color based on airport type\r\n  const getMarkerColor = (type?: string) => {\r\n    switch (type) {\r\n      case 'large_airport': return '#ef4444'; // red\r\n      case 'medium_airport': return '#f59e0b'; // amber\r\n      case 'small_airport': return '#22c55e'; // green\r\n      default: return '#6b7280'; // gray\r\n    }\r\n  };\r\n\r\n  return (\n    <div className=\"h-[100vh] bg-background text-foreground flex flex-col overflow-hidden\">\n      {/* Top Bar */}\n      <div className=\"w-full px-2 py-1.5 bg-card border-b border-border flex-shrink-0\">\n        <div className=\"flex items-center justify-between h-8\">\n          <div className=\"flex items-center gap-3\">\n            <h1 className=\"text-base font-bold\">Flight Planner</h1>\n            <div className=\"flex items-center gap-1 text-sm mb-2\">\n              <a href=\"/modules/fuel-saver\" className=\"px-2 py-0.5 rounded bg-primary/10 text-primary font-medium text-xs\">Fuel Map</a>\n              <a href=\"/modules/fuel-saver/airport-lookup\" className=\"px-2 py-0.5 rounded hover:bg-secondary text-muted-foreground hover:text-foreground text-xs\">Airport Lookup</a>\n              <a href=\"/modules/fuel-saver/favorites\" className=\"px-2 py-0.5 rounded hover:bg-secondary text-muted-foreground hover:text-foreground text-xs\">Favorites</a>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            {status === 'authenticated' ? (\n              <div className=\"flex items-center gap-2\">\n                <span className=\"text-xs text-emerald-600\">{session?.user?.email}</span>\n                <button \n                  onClick={() => signOut()}\n                  className=\"text-xs text-muted-foreground hover:text-foreground\"\n                >\n                  Sign out\n                </button>\n              </div>\n            ) : (\n              <button\n                onClick={() => signIn()}\n                className=\"bg-secondary hover:bg-secondary/80 text-foreground px-3 py-1.5 rounded text-xs\"\n              >\n                Sign In\n              </button>\n            )}\n            <button\n              onClick={() => findNearestFuel()}\n              className=\"bg-primary hover:bg-primary/90 text-primary-foreground px-3 py-1.5 rounded text-xs font-medium flex items-center gap-1\"\n            >\n              <span>â›½</span> Find Cheap Fuel\n            </button>\n            <ExportDropdown \n              waypoints={waypoints}\n              flightPlanName={flightPlanName}\n              aircraftType={selectedAircraft.name}\n              cruisingAltitude={cruisingAlt}\n              isPro={isPro}\n              aircraft={selectedAircraft}\n              fuelPrices={fuelPrices}\n            />\n          </div>\n        </div>\n      </div>\n\r\n      {/* Main Content: Sidebar left, Map right */}\n      <div className=\"flex-1 flex overflow-hidden relative\">\n        {/* Toggle Arrow Button - floats over the map */}\n        <button\n          onClick={() => setShowPanel(!showPanel)}\n          className=\"absolute top-1/2 -translate-y-1/2 z-30 bg-card hover:bg-secondary border text-foreground px-2 py-4 rounded-r-lg text-sm transition-all lg:block hidden shadow-md\"\n          style={{ left: showPanel ? '308px' : '0px' }}\n        >\n          {showPanel ? 'â—€' : 'â–¶'}\n        </button>\n\n        {/* Mobile Toggle Button - always visible on small screens */}\n        <button\n          onClick={() => setShowPanel(!showPanel)}\n          className=\"lg:hidden fixed bottom-4 left-4 z-30 bg-primary hover:bg-primary/90 text-primary-foreground p-4 rounded-full shadow-lg\"\n        >\n          {showPanel ? 'âœ•' : 'â˜°'}\n        </button>\n\r\n        {/* Left Sidebar - Panel */}\n        <div \n          className={`bg-card border-r border-border flex flex-col overflow-hidden transition-all duration-300 fixed lg:relative z-20 h-full ${\n            showPanel ? 'w-full sm:w-[308px]' : 'w-0 lg:w-0'\n          }`}\n        >\n          {showPanel && (\n            <div className=\"w-full sm:w-[308px] flex flex-col h-full pt-5\">\n              {/* Mobile Close Button */}\n              <div className=\"lg:hidden flex justify-end p-2 border-b border-border\">\n                <button\n                  onClick={() => setShowPanel(false)}\n                  className=\"bg-secondary hover:bg-secondary/80 text-foreground p-2 rounded-lg\"\n                >\n                  âœ• Close\n                </button>\n              </div>\n\n              {/* Tabs */}\n              <div className=\"flex items-center text-xs border-b border-border px-1\">\n                <button\n                  onClick={() => setTabIndex(Math.max(0, tabIndex - 1))}\n                  disabled={tabIndex === 0}\n                  className=\"p-1.5 text-muted-foreground disabled:opacity-30 hover:text-foreground\"\n                >\n                  â€¹\n                </button>\n                <div className=\"flex-1 flex overflow-hidden\">\n                  {tabs.slice(tabIndex, tabIndex + 5).map((tab) => (\n                    <button\n                      key={tab.id}\n                      onClick={() => setActiveTab(tab.id as 'details' | 'waypoints' | 'info' | 'e6b')}\n                      className={`flex-1 py-1.5 font-medium border-b-2 ${\n                        activeTab === tab.id \n                          ? 'text-foreground border-primary bg-primary/5' \n                          : 'text-muted-foreground border-transparent hover:text-foreground'\n                      }`}\n                    >\n                      {tab.label}\n                    </button>\n                  ))}\n                </div>\n                <button\n                  onClick={() => setTabIndex(Math.min(tabs.length - 3, tabIndex + 1))}\n                  disabled={tabIndex >= tabs.length - 3}\n                  className=\"p-1.5 text-muted-foreground disabled:opacity-30 hover:text-foreground\"\n                >\n                  â€º\n                </button>\n              </div>\n\r\n              {/* Content - scrollable */}\r\n              <div className=\"flex-1 overflow-y-auto\">\r\n                {activeTab === 'details' ? (\r\n                /* Flight Plan Details Tab */\r\n                <div className=\"p-2 space-y-2\">\r\n                  {/* Search */}\r\n\r\n                  {/* Search */}\r\n                  <div>\r\n                    <div className=\"flex gap-1\">\r\n                      <input\r\n                        type=\"text\"\r\n                        value={searchQuery}\r\n                        onChange={(e) => handleSearch(e.target.value)}\r\n                        onKeyDown={(e) => e.key === 'Enter' && searchResults[0] && addWaypoint(searchResults[0])}\r\n                        placeholder=\"Search airport...\"\r\n                        className=\"flex-1 bg-background border border-border rounded px-2 py-1.5 text-foreground uppercase text-xs\"\r\n                      />\r\n                      <button \r\n                        onClick={() => searchQuery.length >= 2 && searchResults[0] && addWaypoint(searchResults[0])}\r\n                        className=\"bg-sky-600 hover:bg-sky-500 px-3 rounded text-foreground text-xs\"\r\n                      >\r\n                        Add\r\n                      </button>\r\n                    </div>\r\n                    {showSearchResults && searchResults.length > 0 && (\r\n                      <div className=\"mt-2 bg-background rounded max-h-40 overflow-y-auto\">\r\n                        {searchResults.map((airport) => (\r\n                          <button\r\n                            key={airport.icao}\r\n                            onClick={() => addWaypoint(airport)}\r\n                            className=\"w-full text-left px-3 py-2 hover:bg-secondary text-sm border-b border-border last:border-0\"\r\n                          >\r\n                            <div className=\"font-medium\">{airport.icao}</div>\r\n                            <div className=\"text-xs text-muted-foreground\">{airport.name}</div>\r\n                          </button>\r\n                        ))}\r\n                      </div>\r\n                    )}\r\n                    {showSearchResults && searchResults.length === 0 && searchQuery.length >= 2 && (\r\n                      <div className=\"mt-2 text-xs text-muted-foreground text-center py-2\">No airports found</div>\r\n                    )}\r\n                  </div>\r\n\r\n                  {/* Plan Name */}\r\n                  <div>\r\n                    <label className=\"block text-xs text-muted-foreground mb-0.5\">Plan</label>\r\n                    <input\r\n                      type=\"text\"\r\n                      value={flightPlanName}\r\n                      onChange={(e) => setFlightPlanName(e.target.value)}\r\n                      placeholder=\"My Cross Country\"\r\n                      className=\"w-full bg-background border border-border rounded px-2 py-1 text-foreground text-xs\"\r\n                    />\r\n                  </div>\r\n\r\n                  {/* Callsign & Pilot */}\r\n                  <div className=\"grid grid-cols-2 gap-1\">\r\n                    <div>\r\n                      <label className=\"block text-xs text-muted-foreground mb-0.5\">Callsign</label>\r\n                      <input\r\n                        type=\"text\"\r\n                        value={callsign}\r\n                        onChange={(e) => setCallsign(e.target.value)}\r\n                        placeholder=\"N12345\"\r\n                        className=\"w-full bg-background border border-border rounded px-2 py-1 text-foreground text-xs\"\r\n                      />\r\n                    </div>\r\n                    <div>\r\n                      <label className=\"block text-xs text-muted-foreground mb-0.5\">Pilot</label>\r\n                      <input\r\n                        type=\"text\"\r\n                        value={pilotName}\r\n                        onChange={(e) => setPilotName(e.target.value)}\r\n                        placeholder=\"John Doe\"\r\n                        className=\"w-full bg-background border border-border rounded px-2 py-1 text-foreground text-xs\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Aircraft & Departure Time */}\r\n                  <div className=\"grid grid-cols-2 gap-1\">\r\n                    <div>\r\n                      <label className=\"block text-xs text-muted-foreground mb-0.5\">Aircraft</label>\r\n                      <select\r\n                        value={selectedAircraft.name}\r\n                        onChange={(e) => {\r\n                        const ac = AIRCRAFT_PROFILES.find(p => p.name === e.target.value);\r\n                          if (ac) setSelectedAircraft(ac);\r\n                        }}\r\n                        className=\"w-full bg-background border border-border rounded px-2 py-1 text-foreground text-xs\"\r\n                      >\r\n                        {[...new Set(AIRCRAFT_PROFILES.map(p => p.manufacturer))].map(mfr => (\r\n                          <optgroup key={mfr} label={mfr}>\r\n                            {AIRCRAFT_PROFILES.filter(p => p.manufacturer === mfr).map(p => (\r\n                              <option key={p.name} value={p.name}>{p.name}</option>\r\n                            ))}\r\n                          </optgroup>\r\n                        ))}\r\n                      </select>\r\n                    </div>\r\n                    <div>\r\n                      <label className=\"block text-xs text-muted-foreground mb-0.5\">Departure</label>\r\n                      <input\r\n                        type=\"datetime-local\"\r\n                        value={departureTime}\r\n                        onChange={(e) => setDepartureTime(e.target.value)}\r\n                        className=\"w-full bg-background border border-border rounded px-2 py-1 text-foreground text-xs\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Cruising Alt & Souls */}\r\n                  <div className=\"grid grid-cols-2 gap-1\">\r\n                    <div>\r\n                      <label className=\"block text-xs text-muted-foreground mb-0.5\">Alt (ft)</label>\r\n                      <input\r\n                        type=\"number\"\r\n                        value={cruisingAlt}\r\n                        onChange={(e) => setCruisingAlt(parseInt(e.target.value))}\r\n                        className=\"w-full bg-background border border-border rounded px-2 py-1 text-foreground text-xs\"\r\n                      />\r\n                    </div>\r\n                    <div>\r\n                      <label className=\"block text-xs text-muted-foreground mb-0.5\">Souls</label>\r\n                      <input\r\n                        type=\"number\"\r\n                        min=\"1\"\r\n                        value={soulsOnBoard}\r\n                        onChange={(e) => setSoulsOnBoard(parseInt(e.target.value))}\r\n                        className=\"w-full bg-background border border-border rounded px-2 py-1 text-foreground text-xs\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Alternate Airport */}\r\n                  <div>\r\n                    <label className=\"block text-xs text-muted-foreground mb-0.5\">Alternate</label>\r\n                    <input\r\n                      type=\"text\"\r\n                      value={alternateIcao}\r\n                      onChange={(e) => setAlternateIcao(e.target.value.toUpperCase())}\r\n                      placeholder=\"KABC\"\r\n                      className=\"w-full bg-background border border-border rounded px-2 py-1 text-foreground uppercase text-xs\"\r\n                    />\r\n                  </div>\r\n\r\n                  {/* Remarks */}\r\n                  <div>\r\n                    <label className=\"block text-xs text-muted-foreground mb-0.5\">Remarks</label>\r\n                    <textarea\r\n                      value={remarks}\r\n                      onChange={(e) => setRemarks(e.target.value)}\r\n                      placeholder=\"...\"\r\n                      rows={1}\r\n                      className=\"w-full bg-background border border-border rounded px-2 py-1 text-foreground text-xs\"\r\n                    />\r\n                  </div>\r\n\r\n                  {/* Fuel Settings */}\r\n                  <div>\r\n                    <label className=\"block text-xs text-muted-foreground mb-0.5\">Fuel: {departureFuel}%</label>\r\n                    <input\r\n                      type=\"range\"\r\n                      min=\"0\"\r\n                      max=\"100\"\r\n                      value={departureFuel}\r\n                      onChange={(e) => setDepartureFuel(parseInt(e.target.value))}\r\n                      className=\"w-full\"\r\n                    />\r\n                  </div>\r\n\r\n                  {/* Range Calculator - compact inline */}\r\n                  <div className=\"bg-background rounded p-2 space-y-1\">\r\n                    <div className=\"text-xs font-medium text-muted-foreground\">Range</div>\r\n                    <div className=\"grid grid-cols-3 gap-1 text-xs\">\r\n                      <div>\r\n                        <div className=\"text-muted-foreground/60 text-[10px]\">Gal</div>\r\n                        <div className=\"text-foreground\">{selectedAircraft.fuelCapacity}</div>\r\n                      </div>\r\n                      <div>\r\n                        <div className=\"text-muted-foreground/60 text-[10px]\">Burn</div>\r\n                        <div className=\"text-foreground\">{selectedAircraft.burnRate}</div>\r\n                      </div>\r\n                      <div>\r\n                        <div className=\"text-muted-foreground/60 text-[10px]\">Kts</div>\r\n                        <div className=\"text-foreground\">{selectedAircraft.speed}</div>\r\n                      </div>\r\n                    </div>\r\n                    {routeStats && (\r\n                      <div className=\"text-[10px] text-sky-400 pt-1 border-t border-border\">\r\n                        Max Range: {Math.round((selectedAircraft.fuelCapacity * departureFuel / 100 / selectedAircraft.burnRate) * selectedAircraft.speed)} NM\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n\r\n                  {/* Route Weather Impact Button */}\r\n                  {waypoints.length >= 2 && (\r\n                    <div className=\"mt-2 pt-2 border-t border-border\">\r\n                      <button\r\n                        onClick={fetchRouteWeather}\r\n                        disabled={loadingRouteWeather}\r\n                        className={`w-full text-xs px-2 py-1.5 rounded transition ${\r\n                          routeWeather\r\n                            ? 'bg-amber-600 hover:bg-amber-500 text-foreground'\r\n                            : 'bg-secondary hover:bg-secondary/80 text-muted-foreground'\r\n                        }`}\r\n                      >\r\n                        {loadingRouteWeather ? 'ðŸ’¨ Calculating...' : routeWeather ? 'ðŸ’¨ Update Wind Impact' : 'ðŸ’¨ Calculate Wind Impact'}\r\n                      </button>\r\n                      \r\n                      {routeWeather && (\r\n                        <div className=\"mt-2 space-y-1\">\r\n                          <div className={`text-xs font-medium px-2 py-1 rounded ${\r\n                            routeWeather.summary.significant \r\n                              ? routeWeather.summary.fuelImpactPercent > 0 \r\n                                ? 'bg-red-900/50 text-red-400'\r\n                                : 'bg-green-900/50 text-green-400'\r\n                              : 'bg-background text-muted-foreground'\r\n                          }`}>\r\n                            {routeWeather.summary.significant ? (\r\n                              routeWeather.summary.fuelImpactPercent > 0 \r\n                                ? `âš ï¸ +${routeWeather.summary.fuelImpactPercent}% fuel (${routeWeather.summary.fuelImpact} gal more)`\r\n                                : `âœ“ ${routeWeather.summary.fuelImpactPercent}% fuel saved (${Math.abs(routeWeather.summary.fuelImpact)} gal less)`\r\n                            ) : (\r\n                              `âœ“ Minimal wind impact (${routeWeather.summary.fuelImpactPercent}% change)`\r\n                            )}\r\n                          </div>\r\n                          <div className=\"text-[10px] text-muted-foreground/60 px-1\">\r\n                            GS: {routeWeather.summary.totalTimeWithWind}min vs {routeWeather.summary.totalTimeStillAir}min still air\r\n                          </div>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                    )}\r\n                  </div>\r\n                ) : activeTab === 'wb' ? (\r\n                  /* Weight & Balance Tab */\r\n                  <div className=\"p-2 space-y-3\">\r\n                    <div className=\"text-sm font-semibold text-foreground\">âš–ï¸ Weight & Balance</div>\r\n                    \r\n                    {/* Aircraft Selection */}\r\n                    <div>\r\n                      <label className=\"block text-xs text-muted-foreground mb-1\">Aircraft</label>\r\n                      <select\r\n                        value={selectedAircraft.name}\r\n                        onChange={(e) => {\r\n                          const ac = AIRCRAFT_PROFILES.find(p => p.name === e.target.value);\r\n                          if (ac) setSelectedAircraft(ac);\r\n                        }}\r\n                        className=\"w-full bg-background border border-border rounded px-2 py-1.5 text-foreground text-xs\"\r\n                      >\r\n                        {[...new Set(AIRCRAFT_PROFILES.map(p => p.manufacturer))].map(mfr => (\r\n                          <optgroup key={mfr} label={mfr}>\r\n                            {AIRCRAFT_PROFILES.filter(p => p.manufacturer === mfr).map(p => (\r\n                              <option key={p.name} value={p.name}>{p.name}</option>\r\n                            ))}\r\n                          </optgroup>\r\n                        ))}\r\n                      </select>\r\n                    </div>\r\n\r\n                    {/* Weight Inputs */}\r\n                    <div className=\"grid grid-cols-2 gap-2\">\r\n                      <div>\r\n                        <label className=\"block text-xs text-muted-foreground mb-1\">Front Seats (lbs)</label>\r\n                        <input\r\n                          type=\"number\"\r\n                          value={wbFrontPax}\r\n                          onChange={(e) => setWbFrontPax(Number(e.target.value))}\r\n                          className=\"w-full bg-background border border-border rounded px-2 py-1.5 text-foreground text-xs\"\r\n                        />\r\n                      </div>\r\n                      <div>\r\n                        <label className=\"block text-xs text-muted-foreground mb-1\">Rear Seat 1 (lbs)</label>\r\n                        <input\r\n                          type=\"number\"\r\n                          value={wbRearPax1}\r\n                          onChange={(e) => setWbRearPax1(Number(e.target.value))}\r\n                          className=\"w-full bg-background border border-border rounded px-2 py-1.5 text-foreground text-xs\"\r\n                        />\r\n                      </div>\r\n                      <div>\r\n                        <label className=\"block text-xs text-muted-foreground mb-1\">Rear Seat 2 (lbs)</label>\r\n                        <input\r\n                          type=\"number\"\r\n                          value={wbRearPax2}\r\n                          onChange={(e) => setWbRearPax2(Number(e.target.value))}\r\n                          className=\"w-full bg-background border border-border rounded px-2 py-1.5 text-foreground text-xs\"\r\n                        />\r\n                      </div>\r\n                      <div>\r\n                        <label className=\"block text-xs text-muted-foreground mb-1\">Baggage 1 (lbs)</label>\r\n                        <input\r\n                          type=\"number\"\r\n                          value={wbBaggage1}\r\n                          onChange={(e) => setWbBaggage1(Number(e.target.value))}\r\n                          className=\"w-full bg-background border border-border rounded px-2 py-1.5 text-foreground text-xs\"\r\n                        />\r\n                      </div>\r\n                      <div>\r\n                        <label className=\"block text-xs text-muted-foreground mb-1\">Baggage 2 (lbs)</label>\r\n                        <input\r\n                          type=\"number\"\r\n                          value={wbBaggage2}\r\n                          onChange={(e) => setWbBaggage2(Number(e.target.value))}\r\n                          className=\"w-full bg-background border border-border rounded px-2 py-1.5 text-foreground text-xs\"\r\n                        />\r\n                      </div>\r\n                      <div>\r\n                        <label className=\"block text-xs text-muted-foreground mb-1\">Fuel (gal)</label>\r\n                        <input\r\n                          type=\"number\"\r\n                          value={wbFuel}\r\n                          onChange={(e) => setWbFuel(Number(e.target.value))}\r\n                          className=\"w-full bg-background border border-border rounded px-2 py-1.5 text-foreground text-xs\"\r\n                        />\r\n                      </div>\r\n                    </div>\r\n\r\n                    {/* Calculate W&B */}\r\n                    {(() => {\r\n                      const ac = selectedAircraft;\r\n                      const fuelWeight = wbFuel * 6; // 6 lbs per gallon for 100LL\r\n                      const emptyMoment = ac.emptyWeight * ac.emptyCG;\r\n                      const frontMoment = wbFrontPax * (ac.arms?.frontSeats || 37);\r\n                      const rear1Moment = wbRearPax1 * (ac.arms?.rearSeats || 73);\r\n                      const rear2Moment = wbRearPax2 * (ac.arms?.rearSeats || 73);\r\n                      const bag1Moment = wbBaggage1 * (ac.arms?.baggage1 || 95);\r\n                      const bag2Moment = wbBaggage2 * (ac.arms?.baggage2 || 123);\r\n                      const fuelMoment = fuelWeight * (ac.arms?.fuel || 48);\r\n                      \r\n                      const totalWeight = ac.emptyWeight + wbFrontPax + wbRearPax1 + wbRearPax2 + wbBaggage1 + wbBaggage2 + fuelWeight;\r\n                      const totalMoment = emptyMoment + frontMoment + rear1Moment + rear2Moment + bag1Moment + bag2Moment + fuelMoment;\r\n                      const cg = totalMoment / totalWeight;\r\n                      const cgInLimits = cg >= (ac.cgLimits?.forward || 35) && cg <= (ac.cgLimits?.aft || 47.3);\r\n                      \r\n                      return (\r\n                        <div className=\"bg-background rounded p-3 space-y-2\">\r\n                          {/* Weight Summary */}\r\n                          <div className=\"grid grid-cols-2 gap-2 text-xs\">\r\n                            <div className=\"flex justify-between\">\r\n                              <span className=\"text-muted-foreground\">Empty:</span>\r\n                              <span className=\"text-foreground\">{ac.emptyWeight} lbs</span>\r\n                            </div>\r\n                            <div className=\"flex justify-between\">\r\n                              <span className=\"text-muted-foreground\">Payload:</span>\r\n                              <span className=\"text-foreground\">{wbFrontPax + wbRearPax1 + wbRearPax2 + wbBaggage1 + wbBaggage2} lbs</span>\r\n                            </div>\r\n                            <div className=\"flex justify-between\">\r\n                              <span className=\"text-muted-foreground\">Fuel:</span>\r\n                              <span className=\"text-foreground\">{fuelWeight} lbs</span>\r\n                            </div>\r\n                            <div className=\"flex justify-between font-medium\">\r\n                              <span className=\"text-muted-foreground\">Total:</span>\r\n                              <span className={totalWeight > ac.maxWeight ? 'text-red-400' : 'text-foreground'}>{totalWeight} lbs</span>\r\n                            </div>\r\n                          </div>\r\n                          \r\n                          {/* CG Display */}\r\n                          <div className=\"pt-2 border-t border-border\">\r\n                            <div className=\"flex justify-between text-xs mb-1\">\r\n                              <span className=\"text-muted-foreground\">CG:</span>\r\n                              <span className={cgInLimits ? 'text-emerald-400' : 'text-red-400'}>{cg.toFixed(1)}\"</span>\r\n                            </div>\r\n                            <div className=\"h-2 bg-secondary rounded-full overflow-hidden\">\r\n                              <div \r\n                                className={`h-full transition-all ${cgInLimits ? 'bg-emerald-500' : 'bg-red-500'}`}\r\n                                style={{ \r\n                                  width: `${Math.min(100, Math.max(0, ((cg - (ac.cgLimits?.forward || 35)) / ((ac.cgLimits?.aft || 47.3) - (ac.cgLimits?.forward || 35))) * 100))}%`,\r\n                                  marginLeft: `${Math.min(100, Math.max(0, ((cg - (ac.cgLimits?.forward || 35)) / ((ac.cgLimits?.aft || 47.3) - (ac.cgLimits?.forward || 35))) * 100))}%`\r\n                                }}\r\n                              />\r\n                            </div>\r\n                            <div className=\"flex justify-between text-[10px] text-muted-foreground/60 mt-1\">\r\n                              <span>{(ac.cgLimits?.forward || 35)}\"</span>\r\n                              <span className={cgInLimits ? 'text-emerald-400' : 'text-red-400'}>\r\n                                {cgInLimits ? 'âœ“ Within Limits' : 'âš ï¸ Out of Limits'}\r\n                              </span>\r\n                              <span>{(ac.cgLimits?.aft || 47.3)}\"</span>\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      );\r\n                    })()}\r\n                    \r\n                    <div className=\"text-xs text-muted-foreground/60\">\r\n                      Arms and limits based on POH data for selected aircraft.\r\n                    </div>\r\n                  </div>\r\n                ) : activeTab === 'e6b' ? (\r\n                /* E6B Calculator Tab */\r\n                <div className=\"p-3 space-y-4\">\r\n                  <div className=\"text-sm font-semibold text-foreground\">ðŸ§® E6B Wind Correction</div>\r\n                  \r\n                  <div className=\"space-y-3\">\r\n                    <div>\r\n                      <label className=\"block text-xs text-muted-foreground mb-1\">True Airspeed (TAS)</label>\r\n                      <input\r\n                        type=\"number\"\r\n                        value={e6bTAS}\r\n                        onChange={(e) => setE6bTAS(Number(e.target.value))}\r\n                        className=\"w-full bg-background border border-border rounded px-3 py-2 text-foreground text-sm\"\r\n                      />\r\n                    </div>\r\n                    \r\n                    <div>\r\n                      <label className=\"block text-xs text-muted-foreground mb-1\">Heading (Â°)</label>\r\n                      <input\r\n                        type=\"number\"\r\n                        value={e6bHeading}\r\n                        onChange={(e) => setE6bHeading(Number(e.target.value))}\r\n                        className=\"w-full bg-background border border-border rounded px-3 py-2 text-foreground text-sm\"\r\n                      />\r\n                    </div>\r\n                    \r\n                    <div className=\"grid grid-cols-2 gap-2\">\r\n                      <div>\r\n                        <label className=\"block text-xs text-muted-foreground mb-1\">Wind From (Â°)</label>\r\n                        <input\r\n                          type=\"number\"\r\n                          value={e6bWindDir}\r\n                          onChange={(e) => setE6bWindDir(Number(e.target.value))}\r\n                          className=\"w-full bg-background border border-border rounded px-3 py-2 text-foreground text-sm\"\r\n                        />\r\n                      </div>\r\n                      <div>\r\n                        <label className=\"block text-xs text-muted-foreground mb-1\">Wind Speed (kts)</label>\r\n                        <input\r\n                          type=\"number\"\r\n                          value={e6bWindspeed}\r\n                          onChange={(e) => setE6bWindspeed(Number(e.target.value))}\r\n                          className=\"w-full bg-background border border-border rounded px-3 py-2 text-foreground text-sm\"\r\n                        />\r\n                      </div>\r\n                    </div>\r\n                    \r\n                    <button\r\n                      onClick={calculateE6B}\r\n                      className=\"w-full bg-sky-600 hover:bg-sky-500 text-foreground font-medium py-2 rounded text-sm\"\r\n                    >\r\n                      Calculate\r\n                    </button>\r\n                    \r\n                    {e6bResult && (\r\n                      <div className=\"bg-background rounded p-3 space-y-2\">\r\n                        <div className=\"flex justify-between\">\r\n                          <span className=\"text-muted-foreground text-sm\">Ground Speed:</span>\r\n                          <span className=\"text-foreground font-bold\">{e6bResult.groundSpeed} kts</span>\r\n                        </div>\r\n                        <div className=\"flex justify-between\">\r\n                          <span className=\"text-muted-foreground text-sm\">Track:</span>\r\n                          <span className=\"text-foreground font-bold\">{e6bResult.track}Â°</span>\r\n                        </div>\r\n                        <div className=\"flex justify-between\">\r\n                          <span className=\"text-muted-foreground text-sm\">Wind Correction:</span>\r\n                          <span className={`font-bold ${e6bResult.windCorrection > 0 ? 'text-amber-400' : e6bResult.windCorrection < 0 ? 'text-blue-400' : 'text-foreground'}`}>\r\n                            {e6bResult.windCorrection > 0 ? '+' : ''}{e6bResult.windCorrection}Â°\r\n                          </span>\r\n                        </div>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                  \r\n                  <div className=\"text-xs text-muted-foreground/60\">\r\n                    Use weather data from your route to get wind info for accurate calculations.\r\n                  </div>\r\n                </div>\r\n              ) : (\r\n                /* Waypoints Tab */\r\n                <div className=\"p-1.5\">\r\n                  {/* Weather Toggle */}\r\n                  <div className=\"flex items-center justify-between mb-2 px-1\">\r\n                    <span className=\"text-xs text-muted-foreground\">{waypoints.length} waypoints</span>\r\n                    <button\r\n                      onClick={() => {\r\n                        if (!showWeather) {\r\n                          fetchWaypointWeather();\r\n                        }\r\n                        setShowWeather(!showWeather);\r\n                      }}\r\n                      disabled={weatherLoading}\r\n                      className={`text-xs px-2 py-1 rounded transition ${\r\n                        showWeather \r\n                          ? 'bg-sky-600 text-foreground' \r\n                          : 'bg-secondary text-muted-foreground hover:bg-secondary/80'\r\n                      }`}\r\n                    >\r\n                      {weatherLoading ? 'Loading...' : 'ðŸŒ¤ Weather'}\r\n                    </button>\r\n                    \r\n                    {/* Route buttons */}\r\n                    <div className=\"flex gap-1\">\r\n                      <button\r\n                        onClick={fitMapToWaypoints}\r\n                        disabled={waypoints.length === 0}\r\n                        className=\"flex-1 text-xs px-2 py-1 rounded bg-secondary text-muted-foreground hover:bg-secondary/80 disabled:opacity-30 min-w-[60px]\"\r\n                        title=\"Fit map to show all waypoints\"\r\n                      >\r\n                        âŠ™ Fit\r\n                      </button>\r\n                      <button\r\n                        onClick={toggleRoundTrip}\r\n                        disabled={waypoints.length < 2}\r\n                        className=\"flex-1 text-xs px-2 py-1 rounded bg-secondary text-muted-foreground hover:bg-secondary/80 disabled:opacity-30 min-w-[60px]\"\r\n                        title={waypoints[0]?.icao === waypoints[waypoints.length-1]?.icao ? \"Remove return leg\" : \"Add return leg\"}\r\n                      >\r\n                        {waypoints[0]?.icao === waypoints[waypoints.length-1]?.icao ? 'â†©ï¸ One-way' : 'ðŸ”„ Round Trip'}\r\n                      </button>\r\n                      <button\r\n                        onClick={optimizeRoute}\r\n                        disabled={waypoints.length < 3}\r\n                        className=\"flex-1 text-xs px-2 py-1 rounded bg-secondary text-muted-foreground hover:bg-secondary/80 disabled:opacity-30 min-w-[60px]\"\r\n                        title=\"Optimize route for shortest distance\"\r\n                      >\r\n                        âš¡ Optimize\r\n                      </button>\r\n                    </div>\r\n                  </div>\n\n                  {waypoints.length > 0 && (\n                    <div className=\"space-y-1\">\r\n                      {waypoints.map((wp, i) => {\r\n                        const legInfo = routeStats?.legs?.[i];\r\n                        \r\n                        return (\r\n                          <div key={wp.id} className=\"bg-background rounded p-2\">\r\n                            <div className=\"flex items-center justify-between\">\r\n                              <div className=\"flex items-center gap-1.5\">\r\n                                <span className=\"w-5 h-5 rounded-full bg-sky-600 text-foreground flex items-center justify-center font-bold text-xs\">\r\n                                  {i + 1}\r\n                                </span>\r\n                                <div>\r\n                                  <div className=\"font-medium text-foreground text-xs\">{wp.icao}</div>\r\n                                  <div className=\"text-xs text-muted-foreground\">{wp.city || wp.name}</div>\r\n                                </div>\r\n                              </div>\r\n                              <div className=\"flex gap-0.5\">\r\n                                <button \r\n                                  onClick={() => moveWaypoint(wp.id, 'up')}\r\n                                  disabled={i === 0}\r\n                                  className=\"text-muted-foreground hover:text-foreground disabled:opacity-30 text-xs p-0.5\"\r\n                                >â†‘</button>\r\n                                <button \r\n                                  onClick={() => moveWaypoint(wp.id, 'down')}\r\n                                  disabled={i === waypoints.length - 1}\r\n                                  className=\"text-muted-foreground hover:text-foreground disabled:opacity-30 text-xs p-0.5\"\r\n                                >â†“</button>\r\n                                <button \r\n                                  onClick={() => removeWaypoint(wp.id)}\r\n                                  className=\"text-red-400 hover:text-red-300 text-xs p-0.5\"\r\n                                >âœ•</button>\r\n                              </div>\r\n                            </div>\r\n                            \r\n                            {/* Leg stats - shows for all except last waypoint */}\r\n                            {legInfo && (\r\n                              <div className=\"mt-1 pt-1 border-t border-border flex justify-between text-xs\">\r\n                                <span className=\"text-sky-400\">â†’ {legInfo.to.icao}</span>\r\n                                <span className=\"text-amber-400\">{Math.round(legInfo.distance)}NM</span>\r\n                                <span className=\"text-emerald-400\">${legInfo.cost.toFixed(0)}</span>\r\n                              </div>\r\n                            )}\r\n\r\n                            {/* Weather info for this waypoint */}\r\n                            {showWeather && waypointWeather[wp.icao] && (\r\n                              <div className=\"mt-2 pt-2 border-t border-border text-xs space-y-1\">\r\n                                <div className=\"flex justify-between\">\r\n                                  <span className=\"text-muted-foreground\">Flight Cat:</span>\r\n                                  <span className={`font-medium ${\r\n                                    waypointWeather[wp.icao].flightCategory === 'VFR' ? 'text-green-400' :\r\n                                    waypointWeather[wp.icao].flightCategory === 'MVFR' ? 'text-blue-400' :\r\n                                    waypointWeather[wp.icao].flightCategory === 'IFR' ? 'text-red-400' :\r\n                                    'text-purple-400'\r\n                                  }`}>\r\n                                    {waypointWeather[wp.icao].flightCategory || 'N/A'}\r\n                                  </span>\r\n                                </div>\r\n                                {waypointWeather[wp.icao].isForecast && (\r\n                                  <div className=\"flex justify-between\">\r\n                                    <span className=\"text-muted-foreground\">Type:</span>\r\n                                    <span className=\"text-amber-400 text-xs\">â˜ï¸ Forecast</span>\r\n                                  </div>\r\n                                )}\r\n                                {waypointWeather[wp.icao].ws && (\r\n                                  <div className=\"flex justify-between\">\r\n                                    <span className=\"text-muted-foreground\">Wind:</span>\r\n                                    <span className=\"text-foreground\">\r\n                                      {waypointWeather[wp.icao].ws.value}@{waypointWeather[wp.icao].wd?.value}Â°\r\n                                    </span>\r\n                                  </div>\r\n                                )}\r\n                                {waypointWeather[wp.icao].temp && (\r\n                                  <div className=\"flex justify-between\">\r\n                                    <span className=\"text-muted-foreground\">Temp:</span>\r\n                                    <span className=\"text-foreground\">{waypointWeather[wp.icao].temp}Â°C</span>\r\n                                  </div>\r\n                                )}\r\n                                {waypointWeather[wp.icao].altimeter && (\r\n                                  <div className=\"flex justify-between\">\r\n                                    <span className=\"text-muted-foreground\">Alt:</span>\r\n                                    <span className=\"text-foreground\">{(waypointWeather[wp.icao].altimeter / 100).toFixed(2)}\"</span>\r\n                                  </div>\r\n                                )}\r\n                              </div>\r\n                            )}\r\n                          </div>\r\n                        );\r\n                      })}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              )}\n              \n              {/* Trip Finder - only in Tools tab */}\n              {activeTab === 'e6b' && (\n                <>\n                  {/* NOTAMs Panel - shown in sidebar when there are waypoints */}\n                  {waypoints.length > 0 && (\n                    <NotamsPanel \n                      waypoints={waypoints} \n                      isPro={isPro}\n                    />\n                  )}\n                  \n                  <TripFinder\n                  airports={airports}\n                  waypoints={waypoints}\n                  aircraft={selectedAircraft}\n                  fuelPrices={fuelPrices}\n                  onAddWaypoint={(airport) => addWaypoint(airport)}\n                />\n                </>\n              )}\n            </div>\n\n            {/* Bottom Actions - Load/Save/Import */}\n            <div className=\"p-2 border-t border-border bg-card flex-shrink-0 space-y-1\">\r\n              {/* Import Button */}\r\n              <div>\r\n                <label className=\"block text-xs text-muted-foreground mb-1\">Import Flight Plan</label>\r\n                <input\r\n                  type=\"file\"\r\n                  accept=\".gpx,.fpl,.json,.csv\"\r\n                  onChange={handleFileUpload}\r\n                  className=\"w-full text-xs text-muted-foreground file:mr-2 file:py-1 file:px-2 file:rounded file:border-0 file:text-xs file:font-medium file:bg-secondary file:text-foreground hover:file:bg-slate-500\"\r\n                />\r\n              </div>\r\n              <div className=\"flex gap-1\">\r\n                <button\r\n                  onClick={() => {\r\n                    if (status === 'loading') return;\r\n                    if (status !== 'authenticated') {\r\n                      setAuthModalAction('load');\r\n                      setAuthModalOpen(true);\r\n                    } else {\r\n                      setShowPlanList(!showPlanList);\r\n                    }\r\n                  }}\r\n                  className=\"flex-1 bg-secondary hover:bg-secondary/80 text-foreground font-medium py-1.5 rounded text-xs\"\r\n                >\r\n                  Load {savedPlans.length > 0 && `(${savedPlans.length})`}\r\n                </button>\r\n                <button\r\n                  onClick={() => {\r\n                    if (status === 'loading') return;\r\n                    if (status !== 'authenticated') {\r\n                      setAuthModalAction('save');\r\n                      setAuthModalOpen(true);\r\n                    } else {\r\n                      saveFlightPlan();\r\n                    }\r\n                  }}\r\n                  disabled={!canSave}\r\n                  className={`flex-1 font-medium py-1.5 rounded text-xs ${canSave ? 'bg-emerald-500 hover:bg-emerald-600 text-foreground' : 'bg-secondary text-muted-foreground cursor-not-allowed'}`}\r\n                >\r\n                  Save\r\n                </button>\r\n              </div>\r\n              \r\n              {/* Saved Plans List */}\r\n              {showPlanList && (\r\n                <div className=\"bg-background rounded p-1.5 space-y-1 max-h-24 overflow-y-auto\">\r\n                  {status === 'authenticated' ? (\r\n                    <div className=\"flex items-center justify-between text-xs text-emerald-400\">\r\n                      <span>Logged in as {session?.user?.email}</span>\r\n                      <button onClick={() => signOut()} className=\"text-muted-foreground hover:text-foreground\">Sign out</button>\r\n                    </div>\r\n                  ) : (\r\n                    <button \r\n                      onClick={() => signIn()} \r\n                      className=\"w-full text-xs bg-secondary hover:bg-secondary/80 rounded py-1.5 text-sky-400\"\r\n                    >\r\n                      Log in to save plans to your account\r\n                    </button>\r\n                  )}\r\n                  \r\n                  {savedPlans.length > 0 ? (\r\n                    <>\r\n                      <div className=\"text-sm font-semibold text-muted-foreground\">Saved Plans ({savedPlans.length})</div>\r\n                      {savedPlans.map((plan, i) => (\r\n                        <div key={plan.id || i} className=\"flex items-center justify-between bg-secondary rounded p-2 text-sm\">\r\n                          <button onClick={() => loadFlightPlan(plan)} className=\"text-left flex-1 hover:text-sky-400\">\r\n                            <div className=\"font-medium flex items-center gap-2\">\r\n                              {plan.name || 'Untitled'}\r\n                              {plan.isDemo && (\r\n                                <span className=\"text-[10px] bg-amber-500/20 text-amber-400 px-1.5 py-0.5 rounded\">DEMO</span>\r\n                              )}\r\n                            </div>\r\n                            <div className=\"text-xs text-muted-foreground\">\r\n                              {plan.departureIcao || '---'} â†’ {plan.arrivalIcao || '---'} â€¢ {plan.waypoints?.length || 0} waypoints\r\n                            </div>\r\n                          </button>\r\n                          {!plan.isDemo && (\r\n                            <button onClick={() => deleteFlightPlan(plan.id || i)} className=\"text-red-400 hover:text-red-300 px-2\">âœ•</button>\r\n                          )}\r\n                        </div>\r\n                      ))}\r\n                    </>\r\n                  ) : (\r\n                    <div className=\"text-xs text-muted-foreground text-center py-2\">No saved plans</div>\r\n                  )}\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Right Side - Map and Bottom Stats */}\r\n        <div className=\"flex-1 flex flex-col overflow-hidden\">\r\n          {/* Map Section */}\r\n          <div className=\"flex-1 overflow-hidden relative\">\r\n            {!mapLoaded ? (\r\n              <div className=\"h-full flex items-center justify-center bg-card\">\r\n                <button onClick={() => setMapLoaded(true)} className=\"bg-sky-500 hover:bg-sky-600 text-foreground px-4 py-2 rounded-lg text-sm\">\r\n                  Load Map\r\n                </button>\r\n              </div>\r\n            ) : (\r\n              <>\r\n                <LeafletMap\r\n                  key={showPanel ? 'map-open' : 'map-closed'}\r\n                  airports={airports.filter(a => {\r\n                    // Filter by airport type\r\n                    if (a.type === 'large_airport' && !mapOptions.showLarge) return false;\r\n                    if (a.type === 'medium_airport' && !mapOptions.showMedium) return false;\r\n                    if (a.type === 'small_airport' && !mapOptions.showSmall) return false;\r\n                    if (a.type === 'seaplane_base' && !mapOptions.showSeaplane) return false;\r\n                    // Filter by region - hide Canada/Mexico unless toggle is on\r\n                    if (!showInternational && !isNorthAmerica(a)) return false;\r\n                    return true;\r\n                  })}\r\n                  waypoints={waypoints}\r\n                  fuelPrices={fuelPrices}\r\n                  onBoundsChange={setMapBounds}\r\n                  onAirportClick={handleAirportAdd}\r\n                  mapCenter={mapCenter}\r\n                  mapZoom={mapZoom}\r\n                  showTerrain={performanceSettings.showTerrain}\r\n                  showStateOverlay={mapOptions.showStatePrices}\r\n                  showTfrs={mapOptions.showTfrs}\r\n                  showPireps={mapOptions.showPireps}\r\n                  onStateClick={setSelectedStateInfo}\r\n                  onViewStateInfo={handleViewStateInfo}\r\n                  baseLayer={mapOptions.baseLayer}\r\n                  performanceMode={mapOptions.performanceMode}\r\n                />\r\n                {selectedStateInfo && (\r\n                  <StateInfoPanel\r\n                    stateInfo={selectedStateInfo}\r\n                    onClose={() => setSelectedStateInfo(null)}\r\n                    onAirportClick={(icao) => {\r\n                      // Find and add airport to route\r\n                      const airport = airports.find(a => a.icao === icao);\r\n                      if (airport) {\r\n                        handleAirportAdd(airport);\r\n                      }\r\n                    }}\r\n                  />\r\n                )}\r\n                {/* International Toggle - Hidden by default, shows Canada/Mexico */}\r\n                <div className=\"absolute top-4 left-4 z-[1001]\">\r\n                  <button\r\n                    onClick={() => setShowInternational(!showInternational)}\r\n                    className={`px-2 py-1.5 text-xs rounded-lg shadow-lg border transition-colors ${\r\n                      showInternational \r\n                        ? 'bg-emerald-600 border-emerald-500 text-foreground' \r\n                        : 'bg-card/90 border-border text-muted-foreground hover:bg-background'\r\n                    }`}\r\n                    title={showInternational ? 'Hiding Canada/Mexico airports' : 'Show Canada/Mexico airports'}\r\n                  >\r\n                    ðŸŒ Intl {showInternational ? 'ON' : 'OFF'}\r\n                  </button>\r\n                </div>\r\n                <PerformanceSettingsPanel onSettingsChange={setPerformanceSettings} />\r\n                <MapControls \r\n                  options={mapOptions} \r\n                  onOptionsChange={setMapOptions}\r\n                />\r\n              </>\r\n            )}\r\n          </div>\r\n\r\n          {/* Bottom Stats Bar - Full Width */}\r\n          {routeStats && (\r\n            <div className=\"bg-card border-t border-border p-3 flex-shrink-0\">\r\n              {/* Cost Settings Toggle */}\r\n              <div className=\"flex gap-2 mb-2\">\r\n                <label className=\"flex items-center gap-1 text-xs cursor-pointer\">\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    checked={includeLandingFees}\r\n                    onChange={(e) => setIncludeLandingFees(e.target.checked)}\r\n                    className=\"rounded\"\r\n                  />\r\n                  <span className={includeLandingFees ? 'text-foreground' : 'text-muted-foreground/60'}>Landing</span>\r\n                </label>\r\n                <label className=\"flex items-center gap-1 text-xs cursor-pointer\">\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    checked={includeFboFees}\r\n                    onChange={(e) => setIncludeFboFees(e.target.checked)}\r\n                    className=\"rounded\"\r\n                  />\r\n                  <span className={includeFboFees ? 'text-foreground' : 'text-muted-foreground/60'}>FBO</span>\r\n                </label>\r\n              </div>\r\n              \r\n              <div className=\"flex items-center justify-between\">\r\n                {/* Main Stats */}\r\n                <div className=\"flex gap-4\">\r\n                  <div className=\"text-center\">\r\n                    <div className=\"text-2xl font-bold text-sky-400\">{Math.round(routeStats.totalDistance)}</div>\r\n                    <div className=\"text-xs text-muted-foreground/60 uppercase tracking-wider\">NM</div>\r\n                  </div>\r\n                  <div className=\"text-center\">\r\n                    <div className=\"text-2xl font-bold text-amber-400\">{routeStats.flightHours}h</div>\r\n                    <div className=\"text-xs text-muted-foreground/60 uppercase tracking-wider\">Flight Time</div>\r\n                  </div>\r\n                  <div className=\"text-center\">\r\n                    <div className=\"text-2xl font-bold text-purple-400\">{routeStats.fuelNeeded}</div>\r\n                    <div className=\"text-xs text-muted-foreground/60 uppercase tracking-wider\">Gal Fuel</div>\r\n                  </div>\r\n                  <div className=\"text-center\">\r\n                    <div className=\"text-2xl font-bold text-emerald-400\">${routeStats.estimatedCost}</div>\r\n                    <div className=\"text-xs text-muted-foreground/60 uppercase tracking-wider\">Total</div>\r\n                  </div>\r\n                  {soulsOnBoard > 1 && (\r\n                    <div className=\"text-center\">\r\n                      <div className=\"text-2xl font-bold text-cyan-400\">${routeStats.costPerPerson}</div>\r\n                      <div className=\"text-xs text-muted-foreground/60 uppercase tracking-wider\">Per Person</div>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n\r\n                {/* Aircraft Info */}\r\n                <div className=\"hidden md:block text-right\">\r\n                  <div className=\"text-sm font-medium text-foreground\">{selectedAircraft.name}</div>\r\n                  <div className=\"text-xs text-muted-foreground\">{selectedAircraft.speed} kts â€¢ {selectedAircraft.burnRate} gph</div>\r\n                </div>\r\n              </div>\r\n              \r\n              {/* Leg Breakdown - Drag and Drop */}\r\n              {routeStats.legs.length > 0 && (\r\n                <div className=\"mt-3 pt-3 border-t border-border flex gap-2 overflow-x-auto pb-1\">\r\n                  {routeStats.legs.map((leg, toIdx) => {\r\n                    const isDragging = draggedLegIndex === toIdx;\r\n                    const isDragOver = draggedLegIndex !== null && draggedLegIndex !== toIdx;\r\n                    \r\n                    return (\r\n                      <div\r\n                        key={toIdx}\r\n                        draggable\r\n                        onDragStart={(e) => {\r\n                          setDraggedLegIndex(toIdx);\r\n                          e.dataTransfer.effectAllowed = 'move';\r\n                          e.dataTransfer.setData('text/plain', String(toIdx));\r\n                        }}\r\n                        onDragOver={(e) => {\r\n                          e.preventDefault();\r\n                          e.dataTransfer.dropEffect = 'move';\r\n                        }}\r\n                        onDragEnter={(e) => {\r\n                          e.preventDefault();\r\n                        }}\r\n                        onDrop={(e) => {\r\n                          e.preventDefault();\r\n                          e.stopPropagation();\r\n                          const fromIdx = draggedLegIndex;\r\n                          if (fromIdx !== null && fromIdx !== toIdx) {\r\n                            // When dropping leg fromIdx onto leg toIdx:\r\n                            // - Take waypoint at position fromIdx + 1 (destination of dragged leg)\r\n                            // - Move it to position toIdx + 1\r\n                            const newWaypoints = [...waypoints];\r\n                            const movedWp = newWaypoints[fromIdx + 1];\r\n                            newWaypoints.splice(fromIdx + 1, 1);\r\n                            newWaypoints.splice(toIdx + 1, 0, movedWp);\r\n                            setWaypoints(newWaypoints.map((w, idx) => ({ ...w, sequence: idx })));\r\n                          }\r\n                          setDraggedLegIndex(null);\r\n                        }}\r\n                        onDragEnd={() => setDraggedLegIndex(null)}\r\n                        className={`flex-shrink-0 bg-background rounded px-3 py-2 text-xs cursor-move select-none transition-all ${\r\n                          isDragging ? 'opacity-30 scale-95 ring-2 ring-sky-500' : \r\n                          isDragOver ? 'ring-2 ring-amber-500 scale-105 bg-secondary' : \r\n                          'hover:bg-secondary hover:scale-105'\r\n                        }`}\r\n                        style={{ touchAction: 'none' }}\r\n                      >\r\n                        <span className=\"text-sky-400 font-medium\">{leg.from.icao}</span>\r\n                        <span className=\"text-muted-foreground/60 mx-1\">â†’</span>\r\n                        <span className=\"text-amber-400 font-medium\">{leg.to.icao}</span>\r\n                        <div className=\"text-muted-foreground mt-1\">{Math.round(leg.distance)} NM â€¢ ${leg.cost.toFixed(0)}</div>\r\n                      </div>\r\n                    );\r\n                  })}\r\n                </div>\r\n              )}\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Mobile Orientation Warning Popup */}\r\n      {showOrientationWarning && (\r\n        <div className=\"fixed inset-0 z-[9999] bg-black/90 flex items-center justify-center p-8\">\r\n          <div className=\"text-center\">\r\n            {/* Phone Rotation Animation */}\r\n            <div className=\"mb-8 relative w-24 h-40 mx-auto border-4 border-white rounded-3xl bg-card\">\r\n              <div className=\"absolute inset-0 flex items-center justify-center\">\r\n                <div className=\"w-16 h-1 bg-white rounded animate-pulse\"></div>\r\n              </div>\r\n              <div className=\"absolute top-2 left-1/2 -translate-x-1/2 w-2 h-2 bg-secondary rounded-full\"></div>\r\n              <div className=\"absolute bottom-2 left-1/2 -translate-x-1/2 w-8 h-1 bg-secondary rounded\"></div>\r\n            </div>\r\n            {/* Arrow Animation */}\r\n            <div className=\"mb-6 text-6xl animate-bounce\">â†»</div>\r\n            <h2 className=\"text-2xl font-bold text-foreground mb-2\">Rotate Your Phone</h2>\r\n            <p className=\"text-muted-foreground mb-6\">For the best experience, please rotate your phone to landscape mode.</p>\r\n            <button\r\n              onClick={() => {\r\n                setOrientationDismissed(true);\r\n                setShowOrientationWarning(false);\r\n              }}\r\n              className=\"bg-sky-500 hover:bg-sky-600 text-foreground px-6 py-3 rounded-lg font-medium\"\r\n            >\r\n              Continue Anyway\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Auth Modal */}\r\n      <AuthModal \r\n        isOpen={authModalOpen} \r\n        onClose={() => setAuthModalOpen(false)} \r\n        action={authModalAction}\r\n        onConfirm={() => {\r\n          if (authModalAction === 'save') {\r\n            saveFlightPlan();\r\n          }\r\n        }}\r\n      />\r\n\r\n      {/* Upgrade Modal */}\r\n      <UpgradeModal \r\n        isOpen={upgradeModalOpen} \r\n        onClose={() => setUpgradeModalOpen(false)}\r\n        feature={upgradeFeature}\r\n      />\r\n\r\n      {/* Tier Explainer Modal */}\r\n      <TierExplainerModal \r\n        isOpen={showTierExplainer} \r\n        onClose={() => setShowTierExplainer(false)}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n\r\n// Wrapper component with Suspense for useSearchParams\r\nexport default function FuelSaverPage() {\r\n  return (\r\n    <Suspense fallback={\r\n      <div className=\"min-h-screen bg-background text-foreground flex items-center justify-center\">\r\n        <div className=\"text-muted-foreground\">Loading...</div>\r\n      </div>\r\n    }>\r\n      <FuelSaverContent />\r\n    </Suspense>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\fuel-saver\\view\\[id]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'router' is assigned a value but never used.","line":62,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":62,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'session' is assigned a value but never used.","line":63,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":63,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'status' is assigned a value but never used.","line":63,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":63,"endColumn":32},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is assigned a value but never used.","line":66,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":66,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setError' is assigned a value but never used.","line":66,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":66,"endColumn":25},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":141,"column":61,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[5172,5221],"text":"This trip doesn&apos;t exist or you don't have access."},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[5172,5221],"text":"This trip doesn&lsquo;t exist or you don't have access."},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[5172,5221],"text":"This trip doesn&#39;t exist or you don't have access."},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[5172,5221],"text":"This trip doesn&rsquo;t exist or you don't have access."},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":141,"column":80,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[5172,5221],"text":"This trip doesn't exist or you don&apos;t have access."},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[5172,5221],"text":"This trip doesn't exist or you don&lsquo;t have access."},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[5172,5221],"text":"This trip doesn't exist or you don&#39;t have access."},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[5172,5221],"text":"This trip doesn't exist or you don&rsquo;t have access."},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect, useMemo } from 'react';\nimport { useParams, useRouter } from 'next/navigation';\nimport Link from 'next/link';\nimport { useSession } from 'next-auth/react';\n\n// This page shows a static view of a saved flight plan\n// without loading the interactive map\n\ninterface Waypoint {\n  id?: string;\n  icao: string;\n  name?: string;\n  city?: string;\n  latitude: number;\n  longitude: number;\n  sequence?: number;\n}\n\ninterface FlightPlan {\n  id?: string;\n  name?: string;\n  callsign?: string;\n  aircraftType?: string;\n  pilotName?: string;\n  departureTime?: string;\n  cruisingAlt?: number;\n  alternateIcao?: string;\n  remarks?: string;\n  soulsOnBoard?: number;\n  departureFuel?: number;\n  departureIcao?: string;\n  arrivalIcao?: string;\n  waypoints?: Waypoint[];\n  createdAt?: string;\n  updatedAt?: string;\n}\n\n// Simple distance calculation\nfunction calculateDistance(lat1: number, lon1: number, lat2: number, lon2: number): number {\n  const R = 3440.065; // Earth radius in NM\n  const dLat = (lat2 - lat1) * Math.PI / 180;\n  const dLon = (lon2 - lon1) * Math.PI / 180;\n  const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *\n    Math.sin(dLon / 2) * Math.sin(dLon / 2);\n  return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n}\n\n// Default aircraft profiles with W&B data\nconst AIRCRAFT_PROFILES = [\n  { name: 'Cessna 172S', speed: 120, burnRate: 8.4, fuelCapacity: 56, emptyWeight: 1689, emptyCG: 39.1, maxWeight: 2550, arms: { frontSeats: 37.0, rearSeats: 73.0, baggage1: 95.0, baggage2: 123.0, fuel: 48.0 }, cgLimits: { forward: 35.0, aft: 47.3 } },\n  { name: 'Cessna 182T', speed: 140, burnRate: 12, fuelCapacity: 88, emptyWeight: 1710, emptyCG: 39.0, maxWeight: 3100, arms: { frontSeats: 37.0, rearSeats: 73.0, baggage1: 95.0, baggage2: 123.0, fuel: 48.0 }, cgLimits: { forward: 35.0, aft: 47.3 } },\n  { name: 'Cirrus SR22', speed: 155, burnRate: 14, fuelCapacity: 82, emptyWeight: 3400, emptyCG: 35.0, maxWeight: 3600, arms: { frontSeats: 35.0, rearSeats: 66.0, baggage1: 86.0, baggage2: 86.0, fuel: 48.0 }, cgLimits: { forward: 33.0, aft: 47.3 } },\n  { name: 'Diamond DA40', speed: 140, burnRate: 10, fuelCapacity: 52, emptyWeight: 1650, emptyCG: 93.0, maxWeight: 2700, arms: { frontSeats: 85.0, rearSeats: 85.0, baggage1: 90.0, fuel: 90.0 }, cgLimits: { forward: 82.0, aft: 96.0 } },\n  { name: 'Piper Archer', speed: 120, burnRate: 9, fuelCapacity: 48, emptyWeight: 1500, emptyCG: 35.0, maxWeight: 2550, arms: { frontSeats: 32.5, rearSeats: 75.0, baggage1: 95.0, fuel: 47.0 }, cgLimits: { forward: 31.0, aft: 47.3 } },\n];\n\nexport default function ViewTripPage() {\n  const params = useParams();\n  const router = useRouter();\n  const { data: session, status } = useSession();\n  const [plan, setPlan] = useState<FlightPlan | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [selectedAircraft, setSelectedAircraft] = useState(AIRCRAFT_PROFILES[0]);\n  const [fuelPrice, setFuelPrice] = useState(6.50);\n\n  useEffect(() => {\n    const fetchPlan = async () => {\n      try {\n        // If we have an ID, fetch from API\n        if (params.id) {\n          const res = await fetch(`/api/flight-plans?id=${params.id}`);\n          if (res.ok) {\n            const data = await res.json();\n            if (data.flightPlans?.[0]) {\n              setPlan(data.flightPlans[0]);\n            }\n          }\n        }\n      } catch (err) {\n        console.error('Error fetching plan:', err);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchPlan();\n  }, [params.id]);\n\n  // Calculate route stats\n  const routeStats = useMemo(() => {\n    if (!plan?.waypoints || plan.waypoints.length < 2) return null;\n\n    let totalDist = 0;\n    const legs: { from: string; to: string; distance: number }[] = [];\n\n    for (let i = 1; i < plan.waypoints.length; i++) {\n      const dist = calculateDistance(\n        plan.waypoints[i-1].latitude, plan.waypoints[i-1].longitude,\n        plan.waypoints[i].latitude, plan.waypoints[i].longitude\n      );\n      totalDist += dist;\n      legs.push({\n        from: plan.waypoints[i-1].icao,\n        to: plan.waypoints[i].icao,\n        distance: dist\n      });\n    }\n\n    const timeHours = totalDist / selectedAircraft.speed;\n    const fuelNeeded = (totalDist / selectedAircraft.speed) * selectedAircraft.burnRate * 1.25;\n    const estimatedCost = fuelNeeded * fuelPrice;\n\n    return {\n      totalDistance: totalDist,\n      totalTime: timeHours,\n      fuelNeeded,\n      estimatedCost,\n      legs\n    };\n  }, [plan?.waypoints, selectedAircraft, fuelPrice]);\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-slate-900 text-white p-8\">\n        <div className=\"max-w-4xl mx-auto\">\n          <div className=\"animate-pulse\">Loading...</div>\n        </div>\n      </div>\n    );\n  }\n\n  if (!plan) {\n    return (\n      <div className=\"min-h-screen bg-slate-900 text-white p-8\">\n        <div className=\"max-w-4xl mx-auto text-center\">\n          <h1 className=\"text-2xl font-bold mb-4\">Trip Not Found</h1>\n          <p className=\"text-slate-400 mb-6\">This trip doesn't exist or you don't have access.</p>\n          <Link href=\"/trips\" className=\"bg-emerald-500 hover:bg-emerald-600 px-4 py-2 rounded\">\n            Back to My Trips\n          </Link>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-slate-900 text-white\">\n      {/* Header */}\n      <div className=\"bg-slate-800 border-b border-slate-700 p-4\">\n        <div className=\"max-w-4xl mx-auto flex items-center justify-between\">\n          <div className=\"flex items-center gap-4\">\n            <Link href=\"/trips\" className=\"text-slate-400 hover:text-white\">\n              â† Back\n            </Link>\n            <div>\n              <h1 className=\"text-xl font-bold\">{plan.name || 'Flight Plan'}</h1>\n              {plan.createdAt && (\n                <p className=\"text-xs text-slate-400\">\n                  Created {new Date(plan.createdAt).toLocaleDateString()}\n                </p>\n              )}\n            </div>\n          </div>\n          <div className=\"flex gap-2\">\n            <Link \n              href={`/modules/fuel-saver?load=${plan.id}`}\n              className=\"bg-sky-500 hover:bg-sky-600 px-4 py-2 rounded text-sm\"\n            >\n              âœï¸ Edit\n            </Link>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"max-w-4xl mx-auto p-4 space-y-6\">\n        {/* Quick Stats */}\n        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n          <div className=\"bg-slate-800 rounded-lg p-4 text-center\">\n            <div className=\"text-2xl font-bold text-sky-400\">\n              {routeStats?.totalDistance.toFixed(0) || '-'}\n            </div>\n            <div className=\"text-xs text-slate-400\">Total NM</div>\n          </div>\n          <div className=\"bg-slate-800 rounded-lg p-4 text-center\">\n            <div className=\"text-2xl font-bold text-amber-400\">\n              {routeStats?.totalTime.toFixed(1) || '-'}h\n            </div>\n            <div className=\"text-xs text-slate-400\">Flight Time</div>\n          </div>\n          <div className=\"bg-slate-800 rounded-lg p-4 text-center\">\n            <div className=\"text-2xl font-bold text-purple-400\">\n              {routeStats?.fuelNeeded.toFixed(0) || '-'}\n            </div>\n            <div className=\"text-xs text-slate-400\">Gal Fuel</div>\n          </div>\n          <div className=\"bg-slate-800 rounded-lg p-4 text-center\">\n            <div className=\"text-2xl font-bold text-emerald-400\">\n              ${routeStats?.estimatedCost.toFixed(0) || '-'}\n            </div>\n            <div className=\"text-xs text-slate-400\">Est. Cost</div>\n          </div>\n        </div>\n\n        {/* Flight Details */}\n        <div className=\"bg-slate-800 rounded-lg p-4\">\n          <h2 className=\"font-bold mb-3\">Flight Details</h2>\n          <div className=\"grid grid-cols-2 md:grid-cols-3 gap-4 text-sm\">\n            {plan.callsign && (\n              <div>\n                <span className=\"text-slate-400\">Callsign:</span> {plan.callsign}\n              </div>\n            )}\n            {plan.pilotName && (\n              <div>\n                <span className=\"text-slate-400\">Pilot:</span> {plan.pilotName}\n              </div>\n            )}\n            {plan.aircraftType && (\n              <div>\n                <span className=\"text-slate-400\">Aircraft:</span> {plan.aircraftType}\n              </div>\n            )}\n            {plan.departureTime && (\n              <div>\n                <span className=\"text-slate-400\">Departure:</span> {new Date(plan.departureTime).toLocaleString()}\n              </div>\n            )}\n            {plan.cruisingAlt && (\n              <div>\n                <span className=\"text-slate-400\">Altitude:</span> {plan.cruisingAlt} ft\n              </div>\n            )}\n            {plan.soulsOnBoard && (\n              <div>\n                <span className=\"text-slate-400\">Souls:</span> {plan.soulsOnBoard}\n              </div>\n            )}\n          </div>\n          {plan.remarks && (\n            <div className=\"mt-3 pt-3 border-t border-slate-700\">\n              <span className=\"text-slate-400\">Remarks:</span> {plan.remarks}\n            </div>\n          )}\n        </div>\n\n        {/* Calculator Settings */}\n        <div className=\"bg-slate-800 rounded-lg p-4\">\n          <h2 className=\"font-bold mb-3\">Calculator Settings</h2>\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <label className=\"block text-xs text-slate-400 mb-1\">Aircraft</label>\n              <select\n                value={selectedAircraft.name}\n                onChange={(e) => setSelectedAircraft(AIRCRAFT_PROFILES.find(a => a.name === e.target.value) || AIRCRAFT_PROFILES[0])}\n                className=\"w-full bg-slate-700 border border-slate-600 rounded px-3 py-2\"\n              >\n                {AIRCRAFT_PROFILES.map(ac => (\n                  <option key={ac.name} value={ac.name}>{ac.name}</option>\n                ))}\n              </select>\n            </div>\n            <div>\n              <label className=\"block text-xs text-slate-400 mb-1\">Fuel Price ($/gal)</label>\n              <input\n                type=\"number\"\n                value={fuelPrice}\n                onChange={(e) => setFuelPrice(Number(e.target.value))}\n                step={0.1}\n                className=\"w-full bg-slate-700 border border-slate-600 rounded px-3 py-2\"\n              />\n            </div>\n          </div>\n        </div>\n\n        {/* Route */}\n        <div className=\"bg-slate-800 rounded-lg p-4\">\n          <h2 className=\"font-bold mb-3\">Route</h2>\n          <div className=\"space-y-2\">\n            {plan.waypoints?.map((wp, i) => (\n              <div key={i} className=\"flex items-center gap-3\">\n                <span className=\"w-6 h-6 rounded-full bg-sky-600 flex items-center justify-center text-xs font-bold\">\n                  {i + 1}\n                </span>\n                <div className=\"flex-1\">\n                  <span className=\"font-medium\">{wp.icao}</span>\n                  <span className=\"text-slate-400 ml-2 text-sm\">{wp.name}</span>\n                </div>\n                {i > 0 && routeStats?.legs[i-1] && (\n                  <span className=\"text-slate-400 text-sm\">\n                    {routeStats.legs[i-1].distance.toFixed(0)} NM\n                  </span>\n                )}\n              </div>\n            ))}\n          </div>\n        </div>\n\n        {/* Nav Log Preview */}\n        <div className=\"bg-slate-800 rounded-lg p-4\">\n          <div className=\"flex items-center justify-between mb-3\">\n            <h2 className=\"font-bold\">Nav Log</h2>\n            <button\n              onClick={() => window.print()}\n              className=\"text-xs bg-slate-700 hover:bg-slate-600 px-3 py-1 rounded\"\n            >\n              ðŸ–¨ï¸ Print\n            </button>\n          </div>\n          \n          {/* Simple Nav Log Table */}\n          <div className=\"overflow-x-auto\">\n            <table className=\"w-full text-sm\">\n              <thead className=\"bg-slate-700\">\n                <tr>\n                  <th className=\"px-2 py-1 text-left\">From</th>\n                  <th className=\"px-2 py-1 text-left\">To</th>\n                  <th className=\"px-2 py-1\">Course</th>\n                  <th className=\"px-2 py-1\">Dist</th>\n                  <th className=\"px-2 py-1\">Time</th>\n                  <th className=\"px-2 py-1\">Fuel</th>\n                </tr>\n              </thead>\n              <tbody>\n                {plan.waypoints?.slice(1).map((wp, i) => {\n                  const leg = routeStats?.legs[i];\n                  const time = leg ? (leg.distance / selectedAircraft.speed * 60) : 0;\n                  const fuel = leg ? (leg.distance / selectedAircraft.speed * selectedAircraft.burnRate * 1.25) : 0;\n                  const course = i > 0 ? calculateCourse(\n                    plan.waypoints![i-1].latitude, plan.waypoints![i-1].longitude,\n                    wp.latitude, wp.longitude\n                  ) : 0;\n                  \n                  return (\n                    <tr key={i} className=\"border-t border-slate-700\">\n                      <td className=\"px-2 py-1\">{plan.waypoints![i].icao}</td>\n                      <td className=\"px-2 py-1\">{wp.icao}</td>\n                      <td className=\"px-2 py-1 text-center\">{course}Â°</td>\n                      <td className=\"px-2 py-1 text-center\">{leg?.distance.toFixed(0)} NM</td>\n                      <td className=\"px-2 py-1 text-center\">{Math.floor(time)}:{((time % 1) * 60).toFixed(0).padStart(2, '0')}</td>\n                      <td className=\"px-2 py-1 text-center\">{fuel.toFixed(1)} gal</td>\n                    </tr>\n                  );\n                })}\n                <tr className=\"border-t border-slate-600 bg-slate-700 font-bold\">\n                  <td colSpan={3} className=\"px-2 py-1\">TOTAL</td>\n                  <td className=\"px-2 py-1 text-center\">{routeStats?.totalDistance.toFixed(0)} NM</td>\n                  <td className=\"px-2 py-1 text-center\">{Math.floor(routeStats?.totalTime || 0)}:{(((routeStats?.totalTime || 0) % 1) * 60).toFixed(0).padStart(2, '0')}</td>\n                  <td className=\"px-2 py-1 text-center\">{routeStats?.fuelNeeded.toFixed(1)} gal</td>\n                </tr>\n              </tbody>\n            </table>\n          </div>\n          \n          <p className=\"text-xs text-slate-500 mt-3 text-center\">\n            Generated by FuelSaver - For planning purposes only, not for navigation\n          </p>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n// Calculate bearing between two points\nfunction calculateCourse(lat1: number, lon1: number, lat2: number, lon2: number): number {\n  const dLon = (lon2 - lon1) * Math.PI / 180;\n  const lat1Rad = lat1 * Math.PI / 180;\n  const lat2Rad = lat2 * Math.PI / 180;\n  \n  const x = Math.sin(dLon) * Math.cos(lat2Rad);\n  const y = Math.cos(lat1Rad) * Math.sin(lat2Rad) - Math.sin(lat1Rad) * Math.cos(lat2Rad) * Math.cos(dLon);\n  \n  let course = (Math.atan2(x, y) * 180) / Math.PI;\n  course = ((course % 360) + 360) % 360;\n  return Math.round(course);\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\logbook\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\logbook\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TabsList' is defined but never used.","line":12,"column":29,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":37,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"TabsList"},"fix":{"range":[604,614],"text":""},"desc":"Remove unused variable \"TabsList\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TabsTrigger' is defined but never used.","line":12,"column":39,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":50,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"TabsTrigger"},"fix":{"range":[614,627],"text":""},"desc":"Remove unused variable \"TabsTrigger\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Plane' is defined but never used.","line":13,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":15,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Plane"},"fix":{"range":[667,673],"text":""},"desc":"Remove unused variable \"Plane\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setAuthority' is assigned a value but never used.","line":80,"column":21,"nodeType":"Identifier","messageId":"unusedVar","endLine":80,"endColumn":33},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":113,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":113,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3189,3192],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3189,3192],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":115,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3357,3360],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3357,3360],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadPreferences'. Either include it or remove the dependency array.","line":153,"column":6,"nodeType":"ArrayExpression","endLine":153,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [loadPreferences, status]","fix":{"range":[4440,4448],"text":"[loadPreferences, status]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":207,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":207,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5848,5851],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5848,5851],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":403,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":403,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13673,13676],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13673,13676],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":592,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":592,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23409,23412],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23409,23412],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { Suspense, useEffect, useMemo, useState } from 'react'\nimport { useSearchParams } from 'next/navigation'\nimport { useSession, signIn } from 'next-auth/react'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Textarea } from '@/components/ui/textarea'\nimport { Badge } from '@/components/ui/badge'\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle } from '@/components/ui/dialog'\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'\nimport { Plane, Download, Plus, FileText, ShieldCheck, Upload } from 'lucide-react'\n\ntype Authority = 'FAA' | 'EASA' | 'BOTH'\n\ninterface LogbookEntry {\n  id: string\n  date: string\n  aircraft: string\n  routeFrom: string\n  routeTo: string\n  totalTime: number\n  picTime: number\n  sicTime: number\n  soloTime: number\n  dualGiven: number\n  dualReceived: number\n  nightTime: number\n  instrumentTime: number\n  crossCountryTime: number\n  dayLandings: number\n  nightLandings: number\n  remarks?: string | null\n  authority?: Authority\n  isPending?: boolean\n}\n\ninterface StartingTotals {\n  totalTime: number\n  picTime: number\n  sicTime: number\n  nightTime: number\n  instrumentTime: number\n  crossCountryTime: number\n  landingsDay: number\n  landingsNight: number\n  asOfDate?: string | null\n}\n\nconst TAB_KEYS = [\n  'add',\n  'search',\n  'totals',\n  'currency',\n  'analysis',\n  'download',\n  'import',\n  'starting-totals',\n  'check-flights',\n  'print-view',\n  'pending',\n  'preferences',\n] as const\n\ntype TabKey = typeof TAB_KEYS[number]\n\nfunction LogbookContent() {\n  const { data: session, status } = useSession()\n  const searchParams = useSearchParams()\n  const initialTab = (searchParams.get('tab') as TabKey) || 'add'\n  const [activeTab, setActiveTab] = useState<TabKey>(initialTab)\n\n  const [entries, setEntries] = useState<LogbookEntry[]>([])\n  const [startingTotals, setStartingTotals] = useState<StartingTotals | null>(null)\n  const [loading, setLoading] = useState(false)\n  const [error, setError] = useState<string | null>(null)\n  const [fieldErrors, setFieldErrors] = useState<Record<string, string>>({})\n\n  const [authority, setAuthority] = useState<Authority>('FAA')\n  const [formData, setFormData] = useState({\n    date: new Date().toISOString().split('T')[0],\n    aircraft: '',\n    routeFrom: '',\n    routeTo: '',\n    isSimulator: false,\n    trainingDeviceId: '',\n    trainingDeviceLocation: '',\n    safetyPilotName: '',\n    requiresSafetyPilot: false,\n    totalTime: '',\n    picTime: '',\n    sicTime: '',\n    soloTime: '',\n    dualGiven: '',\n    dualReceived: '',\n    nightTime: '',\n    instrumentTime: '',\n    actualInstrumentTime: '',\n    simulatedInstrumentTime: '',\n    groundTrainingReceived: '',\n    simTrainingReceived: '',\n    crossCountryTime: '',\n    dayLandings: '0',\n    nightLandings: '0',\n    isDay: true,\n    isNight: false,\n    remarks: '',\n    isPending: false,\n  })\n\n  const [filters, setFilters] = useState({ year: 'all', aircraft: 'all', search: '' })\n  const [currencyProgress, setCurrencyProgress] = useState<any[]>([])\n  const [openDialog, setOpenDialog] = useState<null | 'add' | 'import' | 'starting-totals' | 'print'>(null)\n  const [preferences, setPreferences] = useState<any>({\n    timeDisplayFormat: 'decimal-1-2',\n    sumTimeMode: 'whole-minutes',\n    preferredTimeZone: 'UTC',\n    dateInterpretation: 'local',\n    showInstructorTime: true,\n    showSicTime: true,\n    showHobbsTach: false,\n    autoFillTimes: true,\n    autoFillLandings: true,\n    includeHeliports: false,\n    estimateNight: false,\n    roundNearestTenth: false,\n    nightStartRule: 'civil-twilight',\n    nightLandingRule: 'sunset-plus-60',\n    totalsByCategoryClass: true,\n    totalsByModel: false,\n    totalsByModelFamily: false,\n    totalsByFeatures: true,\n    currencyAuthorities: 'FAA,EASA',\n    currencyByCategory: true,\n    currencyByModel: false,\n    allowNightTouchAndGo: true,\n    requireDayLandings: false,\n    expiredCurrencyDisplay: 'forever',\n    maintenanceDueWindowDays: 90,\n    notifyCurrencyWeekly: false,\n    notifyCurrencyOnExpiry: true,\n    notifyTotalsWeekly: false,\n    notifyTotalsMonthly: false,\n  })\n\n  useEffect(() => {\n    if (status !== 'authenticated') return\n    loadEntries()\n    loadStartingTotals()\n    loadCurrencyProgress()\n    loadPreferences()\n  }, [status])\n\n  useEffect(() => {\n    if (TAB_KEYS.includes(initialTab)) setActiveTab(initialTab)\n  }, [initialTab])\n\n  const loadEntries = async () => {\n    setLoading(true)\n    setError(null)\n    try {\n      const res = await fetch('/api/logbook')\n      if (!res.ok) throw new Error('Failed to load logbook')\n      const data = await res.json()\n      setEntries(Array.isArray(data.entries) ? data.entries : [])\n    } catch {\n      setError('Failed to load logbook')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const loadStartingTotals = async () => {\n    try {\n      const res = await fetch('/api/logbook/starting-totals')\n      if (!res.ok) return\n      const data = await res.json()\n      setStartingTotals(data.totals ?? null)\n    } catch {\n      setStartingTotals(null)\n    }\n  }\n\n  const loadCurrencyProgress = async () => {\n    try {\n      const res = await fetch('/api/logbook/currency/progress')\n      if (!res.ok) return\n      const data = await res.json()\n      setCurrencyProgress(data.progress || [])\n    } catch {\n      setCurrencyProgress([])\n    }\n  }\n\n  const loadPreferences = async () => {\n    try {\n      const res = await fetch('/api/logbook/preferences')\n      if (!res.ok) return\n      const data = await res.json()\n      if (data.preferences) setPreferences({ ...preferences, ...data.preferences })\n    } catch {\n      // noop\n    }\n  }\n\n  const savePreferences = async (next: any) => {\n    setPreferences(next)\n    await fetch('/api/logbook/preferences', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify(next),\n    })\n  }\n\n  const filteredEntries = useMemo(() => {\n    return entries.filter((entry) => {\n      if (filters.year !== 'all' && new Date(entry.date).getFullYear().toString() !== filters.year) return false\n      if (filters.aircraft !== 'all' && entry.aircraft !== filters.aircraft) return false\n      if (filters.search) {\n        const q = filters.search.toLowerCase()\n        return (\n          entry.aircraft.toLowerCase().includes(q) ||\n          entry.routeFrom.toLowerCase().includes(q) ||\n          entry.routeTo.toLowerCase().includes(q) ||\n          (entry.remarks || '').toLowerCase().includes(q)\n        )\n      }\n      return true\n    })\n  }, [entries, filters])\n\n  const totals = useMemo(() => {\n    return filteredEntries.reduce(\n      (acc, entry) => ({\n        totalTime: acc.totalTime + entry.totalTime,\n        picTime: acc.picTime + entry.picTime,\n        sicTime: acc.sicTime + entry.sicTime,\n        soloTime: acc.soloTime + entry.soloTime,\n        dualGiven: acc.dualGiven + entry.dualGiven,\n        dualReceived: acc.dualReceived + entry.dualReceived,\n        nightTime: acc.nightTime + entry.nightTime,\n        instrumentTime: acc.instrumentTime + entry.instrumentTime,\n        crossCountryTime: acc.crossCountryTime + entry.crossCountryTime,\n        dayLandings: acc.dayLandings + entry.dayLandings,\n        nightLandings: acc.nightLandings + entry.nightLandings,\n      }),\n      {\n        totalTime: 0,\n        picTime: 0,\n        sicTime: 0,\n        soloTime: 0,\n        dualGiven: 0,\n        dualReceived: 0,\n        nightTime: 0,\n        instrumentTime: 0,\n        crossCountryTime: 0,\n        dayLandings: 0,\n        nightLandings: 0,\n      }\n    )\n  }, [filteredEntries])\n\n  const submitEntry = async () => {\n    setLoading(true)\n    setError(null)\n    try {\n      const nextErrors: Record<string, string> = {}\n      if (!formData.date) nextErrors.date = 'Required'\n      if (!formData.totalTime) nextErrors.totalTime = 'Required'\n      if (!formData.isSimulator && !formData.routeFrom) nextErrors.routeFrom = 'Required'\n      if (!formData.isSimulator && !formData.routeTo) nextErrors.routeTo = 'Required'\n      if (formData.isSimulator && !formData.trainingDeviceId) nextErrors.trainingDeviceId = 'Required'\n      if (formData.isSimulator && !formData.trainingDeviceLocation) nextErrors.trainingDeviceLocation = 'Required'\n      if (formData.requiresSafetyPilot && !formData.safetyPilotName) nextErrors.safetyPilotName = 'Required'\n      if (parseFloat(formData.instrumentTime) > 0 && !formData.actualInstrumentTime && !formData.simulatedInstrumentTime) {\n        nextErrors.instrumentBreakdown = 'Required'\n      }\n\n      if (Object.keys(nextErrors).length > 0) {\n        setFieldErrors(nextErrors)\n        setError('Please complete required fields.')\n        setLoading(false)\n        return\n      }\n\n      setFieldErrors({})\n\n      const res = await fetch('/api/logbook', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          ...formData,\n          authority,\n          totalTime: parseFloat(formData.totalTime) || 0,\n          picTime: parseFloat(formData.picTime) || 0,\n          sicTime: parseFloat(formData.sicTime) || 0,\n          soloTime: parseFloat(formData.soloTime) || 0,\n          dualGiven: parseFloat(formData.dualGiven) || 0,\n          dualReceived: parseFloat(formData.dualReceived) || 0,\n          nightTime: parseFloat(formData.nightTime) || 0,\n          instrumentTime: parseFloat(formData.instrumentTime) || 0,\n          actualInstrumentTime: parseFloat(formData.actualInstrumentTime) || 0,\n          simulatedInstrumentTime: parseFloat(formData.simulatedInstrumentTime) || 0,\n          groundTrainingReceived: parseFloat(formData.groundTrainingReceived) || 0,\n          simTrainingReceived: parseFloat(formData.simTrainingReceived) || 0,\n          crossCountryTime: parseFloat(formData.crossCountryTime) || 0,\n          dayLandings: parseInt(formData.dayLandings) || 0,\n          nightLandings: parseInt(formData.nightLandings) || 0,\n        }),\n      })\n      if (!res.ok) throw new Error('Failed to save entry')\n      await loadEntries()\n      setActiveTab('search')\n    } catch {\n      setError('Failed to save entry')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const isSaveDisabled = () => {\n    if (!formData.date || !formData.totalTime) return true\n    if (!formData.isSimulator && (!formData.routeFrom || !formData.routeTo)) return true\n    if (formData.isSimulator && (!formData.trainingDeviceId || !formData.trainingDeviceLocation)) return true\n    if (formData.requiresSafetyPilot && !formData.safetyPilotName) return true\n    if (parseFloat(formData.instrumentTime) > 0 && !formData.actualInstrumentTime && !formData.simulatedInstrumentTime) return true\n    return false\n  }\n\n  const saveStartingTotals = async (totals: StartingTotals) => {\n    await fetch('/api/logbook/starting-totals', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify(totals),\n    })\n    await loadStartingTotals()\n  }\n\n  const formatHours = (value: number) => {\n    if (preferences.timeDisplayFormat === 'hhmm') {\n      const totalMinutes = Math.round(value * 60)\n      const hours = Math.floor(totalMinutes / 60)\n      const minutes = totalMinutes % 60\n      return `${hours}:${minutes.toString().padStart(2, '0')}`\n    }\n\n    if (preferences.timeDisplayFormat === 'decimal-1') return value.toFixed(1)\n    if (preferences.timeDisplayFormat === 'decimal-2') return value.toFixed(2)\n    return value.toFixed(value % 1 === 0 ? 1 : 2)\n  }\n\n  const exportCsv = () => {\n    const headers = ['Date', 'Aircraft', 'From', 'To', 'Total', 'PIC', 'SIC', 'Solo', 'Dual Given', 'Dual Received', 'Night', 'Instrument', 'XC', 'Day Landings', 'Night Landings', 'Remarks']\n    const rows = filteredEntries.map((entry) => [\n      entry.date,\n      entry.aircraft,\n      entry.routeFrom,\n      entry.routeTo,\n      formatHours(entry.totalTime),\n      formatHours(entry.picTime),\n      formatHours(entry.sicTime),\n      formatHours(entry.soloTime),\n      formatHours(entry.dualGiven),\n      formatHours(entry.dualReceived),\n      formatHours(entry.nightTime),\n      formatHours(entry.instrumentTime),\n      formatHours(entry.crossCountryTime),\n      entry.dayLandings,\n      entry.nightLandings,\n      `\"${entry.remarks || ''}\"`,\n    ].join(','))\n    const content = [headers.join(','), ...rows].join('\\n')\n    const blob = new Blob([content], { type: 'text/csv;charset=utf-8;' })\n    const link = document.createElement('a')\n    link.href = URL.createObjectURL(blob)\n    link.download = `logbook_export_${new Date().toISOString().split('T')[0]}.csv`\n    link.click()\n  }\n\n  if (status === 'loading') {\n    return <div className=\"min-h-screen bg-background p-6\">Loadingâ€¦</div>\n  }\n\n  if (!session) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center p-6\">\n        <Card className=\"max-w-md w-full\">\n          <CardContent className=\"pt-6 text-center\">\n            <div className=\"text-5xl mb-4\">ðŸ“˜</div>\n            <h1 className=\"text-2xl font-bold mb-2\">Logbook</h1>\n            <p className=\"text-muted-foreground mb-6\">Sign in to access your logbook, endorsements, and reports.</p>\n            <Button onClick={() => signIn()}>Sign In</Button>\n          </CardContent>\n        </Card>\n      </div>\n    )\n  }\n\n  const uniqueAircraft = [...new Set(entries.map((e) => e.aircraft))]\n  const years = Array.from({ length: 10 }, (_, i) => new Date().getFullYear() - i)\n  const currencyCounts = currencyProgress.reduce(\n    (acc, rule: any) => {\n      acc[rule.status] = (acc[rule.status] || 0) + 1\n      return acc\n    },\n    { current: 0, expiring: 0, expired: 0 } as Record<string, number>\n  )\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between\">\n        <div>\n          <h1 className=\"text-2xl font-semibold\">Logbook</h1>\n          <p className=\"text-xs text-muted-foreground\">FAA + EASA logbook with endorsements, currency, and reports.</p>\n        </div>\n        <div className=\"flex flex-wrap items-center gap-2\">\n          <Button size=\"sm\" onClick={() => setOpenDialog('add')}>Add Flight</Button>\n          <Button size=\"sm\" variant=\"outline\" onClick={() => setOpenDialog('import')}>Import</Button>\n          <Button size=\"sm\" variant=\"outline\" onClick={() => setOpenDialog('print')}>Print</Button>\n          <Button size=\"sm\" variant=\"outline\" onClick={async () => {\n            await fetch('/api/logbook/currency/calc', { method: 'POST' })\n            await loadCurrencyProgress()\n            setActiveTab('currency')\n          }}>Refresh Currency</Button>\n        </div>\n      </div>\n\n      <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-5\">\n        <Card>\n          <CardContent className=\"pt-6\">\n            <p className=\"text-xs text-muted-foreground\">Total Hours</p>\n            <p className=\"text-2xl font-semibold\">{formatHours(totals.totalTime)}</p>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"pt-6\">\n            <p className=\"text-xs text-muted-foreground\">Night</p>\n            <p className=\"text-2xl font-semibold\">{formatHours(totals.nightTime)}</p>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"pt-6\">\n            <p className=\"text-xs text-muted-foreground\">Instrument</p>\n            <p className=\"text-2xl font-semibold\">{formatHours(totals.instrumentTime)}</p>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"pt-6\">\n            <p className=\"text-xs text-muted-foreground\">Cross Country</p>\n            <p className=\"text-2xl font-semibold\">{formatHours(totals.crossCountryTime)}</p>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"pt-6\">\n            <p className=\"text-xs text-muted-foreground\">Currency</p>\n            <div className=\"flex flex-wrap gap-2\">\n              <Badge variant=\"secondary\">Current {currencyCounts.current}</Badge>\n              <Badge variant=\"outline\">Expiring {currencyCounts.expiring}</Badge>\n              <Badge variant=\"outline\">Expired {currencyCounts.expired}</Badge>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {error && <p className=\"text-sm text-destructive\">{error}</p>}\n\n        <Tabs value={activeTab} onValueChange={(value) => setActiveTab(value as TabKey)}>\n\n          <TabsContent value=\"add\" className=\"space-y-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Add Flights</CardTitle>\n                <CardDescription>Recent flight history.</CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-3\">\n                {entries.slice(0, 6).map((entry) => (\n                  <div key={entry.id} className=\"rounded-md border border-border p-3\">\n                    <div className=\"flex items-center justify-between\">\n                      <div>\n                        <p className=\"font-medium\">{entry.aircraft} Â· {entry.routeFrom} â†’ {entry.routeTo}</p>\n                        <p className=\"text-xs text-muted-foreground\">{new Date(entry.date).toLocaleDateString()} Â· {entry.totalTime.toFixed(1)} hrs</p>\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        {entry.authority && <Badge variant=\"secondary\">{entry.authority}</Badge>}\n                      </div>\n                    </div>\n                  </div>\n                ))}\n                <Button onClick={() => setOpenDialog('add')}><Plus className=\"mr-2 h-4 w-4\" /> Add Flight</Button>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"search\" className=\"space-y-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Search</CardTitle>\n                <CardDescription>Filter logbook entries.</CardDescription>\n              </CardHeader>\n              <CardContent className=\"grid gap-3 md:grid-cols-3\">\n                <Input placeholder=\"Search\" value={filters.search} onChange={(e) => setFilters({ ...filters, search: e.target.value })} />\n                <select className=\"h-9 rounded-md border border-input bg-background px-3 text-sm\" value={filters.year} onChange={(e) => setFilters({ ...filters, year: e.target.value })}>\n                  <option value=\"all\">All Years</option>\n                  {years.map((year) => <option key={year} value={year}>{year}</option>)}\n                </select>\n                <select className=\"h-9 rounded-md border border-input bg-background px-3 text-sm\" value={filters.aircraft} onChange={(e) => setFilters({ ...filters, aircraft: e.target.value })}>\n                  <option value=\"all\">All Aircraft</option>\n                  {uniqueAircraft.map((a) => <option key={a} value={a}>{a}</option>)}\n                </select>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle>Entries</CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                {loading && <p className=\"text-sm text-muted-foreground\">Loadingâ€¦</p>}\n                {!loading && filteredEntries.length === 0 && <p className=\"text-sm text-muted-foreground\">No entries.</p>}\n                {filteredEntries.map((entry) => (\n                  <Card key={entry.id}>\n                    <CardContent className=\"pt-6\">\n                      <div className=\"flex items-start justify-between gap-4\">\n                        <div>\n                          <p className=\"text-lg font-semibold\">{entry.aircraft}</p>\n                          <p className=\"text-sm text-muted-foreground\">{entry.routeFrom} â†’ {entry.routeTo}</p>\n                          <p className=\"text-xs text-muted-foreground mt-1\">{new Date(entry.date).toLocaleDateString()}</p>\n                        </div>\n                        <div className=\"text-right\">\n                          <p className=\"text-2xl font-semibold\">{formatHours(entry.totalTime)} hrs</p>\n                          <div className=\"mt-2 flex flex-wrap justify-end gap-2\">\n                            {entry.authority && <Badge variant=\"secondary\">{entry.authority}</Badge>}\n                            {entry.isPending && <Badge variant=\"outline\">Pending</Badge>}\n                            {entry.nightTime > 0 && <Badge variant=\"outline\">Night</Badge>}\n                            {entry.instrumentTime > 0 && <Badge variant=\"outline\">Instrument</Badge>}\n                          </div>\n                        </div>\n                      </div>\n                      {entry.remarks && <p className=\"text-sm text-muted-foreground mt-3\">{entry.remarks}</p>}\n                    </CardContent>\n                  </Card>\n                ))}\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"totals\" className=\"space-y-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Totals</CardTitle>\n                <CardDescription>Filtered totals for FAA/EASA.</CardDescription>\n              </CardHeader>\n              <CardContent className=\"grid gap-4 md:grid-cols-3\">\n                {Object.entries(totals).map(([key, value]) => (\n                  <div key={key} className=\"rounded-md border border-border p-3\">\n                    <p className=\"text-xs text-muted-foreground capitalize\">{key.replace(/([A-Z])/g, ' $1')}</p>\n                    <p className=\"text-lg font-semibold\">{typeof value === 'number' ? formatHours(value) : value}</p>\n                  </div>\n                ))}\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"currency\" className=\"space-y-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Currency</CardTitle>\n                <CardDescription>FAA + EASA currency rules dashboard.</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <Button variant=\"outline\" onClick={async () => {\n                  await fetch('/api/logbook/currency/calc', { method: 'POST' })\n                  await loadCurrencyProgress()\n                }}>\n                  <ShieldCheck className=\"mr-2 h-4 w-4\" /> Refresh Currency\n                </Button>\n                <div className=\"mt-4 space-y-3\">\n                  {currencyProgress.length === 0 && (\n                    <p className=\"text-sm text-muted-foreground\">No currency data yet.</p>\n                  )}\n                  {currencyProgress.map((rule) => (\n                    <div key={rule.code} className=\"rounded-md border border-border p-3\">\n                      <div className=\"flex items-center justify-between\">\n                        <div>\n                          <p className=\"font-medium\">{rule.name}</p>\n                          <p className=\"text-xs text-muted-foreground\">{rule.authority}</p>\n                        </div>\n                        <Badge variant={rule.status === 'current' ? 'secondary' : 'outline'}>{rule.status}</Badge>\n                      </div>\n                      <div className=\"mt-3 space-y-2 text-xs\">\n                        {rule.progress.map((p: any, idx: number) => {\n                          const percent = Math.min(100, Math.round((p.completed / Math.max(1, p.required)) * 100))\n                          return (\n                            <div key={idx}>\n                              <div className=\"flex justify-between\">\n                                <span>{p.unit}</span>\n                                <span>{p.completed} / {p.required}</span>\n                              </div>\n                              <div className=\"h-2 rounded-full bg-muted mt-1\">\n                                <div className=\"h-2 rounded-full bg-primary\" style={{ width: `${percent}%` }} />\n                              </div>\n                            </div>\n                          )\n                        })}\n                      </div>\n                      {rule.nextDueAt && (\n                        <p className=\"mt-2 text-xs text-muted-foreground\">Next due: {new Date(rule.nextDueAt).toLocaleDateString()}</p>\n                      )}\n                    </div>\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"analysis\" className=\"space-y-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Analysis</CardTitle>\n                <CardDescription>Visualize trends and readiness.</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-sm text-muted-foreground\">Charts and analysis will appear here (hours by month, instrument vs night, etc.).</p>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"download\" className=\"space-y-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Download</CardTitle>\n                <CardDescription>Export your logbook.</CardDescription>\n              </CardHeader>\n              <CardContent className=\"flex gap-2\">\n                <Button onClick={exportCsv}><Download className=\"mr-2 h-4 w-4\" />Export CSV</Button>\n                <Button variant=\"outline\" onClick={() => setActiveTab('print-view')}><FileText className=\"mr-2 h-4 w-4\" />Print View</Button>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"import\" className=\"space-y-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Import</CardTitle>\n                <CardDescription>Review recent imports and statuses.</CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-3\">\n                <p className=\"text-sm text-muted-foreground\">No recent imports. Start a new import to see history.</p>\n                <Button onClick={() => setOpenDialog('import')}><Upload className=\"mr-2 h-4 w-4\" />Start Import</Button>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"starting-totals\" className=\"space-y-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Starting Totals</CardTitle>\n                <CardDescription>Set your baseline totals before digital logging.</CardDescription>\n              </CardHeader>\n              <CardContent className=\"grid gap-3 md:grid-cols-2\">\n                <Input placeholder=\"Total Time\" defaultValue={startingTotals?.totalTime ?? ''} readOnly />\n                <Button onClick={() => setOpenDialog('starting-totals')}>Update Starting Totals</Button>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"check-flights\" className=\"space-y-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Check Flights</CardTitle>\n                <CardDescription>Validate compliance issues and missing fields.</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-sm text-muted-foreground\">Validation engine will flag missing times, endorsements, and currency gaps.</p>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"print-view\" className=\"space-y-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Print View</CardTitle>\n                <CardDescription>FAA and EASA formatted print layouts.</CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-2\">\n                <p className=\"text-sm text-muted-foreground\">Preview available in the print dialog.</p>\n                <Button variant=\"outline\" onClick={() => setOpenDialog('print')}><FileText className=\"mr-2 h-4 w-4\" />Open Print</Button>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"pending\" className=\"space-y-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Pending Flights</CardTitle>\n                <CardDescription>Flights awaiting instructor approval.</CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-2\">\n                {entries.filter((e) => e.isPending).length === 0 && (\n                  <p className=\"text-sm text-muted-foreground\">No pending flights.</p>\n                )}\n                {entries.filter((e) => e.isPending).map((entry) => (\n                  <div key={entry.id} className=\"rounded-md border border-border p-3\">\n                    <p className=\"font-medium\">{entry.aircraft} Â· {entry.routeFrom} â†’ {entry.routeTo}</p>\n                    <p className=\"text-xs text-muted-foreground\">{new Date(entry.date).toLocaleDateString()}</p>\n                  </div>\n                ))}\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"preferences\" className=\"space-y-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Flight Entry & Display</CardTitle>\n                <CardDescription>Time formats, timezone, and table visibility.</CardDescription>\n              </CardHeader>\n              <CardContent className=\"grid gap-4 md:grid-cols-2\">\n                <div>\n                  <label className=\"text-xs text-muted-foreground\">Time display format</label>\n                  <select\n                    className=\"mt-1 h-9 w-full rounded-md border border-input bg-background px-3 text-sm\"\n                    value={preferences.timeDisplayFormat}\n                    onChange={(e) => savePreferences({ ...preferences, timeDisplayFormat: e.target.value })}\n                  >\n                    <option value=\"decimal-1-2\">Decimal (1 or 2 digits)</option>\n                    <option value=\"decimal-1\">Decimal (1 digit)</option>\n                    <option value=\"decimal-2\">Decimal (2 digits)</option>\n                    <option value=\"hhmm\">HH:MM</option>\n                  </select>\n                </div>\n                <div>\n                  <label className=\"text-xs text-muted-foreground\">Summation mode</label>\n                  <select\n                    className=\"mt-1 h-9 w-full rounded-md border border-input bg-background px-3 text-sm\"\n                    value={preferences.sumTimeMode}\n                    onChange={(e) => savePreferences({ ...preferences, sumTimeMode: e.target.value })}\n                  >\n                    <option value=\"whole-minutes\">Whole minutes</option>\n                    <option value=\"hundredths\">Hundredths of an hour</option>\n                  </select>\n                </div>\n                <div>\n                  <label className=\"text-xs text-muted-foreground\">Preferred timezone</label>\n                  <select\n                    className=\"mt-1 h-9 w-full rounded-md border border-input bg-background px-3 text-sm\"\n                    value={preferences.preferredTimeZone}\n                    onChange={(e) => savePreferences({ ...preferences, preferredTimeZone: e.target.value })}\n                  >\n                    <option value=\"UTC\">UTC</option>\n                    <option value=\"local\">Local</option>\n                  </select>\n                </div>\n                <div>\n                  <label className=\"text-xs text-muted-foreground\">Date interpretation</label>\n                  <select\n                    className=\"mt-1 h-9 w-full rounded-md border border-input bg-background px-3 text-sm\"\n                    value={preferences.dateInterpretation}\n                    onChange={(e) => savePreferences({ ...preferences, dateInterpretation: e.target.value })}\n                  >\n                    <option value=\"local\">Local date at departure</option>\n                    <option value=\"utc\">UTC date at departure</option>\n                  </select>\n                </div>\n                <label className=\"flex items-center gap-2 text-sm\">\n                  <input\n                    type=\"checkbox\"\n                    checked={preferences.showInstructorTime}\n                    onChange={(e) => savePreferences({ ...preferences, showInstructorTime: e.target.checked })}\n                  />\n                  Show Instructor time in tables\n                </label>\n                <label className=\"flex items-center gap-2 text-sm\">\n                  <input\n                    type=\"checkbox\"\n                    checked={preferences.showSicTime}\n                    onChange={(e) => savePreferences({ ...preferences, showSicTime: e.target.checked })}\n                  />\n                  Show SIC time in tables\n                </label>\n                <label className=\"flex items-center gap-2 text-sm\">\n                  <input\n                    type=\"checkbox\"\n                    checked={preferences.showHobbsTach}\n                    onChange={(e) => savePreferences({ ...preferences, showHobbsTach: e.target.checked })}\n                  />\n                  Show Hobbs/Tach fields\n                </label>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle>Autofill & Night Rules</CardTitle>\n                <CardDescription>Automatic entry rules and night calculations.</CardDescription>\n              </CardHeader>\n              <CardContent className=\"grid gap-4 md:grid-cols-2\">\n                <label className=\"flex items-center gap-2 text-sm\">\n                  <input\n                    type=\"checkbox\"\n                    checked={preferences.autoFillTimes}\n                    onChange={(e) => savePreferences({ ...preferences, autoFillTimes: e.target.checked })}\n                  />\n                  Auto-fill time fields\n                </label>\n                <label className=\"flex items-center gap-2 text-sm\">\n                  <input\n                    type=\"checkbox\"\n                    checked={preferences.autoFillLandings}\n                    onChange={(e) => savePreferences({ ...preferences, autoFillLandings: e.target.checked })}\n                  />\n                  Auto-fill landings\n                </label>\n                <label className=\"flex items-center gap-2 text-sm\">\n                  <input\n                    type=\"checkbox\"\n                    checked={preferences.includeHeliports}\n                    onChange={(e) => savePreferences({ ...preferences, includeHeliports: e.target.checked })}\n                  />\n                  Include heliports\n                </label>\n                <label className=\"flex items-center gap-2 text-sm\">\n                  <input\n                    type=\"checkbox\"\n                    checked={preferences.estimateNight}\n                    onChange={(e) => savePreferences({ ...preferences, estimateNight: e.target.checked })}\n                  />\n                  Estimate night time\n                </label>\n                <label className=\"flex items-center gap-2 text-sm\">\n                  <input\n                    type=\"checkbox\"\n                    checked={preferences.roundNearestTenth}\n                    onChange={(e) => savePreferences({ ...preferences, roundNearestTenth: e.target.checked })}\n                  />\n                  Round to nearest tenth\n                </label>\n                <div>\n                  <label className=\"text-xs text-muted-foreground\">Night starts</label>\n                  <select\n                    className=\"mt-1 h-9 w-full rounded-md border border-input bg-background px-3 text-sm\"\n                    value={preferences.nightStartRule}\n                    onChange={(e) => savePreferences({ ...preferences, nightStartRule: e.target.value })}\n                  >\n                    <option value=\"civil-twilight\">End of civil twilight</option>\n                    <option value=\"sunset-plus-30\">30 min after sunset</option>\n                    <option value=\"sunset-plus-60\">1 hour after sunset</option>\n                  </select>\n                </div>\n                <div>\n                  <label className=\"text-xs text-muted-foreground\">Night landings occur</label>\n                  <select\n                    className=\"mt-1 h-9 w-full rounded-md border border-input bg-background px-3 text-sm\"\n                    value={preferences.nightLandingRule}\n                    onChange={(e) => savePreferences({ ...preferences, nightLandingRule: e.target.value })}\n                  >\n                    <option value=\"sunset-plus-60\">1 hour after sunset</option>\n                    <option value=\"civil-twilight\">End of civil twilight</option>\n                  </select>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle>Totals & Currency</CardTitle>\n                <CardDescription>Grouping and currency rule sets.</CardDescription>\n              </CardHeader>\n              <CardContent className=\"grid gap-4 md:grid-cols-2\">\n                <label className=\"flex items-center gap-2 text-sm\">\n                  <input type=\"checkbox\" checked={preferences.totalsByCategoryClass} onChange={(e) => savePreferences({ ...preferences, totalsByCategoryClass: e.target.checked })} />\n                  Totals by category/class\n                </label>\n                <label className=\"flex items-center gap-2 text-sm\">\n                  <input type=\"checkbox\" checked={preferences.totalsByModel} onChange={(e) => savePreferences({ ...preferences, totalsByModel: e.target.checked })} />\n                  Totals by model\n                </label>\n                <label className=\"flex items-center gap-2 text-sm\">\n                  <input type=\"checkbox\" checked={preferences.totalsByModelFamily} onChange={(e) => savePreferences({ ...preferences, totalsByModelFamily: e.target.checked })} />\n                  Totals by model family\n                </label>\n                <label className=\"flex items-center gap-2 text-sm\">\n                  <input type=\"checkbox\" checked={preferences.totalsByFeatures} onChange={(e) => savePreferences({ ...preferences, totalsByFeatures: e.target.checked })} />\n                  Include feature subtotals\n                </label>\n                <label className=\"flex items-center gap-2 text-sm\">\n                  <input type=\"checkbox\" checked={preferences.currencyByCategory} onChange={(e) => savePreferences({ ...preferences, currencyByCategory: e.target.checked })} />\n                  Currency by category/class\n                </label>\n                <label className=\"flex items-center gap-2 text-sm\">\n                  <input type=\"checkbox\" checked={preferences.currencyByModel} onChange={(e) => savePreferences({ ...preferences, currencyByModel: e.target.checked })} />\n                  Currency by model\n                </label>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle>Notifications</CardTitle>\n                <CardDescription>Currency and totals summaries.</CardDescription>\n              </CardHeader>\n              <CardContent className=\"grid gap-4 md:grid-cols-2\">\n                <label className=\"flex items-center gap-2 text-sm\">\n                  <input type=\"checkbox\" checked={preferences.notifyCurrencyWeekly} onChange={(e) => savePreferences({ ...preferences, notifyCurrencyWeekly: e.target.checked })} />\n                  Weekly currency summary\n                </label>\n                <label className=\"flex items-center gap-2 text-sm\">\n                  <input type=\"checkbox\" checked={preferences.notifyCurrencyOnExpiry} onChange={(e) => savePreferences({ ...preferences, notifyCurrencyOnExpiry: e.target.checked })} />\n                  Notify when currency expires\n                </label>\n                <label className=\"flex items-center gap-2 text-sm\">\n                  <input type=\"checkbox\" checked={preferences.notifyTotalsWeekly} onChange={(e) => savePreferences({ ...preferences, notifyTotalsWeekly: e.target.checked })} />\n                  Weekly totals\n                </label>\n                <label className=\"flex items-center gap-2 text-sm\">\n                  <input type=\"checkbox\" checked={preferences.notifyTotalsMonthly} onChange={(e) => savePreferences({ ...preferences, notifyTotalsMonthly: e.target.checked })} />\n                  Monthly totals\n                </label>\n              </CardContent>\n            </Card>\n          </TabsContent>\n      </Tabs>\n\n      <Dialog open={openDialog === 'add'} onOpenChange={(open) => setOpenDialog(open ? 'add' : null)}>\n        <DialogContent className=\"sm:max-w-3xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>Add Flight</DialogTitle>\n            <DialogDescription>Log a new flight with FAA/EASA fields.</DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-6\">\n            {error && <p className=\"text-sm text-destructive\">{error}</p>}\n\n            <div>\n              <p className=\"text-xs font-semibold uppercase tracking-wider text-muted-foreground\">General</p>\n              <div className=\"mt-3 grid gap-4 md:grid-cols-2\">\n                <Input type=\"date\" value={formData.date} className={fieldErrors.date ? 'border-destructive' : ''} onChange={(e) => setFormData({ ...formData, date: e.target.value })} />\n                <Input placeholder=\"Aircraft / Device\" value={formData.aircraft} onChange={(e) => setFormData({ ...formData, aircraft: e.target.value })} />\n                <label className=\"flex items-center gap-2 text-sm md:col-span-2\">\n                  <input type=\"checkbox\" checked={formData.isSimulator} onChange={(e) => setFormData({ ...formData, isSimulator: e.target.checked })} />\n                  Simulator / Flight Training Device session\n                </label>\n                {!formData.isSimulator && (\n                  <>\n                    <Input placeholder=\"From\" value={formData.routeFrom} className={fieldErrors.routeFrom ? 'border-destructive' : ''} onChange={(e) => setFormData({ ...formData, routeFrom: e.target.value })} />\n                    <Input placeholder=\"To\" value={formData.routeTo} className={fieldErrors.routeTo ? 'border-destructive' : ''} onChange={(e) => setFormData({ ...formData, routeTo: e.target.value })} />\n                  </>\n                )}\n                {formData.isSimulator && (\n                  <>\n                    <Input placeholder=\"Training Device ID\" value={formData.trainingDeviceId} className={fieldErrors.trainingDeviceId ? 'border-destructive' : ''} onChange={(e) => setFormData({ ...formData, trainingDeviceId: e.target.value })} />\n                    <Input placeholder=\"Training Location\" value={formData.trainingDeviceLocation} className={fieldErrors.trainingDeviceLocation ? 'border-destructive' : ''} onChange={(e) => setFormData({ ...formData, trainingDeviceLocation: e.target.value })} />\n                  </>\n                )}\n              </div>\n            </div>\n\n            <div>\n              <p className=\"text-xs font-semibold uppercase tracking-wider text-muted-foreground\">Experience & Training</p>\n              <div className=\"mt-3 grid gap-4 md:grid-cols-2\">\n                <Input placeholder=\"Total Time\" value={formData.totalTime} className={fieldErrors.totalTime ? 'border-destructive' : ''} onChange={(e) => setFormData({ ...formData, totalTime: e.target.value })} />\n                <Input placeholder=\"PIC\" value={formData.picTime} onChange={(e) => setFormData({ ...formData, picTime: e.target.value })} />\n                <Input placeholder=\"SIC\" value={formData.sicTime} onChange={(e) => setFormData({ ...formData, sicTime: e.target.value })} />\n                <Input placeholder=\"Solo\" value={formData.soloTime} onChange={(e) => setFormData({ ...formData, soloTime: e.target.value })} />\n                <Input placeholder=\"Dual Received\" value={formData.dualReceived} onChange={(e) => setFormData({ ...formData, dualReceived: e.target.value })} />\n                <Input placeholder=\"Ground Training\" value={formData.groundTrainingReceived} onChange={(e) => setFormData({ ...formData, groundTrainingReceived: e.target.value })} />\n                <Input placeholder=\"Sim Training\" value={formData.simTrainingReceived} onChange={(e) => setFormData({ ...formData, simTrainingReceived: e.target.value })} />\n              </div>\n            </div>\n\n            <div>\n              <p className=\"text-xs font-semibold uppercase tracking-wider text-muted-foreground\">Conditions & Landings</p>\n              <div className=\"mt-3 grid gap-4 md:grid-cols-2\">\n                <Input placeholder=\"Night\" value={formData.nightTime} onChange={(e) => setFormData({ ...formData, nightTime: e.target.value })} />\n                <Input placeholder=\"Instrument\" value={formData.instrumentTime} onChange={(e) => setFormData({ ...formData, instrumentTime: e.target.value })} />\n                <Input placeholder=\"Actual Instrument\" value={formData.actualInstrumentTime} className={fieldErrors.instrumentBreakdown ? 'border-destructive' : ''} onChange={(e) => setFormData({ ...formData, actualInstrumentTime: e.target.value })} />\n                <Input placeholder=\"Simulated Instrument\" value={formData.simulatedInstrumentTime} className={fieldErrors.instrumentBreakdown ? 'border-destructive' : ''} onChange={(e) => setFormData({ ...formData, simulatedInstrumentTime: e.target.value })} />\n                <Input placeholder=\"Cross Country\" value={formData.crossCountryTime} onChange={(e) => setFormData({ ...formData, crossCountryTime: e.target.value })} />\n                <Input placeholder=\"Day Landings\" value={formData.dayLandings} onChange={(e) => setFormData({ ...formData, dayLandings: e.target.value })} />\n                <Input placeholder=\"Night Landings\" value={formData.nightLandings} onChange={(e) => setFormData({ ...formData, nightLandings: e.target.value })} />\n                <label className=\"flex items-center gap-2 text-sm\">\n                  <input type=\"checkbox\" checked={formData.isDay} onChange={(e) => setFormData({ ...formData, isDay: e.target.checked })} />\n                  Day\n                </label>\n                <label className=\"flex items-center gap-2 text-sm\">\n                  <input type=\"checkbox\" checked={formData.isNight} onChange={(e) => setFormData({ ...formData, isNight: e.target.checked })} />\n                  Night\n                </label>\n              </div>\n            </div>\n\n            <div>\n              <p className=\"text-xs font-semibold uppercase tracking-wider text-muted-foreground\">Safety Pilot</p>\n              <div className=\"mt-3 grid gap-4 md:grid-cols-2\">\n                <label className=\"flex items-center gap-2 text-sm md:col-span-2\">\n                  <input type=\"checkbox\" checked={formData.requiresSafetyPilot} onChange={(e) => setFormData({ ...formData, requiresSafetyPilot: e.target.checked })} />\n                  Safety pilot required\n                </label>\n                {formData.requiresSafetyPilot && (\n                  <Input placeholder=\"Safety Pilot Name\" value={formData.safetyPilotName} className={fieldErrors.safetyPilotName ? 'border-destructive' : ''} onChange={(e) => setFormData({ ...formData, safetyPilotName: e.target.value })} />\n                )}\n              </div>\n            </div>\n\n            <div>\n              <p className=\"text-xs font-semibold uppercase tracking-wider text-muted-foreground\">Notes</p>\n              <div className=\"mt-3 grid gap-4\">\n                <Textarea placeholder=\"Remarks\" value={formData.remarks} onChange={(e) => setFormData({ ...formData, remarks: e.target.value })} />\n                <label className=\"flex items-center gap-2 text-sm\">\n                  <input type=\"checkbox\" checked={formData.isPending} onChange={(e) => setFormData({ ...formData, isPending: e.target.checked })} />\n                  Mark as pending (instructor approval)\n                </label>\n              </div>\n            </div>\n\n            <Button onClick={async () => {\n              await submitEntry()\n              setOpenDialog(null)\n            }} disabled={loading || isSaveDisabled()} className=\"w-full\">\n              <Plus className=\"mr-2 h-4 w-4\" /> Save Flight\n            </Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={openDialog === 'import'} onOpenChange={(open) => setOpenDialog(open ? 'import' : null)}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Start Import</DialogTitle>\n            <DialogDescription>Upload CSV, MyFlightbook, ForeFlight, or Garmin exports.</DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-3\">\n            <select className=\"h-9 w-full rounded-md border border-input bg-background px-3 text-sm\" id=\"import-source\">\n              <option value=\"CSV\">CSV/Excel</option>\n              <option value=\"MYFLIGHTBOOK\">MyFlightbook</option>\n              <option value=\"FOREFLIGHT\">ForeFlight</option>\n              <option value=\"GARMIN\">Garmin</option>\n            </select>\n            <Input type=\"file\" />\n            <Button onClick={async () => {\n              const source = (document.getElementById('import-source') as HTMLSelectElement)?.value\n              await fetch('/api/logbook/imports', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({ source, summaryJson: '{}' }),\n              })\n              setOpenDialog(null)\n            }}>\n              <Upload className=\"mr-2 h-4 w-4\" />Start Import\n            </Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={openDialog === 'starting-totals'} onOpenChange={(open) => setOpenDialog(open ? 'starting-totals' : null)}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Starting Totals</DialogTitle>\n            <DialogDescription>Set your baseline totals.</DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-3\">\n            <Input placeholder=\"Total Time\" defaultValue={startingTotals?.totalTime ?? ''} onBlur={async (e) => {\n              await saveStartingTotals({\n                totalTime: parseFloat(e.target.value) || 0,\n                picTime: startingTotals?.picTime || 0,\n                sicTime: startingTotals?.sicTime || 0,\n                nightTime: startingTotals?.nightTime || 0,\n                instrumentTime: startingTotals?.instrumentTime || 0,\n                crossCountryTime: startingTotals?.crossCountryTime || 0,\n                landingsDay: startingTotals?.landingsDay || 0,\n                landingsNight: startingTotals?.landingsNight || 0,\n                asOfDate: startingTotals?.asOfDate || null,\n              })\n            }} />\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={openDialog === 'print'} onOpenChange={(open) => setOpenDialog(open ? 'print' : null)}>\n        <DialogContent className=\"sm:max-w-3xl\">\n          <DialogHeader>\n            <DialogTitle>Print Preview</DialogTitle>\n            <DialogDescription>FAA and EASA formatted print layouts.</DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-2\">\n            {filteredEntries.slice(0, 20).map((entry) => (\n              <div key={entry.id} className=\"border-b border-border py-2 text-sm\">\n                    {entry.date} Â· {entry.aircraft} Â· {entry.routeFrom} â†’ {entry.routeTo} Â· {formatHours(entry.totalTime)} hrs\n              </div>\n            ))}\n            <Button variant=\"outline\" onClick={() => window.print()}><FileText className=\"mr-2 h-4 w-4\" />Print</Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  )\n}\n\nexport default function LogbookPage() {\n  return (\n    <Suspense fallback={<div className=\"min-h-screen bg-background p-6\">Loadingâ€¦</div>}>\n      <LogbookContent />\n    </Suspense>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\login\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\marketplace\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Users' is defined but never used.","line":16,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":8,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Users"},"fix":{"range":[582,591],"text":""},"desc":"Remove unused variable \"Users\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'X' is defined but never used.","line":26,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":26,"endColumn":4,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"X"},"fix":{"range":[694,699],"text":""},"desc":"Remove unused variable \"X\"."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":419,"column":74,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[19585,19694],"text":"\n                    Try adjusting your search or filters to find what you&apos;re looking for.\n                  "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[19585,19694],"text":"\n                    Try adjusting your search or filters to find what you&lsquo;re looking for.\n                  "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[19585,19694],"text":"\n                    Try adjusting your search or filters to find what you&#39;re looking for.\n                  "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[19585,19694],"text":"\n                    Try adjusting your search or filters to find what you&rsquo;re looking for.\n                  "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState } from \"react\"\nimport { useRouter } from \"next/navigation\"\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\"\nimport { Badge } from \"@/components/ui/badge\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Label } from \"@/components/ui/label\"\nimport { Slider } from \"@/components/ui/slider\"\nimport { Sheet, SheetContent, SheetDescription, SheetHeader, SheetTitle, SheetTrigger } from \"@/components/ui/sheet\"\nimport { \n  Search,\n  Plane,\n  CheckCircle2,\n  Users,\n  TrendingUp,\n  Filter,\n  MapPin,\n  Calendar,\n  DollarSign,\n  Star,\n  Heart,\n  Share2,\n  ChevronRight,\n  X\n} from \"lucide-react\"\n\ntype ListingCategory = 'all' | 'for-sale' | 'full-sale' | 'selling-share' | 'looking-to-join'\n\nconst mockListings = [\n  { id: 1, title: \"Cessna 172S Skyhawk\", year: 2018, price: 385000, location: \"KBOS\", hours: 1250, category: 'for-sale', image: \"/placeholder.jpg\", verified: true, seller: \"Professional Aviation Inc.\", rating: 4.9 },\n  { id: 2, title: \"Piper PA-28 Cherokee\", year: 2015, price: 165000, location: \"KALB\", hours: 2100, category: 'for-sale', image: \"/placeholder.jpg\", verified: true, seller: \"Northeast Flying Club\", rating: 4.8 },\n  { id: 3, title: \"Cirrus SR22T\", year: 2020, price: 750000, location: \"KMVY\", hours: 450, category: 'full-sale', image: \"/placeholder.jpg\", verified: true, seller: \"Cirrus New England\", rating: 5.0 },\n  { id: 4, title: \"Beechcraft Bonanza G36\", year: 2019, price: 125000, location: \"KBOS\", hours: 890, category: 'selling-share', image: \"/placeholder.jpg\", verified: true, seller: \"Boston Bonanza Partnership\", rating: 4.7 },\n  { id: 5, title: \"Diamond DA40 NG\", year: 2021, price: 485000, location: \"KBED\", hours: 320, category: 'for-sale', image: \"/placeholder.jpg\", verified: true, seller: \"Diamond Flight Center\", rating: 4.9 },\n  { id: 6, title: \"Looking for 1/4 Share Partnership\", year: 0, price: 0, location: \"KBOS\", hours: 0, category: 'looking-to-join', image: \"/placeholder.jpg\", verified: false, seller: \"John Smith\", rating: 0 },\n]\n\nexport default function MarketplacePage() {\n  const router = useRouter()\n  const [searchQuery, setSearchQuery] = useState('')\n  const [activeCategory, setActiveCategory] = useState<ListingCategory>('all')\n  const [savedListings, setSavedListings] = useState<number[]>([])\n  \n  // Filter states\n  const [filtersOpen, setFiltersOpen] = useState(false)\n  const [priceRange, setPriceRange] = useState<[number, number]>([0, 1000000])\n  const [yearRange, setYearRange] = useState<[number, number]>([1950, 2024])\n  const [hoursRange, setHoursRange] = useState<[number, number]>([0, 10000])\n  const [locationFilter, setLocationFilter] = useState('')\n  const [verifiedOnly, setVerifiedOnly] = useState(false)\n\n  const categories = [\n    { id: 'all' as const, label: 'All Listings', count: 2400 },\n    { id: 'for-sale' as const, label: 'Aircraft For Sale', count: 1850 },\n    { id: 'full-sale' as const, label: 'Full Sale', count: 1200 },\n    { id: 'selling-share' as const, label: 'Selling Share', count: 380 },\n    { id: 'looking-to-join' as const, label: 'Looking to Join', count: 170 },\n  ]\n\n  const filteredListings = mockListings.filter(listing => {\n    const matchesCategory = activeCategory === 'all' || listing.category === activeCategory\n    const matchesSearch = listing.title.toLowerCase().includes(searchQuery.toLowerCase()) ||\n                          listing.location.toLowerCase().includes(searchQuery.toLowerCase())\n    \n    // Advanced filters (skip for 'looking-to-join' category which has 0 values)\n    if (listing.category !== 'looking-to-join') {\n      const matchesPrice = listing.price >= priceRange[0] && listing.price <= priceRange[1]\n      const matchesYear = listing.year >= yearRange[0] && listing.year <= yearRange[1]\n      const matchesHours = listing.hours >= hoursRange[0] && listing.hours <= hoursRange[1]\n      const matchesLocation = !locationFilter || listing.location.toLowerCase().includes(locationFilter.toLowerCase())\n      const matchesVerified = !verifiedOnly || listing.verified\n      \n      return matchesCategory && matchesSearch && matchesPrice && matchesYear && matchesHours && matchesLocation && matchesVerified\n    }\n    \n    return matchesCategory && matchesSearch\n  })\n  \n  const clearFilters = () => {\n    setPriceRange([0, 1000000])\n    setYearRange([1950, 2024])\n    setHoursRange([0, 10000])\n    setLocationFilter('')\n    setVerifiedOnly(false)\n    setSearchQuery('')\n    setActiveCategory('all')\n  }\n  \n  const handleShare = async (listing: typeof mockListings[0]) => {\n    const url = `${window.location.origin}/modules/marketplace/listing/${listing.id}`\n    try {\n      await navigator.clipboard.writeText(url)\n      // Could add a toast notification here\n      alert('Listing URL copied to clipboard!')\n    } catch (err) {\n      console.error('Failed to copy:', err)\n    }\n  }\n\n  const toggleSave = (id: number) => {\n    setSavedListings(prev => \n      prev.includes(id) ? prev.filter(listingId => listingId !== id) : [...prev, id]\n    )\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n\n      {/* Main Content */}\n      <main>\n        {/* Hero Section */}\n        <div className=\"border-b border-border bg-gradient-to-b from-card to-background\">\n          <div className=\"mx-auto max-w-7xl px-6 py-12\">\n            <div className=\"flex flex-col gap-4\">\n              <h1 className=\"text-4xl font-bold tracking-tight text-balance\">\n                Find Your Perfect Aircraft\n              </h1>\n              <p className=\"text-lg text-muted-foreground text-balance max-w-2xl\">\n                Browse verified listings from trusted dealers and owners. Verified aircraft, secure transactions.\n              </p>\n              \n              {/* Search Bar */}\n              <div className=\"mt-4 flex gap-3 max-w-2xl\">\n                <div className=\"relative flex-1\">\n                  <Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground\" />\n                  <Input\n                    type=\"search\"\n                    placeholder=\"Search by aircraft model, location, or registration...\"\n                    value={searchQuery}\n                    onChange={(e) => setSearchQuery(e.target.value)}\n                    className=\"h-11 pl-9 pr-4\"\n                  />\n                </div>\n                <Sheet open={filtersOpen} onOpenChange={setFiltersOpen}>\n                  <SheetTrigger asChild>\n                    <Button size=\"lg\" className=\"gap-2\">\n                      <Filter className=\"h-4 w-4\" />\n                      Filters\n                    </Button>\n                  </SheetTrigger>\n                  <SheetContent className=\"w-[400px] overflow-y-auto\">\n                    <SheetHeader>\n                      <SheetTitle>Filter Listings</SheetTitle>\n                      <SheetDescription>\n                        Refine your search with advanced filters\n                      </SheetDescription>\n                    </SheetHeader>\n                    \n                    <div className=\"mt-6 space-y-6\">\n                      {/* Price Range */}\n                      <div className=\"space-y-3\">\n                        <Label>Price Range</Label>\n                        <div className=\"flex items-center gap-3 text-sm text-muted-foreground\">\n                          <span>${(priceRange[0] / 1000).toFixed(0)}K</span>\n                          <span className=\"mx-auto\">â€”</span>\n                          <span>${(priceRange[1] / 1000).toFixed(0)}K</span>\n                        </div>\n                        <Slider\n                          min={0}\n                          max={1000000}\n                          step={10000}\n                          value={priceRange}\n                          onValueChange={(value) => setPriceRange(value as [number, number])}\n                          className=\"w-full\"\n                        />\n                      </div>\n                      \n                      {/* Year Range */}\n                      <div className=\"space-y-3\">\n                        <Label>Year Built</Label>\n                        <div className=\"flex items-center gap-3 text-sm text-muted-foreground\">\n                          <span>{yearRange[0]}</span>\n                          <span className=\"mx-auto\">â€”</span>\n                          <span>{yearRange[1]}</span>\n                        </div>\n                        <Slider\n                          min={1950}\n                          max={2024}\n                          step={1}\n                          value={yearRange}\n                          onValueChange={(value) => setYearRange(value as [number, number])}\n                          className=\"w-full\"\n                        />\n                      </div>\n                      \n                      {/* Hours Range */}\n                      <div className=\"space-y-3\">\n                        <Label>Total Hours</Label>\n                        <div className=\"flex items-center gap-3 text-sm text-muted-foreground\">\n                          <span>{hoursRange[0].toLocaleString()}</span>\n                          <span className=\"mx-auto\">â€”</span>\n                          <span>{hoursRange[1].toLocaleString()}</span>\n                        </div>\n                        <Slider\n                          min={0}\n                          max={10000}\n                          step={100}\n                          value={hoursRange}\n                          onValueChange={(value) => setHoursRange(value as [number, number])}\n                          className=\"w-full\"\n                        />\n                      </div>\n                      \n                      {/* Location */}\n                      <div className=\"space-y-3\">\n                        <Label>Location (ICAO/IATA)</Label>\n                        <Input\n                          placeholder=\"e.g. KBOS, BOS\"\n                          value={locationFilter}\n                          onChange={(e) => setLocationFilter(e.target.value)}\n                        />\n                      </div>\n                      \n                      {/* Verified Only */}\n                      <div className=\"flex items-center justify-between\">\n                        <Label>Verified Listings Only</Label>\n                        <Button\n                          variant={verifiedOnly ? \"default\" : \"outline\"}\n                          size=\"sm\"\n                          onClick={() => setVerifiedOnly(!verifiedOnly)}\n                        >\n                          {verifiedOnly ? 'On' : 'Off'}\n                        </Button>\n                      </div>\n                      \n                      {/* Actions */}\n                      <div className=\"flex gap-3 pt-4 border-t\">\n                        <Button\n                          variant=\"outline\"\n                          className=\"flex-1\"\n                          onClick={clearFilters}\n                        >\n                          Clear All\n                        </Button>\n                        <Button\n                          className=\"flex-1\"\n                          onClick={() => setFiltersOpen(false)}\n                        >\n                          Apply Filters\n                        </Button>\n                      </div>\n                    </div>\n                  </SheetContent>\n                </Sheet>\n              </div>\n\n              {/* Stats */}\n              <div className=\"mt-6 grid grid-cols-3 gap-6 max-w-2xl\">\n                <div>\n                  <div className=\"text-3xl font-bold text-foreground\">2,400+</div>\n                  <div className=\"text-sm text-muted-foreground\">Verified Listings</div>\n                </div>\n                <div>\n                  <div className=\"text-3xl font-bold text-foreground\">98%</div>\n                  <div className=\"text-sm text-muted-foreground\">Satisfaction Rate</div>\n                </div>\n                <div>\n                  <div className=\"text-3xl font-bold text-foreground\">15K+</div>\n                  <div className=\"text-sm text-muted-foreground\">Active Buyers</div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Category Navigation - More Prominent */}\n        <div className=\"sticky top-[44px] z-40 border-b border-border bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/80\">\n          <div className=\"mx-auto max-w-7xl px-6\">\n            <nav className=\"flex gap-1 overflow-x-auto py-2\">\n              {categories.map((category) => (\n                <Button\n                  key={category.id}\n                  variant={activeCategory === category.id ? \"default\" : \"ghost\"}\n                  size=\"sm\"\n                  onClick={() => setActiveCategory(category.id)}\n                  className=\"shrink-0 gap-2\"\n                >\n                  {category.label}\n                  <Badge variant=\"secondary\" className=\"ml-1 text-xs\">\n                    {category.count}\n                  </Badge>\n                </Button>\n              ))}\n            </nav>\n          </div>\n        </div>\n\n        {/* Listings Grid */}\n        <div className=\"mx-auto max-w-7xl px-6 py-8\">\n          <div className=\"grid gap-6 md:grid-cols-2 lg:grid-cols-3\">\n            {filteredListings.map((listing) => (\n              <Card key={listing.id} className=\"group overflow-hidden transition-all hover:shadow-lg\">\n                <div className=\"relative aspect-video bg-muted\">\n                  <div className=\"absolute inset-0 flex items-center justify-center\">\n                    <Plane className=\"h-16 w-16 text-muted-foreground/20\" />\n                  </div>\n                  {listing.verified && (\n                    <Badge className=\"absolute left-3 top-3 gap-1 bg-primary\">\n                      <CheckCircle2 className=\"h-3 w-3\" />\n                      Verified\n                    </Badge>\n                  )}\n                  <div className=\"absolute right-3 top-3 flex gap-2\">\n                    <Button\n                      size=\"icon\"\n                      variant=\"secondary\"\n                      className=\"h-8 w-8 rounded-full\"\n                      onClick={() => toggleSave(listing.id)}\n                    >\n                      <Heart className={`h-4 w-4 ${savedListings.includes(listing.id) ? 'fill-current text-destructive' : ''}`} />\n                    </Button>\n                    <Button\n                      size=\"icon\"\n                      variant=\"secondary\"\n                      className=\"h-8 w-8 rounded-full\"\n                      onClick={() => handleShare(listing)}\n                    >\n                      <Share2 className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </div>\n\n                <CardHeader className=\"pb-3\">\n                  <div className=\"flex items-start justify-between gap-2\">\n                    <div className=\"flex-1\">\n                      <CardTitle className=\"text-lg leading-tight group-hover:text-primary transition-colors\">\n                        {listing.title}\n                      </CardTitle>\n                      <CardDescription className=\"mt-1 text-xs\">\n                        {listing.seller}\n                      </CardDescription>\n                    </div>\n                    {listing.rating > 0 && (\n                      <div className=\"flex items-center gap-1 text-xs\">\n                        <Star className=\"h-3 w-3 fill-current text-yellow-500\" />\n                        <span className=\"font-medium\">{listing.rating}</span>\n                      </div>\n                    )}\n                  </div>\n                </CardHeader>\n\n                <CardContent className=\"space-y-4\">\n                  {listing.category !== 'looking-to-join' ? (\n                    <>\n                      <div className=\"grid grid-cols-2 gap-3 text-sm\">\n                        <div className=\"space-y-1\">\n                          <div className=\"flex items-center gap-1.5 text-muted-foreground\">\n                            <Calendar className=\"h-3.5 w-3.5\" />\n                            <span className=\"text-xs\">Year</span>\n                          </div>\n                          <div className=\"font-semibold\">{listing.year}</div>\n                        </div>\n                        <div className=\"space-y-1\">\n                          <div className=\"flex items-center gap-1.5 text-muted-foreground\">\n                            <TrendingUp className=\"h-3.5 w-3.5\" />\n                            <span className=\"text-xs\">Hours</span>\n                          </div>\n                          <div className=\"font-semibold\">{listing.hours.toLocaleString()}</div>\n                        </div>\n                        <div className=\"space-y-1\">\n                          <div className=\"flex items-center gap-1.5 text-muted-foreground\">\n                            <MapPin className=\"h-3.5 w-3.5\" />\n                            <span className=\"text-xs\">Location</span>\n                          </div>\n                          <div className=\"font-semibold\">{listing.location}</div>\n                        </div>\n                        <div className=\"space-y-1\">\n                          <div className=\"flex items-center gap-1.5 text-muted-foreground\">\n                            <DollarSign className=\"h-3.5 w-3.5\" />\n                            <span className=\"text-xs\">Price</span>\n                          </div>\n                          <div className=\"font-semibold\">${(listing.price / 1000).toFixed(0)}K</div>\n                        </div>\n                      </div>\n\n                      <Button \n                        className=\"w-full gap-2\" \n                        variant=\"default\"\n                        onClick={() => router.push(`/modules/marketplace/listing/${listing.id}`)}\n                      >\n                        View Details\n                        <ChevronRight className=\"h-4 w-4\" />\n                      </Button>\n                    </>\n                  ) : (\n                    <>\n                      <div className=\"rounded-lg bg-muted/50 p-3\">\n                        <p className=\"text-sm text-muted-foreground\">\n                          Pilot seeking partnership or share in {listing.location} area. \n                          Looking for reliable partnership with established group.\n                        </p>\n                      </div>\n                      <Button \n                        className=\"w-full gap-2\" \n                        variant=\"outline\"\n                        onClick={() => router.push(`/messages?listing=${listing.id}`)}\n                      >\n                        Contact\n                        <ChevronRight className=\"h-4 w-4\" />\n                      </Button>\n                    </>\n                  )}\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n\n          {filteredListings.length === 0 && (\n            <Card className=\"p-12\">\n              <div className=\"flex flex-col items-center justify-center gap-4 text-center\">\n                <div className=\"rounded-full bg-muted p-6\">\n                  <Search className=\"h-8 w-8 text-muted-foreground\" />\n                </div>\n                <div>\n                  <h3 className=\"text-lg font-semibold\">No listings found</h3>\n                  <p className=\"text-sm text-muted-foreground mt-1\">\n                    Try adjusting your search or filters to find what you're looking for.\n                  </p>\n                </div>\n                <Button onClick={() => { setSearchQuery(''); setActiveCategory('all') }}>\n                  Clear Filters\n                </Button>\n              </div>\n            </Card>\n          )}\n        </div>\n      </main>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\mechanics\\demo\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\mechanics\\inbox\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\mechanics\\login\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\mechanics\\marketplace\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":160,"column":89,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":160,"endColumn":92,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6294,6297],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6294,6297],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":360,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":360,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14854,14857],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14854,14857],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useEffect, useMemo, useState } from \"react\"\nimport { useSession } from \"next-auth/react\"\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\"\nimport { Badge } from \"@/components/ui/badge\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Textarea } from \"@/components/ui/textarea\"\nimport { Separator } from \"@/components/ui/separator\"\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\"\nimport {\n  Search,\n  MapPin,\n  Star,\n  CheckCircle2,\n  Clock,\n  Wrench,\n  ChevronRight,\n  Filter,\n  Plus,\n  FileText,\n  AlertTriangle,\n  MessageSquare,\n  Plane,\n  ShieldCheck,\n  X,\n  Calendar,\n  DollarSign,\n} from \"lucide-react\"\nimport type { LucideIcon } from \"lucide-react\"\n\ntype View = \"browse\" | \"post-squawk\" | \"my-requests\"\n\ntype Mechanic = {\n  id: string\n  name: string\n  businessName?: string | null\n  city?: string | null\n  state?: string | null\n  locationIcao?: string | null\n  certifications?: string | null\n  rating?: number | null\n  reviewCount?: number | null\n  specialties?: string | null\n}\n\ntype Listing = {\n  id: string\n  title: string\n  description: string\n  category: string\n  jobSize?: string | null\n  neededBy?: string | null\n  aircraftType?: string | null\n  airportIcao?: string | null\n  city?: string | null\n  state?: string | null\n  status?: string\n}\n\ntype Quote = {\n  id: string\n  amount?: number | null\n  description: string\n  status: string\n  maintenanceRequest: { id: string; title: string }\n  mechanic: { name: string; businessName?: string | null; rating?: number | null }\n}\n\nconst URGENCY_CONFIG: Record<string, { label: string; className: string }> = {\n  urgent: { label: \"This Week\", className: \"bg-red-500/15 text-red-400 border-red-500/30\" },\n  flexible: { label: \"Flexible\", className: \"bg-emerald-500/15 text-emerald-400 border-emerald-500/30\" },\n}\n\nfunction MechanicCard({ mechanic, onSelect }: { mechanic: Mechanic; onSelect: (m: Mechanic) => void }) {\n  return (\n    <Card className=\"group transition-all hover:shadow-md hover:border-primary/40\">\n      <CardContent className=\"p-5\">\n        <div className=\"flex items-start justify-between gap-3\">\n          <div className=\"flex h-11 w-11 shrink-0 items-center justify-center rounded-full bg-primary/10 text-sm font-bold text-primary\">\n            {(mechanic.name || \"M\").split(\" \").map((n) => n[0]).join(\"\")}\n          </div>\n          <div className=\"flex-1 min-w-0\">\n            <div className=\"flex items-center gap-2 flex-wrap\">\n              <span className=\"font-semibold text-sm\">{mechanic.name}</span>\n              <div className=\"flex items-center gap-1 ml-auto\">\n                <span className=\"text-[11px] text-muted-foreground\">Verified</span>\n                <ShieldCheck className=\"h-3.5 w-3.5 text-primary shrink-0\" />\n              </div>\n            </div>\n            <p className=\"text-xs text-muted-foreground\">{mechanic.businessName || \"Independent\"}</p>\n            <div className=\"mt-1 flex items-center gap-3 text-xs text-muted-foreground\">\n              <span className=\"flex items-center gap-1\"><MapPin className=\"h-3 w-3\" />{[mechanic.city, mechanic.state, mechanic.locationIcao].filter(Boolean).join(\" â€¢ \")}</span>\n              <span className=\"flex items-center gap-1\"><Star className=\"h-3 w-3 fill-yellow-400 text-yellow-400\" />{mechanic.rating ?? 0} ({mechanic.reviewCount ?? 0})</span>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"mt-3 flex flex-wrap gap-1.5\">\n          {(mechanic.specialties || \"\").split(',').filter(Boolean).slice(0, 3).map((s) => (\n            <Badge key={s} variant=\"secondary\" className=\"text-[11px]\">{s.trim()}</Badge>\n          ))}\n        </div>\n\n        <Separator className=\"my-3\" />\n\n        <div className=\"flex items-center justify-between\">\n          <div className=\"text-xs text-muted-foreground\">\n            <span className=\"font-medium text-foreground\">{mechanic.certifications || \"A&P\"}</span>\n          </div>\n          <Button size=\"sm\" variant=\"outline\" className=\"h-7 gap-1.5 text-xs\" onClick={() => onSelect(mechanic)}>\n            View Profile <ChevronRight className=\"h-3.5 w-3.5\" />\n          </Button>\n        </div>\n      </CardContent>\n    </Card>\n  )\n}\n\nfunction SquawkCard({ squawk, onQuote }: { squawk: Listing; onQuote: (id: string) => void }) {\n  return (\n    <Card className=\"transition-all hover:shadow-md hover:border-primary/40\">\n      <CardContent className=\"p-5\">\n        <div className=\"flex items-start justify-between gap-3\">\n          <div className=\"flex-1 min-w-0\">\n            <div className=\"flex items-center gap-2 flex-wrap\">\n              <span className=\"font-semibold text-sm\">{squawk.title}</span>\n              {squawk.jobSize && (\n                <Badge variant=\"outline\" className=\"text-[11px] border\">{squawk.jobSize}</Badge>\n              )}\n            </div>\n            <p className=\"mt-0.5 text-xs text-muted-foreground flex items-center gap-1.5\">\n              <Plane className=\"h-3 w-3\" />{squawk.aircraftType || \"Aircraft\"}\n              <span className=\"mx-1\">Â·</span>\n              <MapPin className=\"h-3 w-3\" />{[squawk.city, squawk.state, squawk.airportIcao].filter(Boolean).join(\" â€¢ \") || \"Location hidden\"}\n              <span className=\"mx-1\">Â·</span>\n              <Clock className=\"h-3 w-3\" />{squawk.neededBy ? new Date(squawk.neededBy).toLocaleDateString() : \"Flexible\"}\n            </p>\n          </div>\n          <Badge variant=\"secondary\" className=\"shrink-0 text-xs\">{squawk.category}</Badge>\n        </div>\n\n        <p className=\"mt-3 text-xs text-muted-foreground leading-relaxed\">{squawk.description}</p>\n\n        <div className=\"mt-3 flex items-center justify-between\">\n          <div className=\"flex items-center gap-1 text-xs text-muted-foreground\">\n            <MessageSquare className=\"h-3.5 w-3.5\" />\n            <span>Status: {squawk.status || \"Open\"}</span>\n          </div>\n          <Button size=\"sm\" className=\"h-7 gap-1.5 text-xs\" onClick={() => onQuote(squawk.id)}>\n            Send Quote <ChevronRight className=\"h-3.5 w-3.5\" />\n          </Button>\n        </div>\n      </CardContent>\n    </Card>\n  )\n}\n\nfunction PostSquawkForm({ onBack, onSubmit }: { onBack: () => void; onSubmit: (payload: any) => void }) {\n  const [urgency, setUrgency] = useState<\"flexible\" | \"urgent\">(\"flexible\")\n  const [form, setForm] = useState({\n    aircraftModel: \"\",\n    airportIcao: \"\",\n    title: \"\",\n    description: \"\",\n    category: \"Other\",\n    neededBy: \"\",\n    jobSize: \"MEDIUM\",\n  })\n\n  return (\n    <div className=\"mx-auto max-w-2xl space-y-6\">\n      <div>\n        <h2 className=\"text-xl font-bold\">Post a Squawk</h2>\n        <p className=\"mt-1 text-sm text-muted-foreground\">Describe the issue on your aircraft and receive quotes from verified local mechanics.</p>\n      </div>\n\n      <Card>\n        <CardHeader className=\"pb-4\">\n          <CardTitle className=\"text-base flex items-center gap-2\"><Plane className=\"h-4 w-4 text-primary\" />Aircraft</CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div className=\"space-y-1.5\">\n              <label className=\"text-xs font-medium\">Aircraft Model</label>\n              <Input value={form.aircraftModel} onChange={(e) => setForm({ ...form, aircraftModel: e.target.value })} placeholder=\"e.g. Cessna 172S\" className=\"h-9 text-sm\" />\n            </div>\n            <div className=\"space-y-1.5\">\n              <label className=\"text-xs font-medium\">Airport (ICAO)</label>\n              <Input value={form.airportIcao} onChange={(e) => setForm({ ...form, airportIcao: e.target.value.toUpperCase() })} placeholder=\"e.g. KBOS\" className=\"h-9 text-sm\" />\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader className=\"pb-4\">\n          <CardTitle className=\"text-base flex items-center gap-2\"><Wrench className=\"h-4 w-4 text-primary\" />Squawk Details</CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"space-y-1.5\">\n            <label className=\"text-xs font-medium\">Title</label>\n            <Input value={form.title} onChange={(e) => setForm({ ...form, title: e.target.value })} placeholder=\"e.g. Mag drop on right magneto\" className=\"h-9 text-sm\" />\n          </div>\n          <div className=\"space-y-1.5\">\n            <label className=\"text-xs font-medium\">Description</label>\n            <textarea\n              rows={4}\n              value={form.description}\n              onChange={(e) => setForm({ ...form, description: e.target.value })}\n              placeholder=\"Describe the squawk in detail...\"\n              className=\"w-full rounded-md border border-input bg-background px-3 py-2 text-sm resize-none outline-none focus:ring-2 focus:ring-ring placeholder:text-muted-foreground\"\n            />\n          </div>\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div className=\"space-y-1.5\">\n              <label className=\"text-xs font-medium\">Category</label>\n              <select\n                value={form.category}\n                onChange={(e) => setForm({ ...form, category: e.target.value })}\n                className=\"h-9 w-full rounded-md border border-input bg-background px-3 text-sm outline-none focus:ring-2 focus:ring-ring\"\n              >\n                <option>Powerplant</option>\n                <option>Airframe</option>\n                <option>Avionics</option>\n                <option>Landing Gear</option>\n                <option>Electrical</option>\n                <option>Fuel System</option>\n                <option>Other</option>\n              </select>\n            </div>\n            <div className=\"space-y-1.5\">\n              <label className=\"text-xs font-medium\">Urgency</label>\n              <div className=\"flex gap-2\">\n                {([\"flexible\", \"urgent\"] as const).map((u) => (\n                  <button\n                    key={u}\n                    onClick={() => setUrgency(u)}\n                    className={`flex-1 rounded-md border py-1.5 text-xs font-medium capitalize transition-all ${\n                      urgency === u\n                        ? u === \"urgent\"\n                          ? \"border-red-500 bg-red-500/10 text-red-400\"\n                          : \"border-emerald-500 bg-emerald-500/10 text-emerald-400\"\n                        : \"border-border text-muted-foreground hover:border-primary/40\"\n                    }`}\n                  >\n                    {u === \"urgent\" ? \"This week\" : \"Flexible\"}\n                  </button>\n                ))}\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader className=\"pb-4\">\n          <CardTitle className=\"text-base flex items-center gap-2\"><DollarSign className=\"h-4 w-4 text-primary\" />Preferences</CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div className=\"space-y-1.5\">\n              <label className=\"text-xs font-medium\">Needed By</label>\n              <Input type=\"date\" value={form.neededBy} onChange={(e) => setForm({ ...form, neededBy: e.target.value })} className=\"h-9 text-sm\" />\n            </div>\n            <div className=\"space-y-1.5\">\n              <label className=\"text-xs font-medium\">Job Size</label>\n              <select\n                value={form.jobSize}\n                onChange={(e) => setForm({ ...form, jobSize: e.target.value })}\n                className=\"h-9 w-full rounded-md border border-input bg-background px-3 text-sm outline-none focus:ring-2 focus:ring-ring\"\n              >\n                <option value=\"SMALL\">Small</option>\n                <option value=\"MEDIUM\">Medium</option>\n                <option value=\"LARGE\">Large</option>\n              </select>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <div className=\"flex gap-3\">\n        <Button variant=\"outline\" onClick={onBack} className=\"gap-2\"><X className=\"h-4 w-4\" />Cancel</Button>\n        <Button className=\"flex-1 gap-2\" onClick={() => onSubmit({ ...form, urgency })}><FileText className=\"h-4 w-4\" />Post Squawk</Button>\n      </div>\n    </div>\n  )\n}\n\nexport default function MechanicMarketplacePage() {\n  const { data: session } = useSession()\n  const [view, setView] = useState<View>(\"browse\")\n  const [searchQuery, setSearchQuery] = useState(\"\")\n  const [selectedMechanic, setSelectedMechanic] = useState<Mechanic | null>(null)\n  const [mechanics, setMechanics] = useState<Mechanic[]>([])\n  const [openSquawks, setOpenSquawks] = useState<Listing[]>([])\n  const [myRequests, setMyRequests] = useState<Listing[]>([])\n  const [quotes, setQuotes] = useState<Quote[]>([])\n  const [quoteModalId, setQuoteModalId] = useState<string | null>(null)\n  const [quoteMessage, setQuoteMessage] = useState(\"\")\n  const [quoteAmount, setQuoteAmount] = useState(\"\")\n\n  useEffect(() => {\n    async function loadMechanics() {\n      const res = await fetch(`/api/mechanics/search?q=${encodeURIComponent(searchQuery)}`)\n      if (res.ok) {\n        const data = await res.json()\n        setMechanics(Array.isArray(data.mechanics) ? data.mechanics : [])\n      }\n    }\n    loadMechanics()\n  }, [searchQuery])\n\n  useEffect(() => {\n    async function loadSquawks() {\n      const res = await fetch('/api/mechanics/listings')\n      if (res.ok) {\n        const data = await res.json()\n        setOpenSquawks(Array.isArray(data.listings) ? data.listings : [])\n      }\n    }\n    loadSquawks()\n  }, [])\n\n  useEffect(() => {\n    if (!session?.user) return\n    async function loadMine() {\n      const res = await fetch('/api/mechanics/listings/mine')\n      if (res.ok) {\n        const data = await res.json()\n        setMyRequests(Array.isArray(data.listings) ? data.listings : [])\n      }\n\n      const quotesRes = await fetch('/api/mechanics/quotes')\n      if (quotesRes.ok) {\n        const data = await quotesRes.json()\n        setQuotes(Array.isArray(data.quotes) ? data.quotes : [])\n      }\n    }\n    loadMine()\n  }, [session?.user])\n\n  const filteredMechanics = useMemo(() => {\n    const q = searchQuery.toLowerCase()\n    return mechanics.filter(m =>\n      m.name.toLowerCase().includes(q) ||\n      (m.businessName || '').toLowerCase().includes(q) ||\n      (m.locationIcao || '').toLowerCase().includes(q) ||\n      (m.specialties || '').toLowerCase().includes(q)\n    )\n  }, [mechanics, searchQuery])\n\n  const VIEWS: { id: View; label: string; icon: LucideIcon }[] = [\n    { id: \"browse\", label: \"Browse Mechanics\", icon: Search },\n    { id: \"post-squawk\", label: \"Post a Squawk\", icon: Plus },\n    { id: \"my-requests\", label: \"My Requests\", icon: FileText },\n  ]\n\n  const handlePost = async (payload: any) => {\n    await fetch('/api/mechanics/listings', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        title: payload.title,\n        description: payload.description,\n        category: payload.category,\n        urgency: payload.urgency === 'urgent' ? 'HIGH' : 'NORMAL',\n        neededBy: payload.neededBy || null,\n        jobSize: payload.jobSize,\n        aircraftType: payload.aircraftModel,\n        airportIcao: payload.airportIcao,\n        source: 'manual',\n        anonymous: true,\n      }),\n    })\n    setView('my-requests')\n  }\n\n  const submitQuote = async () => {\n    if (!quoteModalId) return\n    await fetch(`/api/mechanics/listings/${quoteModalId}/respond`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        message: quoteMessage,\n        quoteAmount: quoteAmount ? Number(quoteAmount) : undefined,\n      }),\n    })\n    setQuoteModalId(null)\n    setQuoteMessage('')\n    setQuoteAmount('')\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <div className=\"border-b border-border bg-card\">\n        <div className=\"mx-auto max-w-7xl px-6 pt-6 pb-0\">\n          <div className=\"flex items-start justify-between gap-4\">\n            <div>\n              <h1 className=\"text-2xl font-bold tracking-tight flex items-center gap-2\">\n                <Wrench className=\"h-6 w-6 text-primary\" />\n                Mechanic Marketplace\n              </h1>\n              <p className=\"mt-1 text-sm text-muted-foreground\">\n                Connect with verified A&Ps. Post squawks, compare quotes, get flying again.\n              </p>\n            </div>\n            <div className=\"hidden sm:flex items-center gap-4 text-center\">\n              {[\n                { value: `${mechanics.length}+`, label: \"Verified A&Ps\" },\n                { value: \"98%\", label: \"Response Rate\" },\n                { value: \"4.8\", label: \"Avg Rating\" },\n              ].map(stat => (\n                <div key={stat.label} className=\"border-l border-border pl-4 first:border-0 first:pl-0\">\n                  <p className=\"text-xl font-bold text-foreground\">{stat.value}</p>\n                  <p className=\"text-xs text-muted-foreground\">{stat.label}</p>\n                </div>\n              ))}\n            </div>\n          </div>\n\n          <div className=\"mt-6 flex gap-0\">\n            {VIEWS.map((v) => {\n              const Icon = v.icon\n              return (\n                <button\n                  key={v.id}\n                  onClick={() => setView(v.id)}\n                  className={`flex items-center gap-2 border-b-2 px-5 py-2.5 text-xs font-medium transition-colors ${\n                    view === v.id\n                      ? \"border-primary text-foreground\"\n                      : \"border-transparent text-muted-foreground hover:text-foreground\"\n                  }`}\n                >\n                  <Icon className=\"h-3.5 w-3.5\" />\n                  {v.label}\n                  {v.id === \"my-requests\" && (\n                    <Badge variant=\"secondary\" className=\"text-[10px] px-1.5 py-0\">{myRequests.length}</Badge>\n                  )}\n                </button>\n              )\n            })}\n          </div>\n        </div>\n      </div>\n\n      <div className=\"mx-auto max-w-7xl px-6 py-8\">\n        {view === \"browse\" && (\n          <div className=\"space-y-6\">\n            <div className=\"flex gap-3\">\n              <div className=\"relative flex-1\">\n                <Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground\" />\n                <Input\n                  placeholder=\"Search by name, airport, specialisation...\"\n                  value={searchQuery}\n                  onChange={e => setSearchQuery(e.target.value)}\n                  className=\"pl-9 h-9 text-sm\"\n                />\n              </div>\n              <Button variant=\"outline\" size=\"sm\" className=\"gap-2 h-9\">\n                <Filter className=\"h-4 w-4\" />Filters\n              </Button>\n            </div>\n\n            <Card className=\"border-primary/40 bg-primary/5\">\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center justify-between gap-4\">\n                  <div>\n                    <p className=\"text-sm font-semibold flex items-center gap-2\">\n                      <AlertTriangle className=\"h-4 w-4 text-primary\" />\n                      {openSquawks.length} Open Squawks Near You\n                    </p>\n                    <p className=\"mt-0.5 text-xs text-muted-foreground\">Pilots are looking for quotes right now.</p>\n                  </div>\n                  <Button size=\"sm\" variant=\"outline\" className=\"shrink-0\" onClick={() => setView(\"post-squawk\")}>View All</Button>\n                </div>\n                <div className=\"mt-3 space-y-2\">\n                  {openSquawks.slice(0, 2).map(sq => (\n                    <div key={sq.id} className=\"flex items-center justify-between gap-3 rounded-md border border-border bg-card px-3 py-2\">\n                      <div className=\"flex items-center gap-2 min-w-0\">\n                        <Badge variant=\"outline\" className={`shrink-0 text-[10px] border ${URGENCY_CONFIG.flexible.className}`}>Open</Badge>\n                        <span className=\"text-xs font-medium truncate\">{sq.title}</span>\n                        <span className=\"text-xs text-muted-foreground shrink-0\">{sq.airportIcao || sq.city || ''}</span>\n                      </div>\n                      <Button size=\"sm\" className=\"h-6 shrink-0 text-[11px]\" onClick={() => setQuoteModalId(sq.id)}>Quote</Button>\n                    </div>\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n\n            <div>\n              <div className=\"mb-3 flex items-center justify-between\">\n                <p className=\"text-sm text-muted-foreground\">{filteredMechanics.length} mechanics found</p>\n              </div>\n              <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n                {filteredMechanics.map(m => (\n                  <MechanicCard key={m.id} mechanic={m} onSelect={setSelectedMechanic} />\n                ))}\n              </div>\n            </div>\n          </div>\n        )}\n\n        {view === \"post-squawk\" && (\n          <div className=\"grid gap-8 lg:grid-cols-3\">\n            <div className=\"lg:col-span-2\">\n              <PostSquawkForm onBack={() => setView(\"browse\")} onSubmit={handlePost} />\n            </div>\n            <div className=\"space-y-4\">\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"text-sm\">Open Requests</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-3\">\n                  {openSquawks.slice(0, 3).map(sq => (\n                    <SquawkCard key={sq.id} squawk={sq} onQuote={setQuoteModalId} />\n                  ))}\n                </CardContent>\n              </Card>\n            </div>\n          </div>\n        )}\n\n        {view === \"my-requests\" && (\n          <div className=\"space-y-6\">\n            <div className=\"flex items-center justify-between\">\n              <h2 className=\"text-base font-semibold\">My Squawk Requests</h2>\n              <Badge variant=\"secondary\">{myRequests.length} active</Badge>\n            </div>\n            {myRequests.map(req => (\n              <Card key={req.id} className=\"overflow-hidden\">\n                <CardHeader className=\"pb-3 bg-muted/30 border-b border-border\">\n                  <div className=\"flex items-start justify-between gap-3\">\n                    <div>\n                      <div className=\"flex items-center gap-2\">\n                        <CardTitle className=\"text-sm\">{req.title}</CardTitle>\n                        <Badge variant=\"outline\" className={`text-[11px] border ${URGENCY_CONFIG.flexible.className}`}>Open</Badge>\n                        <Badge variant=\"secondary\" className=\"text-[11px] capitalize\">{req.status || 'open'}</Badge>\n                      </div>\n                      <p className=\"mt-1 text-xs text-muted-foreground flex items-center gap-1.5\">\n                        <Plane className=\"h-3 w-3\" />{req.aircraftType || \"Aircraft\"} Â· <Clock className=\"h-3 w-3\" />{req.neededBy ? new Date(req.neededBy).toLocaleDateString() : \"Flexible\"}\n                      </p>\n                    </div>\n                    <div className=\"text-right shrink-0\">\n                      <p className=\"text-xs font-semibold\">{quotes.filter(q => q.maintenanceRequest.id === req.id).length} Quotes</p>\n                      <p className=\"text-[11px] text-muted-foreground\">Received</p>\n                    </div>\n                  </div>\n                </CardHeader>\n                <CardContent className=\"p-0\">\n                  {quotes.filter(q => q.maintenanceRequest.id === req.id).map((quote) => (\n                    <div key={quote.id} className=\"p-4 border-t border-border\">\n                      <div className=\"flex items-start justify-between gap-4\">\n                        <div className=\"flex items-center gap-3\">\n                          <div className=\"flex h-9 w-9 shrink-0 items-center justify-center rounded-full bg-primary/10 text-xs font-bold text-primary\">\n                            {quote.mechanic.name.split(\" \").map(n => n[0]).join(\"\")}\n                          </div>\n                          <div>\n                            <div className=\"flex items-center gap-1.5\">\n                              <span className=\"text-sm font-medium\">{quote.mechanic.businessName || quote.mechanic.name}</span>\n                              <ShieldCheck className=\"h-3.5 w-3.5 text-primary\" />\n                            </div>\n                            <p className=\"text-xs text-muted-foreground\">{quote.mechanic.name}</p>\n                            <div className=\"mt-1 flex items-center gap-2 text-xs text-muted-foreground\">\n                              <span className=\"flex items-center gap-1\"><Star className=\"h-3 w-3 fill-yellow-400 text-yellow-400\" />{quote.mechanic.rating ?? 0}</span>\n                              <span>Â·</span>\n                              <span className=\"flex items-center gap-1\"><Calendar className=\"h-3 w-3\" />ETA: TBD</span>\n                            </div>\n                          </div>\n                        </div>\n                        <div className=\"text-right shrink-0\">\n                          <p className=\"text-lg font-bold\">${quote.amount ?? 0}</p>\n                          <p className=\"text-[11px] text-muted-foreground\">est. total</p>\n                        </div>\n                      </div>\n                      <p className=\"mt-2 rounded-md bg-muted/40 px-3 py-2 text-xs text-muted-foreground leading-relaxed\">\n                        {quote.description}\n                      </p>\n                      <div className=\"mt-3 flex gap-2\">\n                        <Button size=\"sm\" variant=\"outline\" className=\"h-7 text-xs gap-1.5 flex-1\">\n                          <MessageSquare className=\"h-3.5 w-3.5\" />Message\n                        </Button>\n                        <Button size=\"sm\" className=\"h-7 text-xs gap-1.5 flex-1\">\n                          <CheckCircle2 className=\"h-3.5 w-3.5\" />Accept Quote\n                        </Button>\n                      </div>\n                    </div>\n                  ))}\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        )}\n      </div>\n\n      <Dialog open={!!quoteModalId} onOpenChange={() => setQuoteModalId(null)}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Send Quote</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-3\">\n            <Textarea placeholder=\"Message\" value={quoteMessage} onChange={(e) => setQuoteMessage(e.target.value)} />\n            <Input type=\"number\" placeholder=\"Total estimate\" value={quoteAmount} onChange={(e) => setQuoteAmount(e.target.value)} />\n            <Button onClick={submitQuote}>Send Quote</Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {selectedMechanic && (\n        <div className=\"fixed inset-0 z-50 flex items-start justify-end\">\n          <div className=\"absolute inset-0 bg-black/40\" onClick={() => setSelectedMechanic(null)} />\n          <div className=\"relative z-10 h-full w-full max-w-md overflow-y-auto bg-card shadow-2xl border-l border-border\">\n            <div className=\"sticky top-0 z-10 flex items-center justify-between border-b border-border bg-card/95 px-5 py-3 backdrop-blur\">\n              <span className=\"text-sm font-semibold\">Mechanic Profile</span>\n              <Button size=\"icon\" variant=\"ghost\" className=\"h-7 w-7\" onClick={() => setSelectedMechanic(null)}>\n                <X className=\"h-4 w-4\" />\n              </Button>\n            </div>\n            <div className=\"p-5 space-y-5\">\n              <div className=\"flex items-start gap-4\">\n                <div className=\"flex h-14 w-14 shrink-0 items-center justify-center rounded-full bg-primary/10 text-lg font-bold text-primary\">\n                  {selectedMechanic.name.split(\" \").map(n => n[0]).join(\"\")}\n                </div>\n                <div className=\"flex-1\">\n                  <div className=\"flex items-center gap-2\">\n                    <h2 className=\"text-base font-bold\">{selectedMechanic.name}</h2>\n                    <ShieldCheck className=\"h-4 w-4 text-primary\" />\n                  </div>\n                  <p className=\"text-sm text-muted-foreground\">{selectedMechanic.businessName || \"Independent\"}</p>\n                  <div className=\"mt-1 flex flex-wrap items-center gap-2 text-xs text-muted-foreground\">\n                    <span className=\"flex items-center gap-1\"><MapPin className=\"h-3 w-3\" />{[selectedMechanic.city, selectedMechanic.state, selectedMechanic.locationIcao].filter(Boolean).join(\" â€¢ \")}</span>\n                  </div>\n                </div>\n              </div>\n              <Separator />\n              <div>\n                <h3 className=\"mb-2 text-xs font-semibold uppercase tracking-wider text-muted-foreground\">Specialisations</h3>\n                <div className=\"flex flex-wrap gap-2\">\n                  {(selectedMechanic.specialties || '').split(',').filter(Boolean).map((s) => (\n                    <Badge key={s} variant=\"secondary\">{s.trim()}</Badge>\n                  ))}\n                </div>\n              </div>\n              <div className=\"flex flex-col gap-2 pt-2\">\n                <Button className=\"w-full gap-2\"><MessageSquare className=\"h-4 w-4\" />Send Message</Button>\n                <Button variant=\"outline\" className=\"w-full gap-2\"><FileText className=\"h-4 w-4\" />Request Quote</Button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\mechanics\\onboarding\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\mechanics\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\mechanics\\profile\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\mechanics\\requests\\files\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\mechanics\\requests\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\messages\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'formatTime' is defined but never used.","line":30,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":30,"endColumn":20},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":48,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1801,1804],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1801,1804],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'messagesLoading' is assigned a value but never used.","line":55,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":55,"endColumn":25},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\David\\next-dashboard\\app\\messages\\page.tsx:62:7\n  60 |     const newConvoId = searchParams.get('newConversation')\n  61 |     if (newConvoId) {\n> 62 |       setSelectedId(newConvoId)\n     |       ^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  63 |       setShowThread(true)\n  64 |       setTab('marketplace')\n  65 |     }","line":62,"column":7,"nodeType":null,"endLine":62,"endColumn":20},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\David\\next-dashboard\\app\\messages\\page.tsx:76:7\n  74 |   useEffect(() => {\n  75 |     if (selectedId) {\n> 76 |       setMessagesLoading(true)\n     |       ^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  77 |       fetch(`/api/conversations/${selectedId}/messages`)\n  78 |         .then(r => {\n  79 |           if (!r.ok) {","line":76,"column":7,"nodeType":null,"endLine":76,"endColumn":25},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":87,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3274,3277],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3274,3277],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":87,"column":92,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":95,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3300,3303],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3300,3303],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":111,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4004,4007],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4004,4007],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":111,"column":94,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":97,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4030,4033],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4030,4033],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect, useRef, Suspense } from 'react'\nimport Link from 'next/link'\nimport { useSearchParams } from 'next/navigation'\nimport { useSession } from 'next-auth/react'\nimport { Search, Plane, Users, Send, MoreHorizontal, Phone, Video, ExternalLink, ChevronLeft } from 'lucide-react'\nimport { Button } from '@/components/ui/button'\nimport { Badge } from '@/components/ui/badge'\nimport { Input } from '@/components/ui/input'\n\ntype ConversationItem = {\n  id: string\n  updatedAt: string\n  listingId?: string | null\n  listing?: { id: string; title: string; airportIcao: string } | null\n  participants: { user: { id: string; name?: string | null; username?: string | null } }[]\n  messages: { id: string; body: string; createdAt: string; senderId: string }[]\n}\n\nfunction initials(name?: string | null) {\n  const raw = (name || '').trim()\n  if (!raw) return '?'\n  const parts = raw.split(/\\s+/).filter(Boolean)\n  const first = parts[0]?.[0] || '?'\n  const last = parts.length > 1 ? parts[parts.length - 1]?.[0] : ''\n  return (first + last).toUpperCase()\n}\n\nfunction formatTime(dateStr: string) {\n  const date = new Date(dateStr)\n  const now = new Date()\n  const diffMs = now.getTime() - date.getTime()\n  const diffMins = Math.floor(diffMs / 60000)\n  const diffHours = Math.floor(diffMins / 60)\n  const diffDays = Math.floor(diffHours / 24)\n  if (diffMins < 1) return 'Just now'\n  if (diffMins < 60) return `${diffMins}m`\n  if (diffHours < 24) return `${diffHours}h`\n  if (diffDays < 7) return `${diffDays}d`\n  return date.toLocaleDateString()\n}\n\nfunction MessagesContent() {\n  const { data: session } = useSession()\n  const searchParams = useSearchParams()\n  const [conversations, setConversations] = useState<ConversationItem[]>([])\n  const [messages, setMessages] = useState<any[]>([])\n  const [selectedId, setSelectedId] = useState<string | null>(null)\n  const [showThread, setShowThread] = useState(false)\n  const [tab, setTab] = useState<'marketplace' | 'friends'>('marketplace')\n  const [search, setSearch] = useState('')\n  const [newMessage, setNewMessage] = useState('')\n  const [loading, setLoading] = useState(true)\n  const [messagesLoading, setMessagesLoading] = useState(false)\n  const messagesEndRef = useRef<HTMLDivElement>(null)\n  const currentUserId = session?.user?.id\n\n  useEffect(() => {\n    const newConvoId = searchParams.get('newConversation')\n    if (newConvoId) {\n      setSelectedId(newConvoId)\n      setShowThread(true)\n      setTab('marketplace')\n    }\n  }, [searchParams])\n\n  useEffect(() => {\n    if (session?.user?.id) {\n      fetch('/api/conversations').then(r => r.json()).then(d => { setConversations(d.conversations || []); setLoading(false) }).catch(() => setLoading(false))\n    }\n  }, [session])\n\n  useEffect(() => {\n    if (selectedId) {\n      setMessagesLoading(true)\n      fetch(`/api/conversations/${selectedId}/messages`)\n        .then(r => {\n          if (!r.ok) {\n            console.error('Messages fetch error:', r.status, r.statusText);\n            return r.json().then(err => { throw new Error(err.error || 'Failed to load') });\n          }\n          return r.json()\n        })\n        .then(d => {\n          // Deduplicate by message ID\n          const uniqueMessages = (d.messages || []).filter((msg: any, index: number, self: any[]) => \n            index === self.findIndex((m) => m.id === msg.id)\n          )\n          setMessages(uniqueMessages)\n        })\n        .catch(err => {\n          console.error('Failed to load messages:', err);\n          setMessages([])\n        })\n        .finally(() => {\n          setMessagesLoading(false)\n        })\n    }\n  }, [selectedId])\n\n  // Poll for new messages every 3 seconds\n  useEffect(() => {\n    if (!selectedId) return\n    \n    const interval = setInterval(() => {\n      fetch(`/api/conversations/${selectedId}/messages`)\n        .then(r => r.ok ? r.json() : null)\n        .then(d => {\n          if (d?.messages) {\n            const uniqueMessages = (d.messages || []).filter((msg: any, index: number, self: any[]) => \n              index === self.findIndex((m) => m.id === msg.id)\n            )\n            setMessages(uniqueMessages)\n          }\n        })\n        .catch(() => {})\n    }, 3000)\n    \n    return () => clearInterval(interval)\n  }, [selectedId])\n\n  useEffect(() => { messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' }) }, [messages])\n\n  const marketplaceConversations = conversations.filter(c => c.listingId)\n  const friendsConversations = conversations.filter(c => !c.listingId)\n  const selectedConversation = conversations.find(c => c.id === selectedId)\n  const otherParticipant = selectedConversation?.participants.find(p => p.user.id !== currentUserId)?.user\n  const filteredConversations = tab === 'marketplace' ? marketplaceConversations : friendsConversations\n\n  async function handleSend() {\n    if (!newMessage.trim() || !selectedId) return\n    \n    // Send plain text - server will encrypt it\n    const res = await fetch(`/api/conversations/${selectedId}/messages`, { \n      method: 'POST', \n      headers: { 'Content-Type': 'application/json' }, \n      body: JSON.stringify({ body: newMessage }) \n    })\n    \n    if (!res.ok) {\n      const err = await res.json().catch(() => ({ error: 'Failed to send' }))\n      console.error('Send failed:', err.error)\n      return\n    }\n    \n    setNewMessage('')\n    // Polling will automatically fetch the new message\n  }\n\n  if (!session) return <div className=\"min-h-screen bg-background flex items-center justify-center\"><p className=\"text-muted-foreground\">Please sign in to view messages.</p></div>\n\n  return (\n    <div className=\"h-screen flex flex-col bg-background\">\n      <div className=\"border-b border-border bg-card/50 px-4 lg:px-8 py-4\">\n        <div className=\"max-w-7xl mx-auto\">\n          <h1 className=\"text-2xl font-bold\">Messages</h1>\n          <p className=\"text-sm text-muted-foreground\">Chat with sellers and friends</p>\n        </div>\n      </div>\n      <main className=\"flex-1 overflow-hidden px-0 lg:px-8 lg:py-4\">\n        <div className=\"h-[calc(100vh-8rem)] border border-border rounded-xl overflow-hidden bg-card flex max-w-7xl mx-auto\">\n          <div className={`w-full lg:w-[340px] border-r border-border bg-card ${showThread ? 'hidden lg:flex lg:flex-col' : 'flex flex-col'}`}>\n            <div className=\"p-4 border-b border-border\">\n              <div className=\"flex rounded-lg bg-secondary/60 p-1\">\n                <button onClick={() => setTab('marketplace')} className={`flex-1 flex items-center justify-center gap-2 rounded-md px-3 py-2 text-sm font-medium ${tab === 'marketplace' ? 'bg-card text-foreground shadow-sm' : 'text-muted-foreground'}`}>\n                  <Plane className=\"w-4 h-4\" /><span>Marketplace</span>\n                  {marketplaceConversations.length > 0 && <Badge className=\"bg-primary/20 text-primary border-0 px-1.5 text-xs\">{marketplaceConversations.length}</Badge>}\n                </button>\n                <button onClick={() => setTab('friends')} className={`flex-1 flex items-center justify-center gap-2 rounded-md px-3 py-2 text-sm font-medium ${tab === 'friends' ? 'bg-card text-foreground shadow-sm' : 'text-muted-foreground'}`}>\n                  <Users className=\"w-4 h-4\" /><span>Friends</span>\n                </button>\n              </div>\n            </div>\n            <div className=\"p-4 pb-2\">\n              <div className=\"relative\">\n                <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\n                <Input placeholder={tab === 'marketplace' ? 'Search listings or sellers...' : 'Search friends...'} value={search} onChange={(e) => setSearch(e.target.value)} className=\"pl-9\" />\n              </div>\n            </div>\n            <div className=\"flex-1 overflow-y-auto px-2 pb-2\">\n              {loading ? <div className=\"p-4 text-center text-muted-foreground\">Loading...</div> : filteredConversations.length === 0 ? <div className=\"p-4 text-center text-muted-foreground\">No conversations yet</div> : filteredConversations.map((convo) => {\n                const participant = convo.participants.find(p => p.user.id !== currentUserId)?.user\n                return (\n                  <button key={convo.id} onClick={() => { setSelectedId(convo.id); setShowThread(true) }} className={`w-full text-left p-3 rounded-lg mb-1 ${selectedId === convo.id ? 'bg-secondary' : 'hover:bg-secondary/50'}`}>\n                    <div className=\"flex gap-3\">\n                      <div className=\"w-10 h-10 rounded-full bg-secondary flex items-center justify-center shrink-0\"><span className=\"text-xs font-semibold text-muted-foreground\">{initials(participant?.name || participant?.username)}</span></div>\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"text-sm font-medium truncate\">{convo.listing?.title || participant?.name || 'Pilot'}</div>\n                        {tab === 'marketplace' && convo.listing && <div className=\"flex items-center gap-1 mt-0.5\"><Plane className=\"w-3 h-3 text-primary\" /><span className=\"text-xs text-primary truncate\">{convo.listing.title}</span></div>}\n                        <div className=\"text-xs text-muted-foreground truncate\">{participant?.name || participant?.username}</div>\n                      </div>\n                    </div>\n                  </button>\n                )\n              })}\n            </div>\n          </div>\n          <div className={`flex-1 ${showThread ? 'flex flex-col' : 'hidden lg:flex'}`}>\n            {selectedId && selectedConversation ? (\n              <>\n                <div className=\"flex items-center justify-between px-4 lg:px-6 py-4 border-b border-border bg-card/50\">\n                  <div className=\"flex items-center gap-3\">\n                    {showThread && <button onClick={() => setShowThread(false)} className=\"lg:hidden\"><ChevronLeft className=\"w-5 h-5\" /></button>}\n                    <div className=\"w-10 h-10 rounded-full bg-secondary flex items-center justify-center\"><span className=\"text-xs font-semibold text-muted-foreground\">{initials(otherParticipant?.name || otherParticipant?.username)}</span></div>\n                    <div><h3 className=\"text-sm font-semibold\">{otherParticipant?.name || 'Pilot'}</h3><span className=\"text-xs text-primary\">Tap to view profile</span></div>\n                  </div>\n                  <div className=\"flex gap-1\">\n                    <Button variant=\"ghost\" size=\"icon\" className=\"h-9 w-9\"><Phone className=\"w-4 h-4\" /></Button>\n                    <Button variant=\"ghost\" size=\"icon\" className=\"h-9 w-9\"><Video className=\"w-4 h-4\" /></Button>\n                    <Button variant=\"ghost\" size=\"icon\" className=\"h-9 w-9\"><MoreHorizontal className=\"w-4 h-4\" /></Button>\n                  </div>\n                </div>\n                {selectedConversation.listing && (\n                  <div className=\"px-4 lg:px-6 py-3 border-b border-border bg-secondary/30\">\n                    <div className=\"flex items-center gap-3 p-3 rounded-lg bg-card border\">\n                      <div className=\"w-14 h-10 rounded-md bg-secondary flex items-center justify-center shrink-0\"><Plane className=\"w-5 h-5 text-primary\" /></div>\n                      <div className=\"flex-1\"><p className=\"text-sm font-medium truncate\">{selectedConversation.listing.title}</p><p className=\"text-xs text-muted-foreground\">{selectedConversation.listing.airportIcao}</p></div>\n                      <Link href={`/modules/marketplace/listing/${selectedConversation.listing.id}`}><Button variant=\"ghost\" size=\"sm\" className=\"gap-1\"><ExternalLink className=\"w-3.5 h-3.5\" /><span className=\"hidden sm:inline text-xs\">View</span></Button></Link>\n                    </div>\n                  </div>\n                )}\n                <div className=\"flex-1 overflow-y-auto px-4 lg:px-6 py-4\">\n                  {messages.map((msg) => {\n                    const msgDate = new Date(msg.createdAt);\n                    const timeStr = msgDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\n                    const dateStr = msgDate.toLocaleDateString([], { month: 'short', day: 'numeric' });\n                    return (\n                    <div key={msg.id} className={`flex ${msg.senderId === currentUserId ? 'justify-end' : 'justify-start'} mb-4`}>\n                      <div className={`max-w-[75%] px-4 py-2.5 rounded-2xl text-sm ${msg.senderId === currentUserId ? 'bg-primary text-primary-foreground' : 'bg-secondary'}`}>\n                        <div>{msg.body}</div>\n                        <div className={`text-[10px] mt-1 opacity-70 ${msg.senderId === currentUserId ? 'text-right' : ''}`}>{timeStr} Â· {dateStr}</div>\n                      </div>\n                    </div>\n                  )})}\n                  <div ref={messagesEndRef} />\n                </div>\n                <div className=\"px-4 lg:px-6 py-4 border-t border-border bg-card/50\">\n                  <div className=\"flex gap-2\">\n                    <textarea rows={1} value={newMessage} onChange={(e) => setNewMessage(e.target.value)} onKeyDown={(e) => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); handleSend() } }} placeholder=\"Type a message...\" className=\"flex-1 resize-none bg-secondary/60 border border-border rounded-lg px-4 py-2 text-sm focus:outline-none\" />\n                    <Button onClick={handleSend} disabled={!newMessage.trim()} className=\"h-10 w-10\"><Send className=\"w-4 h-4\" /></Button>\n                  </div>\n                </div>\n              </>\n            ) : <div className=\"flex-1 flex items-center justify-center text-muted-foreground\">Select a conversation</div>}\n          </div>\n        </div>\n      </main>\n    </div>\n  )\n}\n\nfunction MessagesLoading() {\n  return (\n    <div className=\"h-screen flex items-center justify-center bg-background\">\n      <div className=\"text-muted-foreground\">Loading messages...</div>\n    </div>\n  )\n}\n\nexport default function MessagesPage() {\n  return (\n    <Suspense fallback={<MessagesLoading />}>\n      <MessagesContent />\n    </Suspense>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\model-viewer\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\model-viewer\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Suspense' is defined but never used.","line":3,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":18,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Suspense"},"fix":{"range":[15,49],"text":""},"desc":"Remove unused import declaration."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { Suspense } from 'react';\nimport { AircraftModel } from '../components/three/aircraft-model';\n\nexport default function ModelViewerPage() {\n  return (\n    <div className=\"min-h-screen bg-gradient-to-b from-slate-950 via-slate-950 to-slate-900 px-6 py-10\">\n      <div className=\"mx-auto max-w-6xl space-y-6\">\n        <header className=\"space-y-2\">\n          <p className=\"text-xs uppercase tracking-[0.28em] text-slate-400\">3D Viewer</p>\n          <h1 className=\"text-3xl font-semibold text-slate-50\">Aircraft Model</h1>\n          <p className=\"max-w-3xl text-sm text-slate-300\">\n            Procedural Ghost Aircraft generated from FAA specifications\n          </p>\n        </header>\n\n        <div className=\"grid gap-6 md:grid-cols-2\">\n          {/* Cessna 172 Style */}\n          <div className=\"rounded-2xl border border-slate-800 bg-slate-900/60 overflow-hidden\">\n            <div className=\"p-4 border-b border-slate-800\">\n              <h2 className=\"font-semibold text-slate-100\">Cessna 172 (GA Single)</h2>\n              <p className=\"text-xs text-slate-400\">Single Engine â€¢ 180 HP</p>\n            </div>\n            <div className=\"h-80\">\n              <AircraftModel\n                nNumber=\"N12345\"\n                manufacturer=\"Cessna\"\n                model=\"172 Skyhawk\"\n                length={27}\n                wingspan={36}\n                engineCount={1}\n              />\n            </div>\n          </div>\n\n          {/* Boeing 737 Style */}\n          <div className=\"rounded-2xl border border-slate-800 bg-slate-900/60 overflow-hidden\">\n            <div className=\"p-4 border-b border-slate-800\">\n              <h2 className=\"font-semibold text-slate-100\">Boeing 737-800 (Commercial)</h2>\n              <p className=\"text-xs text-slate-400\">Twin Engine â€¢ 12000 lbs thrust</p>\n            </div>\n            <div className=\"h-80\">\n              <AircraftModel\n                nNumber=\"N56789\"\n                manufacturer=\"Boeing\"\n                model=\"737-824\"\n                length={129}\n                wingspan={117}\n                engineCount={2}\n              />\n            </div>\n          </div>\n\n          {/* Gulfstream Style */}\n          <div className=\"rounded-2xl border border-slate-800 bg-slate-900/60 overflow-hidden\">\n            <div className=\"p-4 border-b border-slate-800\">\n              <h2 className=\"font-semibold text-slate-100\">Gulfstream G650 (Business Jet)</h2>\n              <p className=\"text-xs text-slate-400\">Twin Engine â€¢ Long Range</p>\n            </div>\n            <div className=\"h-80\">\n              <AircraftModel\n                nNumber=\"N99999\"\n                manufacturer=\"Gulfstream\"\n                model=\"G650\"\n                length={90}\n                wingspan={93}\n                engineCount={2}\n              />\n            </div>\n          </div>\n\n          {/* Embraer E-Jet */}\n          <div className=\"rounded-2xl border border-slate-800 bg-slate-900/60 overflow-hidden\">\n            <div className=\"p-4 border-b border-slate-800\">\n              <h2 className=\"font-semibold text-slate-100\">Embraer E190 (Regional Jet)</h2>\n              <p className=\"text-xs text-slate-400\">Twin Engine â€¢ 100+ PAX</p>\n            </div>\n            <div className=\"h-80\">\n              <AircraftModel\n                nNumber=\"N11111\"\n                manufacturer=\"Embraer\"\n                model=\"E190\"\n                length={98}\n                wingspan={94}\n                engineCount={2}\n              />\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\aircraft\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\aperture\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":58,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1727,1730],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1727,1730],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":61,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1891,1894],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1891,1894],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":63,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2038,2041],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2038,2041],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":86,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2637,2640],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2637,2640],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`loadProfiles` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nC:\\Users\\David\\next-dashboard\\app\\modules\\aperture\\page.tsx:90:11\n  88 |         } else {\n  89 |           // Logged in - load real data\n> 90 |           loadProfiles();\n     |           ^^^^^^^^^^^^ `loadProfiles` accessed before it is declared\n  91 |           loadMyProfile();\n  92 |         }\n  93 |       })\n\nC:\\Users\\David\\next-dashboard\\app\\modules\\aperture\\page.tsx:102:3\n  100 |   }, [filters]);\n  101 |\n> 102 |   const loadProfiles = async () => {\n      |   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 103 |     setLoading(true);\n      | ^^^^^^^^^^^^^^^^^^^^^\n> 104 |     const params = new URLSearchParams();\n      â€¦\n      | ^^^^^^^^^^^^^^^^^^^^^\n> 119 |     setLoading(false);\n      | ^^^^^^^^^^^^^^^^^^^^^\n> 120 |   };\n      | ^^^^^ `loadProfiles` is declared here\n  121 |\n  122 |   const loadMyProfile = async () => {\n  123 |     try {","line":90,"column":11,"nodeType":null,"endLine":90,"endColumn":23},{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`loadMyProfile` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nC:\\Users\\David\\next-dashboard\\app\\modules\\aperture\\page.tsx:91:11\n  89 |           // Logged in - load real data\n  90 |           loadProfiles();\n> 91 |           loadMyProfile();\n     |           ^^^^^^^^^^^^^ `loadMyProfile` accessed before it is declared\n  92 |         }\n  93 |       })\n  94 |       .catch(() => {\n\nC:\\Users\\David\\next-dashboard\\app\\modules\\aperture\\page.tsx:122:3\n  120 |   };\n  121 |\n> 122 |   const loadMyProfile = async () => {\n      |   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 123 |     try {\n      | ^^^^^^^^^\n> 124 |       const res = await fetch('/api/users/me');\n      â€¦\n      | ^^^^^^^^^\n> 148 |     }\n      | ^^^^^^^^^\n> 149 |   };\n      | ^^^^^ `loadMyProfile` is declared here\n  150 |\n  151 |   const handleSubmit = async (e: React.FormEvent) => {\n  152 |     e.preventDefault();","line":91,"column":11,"nodeType":null,"endLine":91,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":97,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2964,2967],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2964,2967],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadProfiles'. Either include it or remove the dependency array.","line":100,"column":6,"nodeType":"ArrayExpression","endLine":100,"endColumn":15,"suggestions":[{"desc":"Update the dependencies array to be: [filters, loadProfiles]","fix":{"range":[3043,3052],"text":"[filters, loadProfiles]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":114,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3552,3555],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3552,3555],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":130,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":130,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4048,4051],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4048,4051],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":178,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":178,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5888,5891],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5888,5891],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":260,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":260,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9858,9861],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9858,9861],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":283,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":283,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10768,10771],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10768,10771],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":322,"column":21,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[12702,12724],"text":"\n                    &quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[12702,12724],"text":"\n                    &ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[12702,12724],"text":"\n                    &#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[12702,12724],"text":"\n                    &rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":322,"column":35,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[12737,12757],"text":"&quot;\n                  "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[12737,12757],"text":"&ldquo;\n                  "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[12737,12757],"text":"&#34;\n                  "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[12737,12757],"text":"&rdquo;\n                  "},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":14,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect } from 'react';\n\n// Demo profiles for demo mode\nconst demoProfiles = [\n  {\n    id: 'demo-profile-1',\n    userId: 'demo-user-1',\n    availability: 'Weekends, Evenings',\n    flightInterests: 'Cross Country,IFR,Night',\n    homeAirport: 'KORD',\n    experienceLevel: 'Private PPL',\n    bio: 'Instrument rated pilot with 200 hours. Love cross-country flights and exploring new airports.',\n    lookingFor: 'Weekend XC partner',\n    city: 'Chicago',\n    state: 'IL',\n    latitude: 41.8781,\n    longitude: -87.6298,\n    isActive: true,\n    user: { name: 'Mike Chen', email: 'mike@demo.com' }\n  },\n  {\n    id: 'demo-profile-2',\n    userId: 'demo-user-2',\n    availability: 'Weekends',\n    flightInterests: 'Sightseeing,Training',\n    homeAirport: 'KMDW',\n    experienceLevel: 'Student Pilot',\n    bio: 'Working on my PPL. Looking for a mentor or flight buddy!',\n    lookingFor: 'CFI or experienced pilot for mentorship',\n    city: 'Chicago',\n    state: 'IL',\n    latitude: 41.7868,\n    longitude: -87.6082,\n    isActive: true,\n    user: { name: 'Sarah Williams', email: 'sarah.w@demo.com' }\n  },\n  {\n    id: 'demo-profile-3',\n    userId: 'demo-user-3',\n    availability: 'Flexible',\n    flightInterests: 'Mountain,Coastal',\n    homeAirport: 'KSFO',\n    experienceLevel: 'Commercial',\n    bio: 'Commercial pilot, 1500 hours. Love scenic flights along the coast and mountains.',\n    lookingFor: 'Adventure flying partner',\n    city: 'San Francisco',\n    state: 'CA',\n    latitude: 37.7749,\n    longitude: -122.4194,\n    isActive: true,\n    user: { name: 'James Rodriguez', email: 'james@demo.com' }\n  },\n];\n\nexport default function PartnershipPage() {\n  const [profiles, setProfiles] = useState<any[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [showEditForm, setShowEditForm] = useState(false);\n  const [myProfile, setMyProfile] = useState<any>(null);\n  const [filters, setFilters] = useState({ airport: '', state: '', experience: '' });\n  const [mapProfiles, setMapProfiles] = useState<any[]>([]);\n  const [isDemoMode, setIsDemoMode] = useState(false);\n\n  const [formData, setFormData] = useState({\n    availability: '',\n    flightInterests: '',\n    homeAirport: '',\n    experienceLevel: '',\n    bio: '',\n    lookingFor: '',\n    city: '',\n    state: ''\n  });\n\n  useEffect(() => {\n    // Check if user is logged in\n    fetch('/api/auth/session')\n      .then(res => res.json())\n      .then(data => {\n        if (!data?.user) {\n          // Not logged in - use demo mode\n          setIsDemoMode(true);\n          setProfiles(demoProfiles);\n          setMapProfiles(demoProfiles.filter((p: any) => p.latitude && p.longitude));\n          setLoading(false);\n        } else {\n          // Logged in - load real data\n          loadProfiles();\n          loadMyProfile();\n        }\n      })\n      .catch(() => {\n        setIsDemoMode(true);\n        setProfiles(demoProfiles);\n        setMapProfiles(demoProfiles.filter((p: any) => p.latitude && p.longitude));\n        setLoading(false);\n      });\n  }, [filters]);\n\n  const loadProfiles = async () => {\n    setLoading(true);\n    const params = new URLSearchParams();\n    if (filters.airport) params.set('airport', filters.airport);\n    if (filters.state) params.set('state', filters.state);\n    if (filters.experience) params.set('experience', filters.experience);\n\n    try {\n      const res = await fetch(`/api/partnership?${params}`);\n      if (res.ok) {\n        const data = await res.json();\n        setProfiles(data);\n        setMapProfiles(data.filter((p: any) => p.latitude && p.longitude));\n      }\n    } catch (e) {\n      console.error('Error loading profiles:', e);\n    }\n    setLoading(false);\n  };\n\n  const loadMyProfile = async () => {\n    try {\n      const res = await fetch('/api/users/me');\n      if (res.ok) {\n        const userData = await res.json();\n        const profileRes = await fetch('/api/partnership');\n        if (profileRes.ok) {\n          const allProfiles = await profileRes.json();\n          const mine = allProfiles.find((p: any) => p.userId === userData.id);\n          if (mine) {\n            setMyProfile(mine);\n            setFormData({\n              availability: mine.availability || '',\n              flightInterests: mine.flightInterests || '',\n              homeAirport: mine.homeAirport || '',\n              experienceLevel: mine.experienceLevel || '',\n              bio: mine.bio || '',\n              lookingFor: mine.lookingFor || '',\n              city: mine.city || '',\n              state: mine.state || ''\n            });\n          }\n        }\n      }\n    } catch (e) {\n      console.error('Error loading profile:', e);\n    }\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    try {\n      const res = await fetch('/api/partnership', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(formData)\n      });\n      const data = await res.json();\n      if (res.ok) {\n        setMyProfile(data);\n        setShowEditForm(false);\n        loadProfiles();\n      } else {\n        alert('Error: ' + (data.error || data.details || 'Failed to save'));\n      }\n    } catch (e) {\n      console.error('Error saving profile:', e);\n      alert('Error saving profile: ' + e);\n    }\n  };\n\n  const experienceLevels = ['Student Pilot', 'Private PPL', 'Commercial', 'ATP', 'CFI', 'CFII', 'MEI'];\n  const interestOptions = ['Cross Country', 'IFR', 'VFR', 'Sightseeing', 'Training', 'Night', 'Mountain', 'Coastal'];\n  const states = ['AL','AK','AZ','AR','CA','CO','CT','DE','FL','GA','HI','ID','IL','IN','IA','KS','KY','LA','ME','MD','MA','MI','MN','MS','MO','MT','NE','NV','NH','NJ','NM','NY','NC','ND','OH','OK','OR','PA','RI','SC','SD','TN','TX','UT','VT','VA','WA','WV','WI','WY'];\n\n  // Filter profiles based on filters\n  const filteredProfiles = profiles.filter((profile: any) => {\n    if (filters.airport && profile.homeAirport !== filters.airport) return false;\n    if (filters.state && profile.state !== filters.state) return false;\n    if (filters.experience && profile.experienceLevel !== filters.experience) return false;\n    return true;\n  });\n\n  return (\n    <div className=\"min-h-screen bg-slate-900 text-white p-6\">\n      <div className=\"max-w-6xl mx-auto\">\n        <div className=\"flex justify-between items-center mb-8\">\n          <div>\n            <h1 className=\"text-3xl font-bold\">ðŸ¤ Flying Partner Marketplace</h1>\n            <p className=\"text-slate-400\">Find other pilots in your area to fly with</p>\n            {isDemoMode && (\n              <span className=\"inline-block mt-2 bg-yellow-500/20 text-yellow-400 text-xs px-2 py-1 rounded\">\n                Demo Mode - Sign in to create your profile\n              </span>\n            )}\n          </div>\n          {!isDemoMode && (\n            <button\n              onClick={() => { loadMyProfile(); setShowEditForm(true); }}\n              className=\"bg-sky-500 hover:bg-sky-600 px-4 py-2 rounded-lg font-medium\"\n            >\n              {myProfile ? 'âœï¸ Edit My Profile' : 'âž• Create Profile'}\n            </button>\n          )}\n        </div>\n\n        {/* Filters */}\n        <div className=\"bg-slate-800 rounded-lg p-4 border border-slate-700 mb-6\">\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n            <div>\n              <label className=\"block text-xs text-slate-400 mb-1\">Home Airport</label>\n              <input\n                type=\"text\"\n                placeholder=\"e.g., KORD\"\n                value={filters.airport}\n                onChange={(e) => setFilters({ ...filters, airport: e.target.value.toUpperCase() })}\n                className=\"w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm uppercase\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-xs text-slate-400 mb-1\">State</label>\n              <select\n                value={filters.state}\n                onChange={(e) => setFilters({ ...filters, state: e.target.value })}\n                className=\"w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm\"\n              >\n                <option value=\"\">All States</option>\n                {states.map(s => <option key={s} value={s}>{s}</option>)}\n              </select>\n            </div>\n            <div>\n              <label className=\"block text-xs text-slate-400 mb-1\">Experience</label>\n              <select\n                value={filters.experience}\n                onChange={(e) => setFilters({ ...filters, experience: e.target.value })}\n                className=\"w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm\"\n              >\n                <option value=\"\">All Levels</option>\n                {experienceLevels.map(l => <option key={l} value={l}>{l}</option>)}\n              </select>\n            </div>\n          </div>\n        </div>\n\n        {/* Map View */}\n        {mapProfiles.length > 0 && (\n          <div className=\"bg-slate-800 rounded-lg border border-slate-700 overflow-hidden mb-6\">\n            <div className=\"p-4 border-b border-slate-700\">\n              <h3 className=\"font-medium\">ðŸ—ºï¸ Pilot Locations</h3>\n              <p className=\"text-xs text-slate-400\">{mapProfiles.length} pilots on map</p>\n            </div>\n            <div className=\"h-[300px] bg-slate-900 relative\">\n              <div className=\"absolute inset-0 flex items-center justify-center\">\n                <div className=\"text-center p-4\">\n                  <div className=\"text-4xl mb-2\">ðŸ—ºï¸</div>\n                  <p className=\"text-slate-400 text-sm\">Interactive Map</p>\n                  <p className=\"text-slate-500 text-xs\">{mapProfiles.length} pilots near you</p>\n                  <div className=\"mt-4 flex flex-wrap gap-2 justify-center\">\n                    {mapProfiles.slice(0, 6).map((p: any, i: number) => (\n                      <div key={i} className=\"bg-slate-800 px-3 py-1 rounded-full text-xs\">\n                        {p.city}, {p.state} âœˆï¸ {p.homeAirport}\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* Profile Cards */}\n        {loading ? (\n          <div className=\"text-center py-12\">Loading...</div>\n        ) : filteredProfiles.length === 0 ? (\n          <div className=\"text-center py-12 text-slate-400\">\n            <div className=\"text-4xl mb-4\">ðŸ¤</div>\n            <p>No pilots found matching your criteria</p>\n            <p className=\"text-sm mt-2\">Be the first to create a profile!</p>\n          </div>\n        ) : (\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n            {filteredProfiles.map((profile: any) => (\n              <div key={profile.id} className=\"bg-slate-800 rounded-lg p-4 border border-slate-700\">\n                <div className=\"flex justify-between items-start mb-3\">\n                  <div>\n                    <div className=\"font-semibold text-lg\">{profile.user?.name || 'Anonymous Pilot'}</div>\n                    <div className=\"text-sky-400 text-sm\">\n                      ðŸ“ {profile.city}, {profile.state}\n                    </div>\n                  </div>\n                  <span className=\"text-xs bg-sky-500/20 text-sky-400 px-2 py-1 rounded\">\n                    {profile.experienceLevel}\n                  </span>\n                </div>\n                \n                <div className=\"space-y-2 text-sm\">\n                  {profile.homeAirport && (\n                    <div className=\"flex items-center gap-2 text-slate-300\">\n                      <span>âœˆï¸</span> Home: <span className=\"font-mono\">{profile.homeAirport}</span>\n                    </div>\n                  )}\n                  {profile.availability && (\n                    <div className=\"flex items-center gap-2 text-slate-300\">\n                      <span>ðŸ“…</span> {profile.availability}\n                    </div>\n                  )}\n                  {profile.flightInterests && (\n                    <div className=\"flex items-start gap-2 text-slate-300\">\n                      <span>ðŸŽ¯</span> \n                      <div className=\"flex flex-wrap gap-1 mt-0.5\">\n                        {profile.flightInterests.split(',').map((interest: string, i: number) => (\n                          <span key={i} className=\"text-xs bg-slate-700 px-2 py-0.5 rounded\">{interest.trim()}</span>\n                        ))}\n                      </div>\n                    </div>\n                  )}\n                </div>\n                \n                {profile.bio && (\n                  <div className=\"mt-3 text-sm text-slate-400 italic\">\n                    \"{profile.bio}\"\n                  </div>\n                )}\n                \n                {profile.lookingFor && (\n                  <div className=\"mt-3 text-xs text-slate-500\">\n                    Looking for: {profile.lookingFor}\n                  </div>\n                )}\n                \n                {!isDemoMode && (\n                  <button className=\"mt-4 w-full bg-slate-700 hover:bg-slate-600 py-2 rounded-lg text-sm transition-colors\">\n                    ðŸ“§ Contact\n                  </button>\n                )}\n              </div>\n            ))}\n          </div>\n        )}\n\n        {/* Edit Profile Modal */}\n        {showEditForm && (\n          <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\n            <div className=\"bg-slate-800 rounded-xl p-6 border border-slate-700 max-w-lg w-full max-h-[90vh] overflow-y-auto\">\n              <h3 className=\"text-lg font-semibold mb-4\">\n                {myProfile ? 'Edit Your Profile' : 'Create Your Profile'}\n              </h3>\n              <form onSubmit={handleSubmit} className=\"space-y-4\">\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div>\n                    <label className=\"block text-sm text-slate-400 mb-1\">City</label>\n                    <input\n                      type=\"text\"\n                      value={formData.city}\n                      onChange={(e) => setFormData({ ...formData, city: e.target.value })}\n                      className=\"w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2\"\n                      placeholder=\"Chicago\"\n                    />\n                  </div>\n                  <div>\n                    <label className=\"block text-sm text-slate-400 mb-1\">State</label>\n                    <select\n                      value={formData.state}\n                      onChange={(e) => setFormData({ ...formData, state: e.target.value })}\n                      className=\"w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2\"\n                    >\n                      <option value=\"\">Select</option>\n                      {states.map(s => <option key={s} value={s}>{s}</option>)}\n                    </select>\n                  </div>\n                </div>\n                \n                <div>\n                  <label className=\"block text-sm text-slate-400 mb-1\">Home Airport (ICAO)</label>\n                  <input\n                    type=\"text\"\n                    value={formData.homeAirport}\n                    onChange={(e) => setFormData({ ...formData, homeAirport: e.target.value.toUpperCase() })}\n                    className=\"w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 uppercase font-mono\"\n                    placeholder=\"KORD\"\n                  />\n                </div>\n                \n                <div>\n                  <label className=\"block text-sm text-slate-400 mb-1\">Experience Level</label>\n                  <select\n                    value={formData.experienceLevel}\n                    onChange={(e) => setFormData({ ...formData, experienceLevel: e.target.value })}\n                    className=\"w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2\"\n                  >\n                    <option value=\"\">Select</option>\n                    {experienceLevels.map(l => <option key={l} value={l}>{l}</option>)}\n                  </select>\n                </div>\n                \n                <div>\n                  <label className=\"block text-sm text-slate-400 mb-1\">Availability</label>\n                  <input\n                    type=\"text\"\n                    value={formData.availability}\n                    onChange={(e) => setFormData({ ...formData, availability: e.target.value })}\n                    className=\"w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2\"\n                    placeholder=\"Weekends, Evenings\"\n                  />\n                </div>\n                \n                <div>\n                  <label className=\"block text-sm text-slate-400 mb-1\">Flight Interests</label>\n                  <div className=\"flex flex-wrap gap-2\">\n                    {interestOptions.map(interest => (\n                      <button\n                        key={interest}\n                        type=\"button\"\n                        onClick={() => {\n                          const current = formData.flightInterests.split(',').map(s => s.trim()).filter(Boolean);\n                          if (current.includes(interest)) {\n                            setFormData({ ...formData, flightInterests: current.filter(i => i !== interest).join(', ') });\n                          } else {\n                            setFormData({ ...formData, flightInterests: [...current, interest].join(', ') });\n                          }\n                        }}\n                        className={`text-xs px-3 py-1 rounded-full ${\n                          formData.flightInterests.includes(interest)\n                            ? 'bg-sky-500 text-white'\n                            : 'bg-slate-700 text-slate-300 hover:bg-slate-600'\n                        }`}\n                      >\n                        {interest}\n                      </button>\n                    ))}\n                  </div>\n                </div>\n                \n                <div>\n                  <label className=\"block text-sm text-slate-400 mb-1\">Bio</label>\n                  <textarea\n                    value={formData.bio}\n                    onChange={(e) => setFormData({ ...formData, bio: e.target.value })}\n                    className=\"w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 h-20\"\n                    placeholder=\"Tell others about yourself...\"\n                  />\n                </div>\n                \n                <div>\n                  <label className=\"block text-sm text-slate-400 mb-1\">Looking For</label>\n                  <input\n                    type=\"text\"\n                    value={formData.lookingFor}\n                    onChange={(e) => setFormData({ ...formData, lookingFor: e.target.value })}\n                    className=\"w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2\"\n                    placeholder=\"Weekend XC partner, IFR currency partner...\"\n                  />\n                </div>\n                \n                <div className=\"flex gap-3 pt-4\">\n                  <button\n                    type=\"button\"\n                    onClick={() => setShowEditForm(false)}\n                    className=\"flex-1 px-4 py-2 bg-slate-700 rounded-lg\"\n                  >\n                    Cancel\n                  </button>\n                  <button\n                    type=\"submit\"\n                    className=\"flex-1 px-4 py-2 bg-sky-500 rounded-lg font-medium\"\n                  >\n                    Save Profile\n                  </button>\n                </div>\n              </form>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\calendar-sync\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'session' is assigned a value but never used.","line":20,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":20,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'generatedLink' is assigned a value but never used.","line":35,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":35,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":53,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":53,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect } from 'react';\nimport { useSession } from 'next-auth/react';\nimport { useRouter } from 'next/navigation';\nimport Link from 'next/link';\n\ninterface FlightEvent {\n  title: string;\n  date: string;\n  time: string;\n  duration: number;\n  routeFrom: string;\n  routeTo: string;\n  aircraft: string;\n  notes: string;\n}\n\nexport default function CalendarSyncPage() {\n  const { data: session, status } = useSession();\n  const router = useRouter();\n  const [userTier, setUserTier] = useState<string | null>(null);\n  const [loadingTier, setLoadingTier] = useState(true);\n  \n  const [flight, setFlight] = useState<FlightEvent>({\n    title: '',\n    date: '',\n    time: '',\n    duration: 1.5,\n    routeFrom: '',\n    routeTo: '',\n    aircraft: '',\n    notes: '',\n  });\n  const [generatedLink, setGeneratedLink] = useState<string | null>(null);\n\n  // Check user tier when session is available\n  useEffect(() => {\n    if (status === 'authenticated') {\n      fetchUserTier();\n    } else if (status === 'unauthenticated') {\n      setLoadingTier(false);\n    }\n  }, [status]);\n\n  const fetchUserTier = async () => {\n    try {\n      const res = await fetch('/api/user/tier');\n      if (res.ok) {\n        const data = await res.json();\n        setUserTier(data.tier);\n      }\n    } catch (err) {\n      console.error('Failed to fetch tier');\n    } finally {\n      setLoadingTier(false);\n    }\n  };\n\n  const isProPlus = userTier === 'proplus' || userTier === 'pro';\n\n  const generateGoogleCalendarLink = () => {\n    const startDate = new Date(`${flight.date}T${flight.time}`);\n    const endDate = new Date(startDate.getTime() + flight.duration * 60 * 60 * 1000);\n\n    const formatDate = (date: Date) => {\n      return date.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';\n    };\n\n    const title = flight.title || `Flight: ${flight.routeFrom} â†’ ${flight.routeTo}`;\n    const description = `\nAircraft: ${flight.aircraft}\nRoute: ${flight.routeFrom} â†’ ${flight.routeTo}\nDuration: ${flight.duration} hours\n\n${flight.notes}\n    `.trim();\n\n    const params = new URLSearchParams({\n      action: 'TEMPLATE',\n      text: title,\n      dates: `${formatDate(startDate)}/${formatDate(endDate)}`,\n      details: description,\n    });\n\n    const link = `https://calendar.google.com/calendar/render?${params.toString()}`;\n    setGeneratedLink(link);\n    window.open(link, '_blank');\n  };\n\n  const generateICSFile = () => {\n    const startDate = new Date(`${flight.date}T${flight.time}`);\n    const endDate = new Date(startDate.getTime() + flight.duration * 60 * 60 * 1000);\n\n    const formatICSDate = (date: Date) => {\n      return date.toISOString().replace(/[-:]/g, '').split('.')[0];\n    };\n\n    const title = flight.title || `Flight: ${flight.routeFrom} â†’ ${flight.routeTo}`;\n    const description = `Aircraft: ${flight.aircraft}\\\\nRoute: ${flight.routeFrom} â†’ ${flight.routeTo}\\\\nDuration: ${flight.duration} hours\\\\n\\\\n${flight.notes}`;\n\n    const icsContent = `BEGIN:VCALENDAR\nVERSION:2.0\nBEGIN:VEVENT\nDTSTART:${formatICSDate(startDate)}\nDTEND:${formatICSDate(endDate)}\nSUMMARY:${title}\nDESCRIPTION:${description}\nEND:VEVENT\nEND:VCALENDAR`;\n\n    const blob = new Blob([icsContent], { type: 'text/calendar' });\n    const url = window.URL.createObjectURL(blob);\n    const link = document.createElement('a');\n    link.href = url;\n    link.download = `flight-${flight.routeFrom}-${flight.routeTo}.ics`;\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n    window.URL.revokeObjectURL(url);\n  };\n\n  if (status === 'loading' || loadingTier) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <div className=\"text-muted-foreground\">Loading...</div>\n      </div>\n    );\n  }\n\n  // Redirect to login if not authenticated\n  if (status === 'unauthenticated') {\n    router.push('/login');\n    return null;\n  }\n\n  // Show upgrade prompt for non-Pro+ users\n  if (!isProPlus) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center p-4\">\n        <div className=\"max-w-md w-full bg-card border border-border rounded-xl p-8 text-center\">\n          <div className=\"text-5xl mb-4\">ðŸ“…</div>\n          <h1 className=\"text-2xl font-bold text-foreground mb-2\">Calendar Sync</h1>\n          <p className=\"text-muted-foreground mb-6\">\n            Add your flights to Google or Apple Calendar to keep your schedule organized.\n          </p>\n          \n          <div className=\"bg-amber-50 border border-amber-200 rounded-lg p-4 mb-6\">\n            <p className=\"text-amber-700 font-medium mb-2\">ðŸ”’ Pro+ Feature</p>\n            <p className=\"text-muted-foreground text-sm\">\n              Calendar Sync is available exclusively for Pro+ subscribers. \n              Upgrade to unlock this feature and more!\n            </p>\n          </div>\n\n          <div className=\"space-y-3\">\n            <Link\n              href=\"/pricing\"\n              className=\"block w-full bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-lg transition-colors\"\n            >\n              View Pro+ Plans\n            </Link>\n            <Link\n              href=\"/dashboard\"\n              className=\"block w-full bg-muted hover:bg-muted/80 text-foreground font-medium py-3 px-4 rounded-lg transition-colors\"\n            >\n              Back to Dashboard\n            </Link>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background p-4 md:p-8\">\n      <div className=\"max-w-2xl mx-auto\">\n        {/* Header */}\n        <div className=\"mb-8\">\n          <h1 className=\"text-2xl font-bold text-foreground\">ðŸ“… Calendar Sync</h1>\n          <p className=\"text-muted-foreground\">Add your flights to Google or Apple Calendar</p>\n        </div>\n\n        {/* Form */}\n        <div className=\"bg-card border border-border rounded-xl p-6 mb-6\">\n          <h2 className=\"text-lg font-semibold text-foreground mb-4\">Flight Details</h2>\n          \n          <div className=\"space-y-4\">\n            <div>\n              <label className=\"block text-sm text-muted-foreground mb-1\">Flight Title (optional)</label>\n              <input\n                type=\"text\"\n                value={flight.title}\n                onChange={(e) => setFlight({...flight, title: e.target.value})}\n                placeholder=\"Cross Country Training\"\n                className=\"w-full bg-background border border-border rounded-lg px-4 py-2 text-foreground\"\n              />\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <label className=\"block text-sm text-muted-foreground mb-1\">Date</label>\n                <input\n                  type=\"date\"\n                  value={flight.date}\n                  onChange={(e) => setFlight({...flight, date: e.target.value})}\n                  className=\"w-full bg-background border border-border rounded-lg px-4 py-2 text-foreground\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm text-muted-foreground mb-1\">Time</label>\n                <input\n                  type=\"time\"\n                  value={flight.time}\n                  onChange={(e) => setFlight({...flight, time: e.target.value})}\n                  className=\"w-full bg-background border border-border rounded-lg px-4 py-2 text-foreground\"\n                />\n              </div>\n            </div>\n\n            <div className=\"grid grid-cols-3 gap-4\">\n              <div>\n                <label className=\"block text-sm text-muted-foreground mb-1\">From</label>\n                <input\n                  type=\"text\"\n                  value={flight.routeFrom}\n                  onChange={(e) => setFlight({...flight, routeFrom: e.target.value.toUpperCase()})}\n                  placeholder=\"KABC\"\n                  className=\"w-full bg-background border border-border rounded-lg px-4 py-2 text-foreground uppercase\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm text-muted-foreground mb-1\">To</label>\n                <input\n                  type=\"text\"\n                  value={flight.routeTo}\n                  onChange={(e) => setFlight({...flight, routeTo: e.target.value.toUpperCase()})}\n                  placeholder=\"KXYZ\"\n                  className=\"w-full bg-background border border-border rounded-lg px-4 py-2 text-foreground uppercase\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm text-muted-foreground mb-1\">Duration (hrs)</label>\n                <input\n                  type=\"number\"\n                  step=\"0.5\"\n                  value={flight.duration}\n                  onChange={(e) => setFlight({...flight, duration: parseFloat(e.target.value) || 0})}\n                  className=\"w-full bg-background border border-border rounded-lg px-4 py-2 text-foreground\"\n                />\n              </div>\n            </div>\n\n            <div>\n              <label className=\"block text-sm text-muted-foreground mb-1\">Aircraft</label>\n              <input\n                type=\"text\"\n                value={flight.aircraft}\n                onChange={(e) => setFlight({...flight, aircraft: e.target.value})}\n                placeholder=\"N123AB\"\n                className=\"w-full bg-background border border-border rounded-lg px-4 py-2 text-foreground\"\n              />\n            </div>\n\n            <div>\n              <label className=\"block text-sm text-muted-foreground mb-1\">Notes</label>\n              <textarea\n                value={flight.notes}\n                onChange={(e) => setFlight({...flight, notes: e.target.value})}\n                placeholder=\"Check weather, file flight plan...\"\n                rows={3}\n                className=\"w-full bg-background border border-border rounded-lg px-4 py-2 text-foreground\"\n              />\n            </div>\n          </div>\n        </div>\n\n        {/* Sync Options */}\n        <div className=\"bg-card border border-border rounded-xl p-6\">\n          <h2 className=\"text-lg font-semibold text-foreground mb-4\">Add to Calendar</h2>\n          \n          <div className=\"grid md:grid-cols-2 gap-4\">\n            <button\n              onClick={generateGoogleCalendarLink}\n              disabled={!flight.date || !flight.time}\n              className=\"flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-700 disabled:bg-muted disabled:text-muted-foreground text-white px-6 py-3 rounded-lg transition\"\n            >\n              <svg className=\"w-5 h-5\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n                <path d=\"M19 4h-1V2h-2v2H8V2H6v2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z\"/>\n              </svg>\n              Google Calendar\n            </button>\n\n            <button\n              onClick={generateICSFile}\n              disabled={!flight.date || !flight.time}\n              className=\"flex items-center justify-center gap-2 bg-muted hover:bg-muted/80 disabled:bg-muted disabled:text-muted-foreground text-foreground px-6 py-3 rounded-lg transition\"\n            >\n              <svg className=\"w-5 h-5\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n                <path d=\"M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM9 10H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm-8 4H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2z\"/>\n              </svg>\n              Apple/Outlook (.ics)\n            </button>\n          </div>\n\n          {(!flight.date || !flight.time) && (\n            <p className=\"text-amber-600 text-sm mt-4 text-center\">\n              Please fill in date and time to add to calendar\n            </p>\n          )}\n        </div>\n\n        {/* Instructions */}\n        <div className=\"mt-6 bg-muted/50 rounded-xl p-6\">\n          <h3 className=\"text-sm font-semibold text-foreground mb-2\">How it works</h3>\n          <ul className=\"text-sm text-muted-foreground space-y-2\">\n            <li>â€¢ <strong>Google Calendar</strong> - Opens Google Calendar in a new tab with pre-filled event details</li>\n            <li>â€¢ <strong>Apple/Outlook</strong> - Downloads an .ics file you can open in any calendar app</li>\n            <li>â€¢ Flight events include route, aircraft, duration, and your notes</li>\n          </ul>\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\e6b\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardHeader' is defined but never used.","line":11,"column":29,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":39,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"CardHeader"},"fix":{"range":[327,339],"text":""},"desc":"Remove unused variable \"CardHeader\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardTitle' is defined but never used.","line":11,"column":41,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":50,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"CardTitle"},"fix":{"range":[339,350],"text":""},"desc":"Remove unused variable \"CardTitle\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardDescription' is defined but never used.","line":11,"column":52,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":67,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"CardDescription"},"fix":{"range":[350,367],"text":""},"desc":"Remove unused variable \"CardDescription\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * @fileoverview E6B Flight Computer module\n * @description Aviation E6B calculator with wind correction, fuel, TAS, and conversions\n * @module modules/e6b\n */\n\n'use client'\n\nimport { useState } from 'react'\nimport { Calculator, Wind, Fuel, Gauge, ArrowRightLeft, HelpCircle } from 'lucide-react'\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card'\nimport { Input } from '@/components/ui/input'\nimport { Label } from '@/components/ui/label'\nimport { Button } from '@/components/ui/button'\nimport { Separator } from '@/components/ui/separator'\n\n/**\n * E6B Calculator modes\n */\ntype E6BMode = 'wind' | 'fuel' | 'speed' | 'convert'\n\n/**\n * Wind calculation result\n */\ninterface WindResult {\n  gs: number\n  track: number\n  correction: number\n}\n\n/**\n * Fuel calculation result\n */\ninterface FuelResult {\n  fuel: number\n  endurance: number\n}\n\n/**\n * E6B Flight Computer Page\n * Provides wind correction, fuel burn, true airspeed, and unit conversions\n */\nexport default function E6BPage() {\n  const [mode, setMode] = useState<E6BMode>('wind')\n  \n  // Wind components\n  const [tas, setTas] = useState(120)\n  const [heading, setHeading] = useState(360)\n  const [windDir, setWindDir] = useState(270)\n  const [windSpeed, setWindSpeed] = useState(15)\n  const [windResult, setWindResult] = useState<WindResult | null>(null)\n  \n  // Fuel\n  const [fuelBurn, setFuelBurn] = useState(8.5)\n  const [flightTime, setFlightTime] = useState(2.5)\n  const [fuelResult, setFuelResult] = useState<FuelResult | null>(null)\n  \n  // Speed\n  const [ias, setIas] = useState(100)\n  const [altitude, setAltitude] = useState(6500)\n  const [temp, setTemp] = useState(15)\n  const [tasResult, setTasResult] = useState<number | null>(null)\n  \n  // Conversions\n  const [convertFrom, setConvertFrom] = useState('nm')\n  const [convertValue, setConvertValue] = useState(100)\n  const [convertResult, setConvertResult] = useState<Record<string, number> | null>(null)\n\n  // Calculate wind correction\n  const calculateWind = () => {\n    const headingRad = (heading * Math.PI) / 180\n    const windRad = (windDir * Math.PI) / 180\n    \n    const windFrom = windRad + Math.PI\n    const wx = windSpeed * Math.cos(windFrom)\n    const wy = windSpeed * Math.sin(windFrom)\n    \n    const gsx = tas * Math.cos(headingRad) - wx\n    const gsy = tas * Math.sin(headingRad) - wy\n    \n    const gs = Math.sqrt(gsx * gsx + gsy * gsy)\n    const track = ((Math.atan2(gsy, gsx) * 180) / Math.PI + 360) % 360\n    const correction = track - heading\n    \n    setWindResult({ gs: Math.round(gs), track: Math.round(track), correction: Math.round(correction) })\n  }\n\n  // Calculate fuel\n  const calculateFuel = () => {\n    const fuel = fuelBurn * flightTime\n    const endurance = 48 / fuelBurn // Assuming 48 gal usable\n    setFuelResult({ fuel: Math.round(fuel * 10) / 10, endurance: Math.round(endurance * 10) / 10 })\n  }\n\n  // Calculate TAS from IAS\n  const calculateTAS = () => {\n    const isaTemp = 15 - (altitude / 1000) * 2\n    const oat = temp || isaTemp\n    const deltaT = oat - isaTemp\n    const mach = ias / 661.47\n    const tas = Math.round(ias * (1 + 0.2 * Math.pow(mach, 2) + deltaT * 0.004))\n    setTasResult(tas)\n  }\n\n  // Unit conversions\n  const calculateConversions = () => {\n    const v = convertValue\n    const results: Record<string, number> = {}\n    \n    if (convertFrom === 'nm') {\n      results['NM'] = v\n      results['SM'] = Math.round(v * 1.15078)\n      results['KM'] = Math.round(v * 1.852)\n      results['MI'] = Math.round(v * 1852)\n    } else if (convertFrom === 'sm') {\n      results['NM'] = Math.round(v * 0.868976)\n      results['SM'] = v\n      results['KM'] = Math.round(v * 1.60934)\n      results['MI'] = v * 1609.34\n    } else if (convertFrom === 'gal') {\n      results['Gal'] = v\n      results['L'] = Math.round(v * 3.78541)\n      results['Lbs'] = Math.round(v * 6)\n    } else if (convertFrom === 'lbs') {\n      results['Lbs'] = v\n      results['Kg'] = Math.round(v * 0.453592)\n      results['Gal'] = Math.round(v / 6 * 10) / 10\n    } else if (convertFrom === 'f') {\n      results['Â°F'] = v\n      results['Â°C'] = Math.round((v - 32) * 5 / 9)\n      results['K'] = Math.round((v - 32) * 5 / 9 + 273.15)\n    } else if (convertFrom === 'ft') {\n      results['ft'] = v\n      results['m'] = Math.round(v * 0.3048)\n      results['FL'] = Math.round(v / 100)\n    }\n    \n    setConvertResult(results)\n  }\n\n  // Mode tabs configuration\n  const modes = [\n    { id: 'wind', label: 'Wind', icon: Wind },\n    { id: 'fuel', label: 'Fuel', icon: Fuel },\n    { id: 'speed', label: 'TAS', icon: Gauge },\n    { id: 'convert', label: 'Convert', icon: ArrowRightLeft },\n  ]\n\n  return (\n    <div className=\"min-h-screen bg-background p-4\">\n      <div className=\"max-w-md mx-auto\">\n        {/* Header */}\n        <div className=\"text-center mb-6\">\n          <div className=\"inline-flex items-center justify-center w-12 h-12 rounded-xl bg-primary/10 mb-3\">\n            <Calculator className=\"w-6 h-6 text-primary\" />\n          </div>\n          <h1 className=\"text-2xl font-bold text-foreground\">E6B Flight Computer</h1>\n          <p className=\"text-muted-foreground text-sm mt-1\">\n            Essential aviation calculations\n          </p>\n        </div>\n\n        {/* Mode Tabs */}\n        <div className=\"flex gap-2 mb-4\">\n          {modes.map((m) => (\n            <button\n              key={m.id}\n              onClick={() => setMode(m.id as E6BMode)}\n              className={`flex-1 flex items-center justify-center gap-2 py-2 px-3 rounded-lg text-sm font-medium transition-colors ${\n                mode === m.id \n                  ? 'bg-primary text-primary-foreground' \n                  : 'bg-card border border-border text-muted-foreground hover:text-foreground hover:bg-muted'\n              }`}\n            >\n              <m.icon className=\"w-4 h-4\" />\n              {m.label}\n            </button>\n          ))}\n        </div>\n\n        <Card>\n          <CardContent className=\"p-4 space-y-4\">\n            {/* Wind Mode */}\n            {mode === 'wind' && (\n              <>\n                <div className=\"space-y-3\">\n                  <div>\n                    <Label htmlFor=\"tas\" className=\"text-xs\">True Airspeed (kts)</Label>\n                    <Input\n                      id=\"tas\"\n                      type=\"number\"\n                      value={tas}\n                      onChange={(e) => setTas(Number(e.target.value))}\n                      className=\"mt-1\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"heading\" className=\"text-xs\">Heading (Â°)</Label>\n                    <Input\n                      id=\"heading\"\n                      type=\"number\"\n                      value={heading}\n                      onChange={(e) => setHeading(Number(e.target.value))}\n                      className=\"mt-1\"\n                    />\n                  </div>\n                  <div className=\"grid grid-cols-2 gap-3\">\n                    <div>\n                      <Label htmlFor=\"windDir\" className=\"text-xs\">Wind From (Â°)</Label>\n                      <Input\n                        id=\"windDir\"\n                        type=\"number\"\n                        value={windDir}\n                        onChange={(e) => setWindDir(Number(e.target.value))}\n                        className=\"mt-1\"\n                      />\n                    </div>\n                    <div>\n                      <Label htmlFor=\"windSpeed\" className=\"text-xs\">Wind Speed (kts)</Label>\n                      <Input\n                        id=\"windSpeed\"\n                        type=\"number\"\n                        value={windSpeed}\n                        onChange={(e) => setWindSpeed(Number(e.target.value))}\n                        className=\"mt-1\"\n                      />\n                    </div>\n                  </div>\n                </div>\n                <Button onClick={calculateWind} className=\"w-full\">\n                  Calculate\n                </Button>\n                {windResult && (\n                  <div className=\"bg-muted rounded-lg p-3 space-y-2\">\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-muted-foreground\">Ground Speed:</span>\n                      <span className=\"font-bold\">{windResult.gs} kts</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-muted-foreground\">Track:</span>\n                      <span className=\"font-bold\">{windResult.track}Â°</span>\n                    </div>\n                    <Separator />\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-muted-foreground\">Wind Correction:</span>\n                      <span className={`font-bold ${windResult.correction > 0 ? 'text-amber-600' : 'text-blue-600'}`}>\n                        {windResult.correction > 0 ? '+' : ''}{windResult.correction}Â°\n                      </span>\n                    </div>\n                  </div>\n                )}\n              </>\n            )}\n\n            {/* Fuel Mode */}\n            {mode === 'fuel' && (\n              <>\n                <div className=\"grid grid-cols-2 gap-3\">\n                  <div>\n                    <Label htmlFor=\"fuelBurn\" className=\"text-xs\">Fuel Burn (gph)</Label>\n                    <Input\n                      id=\"fuelBurn\"\n                      type=\"number\"\n                      step=\"0.1\"\n                      value={fuelBurn}\n                      onChange={(e) => setFuelBurn(Number(e.target.value))}\n                      className=\"mt-1\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"flightTime\" className=\"text-xs\">Flight Time (hrs)</Label>\n                    <Input\n                      id=\"flightTime\"\n                      type=\"number\"\n                      step=\"0.1\"\n                      value={flightTime}\n                      onChange={(e) => setFlightTime(Number(e.target.value))}\n                      className=\"mt-1\"\n                    />\n                  </div>\n                </div>\n                <Button onClick={calculateFuel} className=\"w-full\">\n                  Calculate\n                </Button>\n                {fuelResult && (\n                  <div className=\"bg-muted rounded-lg p-3 space-y-2\">\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-muted-foreground\">Fuel Required:</span>\n                      <span className=\"font-bold\">{fuelResult.fuel} gal</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-muted-foreground\">Endurance:</span>\n                      <span className=\"font-bold\">{fuelResult.endurance} hrs</span>\n                    </div>\n                  </div>\n                )}\n              </>\n            )}\n\n            {/* Speed Mode (TAS) */}\n            {mode === 'speed' && (\n              <>\n                <div className=\"grid grid-cols-3 gap-3\">\n                  <div>\n                    <Label htmlFor=\"ias\" className=\"text-xs\">IAS (kts)</Label>\n                    <Input\n                      id=\"ias\"\n                      type=\"number\"\n                      value={ias}\n                      onChange={(e) => setIas(Number(e.target.value))}\n                      className=\"mt-1\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"altitude\" className=\"text-xs\">Altitude (ft)</Label>\n                    <Input\n                      id=\"altitude\"\n                      type=\"number\"\n                      value={altitude}\n                      onChange={(e) => setAltitude(Number(e.target.value))}\n                      className=\"mt-1\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"temp\" className=\"text-xs\">Temp (Â°C)</Label>\n                    <Input\n                      id=\"temp\"\n                      type=\"number\"\n                      value={temp}\n                      onChange={(e) => setTemp(Number(e.target.value))}\n                      className=\"mt-1\"\n                    />\n                  </div>\n                </div>\n                <Button onClick={calculateTAS} className=\"w-full\">\n                  Calculate TAS\n                </Button>\n                {tasResult !== null && (\n                  <div className=\"bg-muted rounded-lg p-4 text-center\">\n                    <div className=\"text-sm text-muted-foreground\">True Airspeed</div>\n                    <div className=\"text-3xl font-bold text-primary\">{tasResult} kts</div>\n                  </div>\n                )}\n              </>\n            )}\n\n            {/* Convert Mode */}\n            {mode === 'convert' && (\n              <>\n                <div className=\"space-y-3\">\n                  <div>\n                    <Label htmlFor=\"convertType\" className=\"text-xs\">Convert From</Label>\n                    <select\n                      id=\"convertType\"\n                      value={convertFrom}\n                      onChange={(e) => setConvertFrom(e.target.value)}\n                      className=\"w-full mt-1 h-10 rounded-md border border-input bg-background px-3 text-sm\"\n                    >\n                      <option value=\"nm\">Nautical Miles</option>\n                      <option value=\"sm\">Statute Miles</option>\n                      <option value=\"gal\">Gallons</option>\n                      <option value=\"lbs\">Pounds</option>\n                      <option value=\"f\">Fahrenheit</option>\n                      <option value=\"ft\">Feet</option>\n                    </select>\n                  </div>\n                  <div>\n                    <Label htmlFor=\"convertValue\" className=\"text-xs\">Value</Label>\n                    <Input\n                      id=\"convertValue\"\n                      type=\"number\"\n                      value={convertValue}\n                      onChange={(e) => setConvertValue(Number(e.target.value))}\n                      className=\"mt-1\"\n                    />\n                  </div>\n                </div>\n                <Button onClick={calculateConversions} className=\"w-full\">\n                  Convert\n                </Button>\n                {convertResult && (\n                  <div className=\"bg-muted rounded-lg p-3 space-y-2\">\n                    {Object.entries(convertResult).map(([key, val]) => (\n                      <div key={key} className=\"flex justify-between\">\n                        <span className=\"text-muted-foreground\">{key}:</span>\n                        <span className=\"font-bold\">{val}</span>\n                      </div>\n                    ))}\n                  </div>\n                )}\n              </>\n            )}\n          </CardContent>\n        </Card>\n        \n        {/* Footer */}\n        <div className=\"mt-6 text-center text-xs text-muted-foreground flex items-center justify-center gap-2\">\n          <HelpCircle className=\"w-3 h-3\" />\n          Full E6B functionality for pilots\n        </div>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\engine-health\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Input' is defined but never used.","line":7,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":15,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Input"},"fix":{"range":[256,302],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrendingUp' is defined but never used.","line":19,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":13,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"TrendingUp"},"fix":{"range":[637,651],"text":""},"desc":"Remove unused variable \"TrendingUp\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrendingDown' is defined but never used.","line":20,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":20,"endColumn":15,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"TrendingDown"},"fix":{"range":[651,667],"text":""},"desc":"Remove unused variable \"TrendingDown\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Minus' is defined but never used.","line":21,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":8,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Minus"},"fix":{"range":[667,676],"text":""},"desc":"Remove unused variable \"Minus\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Eye' is defined but never used.","line":23,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":23,"endColumn":6,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Eye"},"fix":{"range":[689,696],"text":""},"desc":"Remove unused variable \"Eye\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":59,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1624,1627],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1624,1627],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect, useRef } from 'react'\nimport { useSession } from 'next-auth/react'\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Label } from '@/components/ui/label'\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'\nimport { Badge } from '@/components/ui/badge'\nimport { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert'\nimport { \n  Upload, \n  FileText, \n  AlertTriangle, \n  CheckCircle, \n  Activity,\n  Plane,\n  TrendingUp,\n  TrendingDown,\n  Minus,\n  RefreshCw,\n  Eye,\n  X,\n  UploadCloud,\n  AlertCircle,\n  Info\n} from 'lucide-react'\n\ninterface Anomaly {\n  id: string\n  aircraftId: string\n  type: string\n  severity: 'CRITICAL' | 'WARNING' | 'INFO'\n  value: number\n  threshold: number\n  message: string\n  flightDate: string\n  acknowledged: boolean\n  createdAt: string\n}\n\ninterface UploadRecord {\n  id: string\n  aircraftId: string\n  fileName: string\n  fileType: string\n  uploadDate: string\n}\n\nexport default function EngineHealthPage() {\n  const { data: session, status } = useSession()\n  const [loading, setLoading] = useState(true)\n  const [uploading, setUploading] = useState(false)\n  const [selectedAircraft, setSelectedAircraft] = useState('')\n  const [anomalies, setAnomalies] = useState<Anomaly[]>([])\n  const [uploads, setUploads] = useState<UploadRecord[]>([])\n  const [counts, setCounts] = useState({ critical: 0, warning: 0, info: 0 })\n  const [uploadResult, setUploadResult] = useState<any>(null)\n  const fileInputRef = useRef<HTMLInputElement>(null)\n\n  // Demo aircraft - in real app would fetch from user's aircraft\n  const aircraftList = [\n    { id: '1', nNumber: 'N12345', nickname: 'Cessna 172' },\n    { id: '2', nNumber: 'N54321', nickname: 'Piper Archer' },\n  ]\n\n  useEffect(() => {\n    if (session) {\n      fetchData()\n    } else {\n      setLoading(false)\n    }\n  }, [session])\n\n  const fetchData = async () => {\n    try {\n      // Fetch anomalies\n      const anomalyRes = await fetch('/api/engine/anomalies')\n      if (anomalyRes.ok) {\n        const anomalyData = await anomalyRes.json()\n        setAnomalies(anomalyData.anomalies || [])\n        setCounts(anomalyData.counts || { critical: 0, warning: 0, info: 0 })\n      }\n\n      // Fetch uploads\n      const uploadRes = await fetch('/api/engine/upload')\n      if (uploadRes.ok) {\n        const uploadData = await uploadRes.json()\n        setUploads(uploadData || [])\n      }\n    } catch (error) {\n      console.error('Error fetching data:', error)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleFileUpload = async (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0]\n    if (!file || !selectedAircraft) {\n      alert('Please select an aircraft first')\n      return\n    }\n\n    setUploading(true)\n    setUploadResult(null)\n\n    try {\n      const formData = new FormData()\n      formData.append('file', file)\n      formData.append('aircraftId', selectedAircraft)\n\n      const res = await fetch('/api/engine/upload', {\n        method: 'POST',\n        body: formData,\n      })\n\n      const result = await res.json()\n      setUploadResult(result)\n\n      if (result.success) {\n        fetchData()\n      }\n    } catch (error) {\n      console.error('Upload error:', error)\n      setUploadResult({ error: 'Upload failed' })\n    } finally {\n      setUploading(false)\n    }\n  }\n\n  const acknowledgeAnomaly = async (anomalyId: string) => {\n    try {\n      await fetch('/api/engine/anomalies', {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ anomalyId, acknowledge: true }),\n      })\n      fetchData()\n    } catch (error) {\n      console.error('Error acknowledging:', error)\n    }\n  }\n\n  const getSeverityColor = (severity: string) => {\n    switch (severity) {\n      case 'CRITICAL': return 'bg-red-500'\n      case 'WARNING': return 'bg-amber-500'\n      default: return 'bg-blue-500'\n    }\n  }\n\n  const getSeverityIcon = (severity: string) => {\n    switch (severity) {\n      case 'CRITICAL': return <AlertTriangle className=\"h-4 w-4 text-red-500\" />\n      case 'WARNING': return <AlertCircle className=\"h-4 w-4 text-amber-500\" />\n      default: return <Info className=\"h-4 w-4 text-blue-500\" />\n    }\n  }\n\n  if (status === 'loading' || loading) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <RefreshCw className=\"h-8 w-8 animate-spin text-primary\" />\n      </div>\n    )\n  }\n\n  if (!session) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center p-4\">\n        <Card className=\"max-w-md w-full\">\n          <CardContent className=\"pt-6 text-center\">\n            <Plane className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground\" />\n            <h2 className=\"text-xl font-bold mb-2\">Engine Health Monitoring</h2>\n            <p className=\"text-muted-foreground mb-4\">\n              Sign in to upload engine monitor data and track engine health\n            </p>\n            <Button asChild>\n              <a href=\"/login\">Sign In</a>\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background p-4 md:p-8\">\n      <div className=\"max-w-7xl mx-auto space-y-6\">\n        \n        {/* Header */}\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold flex items-center gap-2\">\n              <Activity className=\"h-8 w-8\" />\n              Engine Health Monitoring\n            </h1>\n            <p className=\"text-muted-foreground\">\n              Upload engine monitor data to detect anomalies and track engine health\n            </p>\n          </div>\n          <Button variant=\"outline\" onClick={fetchData}>\n            <RefreshCw className=\"h-4 w-4 mr-2\" />\n            Refresh\n          </Button>\n        </div>\n\n        {/* Summary Cards */}\n        <div className=\"grid gap-4 md:grid-cols-4\">\n          <Card>\n            <CardContent className=\"pt-4\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Total Flights</p>\n                  <p className=\"text-2xl font-bold\">{uploads.length}</p>\n                </div>\n                <FileText className=\"h-8 w-8 text-muted-foreground\" />\n              </div>\n            </CardContent>\n          </Card>\n          \n          <Card className=\"border-red-500/50\">\n            <CardContent className=\"pt-4\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Critical</p>\n                  <p className=\"text-2xl font-bold text-red-500\">{counts.critical}</p>\n                </div>\n                <AlertTriangle className=\"h-8 w-8 text-red-500\" />\n              </div>\n            </CardContent>\n          </Card>\n          \n          <Card className=\"border-amber-500/50\">\n            <CardContent className=\"pt-4\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Warnings</p>\n                  <p className=\"text-2xl font-bold text-amber-500\">{counts.warning}</p>\n                </div>\n                <AlertCircle className=\"h-8 w-8 text-amber-500\" />\n              </div>\n            </CardContent>\n          </Card>\n          \n          <Card>\n            <CardContent className=\"pt-4\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Info</p>\n                  <p className=\"text-2xl font-bold text-blue-500\">{counts.info}</p>\n                </div>\n                <Info className=\"h-8 w-8 text-blue-500\" />\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        <Tabs defaultValue=\"upload\" className=\"w-full\">\n          <TabsList>\n            <TabsTrigger value=\"upload\">Upload Data</TabsTrigger>\n            <TabsTrigger value=\"anomalies\">Anomalies ({anomalies.length})</TabsTrigger>\n            <TabsTrigger value=\"uploads\">Upload History</TabsTrigger>\n          </TabsList>\n\n          {/* Upload Tab */}\n          <TabsContent value=\"upload\" className=\"space-y-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <UploadCloud className=\"h-5 w-5\" />\n                  Upload Engine Data\n                </CardTitle>\n                <CardDescription>\n                  Upload engine monitor data from JPI, Garmin G1000, or CSV files\n                </CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"grid gap-4 md:grid-cols-2\">\n                  <div>\n                    <Label htmlFor=\"aircraft\">Select Aircraft</Label>\n                    <select\n                      id=\"aircraft\"\n                      className=\"w-full mt-1 p-2 border rounded-md bg-background\"\n                      value={selectedAircraft}\n                      onChange={(e) => setSelectedAircraft(e.target.value)}\n                    >\n                      <option value=\"\">Choose aircraft...</option>\n                      {aircraftList.map((ac) => (\n                        <option key={ac.id} value={ac.id}>\n                          {ac.nNumber} - {ac.nickname}\n                        </option>\n                      ))}\n                    </select>\n                  </div>\n                  \n                  <div>\n                    <Label>Upload File</Label>\n                    <input\n                      ref={fileInputRef}\n                      type=\"file\"\n                      accept=\".csv,.txt,.dat\"\n                      className=\"w-full mt-1 p-2 border rounded-md bg-background\"\n                      onChange={handleFileUpload}\n                      disabled={uploading || !selectedAircraft}\n                    />\n                  </div>\n                </div>\n\n                {uploading && (\n                  <div className=\"flex items-center gap-2 text-muted-foreground\">\n                    <RefreshCw className=\"h-4 w-4 animate-spin\" />\n                    Processing uploaded data...\n                  </div>\n                )}\n\n                {uploadResult && (\n                  <Alert variant={uploadResult.success ? 'default' : 'destructive'}>\n                    {uploadResult.success ? (\n                      <CheckCircle className=\"h-4 w-4\" />\n                    ) : (\n                      <AlertCircle className=\"h-4 w-4\" />\n                    )}\n                    <AlertTitle>\n                      {uploadResult.success ? 'Upload Successful' : 'Upload Failed'}\n                    </AlertTitle>\n                    <AlertDescription>\n                      {uploadResult.success ? (\n                        <>\n                          Processed {uploadResult.flightsProcessed} flights. Found {uploadResult.anomaliesFound} anomalies.\n                        </>\n                      ) : (\n                        uploadResult.error\n                      )}\n                    </AlertDescription>\n                  </Alert>\n                )}\n\n                <div className=\"text-sm text-muted-foreground\">\n                  <p className=\"font-medium\">Supported formats:</p>\n                  <ul className=\"list-disc list-inside mt-1 space-y-1\">\n                    <li>JPI EDM (.csv, .txt, .dat)</li>\n                    <li>Garmin G1000 CSV exports</li>\n                    <li>Generic CSV with columns: Date, CHT, EGT, Fuel Flow, Oil Temp, Oil Pressure</li>\n                  </ul>\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          {/* Anomalies Tab */}\n          <TabsContent value=\"anomalies\" className=\"space-y-4\">\n            {anomalies.length === 0 ? (\n              <Card>\n                <CardContent className=\"pt-6 text-center\">\n                  <CheckCircle className=\"h-12 w-12 mx-auto mb-4 text-green-500\" />\n                  <h3 className=\"text-lg font-medium\">No Anomalies Detected</h3>\n                  <p className=\"text-muted-foreground\">\n                    Your engine data looks healthy. Upload more data to continue monitoring.\n                  </p>\n                </CardContent>\n              </Card>\n            ) : (\n              <div className=\"space-y-3\">\n                {anomalies.map((anomaly) => (\n                  <Card key={anomaly.id} className={`\n                    ${anomaly.severity === 'CRITICAL' ? 'border-red-500/50' : ''}\n                    ${anomaly.severity === 'WARNING' ? 'border-amber-500/50' : ''}\n                  `}>\n                    <CardContent className=\"pt-4\">\n                      <div className=\"flex items-start justify-between\">\n                        <div className=\"flex items-start gap-3\">\n                          {getSeverityIcon(anomaly.severity)}\n                          <div>\n                            <div className=\"flex items-center gap-2\">\n                              <span className=\"font-medium\">{anomaly.type.replace(/_/g, ' ')}</span>\n                              <Badge className={getSeverityColor(anomaly.severity)}>\n                                {anomaly.severity}\n                              </Badge>\n                            </div>\n                            <p className=\"text-sm text-muted-foreground mt-1\">\n                              {anomaly.message}\n                            </p>\n                            <p className=\"text-xs text-muted-foreground mt-1\">\n                              Value: {anomaly.value.toFixed(1)} | Threshold: {anomaly.threshold}\n                            </p>\n                          </div>\n                        </div>\n                        \n                        {!anomaly.acknowledged && (\n                          <Button \n                            size=\"sm\" \n                            variant=\"outline\"\n                            onClick={() => acknowledgeAnomaly(anomaly.id)}\n                          >\n                            <X className=\"h-3 w-3 mr-1\" />\n                            Acknowledge\n                          </Button>\n                        )}\n                      </div>\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            )}\n          </TabsContent>\n\n          {/* Uploads Tab */}\n          <TabsContent value=\"uploads\" className=\"space-y-4\">\n            {uploads.length === 0 ? (\n              <Card>\n                <CardContent className=\"pt-6 text-center\">\n                  <Upload className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground\" />\n                  <h3 className=\"text-lg font-medium\">No Uploads Yet</h3>\n                  <p className=\"text-muted-foreground\">\n                    Upload your first engine monitor data file to get started.\n                  </p>\n                </CardContent>\n              </Card>\n            ) : (\n              <Card>\n                <CardContent className=\"pt-4\">\n                  <div className=\"space-y-3\">\n                    {uploads.map((upload) => (\n                      <div \n                        key={upload.id}\n                        className=\"flex items-center justify-between p-3 bg-muted/50 rounded-lg\"\n                      >\n                        <div className=\"flex items-center gap-3\">\n                          <FileText className=\"h-5 w-5 text-muted-foreground\" />\n                          <div>\n                            <p className=\"font-medium\">{upload.fileName}</p>\n                            <p className=\"text-sm text-muted-foreground\">\n                              {upload.fileType} â€¢ {new Date(upload.uploadDate).toLocaleDateString()}\n                            </p>\n                          </div>\n                        </div>\n                        <Badge variant=\"outline\">{upload.fileType}</Badge>\n                      </div>\n                    ))}\n                  </div>\n                </CardContent>\n              </Card>\n            )}\n          </TabsContent>\n        </Tabs>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\flight-playback\\FlightPlaybackMap.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useState' is defined but never used.","line":3,"column":29,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":37,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"useState"},"fix":{"range":[41,51],"text":""},"desc":"Remove unused variable \"useState\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useEffect, useRef, useState } from 'react';\nimport L from 'leaflet';\nimport 'leaflet/dist/leaflet.css';\n\n// Fix Leaflet default icons\nimport icon from 'leaflet/dist/images/marker-icon.png';\nimport iconShadow from 'leaflet/dist/images/marker-shadow.png';\n\nconst DefaultIcon = L.icon({\n  iconUrl: icon.src,\n  shadowUrl: iconShadow.src,\n  iconSize: [25, 41],\n  iconAnchor: [12, 41]\n});\n\nL.Marker.prototype.options.icon = DefaultIcon;\n\ninterface TrackPoint {\n  lat: number;\n  lng: number;\n  alt?: number;\n  speed?: number;\n  timestamp: string;\n}\n\ninterface FlightPlaybackMapProps {\n  points: TrackPoint[];\n  playing: boolean;\n  currentPointIndex: number;\n  onPlaybackEnd: () => void;\n  onIndexChange: (index: number) => void;\n}\n\nexport default function FlightPlaybackMap({ \n  points, \n  playing, \n  currentPointIndex, \n  onPlaybackEnd,\n  onIndexChange \n}: FlightPlaybackMapProps) {\n  const mapRef = useRef<L.Map | null>(null);\n  const polylineRef = useRef<L.Polyline | null>(null);\n  const markerRef = useRef<L.Marker | null>(null);\n  const animationRef = useRef<NodeJS.Timeout | null>(null);\n\n  // Initialize map\n  useEffect(() => {\n    if (mapRef.current) return;\n\n    const map = L.map('flight-playback-map', {\n      center: [39.8283, -98.5795],\n      zoom: 6,\n      zoomControl: true,\n    });\n\n    mapRef.current = map;\n\n    // Add base map layer (OpenStreetMap)\n    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n      attribution: 'Â© OpenStreetMap contributors',\n      maxZoom: 19,\n    }).addTo(map);\n\n    // Add dark overlay for better visibility\n    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {\n      attribution: 'Â© CartoDB',\n      maxZoom: 19,\n    }).addTo(map);\n\n    return () => {\n      map.remove();\n      if (animationRef.current) {\n        clearInterval(animationRef.current);\n      }\n    };\n  }, []);\n\n  // Draw full track when points change\n  useEffect(() => {\n    if (!mapRef.current || points.length < 2) return;\n\n    // Remove existing polyline\n    if (polylineRef.current) {\n      mapRef.current.removeLayer(polylineRef.current);\n    }\n\n    // Create lat/lng array for the full track\n    const latLngs: L.LatLngExpression[] = points.map(p => [p.lat, p.lng]);\n\n    // Draw the full track path (gray)\n    polylineRef.current = L.polyline(latLngs, {\n      color: '#64748b',\n      weight: 3,\n      opacity: 0.6,\n      dashArray: '5, 10',\n    }).addTo(mapRef.current);\n\n    // Fit map to track bounds\n    const bounds = L.latLngBounds(latLngs);\n    mapRef.current.fitBounds(bounds, { padding: [50, 50] });\n\n    // Add start/end markers\n    const startIcon = L.divIcon({\n      className: 'custom-marker',\n      html: '<div style=\"background:#22c55e;width:16px;height:16px;border-radius:50%;border:2px solid white;\"></div>',\n      iconSize: [16, 16],\n      iconAnchor: [8, 8]\n    });\n\n    const endIcon = L.divIcon({\n      className: 'custom-marker',\n      html: '<div style=\"background:#ef4444;width:16px;height:16px;border-radius:50%;border:2px solid white;\"></div>',\n      iconSize: [16, 16],\n      iconAnchor: [8, 8]\n    });\n\n    L.marker([points[0].lat, points[0].lng], { icon: startIcon })\n      .bindPopup('Start')\n      .addTo(mapRef.current);\n\n    L.marker([points[points.length - 1].lat, points[points.length - 1].lng], { icon: endIcon })\n      .bindPopup('End')\n      .addTo(mapRef.current);\n\n  }, [points]);\n\n  // Update marker position during playback\n  useEffect(() => {\n    if (!mapRef.current || points.length === 0) return;\n\n    // Remove existing marker\n    if (markerRef.current) {\n      mapRef.current.removeLayer(markerRef.current);\n    }\n\n    const point = points[currentPointIndex];\n    if (!point) return;\n\n    // Create plane icon\n    const planeIcon = L.divIcon({\n      className: 'plane-marker',\n      html: `<div style=\"\n        background: #3b82f6;\n        width: 24px;\n        height: 24px;\n        border-radius: 50%;\n        border: 3px solid white;\n        box-shadow: 0 2px 8px rgba(0,0,0,0.3);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      \">âœˆï¸</div>`,\n      iconSize: [24, 24],\n      iconAnchor: [12, 12]\n    });\n\n    markerRef.current = L.marker([point.lat, point.lng], { icon: planeIcon })\n      .addTo(mapRef.current);\n\n    // Add popup with details\n    const popupContent = `\n      <div style=\"font-family: system-ui; font-size: 12px;\">\n        <strong>Point ${currentPointIndex + 1}</strong><br/>\n        Alt: ${point.alt || '--'} ft<br/>\n        Speed: ${point.speed || '--'} kts<br/>\n        ${point.timestamp ? new Date(point.timestamp).toLocaleTimeString() : ''}\n      </div>\n    `;\n    markerRef.current.bindPopup(popupContent);\n\n    // Pan map to follow the plane\n    mapRef.current.panTo([point.lat, point.lng]);\n\n  }, [currentPointIndex, points]);\n\n  // Handle playback animation\n  useEffect(() => {\n    if (!playing || points.length === 0) {\n      if (animationRef.current) {\n        clearInterval(animationRef.current);\n        animationRef.current = null;\n      }\n      return;\n    }\n\n    const interval = 500; // Base 500ms between points\n\n    animationRef.current = setInterval(() => {\n      if (currentPointIndex >= points.length - 1) {\n        // Playback complete\n        if (animationRef.current) {\n          clearInterval(animationRef.current);\n          animationRef.current = null;\n        }\n        onPlaybackEnd();\n        return;\n      }\n      onIndexChange(currentPointIndex + 1);\n    }, interval);\n\n    return () => {\n      if (animationRef.current) {\n        clearInterval(animationRef.current);\n      }\n    };\n  }, [playing, points.length, onPlaybackEnd, currentPointIndex, onIndexChange]);\n\n  return (\n    <div \n      id=\"flight-playback-map\" \n      style={{ height: '100%', width: '100%' }}\n      className=\"z-0\"\n    />\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\flight-playback\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'session' is assigned a value but never used.","line":37,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":37,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":86,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":86,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":103,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":103,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":120,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":120,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":154,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":154,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect, useMemo, Suspense } from 'react';\nimport { useSession } from 'next-auth/react';\nimport { useSearchParams, useRouter } from 'next/navigation';\nimport dynamic from 'next/dynamic';\nimport Link from 'next/link';\n\n// Dynamic import for Leaflet (no SSR)\nconst FlightPlaybackMap = dynamic(() => import('./FlightPlaybackMap'), { ssr: false });\n\ninterface TrackPoint {\n  lat: number;\n  lng: number;\n  alt?: number;\n  speed?: number;\n  timestamp: string;\n}\n\ninterface Track {\n  id: string;\n  name: string;\n  date: string;\n  aircraft: string;\n  totalDistance: number;\n  maxAltitude: number;\n  maxSpeed: number;\n  duration: number;\n  createdAt: string;\n}\n\ninterface FullTrack extends Track {\n  trackData: string;\n}\n\nfunction FlightPlaybackContent() {\n  const { data: session, status } = useSession();\n  const router = useRouter();\n  const searchParams = useSearchParams();\n  const trackId = searchParams.get('id');\n  \n  const [tracks, setTracks] = useState<Track[]>([]);\n  const [selectedTrack, setSelectedTrack] = useState<FullTrack | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState('');\n  const [playing, setPlaying] = useState(false);\n  const [playbackSpeed, setPlaybackSpeed] = useState(1);\n  const [currentPointIndex, setCurrentPointIndex] = useState(0);\n  const [showAddModal, setShowAddModal] = useState(false);\n  const [saving, setSaving] = useState(false);\n  const [addFormData, setAddFormData] = useState({\n    name: '',\n    date: new Date().toISOString().split('T')[0],\n    aircraft: '',\n    trackData: '[]',\n  });\n\n  // Fetch tracks list\n  useEffect(() => {\n    if (status === 'authenticated') {\n      fetchTracks();\n    }\n  }, [status]);\n\n  // Fetch single track when ID is in URL\n  useEffect(() => {\n    if (trackId && status === 'authenticated') {\n      fetchTrack(trackId);\n    }\n  }, [trackId, status]);\n\n  const fetchTracks = async () => {\n    try {\n      const res = await fetch('/api/flight-tracks');\n      if (!res.ok) {\n        const data = await res.json();\n        if (data.code === 'PROPLUS_REQUIRED') {\n          setError('Pro+ subscription required');\n        } else {\n          setError(data.error || 'Failed to load tracks');\n        }\n        return;\n      }\n      const data = await res.json();\n      setTracks(data.tracks || []);\n    } catch (err) {\n      setError('Failed to load tracks');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchTrack = async (id: string) => {\n    try {\n      const res = await fetch(`/api/flight-tracks?id=${id}`);\n      if (!res.ok) {\n        const data = await res.json();\n        setError(data.error || 'Failed to load track');\n        return;\n      }\n      const data = await res.json();\n      setSelectedTrack(data.track);\n    } catch (err) {\n      setError('Failed to load track');\n    }\n  };\n\n  const handleDelete = async (id: string) => {\n    if (!confirm('Delete this flight track?')) return;\n    \n    try {\n      const res = await fetch(`/api/flight-tracks?id=${id}`, { method: 'DELETE' });\n      if (res.ok) {\n        setTracks(tracks.filter(t => t.id !== id));\n        if (selectedTrack?.id === id) {\n          setSelectedTrack(null);\n          router.push('/modules/flight-playback');\n        }\n      }\n    } catch (err) {\n      alert('Failed to delete track');\n    }\n  };\n\n  const handleAddTrack = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setSaving(true);\n\n    try {\n      const res = await fetch('/api/flight-tracks', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(addFormData),\n      });\n\n      if (!res.ok) {\n        const data = await res.json();\n        alert(data.error || 'Failed to save track');\n        return;\n      }\n\n      const data = await res.json();\n      setShowAddModal(false);\n      setAddFormData({\n        name: '',\n        date: new Date().toISOString().split('T')[0],\n        aircraft: '',\n        trackData: '[]',\n      });\n      // Refresh the track list\n      fetchTracks();\n      // Navigate to the new track\n      router.push(`/modules/flight-playback?id=${data.track.id}`);\n    } catch (err) {\n      alert('Failed to save track');\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const formatDuration = (minutes: number) => {\n    const hrs = Math.floor(minutes / 60);\n    const mins = Math.round(minutes % 60);\n    return hrs > 0 ? `${hrs}h ${mins}m` : `${mins}m`;\n  };\n\n  const formatDate = (dateStr: string) => {\n    return new Date(dateStr).toLocaleDateString('en-US', {\n      year: 'numeric',\n      month: 'short',\n      day: 'numeric',\n    });\n  };\n\n  // Get track data as array\n  const trackPoints: TrackPoint[] = useMemo(() => {\n    if (!selectedTrack?.trackData) return [];\n    try {\n      return JSON.parse(selectedTrack.trackData);\n    } catch {\n      return [];\n    }\n  }, [selectedTrack]);\n\n  if (status === 'loading' || loading) {\n    return (\n      <div className=\"min-h-screen bg-slate-900 flex items-center justify-center\">\n        <div className=\"text-slate-400\">Loading Flight Playback...</div>\n      </div>\n    );\n  }\n\n  if (status === 'unauthenticated') {\n    router.push('/login');\n    return null;\n  }\n\n  if (error && !tracks.length) {\n    return (\n      <div className=\"min-h-screen bg-slate-900 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <p className=\"text-red-400 mb-4\">{error}</p>\n          <Link href=\"/pricing\" className=\"text-emerald-400 hover:underline\">\n            View Pricing â†’\n          </Link>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-slate-900\">\n      {/* Header */}\n      <div className=\"bg-slate-800 border-b border-slate-700 p-4\">\n        <div className=\"max-w-7xl mx-auto\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h1 className=\"text-2xl font-bold text-white\">ðŸ›« Flight Playback</h1>\n              <p className=\"text-slate-400 text-sm\">Replay your flights on a map</p>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"flex h-[calc(100vh-80px)]\">\n        {/* Sidebar - Track List */}\n        <div className=\"w-80 bg-slate-800 border-r border-slate-700 overflow-y-auto\">\n          <div className=\"p-4\">\n            <div className=\"flex items-center justify-between mb-3\">\n              <h2 className=\"text-sm font-semibold text-slate-300\">Your Flight Tracks</h2>\n              <button\n                onClick={() => setShowAddModal(true)}\n                className=\"bg-emerald-500 hover:bg-emerald-600 text-white text-xs px-3 py-1.5 rounded-lg transition-colors\"\n              >\n                + Add Track\n              </button>\n            </div>\n            \n            {tracks.length === 0 ? (\n              <p className=\"text-slate-500 text-sm\">No flight tracks saved yet.</p>\n            ) : (\n              <div className=\"space-y-2\">\n                {tracks.map((track) => (\n                  <div\n                    key={track.id}\n                    className={`p-3 rounded-lg border cursor-pointer transition-colors ${\n                      selectedTrack?.id === track.id\n                        ? 'bg-emerald-500/20 border-emerald-500/50'\n                        : 'bg-slate-700/50 border-slate-600 hover:bg-slate-700'\n                    }`}\n                    onClick={() => router.push(`/modules/flight-playback?id=${track.id}`)}\n                  >\n                    <div className=\"flex justify-between items-start mb-1\">\n                      <span className=\"text-white font-medium text-sm\">{track.name}</span>\n                      <button\n                        onClick={(e) => { e.stopPropagation(); handleDelete(track.id); }}\n                        className=\"text-slate-500 hover:text-red-400\"\n                      >\n                        Ã—\n                      </button>\n                    </div>\n                    <div className=\"text-xs text-slate-400\">\n                      {formatDate(track.date)} â€¢ {track.aircraft}\n                    </div>\n                    <div className=\"flex gap-3 mt-2 text-xs text-slate-500\">\n                      <span>{track.totalDistance} NM</span>\n                      <span>{track.maxAltitude} ft</span>\n                      <span>{formatDuration(track.duration)}</span>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        </div>\n\n        {/* Main Content - Map or Empty State */}\n        <div className=\"flex-1 relative\">\n          {selectedTrack ? (\n            <>\n              <FlightPlaybackMap \n                points={trackPoints} \n                playing={playing}\n                currentPointIndex={currentPointIndex}\n                onPlaybackEnd={() => setPlaying(false)}\n                onIndexChange={(index) => setCurrentPointIndex(index)}\n              />\n              \n              {/* Playback Controls */}\n              <div className=\"absolute bottom-4 left-1/2 -translate-x-1/2 bg-slate-800/90 backdrop-blur rounded-lg p-4 flex items-center gap-4 border border-slate-700\">\n                <button\n                  onClick={() => setPlaying(!playing)}\n                  className=\"bg-emerald-500 hover:bg-emerald-600 text-white rounded-full w-10 h-10 flex items-center justify-center\"\n                >\n                  {playing ? 'â¸' : 'â–¶'}\n                </button>\n                \n                <div className=\"flex items-center gap-2\">\n                  <span className=\"text-xs text-slate-400\">Speed:</span>\n                  <select\n                    value={playbackSpeed}\n                    onChange={(e) => setPlaybackSpeed(Number(e.target.value))}\n                    className=\"bg-slate-700 text-white text-sm rounded px-2 py-1 border border-slate-600\"\n                  >\n                    <option value={1}>1x</option>\n                    <option value={2}>2x</option>\n                    <option value={5}>5x</option>\n                    <option value={10}>10x</option>\n                  </select>\n                </div>\n\n                <div className=\"text-sm text-slate-300\">\n                  Point {currentPointIndex + 1} / {trackPoints.length}\n                </div>\n                \n                {trackPoints[currentPointIndex] && (\n                  <div className=\"text-xs text-slate-400 ml-2\">\n                    ALT: {trackPoints[currentPointIndex].alt || '--'} ft\n                    {' | '}\n                    SPD: {trackPoints[currentPointIndex].speed || '--'} kts\n                  </div>\n                )}\n              </div>\n\n              {/* Track Info */}\n              <div className=\"absolute top-4 right-4 bg-slate-800/90 backdrop-blur rounded-lg p-4 border border-slate-700\">\n                <h3 className=\"text-white font-semibold mb-2\">{selectedTrack.name}</h3>\n                <div className=\"grid grid-cols-2 gap-2 text-xs\">\n                  <div className=\"text-slate-400\">Date:</div>\n                  <div className=\"text-white\">{formatDate(selectedTrack.date)}</div>\n                  <div className=\"text-slate-400\">Aircraft:</div>\n                  <div className=\"text-white\">{selectedTrack.aircraft}</div>\n                  <div className=\"text-slate-400\">Distance:</div>\n                  <div className=\"text-white\">{selectedTrack.totalDistance} NM</div>\n                  <div className=\"text-slate-400\">Max Alt:</div>\n                  <div className=\"text-white\">{selectedTrack.maxAltitude} ft</div>\n                  <div className=\"text-slate-400\">Max Speed:</div>\n                  <div className=\"text-white\">{selectedTrack.maxSpeed} kts</div>\n                  <div className=\"text-slate-400\">Duration:</div>\n                  <div className=\"text-white\">{formatDuration(selectedTrack.duration)}</div>\n                </div>\n              </div>\n            </>\n          ) : (\n            <div className=\"h-full flex items-center justify-center text-slate-500\">\n              <div className=\"text-center\">\n                <p className=\"text-4xl mb-4\">ðŸ—ºï¸</p>\n                <p>Select a flight track to view playback</p>\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Add Track Modal */}\n      {showAddModal && (\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\">\n          <div className=\"bg-slate-800 rounded-xl p-6 w-full max-w-lg border border-slate-700\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <h2 className=\"text-xl font-bold text-white\">Add Flight Track</h2>\n              <button\n                onClick={() => setShowAddModal(false)}\n                className=\"text-slate-400 hover:text-white\"\n              >\n                Ã—\n              </button>\n            </div>\n\n            <form onSubmit={handleAddTrack}>\n              <div className=\"space-y-4\">\n                <div>\n                  <label className=\"block text-sm text-slate-400 mb-1\">Track Name</label>\n                  <input\n                    type=\"text\"\n                    value={addFormData.name}\n                    onChange={(e) => setAddFormData({ ...addFormData, name: e.target.value })}\n                    placeholder=\"e.g., XC to KORD\"\n                    className=\"w-full bg-slate-700 text-white border border-slate-600 rounded-lg px-3 py-2\"\n                    required\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm text-slate-400 mb-1\">Date</label>\n                  <input\n                    type=\"date\"\n                    value={addFormData.date}\n                    onChange={(e) => setAddFormData({ ...addFormData, date: e.target.value })}\n                    className=\"w-full bg-slate-700 text-white border border-slate-600 rounded-lg px-3 py-2\"\n                    required\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm text-slate-400 mb-1\">Aircraft</label>\n                  <input\n                    type=\"text\"\n                    value={addFormData.aircraft}\n                    onChange={(e) => setAddFormData({ ...addFormData, aircraft: e.target.value })}\n                    placeholder=\"e.g., N12345 - C172\"\n                    className=\"w-full bg-slate-700 text-white border border-slate-600 rounded-lg px-3 py-2\"\n                    required\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm text-slate-400 mb-1\">\n                    Track Data (JSON)\n                    <span className=\"text-xs text-slate-500 ml-2\">\n                      Format: [{\"{\"}lat, lng, alt, speed, timestamp{\"}\"}]\n                    </span>\n                  </label>\n                  <textarea\n                    value={addFormData.trackData}\n                    onChange={(e) => setAddFormData({ ...addFormData, trackData: e.target.value })}\n                    placeholder='[{\"lat\": 41.5, \"lng\": -81.7, \"alt\": 3000, \"speed\": 120, \"timestamp\": \"2024-01-15T10:30:00Z\"}]'\n                    rows={6}\n                    className=\"w-full bg-slate-700 text-white border border-slate-600 rounded-lg px-3 py-2 font-mono text-xs\"\n                    required\n                  />\n                  <p className=\"text-xs text-slate-500 mt-1\">\n                    Paste JSON array of track points with lat, lng, alt (ft), speed (kts), timestamp\n                  </p>\n                </div>\n              </div>\n\n              <div className=\"flex justify-end gap-3 mt-6\">\n                <button\n                  type=\"button\"\n                  onClick={() => setShowAddModal(false)}\n                  className=\"px-4 py-2 text-slate-400 hover:text-white\"\n                >\n                  Cancel\n                </button>\n                <button\n                  type=\"submit\"\n                  disabled={saving}\n                  className=\"bg-emerald-500 hover:bg-emerald-600 disabled:opacity-50 text-white px-4 py-2 rounded-lg transition-colors\"\n                >\n                  {saving ? 'Saving...' : 'Save Track'}\n                </button>\n              </div>\n            </form>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default function FlightPlaybackPage() {\n  return (\n    <Suspense fallback={\n      <div className=\"min-h-screen bg-slate-900 flex items-center justify-center\">\n        <div className=\"text-slate-400\">Loading...</div>\n      </div>\n    }>\n      <FlightPlaybackContent />\n    </Suspense>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\flying-club\\DemoContext.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\David\\next-dashboard\\app\\modules\\flying-club\\DemoContext.tsx:45:7\n  43 |     const params = new URLSearchParams(window.location.search);\n  44 |     if (params.get('demo') === 'true') {\n> 45 |       setIsDemo(true);\n     |       ^^^^^^^^^ Avoid calling setState() directly within an effect\n  46 |       setShowDemoPopup(true);\n  47 |       // Load demo data\n  48 |       setGroups(demoGroups);","line":45,"column":7,"nodeType":null,"endLine":45,"endColumn":16}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { createContext, useContext, useState, useEffect, ReactNode } from 'react';\nimport { \n  demoGroups, \n  demoBookings, \n  demoFlightLogs, \n  demoMaintenance,\n  demoUsers,\n  DemoGroup,\n  DemoBooking,\n  DemoFlightLog,\n  DemoMaintenance\n} from './demoData';\n\ninterface DemoContextType {\n  isDemo: boolean;\n  groups: DemoGroup[];\n  bookings: DemoBooking[];\n  flightLogs: DemoFlightLog[];\n  maintenance: DemoMaintenance[];\n  currentUser: { id: string; name: string; email: string };\n  showDemoPopup: boolean;\n  setShowDemoPopup: (show: boolean) => void;\n  // State updaters for CRUD operations (in-memory only)\n  addBooking: (booking: Omit<DemoBooking, 'id' | 'createdAt'>) => void;\n  addFlightLog: (log: Omit<DemoFlightLog, 'id' | 'createdAt'>) => void;\n  updateAircraftStatus: (groupId: string, aircraftId: string, status: string) => void;\n}\n\nconst DemoContext = createContext<DemoContextType | undefined>(undefined);\n\nexport function DemoProvider({ children }: { children: ReactNode }) {\n  const [isDemo, setIsDemo] = useState(false);\n  const [showDemoPopup, setShowDemoPopup] = useState(false);\n  const [groups, setGroups] = useState<DemoGroup[]>([]);\n  const [bookings, setBookings] = useState<DemoBooking[]>([]);\n  const [flightLogs, setFlightLogs] = useState<DemoFlightLog[]>([]);\n  const [maintenance, setMaintenance] = useState<DemoMaintenance[]>([]);\n\n  // Check for demo mode from URL\n  useEffect(() => {\n    const params = new URLSearchParams(window.location.search);\n    if (params.get('demo') === 'true') {\n      setIsDemo(true);\n      setShowDemoPopup(true);\n      // Load demo data\n      setGroups(demoGroups);\n      setBookings(demoBookings);\n      setFlightLogs(demoFlightLogs);\n      setMaintenance(demoMaintenance);\n    }\n  }, []);\n\n  // Generate unique ID for new records\n  const generateId = () => `demo-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n\n  // CRUD operations that stay in memory\n  const addBooking = (booking: Omit<DemoBooking, 'id' | 'createdAt'>) => {\n    const newBooking: DemoBooking = {\n      ...booking,\n      id: generateId(),\n      createdAt: new Date().toISOString(),\n    };\n    setBookings(prev => [newBooking, ...prev]);\n  };\n\n  const addFlightLog = (log: Omit<DemoFlightLog, 'id' | 'createdAt'>) => {\n    const newLog: DemoFlightLog = {\n      ...log,\n      id: generateId(),\n      createdAt: new Date().toISOString(),\n    };\n    setFlightLogs(prev => [newLog, ...prev]);\n  };\n\n  const updateAircraftStatus = (groupId: string, aircraftId: string, status: string) => {\n    setGroups(prev => prev.map(group => {\n      if (group.id === groupId) {\n        return {\n          ...group,\n          aircraft: group.aircraft.map(aircraft => {\n            if (aircraft.id === aircraftId) {\n              const notes = aircraft.aircraftNotes ? JSON.parse(aircraft.aircraftNotes) : {};\n              return {\n                ...aircraft,\n                status,\n                aircraftNotes: JSON.stringify({ ...notes, aircraftStatus: status }),\n              };\n            }\n            return aircraft;\n          }),\n        };\n      }\n      return group;\n    }));\n  };\n\n  // Current user is the demo admin\n  const currentUser = demoUsers[0];\n\n  return (\n    <DemoContext.Provider \n      value={{\n        isDemo,\n        groups,\n        bookings,\n        flightLogs,\n        maintenance,\n        currentUser,\n        showDemoPopup,\n        setShowDemoPopup,\n        addBooking,\n        addFlightLog,\n        updateAircraftStatus,\n      }}\n    >\n      {children}\n    </DemoContext.Provider>\n  );\n}\n\nexport function useDemo() {\n  const context = useContext(DemoContext);\n  if (context === undefined) {\n    throw new Error('useDemo must be used within a DemoProvider');\n  }\n  return context;\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\flying-club\\demoData.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\flying-club\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\flying-club\\manage\\[section]\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\flying-club\\manage\\layout.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":60,"column":89,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":92,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1909,1912],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1909,1912],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":71,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":71,"endColumn":21},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'handleGroupChange'. Either include it or remove the dependency array.","line":104,"column":6,"nodeType":"ArrayExpression","endLine":104,"endColumn":47,"suggestions":[{"desc":"Update the dependencies array to be: [status, groups, selectedGroupIdStateful, handleGroupChange]","fix":{"range":[3065,3106],"text":"[status, groups, selectedGroupIdStateful, handleGroupChange]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'handleGroupChange'. Either include it or remove the dependency array.","line":122,"column":7,"nodeType":"ArrayExpression","endLine":122,"endColumn":48,"suggestions":[{"desc":"Update the dependencies array to be: [groups, selectedGroupIdStateful, handleGroupChange, isDemo]","fix":{"range":[3608,3649],"text":"[groups, selectedGroupIdStateful, handleGroupChange, isDemo]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { ReactNode, Suspense, useEffect, useMemo, useState } from 'react'\nimport Link from 'next/link'\nimport { usePathname, useRouter, useSearchParams } from 'next/navigation'\n\nimport PageContainer from '@/components/modules/PageContainer'\nimport ManageSidebar from '@/components/club/ManageSidebar'\nimport { ManageContextProvider, ManageGroup } from '@/components/club/ManageContext'\nimport { Button } from '@/components/ui/button'\nimport { cn } from '@/lib/utils'\n\ntype FetchState = 'idle' | 'loading' | 'ready'\n\nconst DEMO_GROUPS: ManageGroup[] = [\n  {\n    id: 'demo-1',\n    name: 'Sky High Flying Club',\n    description: 'Demo club for previewing operations features.',\n  },\n  {\n    id: 'demo-2',\n    name: 'Weekend Warriors',\n    description: 'Sample weekend-only fleet.',\n  },\n]\n\nexport default function ManageLayout({ children }: { children: ReactNode }) {\n  return (\n    <Suspense fallback={<LoadingFallback />}> \n      <ManageLayoutInner>{children}</ManageLayoutInner>\n    </Suspense>\n  )\n}\n\nfunction ManageLayoutInner({ children }: { children: ReactNode }) {\n  const router = useRouter()\n  const pathname = usePathname()\n  const searchParams = useSearchParams()\n\n  const [groups, setGroups] = useState<ManageGroup[]>([])\n  const [status, setStatus] = useState<FetchState>('idle')\n  const [isDemo, setIsDemo] = useState(false)\n\n  const queryGroup = searchParams.get('group')\n  const [selectedGroupId, setSelectedGroupIdState] = useState<string | null>(queryGroup)\n\n  useEffect(() => {\n    setStatus('loading')\n    let cancelled = false\n\n    async function loadGroups() {\n      try {\n        const response = await fetch('/api/groups')\n        if (!response.ok) {\n          throw new Error('Unable to load groups')\n        }\n        const data = await response.json()\n        if (cancelled) return\n        const normalized: ManageGroup[] = (Array.isArray(data) ? data : []).map((group: any) => ({\n          id: group.id,\n          name: group.name,\n          description: group.description ?? null,\n          role: group.role ?? group.userRole ?? undefined,\n        }))\n        if (normalized.length === 0) {\n          throw new Error('No groups found')\n        }\n        setGroups(normalized)\n        setIsDemo(false)\n      } catch (error) {\n        if (cancelled) return\n        setGroups(DEMO_GROUPS)\n        setIsDemo(true)\n      } finally {\n        if (!cancelled) {\n          setStatus('ready')\n        }\n      }\n    }\n\n    loadGroups()\n    return () => {\n      cancelled = true\n    }\n  }, [])\n\n  // Ensure selected group stays in sync with URL/search params\n  const selectedGroupIdStateful = useMemo(() => {\n    if (!selectedGroupId) return null\n    const exists = groups.some((group) => group.id === selectedGroupId)\n    return exists ? selectedGroupId : null\n  }, [selectedGroupId, groups])\n\n  useEffect(() => {\n    setSelectedGroupIdState(queryGroup)\n  }, [queryGroup])\n\n  useEffect(() => {\n    if (status !== 'ready') return\n    if (!selectedGroupIdStateful && groups.length > 0) {\n      handleGroupChange(groups[0].id)\n    }\n  }, [status, groups, selectedGroupIdStateful])\n\n  const handleGroupChange = (groupId: string | null) => {\n    const params = new URLSearchParams(searchParams.toString())\n    if (groupId) {\n      params.set('group', groupId)\n    } else {\n      params.delete('group')\n    }\n    setSelectedGroupIdState(groupId)\n    router.replace(`${pathname}?${params.toString()}`, { scroll: false })\n  }\n\n  const contextValue = useMemo(() => ({\n    groups,\n    selectedGroupId: selectedGroupIdStateful,\n    setSelectedGroupId: handleGroupChange,\n    isDemo,\n  }), [groups, selectedGroupIdStateful, isDemo])\n\n  const layoutReady = status === 'ready'\n\n  return (\n    <ManageContextProvider value={contextValue}>\n      <PageContainer fluid className=\"space-y-6\">\n        <header className=\"space-y-4 rounded-xl border border-border bg-card/80 p-4 shadow-sm backdrop-blur\">\n          <div className=\"flex flex-wrap items-center justify-between gap-3\">\n            <div>\n              <h1 className=\"text-xl font-semibold text-foreground\">Manage Club Operations</h1>\n              <p className=\"text-sm text-muted-foreground\">Dispatch, member management, billing, and integrations all in one place.</p>\n            </div>\n            <div className=\"flex flex-wrap items-center gap-2\">\n              <Button variant=\"outline\" asChild>\n                <Link href=\"/modules/flying-club\">Back to dashboard</Link>\n              </Button>\n              <Button size=\"sm\" variant=\"secondary\" onClick={() => alert('Group creation coming soon')}>\n                Create group\n              </Button>\n            </div>\n          </div>\n\n          <div className=\"flex flex-wrap items-center gap-3\">\n            <label className=\"text-sm text-muted-foreground\" htmlFor=\"manage-group-select\">\n              Active club\n            </label>\n            <select\n              id=\"manage-group-select\"\n              className=\"h-9 rounded-lg border border-input bg-background px-3 text-sm\"\n              value={selectedGroupIdStateful ?? ''}\n              onChange={(event) => handleGroupChange(event.target.value || null)}\n              disabled={!layoutReady}\n            >\n              {!layoutReady && <option value=\"\">Loadingâ€¦</option>}\n              {layoutReady && groups.length === 0 && <option value=\"\">No clubs available</option>}\n              {layoutReady && groups.map((group) => (\n                <option key={group.id} value={group.id}>{group.name}</option>\n              ))}\n            </select>\n            {isDemo && (\n              <span className=\"text-xs font-medium uppercase text-amber-600\">Demo data</span>\n            )}\n          </div>\n        </header>\n\n        <div className={cn('flex flex-col gap-6 lg:flex-row', 'lg:items-start')}>\n          <ManageSidebar />\n          <div className=\"flex-1 space-y-6\">\n            {children}\n          </div>\n        </div>\n      </PageContainer>\n    </ManageContextProvider>\n  )\n}\n\nfunction LoadingFallback() {\n  return (\n    <PageContainer fluid className=\"space-y-6\">\n      <div className=\"rounded-xl border border-border bg-card/80 p-6 shadow-sm\">\n        <p className=\"text-sm text-muted-foreground\">Loading club management toolsâ€¦</p>\n      </div>\n    </PageContainer>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\flying-club\\manage\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\flying-club\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Tabs' is defined but never used.","line":12,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":14,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Tabs"},"fix":{"range":[476,481],"text":""},"desc":"Remove unused variable \"Tabs\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TabsContent' is defined but never used.","line":12,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":27,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"TabsContent"},"fix":{"range":[480,493],"text":""},"desc":"Remove unused variable \"TabsContent\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TabsList' is defined but never used.","line":12,"column":29,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":37,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"TabsList"},"fix":{"range":[493,503],"text":""},"desc":"Remove unused variable \"TabsList\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TabsTrigger' is defined but never used.","line":12,"column":39,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":50,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"TabsTrigger"},"fix":{"range":[467,547],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DialogTrigger' is defined but never used.","line":22,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":22,"endColumn":16,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"DialogTrigger"},"fix":{"range":[755,772],"text":""},"desc":"Remove unused variable \"DialogTrigger\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CheckCircle2' is defined but never used.","line":32,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":32,"endColumn":15,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"CheckCircle2"},"fix":{"range":[891,907],"text":""},"desc":"Remove unused variable \"CheckCircle2\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ChevronLeft' is defined but never used.","line":34,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":34,"endColumn":14,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"ChevronLeft"},"fix":{"range":[915,930],"text":""},"desc":"Remove unused variable \"ChevronLeft\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ChevronRight' is defined but never used.","line":35,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":35,"endColumn":15,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"ChevronRight"},"fix":{"range":[930,946],"text":""},"desc":"Remove unused variable \"ChevronRight\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Search' is defined but never used.","line":36,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":36,"endColumn":9,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Search"},"fix":{"range":[946,956],"text":""},"desc":"Remove unused variable \"Search\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MapPin' is defined but never used.","line":40,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":40,"endColumn":9,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"MapPin"},"fix":{"range":[994,1004],"text":""},"desc":"Remove unused variable \"MapPin\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Fuel' is defined but never used.","line":41,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":41,"endColumn":7,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Fuel"},"fix":{"range":[1004,1012],"text":""},"desc":"Remove unused variable \"Fuel\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Settings' is defined but never used.","line":43,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":43,"endColumn":11,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Settings"},"fix":{"range":[1024,1036],"text":""},"desc":"Remove unused variable \"Settings\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'User' is defined but never used.","line":45,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":45,"endColumn":7,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"User"},"fix":{"range":[1047,1055],"text":""},"desc":"Remove unused variable \"User\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Home' is defined but never used.","line":46,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":46,"endColumn":7,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Home"},"fix":{"range":[1055,1063],"text":""},"desc":"Remove unused variable \"Home\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Trash2' is defined but never used.","line":49,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":49,"endColumn":9,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Trash2"},"fix":{"range":[1079,1089],"text":""},"desc":"Remove unused variable \"Trash2\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":550,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":550,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":603,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":603,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":656,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":656,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":709,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":709,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":758,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":758,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":800,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":800,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleRemoveMember' is assigned a value but never used.","line":822,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":822,"endColumn":27}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":22,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport Link from 'next/link'\nimport { useSession } from 'next-auth/react'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\"\nimport { Badge } from \"@/components/ui/badge\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Label } from \"@/components/ui/label\"\nimport { Textarea } from \"@/components/ui/textarea\"\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\"\nimport { Progress } from \"@/components/ui/progress\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\"\nimport {\n  Plane,\n  Calendar,\n  Users,\n  Wrench,\n  DollarSign,\n  Clock,\n  AlertCircle,\n  CheckCircle2,\n  Plus,\n  ChevronLeft,\n  ChevronRight,\n  Search,\n  Filter,\n  Download,\n  MoreVertical,\n  MapPin,\n  Fuel,\n  BookOpen,\n  Settings,\n  Loader2,\n  User,\n  Home,\n  Copy,\n  Mail,\n  Trash2,\n  UserPlus,\n  X\n} from \"lucide-react\"\n\nimport BookingCalendar from \"@/components/club/BookingCalendar\"\nimport CheckoutPanel from \"@/components/club/CheckoutPanel\"\nimport MemberList from \"@/components/club/MemberList\"\nimport BillingRunButton from \"@/components/club/BillingRunButton\"\n\n// Types\ninterface GroupAircraft {\n  id: string\n  nNumber: string\n  nickname: string | null\n  make: string | null\n  model: string | null\n  year: number | null\n  status: string | null\n  hourlyRate: number | null\n  hobbsHours: number | null\n  groupName?: string\n}\n\ninterface Group {\n  id: string\n  name: string\n  description: string | null\n  role: string\n  aircraft: GroupAircraft[]\n  members?: number\n}\n\ninterface Booking {\n  id: string\n  aircraftId: string\n  aircraft?: GroupAircraft\n  userId: string\n  user?: { name: string | null; email: string }\n  groupId?: string\n  groupName?: string\n  source?: 'club' | 'personal'\n  startTime: string\n  endTime: string\n  purpose: string | null\n}\n\ninterface Maintenance {\n  id: string\n  aircraftId: string\n  aircraft?: GroupAircraft\n  description: string\n  status: string\n  priority: string\n  reportedDate: string\n  dueDate: string | null\n  isGrounded?: boolean\n}\n\ninterface FlightLog {\n  id: string\n  aircraftId: string\n  aircraft?: GroupAircraft\n  userId: string\n  user?: { name: string | null }\n  date: string\n  hobbsTime: number | null\n  tachTime: number | null\n  notes: string | null\n}\n\ninterface Member {\n  id: string\n  userId: string\n  user: { id: string; name: string | null; email: string }\n  role: string\n  joinedAt: string\n}\n\ninterface Invite {\n  id: string\n  token: string\n  email: string | null\n  role: string\n  expiresAt: string | null\n}\n\ninterface BillingData {\n  month: string\n  year: number\n  totalMembers: number\n  totalFlights: number\n  totalHobbs: number\n  totalCost: number\n  members: {\n    userId: string\n    name: string\n    email: string\n    flights: number\n    totalHobbs: number\n    totalTach: number\n    totalCost: number\n    details: { date: string; aircraft: string; hobbs: number; tach: number; cost: number }[]\n  }[]\n}\n\ninterface ChatMessage {\n  id: string\n  groupId: string\n  userId: string\n  user: { name: string; initials: string; color: string }\n  message: string\n  timestamp: string\n}\n\n// Demo chat messages\nconst demoChatMessages: ChatMessage[] = [\n  { id: 'c1', groupId: 'demo-1', userId: 'u1', user: { name: 'Frank Miller', initials: 'FM', color: 'bg-primary' }, message: \"Hey everyone! Anyone flying this weekend?\", timestamp: '2026-02-21T10:30:00' },\n  { id: 'c2', groupId: 'demo-1', userId: 'u2', user: { name: 'Sarah Johnson', initials: 'SJ', color: 'bg-green-500' }, message: \"I'm thinking Saturday morning for some IFR practice!\", timestamp: '2026-02-21T10:45:00' },\n  { id: 'c3', groupId: 'demo-1', userId: 'u3', user: { name: 'Mike Wilson', initials: 'MW', color: 'bg-blue-500' }, message: \"Count me in! The 182 is available\", timestamp: '2026-02-21T11:00:00' },\n  { id: 'c4', groupId: 'demo-1', userId: 'u1', user: { name: 'Frank Miller', initials: 'FM', color: 'bg-primary' }, message: \"Great! Let's meet at 8am\", timestamp: '2026-02-21T11:15:00' },\n]\n\n// Demo data\nconst demoGroups: Group[] = [\n  {\n    id: 'demo-1',\n    name: 'Sky High Flying Club',\n    description: 'A welcoming club for pilots of all experience levels',\n    role: 'ADMIN',\n    aircraft: [\n      { id: 'a1', nNumber: 'N172SP', nickname: 'Skyhawk', make: 'Cessna', model: '172S', year: 2025, status: 'Available', hourlyRate: 165, hobbsHours: 98.2 },\n      { id: 'a2', nNumber: 'N9876P', nickname: 'Warrior', make: 'Piper', model: 'PA-28-161', year: 2019, status: 'Maintenance', hourlyRate: 145, hobbsHours: 1842.3 }\n    ],\n    members: 5\n  },\n  {\n    id: 'demo-2',\n    name: 'Weekend Warriors',\n    description: 'Casual flying group for weekend adventures',\n    role: 'MEMBER',\n    aircraft: [\n      { id: 'a3', nNumber: 'N345AB', nickname: 'Cherokee', make: 'Piper', model: 'PA-32-300', year: 1978, status: 'Available', hourlyRate: 135, hobbsHours: 4890.5 }\n    ],\n    members: 2\n  }\n]\n\nconst demoBookings: Booking[] = [\n  { id: 'b1', aircraftId: 'a1', aircraft: demoGroups[0].aircraft[0], userId: 'u1', user: { name: 'Demo Admin', email: 'demo@test.com' }, startTime: '2026-02-23T14:00', endTime: '2026-02-23T16:00', purpose: 'Local practice' },\n  { id: 'b2', aircraftId: 'a3', aircraft: demoGroups[1].aircraft[0], userId: 'u2', user: { name: 'Mike Wilson', email: 'mike@test.com' }, startTime: '2026-02-24T09:00', endTime: '2026-02-24T12:00', purpose: 'Cross country' },\n  { id: 'b3', aircraftId: 'a1', aircraft: demoGroups[0].aircraft[0], userId: 'u3', user: { name: 'Sarah Johnson', email: 'sarah@test.com' }, startTime: '2026-02-25T10:30', endTime: '2026-02-25T13:30', purpose: 'IFR practice' }\n]\n\nconst demoMaintenance: Maintenance[] = [\n  { id: 'm1', aircraftId: 'a2', aircraft: demoGroups[0].aircraft[1], description: 'Annual inspection', status: 'In Progress', priority: 'high', reportedDate: '2026-01-15', dueDate: '2026-08-20' },\n  { id: 'm2', aircraftId: 'a1', aircraft: demoGroups[0].aircraft[0], description: 'Oil change', status: 'Needed', priority: 'medium', reportedDate: '2026-02-01', dueDate: '2026-03-01' }\n]\n\nconst demoBillingData: BillingData = {\n  month: 'February',\n  year: 2026,\n  totalMembers: 3,\n  totalFlights: 8,\n  totalHobbs: 12.5,\n  totalCost: 1812.50,\n  members: [\n    { userId: 'u1', name: 'Demo Admin', email: 'demo@admin.com', flights: 4, totalHobbs: 6.2, totalTach: 5.8, totalCost: 899.00, details: [] },\n    { userId: 'u2', name: 'Frank Miller', email: 'frank@demo.com', flights: 2, totalHobbs: 3.5, totalTach: 3.2, totalCost: 507.50, details: [] },\n    { userId: 'u3', name: 'Sarah Johnson', email: 'sarah@demo.com', flights: 2, totalHobbs: 2.8, totalTach: 2.5, totalCost: 406.00, details: [] },\n  ]\n}\n\nconst demoMembers: Member[] = [\n  { id: 'mb1', userId: 'u1', user: { id: 'u1', name: 'Demo Admin', email: 'demo@admin.com' }, role: 'ADMIN', joinedAt: '2024-01-01' },\n  { id: 'mb2', userId: 'u2', user: { id: 'u2', name: 'Frank Miller', email: 'frank@demo.com' }, role: 'MEMBER', joinedAt: '2024-03-15' },\n  { id: 'mb3', userId: 'u3', user: { id: 'u3', name: 'Sarah Johnson', email: 'sarah@demo.com' }, role: 'MEMBER', joinedAt: '2024-06-20' },\n]\n\nconst demoFlightLogs: FlightLog[] = [\n  { id: 'fl1', aircraftId: 'a1', aircraft: demoGroups[0].aircraft[0], userId: 'u1', user: { name: 'Demo Admin' }, date: '2026-02-20', hobbsTime: 1.5, tachTime: 1.3, notes: 'Local pattern work' },\n  { id: 'fl2', aircraftId: 'a1', aircraft: demoGroups[0].aircraft[0], userId: 'u2', user: { name: 'Frank Miller' }, date: '2026-02-18', hobbsTime: 2.3, tachTime: 2.0, notes: 'Cross country to KSFO' },\n]\n\n// Personal demo data (only used for demo when not logged in)\nconst personalBookings: Booking[] = []\n\nexport default function FlyingClubPage() {\n  const { data: session, status } = useSession()\n  const [activeTab, setActiveTab] = useState('dashboard')\n  const [selectedView, setSelectedView] = useState<string>('personal')\n  const [groups, setGroups] = useState<Group[]>([])\n  const [personalAircraft, setPersonalAircraft] = useState<GroupAircraft[]>([])\n  const [bookings, setBookings] = useState<Booking[]>([])\n  const [maintenance, setMaintenance] = useState<Maintenance[]>([])\n  const [members, setMembers] = useState<Member[]>([])\n  const [flightLogs, setFlightLogs] = useState<FlightLog[]>([])\n  const [invites, setInvites] = useState<Invite[]>([])\n  const [billingData, setBillingData] = useState<BillingData | null>(null)\n  const [chatMessages, setChatMessages] = useState<ChatMessage[]>([])\n  const [chatInput, setChatInput] = useState('')\n  const [loading, setLoading] = useState(true)\n  const [scheduledWindow, setScheduledWindow] = useState<'7' | '30' | 'all'>('7')\n  const [scheduledBookings, setScheduledBookings] = useState<Booking[]>([])\n  const [isScheduledLoading, setIsScheduledLoading] = useState(false)\n  const [scheduledError, setScheduledError] = useState<string | null>(null)\n  \n  // Modal states\n  const [showNewGroupModal, setShowNewGroupModal] = useState(false)\n  const [showAddAircraftModal, setShowAddAircraftModal] = useState(false)\n  const [showNewBookingModal, setShowNewBookingModal] = useState(false)\n  const [showReportIssueModal, setShowReportIssueModal] = useState(false)\n  const [showLogFlightModal, setShowLogFlightModal] = useState(false)\n  const [showInviteModal, setShowInviteModal] = useState(false)\n  \n  // Form states\n  const [formLoading, setFormLoading] = useState(false)\n  const [formError, setFormError] = useState('')\n  \n  // New Group form\n  const [newGroupName, setNewGroupName] = useState('')\n  const [newGroupDescription, setNewGroupDescription] = useState('')\n  const [newGroupDryRate, setNewGroupDryRate] = useState('')\n  const [newGroupWetRate, setNewGroupWetRate] = useState('')\n  \n  // Add Aircraft form\n  const [aircraftNNumber, setAircraftNNumber] = useState('')\n  const [aircraftNickname, setAircraftNickname] = useState('')\n  const [aircraftMake, setAircraftMake] = useState('')\n  const [aircraftModel, setAircraftModel] = useState('')\n  const [aircraftYear, setAircraftYear] = useState('')\n  const [aircraftHourlyRate, setAircraftHourlyRate] = useState('')\n  \n  // Booking form\n  const [bookingAircraftId, setBookingAircraftId] = useState('')\n  const [bookingStartTime, setBookingStartTime] = useState('')\n  const [bookingEndTime, setBookingEndTime] = useState('')\n  const [bookingPurpose, setBookingPurpose] = useState('')\n  \n  // Maintenance form\n  const [maintenanceAircraftId, setMaintenanceAircraftId] = useState('')\n  const [maintenanceDescription, setMaintenanceDescription] = useState('')\n  const [maintenanceNotes, setMaintenanceNotes] = useState('')\n  const [maintenanceGrounded, setMaintenanceGrounded] = useState(false)\n  const [maintenancePostToMarketplace, setMaintenancePostToMarketplace] = useState(false)\n  const [maintenancePostAnonymously, setMaintenancePostAnonymously] = useState(true)\n  \n  // Flight Log form\n  const [logAircraftId, setLogAircraftId] = useState('')\n  const [logDate, setLogDate] = useState('')\n  const [logTachStart, setLogTachStart] = useState('')\n  const [logTachEnd, setLogTachEnd] = useState('')\n  const [logHobbsStart, setLogHobbsStart] = useState('')\n  const [logHobbsEnd, setLogHobbsEnd] = useState('')\n  const [logNotes, setLogNotes] = useState('')\n  \n  // Invite form\n  const [inviteEmail, setInviteEmail] = useState('')\n  const [inviteRole, setInviteRole] = useState('MEMBER')\n  const [generatedInviteLink, setGeneratedInviteLink] = useState('')\n  \n  // Billing state\n  const [billingMonth, setBillingMonth] = useState(new Date().getMonth())\n  const [billingYear, setBillingYear] = useState(new Date().getFullYear())\n\n  // Fetch user's groups\n  useEffect(() => {\n    if (status === 'loading') return\n    \n    async function fetchData() {\n      setLoading(true)\n      try {\n        if (session?.user?.id) {\n          // Fetch real groups from API\n          const groupsRes = await fetch('/api/groups')\n          if (groupsRes.ok) {\n            const groupsData = await groupsRes.json()\n            setGroups(groupsData)\n          }\n          // Fetch personal aircraft\n          const personalAircraftRes = await fetch('/api/user-aircraft')\n          if (personalAircraftRes.ok) {\n            const personalAircraftData = await personalAircraftRes.json()\n            setPersonalAircraft(personalAircraftData.aircraft || [])\n          }\n          // Fetch personal + club bookings\n          const bookingsRes = await fetch('/api/bookings')\n          if (bookingsRes.ok) {\n            const bookingsData = await bookingsRes.json()\n            const resolvedBookings = Array.isArray(bookingsData)\n              ? bookingsData\n              : bookingsData.bookings || []\n            setBookings(resolvedBookings)\n          }\n          // Set empty for demo-like state when logged in\n          setMaintenance([])\n          setMembers([])\n          setFlightLogs([])\n        } else {\n          // Demo mode - only show demo data when NOT logged in\n          setGroups(demoGroups)\n          setBookings([...personalBookings, ...demoBookings])\n          setPersonalAircraft([])\n          setMaintenance(demoMaintenance)\n          setMembers(demoMembers)\n          setFlightLogs(demoFlightLogs)\n          setChatMessages(demoChatMessages)\n        }\n      } catch (error) {\n        console.error('Error fetching data:', error)\n        if (!session?.user?.id) {\n          // Only load demo data on error if not logged in\n          setGroups(demoGroups)\n          setBookings([...personalBookings, ...demoBookings])\n          setPersonalAircraft([])\n          setMaintenance(demoMaintenance)\n          setMembers(demoMembers)\n          setFlightLogs(demoFlightLogs)\n        }\n      }\n      setLoading(false)\n    }\n    \n    fetchData()\n  }, [session, status])\n\n  useEffect(() => {\n    if (!session?.user?.id) return\n    let cancelled = false\n\n    async function loadScheduled() {\n      setIsScheduledLoading(true)\n      setScheduledError(null)\n      try {\n        const res = await fetch(`/api/bookings?days=${scheduledWindow}`)\n        if (!res.ok) throw new Error('Failed to load scheduled flights')\n        const data = await res.json()\n        const bookings = Array.isArray(data) ? data : data.bookings || []\n        if (!cancelled) setScheduledBookings(bookings)\n      } catch (error) {\n        console.error('Failed to load scheduled flights', error)\n        if (!cancelled) setScheduledError('Failed to load scheduled flights')\n      } finally {\n        if (!cancelled) setIsScheduledLoading(false)\n      }\n    }\n\n    loadScheduled()\n    return () => {\n      cancelled = true\n    }\n  }, [session?.user?.id, scheduledWindow])\n\n  // Fetch group-specific data when view changes\n  useEffect(() => {\n    if (!session?.user?.id) return\n    if (selectedView === 'personal') {\n      // Fetch personal bookings\n      fetch('/api/bookings')\n        .then(r => r.ok && r.json())\n        .then(data => {\n          if (!data) return\n          const resolvedBookings = Array.isArray(data) ? data : data.bookings || []\n          setBookings(resolvedBookings)\n        })\n      fetch('/api/user-aircraft')\n        .then(r => r.ok && r.json())\n        .then(data => {\n          if (!data) return\n          setPersonalAircraft(data.aircraft || [])\n        })\n      setMaintenance([])\n      setMembers([])\n      setFlightLogs([])\n      setInvites([])\n      return\n    }\n    \n    async function fetchGroupData() {\n      try {\n        const [bookingsRes, membersRes, logsRes, chatRes] = await Promise.all([\n          fetch(`/api/groups/${selectedView}/bookings`),\n          fetch(`/api/groups/${selectedView}/members`),\n          fetch(`/api/groups/${selectedView}/logs`),\n          fetch(`/api/groups/${selectedView}/chat`)\n        ])\n        \n        if (bookingsRes.ok) {\n          const bookingsData = await bookingsRes.json()\n          const resolvedBookings = Array.isArray(bookingsData)\n            ? bookingsData\n            : bookingsData.bookings || []\n          setBookings(resolvedBookings)\n        }\n        if (membersRes.ok) setMembers(await membersRes.json())\n        if (logsRes.ok) {\n          const logsData = await logsRes.json()\n          setFlightLogs(logsData.logs || [])\n          setMaintenance(logsData.maintenance || [])\n        }\n        if (chatRes.ok) setChatMessages(await chatRes.json())\n        \n        // Fetch invites if admin\n        const group = groups.find(g => g.id === selectedView)\n        if (group?.role === 'ADMIN') {\n          const invitesRes = await fetch(`/api/groups/${selectedView}/invites`)\n          if (invitesRes.ok) setInvites(await invitesRes.json())\n        }\n      } catch (error) {\n        console.error('Error fetching group data:', error)\n      }\n    }\n\n    fetchGroupData()\n  }, [selectedView, session, groups])\n  \n  // Fetch billing data\n  useEffect(() => {\n    if (!session?.user?.id || selectedView === 'personal') return\n    const group = groups.find(g => g.id === selectedView)\n    if (group?.role !== 'ADMIN') return\n    \n    async function fetchBilling() {\n      try {\n        const res = await fetch(`/api/billing?groupId=${selectedView}&month=${billingMonth}&year=${billingYear}`)\n        if (res.ok) {\n          setBillingData(await res.json())\n        }\n      } catch (error) {\n        console.error('Error fetching billing:', error)\n      }\n    }\n    \n    if (activeTab === 'billing') {\n      fetchBilling()\n    }\n  }, [activeTab, selectedView, billingMonth, billingYear, session, groups])\n\n  // Send chat message\n  const handleSendChat = async () => {\n    if (!chatInput.trim() || selectedView === 'personal' || !session?.user?.id) return\n    \n    try {\n      const res = await fetch(`/api/groups/${selectedView}/chat`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ message: chatInput.trim() })\n      })\n      \n      if (res.ok) {\n        const newMessage = await res.json()\n        setChatMessages([...chatMessages, newMessage])\n        setChatInput('')\n      } else {\n        const error = await res.json()\n        alert(error.error || 'Failed to send message')\n      }\n    } catch (error) {\n      console.error('Error sending message:', error)\n    }\n  }\n  \n  // Create new group\n  const handleCreateGroup = async () => {\n    if (isDemo) {\n      setFormError('Please sign in to create a group')\n      return\n    }\n    if (!newGroupName.trim()) {\n      setFormError('Group name is required')\n      return\n    }\n    \n    setFormLoading(true)\n    setFormError('')\n    \n    try {\n      const res = await fetch('/api/groups', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          name: newGroupName,\n          description: newGroupDescription,\n          dryRate: newGroupDryRate ? parseFloat(newGroupDryRate) : null,\n          wetRate: newGroupWetRate ? parseFloat(newGroupWetRate) : null,\n        })\n      })\n      \n      if (res.ok) {\n        const newGroup = await res.json()\n        setGroups([...groups, { ...newGroup, role: 'ADMIN', aircraft: [] }])\n        setShowNewGroupModal(false)\n        setNewGroupName('')\n        setNewGroupDescription('')\n        setNewGroupDryRate('')\n        setNewGroupWetRate('')\n        setSelectedView(newGroup.id)\n      } else {\n        const error = await res.json()\n        setFormError(error.error || 'Failed to create group')\n      }\n    } catch (error) {\n      setFormError('Failed to create group')\n    }\n    \n    setFormLoading(false)\n  }\n  \n  // Add aircraft\n  const handleAddAircraft = async () => {\n    if (isDemo) {\n      setFormError('Please sign in to add aircraft')\n      return\n    }\n    if (isPersonal || !selectedView || selectedView === 'personal') {\n      setFormError('Please select a flying club first')\n      return\n    }\n    if (!aircraftNNumber.trim()) {\n      setFormError('N-Number is required')\n      return\n    }\n    \n    setFormLoading(true)\n    setFormError('')\n    \n    try {\n      const res = await fetch(`/api/groups/${selectedView}/aircraft`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          nNumber: aircraftNNumber,\n          nickname: aircraftNickname || null,\n          make: aircraftMake || null,\n          model: aircraftModel || null,\n          year: aircraftYear ? parseInt(aircraftYear) : null,\n          hourlyRate: aircraftHourlyRate ? parseFloat(aircraftHourlyRate) : null,\n        })\n      })\n      \n      if (res.ok) {\n        const newAircraft = await res.json()\n        // Update groups state\n        setGroups(groups.map(g => \n          g.id === selectedView \n            ? { ...g, aircraft: [...g.aircraft, newAircraft] }\n            : g\n        ))\n        setShowAddAircraftModal(false)\n        resetAircraftForm()\n      } else {\n        const error = await res.json()\n        setFormError(error.error || 'Failed to add aircraft')\n      }\n    } catch (error) {\n      setFormError('Failed to add aircraft')\n    }\n    \n    setFormLoading(false)\n  }\n  \n  // Create booking\n  const handleCreateBooking = async () => {\n    if (isDemo) {\n      setFormError('Please sign in to create a booking')\n      return\n    }\n    if (!bookingAircraftId || !bookingStartTime || !bookingEndTime) {\n      setFormError('Aircraft, start time, and end time are required')\n      return\n    }\n    \n    setFormLoading(true)\n    setFormError('')\n    \n    try {\n      const isPersonalBooking = isPersonal || selectedView === 'personal'\n      const endpoint = isPersonalBooking ? '/api/personal-bookings' : `/api/groups/${selectedView}/bookings`\n      const payload = isPersonalBooking\n        ? {\n            userAircraftId: bookingAircraftId,\n            startTime: bookingStartTime,\n            endTime: bookingEndTime,\n            purpose: bookingPurpose || null,\n          }\n        : {\n            aircraftId: bookingAircraftId,\n            startTime: bookingStartTime,\n            endTime: bookingEndTime,\n            purpose: bookingPurpose || null,\n          }\n\n      const res = await fetch(endpoint, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(payload)\n      })\n      \n      if (res.ok) {\n        const newBooking = await res.json()\n        setBookings([...bookings, newBooking])\n        setShowNewBookingModal(false)\n        resetBookingForm()\n      } else {\n        const error = await res.json()\n        setFormError(error.error || 'Failed to create booking')\n      }\n    } catch (error) {\n      setFormError('Failed to create booking')\n    }\n    \n    setFormLoading(false)\n  }\n  \n  // Report maintenance\n  const handleReportMaintenance = async () => {\n    if (isDemo) {\n      setFormError('Please sign in to report issues')\n      return\n    }\n    if (isPersonal || !selectedView || selectedView === 'personal') {\n      setFormError('Please select a flying club first')\n      return\n    }\n    if (!maintenanceAircraftId || !maintenanceDescription.trim()) {\n      setFormError('Aircraft and description are required')\n      return\n    }\n    \n    setFormLoading(true)\n    setFormError('')\n    \n    try {\n      const res = await fetch('/api/maintenance', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          aircraftId: maintenanceAircraftId,\n          description: maintenanceDescription,\n          notes: maintenanceNotes || null,\n          groupId: selectedView,\n          isGrounded: maintenanceGrounded,\n          postToMarketplace: maintenancePostToMarketplace,\n          postAnonymously: maintenancePostAnonymously,\n        })\n      })\n      \n      if (res.ok) {\n        // Refresh maintenance data\n        const logsRes = await fetch(`/api/groups/${selectedView}/logs`)\n        if (logsRes.ok) {\n          const logsData = await logsRes.json()\n          setMaintenance(logsData.maintenance || [])\n        }\n        setShowReportIssueModal(false)\n        resetMaintenanceForm()\n      } else {\n        const error = await res.json()\n        setFormError(error.error || 'Failed to report issue')\n      }\n    } catch (error) {\n      setFormError('Failed to report issue')\n    }\n    \n    setFormLoading(false)\n  }\n  \n  // Log flight\n  const handleLogFlight = async () => {\n    if (isDemo) {\n      setFormError('Please sign in to log flights')\n      return\n    }\n    if (isPersonal || !selectedView || selectedView === 'personal') {\n      setFormError('Please select a flying club first')\n      return\n    }\n    if (!logAircraftId || !logDate) {\n      setFormError('Aircraft and date are required')\n      return\n    }\n    \n    setFormLoading(true)\n    setFormError('')\n    \n    try {\n      const res = await fetch(`/api/groups/${selectedView}/logs`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          aircraftId: logAircraftId,\n          date: logDate,\n          tachStart: logTachStart ? parseFloat(logTachStart) : null,\n          tachEnd: logTachEnd ? parseFloat(logTachEnd) : null,\n          hobbsStart: logHobbsStart ? parseFloat(logHobbsStart) : null,\n          hobbsEnd: logHobbsEnd ? parseFloat(logHobbsEnd) : null,\n          notes: logNotes || null,\n        })\n      })\n      \n      if (res.ok) {\n        const newLog = await res.json()\n        setFlightLogs([newLog, ...flightLogs])\n        setShowLogFlightModal(false)\n        resetLogFlightForm()\n      } else {\n        const error = await res.json()\n        setFormError(error.error || 'Failed to log flight')\n      }\n    } catch (error) {\n      setFormError('Failed to log flight')\n    }\n    \n    setFormLoading(false)\n  }\n  \n  // Create invite\n  const handleCreateInvite = async () => {\n    if (isDemo) {\n      setFormError('Please sign in to invite members')\n      return\n    }\n    if (isPersonal || !selectedView || selectedView === 'personal') {\n      setFormError('Please select a flying club first')\n      return\n    }\n    setFormLoading(true)\n    setFormError('')\n    \n    try {\n      const res = await fetch(`/api/groups/${selectedView}/invites`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          email: inviteEmail || null,\n          role: inviteRole,\n          expiresInDays: 7,\n        })\n      })\n      \n      if (res.ok) {\n        const invite = await res.json()\n        const inviteLink = `${window.location.origin}/join/${invite.token}`\n        setGeneratedInviteLink(inviteLink)\n        // Refresh invites\n        const invitesRes = await fetch(`/api/groups/${selectedView}/invites`)\n        if (invitesRes.ok) setInvites(await invitesRes.json())\n      } else {\n        const error = await res.json()\n        setFormError(error.error || 'Failed to create invite')\n      }\n    } catch (error) {\n      setFormError('Failed to create invite')\n    }\n    \n    setFormLoading(false)\n  }\n  \n  // Delete invite\n  const handleDeleteInvite = async (inviteId: string) => {\n    try {\n      const res = await fetch(`/api/groups/${selectedView}/invites?inviteId=${inviteId}`, {\n        method: 'DELETE'\n      })\n      if (res.ok) {\n        setInvites(invites.filter(i => i.id !== inviteId))\n      }\n    } catch (error) {\n      console.error('Error deleting invite:', error)\n    }\n  }\n  \n  // Remove member\n  const handleRemoveMember = async (memberId: string) => {\n    if (!confirm('Are you sure you want to remove this member?')) return\n    \n    try {\n      const res = await fetch(`/api/groups/${selectedView}/members?memberId=${memberId}`, {\n        method: 'DELETE'\n      })\n      if (res.ok) {\n        setMembers(members.filter(m => m.id !== memberId))\n      }\n    } catch (error) {\n      console.error('Error removing member:', error)\n    }\n  }\n  \n  // Reset forms\n  const resetAircraftForm = () => {\n    setAircraftNNumber('')\n    setAircraftNickname('')\n    setAircraftMake('')\n    setAircraftModel('')\n    setAircraftYear('')\n    setAircraftHourlyRate('')\n    setFormError('')\n  }\n  \n  const resetBookingForm = () => {\n    setBookingAircraftId('')\n    setBookingStartTime('')\n    setBookingEndTime('')\n    setBookingPurpose('')\n    setFormError('')\n  }\n  \n  const resetMaintenanceForm = () => {\n    setMaintenanceAircraftId('')\n    setMaintenanceDescription('')\n    setMaintenanceNotes('')\n    setMaintenanceGrounded(false)\n    setMaintenancePostToMarketplace(false)\n    setMaintenancePostAnonymously(true)\n    setFormError('')\n  }\n  \n  const resetLogFlightForm = () => {\n    setLogAircraftId('')\n    setLogDate('')\n    setLogTachStart('')\n    setLogTachEnd('')\n    setLogHobbsStart('')\n    setLogHobbsEnd('')\n    setLogNotes('')\n    setFormError('')\n  }\n  \n  const resetInviteForm = () => {\n    setInviteEmail('')\n    setInviteRole('MEMBER')\n    setGeneratedInviteLink('')\n    setFormError('')\n  }\n  \n  // Open booking modal with pre-selected date/aircraft\n  const isDemo = !session?.user?.id\n  const isPersonal = selectedView === 'personal'\n  const selectedGroup = groups.find(g => g.id === selectedView)\n  const isAdmin = selectedGroup?.role === 'ADMIN' || (isDemo && !isPersonal)\n  \n  // Helper to check if actions are allowed (show buttons but may need login)\n  const canPerformActions = !isPersonal // Actions are allowed when a club is selected\n  \n  // Filter data based on selected view\n  const displayAircraft = isPersonal ? personalAircraft : (selectedGroup?.aircraft || [])\n  const displayBookings = isPersonal \n    ? bookings.filter(b => b.source !== 'club')\n    : bookings.filter(b => displayAircraft.some(a => a.id === b.aircraftId))\n  const displayMaintenance = isPersonal ? [] : maintenance\n  const displayMembers = isPersonal ? [] : members\n  const displayFlightLogs = isPersonal ? [] : flightLogs\n\n  const MONTHS = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December']\n\n  if (status === 'loading' || loading) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Header */}\n      <header className=\"border-b border-border bg-card\">\n        <div className=\"mx-auto max-w-[1600px] p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h1 className=\"text-3xl font-bold tracking-tight text-foreground\">Flying Club</h1>\n              <p className=\"text-muted-foreground mt-1\">Manage your aviation group and aircraft</p>\n            </div>\n            <div className=\"flex items-center gap-3\">\n              <select\n                value={selectedView}\n                onChange={(e) => setSelectedView(e.target.value)}\n                className=\"h-10 rounded-lg border border-input bg-background px-3 text-sm min-w-[200px]\"\n              >\n                <option value=\"personal\">ðŸ‘¤ Personal</option>\n                <optgroup label=\"âœˆï¸ Flying Clubs\">\n                  {(isDemo ? demoGroups : groups).map(group => (\n                    <option key={group.id} value={group.id}>{group.name}</option>\n                  ))}\n                </optgroup>\n              </select>\n              <Button\n                size=\"sm\"\n                variant=\"secondary\"\n                asChild\n                className=\"hidden sm:inline-flex\"\n                disabled={isPersonal && !isDemo}\n              >\n                <Link href=\"/modules/flying-club/manage\">Manage</Link>\n              </Button>\n              {/* New Group button - always visible */}\n              <Button size=\"sm\" type=\"button\" onClick={() => setShowNewGroupModal(true)}>\n                <Plus className=\"mr-1 h-3 w-3\" />\n                New Group\n              </Button>\n              <Dialog open={showNewGroupModal} onOpenChange={(open) => { setShowNewGroupModal(open); if (!open) setFormError('') }}>\n                <DialogContent>\n                    <DialogHeader>\n                      <DialogTitle>Create New Flying Club</DialogTitle>\n                      <DialogDescription>\n                        Set up a new flying club to manage aircraft, members, and bookings.\n                      </DialogDescription>\n                    </DialogHeader>\n                    <div className=\"space-y-4 py-4\">\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"groupName\">Club Name *</Label>\n                        <Input \n                          id=\"groupName\" \n                          value={newGroupName} \n                          onChange={(e) => setNewGroupName(e.target.value)}\n                          placeholder=\"e.g., Sky High Flying Club\"\n                        />\n                      </div>\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"groupDescription\">Description</Label>\n                        <Textarea \n                          id=\"groupDescription\" \n                          value={newGroupDescription} \n                          onChange={(e) => setNewGroupDescription(e.target.value)}\n                          placeholder=\"A brief description of your club...\"\n                        />\n                      </div>\n                      <div className=\"grid grid-cols-2 gap-4\">\n                        <div className=\"space-y-2\">\n                          <Label htmlFor=\"dryRate\">Dry Rate ($/hr)</Label>\n                          <Input \n                            id=\"dryRate\" \n                            type=\"number\"\n                            value={newGroupDryRate} \n                            onChange={(e) => setNewGroupDryRate(e.target.value)}\n                            placeholder=\"e.g., 120\"\n                          />\n                        </div>\n                        <div className=\"space-y-2\">\n                          <Label htmlFor=\"wetRate\">Wet Rate ($/hr)</Label>\n                          <Input \n                            id=\"wetRate\" \n                            type=\"number\"\n                            value={newGroupWetRate} \n                            onChange={(e) => setNewGroupWetRate(e.target.value)}\n                            placeholder=\"e.g., 145\"\n                          />\n                        </div>\n                      </div>\n                      {formError && (\n                        <p className=\"text-sm text-destructive\">{formError}</p>\n                      )}\n                    </div>\n                    <DialogFooter>\n                      <Button variant=\"outline\" onClick={() => setShowNewGroupModal(false)}>Cancel</Button>\n                      <Button onClick={handleCreateGroup} disabled={formLoading}>\n                        {formLoading ? <Loader2 className=\"h-4 w-4 animate-spin mr-2\" /> : null}\n                        Create Club\n                      </Button>\n                    </DialogFooter>\n                  </DialogContent>\n                </Dialog>\n            </div>\n          </div>\n\n          {/* Tabs */}\n          <div className=\"mt-6 flex gap-1 border-b border-border overflow-x-auto\">\n            {(['dashboard', 'calendar', 'bookings', 'scheduled', 'aircraft', 'flights', 'maintenance', 'billing', 'members'] as const).map((tab) => (\n              <button\n                key={tab}\n                onClick={() => setActiveTab(tab)}\n                className={`px-4 py-2.5 text-sm font-medium whitespace-nowrap transition-colors relative ${\n                  activeTab === tab\n                    ? 'text-primary'\n                    : 'text-muted-foreground hover:text-foreground'\n                }`}\n              >\n                {tab.charAt(0).toUpperCase() + tab.slice(1)}\n                {activeTab === tab && (\n                  <div className=\"absolute bottom-0 left-0 right-0 h-0.5 bg-primary\" />\n                )}\n              </button>\n            ))}\n          </div>\n        </div>\n      </header>\n\n      {/* Main Content */}\n      <main className=\"mx-auto max-w-[1600px] p-6\">\n        {activeTab === 'dashboard' && (\n          <div className=\"space-y-6\">\n            {/* Stats Overview */}\n            <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\n              <Card \n                className=\"cursor-pointer transition-all hover:shadow-md hover:border-primary/50\"\n                onClick={() => setActiveTab('aircraft')}\n              >\n                <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                  <CardTitle className=\"text-sm font-medium\">Total Aircraft</CardTitle>\n                  <div className=\"rounded-full p-2 bg-primary/10 hover:bg-primary/20 transition-colors\">\n                    <Plane className=\"h-4 w-4 text-primary\" />\n                  </div>\n                </CardHeader>\n                <CardContent>\n            <div className=\"text-2xl font-bold\">{displayAircraft.length}</div>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              {displayAircraft.filter(a => a.status === 'Available').length} available\n            </p>\n                </CardContent>\n              </Card>\n\n              <Card \n                className=\"cursor-pointer transition-all hover:shadow-md hover:border-primary/50\"\n                onClick={() => setActiveTab('bookings')}\n              >\n                <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                  <CardTitle className=\"text-sm font-medium\">Upcoming Bookings</CardTitle>\n                  <div className=\"rounded-full p-2 bg-blue-500/10 hover:bg-blue-500/20 transition-colors\">\n                    <Calendar className=\"h-4 w-4 text-blue-500\" />\n                  </div>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold\">{displayBookings.length}</div>\n                  <p className=\"text-xs text-muted-foreground mt-1\">\n                    {displayBookings.length > 0 ? `Next: ${new Date(displayBookings[0]?.startTime || '').toLocaleDateString()}` : 'No bookings'}\n                  </p>\n                </CardContent>\n              </Card>\n\n              <Card \n                className=\"cursor-pointer transition-all hover:shadow-md hover:border-primary/50\"\n                onClick={() => setActiveTab('members')}\n              >\n                <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                  <CardTitle className=\"text-sm font-medium\">Active Members</CardTitle>\n                  <div className=\"rounded-full p-2 bg-green-500/10 hover:bg-green-500/20 transition-colors\">\n                    <Users className=\"h-4 w-4 text-green-500\" />\n                  </div>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold\">{isPersonal ? 1 : displayMembers.length}</div>\n                  <p className=\"text-xs text-muted-foreground mt-1\">\n                    {isPersonal ? 'Personal account' : `${displayMembers.filter(m => m.role === 'ADMIN').length} admins`}\n                  </p>\n                </CardContent>\n              </Card>\n\n              <Card \n                className=\"cursor-pointer transition-all hover:shadow-md hover:border-primary/50\"\n                onClick={() => setActiveTab('maintenance')}\n              >\n                <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                  <CardTitle className=\"text-sm font-medium\">Maintenance Items</CardTitle>\n                  <div className={`rounded-full p-2 transition-colors ${displayMaintenance.length > 0 ? 'bg-destructive/10 hover:bg-destructive/20' : 'bg-orange-500/10 hover:bg-orange-500/20'}`}>\n                    <Wrench className={`h-4 w-4 ${displayMaintenance.length > 0 ? 'text-destructive' : 'text-orange-500'}`} />\n                  </div>\n                </CardHeader>\n                <CardContent>\n                  <div className={`text-2xl font-bold ${displayMaintenance.length > 0 ? 'text-destructive' : ''}`}>\n                    {displayMaintenance.length}\n                  </div>\n                  <p className=\"text-xs text-muted-foreground mt-1\">\n                    {displayMaintenance.filter(m => m.priority === 'high').length} high priority\n                  </p>\n                </CardContent>\n              </Card>\n            </div>\n\n            {/* Groups Overview - Only show for clubs */}\n            {!isPersonal && (\n            <div className=\"grid gap-6 lg:grid-cols-2\">\n              {/* First column: Groups */}\n              {(selectedView === 'all' ? groups : [selectedGroup].filter(Boolean)).map((group) => group && (\n                <Card key={group.id}>\n                  <CardHeader>\n                    <div className=\"flex items-start justify-between\">\n                      <div>\n                        <CardTitle>{group.name}</CardTitle>\n                        <CardDescription className=\"mt-1\">{group.description}</CardDescription>\n                      </div>\n                      <Button variant=\"ghost\" size=\"icon\">\n                        <MoreVertical className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  </CardHeader>\n                  <CardContent className=\"space-y-4\">\n                    <div className=\"flex items-center gap-4 text-sm\">\n                      <div className=\"flex items-center gap-1.5 text-muted-foreground\">\n                        <Plane className=\"h-4 w-4\" />\n                        <span>{group.aircraft.length} aircraft</span>\n                      </div>\n                      <div className=\"flex items-center gap-1.5 text-muted-foreground\">\n                        <Users className=\"h-4 w-4\" />\n                        <span>{displayMembers.length || group.members} members</span>\n                      </div>\n                    </div>\n\n                    <Separator />\n\n                    <div className=\"space-y-3\">\n                      <div className=\"flex items-center justify-between\">\n                        <p className=\"text-sm font-medium\">Aircraft</p>\n                        {isAdmin && (\n                          <Button variant=\"ghost\" size=\"sm\" type=\"button\" onClick={() => setShowAddAircraftModal(true)}>\n                            <Plus className=\"h-3 w-3 mr-1\" />\n                            Add\n                          </Button>\n                        )}\n                      </div>\n                      {group.aircraft.map((aircraft) => (\n                        <div key={aircraft.id} className=\"flex items-center justify-between rounded-lg border border-border p-3\">\n                          <div className=\"space-y-1\">\n                            <div className=\"flex items-center gap-2\">\n                              <p className=\"font-medium text-sm\">{aircraft.nNumber}</p>\n                              <Badge variant={aircraft.status === 'Available' ? 'secondary' : 'destructive'} className=\"text-xs\">\n                                {aircraft.status}\n                              </Badge>\n                            </div>\n                            <p className=\"text-xs text-muted-foreground\">\n                              {aircraft.year} {aircraft.make} {aircraft.model}\n                            </p>\n                          </div>\n                          <div className=\"text-right\">\n                            <p className=\"text-sm font-semibold\">${aircraft.hourlyRate}/hr</p>\n                            <p className=\"text-xs text-muted-foreground\">{aircraft.hobbsHours} hrs</p>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n\n                    <Button variant=\"outline\" className=\"w-full\" onClick={() => setActiveTab('aircraft')}>\n                      View All Aircraft\n                    </Button>\n                  </CardContent>\n                </Card>\n              ))}\n\n              {/* Second column: Group Chat when only 1 or fewer clubs */}\n              {(selectedView === 'all' ? groups : [selectedGroup].filter(Boolean)).length < 2 && (\n                <Card className=\"flex flex-col h-[500px]\">\n                  <CardHeader className=\"pb-3\">\n                    <div className=\"flex items-center justify-between\">\n                      <div>\n                        <CardTitle className=\"text-lg\">Group Chat</CardTitle>\n                        <CardDescription>Chat with club members</CardDescription>\n                      </div>\n                      <Button variant=\"ghost\" size=\"sm\">\n                        <MoreVertical className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  </CardHeader>\n                  <CardContent className=\"flex-1 flex flex-col p-0\">\n                    {/* Chat Messages */}\n                    <div className=\"flex-1 overflow-y-auto p-4 space-y-4\">\n                      {chatMessages.length > 0 ? (\n                        chatMessages.map((msg) => (\n                          <div key={msg.id} className=\"flex gap-3\">\n                            <div className={`h-8 w-8 rounded-full flex items-center justify-center text-white text-xs ${msg.user.color || 'bg-primary'}`}>\n                              {msg.user.initials}\n                            </div>\n                            <div className=\"flex-1 space-y-1\">\n                              <div className=\"flex items-center gap-2\">\n                                <p className=\"text-sm font-medium\">{msg.user.name}</p>\n                                <span className=\"text-xs text-muted-foreground\">{new Date(msg.timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>\n                              </div>\n                              <p className=\"text-sm text-muted-foreground bg-muted p-2 rounded-lg rounded-tl-none\">{msg.message}</p>\n                            </div>\n                          </div>\n                        ))\n                      ) : (\n                        <div className=\"text-center text-muted-foreground py-8\">\n                          <p className=\"text-sm\">No messages yet</p>\n                          <p className=\"text-xs\">Start a conversation with your club</p>\n                        </div>\n                      )}\n                    </div>\n                    \n                    {/* Chat Input */}\n                    <div className=\"p-3 border-t\">\n                      <div className=\"flex gap-2\">\n                        <Input \n                          placeholder=\"Type a message...\" \n                          className=\"flex-1\"\n                          value={chatInput}\n                          onChange={(e) => setChatInput(e.target.value)}\n                          onKeyPress={(e) => e.key === 'Enter' && handleSendChat()}\n                          disabled={!session?.user?.id || selectedView === 'personal'}\n                        />\n                        <Button \n                          size=\"sm\" \n                          disabled={!session?.user?.id || selectedView === 'personal' || !chatInput.trim()}\n                          onClick={handleSendChat}\n                        >\n                          Send\n                        </Button>\n                      </div>\n                      {selectedView === 'personal' ? (\n                        <p className=\"text-xs text-muted-foreground mt-2 text-center\">Select a club to chat with members</p>\n                      ) : !session?.user?.id && (\n                        <p className=\"text-xs text-muted-foreground mt-2 text-center\">Sign in to chat</p>\n                      )}\n                    </div>\n                  </CardContent>\n                </Card>\n              )}\n            </div>\n            )}\n\n            {/* Upcoming Bookings, Maintenance & Checkout */}\n            <div className=\"grid gap-6 xl:grid-cols-[2fr,1fr]\">\n              <div className=\"space-y-6\">\n                <Card>\n                  <CardHeader>\n                    <div className=\"flex items-center justify-between\">\n                      <CardTitle>Upcoming Bookings</CardTitle>\n                      <Button variant=\"ghost\" size=\"sm\" onClick={() => setActiveTab('bookings')}>View All</Button>\n                    </div>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"space-y-3\">\n                      {displayBookings.slice(0, 5).map((booking) => (\n                        <div key={booking.id} className=\"flex items-center justify-between rounded-lg border border-border p-3\">\n                          <div className=\"space-y-1\">\n                            <div className=\"flex items-center gap-2\">\n                              <p className=\"font-medium text-sm\">{booking.aircraft?.nNumber || booking.aircraftId}</p>\n                              <span className=\"text-xs text-muted-foreground\">â€¢</span>\n                              <p className=\"text-sm text-muted-foreground\">{booking.user?.name || 'Unknown'}</p>\n                            </div>\n                            <p className=\"text-xs text-muted-foreground\">{booking.purpose}</p>\n                          </div>\n                          <div className=\"text-right\">\n                            <p className=\"text-sm font-medium\">{booking.startTime ? new Date(booking.startTime).toLocaleDateString() : 'N/A'}</p>\n                            <p className=\"text-xs text-muted-foreground\">{booking.startTime && booking.endTime ? `${new Date(booking.startTime).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})} - ${new Date(booking.endTime).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}` : 'N/A'}</p>\n                          </div>\n                        </div>\n                      ))}\n                      {displayBookings.length === 0 && (\n                        <p className=\"text-sm text-muted-foreground text-center py-4\">No upcoming bookings</p>\n                      )}\n                    </div>\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardHeader>\n                    <div className=\"flex items-center justify-between\">\n                      <CardTitle>Maintenance Status</CardTitle>\n                      <Button variant=\"ghost\" size=\"sm\" onClick={() => setActiveTab('maintenance')}>View All</Button>\n                    </div>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"space-y-3\">\n                      {displayMaintenance.slice(0, 5).map((item) => (\n                        <div key={item.id} className=\"flex items-center justify-between rounded-lg border border-border p-3\">\n                          <div className=\"space-y-1\">\n                            <div className=\"flex items-center gap-2\">\n                              <p className=\"font-medium text-sm\">{item.aircraft?.nNumber || item.aircraftId}</p>\n                              <Badge variant={item.status === 'In Progress' ? 'default' : 'secondary'} className=\"text-xs\">\n                                {item.status}\n                              </Badge>\n                            </div>\n                            <p className=\"text-xs text-muted-foreground\">{item.description}</p>\n                          </div>\n                          <div className=\"text-right\">\n                            <p className=\"text-sm font-medium\">Due: {item.dueDate || 'N/A'}</p>\n                            {item.priority === 'high' && (\n                              <div className=\"flex items-center justify-end gap-1 mt-1\">\n                                <AlertCircle className=\"h-3 w-3 text-destructive\" />\n                                <p className=\"text-xs text-destructive\">High Priority</p>\n                              </div>\n                            )}\n                          </div>\n                        </div>\n                      ))}\n                      {displayMaintenance.length === 0 && (\n                        <p className=\"text-sm text-muted-foreground text-center py-4\">No maintenance items</p>\n                      )}\n                    </div>\n                  </CardContent>\n                </Card>\n              </div>\n\n              {!isPersonal && selectedGroup ? (\n                <CheckoutPanel groupId={selectedView} userId={session?.user?.id as string | undefined} />\n              ) : (\n                <Card>\n                  <CardContent className=\"py-12 text-center text-muted-foreground\">\n                    Sign in and select a club to use mobile checkout.\n                  </CardContent>\n                </Card>\n              )}\n            </div>\n          </div>\n        )}\n\n        {activeTab === 'calendar' && (\n          <div className=\"space-y-4\">\n            {isPersonal ? (\n              <Card>\n                <CardHeader>\n                  <CardTitle>Flight Schedule</CardTitle>\n                  <CardDescription>Select a flying club to view its shared schedule.</CardDescription>\n                </CardHeader>\n                <CardContent>\n                  <p className=\"text-sm text-muted-foreground\">\n                    The calendar is only available for club aircraft. Switch to one of your clubs or create a new club to begin managing shared bookings.\n                  </p>\n                </CardContent>\n              </Card>\n            ) : selectedGroup ? (\n              <BookingCalendar groupId={selectedView} isAdmin={isAdmin} />\n            ) : (\n              <Card>\n                <CardContent className=\"py-10 text-center text-muted-foreground\">\n                  Select a club to view its calendar.\n                </CardContent>\n              </Card>\n            )}\n          </div>\n        )}\n\n        {activeTab === 'aircraft' && (\n          <div className=\"space-y-4\">\n            {isAdmin && canPerformActions && (\n              <div className=\"flex justify-end\">\n                <Button onClick={() => setShowAddAircraftModal(true)}>\n                  <Plus className=\"h-4 w-4 mr-2\" />\n                  Add Aircraft\n                </Button>\n              </div>\n            )}\n            <div className=\"grid gap-6 md:grid-cols-2 lg:grid-cols-3\">\n              {displayAircraft.map((aircraft) => (\n                <Card key={aircraft.id}>\n                  <CardHeader>\n                    <div className=\"flex items-start justify-between\">\n                      <div>\n                        <CardTitle className=\"flex items-center gap-2\">\n                          {aircraft.nNumber}\n                          <Badge variant={aircraft.status === 'Available' ? 'secondary' : 'destructive'}>\n                            {aircraft.status}\n                          </Badge>\n                        </CardTitle>\n                        <CardDescription className=\"mt-1\">\n                          {aircraft.year} {aircraft.make} {aircraft.model}\n                        </CardDescription>\n                      </div>\n                    </div>\n                  </CardHeader>\n                  <CardContent className=\"space-y-4\">\n                    <div className=\"flex items-center gap-4 text-sm\">\n                      <div className=\"flex items-center gap-1.5\">\n                        <DollarSign className=\"h-4 w-4 text-muted-foreground\" />\n                        <span>${aircraft.hourlyRate}/hr</span>\n                      </div>\n                      <div className=\"flex items-center gap-1.5\">\n                        <Clock className=\"h-4 w-4 text-muted-foreground\" />\n                        <span>{aircraft.hobbsHours} hrs</span>\n                      </div>\n                    </div>\n\n                    <Separator />\n\n                    <div className=\"space-y-2\">\n                      <div className=\"flex items-center justify-between text-sm\">\n                        <span className=\"text-muted-foreground\">Next Maintenance</span>\n                        <span className=\"font-medium\">250 hrs</span>\n                      </div>\n                      <Progress value={75} className=\"h-2\" />\n                    </div>\n\n                    <div className=\"flex gap-2\">\n                      <Button \n                        variant=\"outline\" \n                        className=\"flex-1\"\n                        onClick={() => {\n                          if (canPerformActions) {\n                            const now = new Date()\n                            const startIso = now.toISOString().slice(0, 16)\n                            const endIso = new Date(now.getTime() + 2 * 60 * 60 * 1000).toISOString().slice(0, 16)\n                            setBookingAircraftId(aircraft.id)\n                            setBookingStartTime(startIso)\n                            setBookingEndTime(endIso)\n                            setBookingPurpose('')\n                            setShowNewBookingModal(true)\n                          }\n                        }}\n                        disabled={aircraft.status !== 'Available' || isPersonal}\n                      >\n                        <Calendar className=\"mr-2 h-4 w-4\" />\n                        Book\n                      </Button>\n                      <Button variant=\"outline\" size=\"icon\">\n                        <MoreVertical className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {activeTab === 'bookings' && (\n          <Card>\n            <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                <CardTitle>All Bookings</CardTitle>\n                <div className=\"flex items-center gap-2\">\n                  <Button variant=\"outline\" size=\"sm\">\n                    <Filter className=\"mr-2 h-4 w-4\" />\n                    Filter\n                  </Button>\n                  {canPerformActions && (\n                    <Button size=\"sm\" type=\"button\" onClick={() => setShowNewBookingModal(true)}>\n                      <Plus className=\"mr-2 h-4 w-4\" />\n                      New Booking\n                    </Button>\n                  )}\n                </div>\n              </div>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-2\">\n                {displayBookings.map((booking) => (\n                  <div key={booking.id} className=\"flex items-center justify-between rounded-lg border border-border p-4\">\n                    <div className=\"flex items-center gap-4\">\n                      <div className=\"flex h-10 w-10 items-center justify-center rounded-lg bg-primary/10\">\n                        <Plane className=\"h-5 w-5 text-primary\" />\n                      </div>\n                      <div className=\"space-y-1\">\n                        <p className=\"font-medium text-sm\">{booking.aircraft?.nNumber || booking.aircraftId}</p>\n                        <p className=\"text-xs text-muted-foreground\">{booking.purpose}</p>\n                      </div>\n                    </div>\n                    <div className=\"flex items-center gap-6\">\n                      <div className=\"text-right\">\n                        <p className=\"text-sm font-medium\">{booking.user?.name || 'Unknown'}</p>\n                        <p className=\"text-xs text-muted-foreground\">{booking.startTime ? new Date(booking.startTime).toLocaleDateString() : 'N/A'}</p>\n                      </div>\n                      <Button variant=\"ghost\" size=\"icon\">\n                        <MoreVertical className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  </div>\n                ))}\n                {displayBookings.length === 0 && (\n                  <p className=\"text-sm text-muted-foreground text-center py-8\">No bookings yet</p>\n                )}\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {activeTab === 'scheduled' && (\n          <>\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <h2 className=\"text-lg font-semibold\">Scheduled Flights</h2>\n                <p className=\"text-xs text-muted-foreground\">Your upcoming flights across personal and club aircraft</p>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <select\n                  className=\"h-8 rounded-md border border-input bg-background px-2 text-xs\"\n                  value={scheduledWindow}\n                  onChange={(e) => setScheduledWindow(e.target.value as '7' | '30' | 'all')}\n                >\n                  <option value=\"7\">Next 7 days</option>\n                  <option value=\"30\">Next 30 days</option>\n                  <option value=\"all\">All upcoming</option>\n                </select>\n                <Button size=\"sm\" variant=\"outline\" onClick={() => setActiveTab('bookings')}>\n                  View Calendar\n                </Button>\n              </div>\n            </div>\n\n            {scheduledError && <div className=\"text-xs text-destructive\">{scheduledError}</div>}\n            {isScheduledLoading && !scheduledError && <div className=\"text-xs text-muted-foreground\">Loadingâ€¦</div>}\n\n            <Card>\n              <CardContent className=\"p-0\">\n                <table className=\"w-full text-xs\">\n                  <thead>\n                    <tr className=\"border-b border-border bg-muted/40\">\n                      <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">Aircraft</th>\n                      <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">Type</th>\n                      <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">Start</th>\n                      <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">End</th>\n                      <th className=\"px-4 py-3 text-left font-medium text-muted-foreground\">Purpose</th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"divide-y divide-border\">\n                    {scheduledBookings.length === 0 && !isScheduledLoading ? (\n                      <tr>\n                        <td className=\"px-4 py-6 text-center text-muted-foreground\" colSpan={5}>\n                          No scheduled flights\n                        </td>\n                      </tr>\n                    ) : (\n                      scheduledBookings.map((booking) => (\n                        <tr key={booking.id} className=\"hover:bg-muted/30 transition-colors\">\n                          <td className=\"px-4 py-3\">\n                            <div className=\"flex items-center gap-2\">\n                              <span className=\"font-medium text-foreground\">{booking.aircraft?.nNumber || 'Aircraft'}</span>\n                              <Badge variant=\"outline\" className=\"text-[10px]\">\n                                {booking.groupName ? `Club: ${booking.groupName}` : 'Personal'}\n                              </Badge>\n                            </div>\n                          </td>\n                          <td className=\"px-4 py-3 text-muted-foreground\">\n                            {[booking.aircraft?.make, booking.aircraft?.model].filter(Boolean).join(' ') || 'â€”'}\n                          </td>\n                          <td className=\"px-4 py-3 text-muted-foreground\">\n                            {new Date(booking.startTime).toLocaleString()}\n                          </td>\n                          <td className=\"px-4 py-3 text-muted-foreground\">\n                            {new Date(booking.endTime).toLocaleString()}\n                          </td>\n                          <td className=\"px-4 py-3 text-muted-foreground\">{booking.purpose || 'â€”'}</td>\n                        </tr>\n                      ))\n                    )}\n                  </tbody>\n                </table>\n              </CardContent>\n            </Card>\n          </>\n        )}\n\n        {activeTab === 'maintenance' && (\n          <Card>\n            <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                <CardTitle>Maintenance Tracking</CardTitle>\n                {canPerformActions && (\n                  <>\n                  <Button size=\"sm\" type=\"button\" onClick={() => setShowReportIssueModal(true)}>\n                    <Plus className=\"mr-2 h-4 w-4\" />\n                    Report Issue\n                  </Button>\n                  <Dialog open={showReportIssueModal} onOpenChange={(open) => { setShowReportIssueModal(open); if (!open) resetMaintenanceForm() }}>\n                    <DialogContent>\n                      <DialogHeader>\n                        <DialogTitle>Report Maintenance Issue</DialogTitle>\n                        <DialogDescription>\n                          Report a maintenance issue or squawk for an aircraft.\n                        </DialogDescription>\n                      </DialogHeader>\n                      <div className=\"space-y-4 py-4\">\n                        <div className=\"space-y-2\">\n                          <Label htmlFor=\"maintenanceAircraft\">Aircraft *</Label>\n                          <select\n                            id=\"maintenanceAircraft\"\n                            value={maintenanceAircraftId}\n                            onChange={(e) => setMaintenanceAircraftId(e.target.value)}\n                            className=\"w-full h-10 rounded-lg border border-input bg-background px-3 text-sm\"\n                          >\n                            <option value=\"\">Select aircraft...</option>\n                            {displayAircraft.map(aircraft => (\n                              <option key={aircraft.id} value={aircraft.id}>\n                                {aircraft.nNumber} - {aircraft.make} {aircraft.model}\n                              </option>\n                            ))}\n                          </select>\n                        </div>\n                        <div className=\"space-y-2\">\n                          <Label htmlFor=\"description\">Description *</Label>\n                          <Textarea \n                            id=\"description\" \n                            value={maintenanceDescription} \n                            onChange={(e) => setMaintenanceDescription(e.target.value)}\n                            placeholder=\"Describe the issue...\"\n                          />\n                        </div>\n                        <div className=\"space-y-2\">\n                          <Label>Quick Select</Label>\n                          <div className=\"flex flex-wrap gap-2\">\n                            {['Oil top-up needed', 'Low tire pressure', 'Rough idle', 'Alternator issue', 'Radio static'].map(issue => (\n                              <Button \n                                key={issue}\n                                variant=\"outline\" \n                                size=\"sm\"\n                                onClick={() => setMaintenanceDescription(issue)}\n                              >\n                                {issue}\n                              </Button>\n                            ))}\n                          </div>\n                        </div>\n                        <div className=\"space-y-2\">\n                          <Label htmlFor=\"notes\">Additional Notes</Label>\n                          <Textarea \n                            id=\"notes\" \n                            value={maintenanceNotes} \n                            onChange={(e) => setMaintenanceNotes(e.target.value)}\n                            placeholder=\"Any additional details...\"\n                          />\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                          <input\n                            type=\"checkbox\"\n                            id=\"grounded\"\n                            checked={maintenanceGrounded}\n                            onChange={(e) => setMaintenanceGrounded(e.target.checked)}\n                            className=\"h-4 w-4\"\n                          />\n                          <Label htmlFor=\"grounded\" className=\"text-sm font-normal\">\n                            Ground aircraft (prevents new bookings)\n                          </Label>\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                          <input\n                            type=\"checkbox\"\n                            id=\"postToMarketplace\"\n                            checked={maintenancePostToMarketplace}\n                            onChange={(e) => setMaintenancePostToMarketplace(e.target.checked)}\n                            className=\"h-4 w-4\"\n                          />\n                          <Label htmlFor=\"postToMarketplace\" className=\"text-sm font-normal\">\n                            Post to mechanic marketplace\n                          </Label>\n                        </div>\n                        {maintenancePostToMarketplace && (\n                          <div className=\"flex items-center gap-2 pl-6\">\n                            <input\n                              type=\"checkbox\"\n                              id=\"postAnonymous\"\n                              checked={maintenancePostAnonymously}\n                              onChange={(e) => setMaintenancePostAnonymously(e.target.checked)}\n                              className=\"h-4 w-4\"\n                            />\n                            <Label htmlFor=\"postAnonymous\" className=\"text-sm font-normal\">\n                              Hide my identity\n                            </Label>\n                          </div>\n                        )}\n                        {formError && (\n                          <p className=\"text-sm text-destructive\">{formError}</p>\n                        )}\n                      </div>\n                      <DialogFooter>\n                        <Button variant=\"outline\" onClick={() => setShowReportIssueModal(false)}>Cancel</Button>\n                        <Button onClick={handleReportMaintenance} disabled={formLoading}>\n                          {formLoading ? <Loader2 className=\"h-4 w-4 animate-spin mr-2\" /> : null}\n                          Report Issue\n                        </Button>\n                      </DialogFooter>\n                    </DialogContent>\n                  </Dialog>\n                  </>\n                )}\n              </div>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-2\">\n                {displayMaintenance.map((item) => (\n                  <div key={item.id} className=\"flex items-center justify-between rounded-lg border border-border p-4\">\n                    <div className=\"flex items-center gap-4\">\n                      <div className={`flex h-10 w-10 items-center justify-center rounded-lg ${\n                        item.priority === 'high' ? 'bg-destructive/10' : 'bg-muted'\n                      }`}>\n                        <Wrench className={`h-5 w-5 ${item.priority === 'high' ? 'text-destructive' : 'text-muted-foreground'}`} />\n                      </div>\n                      <div className=\"space-y-1\">\n                        <div className=\"flex items-center gap-2\">\n                          <p className=\"font-medium text-sm\">{item.aircraft?.nNumber || item.aircraftId}</p>\n                          <Badge variant={item.status === 'In Progress' ? 'default' : 'secondary'}>\n                            {item.status}\n                          </Badge>\n                          {item.isGrounded && (\n                            <Badge variant=\"destructive\">Grounded</Badge>\n                          )}\n                        </div>\n                        <p className=\"text-xs text-muted-foreground\">{item.description}</p>\n                      </div>\n                    </div>\n                    <div className=\"flex items-center gap-6\">\n                      <div className=\"text-right\">\n                        <p className=\"text-sm font-medium\">Due: {item.dueDate || 'N/A'}</p>\n                        {item.priority === 'high' && (\n                          <div className=\"flex items-center justify-end gap-1 mt-1\">\n                            <AlertCircle className=\"h-3 w-3 text-destructive\" />\n                            <p className=\"text-xs text-destructive\">High Priority</p>\n                          </div>\n                        )}\n                      </div>\n                      <Button variant=\"ghost\" size=\"icon\">\n                        <MoreVertical className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  </div>\n                ))}\n                {displayMaintenance.length === 0 && (\n                  <p className=\"text-sm text-muted-foreground text-center py-8\">No maintenance items</p>\n                )}\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {activeTab === 'flights' && (\n          <Card>\n            <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                <CardTitle>Flight Logs</CardTitle>\n                {canPerformActions && (\n                  <>\n                  <Button size=\"sm\" type=\"button\" onClick={() => setShowLogFlightModal(true)}>\n                    <Plus className=\"mr-2 h-4 w-4\" />\n                    Log Flight\n                  </Button>\n                  <Dialog open={showLogFlightModal} onOpenChange={(open) => { setShowLogFlightModal(open); if (!open) resetLogFlightForm() }}>\n                    <DialogContent>\n                      <DialogHeader>\n                        <DialogTitle>Log Flight</DialogTitle>\n                        <DialogDescription>\n                          Record your flight details.\n                        </DialogDescription>\n                      </DialogHeader>\n                      <div className=\"space-y-4 py-4\">\n                        <div className=\"grid grid-cols-2 gap-4\">\n                          <div className=\"space-y-2\">\n                            <Label htmlFor=\"logAircraft\">Aircraft *</Label>\n                            <select\n                              id=\"logAircraft\"\n                              value={logAircraftId}\n                              onChange={(e) => setLogAircraftId(e.target.value)}\n                              className=\"w-full h-10 rounded-lg border border-input bg-background px-3 text-sm\"\n                            >\n                              <option value=\"\">Select aircraft...</option>\n                              {displayAircraft.map(aircraft => (\n                                <option key={aircraft.id} value={aircraft.id}>\n                                  {aircraft.nNumber}\n                                </option>\n                              ))}\n                            </select>\n                          </div>\n                          <div className=\"space-y-2\">\n                            <Label htmlFor=\"logDate\">Date *</Label>\n                            <Input \n                              id=\"logDate\" \n                              type=\"date\"\n                              value={logDate} \n                              onChange={(e) => setLogDate(e.target.value)}\n                            />\n                          </div>\n                        </div>\n                        <div className=\"grid grid-cols-2 gap-4\">\n                          <div className=\"space-y-2\">\n                            <Label htmlFor=\"tachStart\">Tach Start</Label>\n                            <Input \n                              id=\"tachStart\" \n                              type=\"number\"\n                              step=\"0.1\"\n                              value={logTachStart} \n                              onChange={(e) => setLogTachStart(e.target.value)}\n                              placeholder=\"e.g., 1234.5\"\n                            />\n                          </div>\n                          <div className=\"space-y-2\">\n                            <Label htmlFor=\"tachEnd\">Tach End</Label>\n                            <Input \n                              id=\"tachEnd\" \n                              type=\"number\"\n                              step=\"0.1\"\n                              value={logTachEnd} \n                              onChange={(e) => setLogTachEnd(e.target.value)}\n                              placeholder=\"e.g., 1236.0\"\n                            />\n                          </div>\n                        </div>\n                        <div className=\"grid grid-cols-2 gap-4\">\n                          <div className=\"space-y-2\">\n                            <Label htmlFor=\"hobbsStart\">Hobbs Start</Label>\n                            <Input \n                              id=\"hobbsStart\" \n                              type=\"number\"\n                              step=\"0.1\"\n                              value={logHobbsStart} \n                              onChange={(e) => setLogHobbsStart(e.target.value)}\n                              placeholder=\"e.g., 456.7\"\n                            />\n                          </div>\n                          <div className=\"space-y-2\">\n                            <Label htmlFor=\"hobbsEnd\">Hobbs End</Label>\n                            <Input \n                              id=\"hobbsEnd\" \n                              type=\"number\"\n                              step=\"0.1\"\n                              value={logHobbsEnd} \n                              onChange={(e) => setLogHobbsEnd(e.target.value)}\n                              placeholder=\"e.g., 458.5\"\n                            />\n                          </div>\n                        </div>\n                        <div className=\"space-y-2\">\n                          <Label htmlFor=\"logNotes\">Notes</Label>\n                          <Textarea \n                            id=\"logNotes\" \n                            value={logNotes} \n                            onChange={(e) => setLogNotes(e.target.value)}\n                            placeholder=\"Route, weather, remarks...\"\n                          />\n                        </div>\n                        {formError && (\n                          <p className=\"text-sm text-destructive\">{formError}</p>\n                        )}\n                      </div>\n                      <DialogFooter>\n                        <Button variant=\"outline\" onClick={() => setShowLogFlightModal(false)}>Cancel</Button>\n                        <Button onClick={handleLogFlight} disabled={formLoading}>\n                          {formLoading ? <Loader2 className=\"h-4 w-4 animate-spin mr-2\" /> : null}\n                          Log Flight\n                        </Button>\n                      </DialogFooter>\n                    </DialogContent>\n                  </Dialog>\n                  </>\n                )}\n              </div>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-2\">\n                {displayFlightLogs.map((log) => (\n                  <div key={log.id} className=\"flex items-center justify-between rounded-lg border border-border p-4\">\n                    <div className=\"flex items-center gap-4\">\n                      <div className=\"flex h-10 w-10 items-center justify-center rounded-lg bg-primary/10\">\n                        <BookOpen className=\"h-5 w-5 text-primary\" />\n                      </div>\n                      <div className=\"space-y-1\">\n                        <p className=\"font-medium text-sm\">{log.aircraft?.nNumber || log.aircraftId}</p>\n                        <p className=\"text-xs text-muted-foreground\">{log.notes || 'No notes'}</p>\n                      </div>\n                    </div>\n                    <div className=\"flex items-center gap-6\">\n                      <div className=\"text-right\">\n                        <p className=\"text-sm font-medium\">{log.user?.name || 'Unknown'}</p>\n                        <p className=\"text-xs text-muted-foreground\">\n                          {new Date(log.date).toLocaleDateString()} â€¢ {log.hobbsTime || 0}h Hobbs\n                        </p>\n                      </div>\n                      <Button variant=\"ghost\" size=\"icon\">\n                        <MoreVertical className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  </div>\n                ))}\n                {displayFlightLogs.length === 0 && (\n                  <div className=\"flex flex-col items-center justify-center py-12 text-center\">\n                    <div className=\"rounded-full bg-muted p-4 mb-4\">\n                      <BookOpen className=\"h-8 w-8 text-muted-foreground\" />\n                    </div>\n                    <h3 className=\"text-lg font-semibold mb-2\">No flight logs yet</h3>\n                    <p className=\"text-sm text-muted-foreground mb-4\">Get started by logging your first flight</p>\n                    {canPerformActions && (\n                      <Button onClick={() => setShowLogFlightModal(true)}>\n                        <Plus className=\"mr-2 h-4 w-4\" />\n                        Log Flight\n                      </Button>\n                    )}\n                  </div>\n                )}\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {activeTab === 'billing' && (\n          <Card>\n            <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                <CardTitle>Monthly Billing</CardTitle>\n                <div className=\"flex items-center gap-2\">\n                  <select\n                    value={billingMonth}\n                    onChange={(e) => setBillingMonth(parseInt(e.target.value))}\n                    className=\"h-10 rounded-lg border border-input bg-background px-3 text-sm\"\n                  >\n                    {MONTHS.map((month, i) => (\n                      <option key={i} value={i}>{month}</option>\n                    ))}\n                  </select>\n                  <select\n                    value={billingYear}\n                    onChange={(e) => setBillingYear(parseInt(e.target.value))}\n                    className=\"h-10 rounded-lg border border-input bg-background px-3 text-sm\"\n                  >\n                    {[2024, 2025, 2026].map(year => (\n                      <option key={year} value={year}>{year}</option>\n                    ))}\n                  </select>\n                  <Button variant=\"outline\" size=\"sm\">\n                    <Download className=\"mr-2 h-4 w-4\" />\n                    Export\n                  </Button>\n                </div>\n              </div>\n            </CardHeader>\n            <CardContent>\n              {!isAdmin ? (\n                <p className=\"text-sm text-muted-foreground text-center py-8\">Only admins can view billing</p>\n              ) : billingData || isDemo ? (\n                <div className=\"space-y-6\">\n                  {isAdmin && !isPersonal && !isDemo && (\n                    <BillingRunButton groupId={selectedView} clubName={selectedGroup?.name} />\n                  )}\n\n                  {/* Summary */}\n                  <div className=\"grid grid-cols-4 gap-4\">\n                    <div className=\"rounded-lg border p-4\">\n                      <p className=\"text-sm text-muted-foreground\">Total Members</p>\n                      <p className=\"text-2xl font-bold\">{(billingData || demoBillingData).totalMembers}</p>\n                    </div>\n                    <div className=\"rounded-lg border p-4\">\n                      <p className=\"text-sm text-muted-foreground\">Total Flights</p>\n                      <p className=\"text-2xl font-bold\">{(billingData || demoBillingData).totalFlights}</p>\n                    </div>\n                    <div className=\"rounded-lg border p-4\">\n                      <p className=\"text-sm text-muted-foreground\">Total Hobbs</p>\n                      <p className=\"text-2xl font-bold\">{(billingData || demoBillingData).totalHobbs.toFixed(1)}h</p>\n                    </div>\n                    <div className=\"rounded-lg border p-4\">\n                      <p className=\"text-sm text-muted-foreground\">Total Billed</p>\n                      <p className=\"text-2xl font-bold\">${(billingData || demoBillingData).totalCost.toFixed(2)}</p>\n                    </div>\n                  </div>\n                  \n                  {/* Member breakdown */}\n                  <div className=\"space-y-2\">\n                    {(billingData || demoBillingData).members.map((member) => (\n                      <div key={member.userId} className=\"rounded-lg border p-4\">\n                        <div className=\"flex items-center justify-between\">\n                          <div>\n                            <p className=\"font-medium\">{member.name}</p>\n                            <p className=\"text-sm text-muted-foreground\">{member.email}</p>\n                          </div>\n                          <div className=\"text-right\">\n                            <p className=\"text-lg font-bold\">${member.totalCost.toFixed(2)}</p>\n                            <p className=\"text-sm text-muted-foreground\">\n                              {member.flights} flights â€¢ {member.totalHobbs.toFixed(1)}h\n                            </p>\n                          </div>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              ) : (\n                <div className=\"flex flex-col items-center justify-center py-12 text-center\">\n                  <div className=\"rounded-full bg-muted p-4 mb-4\">\n                    <DollarSign className=\"h-8 w-8 text-muted-foreground\" />\n                  </div>\n                  <h3 className=\"text-lg font-semibold mb-2\">No billing data</h3>\n                  <p className=\"text-sm text-muted-foreground\">No flights recorded for this period</p>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        )}\n\n        {activeTab === 'members' && (\n          <Card>\n            <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                <CardTitle>Members</CardTitle>\n                {isAdmin && canPerformActions && (\n                  <>\n                  <Button size=\"sm\" type=\"button\" onClick={() => setShowInviteModal(true)}>\n                    <UserPlus className=\"mr-2 h-4 w-4\" />\n                    Invite Member\n                  </Button>\n                  <Dialog open={showInviteModal} onOpenChange={(open) => { setShowInviteModal(open); if (!open) resetInviteForm() }}>\n                    <DialogContent>\n                      <DialogHeader>\n                        <DialogTitle>Invite Member</DialogTitle>\n                        <DialogDescription>\n                          Create an invite link or send directly to an email.\n                        </DialogDescription>\n                      </DialogHeader>\n                      <div className=\"space-y-4 py-4\">\n                        <div className=\"space-y-2\">\n                          <Label htmlFor=\"inviteEmail\">Email (optional)</Label>\n                          <Input \n                            id=\"inviteEmail\" \n                            type=\"email\"\n                            value={inviteEmail} \n                            onChange={(e) => setInviteEmail(e.target.value)}\n                            placeholder=\"member@example.com\"\n                          />\n                          <p className=\"text-xs text-muted-foreground\">Leave blank to generate a shareable link</p>\n                        </div>\n                        <div className=\"space-y-2\">\n                          <Label htmlFor=\"inviteRole\">Role</Label>\n                          <select\n                            id=\"inviteRole\"\n                            value={inviteRole}\n                            onChange={(e) => setInviteRole(e.target.value)}\n                            className=\"w-full h-10 rounded-lg border border-input bg-background px-3 text-sm\"\n                          >\n                            <option value=\"MEMBER\">Member</option>\n                            <option value=\"ADMIN\">Admin</option>\n                          </select>\n                        </div>\n                        {generatedInviteLink && (\n                          <div className=\"space-y-2\">\n                            <Label>Invite Link</Label>\n                            <div className=\"flex gap-2\">\n                              <Input value={generatedInviteLink} readOnly />\n                              <Button \n                                variant=\"outline\" \n                                size=\"icon\"\n                                onClick={() => {\n                                  navigator.clipboard.writeText(generatedInviteLink)\n                                  alert('Copied to clipboard!')\n                                }}\n                              >\n                                <Copy className=\"h-4 w-4\" />\n                              </Button>\n                            </div>\n                          </div>\n                        )}\n                        {formError && (\n                          <p className=\"text-sm text-destructive\">{formError}</p>\n                        )}\n                      </div>\n                      <DialogFooter>\n                        <Button variant=\"outline\" onClick={() => setShowInviteModal(false)}>Close</Button>\n                        <Button onClick={handleCreateInvite} disabled={formLoading}>\n                          {formLoading ? <Loader2 className=\"h-4 w-4 animate-spin mr-2\" /> : null}\n                          {generatedInviteLink ? 'Generate New Link' : 'Create Invite'}\n                        </Button>\n                      </DialogFooter>\n                    </DialogContent>\n                  </Dialog>\n                  </>\n                )}\n              </div>\n            </CardHeader>\n            <CardContent>\n              {isPersonal ? (\n                <p className=\"text-sm text-muted-foreground text-center py-8\">Select a club to view members</p>\n              ) : (\n                <div className=\"space-y-4\">\n                  <MemberList\n                    groupId={selectedView}\n                    isAdmin={isAdmin}\n                    onInviteClick={canPerformActions && isAdmin ? () => setShowInviteModal(true) : undefined}\n                  />\n\n                  {isAdmin && invites.length > 0 && (\n                    <Card>\n                      <CardHeader>\n                        <CardTitle className=\"text-base\">Pending Invites</CardTitle>\n                      </CardHeader>\n                      <CardContent className=\"space-y-2\">\n                        {invites.map((invite) => (\n                          <div key={invite.id} className=\"flex items-center justify-between rounded-lg border border-dashed border-border p-3\">\n                            <div className=\"flex items-center gap-3\">\n                              <Mail className=\"h-4 w-4 text-muted-foreground\" />\n                              <div>\n                                <p className=\"text-sm\">{invite.email || 'Open invite link'}</p>\n                                <p className=\"text-xs text-muted-foreground\">\n                                  {invite.role} â€¢ Expires {invite.expiresAt ? new Date(invite.expiresAt).toLocaleDateString() : 'Never'}\n                                </p>\n                              </div>\n                            </div>\n                            <Button \n                              variant=\"ghost\" \n                              size=\"icon\"\n                              onClick={() => handleDeleteInvite(invite.id)}\n                            >\n                              <X className=\"h-4 w-4\" />\n                            </Button>\n                          </div>\n                        ))}\n                      </CardContent>\n                    </Card>\n                  )}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        )}\n      </main>\n      \n      {/* New Booking Modal (used from calendar/aircraft) */}\n      <Dialog open={showNewBookingModal} onOpenChange={(open) => { setShowNewBookingModal(open); if (!open) resetBookingForm() }}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Create Booking</DialogTitle>\n            <DialogDescription>\n              Book an aircraft for your flight.\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"bookingAircraft2\">Aircraft *</Label>\n              <select\n                id=\"bookingAircraft2\"\n                value={bookingAircraftId}\n                onChange={(e) => setBookingAircraftId(e.target.value)}\n                className=\"w-full h-10 rounded-lg border border-input bg-background px-3 text-sm\"\n              >\n                <option value=\"\">Select aircraft...</option>\n                {displayAircraft.filter(a => a.status === 'Available').map(aircraft => (\n                  <option key={aircraft.id} value={aircraft.id}>\n                    {aircraft.nNumber} - {aircraft.make} {aircraft.model}\n                  </option>\n                ))}\n              </select>\n            </div>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"startTime2\">Start Time *</Label>\n                <Input \n                  id=\"startTime2\" \n                  type=\"datetime-local\"\n                  value={bookingStartTime} \n                  onChange={(e) => setBookingStartTime(e.target.value)}\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"endTime2\">End Time *</Label>\n                <Input \n                  id=\"endTime2\" \n                  type=\"datetime-local\"\n                  value={bookingEndTime} \n                  onChange={(e) => setBookingEndTime(e.target.value)}\n                />\n              </div>\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"purpose2\">Purpose</Label>\n              <Input \n                id=\"purpose2\" \n                value={bookingPurpose} \n                onChange={(e) => setBookingPurpose(e.target.value)}\n                placeholder=\"e.g., Cross country, Pattern work, IFR practice\"\n              />\n            </div>\n            {formError && (\n              <p className=\"text-sm text-destructive\">{formError}</p>\n            )}\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setShowNewBookingModal(false)}>Cancel</Button>\n            <Button onClick={handleCreateBooking} disabled={formLoading}>\n              {formLoading ? <Loader2 className=\"h-4 w-4 animate-spin mr-2\" /> : null}\n              Create Booking\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n      \n      {/* Add Aircraft Modal */}\n      <Dialog open={showAddAircraftModal} onOpenChange={(open) => { setShowAddAircraftModal(open); if (!open) resetAircraftForm() }}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Add Aircraft</DialogTitle>\n            <DialogDescription>\n              Add a new aircraft to your flying club.\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"nNumber\">N-Number *</Label>\n              <Input \n                id=\"nNumber\" \n                value={aircraftNNumber} \n                onChange={(e) => setAircraftNNumber(e.target.value.toUpperCase())}\n                placeholder=\"e.g., N172SP\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"nickname\">Nickname</Label>\n              <Input \n                id=\"nickname\" \n                value={aircraftNickname} \n                onChange={(e) => setAircraftNickname(e.target.value)}\n                placeholder=\"e.g., Skyhawk\"\n              />\n            </div>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"make\">Make</Label>\n                <Input \n                  id=\"make\" \n                  value={aircraftMake} \n                  onChange={(e) => setAircraftMake(e.target.value)}\n                  placeholder=\"e.g., Cessna\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"model\">Model</Label>\n                <Input \n                  id=\"model\" \n                  value={aircraftModel} \n                  onChange={(e) => setAircraftModel(e.target.value)}\n                  placeholder=\"e.g., 172S\"\n                />\n              </div>\n            </div>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"year\">Year</Label>\n                <Input \n                  id=\"year\" \n                  type=\"number\"\n                  value={aircraftYear} \n                  onChange={(e) => setAircraftYear(e.target.value)}\n                  placeholder=\"e.g., 2020\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"hourlyRate\">Hourly Rate ($)</Label>\n                <Input \n                  id=\"hourlyRate\" \n                  type=\"number\"\n                  value={aircraftHourlyRate} \n                  onChange={(e) => setAircraftHourlyRate(e.target.value)}\n                  placeholder=\"e.g., 145\"\n                />\n              </div>\n            </div>\n            {formError && (\n              <p className=\"text-sm text-destructive\">{formError}</p>\n            )}\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setShowAddAircraftModal(false)}>Cancel</Button>\n            <Button onClick={handleAddAircraft} disabled={formLoading}>\n              {formLoading ? <Loader2 className=\"h-4 w-4 animate-spin mr-2\" /> : null}\n              Add Aircraft\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\fuel-saver\\AuthModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useCallback' is defined but never used.","line":3,"column":31,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":42,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"useCallback"},"fix":{"range":[43,56],"text":""},"desc":"Remove unused variable \"useCallback\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'signOut' is defined but never used.","line":4,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":37,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"signOut"},"fix":{"range":[100,109],"text":""},"desc":"Remove unused variable \"signOut\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'session' is assigned a value but never used.","line":15,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'mode' is assigned a value but never used.","line":17,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":17,"endColumn":14},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\David\\next-dashboard\\app\\modules\\fuel-saver\\AuthModal.tsx:22:7\n  20 |   useEffect(() => {\n  21 |     if (isOpen) {\n> 22 |       setMode('select');\n     |       ^^^^^^^ Avoid calling setState() directly within an effect\n  23 |     }\n  24 |   }, [isOpen]);\n  25 |","line":22,"column":7,"nodeType":null,"endLine":22,"endColumn":14}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect, useCallback } from 'react';\nimport { useSession, signIn, signOut } from 'next-auth/react';\nimport { useRouter } from 'next/navigation';\n\ninterface AuthModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  action: 'save' | 'load' | 'export';\n  onConfirm?: () => void;\n}\n\nexport default function AuthModal({ isOpen, onClose, action, onConfirm }: AuthModalProps) {\n  const { data: session, status } = useSession();\n  const router = useRouter();\n  const [mode, setMode] = useState<'select' | 'confirm'>('select');\n\n  // Reset mode when modal opens\n  useEffect(() => {\n    if (isOpen) {\n      setMode('select');\n    }\n  }, [isOpen]);\n\n  if (!isOpen) return null;\n\n  const handleCreateAccount = () => {\n    onClose();\n    router.push('/signup');\n  };\n\n  const handleContinue = () => {\n    if (onConfirm) {\n      onConfirm();\n    }\n    onClose();\n  };\n\n  return (\n    <div className=\"fixed inset-0 z-[9999] flex items-center justify-center\">\n      {/* Backdrop */}\n      <div \n        className=\"absolute inset-0 bg-black/60 backdrop-blur-sm\"\n        onClick={onClose}\n      />\n      \n      {/* Modal */}\n      <div className=\"relative bg-slate-800 rounded-xl p-6 max-w-sm w-full mx-4 shadow-2xl border border-slate-700\">\n        {/* Icon */}\n        <div className=\"text-4xl text-center mb-4\">\n          {action === 'save' ? 'ðŸ’¾' : action === 'load' ? 'ðŸ“‚' : 'ðŸ“¤'}\n        </div>\n\n        {/* Title */}\n        <h3 className=\"text-xl font-bold text-white text-center mb-2\">\n          {action === 'save' ? 'Save requires an account' : \n           action === 'load' ? 'Load requires an account' : \n           'Export requires an account'}\n        </h3>\n\n        {/* Description */}\n        <p className=\"text-slate-400 text-center mb-6\">\n          Create one to save your plans and access from any device. \n          Or continue without an account (saved locally only).\n        </p>\n\n        {/* Buttons */}\n        <div className=\"flex flex-col gap-3\">\n          <button\n            onClick={handleCreateAccount}\n            className=\"w-full bg-emerald-500 hover:bg-emerald-400 text-white font-semibold py-3 px-4 rounded-lg transition\"\n          >\n            Create Free Account\n          </button>\n          \n          <button\n            onClick={handleContinue}\n            className=\"w-full bg-slate-700 hover:bg-slate-600 text-white font-medium py-3 px-4 rounded-lg transition\"\n          >\n            Continue Without Account\n          </button>\n          \n          <button\n            onClick={onClose}\n            className=\"w-full text-slate-500 hover:text-white text-sm py-2 transition\"\n          >\n            Cancel\n          </button>\n        </div>\n\n        {/* Already have account */}\n        {status !== 'authenticated' && (\n          <p className=\"text-center text-sm text-slate-500 mt-4\">\n            Already have an account?{' '}\n            <button \n              onClick={() => { onClose(); signIn(); }}\n              className=\"text-sky-400 hover:underline\"\n            >\n              Sign in\n            </button>\n          </p>\n        )}\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\fuel-saver\\FlightPlayback.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useRef' is defined but never used.","line":3,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":26,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"useRef"},"fix":{"range":[32,40],"text":""},"desc":"Remove unused variable \"useRef\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useRef } from 'react';\n\ninterface TrackPoint {\n  timestamp: string;\n  lat: number;\n  lon: number;\n  alt?: number;\n  speed?: number;\n  heading?: number;\n  vs?: number;\n}\n\ninterface FlightRecording {\n  id: string;\n  filename: string;\n  fileType: string;\n  flightDate?: string;\n  departure?: string;\n  arrival?: string;\n  duration?: number;\n  track: TrackPoint[];\n}\n\nexport default function FlightPlayback() {\n  const [recording, setRecording] = useState<FlightRecording | null>(null);\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [playbackSpeed, setPlaybackSpeed] = useState(1);\n  const [currentIndex, setCurrentIndex] = useState(0);\n  const [error, setError] = useState<string | null>(null);\n\n  // Parse GPX file\n  const parseGPX = (content: string): TrackPoint[] => {\n    const parser = new DOMParser();\n    const doc = parser.parseFromString(content, 'text/xml');\n    const trkpts = doc.querySelectorAll('trkpt');\n    \n    const points: TrackPoint[] = [];\n    trkpts.forEach((pt) => {\n      const lat = parseFloat(pt.getAttribute('lat') || '0');\n      const lon = parseFloat(pt.getAttribute('lon') || '0');\n      const ele = pt.querySelector('ele')?.textContent;\n      const time = pt.querySelector('time')?.textContent;\n      \n      if (lat && lon) {\n        points.push({\n          timestamp: time || new Date().toISOString(),\n          lat,\n          lon,\n          alt: ele ? parseFloat(ele) : undefined,\n        });\n      }\n    });\n    \n    return points;\n  };\n\n  // Parse CSV file (simple format)\n  const parseCSV = (content: string): TrackPoint[] => {\n    const lines = content.split('\\n');\n    const points: TrackPoint[] = [];\n    \n    for (const line of lines) {\n      const parts = line.split(',').map(p => p.trim());\n      if (parts.length >= 2) {\n        const lat = parseFloat(parts[0]);\n        const lon = parseFloat(parts[1]);\n        if (!isNaN(lat) && !isNaN(lon)) {\n          points.push({\n            timestamp: parts[2] || new Date().toISOString(),\n            lat,\n            lon,\n            alt: parts[3] ? parseFloat(parts[3]) : undefined,\n            speed: parts[4] ? parseFloat(parts[4]) : undefined,\n          });\n        }\n      }\n    }\n    \n    return points;\n  };\n\n  // Handle file upload\n  const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    setError(null);\n    const reader = new FileReader();\n    \n    reader.onload = (event) => {\n      try {\n        const content = event.target?.result as string;\n        const ext = file.name.toLowerCase();\n        let track: TrackPoint[] = [];\n        let fileType = '';\n\n        if (ext.endsWith('.gpx')) {\n          track = parseGPX(content);\n          fileType = 'GPX';\n        } else if (ext.endsWith('.csv') || ext.endsWith('.igc')) {\n          track = parseCSV(content);\n          fileType = ext.endsWith('.igc') ? 'IGC' : 'CSV';\n        } else {\n          setError('Unsupported file format. Please upload GPX, CSV, or IGC files.');\n          return;\n        }\n\n        if (track.length === 0) {\n          setError('No valid track points found in file.');\n          return;\n        }\n\n        // Calculate duration\n        const startTime = new Date(track[0].timestamp).getTime();\n        const endTime = new Date(track[track.length - 1].timestamp).getTime();\n        const duration = Math.round((endTime - startTime) / 60000); // minutes\n\n        // Try to extract departure/arrival from filename\n        const filenameMatch = file.name.match(/([A-Z]{4})[-_]([A-Z]{4})/);\n        \n        const newRecording: FlightRecording = {\n          id: crypto.randomUUID(),\n          filename: file.name,\n          fileType,\n          flightDate: track[0]?.timestamp.split('T')[0],\n          departure: filenameMatch?.[1],\n          arrival: filenameMatch?.[2],\n          duration,\n          track,\n        };\n\n        setRecording(newRecording);\n        setCurrentIndex(0);\n        setIsPlaying(false);\n      } catch (err) {\n        setError('Error parsing file. Please check the format.');\n        console.error(err);\n      }\n    };\n\n    reader.readAsText(file);\n  };\n\n  // Playback control\n  const togglePlayback = () => {\n    if (!recording) return;\n    setIsPlaying(!isPlaying);\n    \n    if (!isPlaying) {\n      // Start playing\n      const interval = setInterval(() => {\n        setCurrentIndex((prev) => {\n          if (prev >= recording.track.length - 1) {\n            setIsPlaying(false);\n            clearInterval(interval);\n            return prev;\n          }\n          return prev + 1;\n        });\n      }, 1000 / playbackSpeed);\n    }\n  };\n\n  const resetPlayback = () => {\n    setIsPlaying(false);\n    setCurrentIndex(0);\n  };\n\n  const currentPoint = recording?.track[currentIndex];\n\n  return (\n    <div className=\"bg-slate-800 rounded-lg p-4 space-y-4\">\n      <h3 className=\"font-semibold text-white flex items-center gap-2\">\n        <span>ðŸ›«</span> Flight Playback\n      </h3>\n\n      {/* File Upload */}\n      <div>\n        <label className=\"block text-xs text-slate-400 mb-1\">Import Flight (GPX, CSV, IGC)</label>\n        <input\n          type=\"file\"\n          accept=\".gpx,.csv,.igc\"\n          onChange={handleFileUpload}\n          className=\"w-full bg-slate-700 border border-slate-600 rounded px-3 py-2 text-white text-sm file:mr-2 file:py-1 file:px-3 file:rounded file:border-0 file:bg-sky-500 file:text-white file:cursor-pointer\"\n        />\n        <p className=\"text-xs text-slate-500 mt-1\">Import from ForeFlight, Garmin, CloudAhoy, etc.</p>\n      </div>\n\n      {error && (\n        <div className=\"bg-red-500/20 text-red-400 p-2 rounded text-sm\">{error}</div>\n      )}\n\n      {/* Recording Info */}\n      {recording && (\n        <>\n          <div className=\"bg-slate-700 rounded p-3 space-y-2\">\n            <div className=\"flex justify-between text-sm\">\n              <span className=\"text-slate-400\">File:</span>\n              <span className=\"text-white\">{recording.filename}</span>\n            </div>\n            <div className=\"flex justify-between text-sm\">\n              <span className=\"text-slate-400\">Format:</span>\n              <span className=\"text-white\">{recording.fileType}</span>\n            </div>\n            <div className=\"flex justify-between text-sm\">\n              <span className=\"text-slate-400\">Duration:</span>\n              <span className=\"text-white\">{recording.duration} min</span>\n            </div>\n            <div className=\"flex justify-between text-sm\">\n              <span className=\"text-slate-400\">Track Points:</span>\n              <span className=\"text-white\">{recording.track.length}</span>\n            </div>\n            {recording.departure && recording.arrival && (\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"text-slate-400\">Route:</span>\n                <span className=\"text-white\">{recording.departure} â†’ {recording.arrival}</span>\n              </div>\n            )}\n          </div>\n\n          {/* Playback Controls */}\n          <div className=\"space-y-3\">\n            {/* Progress */}\n            <div className=\"relative\">\n              <input\n                type=\"range\"\n                min={0}\n                max={recording.track.length - 1}\n                value={currentIndex}\n                onChange={(e) => setCurrentIndex(parseInt(e.target.value))}\n                className=\"w-full\"\n              />\n              <div className=\"flex justify-between text-xs text-slate-500 mt-1\">\n                <span>Start</span>\n                <span>{currentIndex + 1} / {recording.track.length}</span>\n                <span>End</span>\n              </div>\n            </div>\n\n            {/* Controls */}\n            <div className=\"flex items-center gap-2\">\n              <button\n                onClick={togglePlayback}\n                className=\"bg-sky-500 hover:bg-sky-600 text-white px-4 py-2 rounded font-medium flex items-center gap-2\"\n              >\n                {isPlaying ? 'â¸ Pause' : 'â–¶ Play'}\n              </button>\n              <button\n                onClick={resetPlayback}\n                className=\"bg-slate-700 hover:bg-slate-600 text-white px-3 py-2 rounded\"\n              >\n                â¹ Reset\n              </button>\n              \n              {/* Speed */}\n              <div className=\"flex items-center gap-1 ml-auto\">\n                <span className=\"text-xs text-slate-400\">Speed:</span>\n                {[1, 2, 5, 10].map((speed) => (\n                  <button\n                    key={speed}\n                    onClick={() => setPlaybackSpeed(speed)}\n                    className={`px-2 py-1 rounded text-xs ${\n                      playbackSpeed === speed \n                        ? 'bg-sky-500 text-white' \n                        : 'bg-slate-700 text-slate-300'\n                    }`}\n                  >\n                    {speed}x\n                  </button>\n                ))}\n              </div>\n            </div>\n\n            {/* Current Point Info */}\n            {currentPoint && (\n              <div className=\"bg-slate-700 rounded p-2 grid grid-cols-2 gap-2 text-xs\">\n                <div>\n                  <span className=\"text-slate-400\">Position:</span>\n                  <span className=\"text-white ml-1\">\n                    {currentPoint.lat.toFixed(4)}, {currentPoint.lon.toFixed(4)}\n                  </span>\n                </div>\n                {currentPoint.alt && (\n                  <div>\n                    <span className=\"text-slate-400\">Altitude:</span>\n                    <span className=\"text-white ml-1\">{currentPoint.alt} ft</span>\n                  </div>\n                )}\n                {currentPoint.speed && (\n                  <div>\n                    <span className=\"text-slate-400\">Speed:</span>\n                    <span className=\"text-white ml-1\">{currentPoint.speed} kts</span>\n                  </div>\n                )}\n                <div>\n                  <span className=\"text-slate-400\">Time:</span>\n                  <span className=\"text-white ml-1\">\n                    {new Date(currentPoint.timestamp).toLocaleTimeString()}\n                  </span>\n                </div>\n              </div>\n            )}\n          </div>\n        </>\n      )}\n\n      {/* Tips */}\n      {!recording && (\n        <div className=\"text-xs text-slate-500 space-y-1\">\n          <p>Export your flight track from:</p>\n          <ul className=\"list-disc list-inside\">\n            <li>ForeFlight: More â†’ Track Logs â†’ Export</li>\n            <li>Garmin Pilot: My Flights â†’ Export</li>\n            <li>CloudAhoy: Import/Export â†’ Download</li>\n            <li>X-Plane: Track logs folder</li>\n          </ul>\n        </div>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\fuel-saver\\LeafletMap.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":104,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":104,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2476,2479],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2476,2479],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":111,"column":85,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":88,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2772,2775],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2772,2775],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":113,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":113,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2871,2874],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2871,2874],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":205,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":205,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7220,7223],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7220,7223],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleViewStateInfo' is assigned a value but never used.","line":228,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":228,"endColumn":28},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":426,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":426,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17366,17369],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17366,17369],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'showAirspaces' is assigned a value but never used.","line":536,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":536,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'showStateOverlay' is assigned a value but never used.","line":537,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":537,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'showNotams' is assigned a value but never used.","line":538,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":538,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'onStateClick' is defined but never used.","line":541,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":541,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'performanceMode' is assigned a value but never used.","line":544,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":544,"endColumn":18},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":547,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":547,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21753,21756],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21753,21756],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":548,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":548,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21804,21807],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21804,21807],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'notams' is assigned a value but never used.","line":549,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":549,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setNotams' is assigned a value but never used.","line":549,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":549,"endColumn":27},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":549,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":549,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21855,21858],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21855,21858],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleMoveEnd' is assigned a value but never used.","line":592,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":592,"endColumn":24}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[376,379],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[376,379],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":8,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect, useRef, useMemo, useCallback } from 'react';\nimport { MapContainer, TileLayer, Popup, Polyline, CircleMarker, useMapEvents } from 'react-leaflet';\nimport 'leaflet/dist/leaflet.css';\n\n// Fix Leaflet icon issue\nif (typeof window !== 'undefined') {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  delete (window as any).L?.Icon?.Default?.prototype?._getIconUrl;\n}\n\ninterface Airport {\n  icao: string;\n  iata?: string;\n  name: string;\n  city?: string;\n  latitude: number;\n  longitude: number;\n  type?: string;\n}\n\ninterface Waypoint {\n  id: string;\n  icao: string;\n  name: string;\n  latitude: number;\n  longitude: number;\n}\n\ninterface FuelPrice {\n  icao: string;\n  price100ll: number | null;\n  priceJetA?: number | null;\n  source?: string;\n  sourceUrl?: string;\n  lastReported?: string;\n  attribution?: {\n    name: string;\n    url: string;\n    airbossUrl: string;\n  };\n}\n\ninterface AirportDetails {\n  icao: string;\n  name: string;\n  type?: string;\n  elevation_ft?: number;\n  city?: string;\n  state?: string;\n  runways?: { length_ft: number; surface: string; he_ident: string }[];\n  frequencies?: { frequency_mhz: number; description: string; type: string }[];\n  fuel?: { \n    price100ll: number; \n    priceJetA?: number;\n    source: string;\n    sourceUrl?: string;\n    lastReported?: string;\n    providerName?: string;\n    providerPhone?: string;\n    community100ll?: {\n      price: number;\n      fbo: string | null;\n      date: string;\n      reportedAt: string;\n      daysAgo: number;\n    } | null;\n    communityJetA?: {\n      price: number;\n      fbo: string | null;\n      date: string;\n      reportedAt: string;\n      daysAgo: number;\n    } | null;\n    priceDivergence?: {\n      type: string;\n      airnavPrice: number;\n      communityPrice: number;\n      difference: string;\n    } | null;\n  };\n  landingFee?: { amount: number };\n  hasTower?: boolean;\n  attendance?: string;\n  phone?: string;\n  manager?: string;\n}\n\ninterface LeafletMapProps {\n  airports: Airport[];\n  waypoints: Waypoint[];\n  fuelPrices: Record<string, FuelPrice>;\n  onBoundsChange: (bounds: { minLat: number; maxLat: number; minLon: number; maxLon: number }) => void;\n  onAirportClick: (airport: Airport) => void;\n  mapCenter: [number, number];\n  mapZoom: number;\n  showTerrain?: boolean;\n  showAirspaces?: boolean;\n  showStateOverlay?: boolean;\n  showNotams?: boolean;\n  showTfrs?: boolean;\n  showPireps?: boolean;\n  onStateClick?: (stateInfo: any) => void;\n  baseLayer?: 'osm' | 'satellite' | 'terrain' | 'dark';\n  onViewStateInfo?: (stateCode: string) => void;\n  performanceMode?: boolean;\n}\n\n// Component to handle map move events and get map reference\nfunction MapEventHandler({ onBoundsChange, onMapReady }: { onBoundsChange: (bounds: any) => void; onMapReady?: (map: L.Map) => void }) {\n  const map = useMapEvents({\n    moveend: (e: any) => {\n      const bounds = e.target.getBounds();\n      onBoundsChange({\n        minLat: bounds.getSouth(),\n        maxLat: bounds.getNorth(),\n        minLon: bounds.getWest(),\n        maxLon: bounds.getEast()\n      });\n    }\n  });\n  \n  useEffect(() => {\n    if (onMapReady) {\n      onMapReady(map);\n    }\n  }, [map, onMapReady]);\n  \n  return null;\n}\n\nfunction getMarkerColor(type?: string) {\n  switch (type) {\n    case 'large_airport': return '#ef4444';\n    case 'medium_airport': return '#f59e0b';\n    case 'small_airport': return '#22c55e';\n    default: return '#6b7280';\n  }\n}\n\n// Simple state inference from coordinates\nfunction inferStateFromCoords(lat: number, lon: number): string | null {\n  if (lat >= 41.7 && lon >= -90.4 && lon <= -82.1) return 'MI';\n  if (lat >= 40.5 && lon >= -79.8 && lon <= -71.8) return 'NY';\n  if (lat >= 30.4 && lon >= -85.6 && lon <= -80.8) return 'GA';\n  if (lat >= 35 && lon >= -90.3 && lon <= -81.6) return 'TN';\n  if (lat >= 37 && lon >= -91.5 && lon <= -87) return 'IL';\n  if (lat >= 38 && lon >= -88.1 && lon <= -84.8) return 'IN';\n  if (lat >= 38.4 && lon >= -84.8 && lon <= -80.5) return 'OH';\n  if (lat >= 29 && lon >= -95 && lon <= -81) return 'FL';\n  if (lat >= 30 && lon >= -90 && lon <= -85) return 'MS';\n  if (lat >= 29 && lon >= -94.1 && lon <= -88.8) return 'LA';\n  if (lat >= 33 && lon >= -106.7 && lon <= -93.5) return 'TX';\n  if (lat >= 31.3 && lon >= -114.7 && lon <= -109) return 'AZ';\n  if (lat >= 32.5 && lon >= -124.4 && lon <= -114.6) return 'CA';\n  if (lat >= 45.5 && lon >= -124.8 && lon <= -116.9) return 'WA';\n  if (lat >= 42 && lon >= -124.6 && lon <= -116.5) return 'OR';\n  if (lat >= 43 && lon >= -117 && lon <= -111) return 'ID';\n  if (lat >= 37 && lon >= -109.1 && lon <= -102) return 'CO';\n  if (lat >= 35 && lon >= -120 && lon <= -114) return 'NV';\n  if (lat >= 37 && lon >= -114.1 && lon <= -109) return 'UT';\n  if (lat >= 41 && lon >= -111.1 && lon <= -104.1) return 'WY';\n  if (lat >= 44.4 && lon >= -116 && lon <= -104) return 'MT';\n  if (lat >= 45.9 && lon >= -104.1 && lon <= -96.6) return 'ND';\n  if (lat >= 42.5 && lon >= -104.1 && lon <= -96.4) return 'SD';\n  if (lat >= 38 && lon >= -104.1 && lon <= -94.3) return 'NE';\n  if (lat >= 37 && lon >= -102.1 && lon <= -94.6) return 'KS';\n  if (lat >= 33.6 && lon >= -103 && lon <= -94.4) return 'OK';\n  if (lat >= 33.8 && lon >= -84.3 && lon <= -75.4) return 'NC';\n  if (lat >= 32 && lon >= -83.4 && lon <= -78.5) return 'SC';\n  if (lat >= 36.5 && lon >= -83.7 && lon <= -75.2) return 'VA';\n  if (lat >= 36.5 && lon >= -89.6 && lon <= -81.9) return 'KY';\n  if (lat >= 37.2 && lon >= -82.6 && lon <= -77.7) return 'WV';\n  if (lat >= 39.7 && lon >= -80.5 && lon <= -74.7) return 'PA';\n  if (lat >= 41 && lon >= -73.7 && lon <= -71.8) return 'CT';\n  if (lat >= 41.2 && lon >= -73.5 && lon <= -69.9) return 'MA';\n  if (lat >= 42.7 && lon >= -72.6 && lon <= -70.7) return 'NH';\n  if (lat >= 43.1 && lon >= -71.1 && lon <= -66.9) return 'ME';\n  if (lat >= 42.7 && lon >= -73.5 && lon <= -71.5) return 'VT';\n  if (lat >= 38.9 && lon >= -75.6 && lon <= -73.9) return 'NJ';\n  if (lat >= 41.1 && lon >= -71.9 && lon <= -71.1) return 'RI';\n  if (lat >= 38.5 && lon >= -75.8 && lon <= -75) return 'DE';\n  if (lat >= 37.9 && lon >= -79.5 && lon <= -75) return 'MD';\n  if (lat >= 38.79 && lon >= -77.119 && lon <= -76.909) return 'DC';\n  if (lat >= 30.2 && lon >= -88.5 && lon <= -84.9) return 'AL';\n  if (lat >= 33 && lon >= -94.6 && lon <= -89.6) return 'AR';\n  if (lat >= 40.4 && lon >= -96.6 && lon <= -90.1) return 'IA';\n  if (lat >= 36 && lon >= -95.8 && lon <= -89.1) return 'MO';\n  if (lat >= 31.3 && lon >= -109.1 && lon <= -103) return 'NM';\n  if (lat >= 42.5 && lon >= -92.9 && lon <= -86.8) return 'WI';\n  if (lat >= 43.5 && lon >= -97.2 && lon <= -89.5) return 'MN';\n  if (lat >= 51.8 && lon >= -180 && lon <= -130) return 'AK';\n  if (lat >= 18.9 && lon >= -160.2 && lon <= -154.7) return 'HI';\n  return null;\n}\n\nfunction AirportPopup({ airport, onAddToRoute, onViewStateInfo }: { airport: Airport; onAddToRoute: () => void; onViewStateInfo?: (stateCode: string) => void }) {\n  const [details, setDetails] = useState<AirportDetails | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [refreshKey, setRefreshKey] = useState(0);\n\n  // Expose refresh function globally\n  useEffect(() => {\n    (window as any).refreshAirportDetails = (icao: string) => {\n      if (icao === airport.icao) {\n        setRefreshKey(k => k + 1);\n      }\n    };\n  }, [airport.icao]);\n\n  useEffect(() => {\n    async function fetchDetails() {\n      try {\n        const res = await fetch(`/api/airports/${airport.icao}`);\n        if (res.ok) {\n          const data = await res.json();\n          setDetails(data);\n        }\n      } catch (e) {\n        console.error('Error fetching airport details:', e);\n      }\n      setLoading(false);\n    }\n    fetchDetails();\n  }, [airport.icao, refreshKey]);\n\n  const handleViewStateInfo = () => {\n    if (onViewStateInfo) {\n      const stateCode = details?.state || inferStateFromCoords(airport.latitude, airport.longitude);\n      if (stateCode) {\n        onViewStateInfo(stateCode);\n      }\n    }\n  };\n\n  return (\n    <div className=\"min-w-[150px] max-w-[180px] text-slate-900 relative\">\n      {/* Close button */}\n      <button\n        onClick={(e) => { e.stopPropagation(); }}\n        className=\"absolute -top-1 -right-1 w-5 h-5 bg-slate-200 hover:bg-slate-300 rounded-full text-xs flex items-center justify-center\"\n        title=\"Close\"\n      >\n        Ã—\n      </button>\n      <strong className=\"text-lg\">{airport.icao}</strong>\n      {airport.iata && <span className=\"ml-2 text-slate-500\">({airport.iata})</span>}\n      <div className=\"font-medium\">{airport.name}</div>\n      {details?.city && (\n        <div className=\"text-sm text-slate-600\">\n          {details.city}{details.state && `, ${details.state}`}\n        </div>\n      )}\n      \n      {details && (\n        <>\n          {details.elevation_ft && (\n            <div className=\"text-sm mt-2\">\n              <span className=\"font-medium\">Elevation:</span> {details.elevation_ft} ft\n            </div>\n          )}\n          \n          {details.runways && details.runways.length > 0 && (\n            <div className=\"text-sm mt-1\">\n              <span className=\"font-medium\">Runways:</span>{' '}\n              {details.runways.slice(0, 2).map((r, i) => (\n                <span key={i} className=\"mr-2\">\n                  {r.he_ident} ({r.length_ft?.toLocaleString()}ft {r.surface})\n                </span>\n              ))}\n            </div>\n          )}\n          \n          {details.frequencies && details.frequencies.length > 0 && (\n            <div className=\"text-sm mt-2\">\n              <span className=\"font-medium\">Freqs:</span>\n              <div className=\"max-h-20 overflow-y-auto mt-1\">\n                {details.frequencies.slice(0, 5).map((f, i) => (\n                  <div key={i} className=\"text-xs\">\n                    {f.frequency_mhz.toFixed(3)} {f.type} - {f.description}\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n          \n          {details.fuel && (\n            <div className=\"mt-2\">\n              <div className=\"text-emerald-600 font-medium\">\n                100LL: ${details.fuel.price100ll.toFixed(2)}/gal\n                {details.fuel.priceJetA && (\n                  <span className=\"ml-2\">JetA: ${details.fuel.priceJetA.toFixed(2)}/gal</span>\n                )}\n              </div>\n              \n              {/* Community-reported price (shown alongside AirNav if available) */}\n              {(details.fuel.community100ll || details.fuel.communityJetA) && (\n                <div className=\"mt-1 space-y-1\">\n                  {details.fuel.community100ll && (\n                    <div className={`text-sm ${details.fuel.community100ll.daysAgo <= 30 ? 'text-green-600 font-medium' : 'text-slate-500'}`}>\n                      <span className=\"text-green-600\">â—</span> ${details.fuel.community100ll.price.toFixed(2)}/gal community\n                      <span className=\"text-xs text-slate-400 ml-1\">Â· {details.fuel.community100ll.daysAgo === 0 ? 'today' : `${details.fuel.community100ll.daysAgo}d ago`}</span>\n                      {details.fuel.community100ll.fbo && (\n                        <span className=\"text-xs text-slate-400\"> @ {details.fuel.community100ll.fbo}</span>\n                      )}\n                    </div>\n                  )}\n                  {details.fuel.communityJetA && (\n                    <div className={`text-sm ${details.fuel.communityJetA.daysAgo <= 30 ? 'text-green-600 font-medium' : 'text-slate-500'}`}>\n                      <span className=\"text-green-600\">â—</span> ${details.fuel.communityJetA.price.toFixed(2)}/gal JetA community\n                      <span className=\"text-xs text-slate-400 ml-1\">Â· {details.fuel.communityJetA.daysAgo === 0 ? 'today' : `${details.fuel.communityJetA.daysAgo}d ago`}</span>\n                    </div>\n                  )}\n                </div>\n              )}\n              \n              {/* Price divergence warning */}\n              {details.fuel.priceDivergence && (\n                <div className=\"mt-1 text-xs text-amber-600 bg-amber-50 px-2 py-1 rounded\">\n                  âš ï¸ Community price is {details.fuel.priceDivergence.difference}\n                </div>\n              )}\n              \n              {details.fuel.lastReported && (\n                <div className=\"text-xs text-slate-400\">\n                  AirNav: {details.fuel.lastReported}\n                </div>\n              )}\n              {/* AirNav Attribution */}\n              {details.fuel.source === 'airnav' && (\n                <a \n                  href={details.fuel.sourceUrl || 'https://www.airnav.com'} \n                  target=\"_blank\" \n                  rel=\"noopener noreferrer\"\n                  className=\"text-xs text-slate-500 hover:text-sky-500 block mt-1\"\n                >\n                  Source: AirNav.com\n                </a>\n              )}\n              {/* Tower & Landing Fee - Important Info */}\n              {(details.hasTower !== undefined || details.landingFee) && (\n                <div className=\"mt-2 flex gap-2 flex-wrap\">\n                  {details.hasTower !== undefined && (\n                    <span className={`text-xs px-2 py-1 rounded ${details.hasTower ? 'bg-green-500/20 text-green-400' : 'bg-red-500/20 text-red-400'}`}>\n                      {details.hasTower ? 'âœ“ Tower' : 'âœ— No Tower'}\n                    </span>\n                  )}\n                  {details.landingFee && (\n                    <span className=\"text-xs px-2 py-1 rounded bg-amber-500/20 text-amber-400\">\n                      Landing: ${details.landingFee.amount}\n                    </span>\n                  )}\n                </div>\n              )}\n              {/* More Details Dropdown */}\n              <details className=\"mt-2\">\n                <summary className=\"text-xs text-slate-500 cursor-pointer hover:text-sky-400\">\n                  More details\n                </summary>\n                <div className=\"mt-2 space-y-1 text-xs bg-slate-100 p-2 rounded\">\n                  {details.manager && (\n                    <div><span className=\"font-medium\">Manager:</span> {details.manager}</div>\n                  )}\n                  {/* Manager/Airport Phone */}\n                  {details.phone && (\n                    <div>\n                      <span className=\"font-medium\">Airport Phone:</span>{' '}\n                      <a href={`tel:${details.phone}`} className=\"text-sky-600 hover:underline\">{details.phone}</a>\n                    </div>\n                  )}\n                  {/* Fuel Provider Info */}\n                  {details.fuel?.providerName && (\n                    <div>\n                      <span className=\"font-medium\">Fuel Provider:</span> {details.fuel.providerName}\n                      {details.fuel.providerPhone && (\n                        <span className=\"ml-1\">\n                          (<a href={`tel:${details.fuel.providerPhone}`} className=\"text-sky-600 hover:underline\">{details.fuel.providerPhone}</a>)\n                        </span>\n                      )}\n                    </div>\n                  )}\n                  {details.attendance && (\n                    <div><span className=\"font-medium\">Attendance:</span> {details.attendance}</div>\n                  )}\n                  <a \n                    href={`https://www.airnav.com/airport/${airport.icao}`}\n                    target=\"_blank\" \n                    rel=\"noopener noreferrer\"\n                    className=\"text-sky-500 hover:underline block mt-2\"\n                  >\n                    View full details on AirNav â†’\n                  </a>\n                </div>\n              </details>\n              {/* Submit price button */}\n              <details className=\"mt-2\">\n                <summary className=\"text-xs text-sky-500 cursor-pointer hover:text-sky-400\">\n                  Paid a different price? Submit it\n                </summary>\n                <form \n                  onSubmit={async (e) => {\n                    e.preventDefault();\n                    const form = e.target as HTMLFormElement;\n                    const price = parseFloat((form.elements.namedItem('price') as HTMLInputElement).value);\n                    const fuelType = (form.elements.namedItem('fuelType') as HTMLSelectElement).value;\n                    const fbo = (form.elements.namedItem('fbo') as HTMLInputElement).value;\n                    const purchaseDate = (form.elements.namedItem('purchaseDate') as HTMLInputElement).value;\n                    \n                    if (price > 0 && purchaseDate) {\n                      try {\n                        const res = await fetch('/api/fuel-prices/community', {\n                          method: 'POST',\n                          headers: { 'Content-Type': 'application/json' },\n                          body: JSON.stringify({\n                            icao: details.icao,\n                            price,\n                            fuelType,\n                            fbo: fbo || null,\n                            purchaseDate\n                          })\n                        });\n                        if (res.ok) {\n                          alert('Thanks! Price submitted. Other pilots will see your community price.');\n                          // Refresh the airport details\n                          (window as any).refreshAirportDetails?.(details.icao);\n                        } else {\n                          const err = await res.json();\n                          alert(err.error || 'Failed to submit price');\n                        }\n                      } catch (err) {\n                        console.error('Error submitting price:', err);\n                        alert('Failed to submit price. Please try again.');\n                      }\n                    }\n                  }}\n                  className=\"mt-2 p-2 bg-slate-700 rounded\"\n                >\n                  <div className=\"text-xs mb-2 text-slate-300\">Submit your actual price (per gallon)</div>\n                  <div className=\"space-y-2\">\n                    <div className=\"flex gap-2\">\n                      <select \n                        name=\"fuelType\" \n                        className=\"bg-slate-600 text-white text-xs px-2 py-1 rounded\"\n                      >\n                        <option value=\"100LL\">100LL</option>\n                        <option value=\"JetA\">Jet A</option>\n                      </select>\n                      <input \n                        type=\"number\" \n                        name=\"price\" \n                        step=\"0.01\" \n                        min=\"0\" \n                        max=\"20\"\n                        placeholder=\"$0.00\"\n                        className=\"bg-slate-600 text-white text-xs px-2 py-1 rounded w-20\"\n                        required\n                      />\n                    </div>\n                    <div className=\"flex gap-2\">\n                      <input \n                        type=\"text\" \n                        name=\"fbo\" \n                        placeholder=\"FBO name (optional)\"\n                        className=\"bg-slate-600 text-white text-xs px-2 py-1 rounded flex-1\"\n                      />\n                      <input \n                        type=\"date\" \n                        name=\"purchaseDate\" \n                        max={new Date().toISOString().split('T')[0]}\n                        className=\"bg-slate-600 text-white text-xs px-2 py-1 rounded w-28\"\n                        required\n                      />\n                    </div>\n                    <button \n                      type=\"submit\"\n                      className=\"w-full bg-sky-500 hover:bg-sky-600 text-white text-xs px-2 py-2 rounded\"\n                    >\n                      Submit Price\n                    </button>\n                  </div>\n                  <div className=\"text-xs text-slate-400 mt-1\">\n                    Help other pilots know real prices!\n                  </div>\n                </form>\n              </details>\n            </div>\n          )}\n          \n          {details.landingFee && (\n            <div className=\"text-sm text-amber-600\">\n              Landing: ${details.landingFee.amount.toFixed(2)}\n            </div>\n          )}\n        </>\n      )}\n      \n      {loading && <div className=\"text-sm text-slate-400 mt-2\">Loading details...</div>}\n      \n      <button\n        onClick={onAddToRoute}\n        className=\"mt-3 w-full bg-sky-500 hover:bg-sky-600 text-white px-3 py-2 rounded text-sm font-medium\"\n      >\n        Add to Route\n      </button>\n      \n      {/* View State Info button - always show */}\n      <button\n        onClick={() => {\n          // Use state from details or infer from coordinates\n          let stateCode: string | undefined = details?.state;\n          if (!stateCode) {\n            stateCode = inferStateFromCoords(airport.latitude, airport.longitude) ?? undefined;\n          }\n          if (stateCode && onViewStateInfo) {\n            onViewStateInfo(stateCode);\n          }\n        }}\n        className=\"mt-2 w-full bg-purple-500 hover:bg-purple-600 text-white px-3 py-2 rounded text-sm font-medium\"\n      >\n        View State Info\n      </button>\n    </div>\n  );\n}\n\nexport default function LeafletMap({ \n  airports, \n  waypoints, \n  fuelPrices, \n  onBoundsChange, \n  onAirportClick, \n  mapCenter, \n  mapZoom,\n  showTerrain = false,\n  showAirspaces = false,\n  showStateOverlay = false,\n  showNotams = false,\n  showTfrs = false,\n  showPireps = false,\n  onStateClick,\n  baseLayer = 'osm',\n  onViewStateInfo,\n  performanceMode = false\n}: LeafletMapProps) {\n  const [terrainLayer, setTerrainLayer] = useState<L.TileLayer | null>(null);\n  const [tfrs, setTfrs] = useState<any[]>([]);\n  const [pireps, setPireps] = useState<any[]>([]);\n  const [notams, setNotams] = useState<any[]>([]);\n  const mapRef = useRef<L.Map | null>(null);\n  const [currentZoom, setCurrentZoom] = useState(mapZoom);\n  const boundsRef = useRef<{ minLat: number; maxLat: number; minLon: number; maxLon: number } | null>(null);\n  const fetchTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const isFetchingRef = useRef(false);\n  const lastFailedRef = useRef<{ tfrs?: number; pireps?: number }>({});\n  \n  // Base layer URLs\n  const baseLayers = {\n    osm: { url: 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', attribution: '&copy; OpenStreetMap' },\n    satellite: { url: 'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', attribution: '&copy; Esri' },\n    terrain: { url: 'https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', attribution: '&copy; OpenTopoMap' },\n    dark: { url: 'https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', attribution: '&copy; CartoDB' }\n  };\n  \n  // Filter out seaplanes automatically\n  const filteredAirports = useMemo(() => {\n    return airports.filter(a => a.type !== 'seaplane_base');\n  }, [airports]);\n  \n  // Calculate marker size based on zoom - smaller airports stay small when zoomed out\n  const getMarkerRadius = (type?: string) => {\n    const zoomScale = Math.max(1, (currentZoom - 4) * 0.5);\n    if (type === 'large_airport') {\n      return 6 + zoomScale;\n    } else if (type === 'medium_airport') {\n      // Medium airports: smaller when zoomed out, larger when zoomed in\n      return currentZoom < 7 ? 3 : 3 + (zoomScale * 0.7);\n    } else {\n      // Small airports: stay small when zoomed out, only grow when very zoomed in\n      return currentZoom < 8 ? 1.5 : 1.5 + ((currentZoom - 7) * 0.8);\n    }\n  };\n  \n  // Update zoom level and respond to center/zoom changes from parent\n  useEffect(() => {\n    if (!mapRef.current) return;\n    \n    const handleZoom = () => setCurrentZoom(mapRef.current!.getZoom());\n    mapRef.current.on('zoomend', handleZoom);\n    \n    // Watch for center/zoom prop changes and update map view\n    const handleMoveEnd = () => {\n      const map = mapRef.current;\n      if (!map) return;\n      const newCenter = map.getCenter();\n      const newZoom = map.getZoom();\n      // Only update if significantly different to avoid loops\n      if (Math.abs(newCenter.lat - mapCenter[0]) > 0.001 || \n          Math.abs(newCenter.lng - mapCenter[1]) > 0.001 ||\n          newZoom !== mapZoom) {\n        map.setView(mapCenter as [number, number], mapZoom, { animate: true });\n      }\n    };\n    \n    // Apply the center/zoom from props\n    mapRef.current.setView(mapCenter as [number, number], mapZoom, { animate: true });\n    \n    return () => {\n      mapRef.current?.off('zoomend', handleZoom);\n    };\n  }, [mapCenter, mapZoom]);\n  \n  // Toggle terrain layer based on setting\n  useEffect(() => {\n    if (typeof window === 'undefined') return;\n    \n    // Import Leaflet dynamically\n    import('leaflet').then((L) => {\n      if (showTerrain && !terrainLayer) {\n        // Add OpenTopoMap terrain layer\n        const terrain = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {\n          attribution: 'Map data: &copy; <a href=\"https://opentopomap.org\">OpenTopoMap</a>',\n          maxZoom: 17,\n        });\n        terrain.addTo(mapRef.current!);\n        setTerrainLayer(terrain);\n      } else if (!showTerrain && terrainLayer) {\n        // Remove terrain layer\n        terrainLayer.remove();\n        setTerrainLayer(null);\n      }\n    });\n  }, [showTerrain, terrainLayer]);\n  \n  // Track bounds changes and update ref\n  const handleBoundsChange = useCallback((bounds: { minLat: number; maxLat: number; minLon: number; maxLon: number }) => {\n    boundsRef.current = bounds;\n    onBoundsChange(bounds);\n    \n    // Debounce TFR/PIREP fetches - wait 500ms after map stops moving\n    if (fetchTimeoutRef.current) {\n      clearTimeout(fetchTimeoutRef.current);\n    }\n    \n    fetchTimeoutRef.current = setTimeout(() => {\n      // Don't fetch if already fetching or recently failed\n      if (isFetchingRef.current) return;\n      const now = Date.now();\n      if (lastFailedRef.current.tfrs && now - lastFailedRef.current.tfrs < 30000) return;\n      if (lastFailedRef.current.pireps && now - lastFailedRef.current.pireps < 30000) return;\n      \n      if (showTfrs && boundsRef.current && !lastFailedRef.current.tfrs) {\n        isFetchingRef.current = true;\n        const boundsParam = `${bounds.minLat},${bounds.maxLat},${bounds.minLon},${bounds.maxLon}`;\n        fetch(`/api/tfrs?bounds=${boundsParam}`)\n          .then(res => {\n            if (!res.ok) throw new Error('API unavailable');\n            return res.json();\n          })\n          .then(data => setTfrs(data.tfrs || []))\n          .catch(() => { lastFailedRef.current.tfrs = Date.now(); })\n          .finally(() => { isFetchingRef.current = false; });\n      }\n      if (showPireps && boundsRef.current && !lastFailedRef.current.pireps) {\n        isFetchingRef.current = true;\n        const boundsParam = `${bounds.minLat},${bounds.maxLat},${bounds.minLon},${bounds.maxLon}`;\n        fetch(`/api/pireps?bounds=${boundsParam}`)\n          .then(res => {\n            if (!res.ok) throw new Error('API unavailable');\n            return res.json();\n          })\n          .then(data => setPireps(data.pireps || []))\n          .catch(() => { lastFailedRef.current.pireps = Date.now(); })\n          .finally(() => { isFetchingRef.current = false; });\n      }\n    }, 500);\n  }, [onBoundsChange, showTfrs, showPireps]);\n\n  // Initial fetch when toggled ON\n  useEffect(() => {\n    if (!showTfrs) return;\n    if (!boundsRef.current) return;\n    \n    const bounds = boundsRef.current;\n    const boundsParam = `${bounds.minLat},${bounds.maxLat},${bounds.minLon},${bounds.maxLon}`;\n    \n    fetch(`/api/tfrs?bounds=${boundsParam}`)\n      .then(res => res.json())\n      .then(data => setTfrs(data.tfrs || []))\n      .catch(console.error);\n  }, [showTfrs]);\n\n  // Initial fetch when toggled ON  \n  useEffect(() => {\n    if (!showPireps) return;\n    if (!boundsRef.current) return;\n    \n    const bounds = boundsRef.current;\n    const boundsParam = `${bounds.minLat},${bounds.maxLat},${bounds.minLon},${bounds.maxLon}`;\n    \n    fetch(`/api/pireps?bounds=${boundsParam}`)\n      .then(res => res.json())\n      .then(data => setPireps(data.pireps || []))\n      .catch(console.error);\n  }, [showPireps]);\n \n  return (\n    <MapContainer\n      center={mapCenter}\n      zoom={mapZoom}\n      style={{ height: '100%', width: '100%', zIndex: 0 }}\n    >\n      <TileLayer\n        attribution={baseLayers[baseLayer].attribution}\n        url={baseLayers[baseLayer].url}\n      />\n      \n      <MapEventHandler onBoundsChange={handleBoundsChange} onMapReady={(map) => { mapRef.current = map; }} />\n      \n      {/* Airport markers - filtered and zoom-based sizing */}\n      {filteredAirports.map(airport => (\n        <CircleMarker\n          key={airport.icao}\n          center={[airport.latitude, airport.longitude]}\n          radius={getMarkerRadius(airport.type)}\n          pathOptions={{\n            color: getMarkerColor(airport.type),\n            fillColor: getMarkerColor(airport.type),\n            fillOpacity: 0.7,\n            weight: 1\n          }}\n        >\n          <Popup>\n            <AirportPopup airport={airport} onAddToRoute={() => onAirportClick(airport)} onViewStateInfo={onViewStateInfo} />\n          </Popup>\n        </CircleMarker>\n      ))}\n      \n      {/* Route line */}\n      {waypoints.length > 1 && (\n        <Polyline\n          positions={waypoints.map(w => [w.latitude, w.longitude])}\n          pathOptions={{ color: '#38bdf8', weight: 3, dashArray: '10, 5' }}\n        />\n      )}\n      \n      {/* TFR markers */}\n      {showTfrs && tfrs.map(tfr => (\n        <CircleMarker\n          key={tfr.id}\n          center={[tfr.latitude, tfr.longitude]}\n          radius={8}\n          pathOptions={{\n            color: '#ef4444',\n            fillColor: '#ef4444',\n            fillOpacity: 0.4,\n            weight: 2,\n            dashArray: '5, 5'\n          }}\n        >\n          <Popup>\n            <div className=\"text-slate-900 min-w-[150px]\">\n              <strong className=\"text-red-600\">ðŸ”´ TFR</strong>\n              <div className=\"font-medium\">{tfr.title}</div>\n              <div className=\"text-sm\">{tfr.description}</div>\n              <div className=\"text-xs text-slate-500 mt-1\">\n                {tfr.type} - {tfr.facility}\n              </div>\n              <div className=\"text-xs text-slate-500\">\n                Alt: {tfr.lowerAltitude} to {tfr.upperAltitude}\n              </div>\n              <div className=\"text-xs text-slate-500\">\n                Radius: {tfr.radius} NM\n              </div>\n            </div>\n          </Popup>\n        </CircleMarker>\n      ))}\n      \n      {/* PIREP markers */}\n      {showPireps && pireps.map(pirep => (\n        <CircleMarker\n          key={pirep.id}\n          center={[pirep.latitude, pirep.longitude]}\n          radius={6}\n          pathOptions={{\n            color: pirep.turbulence !== 'NIL' ? '#f59e0b' : pirep.icing !== 'NIL' ? '#8b5cf6' : '#22c55e',\n            fillColor: pirep.turbulence !== 'NIL' ? '#f59e0b' : pirep.icing !== 'NIL' ? '#8b5cf6' : '#22c55e',\n            fillOpacity: 0.7,\n            weight: 2\n          }}\n        >\n          <Popup>\n            <div className=\"text-slate-900 min-w-[150px]\">\n              <strong className=\"text-purple-600\">ðŸ›©ï¸ PIREP</strong>\n              <div className=\"text-sm font-medium\">{pirep.aircraft} FL{pirep.flightLevel}</div>\n              {pirep.turbulence !== 'NIL' && (\n                <div className=\"text-amber-600\">Turbulence: {pirep.turbulence}</div>\n              )}\n              {pirep.icing !== 'NIL' && (\n                <div className=\"text-purple-600\">Icing: {pirep.icing}</div>\n              )}\n              <div className=\"text-xs text-slate-500 mt-1\">\n                {pirep.windDirection}Â° @ {pirep.windSpeed} kts\n              </div>\n              <div className=\"text-xs text-slate-500\">\n                Temp: {pirep.temperature}Â°C\n              </div>\n            </div>\n          </Popup>\n        </CircleMarker>\n      ))}\n      \n      {/* Waypoint markers */}\n      {waypoints.map((wp, i) => (\n        <CircleMarker\n          key={wp.id}\n          center={[wp.latitude, wp.longitude]}\n          radius={8}\n          pathOptions={{\n            color: i === 0 ? '#22c55e' : i === waypoints.length - 1 ? '#ef4444' : '#f59e0b',\n            fillColor: i === 0 ? '#22c55e' : i === waypoints.length - 1 ? '#ef4444' : '#f59e0b',\n            fillOpacity: 1,\n            weight: 2\n          }}\n        >\n          <Popup>\n            <div className=\"text-slate-900\">\n              <strong>{wp.icao}</strong>\n              <br />\n              {wp.name}\n              <br />\n              <span className=\"text-sm\">Position: {i + 1} of {waypoints.length}</span>\n              <br />\n              {fuelPrices[wp.icao] && (\n                <span className=\"text-emerald-600 font-medium\">\n                  ${fuelPrices[wp.icao].price100ll}/gal\n                </span>\n              )}\n            </div>\n          </Popup>\n        </CircleMarker>\n      ))}\n    </MapContainer>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\fuel-saver\\MapControls.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useEffect' is defined but never used.","line":3,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":29,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"useEffect"},"fix":{"range":[34,45],"text":""},"desc":"Remove unused variable \"useEffect\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'LayersControl' is defined but never used.","line":4,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":23,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"LayersControl"},"fix":{"range":[72,86],"text":""},"desc":"Remove unused variable \"LayersControl\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useMap' is defined but never used.","line":4,"column":36,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":42,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"useMap"},"fix":{"range":[96,104],"text":""},"desc":"Remove unused variable \"useMap\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { LayersControl, TileLayer, useMap } from 'react-leaflet';\r\nimport 'leaflet/dist/leaflet.css';\r\n\r\nexport interface MapLayerOptions {\n  baseLayer: 'osm' | 'satellite' | 'terrain' | 'dark';\n  showLarge: boolean;\n  showMedium: boolean;\n  showSmall: boolean;\n  showSeaplane: boolean;\n  showTerrain: boolean;\n  showAirspaces: boolean;\n  showFuelPrices: boolean;\n  showStatePrices: boolean;\n  showTfrs: boolean;\n  showPireps: boolean;\n  performanceMode: boolean;\n}\n\r\ninterface MapControlsProps {\n  options: MapLayerOptions;\n  onOptionsChange: (options: MapLayerOptions) => void;\n}\n\r\n// Layer configuration\r\nconst LAYERS = {\r\n  osm: {\r\n    name: 'OSM',\r\n    url: 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',\r\n    attribution: '&copy; OpenStreetMap contributors'\r\n  },\r\n  satellite: {\r\n    name: 'Sat',\r\n    url: 'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',\r\n    attribution: '&copy; Esri'\r\n  },\r\n  terrain: {\r\n    name: 'Terrain',\r\n    url: 'https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png',\r\n    attribution: '&copy; OpenTopoMap'\r\n  },\r\n  dark: {\r\n    name: 'Dark',\r\n    url: 'https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png',\r\n    attribution: '&copy; CartoDB'\r\n  }\r\n};\r\n\r\nexport function MapControls({ options, onOptionsChange }: MapControlsProps) {\n  const [isCollapsed, setIsCollapsed] = useState(true);\n\r\n  const toggleOption = (key: keyof MapLayerOptions) => {\r\n    if (key === 'baseLayer') return;\r\n    onOptionsChange({\r\n      ...options,\r\n      [key]: !options[key as keyof MapLayerOptions]\r\n    });\r\n  };\r\n\r\n  const setBaseLayer = (layer: MapLayerOptions['baseLayer']) => {\r\n    onOptionsChange({ ...options, baseLayer: layer });\r\n  };\r\n\r\n  return (\r\n    <div className={`absolute bottom-4 right-4 z-[1000] transition-all`}>\r\n      {/* Toggle Button */}\r\n      <button\r\n        onClick={() => setIsCollapsed(!isCollapsed)}\r\n        className=\"bg-slate-800/95 hover:bg-slate-700 text-white p-2 rounded-lg shadow-xl border border-slate-700 mb-2\"\r\n        title={isCollapsed ? 'Show Map Controls' : 'Hide Map Controls'}\r\n      >\r\n        {isCollapsed ? 'â˜°' : 'âœ•'}\r\n      </button>\r\n\r\n      {!isCollapsed && (\r\n        <div className=\"bg-slate-800/95 backdrop-blur rounded-lg shadow-xl border border-slate-700 w-48 max-h-[60vh] overflow-y-auto\">\r\n          {/* Layer Selector */}\r\n          <div className=\"p-3 border-b border-slate-700\">\r\n            <div className=\"text-xs font-medium text-slate-400 mb-2 uppercase tracking-wide\">Map Layer</div>\r\n            <div className=\"grid grid-cols-2 gap-1\">\r\n              {(Object.keys(LAYERS) as MapLayerOptions['baseLayer'][]).map((layer) => (\r\n                <button\r\n                  key={layer}\r\n                  onClick={() => setBaseLayer(layer)}\r\n                  className={`px-2 py-1.5 text-xs rounded transition-colors ${\r\n                    options.baseLayer === layer\r\n                      ? 'bg-sky-500 text-white'\r\n                      : 'bg-slate-700 text-slate-300 hover:bg-slate-600'\r\n                  }`}\r\n                >\r\n                  {LAYERS[layer].name}\r\n                </button>\r\n              ))}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Airport Filters */}\r\n          <div className=\"p-3 border-b border-slate-700\">\r\n            <div className=\"text-xs font-medium text-slate-400 mb-2 uppercase tracking-wide\">Airports</div>\r\n            <div className=\"space-y-1.5\">\r\n              <label className=\"flex items-center gap-2 cursor-pointer\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  checked={options.showLarge}\r\n                  onChange={() => toggleOption('showLarge')}\r\n                  className=\"w-4 h-4 rounded bg-slate-700 border-slate-600 text-sky-500\"\r\n                />\r\n                <span className=\"text-sm\">\r\n                  <span className=\"inline-block w-2 h-2 rounded-full bg-red-500 mr-1\"></span>\r\n                  Large\r\n                </span>\r\n              </label>\r\n              <label className=\"flex items-center gap-2 cursor-pointer\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  checked={options.showMedium}\r\n                  onChange={() => toggleOption('showMedium')}\r\n                  className=\"w-4 h-4 rounded bg-slate-700 border-slate-600 text-sky-500\"\r\n                />\r\n                <span className=\"text-sm\">\r\n                  <span className=\"inline-block w-2 h-2 rounded-full bg-amber-500 mr-1\"></span>\r\n                  Medium\r\n                </span>\r\n              </label>\r\n              <label className=\"flex items-center gap-2 cursor-pointer\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  checked={options.showSmall}\r\n                  onChange={() => toggleOption('showSmall')}\r\n                  className=\"w-4 h-4 rounded bg-slate-700 border-slate-600 text-sky-500\"\r\n                />\r\n                <span className=\"text-sm\">\r\n                  <span className=\"inline-block w-2 h-2 rounded-full bg-green-500 mr-1\"></span>\r\n                  Small\r\n                </span>\r\n              </label>\r\n              <label className=\"flex items-center gap-2 cursor-pointer\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  checked={options.showSeaplane}\r\n                  onChange={() => toggleOption('showSeaplane')}\r\n                  className=\"w-4 h-4 rounded bg-slate-700 border-slate-600 text-sky-500\"\r\n                />\r\n                <span className=\"text-sm\">\r\n                  <span className=\"inline-block w-2 h-2 rounded-full bg-blue-500 mr-1\"></span>\r\n                  Seaplane\r\n                </span>\r\n              </label>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Overlays */}\r\n          <div className=\"p-3\">\r\n            <div className=\"text-xs font-medium text-slate-400 mb-2 uppercase tracking-wide\">Overlays</div>\r\n            <div className=\"space-y-1.5\">\r\n              <label className=\"flex items-center gap-2 cursor-pointer\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  checked={options.showFuelPrices}\r\n                  onChange={() => toggleOption('showFuelPrices')}\r\n                  className=\"w-4 h-4 rounded bg-slate-700 border-slate-600 text-sky-500\"\r\n                />\r\n                <span className=\"text-sm\">ðŸ’° Fuel Prices</span>\r\n              </label>\r\n              <label className=\"flex items-center gap-2 cursor-pointer\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  checked={options.showStatePrices}\r\n                  onChange={() => toggleOption('showStatePrices')}\r\n                  className=\"w-4 h-4 rounded bg-slate-700 border-slate-600 text-sky-500\"\r\n                />\r\n                <span className=\"text-sm\">ðŸ—ºï¸ State Prices</span>\r\n              </label>\r\n              <label className=\"flex items-center gap-2 cursor-pointer\">\n                <input\n                  type=\"checkbox\"\n                  checked={options.showTerrain}\n                  onChange={() => toggleOption('showTerrain')}\n                  className=\"w-4 h-4 rounded bg-slate-700 border-slate-600 text-sky-500\"\n                />\n                <span className=\"text-sm\">ðŸ”ï¸ Terrain</span>\n              </label>\n              <label className=\"flex items-center gap-2 cursor-pointer\">\n                <input\n                  type=\"checkbox\"\n                  checked={options.showTfrs}\n                  onChange={() => toggleOption('showTfrs')}\n                  className=\"w-4 h-4 rounded bg-slate-700 border-slate-600 text-red-500\"\n                />\n                <span className=\"text-sm\">ðŸ”´ TFRs</span>\n              </label>\n              <label className=\"flex items-center gap-2 cursor-pointer\">\n                <input\n                  type=\"checkbox\"\n                  checked={options.showPireps}\n                  onChange={() => toggleOption('showPireps')}\n                  className=\"w-4 h-4 rounded bg-slate-700 border-slate-600 text-purple-500\"\n                />\n                <span className=\"text-sm\">ðŸ›©ï¸ PIREPs</span>\n              </label>\n              <label className=\"flex items-center gap-2 cursor-pointer\">\n                <input\n                  type=\"checkbox\"\n                  checked={options.performanceMode}\n                  onChange={() => toggleOption('performanceMode')}\n                  className=\"w-4 h-4 rounded bg-slate-700 border-slate-600 text-green-500\"\n                />\n                <span className=\"text-sm\">âš¡ Performance Mode</span>\n              </label>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\r\n// Default options\nexport const DEFAULT_MAP_OPTIONS: MapLayerOptions = {\n  baseLayer: 'osm',\n  showLarge: true,\n  showMedium: true,\n  showSmall: true,\n  showSeaplane: false,\n  showTerrain: false,\n  showAirspaces: false,\n  showFuelPrices: true,\n  showStatePrices: true,\n  showTfrs: true,\n  showPireps: true,\n  performanceMode: false\n};\n\r\n// Tile layer component for the map\r\nexport function MapTileLayer({ baseLayer }: { baseLayer: MapLayerOptions['baseLayer'] }) {\r\n  const layer = LAYERS[baseLayer];\r\n  return (\r\n    <TileLayer\r\n      key={baseLayer}\r\n      url={layer.url}\r\n      attribution={layer.attribution}\r\n    />\r\n  );\r\n}\r\n\r\nexport { LAYERS };\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\fuel-saver\\PerformanceSettings.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\David\\next-dashboard\\app\\modules\\fuel-saver\\PerformanceSettings.tsx:40:11\n  38 |         try {\n  39 |           const parsed = JSON.parse(saved);\n> 40 |           setSettings(parsed);\n     |           ^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  41 |           onSettingsChange?.(parsed);\n  42 |         } catch (e) {\n  43 |           console.error('Error loading settings:', e);","line":40,"column":11,"nodeType":null,"endLine":40,"endColumn":22},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'onSettingsChange'. Either include it or remove the dependency array. If 'onSettingsChange' changes too often, find the parent component that defines it and wrap that definition in useCallback.","line":47,"column":6,"nodeType":"ArrayExpression","endLine":47,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [onSettingsChange]","fix":{"range":[1247,1249],"text":"[onSettingsChange]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect } from 'react';\n\ninterface PerformanceSettings {\n  threeDMode: boolean;\n  weatherPlayback: boolean;\n  animations: boolean;\n  liveWeather: boolean;\n  autoWeatherZoom: boolean;\n  showAirspaces: boolean;\n  showTerrain: boolean;\n}\n\ninterface PerformanceSettingsPanelProps {\n  onSettingsChange?: (settings: PerformanceSettings) => void;\n}\n\nconst DEFAULT_SETTINGS: PerformanceSettings = {\n  threeDMode: true,\n  weatherPlayback: true,\n  animations: true,\n  liveWeather: true,\n  autoWeatherZoom: true,\n  showAirspaces: false,\n  showTerrain: false,\n};\n\nexport default function PerformanceSettingsPanel({ onSettingsChange }: PerformanceSettingsPanelProps) {\n  const [settings, setSettings] = useState<PerformanceSettings>(DEFAULT_SETTINGS);\n  const [isOpen, setIsOpen] = useState(false);\n\n  // Load settings from localStorage on mount\n  useEffect(() => {\n    if (typeof window !== 'undefined') {\n      const saved = localStorage.getItem('performanceSettings');\n      if (saved) {\n        try {\n          const parsed = JSON.parse(saved);\n          setSettings(parsed);\n          onSettingsChange?.(parsed);\n        } catch (e) {\n          console.error('Error loading settings:', e);\n        }\n      }\n    }\n  }, []);\n\n  // Save settings when they change\n  const updateSettings = (newSettings: Partial<PerformanceSettings>) => {\n    const updated = { ...settings, ...newSettings };\n    setSettings(updated);\n    if (typeof window !== 'undefined') {\n      localStorage.setItem('performanceSettings', JSON.stringify(updated));\n    }\n    onSettingsChange?.(updated);\n  };\n\n  return (\n    <>\n      {/* Toggle Button */}\n      <button\n        onClick={() => setIsOpen(!isOpen)}\n        className=\"fixed bottom-4 right-4 z-[1001] bg-slate-800 hover:bg-slate-700 text-white p-3 rounded-full shadow-lg border border-slate-600\"\n        title=\"Performance Settings\"\n      >\n        âš™ï¸\n      </button>\n\n      {/* Panel */}\n      {isOpen && (\n        <div className=\"fixed bottom-16 right-4 z-[1000] bg-slate-800 rounded-lg shadow-xl border border-slate-700 w-72 p-4\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <h3 className=\"font-semibold text-white\">Performance</h3>\n            <button\n              onClick={() => setIsOpen(false)}\n              className=\"text-slate-400 hover:text-white\"\n            >\n              âœ•\n            </button>\n          </div>\n\n          <p className=\"text-xs text-slate-400 mb-4\">\n            Toggle features to improve performance on slower devices.\n          </p>\n\n          <div className=\"space-y-3\">\n            {/* 3D Mode */}\n            <label className=\"flex items-center justify-between cursor-pointer\">\n              <span className=\"text-sm text-slate-300\">3D Map Mode</span>\n              <input\n                type=\"checkbox\"\n                checked={settings.threeDMode}\n                onChange={(e) => updateSettings({ threeDMode: e.target.checked })}\n                className=\"w-5 h-5 rounded bg-slate-700 border-slate-600 text-sky-500\"\n              />\n            </label>\n\n            {/* Weather Playback */}\n            <label className=\"flex items-center justify-between cursor-pointer\">\n              <span className=\"text-sm text-slate-300\">Weather Playback</span>\n              <input\n                type=\"checkbox\"\n                checked={settings.weatherPlayback}\n                onChange={(e) => updateSettings({ weatherPlayback: e.target.checked })}\n                className=\"w-5 h-5 rounded bg-slate-700 border-slate-600 text-sky-500\"\n              />\n            </label>\n\n            {/* Animations */}\n            <label className=\"flex items-center justify-between cursor-pointer\">\n              <span className=\"text-sm text-slate-300\">Smooth Animations</span>\n              <input\n                type=\"checkbox\"\n                checked={settings.animations}\n                onChange={(e) => updateSettings({ animations: e.target.checked })}\n                className=\"w-5 h-5 rounded bg-slate-700 border-slate-600 text-sky-500\"\n              />\n            </label>\n\n            {/* Live Weather */}\n            <label className=\"flex items-center justify-between cursor-pointer\">\n              <span className=\"text-sm text-slate-300\">Live Weather</span>\n              <input\n                type=\"checkbox\"\n                checked={settings.liveWeather}\n                onChange={(e) => updateSettings({ liveWeather: e.target.checked })}\n                className=\"w-5 h-5 rounded bg-slate-700 border-slate-600 text-sky-500\"\n              />\n            </label>\n\n            {/* Auto Weather Zoom */}\n            <label className=\"flex items-center justify-between cursor-pointer\">\n              <span className=\"text-sm text-slate-300\">Auto Weather Zoom</span>\n              <input\n                type=\"checkbox\"\n                checked={settings.autoWeatherZoom}\n                onChange={(e) => updateSettings({ autoWeatherZoom: e.target.checked })}\n                className=\"w-5 h-5 rounded bg-slate-700 border-slate-600 text-sky-500\"\n              />\n            </label>\n\n            {/* Show Airspaces */}\n            <label className=\"flex items-center justify-between cursor-pointer\">\n              <span className=\"text-sm text-slate-300\">Show Airspaces</span>\n              <input\n                type=\"checkbox\"\n                checked={settings.showAirspaces}\n                onChange={(e) => updateSettings({ showAirspaces: e.target.checked })}\n                className=\"w-5 h-5 rounded bg-slate-700 border-slate-600 text-sky-500\"\n              />\n            </label>\n\n            {/* Show Terrain */}\n            <label className=\"flex items-center justify-between cursor-pointer\">\n              <span className=\"text-sm text-slate-300\">Show Terrain</span>\n              <input\n                type=\"checkbox\"\n                checked={settings.showTerrain}\n                onChange={(e) => updateSettings({ showTerrain: e.target.checked })}\n                className=\"w-5 h-5 rounded bg-slate-700 border-slate-600 text-sky-500\"\n              />\n            </label>\n          </div>\n\n          {/* Reset Button */}\n          <button\n            onClick={() => updateSettings(DEFAULT_SETTINGS)}\n            className=\"mt-4 w-full bg-slate-700 hover:bg-slate-600 text-white py-2 rounded text-sm\"\n          >\n            Reset to Defaults\n          </button>\n        </div>\n      )}\n    </>\n  );\n}\n\nexport { DEFAULT_SETTINGS, type PerformanceSettings };\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\fuel-saver\\RangeRing.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'RangeRingProps' is defined but never used.","line":5,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setCenter' is assigned a value but never used.","line":75,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":75,"endColumn":27},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\David\\next-dashboard\\app\\modules\\fuel-saver\\RangeRing.tsx:80:5\n  78 |   useEffect(() => {\n  79 |     const result = calculateRange(fuelCapacity, burnRate, cruiseSpeed, currentFuel, unusableFuel);\n> 80 |     setRange(result);\n     |     ^^^^^^^^ Avoid calling setState() directly within an effect\n  81 |     onRangeChange(result, center);\n  82 |   }, [fuelCapacity, burnRate, cruiseSpeed, currentFuel, unusableFuel, center]);\n  83 |","line":80,"column":5,"nodeType":null,"endLine":80,"endColumn":13},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'onRangeChange'. Either include it or remove the dependency array. If 'onRangeChange' changes too often, find the parent component that defines it and wrap that definition in useCallback.","line":82,"column":6,"nodeType":"ArrayExpression","endLine":82,"endColumn":78,"suggestions":[{"desc":"Update the dependencies array to be: [fuelCapacity, burnRate, cruiseSpeed, currentFuel, unusableFuel, center, onRangeChange]","fix":{"range":[2414,2486],"text":"[fuelCapacity, burnRate, cruiseSpeed, currentFuel, unusableFuel, center, onRangeChange]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect } from 'react';\n\ninterface RangeRingProps {\n  center: [number, number];\n  aircraft?: {\n    fuelCapacity: number;\n    burnRate: number;\n    cruiseSpeed: number;\n    unusableFuel?: number;\n  };\n  currentFuel?: number; // percentage or gallons\n}\n\ninterface RangeRingResult {\n  maxRangeNm: number;\n  usableFuel: number;\n  reserveFuel: number;\n  withReserve: number;\n}\n\n/**\n * Calculate range ring parameters\n * Default: 45 min + 1 hour reserve = 1.75 hours\n */\nexport function calculateRange(\n  fuelCapacity: number,\n  burnRate: number,\n  cruiseSpeed: number,\n  currentFuelPercent: number = 100,\n  unusableFuel: number = 2\n): RangeRingResult {\n  const currentFuel = (fuelCapacity * currentFuelPercent / 100) - unusableFuel;\n  \n  // Reserve: 45 min + 1 hour = 1.75 hours\n  const reserveHours = 1.75;\n  const reserveFuel = burnRate * reserveHours;\n  \n  // Usable fuel after reserves\n  const usableFuel = Math.max(0, currentFuel - reserveFuel);\n  \n  // Range without reserve\n  const maxRangeNm = (usableFuel / burnRate) * cruiseSpeed;\n  \n  // Range with reserve (what you can actually use)\n  const withReserve = ((currentFuel - unusableFuel) / burnRate) * cruiseSpeed;\n  \n  return {\n    maxRangeNm: Math.round(maxRangeNm),\n    usableFuel: Math.round(usableFuel * 10) / 10,\n    reserveFuel: Math.round(reserveFuel * 10) / 10,\n    withReserve: Math.round(withReserve)\n  };\n}\n\n/**\n * Range Ring Calculator Component\n */\nexport function RangeRingCalculator({ \n  onRangeChange, \n  initialCenter \n}: { \n  onRangeChange: (range: RangeRingResult, center: [number, number]) => void;\n  initialCenter?: [number, number];\n}) {\n  const [fuelCapacity, setFuelCapacity] = useState(56); // gallons\n  const [burnRate, setBurnRate] = useState(9.5); // gph\n  const [cruiseSpeed, setCruiseSpeed] = useState(120); // kts\n  const [currentFuel, setCurrentFuel] = useState(100); // percentage\n  const [unusableFuel, setUnusableFuel] = useState(2); // gallons\n  const [range, setRange] = useState<RangeRingResult | null>(null);\n\n  // Use selected airport as center when available\n  const [center, setCenter] = useState<[number, number]>(initialCenter || [39.8283, -98.5795]);\n\n  // Calculate range whenever inputs change\n  useEffect(() => {\n    const result = calculateRange(fuelCapacity, burnRate, cruiseSpeed, currentFuel, unusableFuel);\n    setRange(result);\n    onRangeChange(result, center);\n  }, [fuelCapacity, burnRate, cruiseSpeed, currentFuel, unusableFuel, center]);\n\n  return (\n    <div className=\"bg-slate-800 rounded-lg p-4 space-y-4\">\n      <h3 className=\"font-semibold text-white flex items-center gap-2\">\n        <span>â›½</span> Range Calculator\n      </h3>\n      \n      {/* Quick Aircraft Select */}\n      <div>\n        <label className=\"block text-xs text-slate-400 mb-1\">Quick Select</label>\n        <select\n          onChange={(e) => {\n            const presets: Record<string, { fuel: number; burn: number; speed: number }> = {\n              '172s': { fuel: 56, burn: 9.5, speed: 122 },\n              '182t': { fuel: 87, burn: 13.5, speed: 150 },\n              'pa28': { fuel: 48, burn: 8.5, speed: 120 },\n              'sr22': { fuel: 92, burn: 12.5, speed: 180 },\n              'bonanza': { fuel: 102, burn: 14, speed: 155 }\n            };\n            const preset = presets[e.target.value];\n            if (preset) {\n              setFuelCapacity(preset.fuel);\n              setBurnRate(preset.burn);\n              setCruiseSpeed(preset.speed);\n            }\n          }}\n          className=\"w-full bg-slate-700 border border-slate-600 rounded px-3 py-2 text-white text-sm\"\n        >\n          <option value=\"\">Custom</option>\n          <option value=\"172s\">Cessna 172S</option>\n          <option value=\"182t\">Cessna 182T</option>\n          <option value=\"pa28\">Piper Archer</option>\n          <option value=\"sr22\">Cirrus SR22</option>\n          <option value=\"bonanza\">Beechcraft Bonanza</option>\n        </select>\n      </div>\n\n      {/* Manual Inputs */}\n      <div className=\"grid grid-cols-2 gap-3\">\n        <div>\n          <label className=\"block text-xs text-slate-400 mb-1\">Fuel (gal)</label>\n          <input\n            type=\"number\"\n            value={fuelCapacity}\n            onChange={(e) => setFuelCapacity(Number(e.target.value))}\n            min=\"1\"\n            max=\"500\"\n            className=\"w-full bg-slate-700 border border-slate-600 rounded px-3 py-2 text-white text-sm\"\n          />\n        </div>\n        <div>\n          <label className=\"block text-xs text-slate-400 mb-1\">Fuel on Board</label>\n          <div className=\"flex items-center gap-2\">\n            <input\n              type=\"range\"\n              value={currentFuel}\n              onChange={(e) => setCurrentFuel(Number(e.target.value))}\n              min=\"10\"\n              max=\"100\"\n              className=\"flex-1\"\n            />\n            <span className=\"text-white text-sm w-12 text-right\">{currentFuel}%</span>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-2 gap-3\">\n        <div>\n          <label className=\"block text-xs text-slate-400 mb-1\">Burn Rate (gph)</label>\n          <input\n            type=\"number\"\n            value={burnRate}\n            onChange={(e) => setBurnRate(Number(e.target.value))}\n            min=\"1\"\n            max=\"50\"\n            step=\"0.5\"\n            className=\"w-full bg-slate-700 border border-slate-600 rounded px-3 py-2 text-white text-sm\"\n          />\n        </div>\n        <div>\n          <label className=\"block text-xs text-slate-400 mb-1\">Cruise Speed (kts)</label>\n          <input\n            type=\"number\"\n            value={cruiseSpeed}\n            onChange={(e) => setCruiseSpeed(Number(e.target.value))}\n            min=\"50\"\n            max=\"500\"\n            className=\"w-full bg-slate-700 border border-slate-600 rounded px-3 py-2 text-white text-sm\"\n          />\n        </div>\n      </div>\n\n      <div>\n        <label className=\"block text-xs text-slate-400 mb-1\">Unusable Fuel (gal)</label>\n        <input\n          type=\"number\"\n          value={unusableFuel}\n          onChange={(e) => setUnusableFuel(Number(e.target.value))}\n          min=\"0\"\n          max=\"10\"\n          className=\"w-full bg-slate-700 border border-slate-600 rounded px-3 py-2 text-white text-sm\"\n        />\n      </div>\n\n      {/* Results */}\n      {range && (\n        <div className=\"bg-slate-700 rounded-lg p-3 space-y-2\">\n          <div className=\"flex justify-between items-center\">\n            <span className=\"text-slate-400 text-sm\">Max Range:</span>\n            <span className=\"text-green-400 font-bold text-lg\">{range.maxRangeNm} nm</span>\n          </div>\n          <div className=\"flex justify-between items-center\">\n            <span className=\"text-slate-400 text-sm\">With 1.75hr Reserve:</span>\n            <span className=\"text-yellow-400 font-semibold\">{range.withReserve} nm</span>\n          </div>\n          <div className=\"flex justify-between items-center text-xs\">\n            <span className=\"text-slate-500\">Usable Fuel:</span>\n            <span className=\"text-slate-300\">{range.usableFuel} gal</span>\n          </div>\n          <div className=\"flex justify-between items-center text-xs\">\n            <span className=\"text-slate-500\">Reserve Required:</span>\n            <span className=\"text-slate-300\">{range.reserveFuel} gal</span>\n          </div>\n        </div>\n      )}\n\n      <button\n        onClick={() => center && onRangeChange(range!, center)}\n        className=\"w-full bg-sky-500 hover:bg-sky-600 text-white rounded-lg py-2 text-sm font-medium\"\n      >\n        Show on Map\n      </button>\n    </div>\n  );\n}\n\nexport default RangeRingCalculator;\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\fuel-saver\\StateInfoPanel.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useState' is defined but never used.","line":3,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":18,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"useState"},"fix":{"range":[24,33],"text":""},"desc":"Remove unused variable \"useState\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useEffect' is defined but never used.","line":3,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":29,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"useEffect"},"fix":{"range":[15,60],"text":""},"desc":"Remove unused import declaration."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect } from 'react';\n\ninterface StateInfo {\n  state: string;\n  stateName: string;\n  nickname: string;\n  capital: string;\n  region: string;\n  bio: string;\n  terrain: string;\n  majorAirports: string[];\n  attractions: string[];\n  funFact: string;\n  avgElevation: number;\n  climate: string;\n  medianPrice?: number;\n  sampleCount?: number;\n}\n\ninterface StateInfoPanelProps {\n  stateInfo: StateInfo | null;\n  onClose: () => void;\n  onAirportClick?: (icao: string) => void;\n}\n\nexport default function StateInfoPanel({ stateInfo, onClose, onAirportClick }: StateInfoPanelProps) {\n  if (!stateInfo) return null;\n\n  // Get region color\n  const getRegionColor = (region: string) => {\n    switch (region) {\n      case 'Northeast': return 'from-blue-500 to-cyan-500';\n      case 'South': return 'from-red-500 to-orange-500';\n      case 'Midwest': return 'from-green-500 to-emerald-500';\n      case 'West': return 'from-purple-500 to-pink-500';\n      default: return 'from-slate-500 to-slate-600';\n    }\n  };\n\n  return (\n    <div className=\"absolute top-4 left-4 z-[1000] w-80 animate-in slide-in-from-left duration-300\">\n      {/* Main Card */}\n      <div className=\"bg-slate-900/95 backdrop-blur-xl rounded-2xl border border-slate-700/50 shadow-2xl overflow-hidden\">\n        \n        {/* Header with gradient */}\n        <div className={`bg-gradient-to-r ${getRegionColor(stateInfo.region)} p-4 relative overflow-hidden`}>\n          {/* Decorative elements */}\n          <div className=\"absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -mr-16 -mt-16 blur-2xl\"></div>\n          <div className=\"absolute bottom-0 left-0 w-20 h-20 bg-white/10 rounded-full -ml-10 -mb-10 blur-xl\"></div>\n          \n          <div className=\"relative z-10\">\n            <button\n              onClick={onClose}\n              className=\"absolute top-0 right-0 w-7 h-7 bg-white/20 hover:bg-white/30 rounded-full flex items-center justify-center text-white text-lg font-bold transition-colors\"\n            >\n              Ã—\n            </button>\n            <div className=\"flex items-center gap-3\">\n              <div className=\"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center backdrop-blur\">\n                <span className=\"text-2xl font-bold text-white\">{stateInfo.state}</span>\n              </div>\n              <div>\n                <h2 className=\"text-xl font-bold text-white\">{stateInfo.stateName}</h2>\n                <p className=\"text-white/80 text-sm\">The {stateInfo.nickname}</p>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Content */}\n        <div className=\"p-4 space-y-4\">\n          \n          {/* Quick Stats Grid */}\n          <div className=\"grid grid-cols-2 gap-2\">\n            <div className=\"bg-slate-800/50 rounded-xl p-3 text-center\">\n              <div className=\"text-2xl font-bold text-sky-400\">${stateInfo.medianPrice?.toFixed(2) || '--'}</div>\n              <div className=\"text-xs text-slate-400\">Avg Fuel Price</div>\n              {stateInfo.sampleCount && (\n                <div className=\"text-xs text-slate-500\">{stateInfo.sampleCount} airports</div>\n              )}\n            </div>\n            <div className=\"bg-slate-800/50 rounded-xl p-3 text-center\">\n              <div className=\"text-2xl font-bold text-emerald-400\">{stateInfo.avgElevation.toLocaleString()}</div>\n              <div className=\"text-xs text-slate-400\">Avg Elevation</div>\n              <div className=\"text-xs text-slate-500\">ft</div>\n            </div>\n          </div>\n\n          {/* Bio */}\n          <div className=\"bg-slate-800/30 rounded-xl p-3\">\n            <p className=\"text-sm text-slate-300 leading-relaxed\">{stateInfo.bio}</p>\n          </div>\n\n          {/* Quick Facts */}\n          <div className=\"grid grid-cols-2 gap-2 text-sm\">\n            <div className=\"flex items-center gap-2\">\n              <span className=\"text-slate-500\">ðŸ“</span>\n              <span className=\"text-slate-300\">Capital: <strong>{stateInfo.capital}</strong></span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <span className=\"text-slate-500\">ðŸŒ¡ï¸</span>\n              <span className=\"text-slate-300\">{stateInfo.climate}</span>\n            </div>\n          </div>\n\n          {/* Terrain */}\n          <div className=\"bg-gradient-to-r from-amber-900/30 to-orange-900/30 rounded-xl p-3 border border-amber-700/30\">\n            <div className=\"flex items-center gap-2 mb-1\">\n              <span className=\"text-amber-400\">ðŸ”ï¸</span>\n              <span className=\"text-sm font-medium text-amber-200\">Terrain</span>\n            </div>\n            <p className=\"text-xs text-slate-300\">{stateInfo.terrain}</p>\n          </div>\n\n          {/* Attractions */}\n          <div>\n            <div className=\"flex items-center gap-2 mb-2\">\n              <span className=\"text-pink-400\">ðŸŽ¯</span>\n              <span className=\"text-sm font-medium text-slate-300\">Top Attractions</span>\n            </div>\n            <div className=\"flex flex-wrap gap-1.5\">\n              {stateInfo.attractions.slice(0, 3).map((attraction, i) => (\n                <span \n                  key={i} \n                  className=\"text-xs bg-slate-800/60 text-slate-300 px-2 py-1 rounded-lg border border-slate-700/50\"\n                >\n                  {attraction}\n                </span>\n              ))}\n            </div>\n          </div>\n\n          {/* Major Airports */}\n          {stateInfo.majorAirports.length > 0 && (\n            <div>\n              <div className=\"flex items-center gap-2 mb-2\">\n                <span className=\"text-sky-400\">âœˆï¸</span>\n                <span className=\"text-sm font-medium text-slate-300\">Major Airports</span>\n              </div>\n              <div className=\"flex flex-wrap gap-1.5\">\n                {stateInfo.majorAirports.map((icao, i) => (\n                  <button\n                    key={i}\n                    onClick={() => onAirportClick?.(icao)}\n                    className=\"text-xs bg-sky-900/40 hover:bg-sky-800/60 text-sky-300 px-2 py-1 rounded-lg border border-sky-700/30 hover:border-sky-500/50 transition-colors\"\n                  >\n                    {icao}\n                  </button>\n                ))}\n              </div>\n            </div>\n          )}\n\n          {/* Fun Fact */}\n          <div className=\"bg-gradient-to-r from-violet-900/30 to-purple-900/30 rounded-xl p-3 border border-violet-700/30\">\n            <div className=\"flex items-center gap-2 mb-1\">\n              <span className=\"text-violet-400\">ðŸ’¡</span>\n              <span className=\"text-sm font-medium text-violet-200\">Fun Fact</span>\n            </div>\n            <p className=\"text-xs text-slate-300\">{stateInfo.funFact}</p>\n          </div>\n\n        </div>\n      </div>\n\n      {/* Decorative corner */}\n      <div className=\"absolute -bottom-2 -right-2 w-8 h-8 bg-gradient-to-tl from-sky-500/30 to-transparent rounded-bl-2xl\"></div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\fuel-saver\\TierExplainerModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'session' is assigned a value but never used.","line":12,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":24},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\David\\next-dashboard\\app\\modules\\fuel-saver\\TierExplainerModal.tsx:20:9\n  18 |       const seen = localStorage.getItem('hasSeenTierExplainer');\n  19 |       if (seen) {\n> 20 |         setHasSeenExplainer(true);\n     |         ^^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  21 |       }\n  22 |     }\n  23 |   }, []);","line":20,"column":9,"nodeType":null,"endLine":20,"endColumn":28}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect } from 'react';\nimport { useSession } from 'next-auth/react';\n\ninterface TierExplainerModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nexport default function TierExplainerModal({ isOpen, onClose }: TierExplainerModalProps) {\n  const { data: session } = useSession();\n  const [hasSeenExplainer, setHasSeenExplainer] = useState(false);\n\n  useEffect(() => {\n    // Check if user has seen the explainer before\n    if (typeof window !== 'undefined') {\n      const seen = localStorage.getItem('hasSeenTierExplainer');\n      if (seen) {\n        setHasSeenExplainer(true);\n      }\n    }\n  }, []);\n\n  const handleClose = () => {\n    // Mark as seen\n    if (typeof window !== 'undefined') {\n      localStorage.setItem('hasSeenTierExplainer', 'true');\n    }\n    setHasSeenExplainer(true);\n    onClose();\n  };\n\n  if (!isOpen || hasSeenExplainer) return null;\n\n  return (\n    <div className=\"fixed inset-0 z-[9998] flex items-center justify-center\">\n      {/* Backdrop */}\n      <div \n        className=\"absolute inset-0 bg-black/70 backdrop-blur-sm\"\n        onClick={handleClose}\n      />\n      \n      {/* Modal */}\n      <div className=\"relative bg-slate-800 rounded-2xl p-8 max-w-lg w-full mx-4 shadow-2xl border border-slate-700\">\n        {/* Header with plane animation */}\n        <div className=\"text-center mb-6\">\n          <div className=\"text-5xl mb-4\">âœˆï¸</div>\n          <h2 className=\"text-2xl font-bold text-white\">\n            Welcome to Signal Desk! \n          </h2>\n          <p className=\"text-slate-400 mt-2\">\n            Your free flight planning & fuel saver tool\n          </p>\n        </div>\n\n        {/* Free vs Pro comparison */}\n        <div className=\"space-y-4 mb-6\">\n          {/* Free Tier */}\n          <div className=\"bg-slate-700/50 rounded-xl p-4 border border-slate-600\">\n            <div className=\"flex items-center justify-between mb-3\">\n              <span className=\"text-lg font-semibold text-white\">Free</span>\n              <span className=\"text-slate-400\">$0 forever</span>\n            </div>\n            <ul className=\"space-y-2 text-sm text-slate-300\">\n              <li className=\"flex items-center gap-2\">\n                <span className=\"text-emerald-400\">âœ“</span> Up to 6 waypoints per flight\n              </li>\n              <li className=\"flex items-center gap-2\">\n                <span className=\"text-emerald-400\">âœ“</span> Up to 5 saved flight plans\n              </li>\n              <li className=\"flex items-center gap-2\">\n                <span className=\"text-emerald-400\">âœ“</span> 1 Flying Club\n              </li>\n              <li className=\"flex items-center gap-2\">\n                <span className=\"text-emerald-400\">âœ“</span> 3 Aircraft profiles\n              </li>\n              <li className=\"flex items-center gap-2\">\n                <span className=\"text-emerald-400\">âœ“</span> Home state fuel prices\n              </li>\n            </ul>\n          </div>\n\n          {/* Pro Tier */}\n          <div className=\"bg-gradient-to-br from-emerald-500/10 to-emerald-600/10 rounded-xl p-4 border-2 border-emerald-500/50\">\n            <div className=\"flex items-center justify-between mb-3\">\n              <span className=\"text-lg font-semibold text-emerald-400\">Pro</span>\n              <div className=\"text-right\">\n                <span className=\"text-2xl font-bold text-white\">$3.99</span>\n                <span className=\"text-slate-400 text-sm\">/mo</span>\n              </div>\n            </div>\n            <ul className=\"space-y-2 text-sm text-slate-300\">\n              <li className=\"flex items-center gap-2\">\n                <span className=\"text-emerald-400\">âœ“</span> <strong className=\"text-white\">Unlimited</strong> waypoints\n              </li>\n              <li className=\"flex items-center gap-2\">\n                <span className=\"text-emerald-400\">âœ“</span> <strong className=\"text-white\">Unlimited</strong> flight plans\n              </li>\n              <li className=\"flex items-center gap-2\">\n                <span className=\"text-emerald-400\">âœ“</span> <strong className=\"text-white\">Unlimited</strong> Flying Clubs\n              </li>\n              <li className=\"flex items-center gap-2\">\n                <span className=\"text-emerald-400\">âœ“</span> <strong className=\"text-white\">Unlimited</strong> Aircraft\n              </li>\n              <li className=\"flex items-center gap-2\">\n                <span className=\"text-emerald-400\">âœ“</span> All 50 states fuel prices\n              </li>\n              <li className=\"flex items-center gap-2\">\n                <span className=\"text-emerald-400\">âœ“</span> Document storage (POH, insurance)\n              </li>\n              <li className=\"flex items-center gap-2\">\n                <span className=\"text-emerald-400\">âœ“</span> Export to ForeFlight & Garmin\n              </li>\n            </ul>\n          </div>\n        </div>\n\n        {/* Early bird pricing */}\n        <div className=\"bg-amber-500/10 border border-amber-500/30 rounded-lg p-3 mb-6 text-center\">\n          <p className=\"text-amber-400 font-semibold\">\n            ðŸŽ‰ Early Bird Pricing: $39.99/year (save 17%)\n          </p>\n          <p className=\"text-xs text-slate-400 mt-1\">\n            Lock in this rate for life when you sign up now!\n          </p>\n        </div>\n\n        {/* Buttons */}\n        <div className=\"flex flex-col gap-3\">\n          <button\n            onClick={handleClose}\n            className=\"w-full bg-emerald-500 hover:bg-emerald-400 text-white font-semibold py-3 px-4 rounded-lg transition\"\n          >\n            Got it, thanks!\n          </button>\n        </div>\n\n        {/* Privacy note */}\n        <p className=\"text-xs text-slate-500 text-center mt-4\">\n          ðŸ”’ We never sell your data. No ads. Built by a pilot, for pilots.\n        </p>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\fuel-saver\\UpgradeModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'session' is assigned a value but never used.","line":22,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":22,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'status' is assigned a value but never used.","line":22,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":22,"endColumn":32},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\David\\next-dashboard\\app\\modules\\fuel-saver\\UpgradeModal.tsx:29:7\n  27 |   useEffect(() => {\n  28 |     if (isOpen) {\n> 29 |       setLoading(false);\n     |       ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  30 |     }\n  31 |   }, [isOpen]);\n  32 |","line":29,"column":7,"nodeType":null,"endLine":29,"endColumn":17}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect } from 'react';\nimport { useSession } from 'next-auth/react';\nimport { useRouter } from 'next/navigation';\n\ninterface UpgradeModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  title?: string;\n  message?: string;\n  feature?: string;\n}\n\nexport default function UpgradeModal({ \n  isOpen, \n  onClose, \n  title = 'Upgrade to Pro',\n  message = 'You\\'ve reached the free tier limit. Upgrade to Pro to unlock unlimited features!',\n  feature\n}: UpgradeModalProps) {\n  const { data: session, status } = useSession();\n  const router = useRouter();\n  const [loading, setLoading] = useState(false);\n\n  // Reset state when modal opens\n  useEffect(() => {\n    if (isOpen) {\n      setLoading(false);\n    }\n  }, [isOpen]);\n\n  if (!isOpen) return null;\n\n  const handleUpgrade = async () => {\n    setLoading(true);\n    // Redirect to billing/upgrade page\n    router.push('/billing?upgrade=true');\n    onClose();\n  };\n\n  const handleContinueFree = () => {\n    // User chooses to continue with free tier limits\n    onClose();\n  };\n\n  return (\n    <div className=\"fixed inset-0 z-[9999] flex items-center justify-center\">\n      {/* Backdrop */}\n      <div \n        className=\"absolute inset-0 bg-black/60 backdrop-blur-sm\"\n        onClick={onClose}\n      />\n      \n      {/* Modal */}\n      <div className=\"relative bg-slate-800 rounded-xl p-6 max-w-sm w-full mx-4 shadow-2xl border border-slate-700\">\n        {/* Icon */}\n        <div className=\"text-4xl text-center mb-4\">\n          ðŸš€\n        </div>\n\n        {/* Title */}\n        <h3 className=\"text-xl font-bold text-white text-center mb-2\">\n          {title}\n        </h3>\n\n        {/* Feature-specific message */}\n        {feature && (\n          <div className=\"mb-4 p-3 bg-amber-500/10 border border-amber-500/30 rounded-lg\">\n            <p className=\"text-amber-400 text-sm text-center\">\n              <span className=\"font-semibold\">{feature}</span> is available on Pro\n            </p>\n          </div>\n        )}\n\n        {/* Description */}\n        <p className=\"text-slate-400 text-center mb-6\">\n          {message}\n        </p>\n\n        {/* Pricing */}\n        <div className=\"flex gap-3 mb-6\">\n          <div className=\"flex-1 bg-slate-700 rounded-lg p-3 text-center\">\n            <div className=\"text-2xl font-bold text-white\">$3.99</div>\n            <div className=\"text-xs text-slate-400\">per month</div>\n          </div>\n          <div className=\"flex-1 bg-gradient-to-br from-emerald-500/20 to-emerald-600/20 rounded-lg p-3 text-center border border-emerald-500/30\">\n            <div className=\"text-2xl font-bold text-emerald-400\">$39.99</div>\n            <div className=\"text-xs text-emerald-300\">per year</div>\n            <div className=\"text-[10px] text-emerald-300\">Save 17%</div>\n          </div>\n        </div>\n\n        {/* Buttons */}\n        <div className=\"flex flex-col gap-3\">\n          <button\n            onClick={handleUpgrade}\n            disabled={loading}\n            className=\"w-full bg-emerald-500 hover:bg-emerald-400 disabled:bg-slate-600 text-white font-semibold py-3 px-4 rounded-lg transition\"\n          >\n            {loading ? 'Redirecting...' : 'Upgrade to Pro'}\n          </button>\n          \n          <button\n            onClick={handleContinueFree}\n            className=\"w-full bg-slate-700 hover:bg-slate-600 text-white font-medium py-3 px-4 rounded-lg transition\"\n          >\n            Continue with Free\n          </button>\n        </div>\n\n        {/* Features list */}\n        <div className=\"mt-6 pt-4 border-t border-slate-700\">\n          <p className=\"text-xs text-slate-500 mb-2 text-center\">Pro includes:</p>\n          <div className=\"grid grid-cols-2 gap-1 text-xs text-slate-400\">\n            <div className=\"flex items-center gap-1\">âœ“ Unlimited flight plans</div>\n            <div className=\"flex items-center gap-1\">âœ“ Unlimited waypoints</div>\n            <div className=\"flex items-center gap-1\">âœ“ Multiple clubs</div>\n            <div className=\"flex items-center gap-1\">âœ“ Document storage</div>\n            <div className=\"flex items-center gap-1\">âœ“ All US fuel prices</div>\n            <div className=\"flex items-center gap-1\">âœ“ Export toForeFlight</div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\fuel-saver\\WindImpactGraph.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\David\\next-dashboard\\app\\modules\\fuel-saver\\WindImpactGraph.tsx:37:5\n  35 |     const length = path.getTotalLength?.() || 1000;\n  36 |     \n> 37 |     setDashOffset(length * (1 - progress));\n     |     ^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  38 |   }, [progress, points]);\n  39 |   \n  40 |   return (","line":37,"column":5,"nodeType":null,"endLine":37,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'hoveredPoint' is assigned a value but never used.","line":64,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":64,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setHoveredPoint' is assigned a value but never used.","line":64,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":64,"endColumn":39},{"ruleId":"react-hooks/preserve-manual-memoization","severity":2,"message":"Compilation Skipped: Existing memoization could not be preserved\n\nReact Compiler has skipped optimizing this component because the existing manual memoization could not be preserved. The inferred dependencies did not match the manually specified dependencies, which could cause the value to change more or less frequently than expected. The inferred dependency was `xScale`, but the source dependencies were [data, maxDistance, maxImpact]. Inferred different dependency than source.\n\nC:\\Users\\David\\next-dashboard\\app\\modules\\fuel-saver\\WindImpactGraph.tsx:87:28\n  85 |   \n  86 |   // Generate path\n> 87 |   const linePath = useMemo(() => {\n     |                            ^^^^^^^\n> 88 |     if (data.length === 0) return '';\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 89 |     \n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 90 |     return data.map((point, i) => {\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 91 |       const x = xScale(point.distanceNm);\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 92 |       const y = yScale(point.cumulativeImpactGallons);\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 93 |       return i === 0 ? `M ${x} ${y}` : `L ${x} ${y}`;\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 94 |     }).join(' ');\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 95 |   }, [data, maxDistance, maxImpact]);\n     | ^^^^ Could not preserve existing manual memoization\n  96 |   \n  97 |   // Current progress (0-1)\n  98 |   const currentProgress = maxDistance > 0 ? currentDistanceNm / maxDistance : 0;","line":87,"column":28,"nodeType":null,"endLine":95,"endColumn":4},{"ruleId":"react-hooks/preserve-manual-memoization","severity":2,"message":"Compilation Skipped: Existing memoization could not be preserved\n\nReact Compiler has skipped optimizing this component because the existing manual memoization could not be preserved. The inferred dependencies did not match the manually specified dependencies, which could cause the value to change more or less frequently than expected. The inferred dependency was `yScale`, but the source dependencies were [data, maxDistance, maxImpact]. Inferred different dependency than source.\n\nC:\\Users\\David\\next-dashboard\\app\\modules\\fuel-saver\\WindImpactGraph.tsx:87:28\n  85 |   \n  86 |   // Generate path\n> 87 |   const linePath = useMemo(() => {\n     |                            ^^^^^^^\n> 88 |     if (data.length === 0) return '';\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 89 |     \n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 90 |     return data.map((point, i) => {\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 91 |       const x = xScale(point.distanceNm);\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 92 |       const y = yScale(point.cumulativeImpactGallons);\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 93 |       return i === 0 ? `M ${x} ${y}` : `L ${x} ${y}`;\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 94 |     }).join(' ');\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 95 |   }, [data, maxDistance, maxImpact]);\n     | ^^^^ Could not preserve existing manual memoization\n  96 |   \n  97 |   // Current progress (0-1)\n  98 |   const currentProgress = maxDistance > 0 ? currentDistanceNm / maxDistance : 0;","line":87,"column":28,"nodeType":null,"endLine":95,"endColumn":4},{"ruleId":"react-hooks/preserve-manual-memoization","severity":2,"message":"Compilation Skipped: Existing memoization could not be preserved\n\nReact Compiler has skipped optimizing this component because the existing manual memoization could not be preserved. The inferred dependencies did not match the manually specified dependencies, which could cause the value to change more or less frequently than expected. The inferred dependency was `xScale`, but the source dependencies were [data, maxDistance, maxImpact]. Inferred different dependency than source.\n\nC:\\Users\\David\\next-dashboard\\app\\modules\\fuel-saver\\WindImpactGraph.tsx:87:28\n  85 |   \n  86 |   // Generate path\n> 87 |   const linePath = useMemo(() => {\n     |                            ^^^^^^^\n> 88 |     if (data.length === 0) return '';\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 89 |     \n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 90 |     return data.map((point, i) => {\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 91 |       const x = xScale(point.distanceNm);\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 92 |       const y = yScale(point.cumulativeImpactGallons);\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 93 |       return i === 0 ? `M ${x} ${y}` : `L ${x} ${y}`;\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 94 |     }).join(' ');\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 95 |   }, [data, maxDistance, maxImpact]);\n     | ^^^^ Could not preserve existing manual memoization\n  96 |   \n  97 |   // Current progress (0-1)\n  98 |   const currentProgress = maxDistance > 0 ? currentDistanceNm / maxDistance : 0;","line":87,"column":28,"nodeType":null,"endLine":95,"endColumn":4},{"ruleId":"react-hooks/preserve-manual-memoization","severity":2,"message":"Compilation Skipped: Existing memoization could not be preserved\n\nReact Compiler has skipped optimizing this component because the existing manual memoization could not be preserved. The inferred dependencies did not match the manually specified dependencies, which could cause the value to change more or less frequently than expected. The inferred dependency was `yScale`, but the source dependencies were [data, maxDistance, maxImpact]. Inferred different dependency than source.\n\nC:\\Users\\David\\next-dashboard\\app\\modules\\fuel-saver\\WindImpactGraph.tsx:87:28\n  85 |   \n  86 |   // Generate path\n> 87 |   const linePath = useMemo(() => {\n     |                            ^^^^^^^\n> 88 |     if (data.length === 0) return '';\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 89 |     \n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 90 |     return data.map((point, i) => {\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 91 |       const x = xScale(point.distanceNm);\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 92 |       const y = yScale(point.cumulativeImpactGallons);\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 93 |       return i === 0 ? `M ${x} ${y}` : `L ${x} ${y}`;\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 94 |     }).join(' ');\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 95 |   }, [data, maxDistance, maxImpact]);\n     | ^^^^ Could not preserve existing manual memoization\n  96 |   \n  97 |   // Current progress (0-1)\n  98 |   const currentProgress = maxDistance > 0 ? currentDistanceNm / maxDistance : 0;","line":87,"column":28,"nodeType":null,"endLine":95,"endColumn":4},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has missing dependencies: 'xScale' and 'yScale'. Either include them or remove the dependency array.","line":95,"column":6,"nodeType":"ArrayExpression","endLine":95,"endColumn":36,"suggestions":[{"desc":"Update the dependencies array to be: [data, xScale, yScale]","fix":{"range":[2616,2646],"text":"[data, xScale, yScale]"}}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\David\\next-dashboard\\app\\modules\\fuel-saver\\WindImpactGraph.tsx:114:7\n  112 |       animationRef.current = requestAnimationFrame(animate);\n  113 |     } else {\n> 114 |       setAnimatedProgress(currentProgress);\n      |       ^^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  115 |     }\n  116 |     \n  117 |     return () => {","line":114,"column":7,"nodeType":null,"endLine":114,"endColumn":26}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect, useRef, useMemo } from 'react';\n\ninterface WindImpactPoint {\n  distanceNm: number;\n  cumulativeImpactGallons: number;\n  impactDollars?: number;\n}\n\ninterface WindImpactGraphProps {\n  data: WindImpactPoint[];\n  currentDistanceNm: number;\n  isPlaying: boolean;\n  onPlayPause: () => void;\n  fuelPricePerGallon?: number;\n}\n\n// Animated path component\nfunction AnimatedLine({ \n  points, \n  progress, \n  color \n}: { \n  points: string; \n  progress: number; \n  color: string;\n}) {\n  const [dashOffset, setDashOffset] = useState(0);\n  \n  useEffect(() => {\n    // Calculate path length\n    const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n    path.setAttribute('d', points);\n    const length = path.getTotalLength?.() || 1000;\n    \n    setDashOffset(length * (1 - progress));\n  }, [progress, points]);\n  \n  return (\n    <path\n      d={points}\n      fill=\"none\"\n      stroke={color}\n      strokeWidth=\"2\"\n      strokeLinecap=\"round\"\n      strokeLinejoin=\"round\"\n      style={{\n        strokeDasharray: '1000',\n        strokeDashoffset: dashOffset,\n        transition: 'stroke-dashoffset 0.1s ease-out'\n      }}\n    />\n  );\n}\n\nexport default function WindImpactGraph({\n  data,\n  currentDistanceNm,\n  isPlaying,\n  onPlayPause,\n  fuelPricePerGallon = 6.0\n}: WindImpactGraphProps) {\n  const [hoveredPoint, setHoveredPoint] = useState<WindImpactPoint | null>(null);\n  const [animatedProgress, setAnimatedProgress] = useState(0);\n  const animationRef = useRef<number | null>(null);\n  \n  // Calculate graph dimensions\n  const width = 280;\n  const height = 100;\n  const padding = { top: 10, right: 10, bottom: 25, left: 10 };\n  const graphWidth = width - padding.left - padding.right;\n  const graphHeight = height - padding.top - padding.bottom;\n  \n  // Calculate scales\n  const maxDistance = useMemo(() => Math.max(...data.map(d => d.distanceNm), 100), [data]);\n  const maxImpact = useMemo(() => {\n    const max = Math.max(...data.map(d => Math.abs(d.cumulativeImpactGallons)));\n    return Math.max(max, 1); // Minimum 1 gallon range\n  }, [data]);\n  \n  // Scale functions\n  const xScale = (d: number) => padding.left + (d / maxDistance) * graphWidth;\n  const yScale = (g: number) => padding.top + graphHeight / 2 - (g / maxImpact) * (graphHeight / 2);\n  \n  // Generate path\n  const linePath = useMemo(() => {\n    if (data.length === 0) return '';\n    \n    return data.map((point, i) => {\n      const x = xScale(point.distanceNm);\n      const y = yScale(point.cumulativeImpactGallons);\n      return i === 0 ? `M ${x} ${y}` : `L ${x} ${y}`;\n    }).join(' ');\n  }, [data, maxDistance, maxImpact]);\n  \n  // Current progress (0-1)\n  const currentProgress = maxDistance > 0 ? currentDistanceNm / maxDistance : 0;\n  \n  // Animate the line drawing when playing\n  useEffect(() => {\n    if (isPlaying) {\n      const animate = () => {\n        setAnimatedProgress(prev => {\n          if (prev >= currentProgress) {\n            return prev;\n          }\n          return Math.min(prev + 0.02, currentProgress);\n        });\n        animationRef.current = requestAnimationFrame(animate);\n      };\n      animationRef.current = requestAnimationFrame(animate);\n    } else {\n      setAnimatedProgress(currentProgress);\n    }\n    \n    return () => {\n      if (animationRef.current) {\n        cancelAnimationFrame(animationRef.current);\n      }\n    };\n  }, [isPlaying, currentProgress]);\n  \n  // Current impact value\n  const currentImpact = useMemo(() => {\n    const point = data.find(d => d.distanceNm >= currentDistanceNm);\n    return point || data[data.length - 1] || { distanceNm: 0, cumulativeImpactGallons: 0 };\n  }, [data, currentDistanceNm]);\n  \n  // Color based on impact\n  const impactColor = currentImpact.cumulativeImpactGallons >= 0 \n    ? '#ef4444' // Red for negative (headwind = more fuel)\n    : '#22c55e'; // Green for positive (tailwind = less fuel)\n  \n  // Calculate zero line Y position\n  const zeroY = yScale(0);\n  \n  return (\n    <div className=\"bg-slate-800/90 rounded-lg p-3 space-y-2\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div className=\"text-xs font-medium text-slate-300\">ðŸ’¨ Wind Impact</div>\n        <button\n          onClick={onPlayPause}\n          className=\"bg-sky-500 hover:bg-sky-600 text-white text-xs px-2 py-1 rounded flex items-center gap-1\"\n        >\n          {isPlaying ? 'â¸ Pause' : 'â–¶ Play'}\n        </button>\n      </div>\n      \n      {/* Graph */}\n      <div className=\"relative\" style={{ width, height }}>\n        <svg width={width} height={height} className=\"overflow-visible\">\n          {/* Zero line (expected) */}\n          <line\n            x1={padding.left}\n            y1={zeroY}\n            x2={width - padding.right}\n            y2={zeroY}\n            stroke=\"#475569\"\n            strokeWidth=\"1\"\n            strokeDasharray=\"4 4\"\n          />\n          \n          {/* Impact line */}\n          {linePath && (\n            <AnimatedLine\n              points={linePath}\n              progress={animatedProgress}\n              color={impactColor}\n            />\n          )}\n          \n          {/* Current position dot */}\n          {animatedProgress > 0 && (\n            <circle\n              cx={xScale(currentDistanceNm)}\n              cy={yScale(currentImpact.cumulativeImpactGallons)}\n              r=\"4\"\n              fill={impactColor}\n              stroke=\"white\"\n              strokeWidth=\"2\"\n            />\n          )}\n          \n          {/* X-axis labels */}\n          <text x={padding.left} y={height - 5} fill=\"#64748b\" fontSize=\"8\">0 NM</text>\n          <text x={width / 2} y={height - 5} fill=\"#64748b\" fontSize=\"8\" textAnchor=\"middle\">{Math.round(maxDistance / 2)} NM</text>\n          <text x={width - padding.right} y={height - 5} fill=\"#64748b\" fontSize=\"8\" textAnchor=\"end\">{Math.round(maxDistance)} NM</text>\n          \n          {/* Y-axis label */}\n          <text x={padding.left + 5} y={padding.top + 8} fill=\"#64748b\" fontSize=\"7\">+</text>\n          <text x={padding.left + 5} y={zeroY - 5} fill=\"#64748b\" fontSize=\"7\" textAnchor=\"middle\">0</text>\n          <text x={padding.left + 5} y={height - padding.bottom - 5} fill=\"#64748b\" fontSize=\"7\">-</text>\n        </svg>\n      </div>\n      \n      {/* Stats */}\n      <div className=\"flex justify-between text-xs\">\n        <div>\n          <span className=\"text-slate-400\">Distance: </span>\n          <span className=\"text-white font-medium\">{Math.round(currentDistanceNm)} NM</span>\n        </div>\n        <div>\n          <span className=\"text-slate-400\">Impact: </span>\n          <span \n            className=\"font-medium\"\n            style={{ color: impactColor }}\n          >\n            {currentImpact.cumulativeImpactGallons >= 0 ? '+' : ''}\n            {currentImpact.cumulativeImpactGallons.toFixed(1)} gal\n          </span>\n        </div>\n        <div>\n          <span className=\"text-slate-400\">$ </span>\n          <span \n            className=\"font-medium\"\n            style={{ color: impactColor }}\n          >\n            {currentImpact.cumulativeImpactGallons >= 0 ? '+' : ''}\n            ${(currentImpact.cumulativeImpactGallons * fuelPricePerGallon).toFixed(0)}\n          </span>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n// Helper function to generate mock wind impact data\nexport function generateWindImpactData(\n  trackPoints: { lat: number; lon: number }[],\n  averageWind: number = 0 // knots headwind (+), tailwind (-)\n): WindImpactPoint[] {\n  if (trackPoints.length < 2) return [];\n  \n  const data: WindImpactPoint[] = [];\n  let totalDistance = 0;\n  let cumulativeImpact = 0;\n  \n  // Simple distance calculation (Haversine would be better but this works for demo)\n  for (let i = 1; i < trackPoints.length; i++) {\n    const lat1 = trackPoints[i - 1].lat;\n    const lon1 = trackPoints[i - 1].lon;\n    const lat2 = trackPoints[i].lat;\n    const lon2 = trackPoints[i].lon;\n    \n    // Simple approximate distance\n    const dLat = lat2 - lat1;\n    const dLon = (lon2 - lon1) * Math.cos((lat1 + lat2) / 2 * Math.PI / 180);\n    const distanceNm = Math.sqrt(dLat * dLat + dLon * dLon) * 60; // Rough conversion\n    \n    totalDistance += distanceNm;\n    \n    // Wind impact: headwind increases fuel burn, tailwind decreases\n    // Assume 10 gallons/hour per 10 knots wind difference\n    const windImpactPerNm = averageWind / 60; // Simplified\n    cumulativeImpact += windImpactPerNm * distanceNm;\n    \n    data.push({\n      distanceNm: Math.round(totalDistance),\n      cumulativeImpactGallons: Math.round(cumulativeImpact * 10) / 10\n    });\n  }\n  \n  return data;\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\fuel-saver\\airport-lookup\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\fuel-saver\\components\\ExportDropdown.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'navLogDetail' is assigned a value but never used.","line":31,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":31,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setNavLogDetail' is assigned a value but never used.","line":31,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":31,"endColumn":39}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useRef, useEffect } from 'react';\nimport { Waypoint, downloadGPX, downloadFPL, downloadJSON, downloadNavLog, downloadNavLogPdf, FlightPlanData, generateForeFlightDeepLink, generateGarminDeepLink } from '../lib/exportUtils';\n\ninterface ExportDropdownProps {\n  waypoints: Waypoint[];\n  flightPlanName?: string;\n  aircraftType?: string;\n  cruisingAltitude?: number;\n  isPro?: boolean;\n  aircraft?: {\n    name: string;\n    speed: number;\n    burnRate: number;\n    fuelCapacity: number;\n  };\n  fuelPrices?: Record<string, { price100ll: number | null }>;\n}\n\nexport default function ExportDropdown({ \n  waypoints, \n  flightPlanName, \n  aircraftType, \n  cruisingAltitude,\n  isPro = false,\n  aircraft,\n  fuelPrices = {}\n}: ExportDropdownProps) {\n  const [isOpen, setIsOpen] = useState(false);\n  const [navLogDetail, setNavLogDetail] = useState<'basic' | 'detailed' | null>(null);\n  const [copied, setCopied] = useState(false);\n  const [deepLinkNotice, setDeepLinkNotice] = useState<string | null>(null);\n  const dropdownRef = useRef<HTMLDivElement>(null);\n\n  // Close dropdown when clicking outside\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (dropdownRef.current && !dropdownRef.current.contains(event.target as Node)) {\n        setIsOpen(false);\n      }\n    };\n    \n    document.addEventListener('mousedown', handleClickOutside);\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, []);\n\n  const handleCopyLink = () => {\n    const planData: FlightPlanData = {\n      name: flightPlanName,\n      waypoints,\n      aircraftType,\n      cruisingAltitude\n    };\n    \n    // Encode to base64 for URL sharing\n    const encoded = btoa(encodeURIComponent(JSON.stringify(planData)));\n    const shareUrl = `${window.location.origin}/modules/fuel-saver?plan=${encoded}`;\n    \n    navigator.clipboard.writeText(shareUrl).then(() => {\n      setCopied(true);\n      setTimeout(() => setCopied(false), 2000);\n    });\n  };\n\n  const handleExportGPX = () => {\n    const planData: FlightPlanData = {\n      name: flightPlanName,\n      waypoints,\n      aircraftType,\n      cruisingAltitude\n    };\n    downloadGPX(planData);\n    setIsOpen(false);\n  };\n\n  const handleExportFPL = () => {\n    downloadFPL(waypoints);\n    setIsOpen(false);\n  };\n\n  const handleExportJSON = () => {\n    const planData: FlightPlanData = {\n      name: flightPlanName,\n      waypoints,\n      aircraftType,\n      cruisingAltitude\n    };\n    downloadJSON(planData);\n    setIsOpen(false);\n  };\n\n  const handleExportNavLog = (detailed: boolean) => {\n    if (!aircraft || waypoints.length < 2) return;\n    downloadNavLog(\n      waypoints,\n      {\n        name: aircraftType || aircraft.name,\n        speed: aircraft.speed,\n        burnRate: aircraft.burnRate,\n        fuelCapacity: aircraft.fuelCapacity\n      },\n      cruisingAltitude || 5500,\n      fuelPrices,\n      detailed,\n      flightPlanName\n    );\n    setIsOpen(false);\n  };\n\n  const handleExportNavLogPdf = (detailed: boolean) => {\n    if (!aircraft || waypoints.length < 2) return;\n    downloadNavLogPdf(\n      waypoints,\n      {\n        name: aircraftType || aircraft.name,\n        speed: aircraft.speed,\n        burnRate: aircraft.burnRate,\n        fuelCapacity: aircraft.fuelCapacity\n      },\n      cruisingAltitude || 5500,\n      fuelPrices,\n      {\n        detailed,\n        planName: flightPlanName\n      }\n    );\n    setIsOpen(false);\n  };\n\n  const attemptDeepLink = (scheme: string, fallback?: string, label?: string) => {\n    if (typeof window === 'undefined') return;\n    try {\n      const ua = window.navigator.userAgent.toLowerCase();\n      const isMobile = /iphone|ipad|android/.test(ua);\n      if (isMobile) {\n        // Try iOS/Safari-friendly approach with a transient iframe.\n        const iframe = document.createElement('iframe');\n        iframe.style.display = 'none';\n        iframe.src = scheme;\n        document.body.appendChild(iframe);\n        setTimeout(() => {\n          try {\n            document.body.removeChild(iframe);\n          } catch {}\n        }, 800);\n        // Fallback attempt as well.\n        window.location.href = scheme;\n        setDeepLinkNotice(null);\n        return;\n      }\n\n      // Desktop: copy the deep link and show instructions.\n      if (navigator?.clipboard) {\n        navigator.clipboard.writeText(scheme);\n      }\n      if (fallback) {\n        window.open(fallback, '_blank', 'noopener');\n      }\n      setDeepLinkNotice(`${label || 'Link'} copied. On mobile, paste into Safari address bar to open the EFB app. You can also import via GPX.`);\n    } catch (error) {\n      console.error('Deep link failed', error);\n      if (fallback) {\n        window.open(fallback, '_blank', 'noopener');\n      }\n    }\n  };\n\n  const handleOpenForeFlight = () => {\n    const link = generateForeFlightDeepLink(waypoints, {\n      planName: flightPlanName || 'Flight Plan',\n      altitude: cruisingAltitude || 5500,\n    });\n    if (!link) return;\n    attemptDeepLink(link.scheme, link.fallback, 'ForeFlight link');\n  };\n\n  const handleOpenGarmin = () => {\n    const link = generateGarminDeepLink(waypoints, {\n      planName: flightPlanName || 'Flight Plan',\n    });\n    if (!link) return;\n    attemptDeepLink(link.scheme, link.fallback, 'Garmin Pilot link');\n  };\n\n  const showNavLogTooltip = (detailed: boolean) => {\n    if (detailed) {\n      return 'Includes magnetic variation, wind correction, VOR info, groundspeed - for serious IFR planning';\n    }\n    return 'Simple format with course, distance, time, fuel, cost - quick reference';\n  };\n\n  if (waypoints.length === 0) {\n    return null;\n  }\n\n  return (\n    <div className=\"relative\" ref={dropdownRef}>\n      <button\n        onClick={() => setIsOpen(!isOpen)}\n        className=\"flex items-center gap-1 px-3 py-1.5 bg-slate-700 hover:bg-slate-600 text-white text-sm rounded transition-colors\"\n      >\n        <span>ðŸ“¤</span>\n        <span>Export</span>\n        <span className={`transform transition-transform ${isOpen ? 'rotate-180' : ''}`}>\n          â–¼\n        </span>\n      </button>\n\n      {isOpen && (\n        <div className=\"absolute right-0 mt-2 w-56 bg-slate-800 border border-slate-700 rounded-lg shadow-xl z-50\">\n          <div className=\"py-1\">\n            {deepLinkNotice && (\n              <div className=\"px-4 pt-3 pb-2 text-xs text-slate-300\">\n                <div className=\"rounded-md border border-slate-700 bg-slate-900/40 p-2\">\n                  {deepLinkNotice}\n                </div>\n              </div>\n            )}\n            {/* Copy Shareable Link */}\n            <button\n              onClick={handleCopyLink}\n              className=\"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-slate-200 hover:bg-slate-700 transition-colors\"\n            >\n              <span className=\"text-lg\">ðŸ”—</span>\n              <div className=\"flex-1 text-left\">\n                <div>{copied ? 'âœ… Copied!' : 'Copy Shareable Link'}</div>\n                <div className=\"text-xs text-slate-400\">\n                  {isPro ? 'Unlimited' : 'Free: 3 days'}\n                </div>\n              </div>\n            </button>\n\n            <div className=\"border-t border-slate-700 my-1\" />\n\n            {/* GPX Export */}\n            <button\n              onClick={handleExportGPX}\n              className=\"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-slate-200 hover:bg-slate-700 transition-colors\"\n            >\n              <span className=\"text-lg\">ðŸ—ºï¸</span>\n              <div className=\"flex-1 text-left\">\n                <div>Export GPX</div>\n                <div className=\"text-xs text-slate-400\">ForeFlight, Garmin, SkyDemon</div>\n              </div>\n            </button>\n\n            {/* FPL Export */}\n            <button\n              onClick={handleExportFPL}\n              className=\"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-slate-200 hover:bg-slate-700 transition-colors\"\n            >\n              <span className=\"text-lg\">ðŸ“‹</span>\n              <div className=\"flex-1 text-left\">\n                <div>Export FPL</div>\n                <div className=\"text-xs text-slate-400\">Garmin 430/530/G1000</div>\n              </div>\n            </button>\n\n            {/* JSON Export */}\n            <button\n              onClick={handleExportJSON}\n              className=\"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-slate-200 hover:bg-slate-700 transition-colors\"\n            >\n              <span className=\"text-lg\">{'{ }'}</span>\n              <div className=\"flex-1 text-left\">\n                <div>Export JSON</div>\n                <div className=\"text-xs text-slate-400\">Backup & custom use</div>\n              </div>\n            </button>\n\n            <div className=\"border-t border-slate-700 my-1\" />\n            <div className=\"px-4 py-1 text-xs uppercase tracking-wide text-slate-500\">Send to EFB</div>\n\n            <button\n              onClick={handleOpenForeFlight}\n              disabled={waypoints.length < 2}\n              className=\"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-slate-200 hover:bg-slate-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              <span className=\"text-lg\">ðŸ›©ï¸</span>\n              <div className=\"flex-1 text-left\">\n                <div>Open in ForeFlight</div>\n                <div className=\"text-xs text-slate-400\">Mobile devices launch automatically</div>\n              </div>\n            </button>\n\n            <button\n              onClick={handleOpenGarmin}\n              disabled={waypoints.length < 2}\n              className=\"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-slate-200 hover:bg-slate-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              <span className=\"text-lg\">ðŸ§­</span>\n              <div className=\"flex-1 text-left\">\n                <div>Open in Garmin Pilot</div>\n                <div className=\"text-xs text-slate-400\">Copies link on desktop</div>\n              </div>\n            </button>\n\n            <div className=\"border-t border-slate-700 my-1\" />\n\n            {/* Nav Log - Basic */}\n            <button\n              onClick={() => handleExportNavLog(false)}\n              disabled={waypoints.length < 2}\n              className=\"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-slate-200 hover:bg-slate-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n              title={showNavLogTooltip(false)}\n            >\n              <span className=\"text-lg\">ðŸ“„</span>\n              <div className=\"flex-1 text-left\">\n                <div>Nav Log (Basic)</div>\n                <div className=\"text-xs text-slate-400\">Simple format</div>\n              </div>\n            </button>\n\n            {/* Nav Log - Detailed */}\n            <button\n              onClick={() => handleExportNavLog(true)}\n              disabled={waypoints.length < 2}\n              className=\"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-slate-200 hover:bg-slate-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n              title={showNavLogTooltip(true)}\n            >\n              <span className=\"text-lg\">ðŸ“Š</span>\n              <div className=\"flex-1 text-left\">\n                <div>Nav Log (Detailed)</div>\n                <div className=\"text-xs text-slate-400\">Wind, mag var, headings</div>\n              </div>\n            </button>\n\n            <div className=\"border-t border-slate-700 my-1\" />\n\n            {/* Nav Log PDF - Basic */}\n            <button\n              onClick={() => handleExportNavLogPdf(false)}\n              disabled={waypoints.length < 2}\n              className=\"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-slate-200 hover:bg-slate-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              <span className=\"text-lg\">ðŸ–¨ï¸</span>\n              <div className=\"flex-1 text-left\">\n                <div>Nav Log PDF</div>\n                <div className=\"text-xs text-slate-400\">Shareable PDF export</div>\n              </div>\n            </button>\n\n            {/* Nav Log PDF - Detailed */}\n            <button\n              onClick={() => handleExportNavLogPdf(true)}\n              disabled={waypoints.length < 2}\n              className=\"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-slate-200 hover:bg-slate-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              <span className=\"text-lg\">ðŸ§¾</span>\n              <div className=\"flex-1 text-left\">\n                <div>Nav Log PDF (Detailed)</div>\n                <div className=\"text-xs text-slate-400\">Headings, winds, costs</div>\n              </div>\n            </button>\n\n            {/* Pro Features Preview */}\n            {!isPro && (\n              <>\n                <div className=\"border-t border-slate-700 my-1\" />\n                <div className=\"px-4 py-2 text-xs text-purple-300 bg-purple-500/10\">\n                  ðŸ”’ Pro: Unlimited sharing, more export formats\n                </div>\n              </>\n            )}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\fuel-saver\\components\\NOTAMsPanel.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'groupedNotams' is assigned a value but never used.","line":95,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":95,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect, useCallback } from 'react';\n\ninterface Notam {\n  id: string;\n  icao: string;\n  category: 'TFR' | 'RUNWAY' | 'NAVAID' | 'OBSTACLE' | 'AIRSPACE' | 'GENERAL';\n  title: string;\n  description: string;\n  startDate: string;\n  endDate: string;\n  location: string;\n  coordinates?: {\n    lat: number;\n    lon: number;\n  };\n}\n\ninterface NotamsPanelProps {\n  waypoints: Array<{ icao: string; latitude: number; longitude: number }>;\n  isPro?: boolean;\n}\n\nconst categoryColors: Record<Notam['category'], { bg: string; text: string; icon: string }> = {\n  TFR: { bg: 'bg-red-500/20', text: 'text-red-400', icon: 'ðŸ”´' },\n  RUNWAY: { bg: 'bg-orange-500/20', text: 'text-orange-400', icon: 'ðŸŸ¡' },\n  NAVAID: { bg: 'bg-gray-500/20', text: 'text-gray-400', icon: 'âšª' },\n  OBSTACLE: { bg: 'bg-amber-500/20', text: 'text-amber-400', icon: 'ðŸŸ ' },\n  AIRSPACE: { bg: 'bg-blue-500/20', text: 'text-blue-400', icon: 'ðŸ”µ' },\n  GENERAL: { bg: 'bg-slate-500/20', text: 'text-slate-400', icon: 'âšª' },\n};\n\nexport default function NotamsPanel({ waypoints, isPro = false }: NotamsPanelProps) {\n  const [notams, setNotams] = useState<Notam[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [expanded, setExpanded] = useState(false);\n  const [filter, setFilter] = useState<Notam['category'] | 'ALL'>('ALL');\n  const [lastFetched, setLastFetched] = useState<Date | null>(null);\n\n  const fetchNotams = useCallback(async () => {\n    if (waypoints.length === 0) {\n      setNotams([]);\n      return;\n    }\n\n    setLoading(true);\n    setError(null);\n\n    try {\n      // Only fetch NOTAMs for real US airports (starting with K)\n      const airportIcaos = waypoints\n        .map(w => w.icao)\n        .filter(icao => icao && icao.startsWith('K'))\n        .join(',');\n      \n      if (!airportIcaos) {\n        setNotams([]);\n        setLoading(false);\n        return;\n      }\n      \n      const res = await fetch(`/api/notams?icaos=${airportIcaos}`);\n      \n      if (!res.ok) {\n        throw new Error('Failed to fetch NOTAMs');\n      }\n      \n      const data = await res.json();\n      setNotams(data.notams || []);\n      setLastFetched(new Date());\n    } catch (err) {\n      console.error('NOTAM fetch error:', err);\n      setError('Unable to load NOTAMs');\n    } finally {\n      setLoading(false);\n    }\n  }, [waypoints]);\n\n  // Fetch NOTAMs when waypoints change\n  useEffect(() => {\n    fetchNotams();\n    \n    // Auto-refresh every 5 minutes\n    const interval = setInterval(fetchNotams, 5 * 60 * 1000);\n    return () => clearInterval(interval);\n  }, [fetchNotams]);\n\n  const filteredNotams = filter === 'ALL' \n    ? notams \n    : notams.filter(n => n.category === filter);\n\n  // Group NOTAMs by category\n  const groupedNotams = filteredNotams.reduce((acc, notam) => {\n    if (!acc[notam.category]) acc[notam.category] = [];\n    acc[notam.category].push(notam);\n    return acc;\n  }, {} as Record<Notam['category'], Notam[]>);\n\n  const formatDate = (dateStr: string) => {\n    if (!dateStr) return '';\n    try {\n      return new Date(dateStr).toLocaleDateString('en-US', {\n        month: 'short',\n        day: 'numeric',\n        hour: '2-digit',\n        minute: '2-digit'\n      });\n    } catch {\n      return dateStr;\n    }\n  };\n\n  if (waypoints.length === 0) {\n    return null;\n  }\n\n  return (\n    <div className=\"bg-slate-800 rounded-lg border border-slate-700\">\n      {/* Header */}\n      <button\n        onClick={() => setExpanded(!expanded)}\n        className=\"w-full px-4 py-3 flex items-center justify-between hover:bg-slate-700/50 transition-colors\"\n      >\n        <div className=\"flex items-center gap-2\">\n          <span className=\"text-lg\">ðŸ“‹</span>\n          <span className=\"font-semibold text-white\">NOTAMs</span>\n          {notams.length > 0 && (\n            <span className={`px-2 py-0.5 rounded-full text-xs font-medium ${\n              notams.some(n => n.category === 'TFR') \n                ? 'bg-red-500/30 text-red-300' \n                : 'bg-slate-600 text-slate-300'\n            }`}>\n              {notams.length}\n            </span>\n          )}\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <button\n            onClick={(e) => {\n              e.stopPropagation();\n              fetchNotams();\n            }}\n            disabled={loading}\n            className=\"p-1 hover:bg-slate-600 rounded disabled:opacity-50\"\n            title=\"Refresh\"\n          >\n            <svg className={`w-4 h-4 text-slate-400 ${loading ? 'animate-spin' : ''}`} fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\" />\n            </svg>\n          </button>\n          <span className={`transform transition-transform ${expanded ? 'rotate-180' : ''}`}>\n            â–¼\n          </span>\n        </div>\n      </button>\n\n      {/* Filters - Pro feature preview */}\n      <div className=\"px-4 py-2 border-b border-slate-700 flex gap-2 flex-wrap\">\n        <button\n          onClick={() => setFilter('ALL')}\n          className={`px-2 py-1 rounded text-xs ${\n            filter === 'ALL' ? 'bg-sky-500 text-white' : 'bg-slate-700 text-slate-300 hover:bg-slate-600'\n          }`}\n        >\n          All\n        </button>\n        {(['TFR', 'RUNWAY', 'OBSTACLE', 'AIRSPACE', 'NAVAID'] as const).map(cat => (\n          <button\n            key={cat}\n            onClick={() => {\n              if (!isPro && cat !== 'TFR' && cat !== 'RUNWAY') {\n                // Show preview mode for non-Pro\n                return;\n              }\n              setFilter(cat);\n            }}\n            disabled={!isPro && cat !== 'TFR' && cat !== 'RUNWAY'}\n            className={`px-2 py-1 rounded text-xs ${\n              filter === cat \n                ? 'bg-sky-500 text-white' \n                : isPro || cat === 'TFR' || cat === 'RUNWAY'\n                  ? 'bg-slate-700 text-slate-300 hover:bg-slate-600'\n                  : 'bg-slate-700/50 text-slate-500 cursor-not-allowed'\n            }`}\n          >\n            {cat === 'TFR' ? 'ðŸ”´' : cat === 'RUNWAY' ? 'ðŸŸ¡' : cat === 'OBSTACLE' ? 'ðŸŸ ' : cat === 'AIRSPACE' ? 'ðŸ”µ' : 'âšª'} {cat}\n            {!isPro && cat !== 'TFR' && cat !== 'RUNWAY' && ' ðŸ”’'}\n          </button>\n        ))}\n      </div>\n\n      {/* Content */}\n      {expanded && (\n        <div className=\"p-4 max-h-96 overflow-y-auto\">\n          {loading && notams.length === 0 && (\n            <div className=\"text-center text-slate-400 py-4\">\n              Loading NOTAMs...\n            </div>\n          )}\n\n          {error && (\n            <div className=\"text-center text-red-400 py-4\">\n              {error}\n            </div>\n          )}\n\n          {!loading && !error && filteredNotams.length === 0 && (\n            <div className=\"text-center text-slate-400 py-4\">\n              No {filter === 'ALL' ? '' : filter.toLowerCase()} NOTAMs found\n            </div>\n          )}\n\n          {/* Show preview warning for non-Pro */}\n          {!isPro && notams.length > 3 && filter === 'ALL' && (\n            <div className=\"mb-4 p-2 bg-purple-500/20 border border-purple-500/30 rounded text-xs text-purple-300\">\n              ðŸ”’ Pro: Filter & sort NOTAMs â€¢ {notams.length - 3} more available\n            </div>\n          )}\n\n          {/* NOTAM List */}\n          {filteredNotams.slice(0, isPro ? undefined : 3).map((notam, idx) => {\n            const colors = categoryColors[notam.category];\n            return (\n              <div\n                key={notam.id || idx}\n                className={`mb-3 p-3 rounded-lg ${colors.bg} border border-slate-600`}\n              >\n                <div className=\"flex items-start gap-2\">\n                  <span className=\"text-lg\">{colors.icon}</span>\n                  <div className=\"flex-1 min-w-0\">\n                    <div className=\"flex items-center gap-2\">\n                      <span className={`font-medium ${colors.text}`}>\n                        {notam.category}\n                      </span>\n                      <span className=\"text-slate-400 text-sm\">\n                        {notam.icao}\n                      </span>\n                    </div>\n                    <div className=\"text-sm text-slate-200 mt-1\">\n                      {notam.title || notam.description.substring(0, 60)}\n                    </div>\n                    {notam.description && (\n                      <details className=\"mt-2\">\n                        <summary className=\"text-xs text-slate-400 cursor-pointer hover:text-slate-300\">\n                          Show more\n                        </summary>\n                        <p className=\"text-xs text-slate-300 mt-1 font-mono whitespace-pre-wrap\">\n                          {notam.description}\n                        </p>\n                      </details>\n                    )}\n                    <div className=\"flex gap-4 mt-2 text-xs text-slate-400\">\n                      {notam.startDate && (\n                        <span>From: {formatDate(notam.startDate)}</span>\n                      )}\n                      {notam.endDate && (\n                        <span>Until: {formatDate(notam.endDate)}</span>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              </div>\n            );\n          })}\n\n          {/* Load more for Pro */}\n          {isPro && filteredNotams.length > 10 && (\n            <div className=\"text-center text-slate-400 text-sm py-2\">\n              Showing 10 of {filteredNotams.length} NOTAMs\n            </div>\n          )}\n\n          {/* Last updated */}\n          {lastFetched && (\n            <div className=\"text-xs text-slate-500 text-center mt-4\">\n              Last updated: {lastFetched.toLocaleTimeString()}\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\fuel-saver\\components\\TripFinder.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'fetchFuelPrice' is defined but never used.","line":26,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":26,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'onClearWaypoints' is defined but never used.","line":54,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":54,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setIsOpen' is assigned a value but never used.","line":56,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":56,"endColumn":27},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":72,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2012,2015],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2012,2015],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'gs' is assigned a value but never used.","line":106,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":106,"endColumn":13},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":112,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":112,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3323,3326],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3323,3326],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'gs' is assigned a value but never used.","line":203,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":203,"endColumn":13},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":215,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":215,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7062,7065],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7062,7065],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":283,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":283,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9767,9770],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9767,9770],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":284,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":284,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9800,9803],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9800,9803],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":284,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":284,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9808,9811],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9808,9811],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":287,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":287,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9926,9929],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9926,9929],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'hasValidRoute' is assigned a value but never used.","line":329,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":329,"endColumn":22},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":495,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":495,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18660,18663],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18660,18663],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":571,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":571,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22384,22387],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22384,22387],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useMemo } from 'react';\nimport { Airport } from '../page';\n\ninterface TripFinderProps {\n  airports: Airport[];\n  waypoints: {\n    icao: string;\n    latitude: number;\n    longitude: number;\n    name?: string;\n  }[];\n  aircraft?: {\n    name: string;\n    speed: number;\n    burnRate: number;\n    fuelCapacity: number;\n  };\n  fuelPrices: Record<string, { price100ll: number | null }>;\n  onAddWaypoint: (airport: Airport) => void;\n  onClearWaypoints?: () => void;\n}\n\n// Fetch fuel price for an airport\nasync function fetchFuelPrice(icao: string): Promise<number | null> {\n  try {\n    const res = await fetch(`/api/fuel?icao=${icao}`);\n    if (res.ok) {\n      const data = await res.json();\n      return data.average?.['100LL'] ? parseFloat(data.average['100LL']) : null;\n    }\n  } catch { /* ignore */ }\n  return null;\n}\n\n// Airport size classifications\nconst AIRPORT_SIZES = {\n  large: { label: 'ðŸ™ï¸ Large', fee: 75 },\n  medium: { label: 'ðŸ˜ï¸ Medium', fee: 35 },\n  small: { label: 'ðŸšï¸ Small', fee: 15 }\n};\n\ntype AirportSize = 'large' | 'medium' | 'small';\ntype TimeMode = 'per_leg' | 'per_day';\ntype FinderMode = 'plan' | 'find' | 'cheapest';\n\nexport default function TripFinder({\n  airports,\n  waypoints,\n  aircraft,\n  fuelPrices,\n  onAddWaypoint,\n  onClearWaypoints\n}: TripFinderProps) {\n  const [isOpen, setIsOpen] = useState(true);\n  const [mode, setMode] = useState<FinderMode>('plan');\n  \n  // Plan mode settings\n  const [maxHours, setMaxHours] = useState(4);\n  const [timeMode, setTimeMode] = useState<TimeMode>('per_leg');\n  const [airportSize, setAirportSize] = useState<AirportSize>('medium');\n  \n  // Find mode settings\n  const [findBudget, setFindBudget] = useState(150);\n  const [findMaxHours, setFindMaxHours] = useState(2);\n  \n  // Cheapest mode settings\n  const [maxDetour, setMaxDetour] = useState(30); // max nm off route\n  const [fuelPriceThreshold, setFuelPriceThreshold] = useState(0.50); // save at least this much\n  \n  const [results, setResults] = useState<any[]>([]);\n  const [isCalculating, setIsCalculating] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  // ==================== PLAN MODE ====================\n  const tripStats = useMemo(() => {\n    if (waypoints.length < 2 || !aircraft) return null;\n    \n    let totalDist = 0;\n    for (let i = 1; i < waypoints.length; i++) {\n      totalDist += calculateDistance(\n        waypoints[i-1].latitude, waypoints[i-1].longitude,\n        waypoints[i].latitude, waypoints[i].longitude\n      );\n    }\n    \n    const gs = aircraft.speed * 0.8;\n    const totalTime = totalDist / gs;\n    const fuelNeeded = (totalDist / aircraft.speed) * aircraft.burnRate * 1.25;\n    \n    return {\n      totalDistance: totalDist,\n      totalTime,\n      fuelNeeded,\n      legsNeeded: Math.ceil(totalTime / maxHours)\n    };\n  }, [waypoints, aircraft, maxHours]);\n\n  const handlePlanTrip = () => {\n    if (!aircraft || waypoints.length < 2 || !tripStats) return;\n    \n    setIsCalculating(true);\n    setError(null);\n    \n    const gs = aircraft.speed * 0.8;\n    const departure = waypoints[0];\n    const arrival = waypoints[waypoints.length - 1];\n    const stopsNeeded = Math.ceil(tripStats.totalTime / maxHours);\n    const depFuelPrice = fuelPrices[departure.icao]?.price100ll || 6.50;\n    \n    const stops: any[] = [];\n    \n    for (let stopNum = 1; stopNum <= stopsNeeded; stopNum++) {\n      const fraction = stopNum / (stopsNeeded + 1);\n      const routeLat = departure.latitude + (arrival.latitude - departure.latitude) * fraction;\n      const routeLon = departure.longitude + (arrival.longitude - departure.longitude) * fraction;\n      \n      const candidates = airports\n        .filter(a => {\n          if (a.icao === departure.icao || a.icao === arrival.icao) return false;\n          if (!a.latitude || !a.longitude) return false;\n          if (airportSize === 'large' && a.type !== 'large_airport') return false;\n          if (airportSize === 'medium' && a.type === 'small_airport') return false;\n          return true;\n        })\n        .map(a => ({\n          airport: a,\n          distFromRoute: calculateDistance(routeLat, routeLon, a.latitude, a.longitude)\n        }))\n        .filter(a => a.distFromRoute < 30)\n        .sort((a, b) => a.distFromRoute - b.distFromRoute)\n        .slice(0, 5);\n      \n      if (candidates.length > 0) {\n        const best = candidates[0];\n        const fuelPrice = fuelPrices[best.airport.icao]?.price100ll || depFuelPrice;\n        const fuelForLeg = (best.distFromRoute / aircraft.speed) * aircraft.burnRate * 1.25;\n        \n        stops.push({\n          airport: best.airport,\n          distanceFromPrevious: best.distFromRoute,\n          fuelCost: fuelForLeg * fuelPrice,\n          landingFee: AIRPORT_SIZES[airportSize].fee\n        });\n      }\n    }\n    \n    setResults(stops);\n    setIsCalculating(false);\n  };\n\n  // ==================== FIND MODE ====================\n  const handleFindDestinations = () => {\n    if (!aircraft || !waypoints[0]) return;\n    \n    setIsCalculating(true);\n    setError(null);\n    \n    const departure = waypoints[0];\n    const gs = aircraft.speed * 0.8;\n    const maxDist = findMaxHours * gs;\n    const depFuelPrice = fuelPrices[departure.icao]?.price100ll || 6.50;\n    \n    const destinations = airports\n      .filter(a => a.icao !== departure.icao && a.latitude && a.longitude)\n      .map(airport => {\n        const dist = calculateDistance(\n          departure.latitude, departure.longitude,\n          airport.latitude, airport.longitude\n        );\n        const fuelNeeded = (dist / aircraft.speed) * aircraft.burnRate * 1.25;\n        const fuelCost = fuelNeeded * (fuelPrices[airport.icao]?.price100ll || depFuelPrice);\n        const landingFee = AIRPORT_SIZES.medium.fee;\n        \n        return {\n          airport,\n          distance: dist,\n          timeHours: dist / gs,\n          fuelCost,\n          landingFee,\n          totalCost: fuelCost + landingFee\n        };\n      })\n      .filter(d => d.distance <= maxDist * 1.1)\n      .filter(d => d.totalCost <= findBudget * 1.2)\n      .sort((a, b) => a.totalCost - b.totalCost)\n      .slice(0, 15);\n    \n    setResults(destinations);\n    setIsCalculating(false);\n  };\n\n  // ==================== CHEAPEST MODE ====================\n  const handleFindCheapestFuel = async () => {\n    if (!aircraft || waypoints.length < 2) return;\n    \n    setIsCalculating(true);\n    setError(null);\n    \n    const departure = waypoints[0];\n    const arrival = waypoints[waypoints.length - 1];\n    const gs = aircraft.speed * 0.8;\n    const depFuelPrice = fuelPrices[departure.icao]?.price100ll || 6.50;\n    \n    // Calculate direct route distance\n    const directDistance = calculateDistance(\n      departure.latitude, departure.longitude,\n      arrival.latitude, arrival.longitude\n    );\n    const directFuelNeeded = (directDistance / aircraft.speed) * aircraft.burnRate * 1.25;\n    const directFuelCost = directFuelNeeded * depFuelPrice;\n    \n    // Find all airports within maxDetour of the route\n    const candidateStops: any[] = [];\n    \n    // Sample points along the route\n    const samplePoints = 10;\n    for (let i = 1; i < samplePoints; i++) {\n      const fraction = i / samplePoints;\n      const routeLat = departure.latitude + (arrival.latitude - departure.latitude) * fraction;\n      const routeLon = departure.longitude + (arrival.longitude - departure.longitude) * fraction;\n      \n      // Find airports near this point\n      airports\n        .filter(a => {\n          if (a.icao === departure.icao || a.icao === arrival.icao) return false;\n          if (!a.latitude || !a.longitude) return false;\n          return true;\n        })\n        .forEach(airport => {\n          const distFromRoute = calculateDistance(routeLat, routeLon, airport.latitude, airport.longitude);\n          if (distFromRoute <= maxDetour) {\n            // Try to get fuel price from prop, or fetch it\n            let fuelPrice = fuelPrices[airport.icao]?.price100ll;\n            \n            // Check if we already have this price cached\n            const cached = localStorage.getItem(`fuel_${airport.icao}`);\n            if (!fuelPrice && cached) {\n              fuelPrice = JSON.parse(cached).price100ll;\n            }\n            \n            if (fuelPrice) {\n              candidateStops.push({\n                airport,\n                detourDistance: distFromRoute,\n                fuelPrice\n              });\n            }\n          }\n        });\n    }\n    \n    // Find unique airports with fuel prices\n    type CandidateStop = { airport: Airport; detourDistance: number; fuelPrice: number };\n    const uniqueStops = candidateStops.reduce((acc: CandidateStop[], stop: CandidateStop) => {\n      const existing = acc.find((s: CandidateStop) => s.airport.icao === stop.airport.icao);\n      if (!existing || stop.detourDistance < existing.detourDistance) {\n        const idx = acc.findIndex((s: CandidateStop) => s.airport.icao === stop.airport.icao);\n        if (idx >= 0) acc[idx] = stop;\n        else acc.push(stop);\n      }\n      return acc;\n    }, [] as CandidateStop[]);\n    \n    // Calculate savings for each potential stop\n    const withSavings = uniqueStops.map((stop: CandidateStop) => {\n      const detourFuel = (stop.detourDistance / aircraft.speed) * aircraft.burnRate * 1.25;\n      const detourCost = detourFuel * depFuelPrice;\n      const fuelAtStop = directFuelNeeded * stop.fuelPrice;\n      \n      // Extra cost to divert vs fuel cost savings\n      const savings = (directFuelCost - fuelAtStop) - detourCost;\n      \n      return {\n        ...stop,\n        detourFuel,\n        detourCost,\n        savings,\n        worthIt: savings > fuelPriceThreshold * 10 // At least save $X to be worth it\n      };\n    })\n    .filter((s: any) => s.worthIt)\n    .sort((a: any, b: any) => b.savings - a.savings);\n    \n    // Calculate total potential savings with best stops\n    const optimalStops: any[] = [];\n    let remainingFuel = directFuelNeeded;\n    let currentPos = { lat: departure.latitude, lon: departure.longitude };\n    let totalSavings = 0;\n    \n    // Greedy: take stops that save money until no more savings\n    for (const stop of withSavings) {\n      const distToStop = calculateDistance(\n        currentPos.lat, currentPos.lon,\n        stop.airport.latitude, stop.airport.longitude\n      );\n      \n      // Check if we can reach it with remaining fuel\n      const fuelToStop = (distToStop / aircraft.speed) * aircraft.burnRate * 1.25;\n      if (fuelToStop < remainingFuel * 0.9) {\n        optimalStops.push({\n          airport: stop.airport,\n          detourDistance: stop.detourDistance,\n          fuelPrice: stop.fuelPrice,\n          savings: stop.savings,\n          fuelAtStop: directFuelNeeded * stop.fuelPrice\n        });\n        totalSavings += stop.savings;\n        remainingFuel = remainingFuel - fuelToStop + (aircraft.fuelCapacity * 0.5);\n        currentPos = { lat: stop.airport.latitude, lon: stop.airport.longitude };\n      }\n    }\n    \n    const directCost = directFuelCost + AIRPORT_SIZES.medium.fee;\n    const optimizedCost = directCost - totalSavings;\n    \n    setResults([{\n      type: 'summary',\n      directDistance,\n      directCost,\n      optimizedCost,\n      totalSavings,\n      stops: optimalStops\n    }]);\n    setIsCalculating(false);\n  };\n\n  const hasValidRoute = waypoints.length >= 2 && aircraft;\n\n  return (\n    <div className=\"bg-background border-t border-border\">\n      {/* Mode Tabs */}\n      <div className=\"flex border-b border-border\">\n        {[\n          { id: 'plan', label: 'ðŸ—ºï¸ Plan' },\n          { id: 'find', label: 'ðŸ” Find' },\n          { id: 'cheapest', label: 'â›½ Cheapest' }\n        ].map(tab => (\n          <button\n            key={tab.id}\n            onClick={() => { setMode(tab.id as FinderMode); setResults([]); }}\n            className={`flex-1 py-2 text-xs font-medium transition-colors ${\n              mode === tab.id \n                ? 'bg-secondary text-foreground' \n                : 'text-muted-foreground hover:text-foreground'\n            }`}\n          >\n            {tab.label}\n          </button>\n        ))}\n      </div>\n\n      {/* Content */}\n      {isOpen && (\n        <div className=\"p-3 space-y-3\">\n          {/* Error message */}\n          {error && (\n            <div className=\"text-red-400 text-xs bg-red-900/30 p-2 rounded\">\n              {error}\n            </div>\n          )}\n\n          {waypoints[0] && aircraft && mode === 'plan' ? (\n            // ==================== PLAN MODE ====================\n            <>\n              {tripStats && (\n                <div className=\"bg-secondary/50 rounded p-2 text-xs space-y-1\">\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-muted-foreground\">Distance:</span>\n                    <span className=\"text-foreground\">{tripStats.totalDistance.toFixed(0)} NM</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-muted-foreground\">Time:</span>\n                    <span className=\"text-foreground\">{tripStats.totalTime.toFixed(1)} hrs</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-muted-foreground\">Stops needed:</span>\n                    <span className=\"text-amber-400\">~{tripStats.legsNeeded}</span>\n                  </div>\n                </div>\n              )}\n\n              <div className=\"space-y-2\">\n                <div className=\"flex gap-1 text-xs\">\n                  <button\n                    onClick={() => setTimeMode('per_leg')}\n                    className={`flex-1 py-1.5 rounded ${timeMode === 'per_leg' ? 'bg-sky-600 text-foreground' : 'bg-secondary text-slate-300'}`}\n                  >\n                    Per Leg\n                  </button>\n                  <button\n                    onClick={() => setTimeMode('per_day')}\n                    className={`flex-1 py-1.5 rounded ${timeMode === 'per_day' ? 'bg-sky-600 text-foreground' : 'bg-secondary text-slate-300'}`}\n                  >\n                    Per Day\n                  </button>\n                </div>\n\n                <div>\n                  <label className=\"block text-xs text-muted-foreground mb-1\">Max hours</label>\n                  <input\n                    type=\"number\"\n                    value={maxHours}\n                    onChange={(e) => setMaxHours(Number(e.target.value))}\n                    min={1}\n                    max={12}\n                    className=\"w-full bg-secondary border border-border rounded px-2 py-1.5 text-foreground text-sm\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-xs text-muted-foreground mb-1\">Stop at</label>\n                  <select\n                    value={airportSize}\n                    onChange={(e) => setAirportSize(e.target.value as AirportSize)}\n                    className=\"w-full bg-secondary border border-border rounded px-2 py-1.5 text-foreground text-sm\"\n                  >\n                    <option value=\"large\">{AIRPORT_SIZES.large.label}</option>\n                    <option value=\"medium\">{AIRPORT_SIZES.medium.label}</option>\n                    <option value=\"small\">{AIRPORT_SIZES.small.label}</option>\n                  </select>\n                </div>\n\n                <button\n                  onClick={handlePlanTrip}\n                  disabled={isCalculating || waypoints.length < 2}\n                  className=\"w-full bg-sky-600 hover:bg-sky-500 disabled:bg-muted text-foreground py-2 rounded text-sm font-medium\"\n                >\n                  {isCalculating ? 'Finding...' : 'ðŸ›« Find Stops'}\n                </button>\n              </div>\n\n              {results.length > 0 && (\n                <div className=\"space-y-2\">\n                  {results.map((stop, i) => (\n                    <button\n                      key={i}\n                      onClick={() => onAddWaypoint(stop.airport)}\n                      className=\"w-full bg-secondary hover:bg-slate-600 rounded p-2 text-left\"\n                    >\n                      <div className=\"flex justify-between items-center\">\n                        <div>\n                          <span className=\"font-medium text-foreground\">{stop.airport.icao}</span>\n                          <span className=\"text-muted-foreground ml-2 text-xs\">{stop.airport.name?.substring(0, 15)}</span>\n                        </div>\n                        <div className=\"text-right text-xs\">\n                          <div className=\"text-muted-foreground\">{stop.distanceFromPrevious.toFixed(0)} NM</div>\n                          <div className=\"text-amber-400\">${(stop.fuelCost + stop.landingFee).toFixed(0)}</div>\n                        </div>\n                      </div>\n                    </button>\n                  ))}\n                </div>\n              )}\n            </>\n          ) : mode === 'find' ? (\n            // ==================== FIND MODE ====================\n            <>\n              <div className=\"space-y-2\">\n                <div>\n                  <label className=\"block text-xs text-muted-foreground mb-1\">Budget ($)</label>\n                  <input\n                    type=\"number\"\n                    value={findBudget}\n                    onChange={(e) => setFindBudget(Number(e.target.value))}\n                    min={50}\n                    className=\"w-full bg-secondary border border-border rounded px-2 py-1.5 text-foreground text-sm\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-xs text-muted-foreground mb-1\">Max hours</label>\n                  <input\n                    type=\"number\"\n                    value={findMaxHours}\n                    onChange={(e) => setFindMaxHours(Number(e.target.value))}\n                    min={0.5}\n                    step={0.5}\n                    className=\"w-full bg-secondary border border-border rounded px-2 py-1.5 text-foreground text-sm\"\n                  />\n                </div>\n\n                <button\n                  onClick={handleFindDestinations}\n                  disabled={isCalculating}\n                  className=\"w-full bg-sky-600 hover:bg-sky-500 disabled:bg-muted text-foreground py-2 rounded text-sm font-medium\"\n                >\n                  {isCalculating ? 'Searching...' : 'ðŸ” Find Destinations'}\n                </button>\n              </div>\n\n              {results.length > 0 && (\n                <div className=\"space-y-2 max-h-48 overflow-y-auto\">\n                  {results.map((r: any, i: number) => (\n                    <button\n                      key={i}\n                      onClick={() => onAddWaypoint(r.airport)}\n                      className=\"w-full bg-secondary hover:bg-slate-600 rounded p-2 text-left\"\n                    >\n                      <div className=\"flex justify-between\">\n                        <div>\n                          <span className=\"font-medium text-foreground\">{r.airport.icao}</span>\n                          <span className=\"text-muted-foreground ml-2 text-xs\">{r.airport.name?.substring(0, 12)}</span>\n                        </div>\n                        <div className=\"text-right\">\n                          <div className=\"text-amber-400\">${r.totalCost.toFixed(0)}</div>\n                          <div className=\"text-muted-foreground text-xs\">{r.distance.toFixed(0)} NM</div>\n                        </div>\n                      </div>\n                    </button>\n                  ))}\n                </div>\n              )}\n            </>\n          ) : mode === 'cheapest' ? (\n            // ==================== CHEAPEST MODE ====================\n            <>\n              <div className=\"text-xs text-muted-foreground bg-secondary/50 rounded p-2\">\n                Find cheapest fuel stops, even if it means a slight detour. Optimizes total trip cost.\n              </div>\n\n              <div className=\"space-y-2\">\n                <div>\n                  <label className=\"block text-xs text-muted-foreground mb-1\">Max detour (NM)</label>\n                  <input\n                    type=\"number\"\n                    value={maxDetour}\n                    onChange={(e) => setMaxDetour(Number(e.target.value))}\n                    min={5}\n                    max={50}\n                    className=\"w-full bg-secondary border border-border rounded px-2 py-1.5 text-foreground text-sm\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-xs text-muted-foreground mb-1\">Min savings to worth it ($)</label>\n                  <input\n                    type=\"number\"\n                    value={fuelPriceThreshold}\n                    onChange={(e) => setFuelPriceThreshold(Number(e.target.value))}\n                    min={5}\n                    max={100}\n                    className=\"w-full bg-secondary border border-border rounded px-2 py-1.5 text-foreground text-sm\"\n                  />\n                </div>\n\n                <button\n                  onClick={handleFindCheapestFuel}\n                  disabled={isCalculating || waypoints.length < 2}\n                  className=\"w-full bg-emerald-600 hover:bg-emerald-500 disabled:bg-muted text-foreground py-2 rounded text-sm font-medium\"\n                >\n                  {isCalculating ? 'Optimizing...' : 'â›½ Find Cheapest Fuel'}\n                </button>\n              </div>\n\n              {results.length > 0 && results[0]?.type === 'summary' && (\n                <div className=\"space-y-2\">\n                  <div className=\"bg-emerald-900/30 border border-emerald-700 rounded p-2 text-center\">\n                    <div className=\"text-emerald-400 font-bold text-lg\">\n                      Save ${results[0].totalSavings.toFixed(0)}\n                    </div>\n                    <div className=\"text-muted-foreground text-xs\">\n                      Direct: ${results[0].directCost.toFixed(0)} â†’ Optimized: ${results[0].optimizedCost.toFixed(0)}\n                    </div>\n                  </div>\n\n                  {results[0].stops.length > 0 ? (\n                    <>\n                      <div className=\"text-xs text-muted-foreground\">Suggested stops:</div>\n                      {results[0].stops.map((stop: any, i: number) => (\n                        <button\n                          key={i}\n                          onClick={() => onAddWaypoint(stop.airport)}\n                          className=\"w-full bg-secondary hover:bg-slate-600 rounded p-2 text-left\"\n                        >\n                          <div className=\"flex justify-between items-center\">\n                            <div>\n                              <span className=\"font-medium text-foreground\">{stop.airport.icao}</span>\n                              <span className=\"text-muted-foreground ml-2 text-xs\">${stop.fuelPrice.toFixed(2)}/gal</span>\n                            </div>\n                            <div className=\"text-right text-xs\">\n                              <div className=\"text-emerald-400\">Save ${stop.savings.toFixed(0)}</div>\n                              <div className=\"text-muted-foreground\">+{stop.detourDistance.toFixed(0)} NM</div>\n                            </div>\n                          </div>\n                        </button>\n                      ))}\n                    </>\n                  ) : (\n                    <div className=\"text-center py-2 text-muted-foreground text-xs\">\n                      No cheaper fuel stops found on this route\n                    </div>\n                  )}\n                </div>\n              )}\n            </>\n          ) : null}\n        </div>\n      )}\n    </div>\n  );\n}\n\n// Haversine distance\nfunction calculateDistance(lat1: number, lon1: number, lat2: number, lon2: number): number {\n  const R = 3440.065;\n  const dLat = (lat2 - lat1) * Math.PI / 180;\n  const dLon = (lon2 - lon1) * Math.PI / 180;\n  const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *\n    Math.sin(dLon / 2) * Math.sin(dLon / 2);\n  return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\fuel-saver\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\fuel-saver\\lib\\exportUtils.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'filename' is assigned a value but never used.","line":673,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":673,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":795,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":795,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25144,25147],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25144,25147],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Magnetic variation utility\n */\nimport { calculateMagneticVariation, trueToMagnetic } from './magneticVariation';\nimport jsPDF from 'jspdf';\nimport autoTable from 'jspdf-autotable';\n\n/**\n * Calculate great circle distance in nautical miles\n */\nfunction calculateDistance(lat1: number, lon1: number, lat2: number, lon2: number): number {\n  const R = 3440.065; // Earth radius in NM\n  const dLat = (lat2 - lat1) * Math.PI / 180;\n  const dLon = (lon2 - lon1) * Math.PI / 180;\n  const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *\n    Math.sin(dLon / 2) * Math.sin(dLon / 2);\n  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n  return R * c;\n}\n\n/*\n * GPX Export - Generate GPX 1.1 format for flight plans\n * Compatible with ForeFlight, Garmin Pilot, SkyDemon, OpenCPN, etc.\n */\n\nexport interface Waypoint {\n  icao: string;\n  name?: string;\n  latitude: number;\n  longitude: number;\n}\n\nexport interface FlightPlanData {\n  name?: string;\n  waypoints: Waypoint[];\n  aircraftType?: string;\n  cruisingAltitude?: number;\n  departureTime?: string;\n  fuelCapacity?: number;\n  fuelBurnRate?: number;\n}\n\nexport function generateGPX(plan: FlightPlanData): string {\n  const { name = 'Flight Plan', waypoints, aircraftType, cruisingAltitude } = plan;\n  \n  const gpxHeader = `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<gpx version=\"1.1\" \n     creator=\"FuelSaver - Flight Planning Tool\"\n     xmlns=\"http://www.topografix.com/GPX/1/1\"\n     xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n     xsi:schemaLocation=\"http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd\">\n  <metadata>\n    <name>${escapeXML(name)}</name>\n    <desc>Flight plan created with FuelSaver</desc>\n    <time>${new Date().toISOString()}</time>\n  </metadata>\n  <rte>\n    <name>${escapeXML(name)}</name>`;\n  \n  const gpxFooter = `\n  </rte>\n</gpx>`;\n  \n  const routePoints = waypoints.map((wp, idx) => {\n    const isDeparture = idx === 0;\n    const isArrival = idx === waypoints.length - 1;\n    let type = 'AIRPORT';\n    \n    if (isDeparture) type = 'DEPARTURE';\n    else if (isArrival) type = 'ARRIVAL';\n    else type = 'WAYPOINT';\n    \n    return `\n    <rtept lat=\"${wp.latitude.toFixed(6)}\" lon=\"${wp.longitude.toFixed(6)}\">\n      <name>${escapeXML(wp.icao)}</name>\n      <type>${type}</type>\n      <extensions>\n        <waypointType>${type}</waypointType>\n        ${wp.name ? `<waypointName>${escapeXML(wp.name)}</waypointName>` : ''}\n        ${aircraftType ? `<aircraftType>${escapeXML(aircraftType)}</aircraftType>` : ''}\n        ${cruisingAltitude ? `<cruisingAltitude>${cruisingAltitude}</cruisingAltitude>` : ''}\n      </extensions>\n    </rtept>`;\n  }).join('');\n  \n  return gpxHeader + routePoints + gpxFooter;\n}\n\nexport function downloadGPX(plan: FlightPlanData): void {\n  const gpx = generateGPX(plan);\n  const filename = (plan.name || 'flight-plan').replace(/[^a-z0-9]/gi, '-').toLowerCase();\n  \n  downloadFile(gpx, `${filename}.gpx`, 'application/gpx+xml');\n}\n\n/**\n * FPL Format - Simple text format for Garmin 430/530/G1000\n * One ICAO code per line\n */\nexport function generateFPL(waypoints: Waypoint[]): string {\n  return waypoints.map(wp => wp.icao).join('\\n');\n}\n\nexport function downloadFPL(waypoints: Waypoint[]): void {\n  const fpl = generateFPL(waypoints);\n  const filename = 'flight-plan';\n  \n  downloadFile(fpl, `${filename}.fpl`, 'text/plain');\n}\n\n/**\n * JSON Export - Full flight plan data\n */\nexport function downloadJSON(plan: FlightPlanData): void {\n  const json = JSON.stringify(plan, null, 2);\n  const filename = (plan.name || 'flight-plan').replace(/[^a-z0-9]/gi, '-').toLowerCase();\n  \n  downloadFile(json, `${filename}.json`, 'application/json');\n}\n\n// Helper function to escape XML special characters\nfunction escapeXML(str: string): string {\n  return str\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&apos;');\n}\n\n// Helper function to trigger file download\nfunction downloadFile(content: string, filename: string, mimeType: string): void {\n  const blob = new Blob([content], { type: mimeType });\n  const url = URL.createObjectURL(blob);\n  \n  const a = document.createElement('a');\n  a.href = url;\n  a.download = filename;\n  a.style.display = 'none';\n  \n  document.body.appendChild(a);\n  a.click();\n  \n  // Clean up\n  setTimeout(() => {\n    document.body.removeChild(a);\n    URL.revokeObjectURL(url);\n  }, 100);\n}\n\n// ============================================\n// NAV LOG EXPORT\n// ============================================\n\nexport interface NavLogLeg {\n  from: Waypoint;\n  to: Waypoint;\n  course: number;           // True course (degrees)\n  distance: number;         // Nautical miles\n  tas: number;              // True airspeed (knots)\n  windDirection: number;    // Wind from direction (degrees)\n  windSpeed: number;        // Wind speed (knots)\n  groundspeed: number;      // Groundspeed (knots)\n  windCorrection: number;   // Wind correction angle (degrees)\n  magneticVariation: number; // Magnetic variation at midpoint (degrees)\n  trueHeading: number;      // True heading\n  magneticHeading: number;  // Magnetic heading\n  time: number;             // Time enroute (minutes)\n  fuelNeeded: number;       // Fuel needed (gallons)\n  fuelWithReserves: number; // Fuel with 25% reserves\n  cost: number;             // Cost for this leg\n}\n\nexport interface NavLogData {\n  name?: string;\n  aircraft: string;\n  departure: string;\n  arrival: string;\n  cruisingAltitude: number;\n  date: string;\n  legs: NavLogLeg[];\n  totalDistance: number;\n  totalTime: number;\n  totalFuel: number;\n  totalCost: number;\n}\n\nexport interface StoredNavLogExport {\n  id: string;\n  name: string;\n  createdAt: string;\n  detailed: boolean;\n  navLogData: NavLogData;\n}\n\nconst NAV_LOG_EXPORTS_KEY = 'navLogExports';\n\n/**\n * Calculate great circle true course between two points\n */\nfunction calculateTrueCourse(lat1: number, lon1: number, lat2: number, lon2: number): number {\n  const dLon = ((lon2 - lon1) * Math.PI) / 180;\n  const lat1Rad = (lat1 * Math.PI) / 180;\n  const lat2Rad = (lat2 * Math.PI) / 180;\n  \n  const x = Math.sin(dLon) * Math.cos(lat2Rad);\n  const y = Math.cos(lat1Rad) * Math.sin(lat2Rad) - Math.sin(lat1Rad) * Math.cos(lat2Rad) * Math.cos(dLon);\n  \n  let course = (Math.atan2(x, y) * 180) / Math.PI;\n  course = ((course % 360) + 360) % 360; // Normalize to 0-360\n  return Math.round(course);\n}\n\n/**\n * Calculate wind correction angle and groundspeed using E6B formula\n */\nfunction calculateWindEffect(\n  trueCourse: number,\n  tas: number,\n  windDirection: number,\n  windSpeed: number\n): { groundspeed: number; windCorrection: number } {\n  const headingRad = (trueCourse * Math.PI) / 180;\n  const windRad = (windDirection * Math.PI) / 180;\n  \n  // Wind components (wind FROM direction)\n  const wx = windSpeed * Math.cos(windRad + Math.PI);\n  const wy = windSpeed * Math.sin(windRad + Math.PI);\n  \n  // Ground speed vector\n  const gsx = tas * Math.cos(headingRad) - wx;\n  const gsy = tas * Math.sin(headingRad) - wy;\n  \n  const groundspeed = Math.sqrt(gsx * gsx + gsy * gsy);\n  const track = ((Math.atan2(gsy, gsx) * 180) / Math.PI + 360) % 360;\n  const windCorrection = track - trueCourse;\n  \n  return {\n    groundspeed: Math.round(groundspeed),\n    windCorrection: Math.round(windCorrection)\n  };\n}\n\n/**\n * Generate Basic Nav Log (simple format)\n */\nexport function generateBasicNavLog(data: NavLogData): string {\n  const { name, aircraft, departure, arrival, date, legs, totalDistance, totalTime, totalFuel, totalCost } = data;\n  \n  const html = `\n<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"UTF-8\">\n  <title>Nav Log - ${name || 'Flight Plan'}</title>\n  <style>\n    @media print {\n      body { font-size: 10pt; }\n      .page-break { page-break-before: always; }\n    }\n    body { \n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      font-size: 11pt;\n      line-height: 1.3;\n      max-width: 800px;\n      margin: 0 auto;\n      padding: 20px;\n      color: #333;\n    }\n    h1 { font-size: 18pt; margin-bottom: 5px; }\n    .header { margin-bottom: 20px; border-bottom: 2px solid #333; padding-bottom: 10px; }\n    .meta { display: flex; gap: 30px; flex-wrap: wrap; font-size: 10pt; color: #666; }\n    .meta-item { }\n    .meta-label { font-weight: bold; color: #333; }\n    table { \n      width: 100%; \n      border-collapse: collapse; \n      margin-top: 15px;\n      font-size: 10pt;\n    }\n    th, td { \n      border: 1px solid #ddd; \n      padding: 6px 8px; \n      text-align: center;\n    }\n    th { background: #f5f5f5; font-weight: bold; }\n    .waypoint-col { text-align: left; }\n    .total-row { background: #f9f9f9; font-weight: bold; }\n    .summary { \n      margin-top: 20px; \n      padding: 15px; \n      background: #f5f5f5; \n      border-radius: 5px;\n      display: flex;\n      gap: 40px;\n      flex-wrap: wrap;\n    }\n    .summary-item { }\n    .summary-value { font-size: 16pt; font-weight: bold; color: #333; }\n    .summary-label { font-size: 9pt; color: #666; text-transform: uppercase; }\n    .footer { \n      margin-top: 30px; \n      font-size: 9pt; \n      color: #999; \n      text-align: center;\n      border-top: 1px solid #eee;\n      padding-top: 10px;\n    }\n  </style>\n</head>\n<body>\n  <div class=\"header\">\n    <h1>${name || 'Flight Plan'}</h1>\n    <div class=\"meta\">\n      <div class=\"meta-item\"><span class=\"meta-label\">Aircraft:</span> ${aircraft}</div>\n      <div class=\"meta-item\"><span class=\"meta-label\">Departure:</span> ${departure}</div>\n      <div class=\"meta-item\"><span class=\"meta-label\">Arrival:</span> ${arrival}</div>\n      <div class=\"meta-item\"><span class=\"meta-label\">Date:</span> ${date}</div>\n    </div>\n  </div>\n\n  <table>\n    <thead>\n      <tr>\n        <th>From</th>\n        <th>To</th>\n        <th>Course</th>\n        <th>Dist</th>\n        <th>Time</th>\n        <th>Fuel</th>\n        <th>Cost</th>\n      </tr>\n    </thead>\n    <tbody>\n      ${legs.map(leg => `\n        <tr>\n          <td class=\"waypoint-col\"><strong>${leg.from.icao}</strong><br><small>${leg.from.name || ''}</small></td>\n          <td class=\"waypoint-col\"><strong>${leg.to.icao}</strong><br><small>${leg.to.name || ''}</small></td>\n          <td>${leg.trueHeading}Â°</td>\n          <td>${leg.distance} NM</td>\n          <td>${Math.floor(leg.time)}:${((leg.time % 1) * 60).toFixed(0).padStart(2, '0')}</td>\n          <td>${leg.fuelWithReserves.toFixed(1)} gal</td>\n          <td>$${leg.cost.toFixed(0)}</td>\n        </tr>\n      `).join('')}\n      <tr class=\"total-row\">\n        <td colspan=\"2\"><strong>TOTAL</strong></td>\n        <td></td>\n        <td><strong>${totalDistance} NM</strong></td>\n        <td><strong>${Math.floor(totalTime)}:${((totalTime % 1) * 60).toFixed(0).padStart(2, '0')}</strong></td>\n        <td><strong>${totalFuel.toFixed(1)} gal</strong></td>\n        <td><strong>$${totalCost.toFixed(0)}</strong></td>\n      </tr>\n    </tbody>\n  </table>\n\n  <div class=\"summary\">\n    <div class=\"summary-item\">\n      <div class=\"summary-value\">${totalDistance}</div>\n      <div class=\"summary-label\">Total Distance (NM)</div>\n    </div>\n    <div class=\"summary-item\">\n      <div class=\"summary-value\">${Math.floor(totalTime)}h ${((totalTime % 1) * 60).toFixed(0)}m</div>\n      <div class=\"summary-label\">Estimated Time</div>\n    </div>\n    <div class=\"summary-item\">\n      <div class=\"summary-value\">${totalFuel.toFixed(1)}</div>\n      <div class=\"summary-label\">Fuel Required (gal)</div>\n    </div>\n    <div class=\"summary-item\">\n      <div class=\"summary-value\">$${totalCost.toFixed(0)}</div>\n      <div class=\"summary-label\">Estimated Cost</div>\n    </div>\n  </div>\n\n  <div class=\"footer\">\n    Generated by FuelSaver - Flight Planning Tool<br>\n    For planning purposes only. Not for navigation.\n  </div>\n</body>\n</html>\n  `.trim();\n  \n  return html;\n}\n\n/**\n * Generate Detailed Nav Log (comprehensive format)\n */\nexport function generateDetailedNavLog(data: NavLogData): string {\n  const { name, aircraft, departure, arrival, date, legs, totalDistance, totalTime, totalFuel, totalCost } = data;\n  \n  const html = `\n<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"UTF-8\">\n  <title>Nav Log - ${name || 'Flight Plan'} (Detailed)</title>\n  <style>\n    @media print {\n      body { font-size: 9pt; }\n      .page-break { page-break-before: always; }\n    }\n    body { \n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      font-size: 10pt;\n      line-height: 1.3;\n      max-width: 900px;\n      margin: 0 auto;\n      padding: 15px;\n      color: #333;\n    }\n    h1 { font-size: 16pt; margin-bottom: 5px; }\n    .header { margin-bottom: 15px; border-bottom: 2px solid #333; padding-bottom: 10px; }\n    .meta { display: flex; gap: 25px; flex-wrap: wrap; font-size: 9pt; color: #666; }\n    .meta-item { }\n    .meta-label { font-weight: bold; color: #333; }\n    table { \n      width: 100%; \n      border-collapse: collapse; \n      margin-top: 12px;\n      font-size: 9pt;\n    }\n    th, td { \n      border: 1px solid #ddd; \n      padding: 4px 6px; \n      text-align: center;\n    }\n    th { background: #f0f0f0; font-weight: bold; font-size: 8pt; }\n    .waypoint-col { text-align: left; }\n    .small { font-size: 8pt; color: #666; }\n    .total-row { background: #f5f5f5; font-weight: bold; }\n    .summary { \n      margin-top: 15px; \n      padding: 12px; \n      background: #f5f5f5; \n      border-radius: 5px;\n      display: flex;\n      gap: 30px;\n      flex-wrap: wrap;\n    }\n    .summary-item { }\n    .summary-value { font-size: 14pt; font-weight: bold; color: #333; }\n    .summary-label { font-size: 8pt; color: #666; text-transform: uppercase; }\n    .footer { \n      margin-top: 20px; \n      font-size: 8pt; \n      color: #999; \n      text-align: center;\n      border-top: 1px solid #eee;\n      padding-top: 8px;\n    }\n    .wind-info { font-size: 8pt; color: #888; }\n  </style>\n</head>\n<body>\n  <div class=\"header\">\n    <h1>${name || 'Flight Plan'} - Detailed Nav Log</h1>\n    <div class=\"meta\">\n      <div class=\"meta-item\"><span class=\"meta-label\">Aircraft:</span> ${aircraft}</div>\n      <div class=\"meta-item\"><span class=\"meta-label\">Departure:</span> ${departure}</div>\n      <div class=\"meta-item\"><span class=\"meta-label\">Arrival:</span> ${arrival}</div>\n      <div class=\"meta-item\"><span class=\"meta-label\">Alt:</span> ${data.cruisingAltitude}ft</div>\n      <div class=\"meta-item\"><span class=\"meta-label\">Date:</span> ${date}</div>\n    </div>\n  </div>\n\n  <table>\n    <thead>\n      <tr>\n        <th rowspan=\"2\">From</th>\n        <th rowspan=\"2\">To</th>\n        <th colspan=\"3\">Course (Â°)</th>\n        <th colspan=\"2\">Speed (kts)</th>\n        <th rowspan=\"2\">Dist</th>\n        <th rowspan=\"2\">Time</th>\n        <th colspan=\"2\">Fuel (gal)</th>\n        <th rowspan=\"2\">Wind</th>\n        <th rowspan=\"2\">Cost</th>\n      </tr>\n      <tr>\n        <th>True</th>\n        <th>Mag Var</th>\n        <th>Mag</th>\n        <th>TAS</th>\n        <th>GS</th>\n        <th>Burn</th>\n        <th>+Res</th>\n      </tr>\n    </thead>\n    <tbody>\n      ${legs.map(leg => `\n        <tr>\n          <td class=\"waypoint-col\"><strong>${leg.from.icao}</strong><br><span class=\"small\">${(leg.from.name || '').substring(0, 20)}</span></td>\n          <td class=\"waypoint-col\"><strong>${leg.to.icao}</strong><br><span class=\"small\">${(leg.to.name || '').substring(0, 20)}</span></td>\n          <td>${leg.trueHeading}Â°</td>\n          <td>${leg.magneticVariation > 0 ? 'E' + leg.magneticVariation : leg.magneticVariation < 0 ? 'W' + Math.abs(leg.magneticVariation) : '0'}</td>\n          <td><strong>${leg.magneticHeading}Â°</strong></td>\n          <td>${leg.tas}</td>\n          <td><strong>${leg.groundspeed}</strong></td>\n          <td>${leg.distance}</td>\n          <td>${Math.floor(leg.time)}:${((leg.time % 1) * 60).toFixed(0).padStart(2, '0')}</td>\n          <td>${leg.fuelNeeded.toFixed(1)}</td>\n          <td><strong>${leg.fuelWithReserves.toFixed(1)}</strong></td>\n          <td class=\"wind-info\">${leg.windDirection}Â°/${leg.windSpeed}</td>\n          <td>$${leg.cost.toFixed(0)}</td>\n        </tr>\n      `).join('')}\n      <tr class=\"total-row\">\n        <td colspan=\"7\"><strong>TOTAL</strong></td>\n        <td><strong>${totalDistance}</strong></td>\n        <td><strong>${Math.floor(totalTime)}:${((totalTime % 1) * 60).toFixed(0).padStart(2, '0')}</strong></td>\n        <td>${(totalFuel - totalFuel * 0.2).toFixed(1)}</td>\n        <td><strong>${totalFuel.toFixed(1)}</strong></td>\n        <td></td>\n        <td><strong>$${totalCost.toFixed(0)}</strong></td>\n      </tr>\n    </tbody>\n  </table>\n\n  <div class=\"summary\">\n    <div class=\"summary-item\">\n      <div class=\"summary-value\">${totalDistance} NM</div>\n      <div class=\"summary-label\">Total Distance</div>\n    </div>\n    <div class=\"summary-item\">\n      <div class=\"summary-value\">${Math.floor(totalTime)}h ${((totalTime % 1) * 60).toFixed(0)}m</div>\n      <div class=\"summary-label\">Est. Time</div>\n    </div>\n    <div class=\"summary-item\">\n      <div class=\"summary-value\">${totalFuel.toFixed(1)} gal</div>\n      <div class=\"summary-label\">Fuel +25%</div>\n    </div>\n    <div class=\"summary-item\">\n      <div class=\"summary-value\">$${totalCost.toFixed(0)}</div>\n      <div class=\"summary-label\">Est. Cost</div>\n    </div>\n  </div>\n\n  <div class=\"footer\">\n    Generated by FuelSaver - Flight Planning Tool | For planning purposes only | Not for navigation\n  </div>\n</body>\n</html>\n  `.trim();\n  \n  return html;\n}\n\n/**\n * Create NavLog data from flight plan\n */\nexport function createNavLogData(\n  waypoints: Waypoint[],\n  aircraft: { name: string; speed: number; burnRate: number; fuelCapacity: number },\n  cruisingAltitude: number,\n  fuelPrices: Record<string, { price100ll: number | null }>,\n  windData: Record<string, { direction: number; speed: number }> = {}, // Optional wind by waypoint\n  planName?: string\n): NavLogData | null {\n  if (waypoints.length < 2) return null;\n\n  const derivedName = `Flight ${waypoints[0].icao} to ${waypoints[waypoints.length - 1].icao}`;\n  const name = planName?.trim()?.length ? planName.trim() : derivedName;\n  const date = new Date().toLocaleDateString('en-US', { \n    year: 'numeric', \n    month: 'numeric', \n    day: 'numeric' \n  });\n\n  const legs: NavLogLeg[] = [];\n  let totalDistance = 0;\n  let totalTime = 0;\n  let totalFuel = 0;\n  let totalCost = 0;\n\n  for (let i = 1; i < waypoints.length; i++) {\n    const from = waypoints[i - 1];\n    const to = waypoints[i];\n    \n    // Calculate distance\n    const distance = calculateDistance(from.latitude, from.longitude, to.latitude, to.longitude);\n    totalDistance += distance;\n    \n    // Get magnetic variation at midpoint\n    const midLat = (from.latitude + to.latitude) / 2;\n    const midLon = (from.longitude + to.longitude) / 2;\n    const magneticVariation = calculateMagneticVariation(midLat, midLon);\n    \n    // Get wind data (default if not provided)\n    const wind = windData[from.icao] || { direction: 270, speed: 10 }; // Default: wind from west at 10kts\n    \n    // Calculate true course\n    const trueCourse = calculateTrueCourse(from.latitude, from.longitude, to.latitude, to.longitude);\n    \n    // Calculate wind effects\n    const { groundspeed, windCorrection } = calculateWindEffect(\n      trueCourse,\n      aircraft.speed,\n      wind.direction,\n      wind.speed\n    );\n    \n    // Calculate headings\n    const magneticHeading = trueToMagnetic(trueCourse, magneticVariation);\n    const trueHeading = trueCourse;\n    \n    // Calculate time\n    const time = groundspeed > 0 ? distance / groundspeed * 60 : 0; // minutes\n    totalTime += time;\n    \n    // Calculate fuel\n    const fuelNeeded = (distance / aircraft.speed) * aircraft.burnRate;\n    const fuelWithReserves = fuelNeeded * 1.25;\n    totalFuel += fuelWithReserves;\n    \n    // Calculate cost\n    const fuelPrice = fuelPrices[from.icao]?.price100ll || 6.50;\n    const legCost = fuelWithReserves * fuelPrice;\n    totalCost += legCost;\n    \n    legs.push({\n      from,\n      to,\n      course: trueCourse,\n      distance,\n      tas: aircraft.speed,\n      windDirection: wind.direction,\n      windSpeed: wind.speed,\n      groundspeed,\n      windCorrection,\n      magneticVariation,\n      trueHeading,\n      magneticHeading,\n      time,\n      fuelNeeded,\n      fuelWithReserves,\n      cost: legCost\n    });\n  }\n\n  return {\n    name,\n    aircraft: aircraft.name,\n    departure: waypoints[0].icao,\n    arrival: waypoints[waypoints.length - 1].icao,\n    cruisingAltitude,\n    date,\n    legs,\n    totalDistance,\n    totalTime,\n    totalFuel,\n    totalCost\n  };\n}\n\n/**\n * Download Basic or Detailed Nav Log\n */\nexport function downloadNavLog(\n  waypoints: Waypoint[],\n  aircraft: { name: string; speed: number; burnRate: number; fuelCapacity: number },\n  cruisingAltitude: number,\n  fuelPrices: Record<string, { price100ll: number | null }>,\n  detailed: boolean = false,\n  planName?: string\n): void {\n  const navLogData = createNavLogData(waypoints, aircraft, cruisingAltitude, fuelPrices, undefined, planName);\n  if (!navLogData) return;\n\n  const html = detailed ? generateDetailedNavLog(navLogData) : generateBasicNavLog(navLogData);\n  const filename = `${navLogData.name?.replace(/[^a-z0-9]/gi, '-').toLowerCase() || 'flight-plan'}-${detailed ? 'detailed' : 'basic'}-navlog`;\n\n  // Open in new window for printing without document.write\n  const blob = new Blob([html], { type: 'text/html' });\n  const url = URL.createObjectURL(blob);\n  const printWindow = window.open(url, '_blank', 'noopener');\n  if (printWindow) {\n    const tryPrint = () => {\n      try {\n        printWindow.focus();\n        printWindow.print();\n      } catch {}\n    };\n    printWindow.addEventListener('load', tryPrint, { once: true });\n    setTimeout(tryPrint, 800);\n  }\n  setTimeout(() => URL.revokeObjectURL(url), 30_000);\n}\n\n/**\n * Download Nav Log as a styled PDF\n */\nexport function downloadNavLogPdf(\n  waypoints: Waypoint[],\n  aircraft: { name: string; speed: number; burnRate: number; fuelCapacity: number },\n  cruisingAltitude: number,\n  fuelPrices: Record<string, { price100ll: number | null }>,\n  options?: { detailed?: boolean; planName?: string }\n): void {\n  const navLogData = createNavLogData(\n    waypoints,\n    aircraft,\n    cruisingAltitude,\n    fuelPrices,\n    undefined,\n    options?.planName\n  );\n\n  if (!navLogData) return;\n\n  const detailed = options?.detailed ?? false;\n  const doc = createNavLogPdfDoc(navLogData, { detailed, cruisingAltitude });\n  const filenameBase = navLogData.name?.replace(/[^a-z0-9]/gi, '-').toLowerCase() || 'flight-plan';\n  doc.save(`${filenameBase}-navlog.pdf`);\n\n  persistNavLogExport(navLogData, detailed);\n}\n\nexport function createNavLogPdfDoc(\n  navLogData: NavLogData,\n  options?: { detailed?: boolean; cruisingAltitude?: number }\n): jsPDF {\n  const detailed = options?.detailed ?? false;\n  const doc = new jsPDF({ orientation: 'landscape', unit: 'mm', format: 'letter' });\n  const margin = 14;\n  const lineHeight = 6;\n  const headingY = margin + 4;\n\n  doc.setFont('helvetica', 'bold');\n  doc.setFontSize(18);\n  doc.text(navLogData.name || 'Flight Plan Nav Log', margin, headingY);\n\n  doc.setFontSize(10);\n  doc.setFont('helvetica', 'normal');\n  const metaLines = [\n    `Aircraft: ${navLogData.aircraft}`,\n    `Route: ${navLogData.departure} â†’ ${navLogData.arrival}`,\n    `Altitude: ${(options?.cruisingAltitude ?? navLogData.cruisingAltitude).toLocaleString()} ft`,\n    `Date: ${navLogData.date}`\n  ];\n  metaLines.forEach((line, idx) => {\n    doc.text(line, margin, headingY + 10 + idx * lineHeight);\n  });\n\n  const tableHead = detailed\n    ? [['Leg', 'CourseÂ°', 'True HDGÂ°', 'Mag HDGÂ°', 'GS (kt)', 'Dist (NM)', 'Time', 'Fuel (gal)', 'Cost ($)']]\n    : [['Leg', 'CourseÂ°', 'Dist (NM)', 'Time', 'Fuel (gal)', 'Cost ($)']];\n\n  const formatTime = (timeMinutes: number) => {\n    const hours = Math.floor(timeMinutes / 60);\n    const minutes = Math.round(timeMinutes % 60);\n    return `${hours}h ${minutes.toString().padStart(2, '0')}m`;\n  };\n\n  const tableBody = navLogData.legs.map((leg, index) => {\n    const legLabel = `${index + 1}. ${leg.from.icao} â†’ ${leg.to.icao}`;\n    if (detailed) {\n      return [\n        legLabel,\n        `${leg.course.toFixed(0)}`,\n        `${leg.trueHeading.toFixed(0)}`,\n        `${leg.magneticHeading.toFixed(0)}`,\n        `${leg.groundspeed.toFixed(0)}`,\n        `${leg.distance.toFixed(1)}`,\n        formatTime(leg.time),\n        `${leg.fuelWithReserves.toFixed(1)}`,\n        `$${leg.cost.toFixed(0)}`\n      ];\n    }\n\n    return [\n      legLabel,\n      `${leg.course.toFixed(0)}`,\n      `${leg.distance.toFixed(1)}`,\n      formatTime(leg.time),\n      `${leg.fuelWithReserves.toFixed(1)}`,\n      `$${leg.cost.toFixed(0)}`\n    ];\n  });\n\n  autoTable(doc, {\n    head: tableHead,\n    body: tableBody,\n    startY: headingY + 10 + metaLines.length * lineHeight + 4,\n    styles: { fontSize: 9, cellPadding: 3 },\n    headStyles: { fillColor: [15, 23, 42], textColor: 255, fontStyle: 'bold' },\n    alternateRowStyles: { fillColor: [248, 250, 252] },\n    columnStyles: {\n      0: { halign: 'left' }\n    }\n  });\n\n  const tableY = (doc as any).lastAutoTable?.finalY || 0;\n  const summaryY = tableY + 8;\n  doc.setFont('helvetica', 'bold');\n  doc.setFontSize(12);\n  doc.text('Summary', margin, summaryY);\n  doc.setFont('helvetica', 'normal');\n  doc.setFontSize(10);\n\n  const summaryLines = [\n    `Total Distance: ${navLogData.totalDistance.toFixed(1)} NM`,\n    `Estimated Time: ${formatTime(navLogData.totalTime)}`,\n    `Fuel Required: ${navLogData.totalFuel.toFixed(1)} gal`,\n    `Estimated Cost: $${navLogData.totalCost.toFixed(0)}`\n  ];\n\n  summaryLines.forEach((line, idx) => {\n    doc.text(line, margin, summaryY + 6 + idx * lineHeight);\n  });\n\n  doc.setFontSize(8);\n  doc.setTextColor(120);\n  doc.text('Generated by FuelSaver â€” For planning purposes only', margin, doc.internal.pageSize.getHeight() - margin);\n\n  return doc;\n}\n\nfunction persistNavLogExport(navLogData: NavLogData, detailed: boolean) {\n  if (typeof window === 'undefined') return;\n  try {\n    const existingRaw = localStorage.getItem(NAV_LOG_EXPORTS_KEY);\n    const existing: StoredNavLogExport[] = existingRaw ? JSON.parse(existingRaw) : [];\n    const entry: StoredNavLogExport = {\n      id: crypto.randomUUID ? crypto.randomUUID() : Date.now().toString(),\n      name: navLogData.name || `${navLogData.departure} â†’ ${navLogData.arrival}`,\n      createdAt: new Date().toISOString(),\n      detailed,\n      navLogData\n    };\n    const next = [entry, ...existing].slice(0, 20);\n    localStorage.setItem(NAV_LOG_EXPORTS_KEY, JSON.stringify(next));\n    window.dispatchEvent(new CustomEvent('navlog-exports-updated'));\n  } catch (error) {\n    console.error('Failed to persist nav log export', error);\n  }\n}\n\nexport function getNavLogExportHistory(): StoredNavLogExport[] {\n  if (typeof window === 'undefined') return [];\n  try {\n    const existingRaw = localStorage.getItem(NAV_LOG_EXPORTS_KEY);\n    return existingRaw ? JSON.parse(existingRaw) : [];\n  } catch (error) {\n    console.error('Failed to load nav log exports', error);\n    return [];\n  }\n}\n\nexport interface DeepLinkResult {\n  scheme: string;\n  fallback?: string;\n}\n\nexport function generateForeFlightDeepLink(\n  waypoints: Waypoint[],\n  options?: { planName?: string; altitude?: number }\n): DeepLinkResult | null {\n  const route = waypoints\n    .filter((wp) => wp?.icao)\n    .map((wp) => ({ ...wp, icao: (wp.icao || '').toUpperCase() }));\n  if (route.length < 2) return null;\n\n  const origin = route[0].icao;\n  const destination = route[route.length - 1].icao;\n  const intermediate = route.slice(1, -1).map((wp) => wp.icao).join('+');\n  const params = new URLSearchParams({\n    name: options?.planName || `${origin}-${destination}`,\n    origin,\n    destination,\n  });\n  if (intermediate) params.set('waypoints', intermediate);\n  if (options?.altitude) params.set('altitude', options.altitude.toString());\n\n  const scheme = `foreflight://route?${params.toString()}`;\n  const fallbackRoute = route.map((wp) => wp.icao).join('.');\n  const fallback = `https://plan.foreflight.com/plan?route=${encodeURIComponent(fallbackRoute)}`;\n  return { scheme, fallback };\n}\n\nexport function generateGarminDeepLink(\n  waypoints: Waypoint[],\n  options?: { planName?: string }\n): DeepLinkResult | null {\n  const route = waypoints\n    .filter((wp) => wp?.icao)\n    .map((wp) => ({ ...wp, icao: (wp.icao || '').toUpperCase() }));\n  if (route.length < 2) return null;\n\n  const routeDots = route.map((wp) => wp.icao).join('..');\n  const schemeParams = new URLSearchParams({\n    route: routeDots,\n  });\n  if (options?.planName) {\n    schemeParams.set('name', options.planName);\n  }\n  const scheme = `garminpilot://flightPlan?${schemeParams.toString()}`;\n  const fallback = `https://fly.garmin.com/fpl/application?plan=${route.map((wp) => wp.icao).join(',')}`;\n  return { scheme, fallback };\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\fuel-saver\\lib\\magneticVariation.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'angle' is assigned a value but never used.","line":41,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":41,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'r' is assigned a value but never used.","line":50,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":50,"endColumn":10}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Magnetic Variation Calculator\n * Uses World Magnetic Model (WMM) simplified approximation\n * Accurate enough for flight planning purposes (Â±1-2 degrees)\n * \n * For more accurate values, use NOAA's WMM calculator:\n * https://www.ngdc.noaa.gov/geomag/calculators/magcalc.shtml\n */\n\n/**\n * Calculate magnetic variation for a given latitude/longitude\n * Uses simplified dipole model approximation\n * \n * @param latitude - in degrees (positive = north)\n * @param longitude - in degrees (positive = east)\n * @param year - year for calculation (defaults to current year)\n * @returns magnetic variation in degrees (positive = east variation, negative = west)\n */\nexport function calculateMagneticVariation(\n  latitude: number, \n  longitude: number, \n  year: number = new Date().getFullYear()\n): number {\n  // Reference year for WMM 2020-2025 model\n  const referenceYear = 2022.5;\n  const yearsFromReference = year - referenceYear;\n\n  // Earth's magnetic pole positions (approximate)\n  const magneticNorthLat = 86.5;   // Magnetic north pole latitude\n  const magneticNorthLon = 172.4;   // Magnetic north pole longitude (west)\n\n  // Convert to radians\n  const latRad = (latitude * Math.PI) / 180;\n  const lonRad = (longitude * Math.PI) / 180;\n  const magLatRad = (magneticNorthLat * Math.PI) / 180;\n  const magLonRad = (magneticNorthLon * Math.PI) / 180;\n\n  // Calculate great circle distance from magnetic pole\n  const cosAngle = Math.sin(latRad) * Math.sin(magLatRad) + \n                   Math.cos(latRad) * Math.cos(magLatRad) * Math.cos(lonRad - magLonRad);\n  const angle = Math.acos(Math.max(-1, Math.min(1, cosAngle)));\n  \n  // Calculate magnetic dipole longitude\n  const dipoleLon = Math.atan2(\n    Math.sin(lonRad - magLonRad) * Math.cos(magLatRad),\n    Math.cos(latRad) * Math.sin(magLatRad) - Math.sin(latRad) * Math.cos(magLatRad) * Math.cos(lonRad - magLonRad)\n  );\n\n  // Simplified magnetic field components\n  const r = 6371.2; // Earth radius in km\n  const a = 6378.137; // WGS84 equatorial radius\n  const b = 6356.752; // WGS84 polar radius\n  \n  // Convert geodetic to geocentric\n  const latGeocentric = Math.atan(\n    (b * b / (a * a)) * Math.tan(latRad)\n  );\n\n  // Simplified dipole field strength (approximation)\n  const colat = Math.acos(\n    Math.sin(latGeocentric) * Math.sin(magLatRad) + \n    Math.cos(latGeocentric) * Math.cos(magLatRad) * Math.cos(dipoleLon)\n  );\n  \n  // Calculate variation using dipole approximation\n  // This gives a reasonable approximation for planning purposes\n  const sinVar = Math.sin(dipoleLon) * Math.cos(latGeocentric) / Math.sin(colat);\n  const cosVar = (Math.sin(magLatRad) - Math.sin(latGeocentric) * Math.cos(colat)) / \n                 (Math.cos(latGeocentric) * Math.sin(colat));\n  \n  let variation = Math.atan2(sinVar, cosVar) * (180 / Math.PI);\n  \n  // Add annual drift (magnetic poles are moving ~40-50km/year)\n  // Eastern drift in North America\n  const annualDrift = 0.15; // degrees per year (approximate)\n  variation += yearsFromReference * annualDrift;\n\n  return Math.round(variation * 10) / 10; // Round to 1 decimal\n}\n\n/**\n * Get variation for multiple waypoints\n */\nexport function getVariationsForRoute(\n  waypoints: { latitude: number; longitude: number }[]\n): number[] {\n  return waypoints.map(wp => calculateMagneticVariation(wp.latitude, wp.longitude));\n}\n\n/**\n * Apply magnetic variation to get heading components\n */\nexport function trueToMagnetic(trueHeading: number, variation: number): number {\n  let magHeading = trueHeading + variation;\n  if (magHeading < 0) magHeading += 360;\n  if (magHeading >= 360) magHeading -= 360;\n  return Math.round(magHeading);\n}\n\nexport function magneticToTrue(magneticHeading: number, variation: number): number {\n  let trueHeading = magneticHeading - variation;\n  if (trueHeading < 0) trueHeading += 360;\n  if (trueHeading >= 360) trueHeading -= 360;\n  return Math.round(trueHeading);\n}\n\n/**\n * Get compass rose directions\n */\nexport function getCompassDirections(): { direction: string; degrees: number }[] {\n  return [\n    { direction: 'N', degrees: 0 },\n    { direction: 'NNE', degrees: 22.5 },\n    { direction: 'NE', degrees: 45 },\n    { direction: 'ENE', degrees: 67.5 },\n    { direction: 'E', degrees: 90 },\n    { direction: 'ESE', degrees: 112.5 },\n    { direction: 'SE', degrees: 135 },\n    { direction: 'SSE', degrees: 157.5 },\n    { direction: 'S', degrees: 180 },\n    { direction: 'SSW', degrees: 202.5 },\n    { direction: 'SW', degrees: 225 },\n    { direction: 'WSW', degrees: 247.5 },\n    { direction: 'W', degrees: 270 },\n    { direction: 'WNW', degrees: 292.5 },\n    { direction: 'NW', degrees: 315 },\n    { direction: 'NNW', degrees: 337.5 },\n  ];\n}\n\n/**\n * Get cardinal direction for a heading\n */\nexport function getCardinalDirection(heading: number): string {\n  const directions = getCompassDirections();\n  const normalized = ((heading % 360) + 360) % 360;\n  \n  for (let i = directions.length - 1; i >= 0; i--) {\n    if (normalized >= directions[i].degrees) {\n      return directions[i].direction;\n    }\n  }\n  return 'N';\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\fuel-saver\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MapTileLayer' is defined but never used.","line":14,"column":44,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":56,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"MapTileLayer"},"fix":{"range":[777,791],"text":""},"desc":"Remove unused variable \"MapTileLayer\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FlightPlayback' is defined but never used.","line":15,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":22,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"FlightPlayback"},"fix":{"range":[834,882],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'RangeRingCalculator' is defined but never used.","line":16,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":27,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"RangeRingCalculator"},"fix":{"range":[882,930],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'VerificationBanner' is defined but never used.","line":21,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":26,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"VerificationBanner"},"fix":{"range":[1174,1245],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":157,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":157,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7631,7634],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7631,7634],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":158,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":158,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7711,7714],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7711,7714],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'loadingAirports' is assigned a value but never used.","line":287,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":287,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setShowAllAirports' is assigned a value but never used.","line":289,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":289,"endColumn":45},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":315,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":315,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14301,14304],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14301,14304],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":318,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":318,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14428,14431],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14428,14431],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-const","severity":2,"message":"'newOrder' is never reassigned. Use 'const' instead.","line":348,"column":11,"nodeType":"Identifier","messageId":"useConst","endLine":348,"endColumn":19,"fix":{"range":[15462,15498],"text":"const newOrder = [...stateCacheOrder];"}},{"ruleId":"prefer-const","severity":2,"message":"'newCache' is never reassigned. Use 'const' instead.","line":349,"column":11,"nodeType":"Identifier","messageId":"useConst","endLine":349,"endColumn":19,"fix":{"range":[15506,15539],"text":"const newCache = { ...stateCache };"}},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'mapHeightPercent' is assigned a value but never used.","line":369,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":369,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setMapHeightPercent' is assigned a value but never used.","line":369,"column":28,"nodeType":"Identifier","messageId":"unusedVar","endLine":369,"endColumn":47},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":397,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":397,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17409,17412],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17409,17412],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'showWeatherMap' is assigned a value but never used.","line":413,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":413,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setShowWeatherMap' is assigned a value but never used.","line":413,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":413,"endColumn":43},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'segmentWeather' is assigned a value but never used.","line":414,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":414,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setSegmentWeather' is assigned a value but never used.","line":414,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":414,"endColumn":43},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":415,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":415,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18314,18317],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18314,18317],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":417,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":417,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18473,18476],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18473,18476],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":426,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":426,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18871,18874],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18871,18874],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":427,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":427,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18921,18924],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18921,18924],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":482,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":482,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20695,20698],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20695,20698],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":507,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":507,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21466,21469],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21466,21469],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":524,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":524,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22083,22086],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22083,22086],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":540,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":540,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22737,22740],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22737,22740],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":542,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":542,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22869,22872],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22869,22872],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":555,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":555,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23626,23629],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23626,23629],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'DEMO_FLIGHT_PLANS'. Either include it or remove the dependency array.","line":641,"column":6,"nodeType":"ArrayExpression","endLine":641,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [DEMO_FLIGHT_PLANS, demoPlansLoaded]","fix":{"range":[26531,26548],"text":"[DEMO_FLIGHT_PLANS, demoPlansLoaded]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":644,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":644,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26633,26636],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26633,26636],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fuelPrices'. Either include it or remove the dependency array.","line":938,"column":6,"nodeType":"ArrayExpression","endLine":938,"endColumn":17,"suggestions":[{"desc":"Update the dependencies array to be: [fuelPrices, waypoints]","fix":{"range":[37998,38009],"text":"[fuelPrices, waypoints]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'isNorthAmerica'. Either include it or remove the dependency array.","line":1031,"column":6,"nodeType":"ArrayExpression","endLine":1031,"endColumn":51,"suggestions":[{"desc":"Update the dependencies array to be: [airports, cachedAirports, isNorthAmerica, showInternational]","fix":{"range":[41398,41443],"text":"[airports, cachedAirports, isNorthAmerica, showInternational]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1085,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1085,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[43030,43033],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[43030,43033],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-const","severity":2,"message":"'airport' is never reassigned. Use 'const' instead.","line":1304,"column":13,"nodeType":"Identifier","messageId":"useConst","endLine":1304,"endColumn":20,"fix":{"range":[50246,50318],"text":"const airport = DEMO_AIRPORTS.find(a => a.icao === icao?.substring(0, 4));"}},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'importFromFPDB' is assigned a value but never used.","line":1386,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":1386,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'parseRouteString' is assigned a value but never used.","line":1445,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":1445,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'parseFMS' is assigned a value but never used.","line":1479,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":1479,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'parseVATSIM' is assigned a value but never used.","line":1520,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":1520,"endColumn":20},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1600,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1600,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[60457,60460],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[60457,60460],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":1628,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":1628,"endColumn":17},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'fboFeesData'. Either include it or remove the dependency array.","line":1764,"column":6,"nodeType":"ArrayExpression","endLine":1764,"endColumn":112,"suggestions":[{"desc":"Update the dependencies array to be: [waypoints, selectedAircraft.speed, selectedAircraft.burnRate, selectedAircraft.fuelCapacity, includeLandingFees, includeFboFees, soulsOnBoard, departureFuel, fuelPrices, fboFeesData]","fix":{"range":[65883,65989],"text":"[waypoints, selectedAircraft.speed, selectedAircraft.burnRate, selectedAircraft.fuelCapacity, includeLandingFees, includeFboFees, soulsOnBoard, departureFuel, fuelPrices, fboFeesData]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1817,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1817,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[67721,67724],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[67721,67724],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1869,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1869,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[69911,69914],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[69911,69914],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1871,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1871,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[70073,70076],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[70073,70076],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1912,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1912,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[71465,71468],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[71465,71468],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1939,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1939,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[72510,72513],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[72510,72513],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1980,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1980,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[73919,73922],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[73919,73922],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getMarkerColor' is assigned a value but never used.","line":2003,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":2003,"endColumn":23},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":2496,"column":113,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[101034,101035],"text":"&quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[101034,101035],"text":"&ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[101034,101035],"text":"&#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[101034,101035],"text":"&rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":2508,"column":67,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[102022,102023],"text":"&quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[102022,102023],"text":"&ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[102022,102023],"text":"&#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[102022,102023],"text":"&rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":2512,"column":65,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[102321,102322],"text":"&quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[102321,102322],"text":"&ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[102321,102322],"text":"&#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[102321,102322],"text":"&rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":2734,"column":126,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[115405,115406],"text":"&quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[115405,115406],"text":"&ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[115405,115406],"text":"&#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[115405,115406],"text":"&rdquo;"},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":31,"fatalErrorCount":0,"warningCount":22,"fixableErrorCount":3,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useMemo, useEffect, useRef, useCallback, Suspense } from 'react';\r\nimport { useSession, signIn, signOut } from 'next-auth/react';\r\nimport { useSearchParams } from 'next/navigation';\r\nimport dynamic from 'next/dynamic';\r\n\r\n// Dynamic imports for Leaflet components (no SSR)\r\nconst LeafletMap = dynamic(() => import('./LeafletMap'), { ssr: false });\r\nconst StateInfoPanel = dynamic(() => import('./StateInfoPanel'), { ssr: false });\r\nconst NotamsPanel = dynamic(() => import('./components/NOTAMsPanel'), { ssr: false });\r\nconst ExportDropdown = dynamic(() => import('./components/ExportDropdown'), { ssr: false });\r\nconst TripFinder = dynamic(() => import('./components/TripFinder'), { ssr: false });\r\nimport { MapControls, DEFAULT_MAP_OPTIONS, MapTileLayer, MapLayerOptions } from './MapControls';\r\nimport FlightPlayback from './FlightPlayback';\r\nimport RangeRingCalculator from './RangeRing';\r\nimport PerformanceSettingsPanel, { PerformanceSettings, DEFAULT_SETTINGS } from './PerformanceSettings';\r\nimport AuthModal from './AuthModal';\r\nimport UpgradeModal from './UpgradeModal';\r\nimport TierExplainerModal from './TierExplainerModal';\r\nimport VerificationBanner from '../../components/VerificationBanner';\r\n\r\n// Types\r\nexport interface Airport {\r\n  icao: string;\r\n  iata?: string;\r\n  name: string;\r\n  city?: string;\r\n  country?: string;\r\n  latitude: number;\r\n  longitude: number;\r\n  type?: string;\r\n  elevation_ft?: number;\r\n}\r\n\r\ninterface Waypoint {\r\n  id: string;\r\n  icao: string;\r\n  name: string;\r\n  city?: string;\r\n  state?: string;\r\n  latitude: number;\r\n  longitude: number;\r\n  altitude?: number;\r\n  sequence: number;\r\n  type?: string;\r\n}\r\n\r\ninterface FuelPrice {\r\n  icao: string;\r\n  price100ll: number | null;\r\n  priceJetA: number | null;\r\n  lastUpdated: string;\r\n  source?: string;\r\n  sourceUrl?: string;\r\n  lastReported?: string;\r\n}\r\n\r\n// Inner component that uses useSearchParams\r\n// function FuelSaverContent() {\r\n// \r\n// Demo airports (fallback)\r\nconst DEMO_AIRPORTS: Airport[] = [\r\n  { icao: 'KORD', iata: 'ORD', name: \"Chicago O'Hare International\", city: 'Chicago', latitude: 41.9742, longitude: -87.9073, type: 'large_airport' },\r\n  { icao: 'KLAX', iata: 'LAX', name: 'Los Angeles International', city: 'Los Angeles', latitude: 33.9425, longitude: -118.4081, type: 'large_airport' },\r\n  { icao: 'KJFK', iata: 'JFK', name: 'John F. Kennedy International', city: 'New York', latitude: 40.6413, longitude: -73.7781, type: 'large_airport' },\r\n  { icao: 'KATL', iata: 'ATL', name: 'Hartsfield-Jackson Atlanta', city: 'Atlanta', latitude: 33.6407, longitude: -84.4277, type: 'large_airport' },\r\n  { icao: 'KDEN', iata: 'DEN', name: 'Denver International', city: 'Denver', latitude: 39.8561, longitude: -104.6737, type: 'large_airport' },\r\n  { icao: 'KSFO', iata: 'SFO', name: 'San Francisco International', city: 'San Francisco', latitude: 37.6213, longitude: -122.379, type: 'large_airport' },\r\n  { icao: 'KLAS', iata: 'LAS', name: 'Harry Reid International', city: 'Las Vegas', latitude: 36.084, longitude: -115.1537, type: 'large_airport' },\r\n  { icao: 'KSEA', iata: 'SEA', name: 'Seattle-Tacoma International', city: 'Seattle', latitude: 47.4502, longitude: -122.3088, type: 'large_airport' },\r\n  { icao: 'KMIA', iata: 'MIA', name: 'Miami International', city: 'Miami', latitude: 25.7959, longitude: -80.287, type: 'large_airport' },\r\n  { icao: 'KDFW', iata: 'DFW', name: 'Dallas/Fort Worth International', city: 'Dallas', latitude: 32.8998, longitude: -97.0403, type: 'large_airport' },\r\n  { icao: 'KPHX', iata: 'PHX', name: 'Phoenix Sky Harbor', city: 'Phoenix', latitude: 33.4352, longitude: -112.0101, type: 'large_airport' },\r\n  { icao: 'KIAH', iata: 'IAH', name: 'George Bush Intercontinental', city: 'Houston', latitude: 29.9902, longitude: -95.3368, type: 'large_airport' },\r\n  { icao: 'KBOS', iata: 'BOS', name: 'Boston Logan International', city: 'Boston', latitude: 42.3656, longitude: -71.0096, type: 'large_airport' },\r\n  { icao: 'KMSP', iata: 'MSP', name: 'Minneapolis-St Paul International', city: 'Minneapolis', latitude: 44.882, longitude: -93.2218, type: 'large_airport' },\r\n  { icao: 'KCLT', iata: 'CLT', name: 'Charlotte Douglas International', city: 'Charlotte', latitude: 35.2144, longitude: -80.9473, type: 'large_airport' },\r\n  { icao: 'KSTL', iata: 'STL', name: 'St. Louis Lambert International', city: 'St. Louis', latitude: 38.7499, longitude: -90.3742, type: 'large_airport' },\r\n  { icao: 'KPDX', iata: 'PDX', name: 'Portland International', city: 'Portland', latitude: 45.5898, longitude: -122.5951, type: 'large_airport' },\r\n  { icao: 'KRDU', iata: 'RDU', name: 'Raleigh-Durham International', city: 'Raleigh', latitude: 35.8801, longitude: -78.788, type: 'large_airport' },\r\n  { icao: 'KSMF', iata: 'SMF', name: 'Sacramento International', city: 'Sacramento', latitude: 38.6954, longitude: -121.5908, type: 'medium_airport' },\r\n  { icao: 'KVNY', iata: 'VNY', name: 'Van Nuys Airport', city: 'Van Nuys', latitude: 34.2098, longitude: -118.4895, type: 'medium_airport' },\r\n];\r\n\r\n// Demo fuel prices\r\nconst DEMO_FUEL_PRICES: FuelPrice[] = [\r\n  { icao: 'KORD', price100ll: 9.58, priceJetA: 9.58, lastUpdated: '2026-02-15' },\r\n  { icao: 'KLAX', price100ll: 10.65, priceJetA: 10.65, lastUpdated: '2026-02-15' },\r\n  { icao: 'KVNY', price100ll: 8.32, priceJetA: 8.32, lastUpdated: '2026-02-15' },\r\n  { icao: 'KPDK', price100ll: 8.67, priceJetA: 8.67, lastUpdated: '2026-02-15' },\r\n];\r\n\r\n// Calculate distance (NM)\r\nfunction calculateDistance(lat1: number, lon1: number, lat2: number, lon2: number): number {\r\n  const R = 3440.065;\r\n  const dLat = (lat2 - lat1) * Math.PI / 180;\r\n  const dLon = (lon2 - lon1) * Math.PI / 180;\r\n  const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +\r\n    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *\r\n    Math.sin(dLon / 2) * Math.sin(dLon / 2);\r\n  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n  return R * c;\r\n}\r\n\r\n// Persistent cache with localStorage\r\nconst CACHE_EXPIRY = 7 * 24 * 60 * 60 * 1000; // 7 days\r\n\r\nfunction getCachedData<T>(key: string): T | null {\r\n  if (typeof window === 'undefined') return null;\r\n  try {\r\n    const cached = localStorage.getItem(key);\r\n    if (!cached) return null;\r\n    const { data, timestamp } = JSON.parse(cached);\r\n    if (Date.now() - timestamp > CACHE_EXPIRY) {\r\n      localStorage.removeItem(key);\r\n      return null;\r\n    }\r\n    return data as T;\r\n  } catch { return null; }\r\n}\r\n\r\nfunction setCachedData<T>(key: string, data: T): void {\r\n  if (typeof window === 'undefined') return;\r\n  try {\r\n    localStorage.setItem(key, JSON.stringify({ data, timestamp: Date.now() }));\r\n  } catch { /* ignore */ }\r\n}\r\n\r\n// Fuel price cache (in-memory + localStorage)\r\nconst fuelPriceCache: Record<string, FuelPrice> = {};\r\n\r\nasync function getFuelPrice(icao: string): Promise<FuelPrice | undefined> {\r\n  if (fuelPriceCache[icao]) return fuelPriceCache[icao];\r\n  \r\n  // Check localStorage cache first\r\n  const cachedPrices = getCachedData<Record<string, FuelPrice>>('fuelPricesCache');\r\n  if (cachedPrices?.[icao]) {\r\n    fuelPriceCache[icao] = cachedPrices[icao];\r\n    return cachedPrices[icao];\r\n  }\r\n  \r\n  // Check demo prices\r\n  const demo = DEMO_FUEL_PRICES.find(f => f.icao === icao);\r\n  if (demo) {\r\n    fuelPriceCache[icao] = demo;\r\n    return demo;\r\n  }\r\n  \r\n  // Try API\r\n  try {\r\n    const res = await fetch(`/api/fuel?icao=${icao}`);\r\n    if (res.ok) {\r\n      const data = await res.json();\r\n      // New API format returns prices array with average\r\n      if (data.prices && data.prices.length > 0) {\r\n        const llPrice = data.prices.find((p: any) => p.fuelType === '100LL');\r\n        const jetPrice = data.prices.find((p: any) => p.fuelType === 'JetA');\r\n        \r\n        const fp: FuelPrice = {\r\n          icao: data.icao,\r\n          price100ll: llPrice?.price || null,\r\n          priceJetA: jetPrice?.price || null,\r\n          lastUpdated: data.scrapedAt || '',\r\n          source: 'airnav',\r\n          sourceUrl: llPrice?.sourceUrl || '',\r\n          lastReported: llPrice?.lastReported || ''\r\n        };\r\n        fuelPriceCache[icao] = fp;\r\n        return fp;\r\n      }\r\n      // Fallback to old format\r\n      if (data.price100ll) {\r\n        const fp: FuelPrice = {\r\n          icao: data.icao,\r\n          price100ll: data.price100ll,\r\n          priceJetA: data.priceJetA,\r\n          lastUpdated: data.lastUpdated || '',\r\n          source: data.source\r\n        };\r\n        fuelPriceCache[icao] = fp;\r\n        return fp;\r\n      }\r\n    }\r\n  } catch (e) { console.error('Error fetching fuel:', e); }\r\n  \r\n  return undefined;\r\n}\r\n\r\n// Aircraft profiles with W&B data (arms in inches, weights in lbs)\r\nconst AIRCRAFT_PROFILES = [\r\n  // Cessna\r\n  { \r\n    name: 'Cessna 172S (2022)', manufacturer: 'Cessna', year: 2022, \r\n    fuelCapacity: 56, burnRate: 9.9, speed: 122, type: '100LL',\r\n    emptyWeight: 1689, emptyCG: 39.1, maxWeight: 2550,\r\n    arms: { frontSeats: 37.0, rearSeats: 73.0, baggage1: 95.0, baggage2: 123.0, fuel: 48.0 },\r\n    cgLimits: { forward: 35.0, aft: 47.3 }\r\n  },\r\n  { \r\n    name: 'Cessna 182T (2020)', manufacturer: 'Cessna', year: 2020, \r\n    fuelCapacity: 92, burnRate: 12.5, speed: 140, type: '100LL',\r\n    emptyWeight: 1710, emptyCG: 39.0, maxWeight: 3100,\r\n    arms: { frontSeats: 37.0, rearSeats: 73.0, baggage1: 95.0, baggage2: 123.0, fuel: 48.0 },\r\n    cgLimits: { forward: 35.0, aft: 47.3 }\r\n  },\r\n  { \r\n    name: 'Cessna 208 Caravan (2020)', manufacturer: 'Cessna', year: 2020, \r\n    fuelCapacity: 335, burnRate: 55, speed: 180, type: 'JET-A',\r\n    emptyWeight: 4520, emptyCG: 90.0, maxWeight: 8800,\r\n    arms: { frontSeats: 82.0, rearSeats: 118.0, baggage1: 150.0, fuel: 95.0 },\r\n    cgLimits: { forward: 75.0, aft: 120.0 }\r\n  },\r\n  // Piper\r\n  { \r\n    name: 'Piper Cherokee Six (2015)', manufacturer: 'Piper', year: 2015, \r\n    fuelCapacity: 84, burnRate: 11, speed: 130, type: '100LL',\r\n    emptyWeight: 1520, emptyCG: 35.5, maxWeight: 2800,\r\n    arms: { frontSeats: 32.5, rearSeats: 75.0, baggage1: 95.0, baggage2: 123.0, fuel: 47.0 },\r\n    cgLimits: { forward: 31.0, aft: 47.3 }\r\n  },\r\n  { \r\n    name: 'Piper Cherokee Six (2020)', manufacturer: 'Piper', year: 2020, \r\n    fuelCapacity: 84, burnRate: 10.5, speed: 132, type: '100LL',\r\n    emptyWeight: 1530, emptyCG: 35.5, maxWeight: 2800,\r\n    arms: { frontSeats: 32.5, rearSeats: 75.0, baggage1: 95.0, baggage2: 123.0, fuel: 47.0 },\r\n    cgLimits: { forward: 31.0, aft: 47.3 }\r\n  },\r\n  { \r\n    name: 'Piper Meridian (2021)', manufacturer: 'Piper', year: 2021, \r\n    fuelCapacity: 242, burnRate: 40, speed: 240, type: 'JET-A',\r\n    emptyWeight: 3200, emptyCG: 85.0, maxWeight: 5200,\r\n    arms: { frontSeats: 80.5, rearSeats: 118.0, baggage1: 150.0, fuel: 95.0 },\r\n    cgLimits: { forward: 75.0, aft: 93.0 }\r\n  },\r\n  // Beechcraft\r\n  { \r\n    name: 'Beechcraft Bonanza A36 (2018)', manufacturer: 'Beechcraft', year: 2018, \r\n    fuelCapacity: 102, burnRate: 14, speed: 155, type: '100LL',\r\n    emptyWeight: 2550, emptyCG: 82.0, maxWeight: 3600,\r\n    arms: { frontSeats: 82.5, rearSeats: 95.0, baggage1: 122.0, fuel: 95.0 },\r\n    cgLimits: { forward: 77.0, aft: 93.0 }\r\n  },\r\n  { \r\n    name: 'Beechcraft Bonanza A36 (2024)', manufacturer: 'Beechcraft', year: 2024, \r\n    fuelCapacity: 102, burnRate: 13.5, speed: 158, type: '100LL',\r\n    emptyWeight: 2560, emptyCG: 82.0, maxWeight: 3600,\r\n    arms: { frontSeats: 82.5, rearSeats: 95.0, baggage1: 122.0, fuel: 95.0 },\r\n    cgLimits: { forward: 77.0, aft: 93.0 }\r\n  },\r\n  // Diamond\r\n  { \r\n    name: 'Diamond DA40 (2020)', manufacturer: 'Diamond', year: 2020, \r\n    fuelCapacity: 58, burnRate: 9, speed: 140, type: '100LL',\r\n    emptyWeight: 1650, emptyCG: 93.0, maxWeight: 2700,\r\n    arms: { frontSeats: 85.0, rearSeats: 85.0, baggage1: 90.0, fuel: 90.0 },\r\n    cgLimits: { forward: 82.0, aft: 96.0 }\r\n  },\r\n  { \r\n    name: 'Diamond DA40 (2024)', manufacturer: 'Diamond', year: 2024, \r\n    fuelCapacity: 58, burnRate: 8.8, speed: 142, type: '100LL',\r\n    emptyWeight: 1660, emptyCG: 93.0, maxWeight: 2700,\r\n    arms: { frontSeats: 85.0, rearSeats: 85.0, baggage1: 90.0, fuel: 90.0 },\r\n    cgLimits: { forward: 82.0, aft: 96.0 }\r\n  },\r\n  // Cirrus\r\n  { \r\n    name: 'Cirrus SR22 (2019)', manufacturer: 'Cirrus', year: 2019, \r\n    fuelCapacity: 92, burnRate: 13, speed: 155, type: '100LL',\r\n    emptyWeight: 3400, emptyCG: 35.0, maxWeight: 3600,\r\n    arms: { frontSeats: 35.0, rearSeats: 66.0, baggage1: 86.0, baggage2: 86.0, fuel: 48.0 },\r\n    cgLimits: { forward: 33.0, aft: 47.3 }\r\n  },\r\n  { \r\n    name: 'Cirrus SR22 (2024)', manufacturer: 'Cirrus', year: 2024, \r\n    fuelCapacity: 92, burnRate: 12.5, speed: 158, type: '100LL',\r\n    emptyWeight: 3410, emptyCG: 35.0, maxWeight: 3600,\r\n    arms: { frontSeats: 35.0, rearSeats: 66.0, baggage1: 86.0, baggage2: 86.0, fuel: 48.0 },\r\n    cgLimits: { forward: 33.0, aft: 47.3 }\r\n  },\r\n];\r\n\r\nfunction FuelSaverContent() {\r\n  // Core state\r\n  const [mapLoaded, setMapLoaded] = useState(true);\r\n  const [airports, setAirports] = useState<Airport[]>([]);\r\n  const [loadingAirports, setLoadingAirports] = useState(false);\r\n  const [mapBounds, setMapBounds] = useState({ minLat: 25, maxLat: 50, minLon: -130, maxLon: -65 });\r\n  const [showAllAirports, setShowAllAirports] = useState(false);\r\n  const [showInternational, setShowInternational] = useState(false); // Show Canada/Mexico airports\r\n  const [mapCenter, setMapCenter] = useState<[number, number]>([39.8283, -98.5795]);\r\n  const [mapZoom, setMapZoom] = useState(5);\r\n  \r\n  // Geographic bounds for USA/Canada/Mexico (default restricted area)\r\n  const NORTH_AMERICA_BOUNDS = {\r\n    minLat: 15, maxLat: 72,  // Mexico to northern Canada\r\n    minLon: -180, maxLon: -50 // Include Alaska\r\n  };\r\n  \r\n  // Check if airport is in North America (USA, Canada, Mexico)\r\n  const isNorthAmerica = (airport: Airport) => {\r\n    const { latitude, longitude } = airport;\r\n    return (\r\n      latitude >= NORTH_AMERICA_BOUNDS.minLat &&\r\n      latitude <= NORTH_AMERICA_BOUNDS.maxLat &&\r\n      longitude >= NORTH_AMERICA_BOUNDS.minLon &&\r\n      longitude <= NORTH_AMERICA_BOUNDS.maxLon\r\n    );\r\n  };\r\n  \r\n  // Map layer options\r\n  const [mapOptions, setMapOptions] = useState<MapLayerOptions>(DEFAULT_MAP_OPTIONS);\r\n  \r\n  // State info panel\r\n  const [selectedStateInfo, setSelectedStateInfo] = useState<any>(null);\r\n  \r\n  // LRU cache for state info (last 4 clicked)\r\n  const [stateCache, setStateCache] = useState<Record<string, any>>({});\r\n  const [stateCacheOrder, setStateCacheOrder] = useState<string[]>([]);\r\n  \r\n  // Handle view state info - lazy loads and caches\r\n  const handleViewStateInfo = useCallback(async (stateCode: string) => {\r\n    if (!stateCode) return;\r\n    \r\n    // Only accept valid US state codes (2-letter abbreviations)\r\n    if (stateCode.length !== 2 || !/^[A-Z]{2}$/.test(stateCode)) {\r\n      console.log('Skipping non-US state:', stateCode);\r\n      return;\r\n    }\r\n    \r\n    console.log('handleViewStateInfo called with:', stateCode);\r\n    \r\n    // Check cache first\r\n    if (stateCache[stateCode]) {\r\n      console.log('Using cached state info for:', stateCode);\r\n      setSelectedStateInfo(stateCache[stateCode]);\r\n      return;\r\n    }\r\n    \r\n    // Lazy load state data\r\n    const mod = await import('@/lib/stateData');\r\n    const info = mod.stateData[stateCode];\r\n    \r\n    console.log('Loaded state info:', stateCode, info ? 'found' : 'not found');\r\n    \r\n    if (info) {\r\n      // Manage cache: remove oldest if we have 4\r\n      let newOrder = [...stateCacheOrder];\r\n      let newCache = { ...stateCache };\r\n      \r\n      if (newOrder.length >= 4) {\r\n        const oldest = newOrder.shift();\r\n        if (oldest) delete newCache[oldest];\r\n      }\r\n      \r\n      newOrder.push(stateCode);\r\n      newCache[stateCode] = info;\r\n      \r\n      setStateCacheOrder(newOrder);\r\n      setStateCache(newCache);\r\n      setSelectedStateInfo(info);\r\n    }\r\n  }, [stateCache, stateCacheOrder]);\r\n  \r\n  // Performance settings\r\n  const [performanceSettings, setPerformanceSettings] = useState<PerformanceSettings>(DEFAULT_SETTINGS);\r\n  \r\n  // Map height control (percentage)\r\n  const [mapHeightPercent, setMapHeightPercent] = useState(60);\r\n   \r\n  // Flight plan state\r\n  const [flightPlanName, setFlightPlanName] = useState('');\r\n  const [callsign, setCallsign] = useState('');\r\n  const [aircraftType, setAircraftType] = useState('');\r\n  const [pilotName, setPilotName] = useState('');\r\n  const [departureTime, setDepartureTime] = useState('');\r\n  const [cruisingAlt, setCruisingAlt] = useState(5500);\r\n  const [alternateIcao, setAlternateIcao] = useState('');\r\n  const [remarks, setRemarks] = useState('');\r\n  const [soulsOnBoard, setSoulsOnBoard] = useState(1);\r\n  \r\n  // Route waypoints\r\n  const [waypoints, setWaypoints] = useState<Waypoint[]>([]);\r\n  const [departureFuel, setDepartureFuel] = useState(100);\r\n  const [selectedAircraft, setSelectedAircraft] = useState(AIRCRAFT_PROFILES[0]);\r\n  \r\n  // Drag and drop for leg reordering\r\n  const [draggedLegIndex, setDraggedLegIndex] = useState<number | null>(null);\r\n  \r\n  // Fuel data\r\n  const [fuelPrices, setFuelPrices] = useState<Record<string, FuelPrice>>({});\r\n  const [fboFeesData, setFboFeesData] = useState<Record<string, { fee25?: number; fee100?: number; landingFee?: number }>>({});\r\n  \r\n  // State prices will be calculated in LeafletMap component\r\n  \r\n  // Saved flight plans\r\n  const [savedPlans, setSavedPlans] = useState<any[]>([]);\r\n  const [showPlanList, setShowPlanList] = useState(false);\r\n  \r\n  // Auth Modal\r\n  const [authModalOpen, setAuthModalOpen] = useState(false);\r\n  const [authModalAction, setAuthModalAction] = useState<'save' | 'load' | 'export'>('save');\r\n    \r\n  // Upgrade Modal\r\n  const [upgradeModalOpen, setUpgradeModalOpen] = useState(false);\r\n  const [upgradeFeature, setUpgradeFeature] = useState<string>('');\r\n    \r\n  // Tier Explainer Modal (shown on first visit for free users)\r\n  const [showTierExplainer, setShowTierExplainer] = useState(false);\r\n\r\n  // Weather for waypoints\r\n  const [showWeather, setShowWeather] = useState(false);\r\n  const [showWeatherMap, setShowWeatherMap] = useState(false);\r\n  const [segmentWeather, setSegmentWeather] = useState<Record<number, { windSpeed: number; windDir: number; temp: number; impact: number }>>({});\r\n  const [routeWeather, setRouteWeather] = useState<any>(null);\r\n  const [loadingRouteWeather, setLoadingRouteWeather] = useState(false);\r\n  const [waypointWeather, setWaypointWeather] = useState<Record<string, any>>({});\r\n  const [weatherLoading, setWeatherLoading] = useState(false);\r\n\r\n  // Auth\r\n  const { data: session, status } = useSession();\r\n  const [syncOffered, setSyncOffered] = useState(false);\r\n  const [currentPlanId, setCurrentPlanId] = useState<string | null>(null);\r\n  \r\n  // User tier and role - check session for pro/owner, default to free for guests\r\n  const userRole = (session?.user as any)?.role;\r\n  const userTier = (session?.user as any)?.tier || 'free';\r\n\r\n  // Free tier limits\r\n  const FREE_TIER_LIMITS = {\r\n    maxWaypoints: 6,\r\n    maxSavedPlans: 5,\r\n    maxClubs: 1,\r\n    maxAircraft: 3,\r\n  };\r\n\r\n  // Owner or Pro users don't see ads\r\n  const isOwner = userRole === 'owner';\r\n  const isPro = userTier === 'pro' || isOwner;\r\n  const isGuest = status === 'unauthenticated';\r\n\r\n  // Validation for save button\r\n  const canSave = waypoints.length >= 2 && \r\n    (flightPlanName.trim() || \r\n     callsign.trim() || \r\n     pilotName.trim() || \r\n     waypoints[0]?.icao);\r\n\r\n  // Check if we should show the tier explainer on mount\r\n  // Only show for guests (not logged in), not for free/pro/owner users\r\n  useEffect(() => {\r\n    if (typeof window !== 'undefined' && isGuest && !isPro) {\r\n      const seen = localStorage.getItem('hasSeenTierExplainer');\r\n      if (!seen) {\r\n        // Show after a short delay to let the page load\r\n        setTimeout(() => setShowTierExplainer(true), 1500);\r\n      }\r\n    }\r\n  }, [isGuest, isPro]);\r\n  \r\n  // Demo plans flag\r\n  const [demoPlansLoaded, setDemoPlansLoaded] = useState(false);\r\n\r\n  const CURRENT_PLAN_STORAGE_KEY = 'fuelSaverCurrentPlan';\r\n  \r\n  // Get URL params for loading a plan\r\n  const searchParams = useSearchParams();\r\n  \r\n  // Load plan from URL param (shared link)\r\n  useEffect(() => {\r\n    if (typeof window === 'undefined') return;\r\n    \r\n    const urlParams = new URLSearchParams(window.location.search);\r\n    const planParam = urlParams.get('plan');\r\n    \r\n    if (planParam) {\r\n      try {\r\n        const decoded = decodeURIComponent(atob(planParam));\r\n        const planData = JSON.parse(decoded);\r\n        \r\n        if (planData.waypoints && Array.isArray(planData.waypoints)) {\r\n          const loadedWaypoints = planData.waypoints.map((w: any, i: number) => ({\r\n            ...w,\r\n            id: `shared-${i}`,\r\n            sequence: i\r\n          }));\r\n          setWaypoints(loadedWaypoints);\r\n          \r\n          if (loadedWaypoints.length > 0) {\r\n            setMapCenter([loadedWaypoints[0].latitude, loadedWaypoints[0].longitude]);\r\n          }\r\n          \r\n          if (planData.name) {\r\n            setFlightPlanName(planData.name);\r\n          }\r\n        }\r\n      } catch (e) {\r\n        console.error('Error loading shared plan:', e);\r\n      }\r\n    }\r\n  }, []);\r\n   \r\n  // Load plan from URL param when plans are loaded (for database plans)\r\n  useEffect(() => {\r\n    const loadId = searchParams?.get('load');\r\n    if (loadId && savedPlans.length > 0) {\r\n      const planToLoad = savedPlans.find((p: any) => p.id === loadId);\r\n      if (planToLoad) {\r\n        setCurrentPlanId(loadId);\r\n        loadFlightPlan(planToLoad);\r\n      }\r\n    }\r\n  }, [searchParams, savedPlans]);\r\n  \r\n  // Load saved flight plans - localStorage first, then database\r\n  useEffect(() => {\r\n    // Always load from localStorage first (works offline)\r\n    if (typeof window !== 'undefined') {\r\n      const localPlans = localStorage.getItem('savedFlightPlans');\r\n      if (localPlans) {\r\n        try {\r\n          const parsed = JSON.parse(localPlans);\r\n          // Mark local plans with a flag\r\n          const localOnlyPlans = parsed.map((p: any) => ({ ...p, fromLocal: true }));\r\n          setSavedPlans(localOnlyPlans);\r\n        } catch (e) { \r\n          console.error('Error loading local plans:', e); \r\n        }\r\n      }\r\n    }\r\n    \r\n    // If authenticated, load from database and offer to sync\r\n    if (status === 'authenticated' && session?.user?.id) {\r\n      fetch('/api/flight-plans')\r\n        .then(res => res.json())\r\n        .then(data => {\r\n          if (data.flightPlans && data.flightPlans.length > 0) {\r\n            // Merge with local plans (database takes precedence for same plans)\r\n            setSavedPlans(prev => {\r\n              const dbPlans = data.flightPlans.map((p: any) => ({ ...p, fromLocal: false }));\r\n              // Keep any local-only plans\r\n              const localOnly = prev.filter((p: any) => p.fromLocal === true);\r\n              return [...localOnly, ...dbPlans];\r\n            });\r\n            \r\n            // Offer to import local plans if there are any\r\n            const localPlans = typeof window !== 'undefined' ? localStorage.getItem('savedFlightPlans') : null;\r\n            if (localPlans && !syncOffered) {\r\n              const parsed = JSON.parse(localPlans);\r\n              if (parsed.length > 0) {\r\n                // Ask user if they want to import\r\n                const importConfirm = confirm(`You have ${parsed.length} flight plan(s) saved locally. Import them to your account?`);\r\n                if (importConfirm) {\r\n                  // Import each local plan to database\r\n                  parsed.forEach(async (plan: any) => {\r\n                    await fetch('/api/flight-plans', {\r\n                      method: 'POST',\r\n                      headers: { 'Content-Type': 'application/json' },\r\n                      body: JSON.stringify(plan)\r\n                    });\r\n                  });\r\n                  // Clear local storage after import\r\n                  localStorage.removeItem('savedFlightPlans');\r\n                  setSyncOffered(true);\r\n                  // Reload from database\r\n                  window.location.reload();\r\n                }\r\n              }\r\n              setSyncOffered(true);\r\n            }\r\n          }\r\n        })\r\n        .catch(err => console.error('Error loading plans:', err));\r\n    }\r\n  }, [status, session, syncOffered]);\r\n  \r\n  // Load fuel prices from localStorage on mount\r\n  useEffect(() => {\r\n    if (typeof window !== 'undefined') {\r\n      const saved = localStorage.getItem('fuelPrices');\r\n      if (saved) {\r\n        try {\r\n          setFuelPrices(JSON.parse(saved));\r\n        } catch (e) { console.error('Error loading fuel prices:', e); }\r\n      }\r\n      \r\n      // Load FBO fees from localStorage\r\n      const savedFbo = localStorage.getItem('fboFees');\r\n      if (savedFbo) {\r\n        try {\r\n          setFboFeesData(JSON.parse(savedFbo));\r\n        } catch (e) { console.error('Error loading FBO fees:', e); }\r\n      }\r\n    }\r\n  }, []);\r\n  \r\n  // Save fuel prices to localStorage when they change\r\n  useEffect(() => {\r\n    if (typeof window !== 'undefined' && Object.keys(fuelPrices).length > 0) {\r\n      localStorage.setItem('fuelPrices', JSON.stringify(fuelPrices));\r\n    }\r\n  }, [fuelPrices]);\r\n  \r\n  // Save FBO fees to localStorage when they change\r\n  useEffect(() => {\r\n    if (typeof window !== 'undefined' && Object.keys(fboFeesData).length > 0) {\r\n      localStorage.setItem('fboFees', JSON.stringify(fboFeesData));\r\n    }\r\n  }, [fboFeesData]);\r\n  \r\n  // Load saved flight plans from localStorage on mount\r\n  useEffect(() => {\r\n    if (typeof window !== 'undefined') {\r\n      const saved = localStorage.getItem('savedFlightPlans');\r\n      if (saved) {\r\n        try {\r\n          const parsed = JSON.parse(saved);\r\n          // Add demo plans if no saved plans exist\r\n          if (parsed.length === 0 && !demoPlansLoaded) {\r\n            setSavedPlans(DEMO_FLIGHT_PLANS);\r\n            setDemoPlansLoaded(true);\r\n          } else {\r\n            setSavedPlans(parsed);\r\n          }\r\n        } catch (e) { \r\n          console.error('Error loading flight plans:', e); \r\n          // Show demo plans on error\r\n          if (!demoPlansLoaded) {\r\n            setSavedPlans(DEMO_FLIGHT_PLANS);\r\n            setDemoPlansLoaded(true);\r\n          }\r\n        }\r\n      } else {\r\n        // No saved plans - show demo plans\r\n        if (!demoPlansLoaded) {\r\n          setSavedPlans(DEMO_FLIGHT_PLANS);\r\n          setDemoPlansLoaded(true);\r\n        }\r\n      }\r\n    }\r\n  }, [demoPlansLoaded]);\r\n  \r\n  // Save flight plans to localStorage\r\n  const saveToLocalStorage = (plans: any[]) => {\r\n    if (typeof window !== 'undefined') {\r\n      localStorage.setItem('savedFlightPlans', JSON.stringify(plans));\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (typeof window === 'undefined') return;\r\n\r\n    if (waypoints.length < 2) {\r\n      localStorage.removeItem(CURRENT_PLAN_STORAGE_KEY);\r\n      window.dispatchEvent(new CustomEvent('fuel-saver-plan-updated'));\r\n      return;\r\n    }\r\n\r\n    const relevantFuelPrices: Record<string, FuelPrice> = {};\r\n    waypoints.forEach((wp) => {\r\n      if (wp?.icao && fuelPrices[wp.icao]) {\r\n        relevantFuelPrices[wp.icao] = fuelPrices[wp.icao];\r\n      }\r\n    });\r\n\r\n    const currentPlan = {\r\n      name: flightPlanName?.trim() || undefined,\r\n      waypoints: waypoints.map((wp) => ({\r\n        icao: wp.icao,\r\n        name: wp.name,\r\n        latitude: wp.latitude,\r\n        longitude: wp.longitude,\r\n      })),\r\n      aircraft: {\r\n        name: selectedAircraft.name,\r\n        speed: selectedAircraft.speed,\r\n        burnRate: selectedAircraft.burnRate,\r\n        fuelCapacity: selectedAircraft.fuelCapacity,\r\n      },\r\n      cruisingAltitude: cruisingAlt,\r\n      fuelPrices: relevantFuelPrices,\r\n      updatedAt: new Date().toISOString(),\r\n    };\r\n\r\n    localStorage.setItem(CURRENT_PLAN_STORAGE_KEY, JSON.stringify(currentPlan));\r\n    window.dispatchEvent(new CustomEvent('fuel-saver-plan-updated'));\r\n  }, [waypoints, selectedAircraft, cruisingAlt, fuelPrices, flightPlanName]);\r\n\r\n  // Demo flight plans for users who want to try it out\r\n  const DEMO_FLIGHT_PLANS = [\r\n    {\r\n      id: 'demo-1',\r\n      name: 'California Coast Hop',\r\n      callsign: 'N12345',\r\n      aircraftType: 'Cessna 172S (2022)',\r\n      pilotName: 'Demo Pilot',\r\n      departureTime: '2026-02-20T08:00',\r\n      cruisingAlt: 5500,\r\n      alternateIcao: 'KSMO',\r\n      remarks: 'Scenic coastal flight',\r\n      soulsOnBoard: 2,\r\n      departureFuel: 100,\r\n      departureIcao: 'KVNY',\r\n      arrivalIcao: 'KSFO',\r\n      waypoints: [\r\n        { icao: 'KVNY', name: 'Van Nuys Airport', city: 'Van Nuys', latitude: 34.2098, longitude: -118.4895, sequence: 0 },\r\n        { icao: 'KLAX', name: 'Los Angeles International', city: 'Los Angeles', latitude: 33.9425, longitude: -118.4081, sequence: 1 },\r\n        { icao: 'KSMF', name: 'Sacramento International', city: 'Sacramento', latitude: 38.6954, longitude: -121.5908, sequence: 2 },\r\n        { icao: 'KSFO', name: 'San Francisco International', city: 'San Francisco', latitude: 37.6213, longitude: -122.379, sequence: 3 },\r\n      ],\r\n      isDemo: true,\r\n      createdAt: '2026-01-15T10:00:00Z'\r\n    },\r\n    {\r\n      id: 'demo-2',\r\n      name: 'Texas Cross Country',\r\n      callsign: 'N98765',\r\n      aircraftType: 'Cessna 182T (2020)',\r\n      pilotName: 'Demo Pilot',\r\n      departureTime: '2026-02-21T09:00',\r\n      cruisingAlt: 6500,\r\n      alternateIcao: 'KDTO',\r\n      remarks: 'Austin to Dallas',\r\n      soulsOnBoard: 3,\r\n      departureFuel: 100,\r\n      departureIcao: 'KAUS',\r\n      arrivalIcao: 'KDFW',\r\n      waypoints: [\r\n        { icao: 'KAUS', name: 'Austin-Bergstrom International', city: 'Austin', latitude: 30.1945, longitude: -97.6699, sequence: 0 },\r\n        { icao: 'KTIW', name: 'Tulip Field', city: 'Cameron', latitude: 30.8791, longitude: -96.9769, sequence: 1 },\r\n        { icao: 'KCFD', name: 'Caddo Mills Municipal', city: 'Caddo Mills', latitude: 33.0362, longitude: -96.2414, sequence: 2 },\r\n        { icao: 'KDFW', name: 'Dallas/Fort Worth International', city: 'Dallas', latitude: 32.8998, longitude: -97.0403, sequence: 3 },\r\n      ],\r\n      isDemo: true,\r\n      createdAt: '2026-01-20T14:30:00Z'\r\n    },\r\n    {\r\n      id: 'demo-3',\r\n      name: 'Florida Fun',\r\n      callsign: 'N11111',\r\n      aircraftType: 'Piper Cherokee Six (2020)',\r\n      pilotName: 'Demo Pilot',\r\n      departureTime: '2026-02-22T07:30',\r\n      cruisingAlt: 4500,\r\n      alternateIcao: 'KMIA',\r\n      remarks: 'Tampa to Miami scenic',\r\n      soulsOnBoard: 4,\r\n      departureFuel: 100,\r\n      departureIcao: 'KTPA',\r\n      arrivalIcao: 'KMIA',\r\n      waypoints: [\r\n        { icao: 'KTPA', name: 'Tampa International', city: 'Tampa', latitude: 27.9755, longitude: -82.5332, sequence: 0 },\r\n        { icao: 'KOPF', name: 'Opa Locka Executive', city: 'Miami', latitude: 25.907, longitude: -80.2586, sequence: 1 },\r\n        { icao: 'KMIA', name: 'Miami International', city: 'Miami', latitude: 25.7959, longitude: -80.287, sequence: 2 },\r\n      ],\r\n      isDemo: true,\r\n      createdAt: '2026-01-25T09:15:00Z'\r\n    }\r\n  ];\r\n\r\n  // Search state\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [searchResults, setSearchResults] = useState<Airport[]>([]);\r\n  const [showSearchResults, setShowSearchResults] = useState(false);\r\n  \r\n  // Panel visibility\r\n  const [showPanel, setShowPanel] = useState(true);\r\n  const [showOrientationWarning, setShowOrientationWarning] = useState(false);\r\n  const [orientationDismissed, setOrientationDismissed] = useState(false);\r\n  const [activeTab, setActiveTab] = useState<'details' | 'waypoints' | 'wb' | 'info' | 'e6b'>('details');\r\n  const [tabIndex, setTabIndex] = useState(0);\r\n  \r\n  // E6B Calculator state\r\n  const [e6bHeading, setE6bHeading] = useState(360);\r\n  const [e6bWindspeed, setE6bWindspeed] = useState(15);\r\n  const [e6bWindDir, setE6bWindDir] = useState(270);\r\n  const [e6bTAS, setE6bTAS] = useState(120);\r\n  const [e6bResult, setE6bResult] = useState<{ groundSpeed: number; windCorrection: number; track: number } | null>(null);\r\n  \r\n  // Weight & Balance state\r\n  const [wbFrontPax, setWbFrontPax] = useState(170);\r\n  const [wbRearPax1, setWbRearPax1] = useState(170);\r\n  const [wbRearPax2, setWbRearPax2] = useState(0);\r\n  const [wbBaggage1, setWbBaggage1] = useState(0);\r\n  const [wbBaggage2, setWbBaggage2] = useState(0);\r\n  const [wbFuel, setWbFuel] = useState(40);\r\n  \r\n  // Total trip cost settings\r\n  const [includeLandingFees, setIncludeLandingFees] = useState(true);\r\n  const [includeFboFees, setIncludeFboFees] = useState(true);\r\n  \r\n  const tabs = [\r\n    { id: 'details', label: 'ðŸ“‹ Details' },\r\n    { id: 'waypoints', label: 'ðŸ“ Route' },\r\n    { id: 'wb', label: 'âš–ï¸ W&B' },\r\n    { id: 'e6b', label: 'ðŸ”§ Tools' },\r\n    { id: 'info', label: 'ðŸŒ¤ Weather' }\r\n  ];\r\n  \r\n  // E6B Wind Correction calculation\r\n  const calculateE6B = () => {\r\n    const headingRad = (e6bHeading * Math.PI) / 180;\r\n    const windRad = (e6bWindDir * Math.PI) / 180;\r\n    const ws = e6bWindspeed;\r\n    const tas = e6bTAS;\r\n    \r\n    // Wind components\r\n    const windFrom = (windRad + Math.PI); // wind FROM direction\r\n    const wx = ws * Math.cos(windFrom);\r\n    const wy = ws * Math.sin(windFrom);\r\n    \r\n    // Ground speed vector\r\n    const gsx = tas * Math.cos(headingRad) - wx;\r\n    const gsy = tas * Math.sin(headingRad) - wy;\r\n    \r\n    const groundSpeed = Math.sqrt(gsx * gsx + gsy * gsy);\r\n    const track = ((Math.atan2(gsy, gsx) * 180) / Math.PI + 360) % 360;\r\n    const windCorrection = track - e6bHeading;\r\n    \r\n    setE6bResult({\r\n      groundSpeed: Math.round(groundSpeed),\r\n      windCorrection: Math.round(windCorrection),\r\n      track: Math.round(track)\r\n    });\r\n  };\r\n  \r\n  // Cached airports - accumulates as user pans around\r\n  const [cachedAirports, setCachedAirports] = useState<Airport[]>([]);\r\n  const [allUSAirportsLoaded, setAllUSAirportsLoaded] = useState(false);\r\n  \r\n  // Pre-load all US airports on first load\r\n  useEffect(() => {\r\n    if (allUSAirportsLoaded) return;\r\n    \r\n    const cached = getCachedData<Airport[]>('allUSAirports');\r\n    if (cached && cached.length > 0) {\r\n      setCachedAirports(cached);\r\n      // Load more airports initially so they're visible\r\n      setAirports(cached.slice(0, 300));\r\n      setAllUSAirportsLoaded(true);\r\n      // Fit to show all airports\r\n      if (cached.length > 0) {\r\n        const lats = cached.slice(0, 300).map(a => a.latitude).filter(Boolean);\r\n        const lons = cached.slice(0, 300).map(a => a.longitude).filter(Boolean);\r\n        if (lats.length > 0) {\r\n          const minLat = Math.min(...lats);\r\n          const maxLat = Math.max(...lats);\r\n          const minLon = Math.min(...lons);\r\n          const maxLon = Math.max(...lons);\r\n          setMapCenter([(minLat + maxLat) / 2, (minLon + maxLon) / 2]);\r\n          setMapZoom(5);\r\n        }\r\n      }\r\n      return;\r\n    }\r\n    \r\n    // Fetch all US airports (large + medium)\r\n    fetch('/api/airports?country=US&limit=10000')\r\n      .then(r => r.json())\r\n      .then(data => {\r\n        if (data.airports) {\r\n          const all = data.airports as Airport[];\r\n          setCachedAirports(all);\r\n          setAirports(all.slice(0, 300));\r\n          setCachedData('allUSAirports', all);\r\n          setAllUSAirportsLoaded(true);\r\n          // Fit to show airports\r\n          const lats = all.slice(0, 300).map(a => a.latitude).filter(Boolean);\r\n          const lons = all.slice(0, 300).map(a => a.longitude).filter(Boolean);\r\n          if (lats.length > 0) {\r\n            const minLat = Math.min(...lats);\r\n            const maxLat = Math.max(...lats);\r\n            const minLon = Math.min(...lons);\r\n            const maxLon = Math.max(...lons);\r\n            setMapCenter([(minLat + maxLat) / 2, (minLon + maxLon) / 2]);\r\n            setMapZoom(5);\r\n          }\r\n        }\r\n      })\r\n      .catch(console.error);\r\n  }, [allUSAirportsLoaded]);\r\n  \r\n  // Fetch airports when map bounds change - with caching\r\n  useEffect(() => {\r\n    if (!mapLoaded) return;\r\n    \r\n    const fetchAirports = async () => {\r\n      setLoadingAirports(true);\r\n      try {\r\n        const sizeParam = showAllAirports ? 'seaplane' : 'medium';\r\n        const res = await fetch(\r\n          `/api/airports/bounds?minLat=${mapBounds.minLat}&maxLat=${mapBounds.maxLat}&minLon=${mapBounds.minLon}&maxLon=${mapBounds.maxLon}&minSize=${sizeParam}&limit=100&country=US`\r\n        );\r\n        const data = await res.json();\r\n        if (data.airports && data.airports.length > 0) {\r\n          // Merge with cached airports (avoid duplicates)\r\n          setCachedAirports(prev => {\r\n            const existing = new Set(prev.map(a => a.icao));\r\n            const newOnes = data.airports.filter((a: Airport) => !existing.has(a.icao));\r\n            const allAirports = [...prev, ...newOnes];\r\n            // Show airports in current view\r\n            const inView = allAirports.filter(a => \r\n              a.latitude >= mapBounds.minLat - 2 && \r\n              a.latitude <= mapBounds.maxLat + 2 &&\r\n              a.longitude >= mapBounds.minLon - 2 && \r\n              a.longitude <= mapBounds.maxLon + 2\r\n            );\r\n            setAirports(inView);\r\n            return allAirports;\r\n          });\r\n        }\r\n      } catch (e) {\r\n        console.error('Error fetching airports:', e);\r\n        // Fallback to demo airports\r\n        setAirports(DEMO_AIRPORTS.slice(0, 20));\r\n      }\r\n      setLoadingAirports(false);\r\n    };\r\n    \r\n    fetchAirports();\r\n  }, [mapBounds, showAllAirports, mapLoaded]);\r\n\r\n  // Fetch fuel prices for waypoints\r\n  useEffect(() => {\r\n    const fetchPrices = async () => {\r\n      for (const wp of waypoints) {\r\n        if (!fuelPrices[wp.icao]) {\r\n          const price = await getFuelPrice(wp.icao);\r\n          if (price) {\r\n            setFuelPrices(prev => ({ ...prev, [wp.icao]: price }));\r\n          }\r\n        }\r\n      }\r\n    };\r\n    if (waypoints.length > 0) {\r\n      fetchPrices();\r\n    }\r\n  }, [waypoints]);\r\n\r\n  // Handle user fuel price submissions\r\n  useEffect(() => {\r\n    const handleSubmitFuelPrice = async (event: Event) => {\r\n      const customEvent = event as CustomEvent;\r\n      const { icao, price, fuelType } = customEvent.detail;\r\n      \r\n      try {\r\n        const res = await fetch('/api/fuel', {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({\r\n            icao,\r\n            fuelType,\r\n            price,\r\n            source: 'user'\r\n          })\r\n        });\r\n        \r\n        if (res.ok) {\r\n          // Update local state\r\n          setFuelPrices(prev => ({\r\n            ...prev,\r\n            [icao]: {\r\n              ...prev[icao],\r\n              icao,\r\n              price100ll: fuelType === '100LL' ? price : (prev[icao]?.price100ll || null),\r\n              priceJetA: fuelType === 'JetA' ? price : (prev[icao]?.priceJetA || null),\r\n              lastUpdated: new Date().toISOString(),\r\n              source: 'user'\r\n            }\r\n          }));\r\n        }\r\n      } catch (e) {\r\n        console.error('Error submitting fuel price:', e);\r\n      }\r\n    };\r\n    \r\n    window.addEventListener('submitFuelPrice', handleSubmitFuelPrice);\r\n    return () => window.removeEventListener('submitFuelPrice', handleSubmitFuelPrice);\r\n  }, []);\r\n\r\n  // Debounced search ref\r\n  const searchTimeoutRef = useRef<NodeJS.Timeout | null>(null);\r\n\r\n  // Search airports - searches demo + loaded + cached airports\r\n  const handleSearch = useCallback((query: string) => {\r\n    setSearchQuery(query);\r\n    \r\n    // Clear previous timeout\r\n    if (searchTimeoutRef.current) {\r\n      clearTimeout(searchTimeoutRef.current);\r\n    }\r\n    \r\n    if (query.length >= 2) {\r\n      // Debounce search by 150ms\r\n      searchTimeoutRef.current = setTimeout(() => {\r\n        const q = query.toUpperCase();\r\n        // Search demo airports\r\n        const demoResults = DEMO_AIRPORTS.filter(a =>\r\n          a.icao.includes(q) || a.iata?.includes(q) || \r\n          a.name.toUpperCase().includes(q) || a.city?.toUpperCase().includes(q)\r\n        );\r\n        // Search current airports from map\r\n        const mapResults = airports.filter(a =>\r\n          a.icao.toUpperCase().includes(q) || a.iata?.toUpperCase().includes(q) || \r\n          a.name.toUpperCase().includes(q) || a.city?.toUpperCase().includes(q)\r\n        );\r\n        // Search cached airports (accumulated from panning)\r\n        const cachedResults = cachedAirports.filter(a =>\r\n          a.icao.toUpperCase().includes(q) || a.iata?.toUpperCase().includes(q) || \r\n          a.name.toUpperCase().includes(q) || a.city?.toUpperCase().includes(q)\r\n        );\r\n        // Combine and dedupe, then filter by region if international is disabled\r\n        const combined = [...demoResults];\r\n        const seen = new Set(combined.map(a => a.icao));\r\n        for (const a of [...mapResults, ...cachedResults]) {\r\n          if (!seen.has(a.icao)) {\r\n            // Only include if in North America or international is enabled\r\n            if (showInternational || isNorthAmerica(a)) {\r\n              seen.add(a.icao);\r\n              combined.push(a);\r\n            }\r\n          }\r\n        }\r\n        setSearchResults(combined.slice(0, 10));\r\n        setShowSearchResults(true);\r\n      }, 150);\r\n    } else {\r\n      setSearchResults([]);\r\n      setShowSearchResults(false);\r\n    }\r\n  }, [airports, cachedAirports, showInternational]);\r\n\r\n  // Cleanup timeout on unmount\r\n  useEffect(() => {\r\n    return () => {\r\n      if (searchTimeoutRef.current) {\r\n        clearTimeout(searchTimeoutRef.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  // Check for mobile and orientation\r\n  useEffect(() => {\r\n    const checkOrientation = () => {\r\n      const isMobile = window.innerWidth < 768;\r\n      const isPortrait = window.innerHeight > window.innerWidth;\r\n      \r\n      if (isMobile && isPortrait && !orientationDismissed) {\r\n        setShowOrientationWarning(true);\r\n      } else {\r\n        setShowOrientationWarning(false);\r\n      }\r\n    };\r\n\r\n    checkOrientation();\r\n    window.addEventListener('resize', checkOrientation);\r\n    window.addEventListener('orientationchange', checkOrientation);\r\n    \r\n    return () => {\r\n      window.removeEventListener('resize', checkOrientation);\r\n      window.removeEventListener('orientationchange', checkOrientation);\r\n    };\r\n  }, [orientationDismissed]);\r\n\r\n  // Add waypoint\r\n  const addWaypoint = (airport: Airport, index?: number) => {\r\n    // Check if already in route\r\n    if (waypoints.find(w => w.icao === airport.icao)) {\r\n      alert('Airport already in route');\r\n      return;\r\n    }\r\n\r\n    // Check free tier limit for waypoints\r\n    if (!isPro && waypoints.length >= FREE_TIER_LIMITS.maxWaypoints) {\r\n      setUpgradeFeature('More than 6 waypoints');\r\n      setUpgradeModalOpen(true);\r\n      return;\r\n    }\r\n\r\n    const wp: Waypoint = {\r\n      id: crypto.randomUUID(),\r\n      icao: airport.icao,\r\n      name: airport.name,\r\n      city: airport.city,\r\n      state: (airport as any).state,\r\n      latitude: airport.latitude,\r\n      longitude: airport.longitude,\r\n      sequence: index ?? waypoints.length,\r\n      type: airport.type\r\n    };\r\n    \r\n    if (index !== undefined) {\r\n      const newWaypoints = [...waypoints];\r\n      newWaypoints.splice(index, 0, wp);\r\n      setWaypoints(newWaypoints.map((w, i) => ({ ...w, sequence: i })));\r\n    } else {\r\n      setWaypoints([...waypoints, wp]);\r\n    }\r\n    \r\n    // Center map on new waypoint\r\n    setMapCenter([airport.latitude, airport.longitude]);\r\n    setMapZoom(8);\r\n    setSearchQuery('');\r\n    setShowSearchResults(false);\r\n  };\r\n\r\n  // Remove waypoint\r\n  const removeWaypoint = (id: string) => {\r\n    setWaypoints(waypoints.filter(w => w.id !== id).map((w, i) => ({ ...w, sequence: i })));\r\n  };\r\n\r\n  // Optimize route for shortest total distance (simple nearest neighbor)\r\n  const optimizeRoute = () => {\r\n    if (waypoints.length <= 2) return;\r\n    \r\n    const unvisited = waypoints.slice(1, waypoints.length - 1); // Keep first and last\r\n    const optimized: Waypoint[] = [waypoints[0]];\r\n    \r\n    let current = waypoints[0];\r\n    while (unvisited.length > 0) {\r\n      let nearestIdx = 0;\r\n      let nearestDist = Infinity;\r\n      \r\n      unvisited.forEach((wp, idx) => {\r\n        const dist = calculateDistance(current.latitude, current.longitude, wp.latitude, wp.longitude);\r\n        if (dist < nearestDist) {\r\n          nearestDist = dist;\r\n          nearestIdx = idx;\r\n        }\r\n      });\r\n      \r\n      const nearest = unvisited.splice(nearestIdx, 1)[0];\r\n      optimized.push(nearest);\r\n      current = nearest;\r\n    }\r\n    \r\n    optimized.push(waypoints[waypoints.length - 1]); // Add last\r\n    \r\n    setWaypoints(optimized.map((w, i) => ({ ...w, sequence: i })));\r\n  };\r\n\r\n  // Toggle round trip (add first airport to end, or remove if already there)\r\n  const toggleRoundTrip = () => {\r\n    const first = waypoints[0];\r\n    const last = waypoints[waypoints.length - 1];\r\n    \r\n    if (first.icao === last.icao) {\r\n      // Already round trip - remove duplicate\r\n      setWaypoints(waypoints.slice(0, -1).map((w, i) => ({ ...w, sequence: i })));\r\n    } else {\r\n      // Add first airport to end\r\n      const returnWp: Waypoint = {\r\n        ...first,\r\n        id: crypto.randomUUID(),\r\n        sequence: waypoints.length\r\n      };\r\n      setWaypoints([...waypoints, returnWp]);\r\n    }\r\n  };\r\n\r\n  // Fit map to show all waypoints\r\n  const fitMapToWaypoints = () => {\r\n    if (waypoints.length === 0) return;\r\n    if (waypoints.length === 1) {\r\n      setMapCenter([waypoints[0].latitude, waypoints[0].longitude]);\r\n      setMapZoom(10);\r\n      return;\r\n    }\r\n    \r\n    let minLat = Infinity, maxLat = -Infinity;\r\n    let minLon = Infinity, maxLon = -Infinity;\r\n    \r\n    waypoints.forEach(wp => {\r\n      minLat = Math.min(minLat, wp.latitude);\r\n      maxLat = Math.max(maxLat, wp.latitude);\r\n      minLon = Math.min(minLon, wp.longitude);\r\n      maxLon = Math.max(maxLon, wp.longitude);\r\n    });\r\n    \r\n    const centerLat = (minLat + maxLat) / 2;\r\n    const centerLon = (minLon + maxLon) / 2;\r\n    \r\n    setMapCenter([centerLat, centerLon]);\r\n    \r\n    // Calculate zoom to fit\r\n    const latDiff = maxLat - minLat;\r\n    const lonDiff = maxLon - minLon;\r\n    const maxDiff = Math.max(latDiff, lonDiff);\r\n    \r\n    let zoom = 8;\r\n    if (maxDiff < 0.5) zoom = 12;\r\n    else if (maxDiff < 1) zoom = 10;\r\n    else if (maxDiff < 2) zoom = 9;\r\n    else if (maxDiff < 5) zoom = 7;\r\n    else if (maxDiff < 10) zoom = 6;\r\n    else zoom = 5;\r\n    \r\n    setMapZoom(zoom);\r\n  };\r\n\r\n  // Move waypoint\r\n  const moveWaypoint = (id: string, direction: 'up' | 'down') => {\r\n    const index = waypoints.findIndex(w => w.id === id);\r\n    if (index < 0) return;\r\n    \r\n    const newIndex = direction === 'up' ? index - 1 : index + 1;\r\n    if (newIndex < 0 || newIndex >= waypoints.length) return;\r\n    \r\n    const newWaypoints = [...waypoints];\r\n    [newWaypoints[index], newWaypoints[newIndex]] = [newWaypoints[newIndex], newWaypoints[index]];\r\n    setWaypoints(newWaypoints.map((w, i) => ({ ...w, sequence: i })));\r\n  };\r\n\r\n  // Parse GPX file\r\n  const parseGPX = (content: string) => {\r\n    const parser = new DOMParser();\r\n    const doc = parser.parseFromString(content, 'text/xml');\r\n    const wpts = doc.querySelectorAll('wpt');\r\n    \r\n    const newWaypoints: Waypoint[] = [];\r\n    wpts.forEach((wpt, i) => {\r\n      const lat = parseFloat(wpt.getAttribute('lat') || '0');\r\n      const lon = parseFloat(wpt.getAttribute('lon') || '0');\r\n      const name = wpt.querySelector('name')?.textContent || `WPT${i + 1}`;\r\n      const ele = wpt.querySelector('ele')?.textContent;\r\n      \r\n      // Try to find matching airport in our DB\r\n      const matchingAirport = DEMO_AIRPORTS.find(a => \r\n        a.icao.toUpperCase() === name.toUpperCase().substring(0, 4)\r\n      );\r\n      \r\n      newWaypoints.push({\r\n        id: crypto.randomUUID(),\r\n        icao: matchingAirport?.icao || name.substring(0, 4),\r\n        name: matchingAirport?.name || name,\r\n        latitude: matchingAirport?.latitude || lat,\r\n        longitude: matchingAirport?.longitude || lon,\r\n        altitude: ele ? parseInt(ele) : undefined,\r\n        sequence: i\r\n      });\r\n    });\r\n    \r\n    if (newWaypoints.length > 0) {\r\n      setWaypoints(newWaypoints);\r\n      // Center on first waypoint\r\n      setMapCenter([newWaypoints[0].latitude, newWaypoints[0].longitude]);\r\n      setMapZoom(8);\r\n    }\r\n  };\r\n\r\n  // Parse FPL file (simple parsing)\r\n  const parseFPL = (content: string) => {\r\n    const lines = content.split('\\n');\r\n    const newWaypoints: Waypoint[] = [];\r\n    let seq = 0;\r\n    \r\n    for (const line of lines) {\r\n      // Look for waypoint patterns (5-letter names or airport codes)\r\n      const match = line.match(/([A-Z]{4,5})/g);\r\n      if (match) {\r\n        for (const wpId of match) {\r\n          const airport = DEMO_AIRPORTS.find(a => \r\n            a.icao === wpId || a.iata === wpId\r\n          );\r\n          if (airport) {\r\n            newWaypoints.push({\r\n              id: crypto.randomUUID(),\r\n              icao: airport.icao,\r\n              name: airport.name,\r\n              city: airport.city,\r\n              latitude: airport.latitude,\r\n              longitude: airport.longitude,\r\n              sequence: seq++\r\n            });\r\n          }\r\n        }\r\n      }\r\n    }\r\n    \r\n    if (newWaypoints.length > 0) {\r\n      setWaypoints(newWaypoints);\r\n      setMapCenter([newWaypoints[0].latitude, newWaypoints[0].longitude]);\r\n      setMapZoom(8);\r\n    }\r\n  };\r\n\r\n  // Parse flightplandatabase.com JSON format\r\n  const parseFPDBJson = async (content: string) => {\r\n    try {\r\n      const data = JSON.parse(content);\r\n      const newWaypoints: Waypoint[] = [];\r\n      \r\n      // Handle flightplandatabase.com JSON format\r\n      // The route is in data.route as array of waypoints\r\n      const route = data.route || data.plan?.route || [];\r\n      \r\n      for (const wp of route) {\r\n        // Each waypoint can have: id, name, type, lat, lon, airway\r\n        const lat = wp.lat || wp.latitude;\r\n        const lon = wp.lon || wp.longitude;\r\n        const icao = wp.id || wp.icao || wp.name;\r\n        \r\n        // Try to find airport in our database\r\n        let airport = DEMO_AIRPORTS.find(a => a.icao === icao?.substring(0, 4));\r\n        \r\n        if (airport || (lat && lon)) {\r\n          newWaypoints.push({\r\n            id: crypto.randomUUID(),\r\n            icao: airport?.icao || icao?.substring(0, 4) || 'WAYPT',\r\n            name: airport?.name || icao || 'Waypoint',\r\n            city: airport?.city,\r\n            latitude: airport?.latitude || lat,\r\n            longitude: airport?.longitude || lon,\r\n            sequence: newWaypoints.length\r\n          });\r\n        }\r\n      }\r\n      \r\n      if (newWaypoints.length > 0) {\r\n        setWaypoints(newWaypoints);\r\n        setMapCenter([newWaypoints[0].latitude, newWaypoints[0].longitude]);\r\n        setMapZoom(6);\r\n        return true;\r\n      }\r\n    } catch (e) {\r\n      console.error('Error parsing FPDB JSON:', e);\r\n    }\r\n    return false;\r\n  };\r\n\r\n  // Parse flightplandatabase.com CSV format\r\n  const parseFPDBCSV = (content: string) => {\r\n    try {\r\n      const lines = content.split('\\n');\r\n      const newWaypoints: Waypoint[] = [];\r\n      \r\n      // Skip header if present, find waypoint data\r\n      for (const line of lines) {\r\n        const parts = line.split(',').map(p => p.trim().replace(/\"/g, ''));\r\n        if (parts.length < 3) continue;\r\n        \r\n        // Try to extract waypoint info - format varies\r\n        // Could be: id,type,lat,lon,airway or waypoint,lat,lon,alt,etc.\r\n        let lat: number | undefined, lon: number | undefined, icao: string | undefined;\r\n        \r\n        // Try to find lat/lon in the line\r\n        for (let i = 0; i < parts.length; i++) {\r\n          const val = parseFloat(parts[i]);\r\n          if (!isNaN(val)) {\r\n            if (val >= -90 && val <= 90 && !lat) lat = val;\r\n            else if (val >= -180 && val <= 180 && !lon) lon = val;\r\n          }\r\n          // Look for 4-letter ICAO codes\r\n          if (parts[i].match(/^[A-Z]{4}$/)) {\r\n            icao = parts[i];\r\n          }\r\n        }\r\n        \r\n        if (lat && lon) {\r\n          const airport = DEMO_AIRPORTS.find(a => a.icao === icao);\r\n          newWaypoints.push({\r\n            id: crypto.randomUUID(),\r\n            icao: airport?.icao || icao || `WPT${newWaypoints.length}`,\r\n            name: airport?.name || icao || 'Waypoint',\r\n            city: airport?.city,\r\n            latitude: airport?.latitude || lat,\r\n            longitude: airport?.longitude || lon,\r\n            sequence: newWaypoints.length\r\n          });\r\n        }\r\n      }\r\n      \r\n      if (newWaypoints.length > 0) {\r\n        setWaypoints(newWaypoints);\r\n        setMapCenter([newWaypoints[0].latitude, newWaypoints[0].longitude]);\r\n        setMapZoom(6);\r\n        return true;\r\n      }\r\n    } catch (e) {\r\n      console.error('Error parsing FPDB CSV:', e);\r\n    }\r\n    return false;\r\n  };\r\n\r\n  // Import from flightplandatabase.com by plan ID\r\n  const importFromFPDB = async (planId: string) => {\r\n    try {\r\n      // Fetch from flightplandatabase.com API (public endpoint)\r\n      const res = await fetch(`https://flightplandatabase.com/api/plan/${planId}?format=json`);\r\n      if (!res.ok) {\r\n        alert('Plan not found. Check the plan ID.');\r\n        return;\r\n      }\r\n      const data = await res.json();\r\n      \r\n      // Parse the route from FPDB format\r\n      const newWaypoints: Waypoint[] = [];\r\n      const route = data.route || [];\r\n      \r\n      for (const wp of route) {\r\n        const lat = wp.lat;\r\n        const lon = wp.lon;\r\n        const waypointId = wp.id;\r\n        \r\n        // Try to find airport in our database\r\n        const airport = DEMO_AIRPORTS.find(a => a.icao === waypointId?.substring(0, 4));\r\n        \r\n        if (airport || (lat && lon)) {\r\n          newWaypoints.push({\r\n            id: crypto.randomUUID(),\r\n            icao: airport?.icao || waypointId?.substring(0, 4) || 'WAYPT',\r\n            name: airport?.name || waypointId || 'Waypoint',\r\n            city: airport?.city,\r\n            latitude: airport?.latitude || lat,\r\n            longitude: airport?.longitude || lon,\r\n            sequence: newWaypoints.length\r\n          });\r\n        }\r\n      }\r\n      \r\n      if (newWaypoints.length > 0) {\r\n        setWaypoints(newWaypoints);\r\n        setMapCenter([newWaypoints[0].latitude, newWaypoints[0].longitude]);\r\n        setMapZoom(6);\r\n        \r\n        // Also fill in flight plan details if available\r\n        if (data.origin) {\r\n          setDepartureTime(data.departureTime || '');\r\n        }\r\n        if (data.altitude) {\r\n          setCruisingAlt(data.altitude);\r\n        }\r\n        \r\n        alert(`Imported ${newWaypoints.length} waypoints from flightplandatabase.com!`);\r\n      } else {\r\n        alert('No waypoints found in this plan.');\r\n      }\r\n    } catch (e) {\r\n      console.error('Error importing from FPDB:', e);\r\n      alert('Failed to import plan. Make sure the plan ID is correct.');\r\n    }\r\n  };\r\n\r\n  // Parse simple route string (comma or space separated ICAOs)\r\n  const parseRouteString = (content: string) => {\r\n    const newWaypoints: Waypoint[] = [];\r\n    \r\n    // Split by comma, space, or newline\r\n    const tokens = content.split(/[,\\s\\n]+/).filter(t => t.length >= 3 && t.length <= 5);\r\n    \r\n    for (const token of tokens) {\r\n      const icao = token.toUpperCase().replace(/[^A-Z]/g, '').substring(0, 4);\r\n      if (icao.length < 3) continue;\r\n      \r\n      const airport = DEMO_AIRPORTS.find(a => a.icao === icao || a.iata === icao);\r\n      if (airport) {\r\n        newWaypoints.push({\r\n          id: crypto.randomUUID(),\r\n          icao: airport.icao,\r\n          name: airport.name,\r\n          city: airport.city,\r\n          latitude: airport.latitude,\r\n          longitude: airport.longitude,\r\n          sequence: newWaypoints.length\r\n        });\r\n      }\r\n    }\r\n    \r\n    if (newWaypoints.length > 0) {\r\n      setWaypoints(newWaypoints);\r\n      setMapCenter([newWaypoints[0].latitude, newWaypoints[0].longitude]);\r\n      setMapZoom(6);\r\n      return true;\r\n    }\r\n    return false;\r\n  };\r\n\r\n  // Parse X-Plane FMS format\r\n  const parseFMS = (content: string) => {\r\n    const lines = content.split('\\n');\r\n    const newWaypoints: Waypoint[] = [];\r\n    \r\n    for (const line of lines) {\r\n      // FMS format: 5 WAYPOINT_NAME lat lon alt (approximate)\r\n      // Or: I waypoint lat lon altitude airWay\r\n      const parts = line.trim().split(/[\\s,]+/);\r\n      if (parts.length < 4) continue;\r\n      \r\n      // Check if it's a valid line (starts with number or I)\r\n      if (!parts[0].match(/^[0-9I]/)) continue;\r\n      \r\n      const waypointName = parts[1] || parts[0];\r\n      const lat = parseFloat(parts[parts.length - 3]);\r\n      const lon = parseFloat(parts[parts.length - 2]);\r\n      \r\n      if (!isNaN(lat) && !isNaN(lon)) {\r\n        const airport = DEMO_AIRPORTS.find(a => a.icao === waypointName.substring(0, 4));\r\n        newWaypoints.push({\r\n          id: crypto.randomUUID(),\r\n          icao: airport?.icao || waypointName.substring(0, 4),\r\n          name: airport?.name || waypointName,\r\n          city: airport?.city,\r\n          latitude: airport?.latitude || lat,\r\n          longitude: airport?.longitude || lon,\r\n          sequence: newWaypoints.length\r\n        });\r\n      }\r\n    }\r\n    \r\n    if (newWaypoints.length > 0) {\r\n      setWaypoints(newWaypoints);\r\n      setMapCenter([newWaypoints[0].latitude, newWaypoints[0].longitude]);\r\n      setMapZoom(6);\r\n      return true;\r\n    }\r\n    return false;\r\n  };\r\n\r\n  // Parse VATSIM/IVAO flight plan (plain text)\r\n  const parseVATSIM = (content: string) => {\r\n    const lines = content.split('\\n');\r\n    const newWaypoints: Waypoint[] = [];\r\n    let foundRoute = false;\r\n    \r\n    for (const line of lines) {\r\n      const upperLine = line.toUpperCase();\r\n      \r\n      // Look for ROUTE: or similar markers\r\n      if (upperLine.includes('ROUTE:') || upperLine.includes('SID') || upperLine.includes('STAR')) {\r\n        foundRoute = true;\r\n      }\r\n      \r\n      if (foundRoute) {\r\n        // Extract ICAO codes (4 letters)\r\n        const matches = line.match(/[A-Z]{4}/g);\r\n        if (matches) {\r\n          for (const icao of matches) {\r\n            const airport = DEMO_AIRPORTS.find(a => a.icao === icao);\r\n            if (airport && !newWaypoints.find(w => w.icao === icao)) {\r\n              newWaypoints.push({\r\n                id: crypto.randomUUID(),\r\n                icao: airport.icao,\r\n                name: airport.name,\r\n                city: airport.city,\r\n                latitude: airport.latitude,\r\n                longitude: airport.longitude,\r\n                sequence: newWaypoints.length\r\n              });\r\n            }\r\n          }\r\n        }\r\n        \r\n        // Stop at next section\r\n        if (upperLine.includes('REMARKS:') || upperLine.includes('NOTES:')) {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    \r\n    if (newWaypoints.length > 0) {\r\n      setWaypoints(newWaypoints);\r\n      setMapCenter([newWaypoints[0].latitude, newWaypoints[0].longitude]);\r\n      setMapZoom(6);\r\n      return true;\r\n    }\r\n    return false;\r\n  };\r\n\r\n  // Handle file upload\r\n  const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (!file) return;\r\n    \r\n    const reader = new FileReader();\r\n    reader.onload = async (event) => {\r\n      const content = event.target?.result as string;\r\n      const ext = file.name.toLowerCase();\r\n      \r\n      if (ext.endsWith('.gpx')) {\r\n        parseGPX(content);\r\n      } else if (ext.endsWith('.fpl')) {\r\n        parseFPL(content);\r\n      } else if (ext.endsWith('.json')) {\r\n        const success = await parseFPDBJson(content);\r\n        if (!success) alert('Could not parse JSON file. Make sure it\\'s from flightplandatabase.com');\r\n      } else if (ext.endsWith('.csv')) {\r\n        const success = parseFPDBCSV(content);\r\n        if (!success) alert('Could not parse CSV file. Make sure it\\'s from flightplandatabase.com');\r\n      } else {\r\n        alert('Please upload a .gpx, .fpl, .json, or .csv file');\r\n      }\r\n    };\r\n    reader.readAsText(file);\r\n  };\r\n\r\n  // Fetch weather for all waypoints\r\n  const fetchWaypointWeather = async () => {\r\n    if (waypoints.length === 0) return;\r\n    setWeatherLoading(true);\r\n    const weatherData: Record<string, any> = {};\r\n    \r\n    // Determine if we should get forecast (TAF) or current (METAR)\r\n    const isForecast = departureTime && new Date(departureTime) > new Date();\r\n    const forecastDate = departureTime ? new Date(departureTime).toISOString().split('T')[0] : null;\r\n    \r\n    for (const wp of waypoints) {\r\n      try {\r\n        // If departure time is in the future, get TAF forecast\r\n        let url = `/api/weather?icao=${wp.icao}`;\r\n        if (isForecast && forecastDate) {\r\n          url += `&forecast=${forecastDate}`;\r\n        }\r\n        \r\n        const res = await fetch(url);\r\n        if (res.ok) {\r\n          const data = await res.json();\r\n          // Get TAF forecast if available, otherwise METAR\r\n          const tafData = data.taf?.[0];\r\n          const metarData = data.data?.[0];\r\n          \r\n          // Use forecast if departure is in future, otherwise current\r\n          weatherData[wp.icao] = isForecast && tafData ? {\r\n            ...tafData,\r\n            isForecast: true,\r\n            forecastFor: forecastDate\r\n          } : (metarData || null);\r\n        }\r\n      } catch (e) {\r\n        weatherData[wp.icao] = null;\r\n      }\r\n    }\r\n    \r\n    setWaypointWeather(weatherData);\r\n    setWeatherLoading(false);\r\n  };\r\n\r\n  // Fetch route weather with segment calculations\r\n  const fetchRouteWeather = async () => {\r\n    if (waypoints.length < 2) return;\r\n    setLoadingRouteWeather(true);\r\n    \r\n    try {\r\n      const routePoints = waypoints.map(wp => ({\r\n        icao: wp.icao,\r\n        lat: wp.latitude,\r\n        lon: wp.longitude\r\n      }));\r\n      \r\n      const res = await fetch('/api/route-weather', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          waypoints: routePoints,\r\n          altitude: cruisingAlt,\r\n          aircraftTAS: selectedAircraft.speed\r\n        })\r\n      });\r\n      \r\n      if (res.ok) {\r\n        const data = await res.json();\r\n        setRouteWeather(data);\r\n      }\r\n    } catch (e) {\r\n      console.error('Route weather error:', e);\r\n    }\r\n    \r\n    setLoadingRouteWeather(false);\r\n  };\r\n\r\n  // Calculate route statistics\r\n  const routeStats = useMemo(() => {\r\n    if (waypoints.length < 2) return null;\r\n    \r\n    let totalDist = 0;\r\n    const segments: number[] = [];\r\n    const legs: { from: Waypoint; to: Waypoint; distance: number; fuelNeeded: number; cost: number }[] = [];\r\n    \r\n    for (let i = 1; i < waypoints.length; i++) {\r\n      const dist = calculateDistance(\r\n        waypoints[i - 1].latitude, waypoints[i - 1].longitude,\r\n        waypoints[i].latitude, waypoints[i].longitude\r\n      );\r\n      totalDist += dist;\r\n      segments.push(dist);\r\n      \r\n      // Calculate fuel and cost for this leg\r\n      const legFuel = (dist / selectedAircraft.speed) * selectedAircraft.burnRate * 1.25; // with reserves\r\n      const fuelPrice = fuelPrices[waypoints[i].icao]?.price100ll || 6.50;\r\n      const legCost = legFuel * fuelPrice;\r\n      \r\n      legs.push({\r\n        from: waypoints[i - 1],\r\n        to: waypoints[i],\r\n        distance: dist,\r\n        fuelNeeded: legFuel,\r\n        cost: legCost\r\n      });\r\n    }\r\n    \r\n    // Estimate total fuel needed with reserves\r\n    const flightHours = totalDist / selectedAircraft.speed;\r\n    const fuelNeeded = flightHours * selectedAircraft.burnRate;\r\n    const fuelWithReserves = fuelNeeded * 1.25; // 25% reserves\r\n    \r\n    // Calculate estimated cost - fuel only\r\n    let fuelCost = 0;\r\n    for (const wp of waypoints) {\r\n      const price = fuelPrices[wp.icao]?.price100ll || 6.50;\r\n      fuelCost += price * (fuelWithReserves / waypoints.length);\r\n    }\r\n    \r\n    // Calculate landing fees (based on airport size)\r\n    let landingFees = 0;\r\n    if (includeLandingFees) {\r\n      for (let i = 1; i < waypoints.length; i++) {\r\n        const wp = waypoints[i];\r\n        // Large airports: $50, Medium: $30, Small: $15\r\n        if (wp.type === 'large_airport') landingFees += 50;\r\n        else if (wp.type === 'medium_airport') landingFees += 30;\r\n        else landingFees += 15;\r\n      }\r\n    }\r\n    \r\n    // Calculate FBO fees (if enabled and available)\r\n    let fboFees = 0;\r\n    if (includeFboFees) {\r\n      for (let i = 1; i < waypoints.length; i++) {\r\n        const wp = waypoints[i];\r\n        if (fboFeesData[wp.icao]) {\r\n          fboFees += fboFeesData[wp.icao].fee25 || 0; // Use typical fee\r\n        }\r\n      }\r\n    }\r\n    \r\n    const totalCost = fuelCost + landingFees + fboFees;\r\n    const costPerPerson = soulsOnBoard > 1 ? totalCost / soulsOnBoard : totalCost;\r\n    \r\n    // Determine if fuel stops needed\r\n    const fuelStops: Waypoint[] = [];\r\n    const fuelCapacity = selectedAircraft.fuelCapacity * (departureFuel / 100);\r\n    let accumulatedDist = 0;\r\n    \r\n    for (let i = 1; i < waypoints.length; i++) {\r\n      accumulatedDist += segments[i - 1];\r\n      if (accumulatedDist > fuelCapacity * 0.6) { // Refuel at 60% capacity\r\n        fuelStops.push(waypoints[i]);\r\n        accumulatedDist = 0;\r\n      }\r\n    }\r\n    \r\n    return {\r\n      totalDistance: totalDist,\r\n      flightHours: flightHours.toFixed(1),\r\n      fuelNeeded: fuelWithReserves.toFixed(1),\r\n      estimatedCost: totalCost.toFixed(0),\r\n      fuelCost: fuelCost.toFixed(0),\r\n      landingFees: landingFees,\r\n      fboFees: fboFees.toFixed(0),\r\n      costPerPerson: costPerPerson.toFixed(0),\r\n      fuelStops,\r\n      segments,\r\n      legs\r\n    };\r\n  }, [waypoints, selectedAircraft, departureFuel, fuelPrices, includeLandingFees, includeFboFees, soulsOnBoard]);\r\n\r\n  // Save flight plan\r\n  const saveFlightPlan = async () => {\r\n    if (waypoints.length < 2) {\r\n      alert('Please add at least departure and destination');\r\n      return;\r\n    }\r\n\r\n    // Check free tier limit for saved plans\r\n    if (!isPro && savedPlans.filter(p => !p.isDemo).length >= FREE_TIER_LIMITS.maxSavedPlans) {\r\n      setUpgradeFeature('More than 5 saved flight plans');\r\n      setUpgradeModalOpen(true);\r\n      return;\r\n    }\r\n    \r\n    const planName = flightPlanName || `Flight Plan ${new Date().toLocaleDateString()}`;\r\n    \r\n    const plan = {\r\n      name: planName,\r\n      callsign,\r\n      aircraftType: aircraftType || selectedAircraft.name,\r\n      aircraftSpeed: selectedAircraft.speed,\r\n      aircraftBurnRate: selectedAircraft.burnRate,\r\n      aircraftFuelCapacity: selectedAircraft.fuelCapacity,\r\n      pilotName,\r\n      departureTime,\r\n      cruisingAlt,\r\n      alternateIcao,\r\n      remarks,\r\n      soulsOnBoard,\r\n      departureFuel,\r\n      departureIcao: waypoints[0]?.icao,\r\n      arrivalIcao: waypoints[waypoints.length - 1]?.icao,\r\n      waypoints: waypoints.map(w => ({\r\n        icao: w.icao,\r\n        name: w.name,\r\n        city: w.city,\r\n        latitude: w.latitude,\r\n        longitude: w.longitude,\r\n        altitude: w.altitude,\r\n        sequence: w.sequence\r\n      })),\r\n      createdAt: new Date().toISOString()\r\n    };\r\n    \r\n    // If logged in, save to database\r\n    if (status === 'authenticated') {\r\n      try {\r\n        // If we have a current plan loaded, update it\r\n        // Only create new if name changed OR no current plan\r\n        if (currentPlanId) {\r\n          // Check if name changed - if so, create new plan instead\r\n          const currentPlan = savedPlans.find((p: any) => p.id === currentPlanId);\r\n          if (currentPlan && currentPlan.name !== planName) {\r\n            // Name changed - create new plan\r\n            console.log('Name changed, creating new plan');\r\n          } else {\r\n            // Same name or no current plan found - update existing\r\n            console.log('Updating existing plan:', currentPlanId);\r\n            const res = await fetch(`/api/flight-plans?id=${currentPlanId}`, {\r\n              method: 'PUT',\r\n              headers: { 'Content-Type': 'application/json' },\r\n              body: JSON.stringify(plan)\r\n            });\r\n            \r\n            if (res.ok) {\r\n              const data = await res.json();\r\n              setSavedPlans(prev => prev.map(p => p.id === currentPlanId ? data.flightPlan : p));\r\n              alert('Flight plan updated!');\r\n              return;\r\n            } else {\r\n              const errData = await res.json();\r\n              console.error('Update failed:', errData);\r\n              alert('Failed to update flight plan: ' + (errData.error || 'Unknown error'));\r\n              return;\r\n            }\r\n          }\r\n        }\r\n        \r\n        // Either no current plan or name changed - create new\r\n        console.log('Creating new plan');\r\n        const res = await fetch('/api/flight-plans', {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify(plan)\r\n        });\r\n        \r\n        if (res.ok) {\r\n          const data = await res.json();\r\n          setSavedPlans(prev => [data.flightPlan, ...prev]);\r\n          setCurrentPlanId(data.flightPlan.id);\r\n          alert('Flight plan saved!');\r\n        } else {\r\n          const errData = await res.json();\r\n          console.error('Save failed:', errData);\r\n          alert('Failed to save flight plan: ' + (errData.error || 'Unknown error'));\r\n        }\r\n      } catch (e) {\r\n        console.error('Error saving:', e);\r\n        alert('Error saving flight plan');\r\n      }\r\n    } else {\r\n      // Save to localStorage only (when not logged in)\r\n      // If we have a current local plan with same name, update it\r\n      const currentLocalPlan = savedPlans.find((p: any) => p.fromLocal && p.id === currentPlanId);\r\n      if (currentLocalPlan && currentLocalPlan.name === planName) {\r\n        const newPlans = savedPlans.map((p: any) => \r\n          (p.fromLocal && p.id === currentPlanId) ? { ...plan, id: currentPlanId, fromLocal: true } : p\r\n        );\r\n        setSavedPlans(newPlans);\r\n        saveToLocalStorage(newPlans);\r\n        alert('Flight plan updated!');\r\n        return;\r\n      }\r\n      \r\n      // Name changed or new - create new\r\n      const newPlans = [...savedPlans.filter(p => !p.id || !p.fromLocal), { ...plan, id: Date.now(), fromLocal: true }];\r\n      setSavedPlans(newPlans);\r\n      saveToLocalStorage(newPlans);\r\n      alert('Flight plan saved locally (log in to save to your account)');\r\n    }\r\n  };\r\n  \r\n  // Delete flight plan\r\n  const deleteFlightPlan = async (planId: string | number) => {\r\n    const plan = savedPlans.find((p, i) => (p.id || i) === planId);\r\n    \r\n    if (plan?.id) {\r\n      // Database plan - delete from API\r\n      try {\r\n        await fetch(`/api/flight-plans?id=${plan.id}`, { method: 'DELETE' });\r\n      } catch (e) {\r\n        console.error('Error deleting:', e);\r\n      }\r\n    }\r\n    \r\n    // Remove from local state\r\n    const newPlans = savedPlans.filter((p, i) => (p.id || i) !== planId);\r\n    setSavedPlans(newPlans);\r\n    \r\n    // If it was a local-only plan, update localStorage\r\n    if (!plan?.id && typeof planId === 'number') {\r\n      saveToLocalStorage(newPlans.filter(p => !p.id));\r\n    }\r\n  };\r\n  \r\n  // Load a flight plan\r\n  const loadFlightPlan = (plan: any) => {\r\n    setFlightPlanName(plan.name || '');\r\n    setCallsign(plan.callsign || '');\r\n    setAircraftType(plan.aircraftType || '');\r\n    setPilotName(plan.pilotName || '');\r\n    setDepartureTime(plan.departureTime || '');\r\n    setCruisingAlt(plan.cruisingAlt || 5500);\r\n    setAlternateIcao(plan.alternateIcao || '');\r\n    setRemarks(plan.remarks || '');\r\n    setSoulsOnBoard(plan.soulsOnBoard || 1);\r\n    setDepartureFuel(plan.departureFuel || 100);\r\n    \r\n    // Mark this plan as loaded so future saves update it\r\n    if (plan.id) {\r\n      setCurrentPlanId(plan.id);\r\n    }\r\n    \r\n    // Set aircraft if it matches one of our profiles\r\n    if (plan.aircraftType) {\r\n      const ac = AIRCRAFT_PROFILES.find(p => p.name === plan.aircraftType);\r\n      if (ac) setSelectedAircraft(ac);\r\n    }\r\n    \r\n    // Handle both array waypoints and relation waypoints\r\n    const waypointsData = plan.waypoints || (plan.waypoints === undefined ? [] : []);\r\n    \r\n    if (waypointsData.length > 0) {\r\n      const loadedWaypoints = waypointsData.map((w: any, i: number) => ({\r\n        id: crypto.randomUUID(),\r\n        icao: w.icao,\r\n        name: w.name || w.icao,\r\n        city: w.city,\r\n        latitude: w.latitude,\r\n        longitude: w.longitude,\r\n        altitude: w.altitude,\r\n        sequence: i\r\n      }));\r\n      setWaypoints(loadedWaypoints);\r\n      \r\n      // Center map on first waypoint\r\n      if (loadedWaypoints.length > 0) {\r\n        setMapCenter([loadedWaypoints[0].latitude, loadedWaypoints[0].longitude]);\r\n        setMapZoom(8);\r\n      }\r\n    }\r\n    \r\n    setShowPlanList(false);\r\n  };\r\n  \r\n  // Marker click handler - for popup Add to Route button\r\n  const handleAirportAdd = (airport: Airport) => {\r\n    addWaypoint(airport);\r\n    // Center map on airport and zoom out to see area (not filling screen)\r\n    setMapCenter([airport.latitude, airport.longitude]);\r\n    setMapZoom(6); // Zoom out more so airport doesn't fill screen\r\n  };\r\n\r\n  // Find nearest cheap fuel\r\n  const findNearestFuel = async () => {\r\n    // Use first waypoint as center, or ask user\r\n    const centerIcao = waypoints[0]?.icao || 'KORD'; // Default to ORD\r\n    const radius = 50; // nautical miles\r\n    \r\n    try {\r\n      const res = await fetch(`/api/fuel/nearest?icao=${centerIcao}&radius=${radius}`);\r\n      const data = await res.json();\r\n      \r\n      if (data.results && data.results.length > 0) {\r\n        const resultsText = data.results.slice(0, 5).map((r: any) => \r\n          `${r.icao} - $${r.price100ll}/gal (${r.distanceNm}nm ${r.direction})`\r\n        ).join('\\n');\r\n        alert(`Nearest Cheap Fuel within ${radius}nm of ${centerIcao}:\\n\\n${resultsText}`);\r\n        \r\n        // Add cheapest to route\r\n        if (confirm('Add cheapest to route?')) {\r\n          const cheapest = data.results[0];\r\n          const airport = airports.find(a => a.icao === cheapest.icao);\r\n          if (airport) {\r\n            addWaypoint(airport);\r\n          }\r\n        }\r\n      } else {\r\n        alert(`No fuel prices found within ${radius}nm of ${centerIcao}`);\r\n      }\r\n    } catch (e) {\r\n      console.error('Error finding fuel:', e);\r\n      alert('Error finding fuel prices. Make sure you have an airport in your route.');\r\n    }\r\n  };\r\n\r\n  // Get marker color based on airport type\r\n  const getMarkerColor = (type?: string) => {\r\n    switch (type) {\r\n      case 'large_airport': return '#ef4444'; // red\r\n      case 'medium_airport': return '#f59e0b'; // amber\r\n      case 'small_airport': return '#22c55e'; // green\r\n      default: return '#6b7280'; // gray\r\n    }\r\n  };\r\n\r\n  return (\n    <div className=\"h-[100vh] bg-background text-foreground flex flex-col overflow-hidden\">\n      {/* Top Bar */}\n      <div className=\"w-full px-2 py-1.5 bg-card border-b border-border flex-shrink-0\">\n        <div className=\"flex items-center justify-between h-8\">\n          <div className=\"flex items-center gap-3\">\n            <h1 className=\"text-base font-bold\">Flight Planner</h1>\n            <div className=\"flex items-center gap-1 text-sm\">\n              <a href=\"/modules/fuel-saver\" className=\"px-2 py-0.5 rounded bg-primary/10 text-primary font-medium text-xs\">Fuel Map</a>\n              <a href=\"/modules/fuel-saver/airport-lookup\" className=\"px-2 py-0.5 rounded hover:bg-secondary text-muted-foreground hover:text-foreground text-xs\">Airport Lookup</a>\n              <a href=\"/modules/fuel-saver/favorites\" className=\"px-2 py-0.5 rounded hover:bg-secondary text-muted-foreground hover:text-foreground text-xs\">Favorites</a>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            {status === 'authenticated' ? (\n              <div className=\"flex items-center gap-2\">\n                <span className=\"text-xs text-emerald-600\">{session?.user?.email}</span>\n                <button \n                  onClick={() => signOut()}\n                  className=\"text-xs text-muted-foreground hover:text-foreground\"\n                >\n                  Sign out\n                </button>\n              </div>\n            ) : (\n              <button\n                onClick={() => signIn()}\n                className=\"bg-secondary hover:bg-secondary/80 text-foreground px-3 py-1.5 rounded text-xs\"\n              >\n                Sign In\n              </button>\n            )}\n            <button\n              onClick={() => findNearestFuel()}\n              className=\"bg-primary hover:bg-primary/90 text-primary-foreground px-3 py-1.5 rounded text-xs font-medium flex items-center gap-1\"\n            >\n              <span>â›½</span> Find Cheap Fuel\n            </button>\n            <ExportDropdown \n              waypoints={waypoints}\n              flightPlanName={flightPlanName}\n              aircraftType={selectedAircraft.name}\n              cruisingAltitude={cruisingAlt}\n              isPro={isPro}\n              aircraft={selectedAircraft}\n              fuelPrices={fuelPrices}\n            />\n          </div>\n        </div>\n      </div>\n\r\n      {/* Main Content: Sidebar left, Map right */}\n      <div className=\"flex-1 flex overflow-hidden relative\">\n        {/* Toggle Arrow Button - floats over the map */}\n        <button\n          onClick={() => setShowPanel(!showPanel)}\n          className=\"absolute top-1/2 -translate-y-1/2 z-30 bg-card hover:bg-secondary border text-foreground px-2 py-4 rounded-r-lg text-sm transition-all lg:block hidden shadow-md\"\n          style={{ left: showPanel ? '308px' : '0px' }}\n        >\n          {showPanel ? 'â—€' : 'â–¶'}\n        </button>\n\n        {/* Mobile Toggle Button - always visible on small screens */}\n        <button\n          onClick={() => setShowPanel(!showPanel)}\n          className=\"lg:hidden fixed bottom-4 left-4 z-30 bg-primary hover:bg-primary/90 text-primary-foreground p-4 rounded-full shadow-lg\"\n        >\n          {showPanel ? 'âœ•' : 'â˜°'}\n        </button>\n\r\n        {/* Left Sidebar - Panel */}\n        <div \n          className={`bg-card border-r border-border flex flex-col overflow-hidden transition-all duration-300 fixed lg:relative z-20 h-full ${\n            showPanel ? 'w-full sm:w-[308px]' : 'w-0 lg:w-0'\n          }`}\n        >\n          {showPanel && (\n            <div className=\"w-full sm:w-[308px] flex flex-col h-full pt-5\">\n              {/* Mobile Close Button */}\n              <div className=\"lg:hidden flex justify-end p-2 border-b border-border\">\n                <button\n                  onClick={() => setShowPanel(false)}\n                  className=\"bg-secondary hover:bg-secondary/80 text-foreground p-2 rounded-lg\"\n                >\n                  âœ• Close\n                </button>\n              </div>\n\n              {/* Tabs */}\n              <div className=\"flex items-center text-xs border-b border-border px-1\">\n                <button\n                  onClick={() => setTabIndex(Math.max(0, tabIndex - 1))}\n                  disabled={tabIndex === 0}\n                  className=\"p-1.5 text-muted-foreground disabled:opacity-30 hover:text-foreground\"\n                >\n                  â€¹\n                </button>\n                <div className=\"flex-1 flex overflow-hidden\">\n                  {tabs.slice(tabIndex, tabIndex + 5).map((tab) => (\n                    <button\n                      key={tab.id}\n                      onClick={() => setActiveTab(tab.id as 'details' | 'waypoints' | 'info' | 'e6b')}\n                      className={`flex-1 py-1.5 font-medium border-b-2 ${\n                        activeTab === tab.id \n                          ? 'text-foreground border-primary bg-primary/5' \n                          : 'text-muted-foreground border-transparent hover:text-foreground'\n                      }`}\n                    >\n                      {tab.label}\n                    </button>\n                  ))}\n                </div>\n                <button\n                  onClick={() => setTabIndex(Math.min(tabs.length - 3, tabIndex + 1))}\n                  disabled={tabIndex >= tabs.length - 3}\n                  className=\"p-1.5 text-muted-foreground disabled:opacity-30 hover:text-foreground\"\n                >\n                  â€º\n                </button>\n              </div>\n\r\n              {/* Content - scrollable */}\r\n              <div className=\"flex-1 overflow-y-auto\">\r\n                {activeTab === 'details' ? (\r\n                /* Flight Plan Details Tab */\r\n                <div className=\"p-2 space-y-2\">\r\n                  {/* Search */}\r\n\r\n                  {/* Search */}\r\n                  <div>\r\n                    <div className=\"flex gap-1\">\r\n                      <input\r\n                        type=\"text\"\r\n                        value={searchQuery}\r\n                        onChange={(e) => handleSearch(e.target.value)}\r\n                        onKeyDown={(e) => e.key === 'Enter' && searchResults[0] && addWaypoint(searchResults[0])}\r\n                        placeholder=\"Search airport...\"\r\n                        className=\"flex-1 bg-background border border-border rounded px-2 py-1.5 text-foreground uppercase text-xs\"\r\n                      />\r\n                      <button \r\n                        onClick={() => searchQuery.length >= 2 && searchResults[0] && addWaypoint(searchResults[0])}\r\n                        className=\"bg-sky-600 hover:bg-sky-500 px-3 rounded text-foreground text-xs\"\r\n                      >\r\n                        Add\r\n                      </button>\r\n                    </div>\r\n                    {showSearchResults && searchResults.length > 0 && (\r\n                      <div className=\"mt-2 bg-background rounded max-h-40 overflow-y-auto\">\r\n                        {searchResults.map((airport) => (\r\n                          <button\r\n                            key={airport.icao}\r\n                            onClick={() => addWaypoint(airport)}\r\n                            className=\"w-full text-left px-3 py-2 hover:bg-secondary text-sm border-b border-border last:border-0\"\r\n                          >\r\n                            <div className=\"font-medium\">{airport.icao}</div>\r\n                            <div className=\"text-xs text-muted-foreground\">{airport.name}</div>\r\n                          </button>\r\n                        ))}\r\n                      </div>\r\n                    )}\r\n                    {showSearchResults && searchResults.length === 0 && searchQuery.length >= 2 && (\r\n                      <div className=\"mt-2 text-xs text-muted-foreground text-center py-2\">No airports found</div>\r\n                    )}\r\n                  </div>\r\n\r\n                  {/* Plan Name */}\r\n                  <div>\r\n                    <label className=\"block text-xs text-muted-foreground mb-0.5\">Plan</label>\r\n                    <input\r\n                      type=\"text\"\r\n                      value={flightPlanName}\r\n                      onChange={(e) => setFlightPlanName(e.target.value)}\r\n                      placeholder=\"My Cross Country\"\r\n                      className=\"w-full bg-background border border-border rounded px-2 py-1 text-foreground text-xs\"\r\n                    />\r\n                  </div>\r\n\r\n                  {/* Callsign & Pilot */}\r\n                  <div className=\"grid grid-cols-2 gap-1\">\r\n                    <div>\r\n                      <label className=\"block text-xs text-muted-foreground mb-0.5\">Callsign</label>\r\n                      <input\r\n                        type=\"text\"\r\n                        value={callsign}\r\n                        onChange={(e) => setCallsign(e.target.value)}\r\n                        placeholder=\"N12345\"\r\n                        className=\"w-full bg-background border border-border rounded px-2 py-1 text-foreground text-xs\"\r\n                      />\r\n                    </div>\r\n                    <div>\r\n                      <label className=\"block text-xs text-muted-foreground mb-0.5\">Pilot</label>\r\n                      <input\r\n                        type=\"text\"\r\n                        value={pilotName}\r\n                        onChange={(e) => setPilotName(e.target.value)}\r\n                        placeholder=\"John Doe\"\r\n                        className=\"w-full bg-background border border-border rounded px-2 py-1 text-foreground text-xs\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Aircraft & Departure Time */}\r\n                  <div className=\"grid grid-cols-2 gap-1\">\r\n                    <div>\r\n                      <label className=\"block text-xs text-muted-foreground mb-0.5\">Aircraft</label>\r\n                      <select\r\n                        value={selectedAircraft.name}\r\n                        onChange={(e) => {\r\n                        const ac = AIRCRAFT_PROFILES.find(p => p.name === e.target.value);\r\n                          if (ac) setSelectedAircraft(ac);\r\n                        }}\r\n                        className=\"w-full bg-background border border-border rounded px-2 py-1 text-foreground text-xs\"\r\n                      >\r\n                        {[...new Set(AIRCRAFT_PROFILES.map(p => p.manufacturer))].map(mfr => (\r\n                          <optgroup key={mfr} label={mfr}>\r\n                            {AIRCRAFT_PROFILES.filter(p => p.manufacturer === mfr).map(p => (\r\n                              <option key={p.name} value={p.name}>{p.name}</option>\r\n                            ))}\r\n                          </optgroup>\r\n                        ))}\r\n                      </select>\r\n                    </div>\r\n                    <div>\r\n                      <label className=\"block text-xs text-muted-foreground mb-0.5\">Departure</label>\r\n                      <input\r\n                        type=\"datetime-local\"\r\n                        value={departureTime}\r\n                        onChange={(e) => setDepartureTime(e.target.value)}\r\n                        className=\"w-full bg-background border border-border rounded px-2 py-1 text-foreground text-xs\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Cruising Alt & Souls */}\r\n                  <div className=\"grid grid-cols-2 gap-1\">\r\n                    <div>\r\n                      <label className=\"block text-xs text-muted-foreground mb-0.5\">Alt (ft)</label>\r\n                      <input\r\n                        type=\"number\"\r\n                        value={cruisingAlt}\r\n                        onChange={(e) => setCruisingAlt(parseInt(e.target.value))}\r\n                        className=\"w-full bg-background border border-border rounded px-2 py-1 text-foreground text-xs\"\r\n                      />\r\n                    </div>\r\n                    <div>\r\n                      <label className=\"block text-xs text-muted-foreground mb-0.5\">Souls</label>\r\n                      <input\r\n                        type=\"number\"\r\n                        min=\"1\"\r\n                        value={soulsOnBoard}\r\n                        onChange={(e) => setSoulsOnBoard(parseInt(e.target.value))}\r\n                        className=\"w-full bg-background border border-border rounded px-2 py-1 text-foreground text-xs\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Alternate Airport */}\r\n                  <div>\r\n                    <label className=\"block text-xs text-muted-foreground mb-0.5\">Alternate</label>\r\n                    <input\r\n                      type=\"text\"\r\n                      value={alternateIcao}\r\n                      onChange={(e) => setAlternateIcao(e.target.value.toUpperCase())}\r\n                      placeholder=\"KABC\"\r\n                      className=\"w-full bg-background border border-border rounded px-2 py-1 text-foreground uppercase text-xs\"\r\n                    />\r\n                  </div>\r\n\r\n                  {/* Remarks */}\r\n                  <div>\r\n                    <label className=\"block text-xs text-muted-foreground mb-0.5\">Remarks</label>\r\n                    <textarea\r\n                      value={remarks}\r\n                      onChange={(e) => setRemarks(e.target.value)}\r\n                      placeholder=\"...\"\r\n                      rows={1}\r\n                      className=\"w-full bg-background border border-border rounded px-2 py-1 text-foreground text-xs\"\r\n                    />\r\n                  </div>\r\n\r\n                  {/* Fuel Settings */}\r\n                  <div>\r\n                    <label className=\"block text-xs text-muted-foreground mb-0.5\">Fuel: {departureFuel}%</label>\r\n                    <input\r\n                      type=\"range\"\r\n                      min=\"0\"\r\n                      max=\"100\"\r\n                      value={departureFuel}\r\n                      onChange={(e) => setDepartureFuel(parseInt(e.target.value))}\r\n                      className=\"w-full\"\r\n                    />\r\n                  </div>\r\n\r\n                  {/* Range Calculator - compact inline */}\r\n                  <div className=\"bg-background rounded p-2 space-y-1\">\r\n                    <div className=\"text-xs font-medium text-muted-foreground\">Range</div>\r\n                    <div className=\"grid grid-cols-3 gap-1 text-xs\">\r\n                      <div>\r\n                        <div className=\"text-muted-foreground/60 text-[10px]\">Gal</div>\r\n                        <div className=\"text-foreground\">{selectedAircraft.fuelCapacity}</div>\r\n                      </div>\r\n                      <div>\r\n                        <div className=\"text-muted-foreground/60 text-[10px]\">Burn</div>\r\n                        <div className=\"text-foreground\">{selectedAircraft.burnRate}</div>\r\n                      </div>\r\n                      <div>\r\n                        <div className=\"text-muted-foreground/60 text-[10px]\">Kts</div>\r\n                        <div className=\"text-foreground\">{selectedAircraft.speed}</div>\r\n                      </div>\r\n                    </div>\r\n                    {routeStats && (\r\n                      <div className=\"text-[10px] text-sky-400 pt-1 border-t border-border\">\r\n                        Max Range: {Math.round((selectedAircraft.fuelCapacity * departureFuel / 100 / selectedAircraft.burnRate) * selectedAircraft.speed)} NM\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n\r\n                  {/* Route Weather Impact Button */}\r\n                  {waypoints.length >= 2 && (\r\n                    <div className=\"mt-2 pt-2 border-t border-border\">\r\n                      <button\r\n                        onClick={fetchRouteWeather}\r\n                        disabled={loadingRouteWeather}\r\n                        className={`w-full text-xs px-2 py-1.5 rounded transition ${\r\n                          routeWeather\r\n                            ? 'bg-amber-600 hover:bg-amber-500 text-foreground'\r\n                            : 'bg-secondary hover:bg-secondary/80 text-muted-foreground'\r\n                        }`}\r\n                      >\r\n                        {loadingRouteWeather ? 'ðŸ’¨ Calculating...' : routeWeather ? 'ðŸ’¨ Update Wind Impact' : 'ðŸ’¨ Calculate Wind Impact'}\r\n                      </button>\r\n                      \r\n                      {routeWeather && (\r\n                        <div className=\"mt-2 space-y-1\">\r\n                          <div className={`text-xs font-medium px-2 py-1 rounded ${\r\n                            routeWeather.summary.significant \r\n                              ? routeWeather.summary.fuelImpactPercent > 0 \r\n                                ? 'bg-red-900/50 text-red-400'\r\n                                : 'bg-green-900/50 text-green-400'\r\n                              : 'bg-background text-muted-foreground'\r\n                          }`}>\r\n                            {routeWeather.summary.significant ? (\r\n                              routeWeather.summary.fuelImpactPercent > 0 \r\n                                ? `âš ï¸ +${routeWeather.summary.fuelImpactPercent}% fuel (${routeWeather.summary.fuelImpact} gal more)`\r\n                                : `âœ“ ${routeWeather.summary.fuelImpactPercent}% fuel saved (${Math.abs(routeWeather.summary.fuelImpact)} gal less)`\r\n                            ) : (\r\n                              `âœ“ Minimal wind impact (${routeWeather.summary.fuelImpactPercent}% change)`\r\n                            )}\r\n                          </div>\r\n                          <div className=\"text-[10px] text-muted-foreground/60 px-1\">\r\n                            GS: {routeWeather.summary.totalTimeWithWind}min vs {routeWeather.summary.totalTimeStillAir}min still air\r\n                          </div>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                    )}\r\n                  </div>\r\n                ) : activeTab === 'wb' ? (\r\n                  /* Weight & Balance Tab */\r\n                  <div className=\"p-2 space-y-3\">\r\n                    <div className=\"text-sm font-semibold text-foreground\">âš–ï¸ Weight & Balance</div>\r\n                    \r\n                    {/* Aircraft Selection */}\r\n                    <div>\r\n                      <label className=\"block text-xs text-muted-foreground mb-1\">Aircraft</label>\r\n                      <select\r\n                        value={selectedAircraft.name}\r\n                        onChange={(e) => {\r\n                          const ac = AIRCRAFT_PROFILES.find(p => p.name === e.target.value);\r\n                          if (ac) setSelectedAircraft(ac);\r\n                        }}\r\n                        className=\"w-full bg-background border border-border rounded px-2 py-1.5 text-foreground text-xs\"\r\n                      >\r\n                        {[...new Set(AIRCRAFT_PROFILES.map(p => p.manufacturer))].map(mfr => (\r\n                          <optgroup key={mfr} label={mfr}>\r\n                            {AIRCRAFT_PROFILES.filter(p => p.manufacturer === mfr).map(p => (\r\n                              <option key={p.name} value={p.name}>{p.name}</option>\r\n                            ))}\r\n                          </optgroup>\r\n                        ))}\r\n                      </select>\r\n                    </div>\r\n\r\n                    {/* Weight Inputs */}\r\n                    <div className=\"grid grid-cols-2 gap-2\">\r\n                      <div>\r\n                        <label className=\"block text-xs text-muted-foreground mb-1\">Front Seats (lbs)</label>\r\n                        <input\r\n                          type=\"number\"\r\n                          value={wbFrontPax}\r\n                          onChange={(e) => setWbFrontPax(Number(e.target.value))}\r\n                          className=\"w-full bg-background border border-border rounded px-2 py-1.5 text-foreground text-xs\"\r\n                        />\r\n                      </div>\r\n                      <div>\r\n                        <label className=\"block text-xs text-muted-foreground mb-1\">Rear Seat 1 (lbs)</label>\r\n                        <input\r\n                          type=\"number\"\r\n                          value={wbRearPax1}\r\n                          onChange={(e) => setWbRearPax1(Number(e.target.value))}\r\n                          className=\"w-full bg-background border border-border rounded px-2 py-1.5 text-foreground text-xs\"\r\n                        />\r\n                      </div>\r\n                      <div>\r\n                        <label className=\"block text-xs text-muted-foreground mb-1\">Rear Seat 2 (lbs)</label>\r\n                        <input\r\n                          type=\"number\"\r\n                          value={wbRearPax2}\r\n                          onChange={(e) => setWbRearPax2(Number(e.target.value))}\r\n                          className=\"w-full bg-background border border-border rounded px-2 py-1.5 text-foreground text-xs\"\r\n                        />\r\n                      </div>\r\n                      <div>\r\n                        <label className=\"block text-xs text-muted-foreground mb-1\">Baggage 1 (lbs)</label>\r\n                        <input\r\n                          type=\"number\"\r\n                          value={wbBaggage1}\r\n                          onChange={(e) => setWbBaggage1(Number(e.target.value))}\r\n                          className=\"w-full bg-background border border-border rounded px-2 py-1.5 text-foreground text-xs\"\r\n                        />\r\n                      </div>\r\n                      <div>\r\n                        <label className=\"block text-xs text-muted-foreground mb-1\">Baggage 2 (lbs)</label>\r\n                        <input\r\n                          type=\"number\"\r\n                          value={wbBaggage2}\r\n                          onChange={(e) => setWbBaggage2(Number(e.target.value))}\r\n                          className=\"w-full bg-background border border-border rounded px-2 py-1.5 text-foreground text-xs\"\r\n                        />\r\n                      </div>\r\n                      <div>\r\n                        <label className=\"block text-xs text-muted-foreground mb-1\">Fuel (gal)</label>\r\n                        <input\r\n                          type=\"number\"\r\n                          value={wbFuel}\r\n                          onChange={(e) => setWbFuel(Number(e.target.value))}\r\n                          className=\"w-full bg-background border border-border rounded px-2 py-1.5 text-foreground text-xs\"\r\n                        />\r\n                      </div>\r\n                    </div>\r\n\r\n                    {/* Calculate W&B */}\r\n                    {(() => {\r\n                      const ac = selectedAircraft;\r\n                      const fuelWeight = wbFuel * 6; // 6 lbs per gallon for 100LL\r\n                      const emptyMoment = ac.emptyWeight * ac.emptyCG;\r\n                      const frontMoment = wbFrontPax * (ac.arms?.frontSeats || 37);\r\n                      const rear1Moment = wbRearPax1 * (ac.arms?.rearSeats || 73);\r\n                      const rear2Moment = wbRearPax2 * (ac.arms?.rearSeats || 73);\r\n                      const bag1Moment = wbBaggage1 * (ac.arms?.baggage1 || 95);\r\n                      const bag2Moment = wbBaggage2 * (ac.arms?.baggage2 || 123);\r\n                      const fuelMoment = fuelWeight * (ac.arms?.fuel || 48);\r\n                      \r\n                      const totalWeight = ac.emptyWeight + wbFrontPax + wbRearPax1 + wbRearPax2 + wbBaggage1 + wbBaggage2 + fuelWeight;\r\n                      const totalMoment = emptyMoment + frontMoment + rear1Moment + rear2Moment + bag1Moment + bag2Moment + fuelMoment;\r\n                      const cg = totalMoment / totalWeight;\r\n                      const cgInLimits = cg >= (ac.cgLimits?.forward || 35) && cg <= (ac.cgLimits?.aft || 47.3);\r\n                      \r\n                      return (\r\n                        <div className=\"bg-background rounded p-3 space-y-2\">\r\n                          {/* Weight Summary */}\r\n                          <div className=\"grid grid-cols-2 gap-2 text-xs\">\r\n                            <div className=\"flex justify-between\">\r\n                              <span className=\"text-muted-foreground\">Empty:</span>\r\n                              <span className=\"text-foreground\">{ac.emptyWeight} lbs</span>\r\n                            </div>\r\n                            <div className=\"flex justify-between\">\r\n                              <span className=\"text-muted-foreground\">Payload:</span>\r\n                              <span className=\"text-foreground\">{wbFrontPax + wbRearPax1 + wbRearPax2 + wbBaggage1 + wbBaggage2} lbs</span>\r\n                            </div>\r\n                            <div className=\"flex justify-between\">\r\n                              <span className=\"text-muted-foreground\">Fuel:</span>\r\n                              <span className=\"text-foreground\">{fuelWeight} lbs</span>\r\n                            </div>\r\n                            <div className=\"flex justify-between font-medium\">\r\n                              <span className=\"text-muted-foreground\">Total:</span>\r\n                              <span className={totalWeight > ac.maxWeight ? 'text-red-400' : 'text-foreground'}>{totalWeight} lbs</span>\r\n                            </div>\r\n                          </div>\r\n                          \r\n                          {/* CG Display */}\r\n                          <div className=\"pt-2 border-t border-border\">\r\n                            <div className=\"flex justify-between text-xs mb-1\">\r\n                              <span className=\"text-muted-foreground\">CG:</span>\r\n                              <span className={cgInLimits ? 'text-emerald-400' : 'text-red-400'}>{cg.toFixed(1)}\"</span>\r\n                            </div>\r\n                            <div className=\"h-2 bg-secondary rounded-full overflow-hidden\">\r\n                              <div \r\n                                className={`h-full transition-all ${cgInLimits ? 'bg-emerald-500' : 'bg-red-500'}`}\r\n                                style={{ \r\n                                  width: `${Math.min(100, Math.max(0, ((cg - (ac.cgLimits?.forward || 35)) / ((ac.cgLimits?.aft || 47.3) - (ac.cgLimits?.forward || 35))) * 100))}%`,\r\n                                  marginLeft: `${Math.min(100, Math.max(0, ((cg - (ac.cgLimits?.forward || 35)) / ((ac.cgLimits?.aft || 47.3) - (ac.cgLimits?.forward || 35))) * 100))}%`\r\n                                }}\r\n                              />\r\n                            </div>\r\n                            <div className=\"flex justify-between text-[10px] text-muted-foreground/60 mt-1\">\r\n                              <span>{(ac.cgLimits?.forward || 35)}\"</span>\r\n                              <span className={cgInLimits ? 'text-emerald-400' : 'text-red-400'}>\r\n                                {cgInLimits ? 'âœ“ Within Limits' : 'âš ï¸ Out of Limits'}\r\n                              </span>\r\n                              <span>{(ac.cgLimits?.aft || 47.3)}\"</span>\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      );\r\n                    })()}\r\n                    \r\n                    <div className=\"text-xs text-muted-foreground/60\">\r\n                      Arms and limits based on POH data for selected aircraft.\r\n                    </div>\r\n                  </div>\r\n                ) : activeTab === 'e6b' ? (\r\n                /* E6B Calculator Tab */\r\n                <div className=\"p-3 space-y-4\">\r\n                  <div className=\"text-sm font-semibold text-foreground\">ðŸ§® E6B Wind Correction</div>\r\n                  \r\n                  <div className=\"space-y-3\">\r\n                    <div>\r\n                      <label className=\"block text-xs text-muted-foreground mb-1\">True Airspeed (TAS)</label>\r\n                      <input\r\n                        type=\"number\"\r\n                        value={e6bTAS}\r\n                        onChange={(e) => setE6bTAS(Number(e.target.value))}\r\n                        className=\"w-full bg-background border border-border rounded px-3 py-2 text-foreground text-sm\"\r\n                      />\r\n                    </div>\r\n                    \r\n                    <div>\r\n                      <label className=\"block text-xs text-muted-foreground mb-1\">Heading (Â°)</label>\r\n                      <input\r\n                        type=\"number\"\r\n                        value={e6bHeading}\r\n                        onChange={(e) => setE6bHeading(Number(e.target.value))}\r\n                        className=\"w-full bg-background border border-border rounded px-3 py-2 text-foreground text-sm\"\r\n                      />\r\n                    </div>\r\n                    \r\n                    <div className=\"grid grid-cols-2 gap-2\">\r\n                      <div>\r\n                        <label className=\"block text-xs text-muted-foreground mb-1\">Wind From (Â°)</label>\r\n                        <input\r\n                          type=\"number\"\r\n                          value={e6bWindDir}\r\n                          onChange={(e) => setE6bWindDir(Number(e.target.value))}\r\n                          className=\"w-full bg-background border border-border rounded px-3 py-2 text-foreground text-sm\"\r\n                        />\r\n                      </div>\r\n                      <div>\r\n                        <label className=\"block text-xs text-muted-foreground mb-1\">Wind Speed (kts)</label>\r\n                        <input\r\n                          type=\"number\"\r\n                          value={e6bWindspeed}\r\n                          onChange={(e) => setE6bWindspeed(Number(e.target.value))}\r\n                          className=\"w-full bg-background border border-border rounded px-3 py-2 text-foreground text-sm\"\r\n                        />\r\n                      </div>\r\n                    </div>\r\n                    \r\n                    <button\r\n                      onClick={calculateE6B}\r\n                      className=\"w-full bg-sky-600 hover:bg-sky-500 text-foreground font-medium py-2 rounded text-sm\"\r\n                    >\r\n                      Calculate\r\n                    </button>\r\n                    \r\n                    {e6bResult && (\r\n                      <div className=\"bg-background rounded p-3 space-y-2\">\r\n                        <div className=\"flex justify-between\">\r\n                          <span className=\"text-muted-foreground text-sm\">Ground Speed:</span>\r\n                          <span className=\"text-foreground font-bold\">{e6bResult.groundSpeed} kts</span>\r\n                        </div>\r\n                        <div className=\"flex justify-between\">\r\n                          <span className=\"text-muted-foreground text-sm\">Track:</span>\r\n                          <span className=\"text-foreground font-bold\">{e6bResult.track}Â°</span>\r\n                        </div>\r\n                        <div className=\"flex justify-between\">\r\n                          <span className=\"text-muted-foreground text-sm\">Wind Correction:</span>\r\n                          <span className={`font-bold ${e6bResult.windCorrection > 0 ? 'text-amber-400' : e6bResult.windCorrection < 0 ? 'text-blue-400' : 'text-foreground'}`}>\r\n                            {e6bResult.windCorrection > 0 ? '+' : ''}{e6bResult.windCorrection}Â°\r\n                          </span>\r\n                        </div>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                  \r\n                  <div className=\"text-xs text-muted-foreground/60\">\r\n                    Use weather data from your route to get wind info for accurate calculations.\r\n                  </div>\r\n                </div>\r\n              ) : (\r\n                /* Waypoints Tab */\r\n                <div className=\"p-1.5\">\r\n                  {/* Weather Toggle */}\r\n                  <div className=\"flex items-center justify-between mb-2 px-1\">\r\n                    <span className=\"text-xs text-muted-foreground\">{waypoints.length} waypoints</span>\r\n                    <button\r\n                      onClick={() => {\r\n                        if (!showWeather) {\r\n                          fetchWaypointWeather();\r\n                        }\r\n                        setShowWeather(!showWeather);\r\n                      }}\r\n                      disabled={weatherLoading}\r\n                      className={`text-xs px-2 py-1 rounded transition ${\r\n                        showWeather \r\n                          ? 'bg-sky-600 text-foreground' \r\n                          : 'bg-secondary text-muted-foreground hover:bg-secondary/80'\r\n                      }`}\r\n                    >\r\n                      {weatherLoading ? 'Loading...' : 'ðŸŒ¤ Weather'}\r\n                    </button>\r\n                    \r\n                    {/* Route buttons */}\r\n                    <div className=\"flex gap-1\">\r\n                      <button\r\n                        onClick={fitMapToWaypoints}\r\n                        disabled={waypoints.length === 0}\r\n                        className=\"flex-1 text-xs px-2 py-1 rounded bg-secondary text-muted-foreground hover:bg-secondary/80 disabled:opacity-30 min-w-[60px]\"\r\n                        title=\"Fit map to show all waypoints\"\r\n                      >\r\n                        âŠ™ Fit\r\n                      </button>\r\n                      <button\r\n                        onClick={toggleRoundTrip}\r\n                        disabled={waypoints.length < 2}\r\n                        className=\"flex-1 text-xs px-2 py-1 rounded bg-secondary text-muted-foreground hover:bg-secondary/80 disabled:opacity-30 min-w-[60px]\"\r\n                        title={waypoints[0]?.icao === waypoints[waypoints.length-1]?.icao ? \"Remove return leg\" : \"Add return leg\"}\r\n                      >\r\n                        {waypoints[0]?.icao === waypoints[waypoints.length-1]?.icao ? 'â†©ï¸ One-way' : 'ðŸ”„ Round Trip'}\r\n                      </button>\r\n                      <button\r\n                        onClick={optimizeRoute}\r\n                        disabled={waypoints.length < 3}\r\n                        className=\"flex-1 text-xs px-2 py-1 rounded bg-secondary text-muted-foreground hover:bg-secondary/80 disabled:opacity-30 min-w-[60px]\"\r\n                        title=\"Optimize route for shortest distance\"\r\n                      >\r\n                        âš¡ Optimize\r\n                      </button>\r\n                    </div>\r\n                  </div>\n\n                  {waypoints.length > 0 && (\n                    <div className=\"space-y-1\">\r\n                      {waypoints.map((wp, i) => {\r\n                        const legInfo = routeStats?.legs?.[i];\r\n                        \r\n                        return (\r\n                          <div key={wp.id} className=\"bg-background rounded p-2\">\r\n                            <div className=\"flex items-center justify-between\">\r\n                              <div className=\"flex items-center gap-1.5\">\r\n                                <span className=\"w-5 h-5 rounded-full bg-sky-600 text-foreground flex items-center justify-center font-bold text-xs\">\r\n                                  {i + 1}\r\n                                </span>\r\n                                <div>\r\n                                  <div className=\"font-medium text-foreground text-xs\">{wp.icao}</div>\r\n                                  <div className=\"text-xs text-muted-foreground\">{wp.city || wp.name}</div>\r\n                                </div>\r\n                              </div>\r\n                              <div className=\"flex gap-0.5\">\r\n                                <button \r\n                                  onClick={() => moveWaypoint(wp.id, 'up')}\r\n                                  disabled={i === 0}\r\n                                  className=\"text-muted-foreground hover:text-foreground disabled:opacity-30 text-xs p-0.5\"\r\n                                >â†‘</button>\r\n                                <button \r\n                                  onClick={() => moveWaypoint(wp.id, 'down')}\r\n                                  disabled={i === waypoints.length - 1}\r\n                                  className=\"text-muted-foreground hover:text-foreground disabled:opacity-30 text-xs p-0.5\"\r\n                                >â†“</button>\r\n                                <button \r\n                                  onClick={() => removeWaypoint(wp.id)}\r\n                                  className=\"text-red-400 hover:text-red-300 text-xs p-0.5\"\r\n                                >âœ•</button>\r\n                              </div>\r\n                            </div>\r\n                            \r\n                            {/* Leg stats - shows for all except last waypoint */}\r\n                            {legInfo && (\r\n                              <div className=\"mt-1 pt-1 border-t border-border flex justify-between text-xs\">\r\n                                <span className=\"text-sky-400\">â†’ {legInfo.to.icao}</span>\r\n                                <span className=\"text-amber-400\">{Math.round(legInfo.distance)}NM</span>\r\n                                <span className=\"text-emerald-400\">${legInfo.cost.toFixed(0)}</span>\r\n                              </div>\r\n                            )}\r\n\r\n                            {/* Weather info for this waypoint */}\r\n                            {showWeather && waypointWeather[wp.icao] && (\r\n                              <div className=\"mt-2 pt-2 border-t border-border text-xs space-y-1\">\r\n                                <div className=\"flex justify-between\">\r\n                                  <span className=\"text-muted-foreground\">Flight Cat:</span>\r\n                                  <span className={`font-medium ${\r\n                                    waypointWeather[wp.icao].flightCategory === 'VFR' ? 'text-green-400' :\r\n                                    waypointWeather[wp.icao].flightCategory === 'MVFR' ? 'text-blue-400' :\r\n                                    waypointWeather[wp.icao].flightCategory === 'IFR' ? 'text-red-400' :\r\n                                    'text-purple-400'\r\n                                  }`}>\r\n                                    {waypointWeather[wp.icao].flightCategory || 'N/A'}\r\n                                  </span>\r\n                                </div>\r\n                                {waypointWeather[wp.icao].isForecast && (\r\n                                  <div className=\"flex justify-between\">\r\n                                    <span className=\"text-muted-foreground\">Type:</span>\r\n                                    <span className=\"text-amber-400 text-xs\">â˜ï¸ Forecast</span>\r\n                                  </div>\r\n                                )}\r\n                                {waypointWeather[wp.icao].ws && (\r\n                                  <div className=\"flex justify-between\">\r\n                                    <span className=\"text-muted-foreground\">Wind:</span>\r\n                                    <span className=\"text-foreground\">\r\n                                      {waypointWeather[wp.icao].ws.value}@{waypointWeather[wp.icao].wd?.value}Â°\r\n                                    </span>\r\n                                  </div>\r\n                                )}\r\n                                {waypointWeather[wp.icao].temp && (\r\n                                  <div className=\"flex justify-between\">\r\n                                    <span className=\"text-muted-foreground\">Temp:</span>\r\n                                    <span className=\"text-foreground\">{waypointWeather[wp.icao].temp}Â°C</span>\r\n                                  </div>\r\n                                )}\r\n                                {waypointWeather[wp.icao].altimeter && (\r\n                                  <div className=\"flex justify-between\">\r\n                                    <span className=\"text-muted-foreground\">Alt:</span>\r\n                                    <span className=\"text-foreground\">{(waypointWeather[wp.icao].altimeter / 100).toFixed(2)}\"</span>\r\n                                  </div>\r\n                                )}\r\n                              </div>\r\n                            )}\r\n                          </div>\r\n                        );\r\n                      })}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              )}\n              \n              {/* Trip Finder - only in Tools tab */}\n              {activeTab === 'e6b' && (\n                <>\n                  {/* NOTAMs Panel - shown in sidebar when there are waypoints */}\n                  {waypoints.length > 0 && (\n                    <NotamsPanel \n                      waypoints={waypoints} \n                      isPro={isPro}\n                    />\n                  )}\n                  \n                  <TripFinder\n                  airports={airports}\n                  waypoints={waypoints}\n                  aircraft={selectedAircraft}\n                  fuelPrices={fuelPrices}\n                  onAddWaypoint={(airport) => addWaypoint(airport)}\n                />\n                </>\n              )}\n            </div>\n\n            {/* Bottom Actions - Load/Save/Import */}\n            <div className=\"p-2 border-t border-border bg-card flex-shrink-0 space-y-1\">\r\n              {/* Import Button */}\r\n              <div>\r\n                <label className=\"block text-xs text-muted-foreground mb-1\">Import Flight Plan</label>\r\n                <input\r\n                  type=\"file\"\r\n                  accept=\".gpx,.fpl,.json,.csv\"\r\n                  onChange={handleFileUpload}\r\n                  className=\"w-full text-xs text-muted-foreground file:mr-2 file:py-1 file:px-2 file:rounded file:border-0 file:text-xs file:font-medium file:bg-secondary file:text-foreground hover:file:bg-slate-500\"\r\n                />\r\n              </div>\r\n              <div className=\"flex gap-1\">\r\n                <button\r\n                  onClick={() => {\r\n                    if (status === 'loading') return;\r\n                    if (status !== 'authenticated') {\r\n                      setAuthModalAction('load');\r\n                      setAuthModalOpen(true);\r\n                    } else {\r\n                      setShowPlanList(!showPlanList);\r\n                    }\r\n                  }}\r\n                  className=\"flex-1 bg-secondary hover:bg-secondary/80 text-foreground font-medium py-1.5 rounded text-xs\"\r\n                >\r\n                  Load {savedPlans.length > 0 && `(${savedPlans.length})`}\r\n                </button>\r\n                <button\r\n                  onClick={() => {\r\n                    if (status === 'loading') return;\r\n                    if (status !== 'authenticated') {\r\n                      setAuthModalAction('save');\r\n                      setAuthModalOpen(true);\r\n                    } else {\r\n                      saveFlightPlan();\r\n                    }\r\n                  }}\r\n                  disabled={!canSave}\r\n                  className={`flex-1 font-medium py-1.5 rounded text-xs ${canSave ? 'bg-emerald-500 hover:bg-emerald-600 text-foreground' : 'bg-secondary text-muted-foreground cursor-not-allowed'}`}\r\n                >\r\n                  Save\r\n                </button>\r\n              </div>\r\n              \r\n              {/* Saved Plans List */}\r\n              {showPlanList && (\r\n                <div className=\"bg-background rounded p-1.5 space-y-1 max-h-24 overflow-y-auto\">\r\n                  {status === 'authenticated' ? (\r\n                    <div className=\"flex items-center justify-between text-xs text-emerald-400\">\r\n                      <span>Logged in as {session?.user?.email}</span>\r\n                      <button onClick={() => signOut()} className=\"text-muted-foreground hover:text-foreground\">Sign out</button>\r\n                    </div>\r\n                  ) : (\r\n                    <button \r\n                      onClick={() => signIn()} \r\n                      className=\"w-full text-xs bg-secondary hover:bg-secondary/80 rounded py-1.5 text-sky-400\"\r\n                    >\r\n                      Log in to save plans to your account\r\n                    </button>\r\n                  )}\r\n                  \r\n                  {savedPlans.length > 0 ? (\r\n                    <>\r\n                      <div className=\"text-sm font-semibold text-muted-foreground\">Saved Plans ({savedPlans.length})</div>\r\n                      {savedPlans.map((plan, i) => (\r\n                        <div key={plan.id || i} className=\"flex items-center justify-between bg-secondary rounded p-2 text-sm\">\r\n                          <button onClick={() => loadFlightPlan(plan)} className=\"text-left flex-1 hover:text-sky-400\">\r\n                            <div className=\"font-medium flex items-center gap-2\">\r\n                              {plan.name || 'Untitled'}\r\n                              {plan.isDemo && (\r\n                                <span className=\"text-[10px] bg-amber-500/20 text-amber-400 px-1.5 py-0.5 rounded\">DEMO</span>\r\n                              )}\r\n                            </div>\r\n                            <div className=\"text-xs text-muted-foreground\">\r\n                              {plan.departureIcao || '---'} â†’ {plan.arrivalIcao || '---'} â€¢ {plan.waypoints?.length || 0} waypoints\r\n                            </div>\r\n                          </button>\r\n                          {!plan.isDemo && (\r\n                            <button onClick={() => deleteFlightPlan(plan.id || i)} className=\"text-red-400 hover:text-red-300 px-2\">âœ•</button>\r\n                          )}\r\n                        </div>\r\n                      ))}\r\n                    </>\r\n                  ) : (\r\n                    <div className=\"text-xs text-muted-foreground text-center py-2\">No saved plans</div>\r\n                  )}\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Right Side - Map and Bottom Stats */}\r\n        <div className=\"flex-1 flex flex-col overflow-hidden\">\r\n          {/* Map Section */}\r\n          <div className=\"flex-1 overflow-hidden relative\">\r\n            {!mapLoaded ? (\r\n              <div className=\"h-full flex items-center justify-center bg-card\">\r\n                <button onClick={() => setMapLoaded(true)} className=\"bg-sky-500 hover:bg-sky-600 text-foreground px-4 py-2 rounded-lg text-sm\">\r\n                  Load Map\r\n                </button>\r\n              </div>\r\n            ) : (\r\n              <>\r\n                <LeafletMap\r\n                  key={showPanel ? 'map-open' : 'map-closed'}\r\n                  airports={airports.filter(a => {\r\n                    // Filter by airport type\r\n                    if (a.type === 'large_airport' && !mapOptions.showLarge) return false;\r\n                    if (a.type === 'medium_airport' && !mapOptions.showMedium) return false;\r\n                    if (a.type === 'small_airport' && !mapOptions.showSmall) return false;\r\n                    if (a.type === 'seaplane_base' && !mapOptions.showSeaplane) return false;\r\n                    // Filter by region - hide Canada/Mexico unless toggle is on\r\n                    if (!showInternational && !isNorthAmerica(a)) return false;\r\n                    return true;\r\n                  })}\r\n                  waypoints={waypoints}\r\n                  fuelPrices={fuelPrices}\r\n                  onBoundsChange={setMapBounds}\r\n                  onAirportClick={handleAirportAdd}\r\n                  mapCenter={mapCenter}\r\n                  mapZoom={mapZoom}\r\n                  showTerrain={performanceSettings.showTerrain}\r\n                  showStateOverlay={mapOptions.showStatePrices}\r\n                  showTfrs={mapOptions.showTfrs}\r\n                  showPireps={mapOptions.showPireps}\r\n                  onStateClick={setSelectedStateInfo}\r\n                  onViewStateInfo={handleViewStateInfo}\r\n                  baseLayer={mapOptions.baseLayer}\r\n                  performanceMode={mapOptions.performanceMode}\r\n                />\r\n                {selectedStateInfo && (\r\n                  <StateInfoPanel\r\n                    stateInfo={selectedStateInfo}\r\n                    onClose={() => setSelectedStateInfo(null)}\r\n                    onAirportClick={(icao) => {\r\n                      // Find and add airport to route\r\n                      const airport = airports.find(a => a.icao === icao);\r\n                      if (airport) {\r\n                        handleAirportAdd(airport);\r\n                      }\r\n                    }}\r\n                  />\r\n                )}\r\n                {/* International Toggle - Hidden by default, shows Canada/Mexico */}\r\n                <div className=\"absolute top-4 left-4 z-[1001]\">\r\n                  <button\r\n                    onClick={() => setShowInternational(!showInternational)}\r\n                    className={`px-2 py-1.5 text-xs rounded-lg shadow-lg border transition-colors ${\r\n                      showInternational \r\n                        ? 'bg-emerald-600 border-emerald-500 text-foreground' \r\n                        : 'bg-card/90 border-border text-muted-foreground hover:bg-background'\r\n                    }`}\r\n                    title={showInternational ? 'Hiding Canada/Mexico airports' : 'Show Canada/Mexico airports'}\r\n                  >\r\n                    ðŸŒ Intl {showInternational ? 'ON' : 'OFF'}\r\n                  </button>\r\n                </div>\r\n                <PerformanceSettingsPanel onSettingsChange={setPerformanceSettings} />\r\n                <MapControls \r\n                  options={mapOptions} \r\n                  onOptionsChange={setMapOptions}\r\n                />\r\n              </>\r\n            )}\r\n          </div>\r\n\r\n          {/* Bottom Stats Bar - Full Width */}\r\n          {routeStats && (\r\n            <div className=\"bg-card border-t border-border p-3 flex-shrink-0\">\r\n              {/* Cost Settings Toggle */}\r\n              <div className=\"flex gap-2 mb-2\">\r\n                <label className=\"flex items-center gap-1 text-xs cursor-pointer\">\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    checked={includeLandingFees}\r\n                    onChange={(e) => setIncludeLandingFees(e.target.checked)}\r\n                    className=\"rounded\"\r\n                  />\r\n                  <span className={includeLandingFees ? 'text-foreground' : 'text-muted-foreground/60'}>Landing</span>\r\n                </label>\r\n                <label className=\"flex items-center gap-1 text-xs cursor-pointer\">\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    checked={includeFboFees}\r\n                    onChange={(e) => setIncludeFboFees(e.target.checked)}\r\n                    className=\"rounded\"\r\n                  />\r\n                  <span className={includeFboFees ? 'text-foreground' : 'text-muted-foreground/60'}>FBO</span>\r\n                </label>\r\n              </div>\r\n              \r\n              <div className=\"flex items-center justify-between\">\r\n                {/* Main Stats */}\r\n                <div className=\"flex gap-4\">\r\n                  <div className=\"text-center\">\r\n                    <div className=\"text-2xl font-bold text-sky-400\">{Math.round(routeStats.totalDistance)}</div>\r\n                    <div className=\"text-xs text-muted-foreground/60 uppercase tracking-wider\">NM</div>\r\n                  </div>\r\n                  <div className=\"text-center\">\r\n                    <div className=\"text-2xl font-bold text-amber-400\">{routeStats.flightHours}h</div>\r\n                    <div className=\"text-xs text-muted-foreground/60 uppercase tracking-wider\">Flight Time</div>\r\n                  </div>\r\n                  <div className=\"text-center\">\r\n                    <div className=\"text-2xl font-bold text-purple-400\">{routeStats.fuelNeeded}</div>\r\n                    <div className=\"text-xs text-muted-foreground/60 uppercase tracking-wider\">Gal Fuel</div>\r\n                  </div>\r\n                  <div className=\"text-center\">\r\n                    <div className=\"text-2xl font-bold text-emerald-400\">${routeStats.estimatedCost}</div>\r\n                    <div className=\"text-xs text-muted-foreground/60 uppercase tracking-wider\">Total</div>\r\n                  </div>\r\n                  {soulsOnBoard > 1 && (\r\n                    <div className=\"text-center\">\r\n                      <div className=\"text-2xl font-bold text-cyan-400\">${routeStats.costPerPerson}</div>\r\n                      <div className=\"text-xs text-muted-foreground/60 uppercase tracking-wider\">Per Person</div>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n\r\n                {/* Aircraft Info */}\r\n                <div className=\"hidden md:block text-right\">\r\n                  <div className=\"text-sm font-medium text-foreground\">{selectedAircraft.name}</div>\r\n                  <div className=\"text-xs text-muted-foreground\">{selectedAircraft.speed} kts â€¢ {selectedAircraft.burnRate} gph</div>\r\n                </div>\r\n              </div>\r\n              \r\n              {/* Leg Breakdown - Drag and Drop */}\r\n              {routeStats.legs.length > 0 && (\r\n                <div className=\"mt-3 pt-3 border-t border-border flex gap-2 overflow-x-auto pb-1\">\r\n                  {routeStats.legs.map((leg, toIdx) => {\r\n                    const isDragging = draggedLegIndex === toIdx;\r\n                    const isDragOver = draggedLegIndex !== null && draggedLegIndex !== toIdx;\r\n                    \r\n                    return (\r\n                      <div\r\n                        key={toIdx}\r\n                        draggable\r\n                        onDragStart={(e) => {\r\n                          setDraggedLegIndex(toIdx);\r\n                          e.dataTransfer.effectAllowed = 'move';\r\n                          e.dataTransfer.setData('text/plain', String(toIdx));\r\n                        }}\r\n                        onDragOver={(e) => {\r\n                          e.preventDefault();\r\n                          e.dataTransfer.dropEffect = 'move';\r\n                        }}\r\n                        onDragEnter={(e) => {\r\n                          e.preventDefault();\r\n                        }}\r\n                        onDrop={(e) => {\r\n                          e.preventDefault();\r\n                          e.stopPropagation();\r\n                          const fromIdx = draggedLegIndex;\r\n                          if (fromIdx !== null && fromIdx !== toIdx) {\r\n                            // When dropping leg fromIdx onto leg toIdx:\r\n                            // - Take waypoint at position fromIdx + 1 (destination of dragged leg)\r\n                            // - Move it to position toIdx + 1\r\n                            const newWaypoints = [...waypoints];\r\n                            const movedWp = newWaypoints[fromIdx + 1];\r\n                            newWaypoints.splice(fromIdx + 1, 1);\r\n                            newWaypoints.splice(toIdx + 1, 0, movedWp);\r\n                            setWaypoints(newWaypoints.map((w, idx) => ({ ...w, sequence: idx })));\r\n                          }\r\n                          setDraggedLegIndex(null);\r\n                        }}\r\n                        onDragEnd={() => setDraggedLegIndex(null)}\r\n                        className={`flex-shrink-0 bg-background rounded px-3 py-2 text-xs cursor-move select-none transition-all ${\r\n                          isDragging ? 'opacity-30 scale-95 ring-2 ring-sky-500' : \r\n                          isDragOver ? 'ring-2 ring-amber-500 scale-105 bg-secondary' : \r\n                          'hover:bg-secondary hover:scale-105'\r\n                        }`}\r\n                        style={{ touchAction: 'none' }}\r\n                      >\r\n                        <span className=\"text-sky-400 font-medium\">{leg.from.icao}</span>\r\n                        <span className=\"text-muted-foreground/60 mx-1\">â†’</span>\r\n                        <span className=\"text-amber-400 font-medium\">{leg.to.icao}</span>\r\n                        <div className=\"text-muted-foreground mt-1\">{Math.round(leg.distance)} NM â€¢ ${leg.cost.toFixed(0)}</div>\r\n                      </div>\r\n                    );\r\n                  })}\r\n                </div>\r\n              )}\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Mobile Orientation Warning Popup */}\r\n      {showOrientationWarning && (\r\n        <div className=\"fixed inset-0 z-[9999] bg-black/90 flex items-center justify-center p-8\">\r\n          <div className=\"text-center\">\r\n            {/* Phone Rotation Animation */}\r\n            <div className=\"mb-8 relative w-24 h-40 mx-auto border-4 border-white rounded-3xl bg-card\">\r\n              <div className=\"absolute inset-0 flex items-center justify-center\">\r\n                <div className=\"w-16 h-1 bg-white rounded animate-pulse\"></div>\r\n              </div>\r\n              <div className=\"absolute top-2 left-1/2 -translate-x-1/2 w-2 h-2 bg-secondary rounded-full\"></div>\r\n              <div className=\"absolute bottom-2 left-1/2 -translate-x-1/2 w-8 h-1 bg-secondary rounded\"></div>\r\n            </div>\r\n            {/* Arrow Animation */}\r\n            <div className=\"mb-6 text-6xl animate-bounce\">â†»</div>\r\n            <h2 className=\"text-2xl font-bold text-foreground mb-2\">Rotate Your Phone</h2>\r\n            <p className=\"text-muted-foreground mb-6\">For the best experience, please rotate your phone to landscape mode.</p>\r\n            <button\r\n              onClick={() => {\r\n                setOrientationDismissed(true);\r\n                setShowOrientationWarning(false);\r\n              }}\r\n              className=\"bg-sky-500 hover:bg-sky-600 text-foreground px-6 py-3 rounded-lg font-medium\"\r\n            >\r\n              Continue Anyway\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Auth Modal */}\r\n      <AuthModal \r\n        isOpen={authModalOpen} \r\n        onClose={() => setAuthModalOpen(false)} \r\n        action={authModalAction}\r\n        onConfirm={() => {\r\n          if (authModalAction === 'save') {\r\n            saveFlightPlan();\r\n          }\r\n        }}\r\n      />\r\n\r\n      {/* Upgrade Modal */}\r\n      <UpgradeModal \r\n        isOpen={upgradeModalOpen} \r\n        onClose={() => setUpgradeModalOpen(false)}\r\n        feature={upgradeFeature}\r\n      />\r\n\r\n      {/* Tier Explainer Modal */}\r\n      <TierExplainerModal \r\n        isOpen={showTierExplainer} \r\n        onClose={() => setShowTierExplainer(false)}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n\r\n// Wrapper component with Suspense for useSearchParams\r\nexport default function FuelSaverPage() {\r\n  return (\r\n    <Suspense fallback={\r\n      <div className=\"min-h-screen bg-background text-foreground flex items-center justify-center\">\r\n        <div className=\"text-muted-foreground\">Loading...</div>\r\n      </div>\r\n    }>\r\n      <FuelSaverContent />\r\n    </Suspense>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\fuel-saver\\view\\[id]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'router' is assigned a value but never used.","line":62,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":62,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'session' is assigned a value but never used.","line":63,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":63,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'status' is assigned a value but never used.","line":63,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":63,"endColumn":32},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is assigned a value but never used.","line":66,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":66,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setError' is assigned a value but never used.","line":66,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":66,"endColumn":25},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":141,"column":61,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[5172,5221],"text":"This trip doesn&apos;t exist or you don't have access."},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[5172,5221],"text":"This trip doesn&lsquo;t exist or you don't have access."},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[5172,5221],"text":"This trip doesn&#39;t exist or you don't have access."},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[5172,5221],"text":"This trip doesn&rsquo;t exist or you don't have access."},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":141,"column":80,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[5172,5221],"text":"This trip doesn't exist or you don&apos;t have access."},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[5172,5221],"text":"This trip doesn't exist or you don&lsquo;t have access."},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[5172,5221],"text":"This trip doesn't exist or you don&#39;t have access."},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[5172,5221],"text":"This trip doesn't exist or you don&rsquo;t have access."},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect, useMemo } from 'react';\nimport { useParams, useRouter } from 'next/navigation';\nimport Link from 'next/link';\nimport { useSession } from 'next-auth/react';\n\n// This page shows a static view of a saved flight plan\n// without loading the interactive map\n\ninterface Waypoint {\n  id?: string;\n  icao: string;\n  name?: string;\n  city?: string;\n  latitude: number;\n  longitude: number;\n  sequence?: number;\n}\n\ninterface FlightPlan {\n  id?: string;\n  name?: string;\n  callsign?: string;\n  aircraftType?: string;\n  pilotName?: string;\n  departureTime?: string;\n  cruisingAlt?: number;\n  alternateIcao?: string;\n  remarks?: string;\n  soulsOnBoard?: number;\n  departureFuel?: number;\n  departureIcao?: string;\n  arrivalIcao?: string;\n  waypoints?: Waypoint[];\n  createdAt?: string;\n  updatedAt?: string;\n}\n\n// Simple distance calculation\nfunction calculateDistance(lat1: number, lon1: number, lat2: number, lon2: number): number {\n  const R = 3440.065; // Earth radius in NM\n  const dLat = (lat2 - lat1) * Math.PI / 180;\n  const dLon = (lon2 - lon1) * Math.PI / 180;\n  const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *\n    Math.sin(dLon / 2) * Math.sin(dLon / 2);\n  return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n}\n\n// Default aircraft profiles with W&B data\nconst AIRCRAFT_PROFILES = [\n  { name: 'Cessna 172S', speed: 120, burnRate: 8.4, fuelCapacity: 56, emptyWeight: 1689, emptyCG: 39.1, maxWeight: 2550, arms: { frontSeats: 37.0, rearSeats: 73.0, baggage1: 95.0, baggage2: 123.0, fuel: 48.0 }, cgLimits: { forward: 35.0, aft: 47.3 } },\n  { name: 'Cessna 182T', speed: 140, burnRate: 12, fuelCapacity: 88, emptyWeight: 1710, emptyCG: 39.0, maxWeight: 3100, arms: { frontSeats: 37.0, rearSeats: 73.0, baggage1: 95.0, baggage2: 123.0, fuel: 48.0 }, cgLimits: { forward: 35.0, aft: 47.3 } },\n  { name: 'Cirrus SR22', speed: 155, burnRate: 14, fuelCapacity: 82, emptyWeight: 3400, emptyCG: 35.0, maxWeight: 3600, arms: { frontSeats: 35.0, rearSeats: 66.0, baggage1: 86.0, baggage2: 86.0, fuel: 48.0 }, cgLimits: { forward: 33.0, aft: 47.3 } },\n  { name: 'Diamond DA40', speed: 140, burnRate: 10, fuelCapacity: 52, emptyWeight: 1650, emptyCG: 93.0, maxWeight: 2700, arms: { frontSeats: 85.0, rearSeats: 85.0, baggage1: 90.0, fuel: 90.0 }, cgLimits: { forward: 82.0, aft: 96.0 } },\n  { name: 'Piper Archer', speed: 120, burnRate: 9, fuelCapacity: 48, emptyWeight: 1500, emptyCG: 35.0, maxWeight: 2550, arms: { frontSeats: 32.5, rearSeats: 75.0, baggage1: 95.0, fuel: 47.0 }, cgLimits: { forward: 31.0, aft: 47.3 } },\n];\n\nexport default function ViewTripPage() {\n  const params = useParams();\n  const router = useRouter();\n  const { data: session, status } = useSession();\n  const [plan, setPlan] = useState<FlightPlan | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [selectedAircraft, setSelectedAircraft] = useState(AIRCRAFT_PROFILES[0]);\n  const [fuelPrice, setFuelPrice] = useState(6.50);\n\n  useEffect(() => {\n    const fetchPlan = async () => {\n      try {\n        // If we have an ID, fetch from API\n        if (params.id) {\n          const res = await fetch(`/api/flight-plans?id=${params.id}`);\n          if (res.ok) {\n            const data = await res.json();\n            if (data.flightPlans?.[0]) {\n              setPlan(data.flightPlans[0]);\n            }\n          }\n        }\n      } catch (err) {\n        console.error('Error fetching plan:', err);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchPlan();\n  }, [params.id]);\n\n  // Calculate route stats\n  const routeStats = useMemo(() => {\n    if (!plan?.waypoints || plan.waypoints.length < 2) return null;\n\n    let totalDist = 0;\n    const legs: { from: string; to: string; distance: number }[] = [];\n\n    for (let i = 1; i < plan.waypoints.length; i++) {\n      const dist = calculateDistance(\n        plan.waypoints[i-1].latitude, plan.waypoints[i-1].longitude,\n        plan.waypoints[i].latitude, plan.waypoints[i].longitude\n      );\n      totalDist += dist;\n      legs.push({\n        from: plan.waypoints[i-1].icao,\n        to: plan.waypoints[i].icao,\n        distance: dist\n      });\n    }\n\n    const timeHours = totalDist / selectedAircraft.speed;\n    const fuelNeeded = (totalDist / selectedAircraft.speed) * selectedAircraft.burnRate * 1.25;\n    const estimatedCost = fuelNeeded * fuelPrice;\n\n    return {\n      totalDistance: totalDist,\n      totalTime: timeHours,\n      fuelNeeded,\n      estimatedCost,\n      legs\n    };\n  }, [plan?.waypoints, selectedAircraft, fuelPrice]);\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-slate-900 text-white p-8\">\n        <div className=\"max-w-4xl mx-auto\">\n          <div className=\"animate-pulse\">Loading...</div>\n        </div>\n      </div>\n    );\n  }\n\n  if (!plan) {\n    return (\n      <div className=\"min-h-screen bg-slate-900 text-white p-8\">\n        <div className=\"max-w-4xl mx-auto text-center\">\n          <h1 className=\"text-2xl font-bold mb-4\">Trip Not Found</h1>\n          <p className=\"text-slate-400 mb-6\">This trip doesn't exist or you don't have access.</p>\n          <Link href=\"/trips\" className=\"bg-emerald-500 hover:bg-emerald-600 px-4 py-2 rounded\">\n            Back to My Trips\n          </Link>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-slate-900 text-white\">\n      {/* Header */}\n      <div className=\"bg-slate-800 border-b border-slate-700 p-4\">\n        <div className=\"max-w-4xl mx-auto flex items-center justify-between\">\n          <div className=\"flex items-center gap-4\">\n            <Link href=\"/trips\" className=\"text-slate-400 hover:text-white\">\n              â† Back\n            </Link>\n            <div>\n              <h1 className=\"text-xl font-bold\">{plan.name || 'Flight Plan'}</h1>\n              {plan.createdAt && (\n                <p className=\"text-xs text-slate-400\">\n                  Created {new Date(plan.createdAt).toLocaleDateString()}\n                </p>\n              )}\n            </div>\n          </div>\n          <div className=\"flex gap-2\">\n            <Link \n              href={`/modules/fuel-saver?load=${plan.id}`}\n              className=\"bg-sky-500 hover:bg-sky-600 px-4 py-2 rounded text-sm\"\n            >\n              âœï¸ Edit\n            </Link>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"max-w-4xl mx-auto p-4 space-y-6\">\n        {/* Quick Stats */}\n        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n          <div className=\"bg-slate-800 rounded-lg p-4 text-center\">\n            <div className=\"text-2xl font-bold text-sky-400\">\n              {routeStats?.totalDistance.toFixed(0) || '-'}\n            </div>\n            <div className=\"text-xs text-slate-400\">Total NM</div>\n          </div>\n          <div className=\"bg-slate-800 rounded-lg p-4 text-center\">\n            <div className=\"text-2xl font-bold text-amber-400\">\n              {routeStats?.totalTime.toFixed(1) || '-'}h\n            </div>\n            <div className=\"text-xs text-slate-400\">Flight Time</div>\n          </div>\n          <div className=\"bg-slate-800 rounded-lg p-4 text-center\">\n            <div className=\"text-2xl font-bold text-purple-400\">\n              {routeStats?.fuelNeeded.toFixed(0) || '-'}\n            </div>\n            <div className=\"text-xs text-slate-400\">Gal Fuel</div>\n          </div>\n          <div className=\"bg-slate-800 rounded-lg p-4 text-center\">\n            <div className=\"text-2xl font-bold text-emerald-400\">\n              ${routeStats?.estimatedCost.toFixed(0) || '-'}\n            </div>\n            <div className=\"text-xs text-slate-400\">Est. Cost</div>\n          </div>\n        </div>\n\n        {/* Flight Details */}\n        <div className=\"bg-slate-800 rounded-lg p-4\">\n          <h2 className=\"font-bold mb-3\">Flight Details</h2>\n          <div className=\"grid grid-cols-2 md:grid-cols-3 gap-4 text-sm\">\n            {plan.callsign && (\n              <div>\n                <span className=\"text-slate-400\">Callsign:</span> {plan.callsign}\n              </div>\n            )}\n            {plan.pilotName && (\n              <div>\n                <span className=\"text-slate-400\">Pilot:</span> {plan.pilotName}\n              </div>\n            )}\n            {plan.aircraftType && (\n              <div>\n                <span className=\"text-slate-400\">Aircraft:</span> {plan.aircraftType}\n              </div>\n            )}\n            {plan.departureTime && (\n              <div>\n                <span className=\"text-slate-400\">Departure:</span> {new Date(plan.departureTime).toLocaleString()}\n              </div>\n            )}\n            {plan.cruisingAlt && (\n              <div>\n                <span className=\"text-slate-400\">Altitude:</span> {plan.cruisingAlt} ft\n              </div>\n            )}\n            {plan.soulsOnBoard && (\n              <div>\n                <span className=\"text-slate-400\">Souls:</span> {plan.soulsOnBoard}\n              </div>\n            )}\n          </div>\n          {plan.remarks && (\n            <div className=\"mt-3 pt-3 border-t border-slate-700\">\n              <span className=\"text-slate-400\">Remarks:</span> {plan.remarks}\n            </div>\n          )}\n        </div>\n\n        {/* Calculator Settings */}\n        <div className=\"bg-slate-800 rounded-lg p-4\">\n          <h2 className=\"font-bold mb-3\">Calculator Settings</h2>\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <label className=\"block text-xs text-slate-400 mb-1\">Aircraft</label>\n              <select\n                value={selectedAircraft.name}\n                onChange={(e) => setSelectedAircraft(AIRCRAFT_PROFILES.find(a => a.name === e.target.value) || AIRCRAFT_PROFILES[0])}\n                className=\"w-full bg-slate-700 border border-slate-600 rounded px-3 py-2\"\n              >\n                {AIRCRAFT_PROFILES.map(ac => (\n                  <option key={ac.name} value={ac.name}>{ac.name}</option>\n                ))}\n              </select>\n            </div>\n            <div>\n              <label className=\"block text-xs text-slate-400 mb-1\">Fuel Price ($/gal)</label>\n              <input\n                type=\"number\"\n                value={fuelPrice}\n                onChange={(e) => setFuelPrice(Number(e.target.value))}\n                step={0.1}\n                className=\"w-full bg-slate-700 border border-slate-600 rounded px-3 py-2\"\n              />\n            </div>\n          </div>\n        </div>\n\n        {/* Route */}\n        <div className=\"bg-slate-800 rounded-lg p-4\">\n          <h2 className=\"font-bold mb-3\">Route</h2>\n          <div className=\"space-y-2\">\n            {plan.waypoints?.map((wp, i) => (\n              <div key={i} className=\"flex items-center gap-3\">\n                <span className=\"w-6 h-6 rounded-full bg-sky-600 flex items-center justify-center text-xs font-bold\">\n                  {i + 1}\n                </span>\n                <div className=\"flex-1\">\n                  <span className=\"font-medium\">{wp.icao}</span>\n                  <span className=\"text-slate-400 ml-2 text-sm\">{wp.name}</span>\n                </div>\n                {i > 0 && routeStats?.legs[i-1] && (\n                  <span className=\"text-slate-400 text-sm\">\n                    {routeStats.legs[i-1].distance.toFixed(0)} NM\n                  </span>\n                )}\n              </div>\n            ))}\n          </div>\n        </div>\n\n        {/* Nav Log Preview */}\n        <div className=\"bg-slate-800 rounded-lg p-4\">\n          <div className=\"flex items-center justify-between mb-3\">\n            <h2 className=\"font-bold\">Nav Log</h2>\n            <button\n              onClick={() => window.print()}\n              className=\"text-xs bg-slate-700 hover:bg-slate-600 px-3 py-1 rounded\"\n            >\n              ðŸ–¨ï¸ Print\n            </button>\n          </div>\n          \n          {/* Simple Nav Log Table */}\n          <div className=\"overflow-x-auto\">\n            <table className=\"w-full text-sm\">\n              <thead className=\"bg-slate-700\">\n                <tr>\n                  <th className=\"px-2 py-1 text-left\">From</th>\n                  <th className=\"px-2 py-1 text-left\">To</th>\n                  <th className=\"px-2 py-1\">Course</th>\n                  <th className=\"px-2 py-1\">Dist</th>\n                  <th className=\"px-2 py-1\">Time</th>\n                  <th className=\"px-2 py-1\">Fuel</th>\n                </tr>\n              </thead>\n              <tbody>\n                {plan.waypoints?.slice(1).map((wp, i) => {\n                  const leg = routeStats?.legs[i];\n                  const time = leg ? (leg.distance / selectedAircraft.speed * 60) : 0;\n                  const fuel = leg ? (leg.distance / selectedAircraft.speed * selectedAircraft.burnRate * 1.25) : 0;\n                  const course = i > 0 ? calculateCourse(\n                    plan.waypoints![i-1].latitude, plan.waypoints![i-1].longitude,\n                    wp.latitude, wp.longitude\n                  ) : 0;\n                  \n                  return (\n                    <tr key={i} className=\"border-t border-slate-700\">\n                      <td className=\"px-2 py-1\">{plan.waypoints![i].icao}</td>\n                      <td className=\"px-2 py-1\">{wp.icao}</td>\n                      <td className=\"px-2 py-1 text-center\">{course}Â°</td>\n                      <td className=\"px-2 py-1 text-center\">{leg?.distance.toFixed(0)} NM</td>\n                      <td className=\"px-2 py-1 text-center\">{Math.floor(time)}:{((time % 1) * 60).toFixed(0).padStart(2, '0')}</td>\n                      <td className=\"px-2 py-1 text-center\">{fuel.toFixed(1)} gal</td>\n                    </tr>\n                  );\n                })}\n                <tr className=\"border-t border-slate-600 bg-slate-700 font-bold\">\n                  <td colSpan={3} className=\"px-2 py-1\">TOTAL</td>\n                  <td className=\"px-2 py-1 text-center\">{routeStats?.totalDistance.toFixed(0)} NM</td>\n                  <td className=\"px-2 py-1 text-center\">{Math.floor(routeStats?.totalTime || 0)}:{(((routeStats?.totalTime || 0) % 1) * 60).toFixed(0).padStart(2, '0')}</td>\n                  <td className=\"px-2 py-1 text-center\">{routeStats?.fuelNeeded.toFixed(1)} gal</td>\n                </tr>\n              </tbody>\n            </table>\n          </div>\n          \n          <p className=\"text-xs text-slate-500 mt-3 text-center\">\n            Generated by FuelSaver - For planning purposes only, not for navigation\n          </p>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n// Calculate bearing between two points\nfunction calculateCourse(lat1: number, lon1: number, lat2: number, lon2: number): number {\n  const dLon = (lon2 - lon1) * Math.PI / 180;\n  const lat1Rad = lat1 * Math.PI / 180;\n  const lat2Rad = lat2 * Math.PI / 180;\n  \n  const x = Math.sin(dLon) * Math.cos(lat2Rad);\n  const y = Math.cos(lat1Rad) * Math.sin(lat2Rad) - Math.sin(lat1Rad) * Math.cos(lat2Rad) * Math.cos(dLon);\n  \n  let course = (Math.atan2(x, y) * 180) / Math.PI;\n  course = ((course % 360) + 360) % 360;\n  return Math.round(course);\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\logbook\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Card' is defined but never used.","line":6,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":14,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Card"},"fix":{"range":[145,150],"text":""},"desc":"Remove unused variable \"Card\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardContent' is defined but never used.","line":6,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":27,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"CardContent"},"fix":{"range":[149,162],"text":""},"desc":"Remove unused variable \"CardContent\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardDescription' is defined but never used.","line":6,"column":29,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":44,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"CardDescription"},"fix":{"range":[162,179],"text":""},"desc":"Remove unused variable \"CardDescription\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardHeader' is defined but never used.","line":6,"column":46,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":56,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"CardHeader"},"fix":{"range":[179,191],"text":""},"desc":"Remove unused variable \"CardHeader\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardTitle' is defined but never used.","line":6,"column":58,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":67,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"CardTitle"},"fix":{"range":[136,233],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Badge' is defined but never used.","line":7,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":15,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Badge"},"fix":{"range":[233,279],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Separator' is defined but never used.","line":9,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":19,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Separator"},"fix":{"range":[327,381],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ChevronLeft' is defined but never used.","line":15,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":14,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"ChevronLeft"},"fix":{"range":[432,447],"text":""},"desc":"Remove unused variable \"ChevronLeft\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ChevronRight' is defined but never used.","line":16,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":15,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"ChevronRight"},"fix":{"range":[447,463],"text":""},"desc":"Remove unused variable \"ChevronRight\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'session' is assigned a value but never used.","line":42,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":42,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":217,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":217,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":270,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":270,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":285,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":285,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":13,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect } from 'react';\nimport { useSession } from 'next-auth/react';\nimport Link from 'next/link';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\"\nimport { Badge } from \"@/components/ui/badge\"\nimport { Button } from \"@/components/ui/button\"\nimport { Separator } from \"@/components/ui/separator\"\nimport { \n  Plane,\n  Download,\n  Filter,\n  Calendar,\n  ChevronLeft,\n  ChevronRight,\n  Search,\n  FileText,\n  X\n} from \"lucide-react\";\n\ninterface LogbookEntry {\n  id: string;\n  date: string;\n  aircraft: string;\n  routeFrom: string;\n  routeTo: string;\n  totalTime: number;\n  soloTime: number;\n  dualGiven: number;\n  dualReceived: number;\n  nightTime: number;\n  instrumentTime: number;\n  crossCountryTime: number;\n  dayLandings: number;\n  nightLandings: number;\n  remarks: string | null;\n  instructor: string | null;\n}\n\nexport default function LogbookPage() {\n  const { data: session, status } = useSession();\n  const [entries, setEntries] = useState<LogbookEntry[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState('');\n  const [showForm, setShowForm] = useState(false);\n  const [saving, setSaving] = useState(false);\n\n  // Filter state\n  const [showFilters, setShowFilters] = useState(false);\n  const [filterYear, setFilterYear] = useState<string>('all');\n  const [filterAircraft, setFilterAircraft] = useState<string>('all');\n  const [searchQuery, setSearchQuery] = useState('');\n\n  // Get unique aircraft for filter dropdown\n  const uniqueAircraft = [...new Set(entries.map(e => e.aircraft))].sort();\n  const currentYear = new Date().getFullYear();\n  const years = Array.from({ length: 10 }, (_, i) => currentYear - i);\n\n  // Filtered entries\n  const filteredEntries = entries.filter(entry => {\n    const entryYear = new Date(entry.date).getFullYear().toString();\n    if (filterYear !== 'all' && entryYear !== filterYear) return false;\n    if (filterAircraft !== 'all' && entry.aircraft !== filterAircraft) return false;\n    if (searchQuery) {\n      const query = searchQuery.toLowerCase();\n      return (\n        entry.aircraft.toLowerCase().includes(query) ||\n        entry.routeFrom.toLowerCase().includes(query) ||\n        entry.routeTo.toLowerCase().includes(query) ||\n        (entry.remarks?.toLowerCase().includes(query) ?? false)\n      );\n    }\n    return true;\n  });\n\n  // Filtered totals\n  const filteredTotals = filteredEntries.reduce((acc, entry) => ({\n    totalTime: acc.totalTime + entry.totalTime,\n    soloTime: acc.soloTime + entry.soloTime,\n    dualGiven: acc.dualGiven + entry.dualGiven,\n    dualReceived: acc.dualReceived + entry.dualReceived,\n    nightTime: acc.nightTime + entry.nightTime,\n    instrumentTime: acc.instrumentTime + entry.instrumentTime,\n    crossCountryTime: acc.crossCountryTime + entry.crossCountryTime,\n    dayLandings: acc.dayLandings + entry.dayLandings,\n    nightLandings: acc.nightLandings + entry.nightLandings,\n  }), {\n    totalTime: 0, soloTime: 0, dualGiven: 0, dualReceived: 0,\n    nightTime: 0, instrumentTime: 0, crossCountryTime: 0,\n    dayLandings: 0, nightLandings: 0\n  });\n\n  // Export to CSV\n  const exportToCSV = () => {\n    const headers = ['Date', 'Aircraft', 'From', 'To', 'Total Time', 'Solo', 'Dual Given', 'Dual Received', 'Night', 'Instrument', 'XC', 'Day Landings', 'Night Landings', 'Remarks'];\n    const csvContent = [\n      headers.join(','),\n      ...filteredEntries.map(entry => [\n        entry.date,\n        entry.aircraft,\n        entry.routeFrom,\n        entry.routeTo,\n        entry.totalTime,\n        entry.soloTime,\n        entry.dualGiven,\n        entry.dualReceived,\n        entry.nightTime,\n        entry.instrumentTime,\n        entry.crossCountryTime,\n        entry.dayLandings,\n        entry.nightLandings,\n        `\"${entry.remarks || ''}\"`\n      ].join(','))\n    ].join('\\n');\n\n    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\n    const link = document.createElement('a');\n    link.href = URL.createObjectURL(blob);\n    link.download = `logbook_export_${new Date().toISOString().split('T')[0]}.csv`;\n    link.click();\n  };\n\n  // Export to PDF (text-based for simplicity)\n  const exportToPDF = () => {\n    const content = `\nLOGBOOK EXPORT - Generated ${new Date().toLocaleDateString()}\n================================================\n\nSUMMARY (Filtered: ${filteredEntries.length} of ${entries.length} entries)\n-------\nTotal Time: ${filteredTotals.totalTime.toFixed(1)} hours\nSolo Time: ${filteredTotals.soloTime.toFixed(1)} hours\nDual Given: ${filteredTotals.dualGiven.toFixed(1)} hours\nDual Received: ${filteredTotals.dualReceived.toFixed(1)} hours\nNight Time: ${filteredTotals.nightTime.toFixed(1)} hours\nInstrument Time: ${filteredTotals.instrumentTime.toFixed(1)} hours\nCross Country: ${filteredTotals.crossCountryTime.toFixed(1)} hours\nDay Landings: ${filteredTotals.dayLandings}\nNight Landings: ${filteredTotals.nightLandings}\n\nFLIGHT ENTRIES\n--------------\n${filteredEntries.map((entry, i) => `\n${i + 1}. ${entry.date} - ${entry.aircraft}\n   Route: ${entry.routeFrom} â†’ ${entry.routeTo}\n   Total: ${entry.totalTime}h | Solo: ${entry.soloTime}h | Night: ${entry.nightTime}h\n   Instrument: ${entry.instrumentTime}h | XC: ${entry.crossCountryTime}h\n   Landings: ${entry.dayLandings} day, ${entry.nightLandings} night\n   ${entry.remarks ? `Remarks: ${entry.remarks}` : ''}\n`).join('\\n')}\n    `.trim();\n\n    const blob = new Blob([content], { type: 'text/plain;charset=utf-8;' });\n    const link = document.createElement('a');\n    link.href = URL.createObjectURL(blob);\n    link.download = `logbook_export_${new Date().toISOString().split('T')[0]}.txt`;\n    link.click();\n  };\n\n  // Form state\n  const [formData, setFormData] = useState({\n    date: new Date().toISOString().split('T')[0],\n    aircraft: '',\n    routeFrom: '',\n    routeTo: '',\n    totalTime: '',\n    soloTime: '',\n    dualGiven: '',\n    dualReceived: '',\n    nightTime: '',\n    instrumentTime: '',\n    crossCountryTime: '',\n    dayLandings: '0',\n    nightLandings: '0',\n    remarks: '',\n    instructor: '',\n  });\n\n  // Calculate totals\n  const totals = entries.reduce((acc, entry) => ({\n    totalTime: acc.totalTime + entry.totalTime,\n    soloTime: acc.soloTime + entry.soloTime,\n    dualGiven: acc.dualGiven + entry.dualGiven,\n    dualReceived: acc.dualReceived + entry.dualReceived,\n    nightTime: acc.nightTime + entry.nightTime,\n    instrumentTime: acc.instrumentTime + entry.instrumentTime,\n    crossCountryTime: acc.crossCountryTime + entry.crossCountryTime,\n    dayLandings: acc.dayLandings + entry.dayLandings,\n    nightLandings: acc.nightLandings + entry.nightLandings,\n  }), {\n    totalTime: 0, soloTime: 0, dualGiven: 0, dualReceived: 0,\n    nightTime: 0, instrumentTime: 0, crossCountryTime: 0,\n    dayLandings: 0, nightLandings: 0\n  });\n\n  useEffect(() => {\n    if (status === 'authenticated') {\n      fetchEntries();\n    }\n  }, [status]);\n\n  const fetchEntries = async () => {\n    try {\n      const res = await fetch('/api/logbook');\n      if (!res.ok) {\n        const data = await res.json();\n        if (data.code === 'PROPLUS_REQUIRED') {\n          setError('Pro+ subscription required');\n        } else {\n          setError(data.error || 'Failed to load entries');\n        }\n        return;\n      }\n      const data = await res.json();\n      setEntries(data.entries || []);\n    } catch (err) {\n      setError('Failed to load logbook');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setSaving(true);\n\n    try {\n      const res = await fetch('/api/logbook', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          ...formData,\n          totalTime: parseFloat(formData.totalTime) || 0,\n          soloTime: parseFloat(formData.soloTime) || 0,\n          dualGiven: parseFloat(formData.dualGiven) || 0,\n          dualReceived: parseFloat(formData.dualReceived) || 0,\n          nightTime: parseFloat(formData.nightTime) || 0,\n          instrumentTime: parseFloat(formData.instrumentTime) || 0,\n          crossCountryTime: parseFloat(formData.crossCountryTime) || 0,\n          dayLandings: parseInt(formData.dayLandings) || 0,\n          nightLandings: parseInt(formData.nightLandings) || 0,\n        }),\n      });\n\n      if (res.ok) {\n        await fetchEntries();\n        setShowForm(false);\n        setFormData({\n          date: new Date().toISOString().split('T')[0],\n          aircraft: '',\n          routeFrom: '',\n          routeTo: '',\n          totalTime: '',\n          soloTime: '',\n          dualGiven: '',\n          dualReceived: '',\n          nightTime: '',\n          instrumentTime: '',\n          crossCountryTime: '',\n          dayLandings: '0',\n          nightLandings: '0',\n          remarks: '',\n          instructor: '',\n        });\n      } else {\n        const data = await res.json();\n        alert(data.error || 'Failed to save');\n      }\n    } catch (err) {\n      alert('Failed to save entry');\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const handleDelete = async (id: string) => {\n    if (!confirm('Delete this entry?')) return;\n    \n    try {\n      const res = await fetch(`/api/logbook?id=${id}`, { method: 'DELETE' });\n      if (res.ok) {\n        await fetchEntries();\n      }\n    } catch (err) {\n      alert('Failed to delete');\n    }\n  };\n\n  if (status === 'loading' || loading) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <div className=\"text-muted-foreground\">Loading...</div>\n      </div>\n    );\n  }\n\n  if (status === 'unauthenticated') {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center p-4\">\n        <div className=\"text-center\">\n          <h1 className=\"text-2xl font-bold text-foreground mb-4\">Please Sign In</h1>\n          <p className=\"text-muted-foreground mb-6\">You need to be signed in to view your logbook.</p>\n          <button\n            onClick={() => window.location.href = '/login'}\n            className=\"bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg\"\n          >\n            Sign In\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  if (error === 'Pro+ subscription required') {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center p-4\">\n        <div className=\"text-center max-w-md\">\n          <div className=\"text-6xl mb-4\">ðŸ“–</div>\n          <h1 className=\"text-2xl font-bold text-foreground mb-4\">Pro+ Feature</h1>\n          <p className=\"text-muted-foreground mb-6\">\n            The Digital Logbook is available with Pro+ subscription. \n            Upgrade to track your flight hours automatically.\n          </p>\n          <Link\n            href=\"/pricing\"\n            className=\"inline-block bg-amber-500 hover:bg-amber-600 text-white px-6 py-2 rounded-lg\"\n          >\n            Upgrade to Pro+\n          </Link>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background p-4 md:p-8\">\n      <div className=\"max-w-6xl mx-auto\">\n        {/* Header */}\n        <div className=\"flex flex-col gap-4 mb-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h1 className=\"text-2xl font-bold text-foreground\">ðŸ“– Digital Logbook</h1>\n              <p className=\"text-muted-foreground\">Track your flight hours</p>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Button \n                variant={showFilters ? \"default\" : \"outline\"} \n                size=\"sm\" \n                onClick={() => setShowFilters(!showFilters)}\n              >\n                <Filter className=\"h-4 w-4 mr-2\" />\n                Filters\n              </Button>\n              <Button variant=\"outline\" size=\"sm\" onClick={exportToCSV}>\n                <FileText className=\"h-4 w-4 mr-2\" />\n                CSV\n              </Button>\n              <Button variant=\"outline\" size=\"sm\" onClick={exportToPDF}>\n                <Download className=\"h-4 w-4 mr-2\" />\n                Export\n              </Button>\n              <Button \n                onClick={() => setShowForm(!showForm)}\n                className=\"bg-green-600 hover:bg-green-700\"\n              >\n                {showForm ? 'Cancel' : '+ Add Entry'}\n              </Button>\n            </div>\n          </div>\n\n          {/* Filter Bar */}\n          {showFilters && (\n            <div className=\"flex flex-wrap items-center gap-3 p-4 bg-card border border-border rounded-xl\">\n              <div className=\"flex items-center gap-2\">\n                <Calendar className=\"h-4 w-4 text-muted-foreground\" />\n                <select\n                  value={filterYear}\n                  onChange={(e) => setFilterYear(e.target.value)}\n                  className=\"h-8 rounded-md border border-input bg-background px-3 text-sm\"\n                >\n                  <option value=\"all\">All Years</option>\n                  {years.map(year => (\n                    <option key={year} value={year}>{year}</option>\n                  ))}\n                </select>\n              </div>\n              \n              <div className=\"flex items-center gap-2\">\n                <Plane className=\"h-4 w-4 text-muted-foreground\" />\n                <select\n                  value={filterAircraft}\n                  onChange={(e) => setFilterAircraft(e.target.value)}\n                  className=\"h-8 rounded-md border border-input bg-background px-3 text-sm\"\n                >\n                  <option value=\"all\">All Aircraft</option>\n                  {uniqueAircraft.map(ac => (\n                    <option key={ac} value={ac}>{ac}</option>\n                  ))}\n                </select>\n              </div>\n\n              <div className=\"flex items-center gap-2 flex-1 min-w-[200px]\">\n                <Search className=\"h-4 w-4 text-muted-foreground\" />\n                <input\n                  type=\"text\"\n                  value={searchQuery}\n                  onChange={(e) => setSearchQuery(e.target.value)}\n                  placeholder=\"Search aircraft, route, remarks...\"\n                  className=\"h-8 flex-1 rounded-md border border-input bg-background px-3 text-sm\"\n                />\n              </div>\n\n              {(filterYear !== 'all' || filterAircraft !== 'all' || searchQuery) && (\n                <Button \n                  variant=\"ghost\" \n                  size=\"sm\"\n                  onClick={() => {\n                    setFilterYear('all');\n                    setFilterAircraft('all');\n                    setSearchQuery('');\n                  }}\n                >\n                  <X className=\"h-4 w-4 mr-1\" />\n                  Clear\n                </Button>\n              )}\n            </div>\n          )}\n        </div>\n\n        {/* Stats Cards - Show filtered totals if filters are active */}\n        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6\">\n          <div className=\"bg-card border border-border rounded-xl p-4\">\n            <p className=\"text-xs text-muted-foreground uppercase\">Total Time {(filterYear !== 'all' || filterAircraft !== 'all' || searchQuery) && '(Filtered)'}</p>\n            <p className=\"text-2xl font-bold text-foreground\">{(filterYear !== 'all' || filterAircraft !== 'all' || searchQuery ? filteredTotals : totals).totalTime.toFixed(1)}h</p>\n          </div>\n          <div className=\"bg-card border border-border rounded-xl p-4\">\n            <p className=\"text-xs text-muted-foreground uppercase\">Solo Time</p>\n            <p className=\"text-2xl font-bold text-green-600\">{(filterYear !== 'all' || filterAircraft !== 'all' || searchQuery ? filteredTotals : totals).soloTime.toFixed(1)}h</p>\n          </div>\n          <div className=\"bg-card border border-border rounded-xl p-4\">\n            <p className=\"text-xs text-muted-foreground uppercase\">Night Time</p>\n            <p className=\"text-2xl font-bold text-purple-600\">{(filterYear !== 'all' || filterAircraft !== 'all' || searchQuery ? filteredTotals : totals).nightTime.toFixed(1)}h</p>\n          </div>\n          <div className=\"bg-card border border-border rounded-xl p-4\">\n            <p className=\"text-xs text-muted-foreground uppercase\">Landings</p>\n            <p className=\"text-2xl font-bold text-blue-600\">{((filterYear !== 'all' || filterAircraft !== 'all' || searchQuery ? filteredTotals : totals).dayLandings + (filterYear !== 'all' || filterAircraft !== 'all' || searchQuery ? filteredTotals : totals).nightLandings)}</p>\n          </div>\n        </div>\n\n        {/* Add Entry Form */}\n        {showForm && (\n          <div className=\"bg-card border border-border rounded-xl p-6 mb-6\">\n            <h2 className=\"text-lg font-semibold text-foreground mb-4\">New Flight Entry</h2>\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\n              <div className=\"grid md:grid-cols-4 gap-4\">\n                <div>\n                  <label className=\"block text-xs text-muted-foreground mb-1\">Date</label>\n                  <input\n                    type=\"date\"\n                    value={formData.date}\n                    onChange={(e) => setFormData({...formData, date: e.target.value})}\n                    className=\"w-full bg-background border border-border rounded-lg px-3 py-2 text-foreground\"\n                    required\n                  />\n                </div>\n                <div>\n                  <label className=\"block text-xs text-muted-foreground mb-1\">Aircraft</label>\n                  <input\n                    type=\"text\"\n                    value={formData.aircraft}\n                    onChange={(e) => setFormData({...formData, aircraft: e.target.value})}\n                    placeholder=\"N123AB\"\n                    className=\"w-full bg-background border border-border rounded-lg px-3 py-2 text-foreground\"\n                    required\n                  />\n                </div>\n                <div>\n                  <label className=\"block text-xs text-muted-foreground mb-1\">From</label>\n                  <input\n                    type=\"text\"\n                    value={formData.routeFrom}\n                    onChange={(e) => setFormData({...formData, routeFrom: e.target.value.toUpperCase()})}\n                    placeholder=\"KABC\"\n                    className=\"w-full bg-background border border-border rounded-lg px-3 py-2 text-foreground uppercase\"\n                    required\n                  />\n                </div>\n                <div>\n                  <label className=\"block text-xs text-muted-foreground mb-1\">To</label>\n                  <input\n                    type=\"text\"\n                    value={formData.routeTo}\n                    onChange={(e) => setFormData({...formData, routeTo: e.target.value.toUpperCase()})}\n                    placeholder=\"KXYZ\"\n                    className=\"w-full bg-background border border-border rounded-lg px-3 py-2 text-foreground uppercase\"\n                    required\n                  />\n                </div>\n              </div>\n\n              <div className=\"grid md:grid-cols-7 gap-4\">\n                <div>\n                  <label className=\"block text-xs text-muted-foreground mb-1\">Total</label>\n                  <input\n                    type=\"number\"\n                    step=\"0.1\"\n                    value={formData.totalTime}\n                    onChange={(e) => setFormData({...formData, totalTime: e.target.value})}\n                    className=\"w-full bg-background border border-border rounded-lg px-3 py-2 text-foreground\"\n                    placeholder=\"1.5\"\n                  />\n                </div>\n                <div>\n                  <label className=\"block text-xs text-muted-foreground mb-1\">Solo</label>\n                  <input\n                    type=\"number\"\n                    step=\"0.1\"\n                    value={formData.soloTime}\n                    onChange={(e) => setFormData({...formData, soloTime: e.target.value})}\n                    className=\"w-full bg-background border border-border rounded-lg px-3 py-2 text-foreground\"\n                    placeholder=\"0\"\n                  />\n                </div>\n                <div>\n                  <label className=\"block text-xs text-muted-foreground mb-1\">Dual Rec</label>\n                  <input\n                    type=\"number\"\n                    step=\"0.1\"\n                    value={formData.dualReceived}\n                    onChange={(e) => setFormData({...formData, dualReceived: e.target.value})}\n                    className=\"w-full bg-background border border-border rounded-lg px-3 py-2 text-foreground\"\n                    placeholder=\"0\"\n                  />\n                </div>\n                <div>\n                  <label className=\"block text-xs text-muted-foreground mb-1\">Night</label>\n                  <input\n                    type=\"number\"\n                    step=\"0.1\"\n                    value={formData.nightTime}\n                    onChange={(e) => setFormData({...formData, nightTime: e.target.value})}\n                    className=\"w-full bg-background border border-border rounded-lg px-3 py-2 text-foreground\"\n                    placeholder=\"0\"\n                  />\n                </div>\n                <div>\n                  <label className=\"block text-xs text-muted-foreground mb-1\">Instrument</label>\n                  <input\n                    type=\"number\"\n                    step=\"0.1\"\n                    value={formData.instrumentTime}\n                    onChange={(e) => setFormData({...formData, instrumentTime: e.target.value})}\n                    className=\"w-full bg-background border border-border rounded-lg px-3 py-2 text-foreground\"\n                    placeholder=\"0\"\n                  />\n                </div>\n                <div>\n                  <label className=\"block text-xs text-muted-foreground mb-1\">XC</label>\n                  <input\n                    type=\"number\"\n                    step=\"0.1\"\n                    value={formData.crossCountryTime}\n                    onChange={(e) => setFormData({...formData, crossCountryTime: e.target.value})}\n                    className=\"w-full bg-background border border-border rounded-lg px-3 py-2 text-foreground\"\n                    placeholder=\"0\"\n                  />\n                </div>\n                <div>\n                  <label className=\"block text-xs text-muted-foreground mb-1\">Landings</label>\n                  <input\n                    type=\"number\"\n                    value={formData.dayLandings}\n                    onChange={(e) => setFormData({...formData, dayLandings: e.target.value})}\n                    className=\"w-full bg-background border border-border rounded-lg px-3 py-2 text-foreground\"\n                    placeholder=\"0\"\n                  />\n                </div>\n              </div>\n\n              <div>\n                <label className=\"block text-xs text-muted-foreground mb-1\">Remarks</label>\n                <textarea\n                  value={formData.remarks}\n                  onChange={(e) => setFormData({...formData, remarks: e.target.value})}\n                  className=\"w-full bg-background border border-border rounded-lg px-3 py-2 text-foreground h-20\"\n                  placeholder=\"Flight notes...\"\n                />\n              </div>\n\n              <button\n                type=\"submit\"\n                disabled={saving}\n                className=\"bg-green-600 hover:bg-green-700 disabled:opacity-50 text-white px-6 py-2 rounded-lg\"\n              >\n                {saving ? 'Saving...' : 'Save Entry'}\n              </button>\n            </form>\n          </div>\n        )}\n\n        {/* Entries Table */}\n        <div className=\"bg-card border border-border rounded-xl overflow-hidden\">\n          {/* Table header with count */}\n          <div className=\"flex items-center justify-between px-4 py-2 bg-muted/50 border-b border-border\">\n            <span className=\"text-xs text-muted-foreground\">\n              Showing {filteredEntries.length} of {entries.length} entries\n            </span>\n            {(filterYear !== 'all' || filterAircraft !== 'all' || searchQuery) && (\n              <span className=\"text-xs text-primary\">\n                (Filtered)\n              </span>\n            )}\n          </div>\n          <div className=\"overflow-x-auto\">\n            <table className=\"w-full text-sm\">\n              <thead className=\"bg-muted\">\n                <tr>\n                  <th className=\"px-4 py-3 text-left text-muted-foreground font-medium\">Date</th>\n                  <th className=\"px-4 py-3 text-left text-muted-foreground font-medium\">Aircraft</th>\n                  <th className=\"px-4 py-3 text-left text-muted-foreground font-medium\">Route</th>\n                  <th className=\"px-4 py-3 text-center text-muted-foreground font-medium\">Total</th>\n                  <th className=\"px-4 py-3 text-center text-muted-foreground font-medium\">Solo</th>\n                  <th className=\"px-4 py-3 text-center text-muted-foreground font-medium\">Night</th>\n                  <th className=\"px-4 py-3 text-center text-muted-foreground font-medium\">Inst</th>\n                  <th className=\"px-4 py-3 text-center text-muted-foreground font-medium\">XC</th>\n                  <th className=\"px-4 py-3 text-center text-muted-foreground font-medium\">Ldg</th>\n                  <th className=\"px-4 py-3 text-right text-muted-foreground font-medium\">Actions</th>\n                </tr>\n              </thead>\n              <tbody>\n                {filteredEntries.length === 0 ? (\n                  <tr>\n                    <td colSpan={10} className=\"px-4 py-8 text-center text-muted-foreground\">\n                      {entries.length === 0 \n                        ? 'No entries yet. Click \"Add Entry\" to log your first flight!'\n                        : 'No entries match your filters. Try adjusting your search criteria.'\n                      }\n                    </td>\n                  </tr>\n                ) : (\n                  filteredEntries.map((entry) => (\n                    <tr key={entry.id} className=\"border-t border-border hover:bg-muted/50\">\n                      <td className=\"px-4 py-3 text-foreground\">\n                        {new Date(entry.date).toLocaleDateString()}\n                      </td>\n                      <td className=\"px-4 py-3 text-foreground\">{entry.aircraft}</td>\n                      <td className=\"px-4 py-3 text-foreground\">\n                        {entry.routeFrom} â†’ {entry.routeTo}\n                      </td>\n                      <td className=\"px-4 py-3 text-center text-foreground\">{entry.totalTime.toFixed(1)}</td>\n                      <td className=\"px-4 py-3 text-center text-green-600\">{entry.soloTime > 0 ? entry.soloTime.toFixed(1) : '-'}</td>\n                      <td className=\"px-4 py-3 text-center text-purple-600\">{entry.nightTime > 0 ? entry.nightTime.toFixed(1) : '-'}</td>\n                      <td className=\"px-4 py-3 text-center text-amber-600\">{entry.instrumentTime > 0 ? entry.instrumentTime.toFixed(1) : '-'}</td>\n                      <td className=\"px-4 py-3 text-center text-blue-600\">{entry.crossCountryTime > 0 ? entry.crossCountryTime.toFixed(1) : '-'}</td>\n                      <td className=\"px-4 py-3 text-center text-foreground\">{entry.dayLandings + entry.nightLandings}</td>\n                      <td className=\"px-4 py-3 text-right\">\n                        <button\n                          onClick={() => handleDelete(entry.id)}\n                          className=\"text-red-600 hover:text-red-700 text-xs\"\n                        >\n                          Delete\n                        </button>\n                      </td>\n                    </tr>\n                  ))\n                )}\n              </tbody>\n            </table>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\marketplace\\MarketplaceMap.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'selectedId' is defined but never used.","line":37,"column":52,"nodeType":"Identifier","messageId":"unusedVar","endLine":37,"endColumn":62}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useEffect } from 'react';\nimport { MapContainer, TileLayer, Marker, Popup, useMap } from 'react-leaflet';\nimport L from 'leaflet';\nimport 'leaflet/dist/leaflet.css';\n\nconst defaultIcon = new L.Icon({\n  iconUrl: 'https://unpkg.com/leaflet@1.9.3/dist/images/marker-icon.png',\n  shadowUrl: 'https://unpkg.com/leaflet@1.9.3/dist/images/marker-shadow.png',\n  iconSize: [25, 41],\n  iconAnchor: [12, 41],\n});\n\nL.Marker.prototype.options.icon = defaultIcon;\n\nexport interface MarketplaceMapListing {\n  id: string;\n  title: string;\n  latitude?: number | null;\n  longitude?: number | null;\n  airportIcao: string;\n  airportName?: string | null;\n  type: string;\n  price?: number | null;\n  sharePercent?: number | null;\n}\n\ninterface MarketplaceMapProps {\n  listings: MarketplaceMapListing[];\n  selectedId?: string | null;\n  onSelect?: (id: string) => void;\n}\n\nconst DEFAULT_CENTER: [number, number] = [39.8283, -98.5795];\n\nexport default function MarketplaceMap({ listings, selectedId, onSelect }: MarketplaceMapProps) {\n  const validListings = listings.filter((listing) =>\n    typeof listing.latitude === 'number' && typeof listing.longitude === 'number'\n  );\n\n  return (\n    <MapContainer\n      center={DEFAULT_CENTER}\n      zoom={4}\n      className=\"w-full h-[480px] rounded-2xl overflow-hidden\"\n      scrollWheelZoom={false}\n    >\n      <MapBounds listings={validListings} />\n      <TileLayer\n        attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n        url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n      />\n      {validListings.map((listing) => (\n        <Marker\n          key={listing.id}\n          position={[listing.latitude!, listing.longitude!]}\n          eventHandlers={{\n            click: () => onSelect?.(listing.id),\n          }}\n        >\n          <Popup>\n            <div className=\"space-y-1\">\n              <div className=\"font-semibold\">{listing.title}</div>\n              <div className=\"text-xs text-muted-foreground\">{listing.airportIcao}</div>\n              {listing.price && (\n                <div className=\"text-sm\">${listing.price.toLocaleString()}</div>\n              )}\n              {listing.sharePercent && (\n                <div className=\"text-xs text-muted-foreground\">Share: {listing.sharePercent}%</div>\n              )}\n            </div>\n          </Popup>\n        </Marker>\n      ))}\n    </MapContainer>\n  );\n}\n\nfunction MapBounds({ listings }: { listings: MarketplaceMapListing[] }) {\n  const map = useMap();\n  useEffect(() => {\n    if (!map || listings.length === 0) return;\n    const bounds = L.latLngBounds(listings.map((l) => [l.latitude!, l.longitude!] as L.LatLngTuple));\n    if (bounds.isValid()) {\n      map.fitBounds(bounds.pad(0.15));\n    }\n  }, [map, listings]);\n  return null;\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\marketplace\\create\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\marketplace\\listing\\[id]\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadListing'. Either include it or remove the dependency array.","line":223,"column":6,"nodeType":"ArrayExpression","endLine":223,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [id, loadListing]","fix":{"range":[8509,8513],"text":"[id, loadListing]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":231,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":231,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":285,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":285,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect, use } from 'react';\nimport Link from 'next/link';\nimport { useSession, signIn } from 'next-auth/react';\n\n// Import v0 components\nimport { ListingHeader } from '@/components/aircraft/listing-header';\nimport { QuickStats } from '@/components/aircraft/quick-stats';\nimport { ImageGallery } from '@/components/aircraft/image-gallery';\nimport { EquipmentSection } from '@/components/aircraft/equipment-section';\nimport { LocationCard } from '@/components/aircraft/location-card';\nimport { ContactSection } from '@/components/aircraft/contact-section';\nimport { Button } from '@/components/ui/button';\n\r\ninterface Listing {\r\n  id: string;\r\n  type: string;\r\n  title: string;\r\n  description: string | null;\r\n  aircraftType: string;\r\n  airportIcao: string;\r\n  airportName: string | null;\r\n  airportCity: string | null;\r\n  price: number | null;\r\n  sharePercent: number | null;\r\n  images: string[];\r\n  nNumber: string | null;\r\n  make: string | null;\r\n  model: string | null;\r\n  year: number | null;\r\n  totalTime: number | null;\r\n  engineTime: number | null;\r\n  propTime: number | null;\r\n  registrationType: string | null;\r\n  airworthiness: string | null;\r\n  fuelType: string | null;\r\n  avionics: string[] | null;\r\n  features: string[] | null;\r\n  upgrades: string[] | null;\r\n  sellerType: string | null;\r\n  isVerified: boolean | null;\r\n  status?: string;\r\n  createdAt?: string;\r\n  user: {\r\n    id: string;\r\n    name: string | null;\r\n    username: string | null;\r\n  };\r\n}\r\n\r\n// Demo data for listing detail page\r\nconst DEMO_LISTINGS_DETAIL: Record<string, Listing> = {\r\n  '1': {\r\n    id: '1',\r\n    type: 'AIRCRAFT_SALE',\r\n    title: '2018 Cirrus SR22T GTS',\r\n    description: 'Exceptional SR22T with GTS package, CAPS, Airbag, FIKI, and full de-ice. This aircraft has been meticulously maintained with all logs available. Features include:\\n\\nâ€¢ Garmin Perspective+ Avionics Suite\\nâ€¢ GFC 700 Autopilot\\nâ€¢ CAPS (Cirrus Airframe Parachute System)\\nâ€¢ Airbag Seatbelts\\nâ€¢ FIKI (Flight Into Known Ice)\\nâ€¢ Full De-Ice System\\nâ€¢ Heated Seats\\nâ€¢ TKS Known Ice Protection\\n\\nFresh annual completed December 2025. Always hangared. No damage history.',\r\n    aircraftType: 'SR22T',\r\n    airportIcao: 'KDVT',\r\n    airportName: 'Phoenix Deer Valley',\r\n    airportCity: 'Phoenix, AZ',\r\n    price: 725000,\r\n    sharePercent: null,\r\n    status: 'ACTIVE',\r\n    createdAt: new Date().toISOString(),\r\n    nNumber: 'N412CT',\r\n    make: 'Cirrus',\r\n    model: 'SR22T',\r\n    year: 2018,\r\n    totalTime: 1247,\r\n    engineTime: 423,\r\n    propTime: 423,\r\n    registrationType: 'Standard',\r\n    airworthiness: 'Current',\r\n    fuelType: '100LL',\r\n    sellerType: 'DEALER',\r\n    isVerified: true,\r\n    avionics: ['Garmin Perspective+', 'GFC 700 Autopilot', 'GDL 69A XM Weather', 'GTX 345 ADS-B In/Out', 'GTS 825 TAS', 'GMA 350c Audio Panel', 'Synthetic Vision (SVT)', 'SafeTaxi'],\r\n    features: ['Air Conditioning', 'TKS Known Ice', 'CAPS Parachute', 'Heated Seats', 'Premium Leather Interior', 'USB Charging Ports', 'CO Detector', 'Oxygen System'],\r\n    upgrades: ['Enhanced Vision System (EVS)', 'LED Landing Lights', 'Premium Paint Scheme', 'Bose A20 Headsets (4)', 'Tanis Engine Heater'],\r\n    user: { id: 'user1', name: 'Cirrus Aviation Partners', username: 'cirrusav' },\r\n    images: ['https://images.unsplash.com/photo-1559627755-0b42f3014507?w=800&q=80'],\r\n  },\r\n  '2': {\r\n    id: '2',\r\n    type: 'FOR_SALE',\r\n    title: '1978 Piper Archer II',\r\n    description: 'Well maintained, fresh annual, hangared. Always hangared since new. Complete logs from new. Recently upgraded with modern avionics.',\r\n    aircraftType: 'PA-28-181',\r\n    airportIcao: 'KAPA',\r\n    airportName: 'Centennial Airport',\r\n    airportCity: 'Denver, CO',\r\n    price: 165000,\r\n    sharePercent: null,\r\n    status: 'ACTIVE',\r\n    createdAt: new Date().toISOString(),\r\n    nNumber: 'N5432P',\r\n    make: 'Piper',\r\n    model: 'Archer II',\r\n    year: 1978,\r\n    totalTime: 4120,\r\n    engineTime: 850,\r\n    propTime: 120,\r\n    registrationType: 'Standard',\r\n    airworthiness: 'Current',\r\n    fuelType: '100LL',\r\n    sellerType: 'OWNER',\r\n    isVerified: true,\r\n    avionics: ['Garmin G500', 'GTX 327 Transponder', 'GMA 340 Audio Panel'],\r\n    features: ['Hangared', 'Fresh Annual', 'Complete Logs'],\r\n    upgrades: ['New Paint (2023)', 'New Interior (2022)'],\r\n    user: { id: 'user2', name: 'Denver Aviation', username: 'denav' },\r\n    images: ['https://images.unsplash.com/photo-1540962351504-03099e0a778a?w=800&q=80'],\r\n  },\r\n  '3': {\r\n    id: '3',\r\n    type: 'SHARE_SELL',\r\n    title: 'C172 Partnership - 25% Share',\r\n    description: 'Great opportunity to join a well-maintained C172 at KSDL. Perfect for students and cross-country training. Monthly costs are approximately $450/month which covers hangar, insurance, and maintenance reserve.',\r\n    aircraftType: 'Cessna 172S',\r\n    airportIcao: 'KSDL',\r\n    airportName: 'Scottsdale Airport',\r\n    airportCity: 'Scottsdale, AZ',\r\n    price: 45000,\r\n    sharePercent: 25,\r\n    status: 'ACTIVE',\r\n    createdAt: new Date().toISOString(),\r\n    nNumber: null,\r\n    make: 'Cessna',\r\n    model: '172S',\r\n    year: 2015,\r\n    totalTime: 2150,\r\n    engineTime: 450,\r\n    propTime: 450,\r\n    registrationType: 'Standard',\r\n    airworthiness: 'Current',\r\n    fuelType: '100LL',\r\n    sellerType: 'OWNER',\r\n    isVerified: false,\r\n    avionics: ['Garmin G1000', 'GFC 700 Autopilot'],\r\n    features: ['Well Maintained', 'Perfect for Training', 'Low Monthly Costs'],\r\n    upgrades: [],\r\n    user: { id: 'user3', name: 'Desert Flyers Club', username: 'desertflyers' },\r\n    images: ['https://images.unsplash.com/photo-1569154941061-e231b4725ef1?w=800&q=80'],\r\n  },\r\n  '4': {\r\n    id: '4',\r\n    type: 'AIRCRAFT_SALE',\r\n    title: '2020 Diamond DA40 NG',\r\n    description: 'Brand new Diamond DA40 NG with G1000 NXi, FIKI, and full de-ice. Low hours, excellent condition. Manufacturer warranty still valid.',\r\n    aircraftType: 'DA40',\r\n    airportIcao: 'KORD',\r\n    airportName: \"Chicago O'Hare International\",\r\n    airportCity: 'Chicago, IL',\r\n    price: 485000,\r\n    sharePercent: null,\r\n    status: 'ACTIVE',\r\n    createdAt: new Date().toISOString(),\r\n    nNumber: 'N888DG',\r\n    make: 'Diamond',\r\n    model: 'DA40 NG',\r\n    year: 2020,\r\n    totalTime: 380,\r\n    engineTime: 380,\r\n    propTime: 380,\r\n    registrationType: 'Standard',\r\n    airworthiness: 'Current',\r\n    fuelType: 'Jet-A',\r\n    sellerType: 'DEALER',\r\n    isVerified: true,\r\n    avionics: ['Garmin G1000 NXi', 'GFC 500 Autopilot', 'GTX 345 ADS-B'],\r\n    features: ['FIKI', 'Full De-Ice', 'Low Hours', 'Warranty'],\r\n    upgrades: ['G1000 NXi Upgrade'],\r\n    user: { id: 'user4', name: 'Midwest Aviation', username: 'mwav' },\r\n    images: ['https://images.unsplash.com/photo-1584634731339-252c581abfc5?w=800&q=80'],\r\n  },\r\n  '5': {\r\n    id: '5',\r\n    type: 'FOR_SALE',\r\n    title: '1967 Beechcraft Bonanza V35',\r\n    description: 'Classic V-tail Bonanza with recent renovation. New paint, interior, and avionics upgrade. Great flying aircraft with classic lines.',\r\n    aircraftType: 'V35',\r\n    airportIcao: 'KSNA',\r\n    airportName: 'John Wayne Airport',\r\n    airportCity: 'Santa Ana, CA',\r\n    price: 285000,\r\n    sharePercent: null,\r\n    status: 'ACTIVE',\r\n    createdAt: new Date().toISOString(),\r\n    nNumber: 'N5678B',\r\n    make: 'Beechcraft',\r\n    model: 'Bonanza V35',\r\n    year: 1967,\r\n    totalTime: 4850,\r\n    engineTime: 450,\r\n    propTime: 125,\r\n    registrationType: 'Standard',\r\n    airworthiness: 'Current',\r\n    fuelType: '100LL',\r\n    sellerType: 'OWNER',\r\n    isVerified: true,\r\n    avionics: ['Garmin GTN 650', 'G5 EI', 'PS Engineering Audio'],\r\n    features: ['New Paint', 'New Interior', 'Classic V-Tail'],\r\n    upgrades: ['Engine Upgrade', 'Avionics Upgrade'],\r\n    user: { id: 'user5', name: 'West Coast Aircraft', username: 'wca' },\r\n    images: ['https://images.unsplash.com/photo-1473968512647-3e447244af8f?w=800&q=80'],\r\n  },\r\n};\r\n\r\nexport default function ListingDetailPage({ params }: { params: Promise<{ id: string }> }) {\n  const { id } = use(params);\n  const { data: session } = useSession();\n  const [listing, setListing] = useState<Listing | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [showContactForm, setShowContactForm] = useState(false);\n  const [contactMessage, setContactMessage] = useState('');\n  const [submitting, setSubmitting] = useState(false);\n\r\n  useEffect(() => {\r\n    loadListing();\r\n  }, [id]);\r\n\r\n  async function loadListing() {\r\n    try {\r\n      const res = await fetch(`/api/marketplace/listings/${id}`);\r\n      if (!res.ok) throw new Error('Listing not found');\r\n      const data = await res.json();\r\n      setListing(data.listing);\r\n    } catch (err) {\r\n      // Fall back to demo data if API fails\r\n      if (DEMO_LISTINGS_DETAIL[id]) {\r\n        setListing(DEMO_LISTINGS_DETAIL[id]);\r\n      } else {\r\n        setError('Listing not found');\r\n      }\r\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  function handleContact() {\n    if (!session) {\n      signIn();\n      return;\n    }\n    setShowContactForm(true);\n  }\n\n  function handleMakeOffer() {\n    if (!session) {\n      signIn();\n      return;\n    }\n    setShowContactForm(true);\n  }\n\n  async function handleSubmitContact(e: React.FormEvent) {\n    e.preventDefault();\n    if (!session || !contactMessage.trim() || !listing) return;\n    \n    setSubmitting(true);\n    try {\n      // Create conversation and send message\n      const res = await fetch('/api/conversations', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          userId: listing.user.id,\n          listingId: listing.id,\n          message: `Inquiry about: ${listing.title}\\n\\n${contactMessage}`,\n        }),\n      });\n      \n      if (res.ok) {\n        const data = await res.json();\n        // Show success and redirect to messages\n        alert('Message sent! Redirecting to your messages...');\n        window.location.href = `/modules/social/messages?newConversation=${data.conversationId}`;\n      } else {\n        const error = await res.json();\n        alert(error.error || 'Failed to send message. Please try again.');\n      }\n    } catch (err) {\n      alert('Failed to send message. Please try again.');\n    } finally {\n      setSubmitting(false);\n    }\n  }\n\n  if (loading) {\n    return <div className=\"min-h-screen bg-background flex items-center justify-center text-muted-foreground\">Loading...</div>;\r\n  }\r\n\r\n  if (error || !listing) {\r\n    return (\r\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"text-red-400 mb-2\">{error || 'Listing not found'}</div>\r\n          <Link href=\"/modules/marketplace\" className=\"text-primary hover:underline\">â† Back</Link>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const images = listing.images?.length ? listing.images : ['https://images.unsplash.com/photo-1559627755-0b42f3014507?w=800&q=80'];\n\n  return (\n    <div className=\"min-h-screen bg-background text-foreground\">\n      {/* Contact Form Modal */}\n      {showContactForm && (\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4\">\n          <div className=\"w-full max-w-md rounded-2xl border border-border bg-card p-6\">\n            <h3 className=\"text-lg font-semibold\">Contact Seller</h3>\n            <p className=\"mt-1 text-sm text-muted-foreground\">Send a message about this listing</p>\n            <form onSubmit={handleSubmitContact} className=\"mt-4 space-y-4\">\n              <div>\n                <textarea\n                  value={contactMessage}\n                  onChange={(e) => setContactMessage(e.target.value)}\n                  placeholder=\"I'm interested in this aircraft...\"\n                  className=\"w-full min-h-[120px] rounded-xl border border-border bg-background px-4 py-3 text-sm placeholder:text-muted-foreground focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20\"\n                  required\n                />\n              </div>\n              <div className=\"flex gap-3\">\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  className=\"flex-1\"\n                  onClick={() => setShowContactForm(false)}\n                >\n                  Cancel\n                </Button>\n                <Button\n                  type=\"submit\"\n                  className=\"flex-1\"\n                  disabled={submitting}\n                >\n                  {submitting ? 'Sending...' : 'Send Message'}\n                </Button>\n              </div>\n            </form>\n          </div>\n        </div>\n      )}\n\n      <main className=\"max-w-7xl mx-auto px-4 py-10\">\n        <div className=\"flex items-center justify-between gap-2 text-sm text-muted-foreground\">\r\n          <Link href=\"/modules/marketplace\" className=\"inline-flex items-center gap-2 rounded-lg border border-border px-3 py-1.5 text-xs font-medium text-muted-foreground transition hover:border-primary/40 hover:text-foreground\">\r\n            <span>â†</span>\r\n            <span>Back to Marketplace</span>\r\n          </Link>\r\n          <span className=\"font-mono text-xs\">#{listing.id.slice(0, 8).toUpperCase()}</span>\r\n        </div>\r\n\r\n        {/* Title Section - Using v0 ListingHeader */}\r\n        <ListingHeader \r\n          title={`${listing.year ? `${listing.year} ` : ''}${listing.make || ''} ${listing.model || ''}`.trim() || listing.title}\r\n          nNumber={listing.nNumber}\r\n          price={listing.price}\r\n          isVerified={listing.isVerified}\r\n          sellerType={listing.sellerType}\r\n        />\r\n\r\n        {/* Quick Stats - Using v0 QuickStats */}\r\n        <div className=\"mt-6\">\r\n          <QuickStats \r\n            totalTime={listing.totalTime}\r\n            engineTime={listing.engineTime}\r\n            propTime={listing.propTime}\r\n            registrationType={listing.registrationType}\r\n            airworthiness={listing.airworthiness}\r\n            fuelType={listing.fuelType}\r\n            aircraftType={listing.aircraftType}\r\n            year={listing.year}\r\n            make={listing.make}\r\n          />\r\n        </div>\r\n\r\n        {/* Main Content */}\r\n        <div className=\"mt-8 grid gap-8 lg:grid-cols-[1fr_360px]\">\r\n          <div className=\"flex flex-col gap-8\">\r\n            {/* Image Gallery - Using v0 component */}\r\n            <ImageGallery images={images} />\r\n\r\n            {/* Description */}\r\n            {listing.description && (\r\n              <section className=\"rounded-xl border border-border bg-card p-6\">\r\n                <h2 className=\"text-lg font-semibold text-foreground\">Description</h2>\r\n                <p className=\"mt-4 text-muted-foreground whitespace-pre-wrap\">{listing.description}</p>\r\n              </section>\r\n            )}\r\n\r\n            {/* Equipment - Using v0 component */}\r\n            {(listing.avionics?.length || listing.features?.length || listing.upgrades?.length) && (\r\n              <EquipmentSection \r\n                avionics={listing.avionics}\r\n                features={listing.features}\r\n                upgrades={listing.upgrades}\r\n              />\r\n            )}\r\n          </div>\r\n\r\n          {/* Sidebar */}\r\n          <aside className=\"flex flex-col gap-6 lg:sticky lg:top-20 lg:self-start\">\r\n            {/* Contact Card - Using v0 component */}\n            <ContactSection \n              sellerName={listing.user.name || listing.user.username || \"Seller\"}\n              sellerType={listing.sellerType}\n              onContact={handleContact}\n              onMakeOffer={handleMakeOffer}\n            />\n\r\n            {/* Location Card - Using v0 component */}\r\n            <LocationCard \r\n              airportIcao={listing.airportIcao}\r\n              airportName={listing.airportName}\r\n              airportCity={listing.airportCity}\r\n            />\r\n          </aside>\r\n        </div>\r\n      </main>\r\n\r\n      {/* Footer */}\r\n      <footer className=\"mt-16 border-t border-border bg-card\">\r\n        <div className=\"max-w-7xl mx-auto flex items-center justify-between px-4 py-6\">\r\n          <p className=\"text-xs text-muted-foreground\">AviationHub Marketplace</p>\r\n          <p className=\"text-xs text-muted-foreground font-mono\">#{listing.id.slice(0, 8).toUpperCase()}</p>\r\n        </div>\r\n      </footer>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\marketplace\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\marketplace\\saved\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Suspense' is defined but never used.","line":1,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":18,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Suspense"},"fix":{"range":[0,33],"text":""},"desc":"Remove unused import declaration."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Suspense } from 'react'\nimport Link from 'next/link'\nimport { Heart, Plane, ArrowRight } from 'lucide-react'\nimport { Button } from '@/components/ui/button'\n\nexport default function SavedListingsPage() {\n  return (\n    <div className=\"min-h-screen bg-background text-foreground\">\n      {/* Header */}\n      <div className=\"border-b border-border bg-card/50\">\n        <div className=\"max-w-7xl mx-auto px-4 lg:px-8 py-8\">\n          <div className=\"flex items-center gap-2 text-sm text-muted-foreground mb-4\">\n            <Link href=\"/modules/marketplace\" className=\"hover:text-primary transition-colors\">\n              Marketplace\n            </Link>\n            <span>/</span>\n            <span className=\"text-foreground\">Saved Listings</span>\n          </div>\n          <h1 className=\"text-3xl font-bold\">Saved Listings</h1>\n          <p className=\"text-muted-foreground mt-2\">\n            Aircraft you&apos;ve saved for later\n          </p>\n        </div>\n      </div>\n\n      {/* Content */}\n      <div className=\"max-w-7xl mx-auto px-4 lg:px-8 py-12\">\n        <div className=\"text-center py-16\">\n          <div className=\"inline-flex items-center justify-center w-16 h-16 rounded-full bg-primary/10 mb-4\">\n            <Heart className=\"w-8 h-8 text-primary\" />\n          </div>\n          <h2 className=\"text-xl font-semibold mb-2\">No saved listings yet</h2>\n          <p className=\"text-muted-foreground mb-6 max-w-md mx-auto\">\n            Browse aircraft listings and click the heart icon to save your favorites.\n          </p>\n          <Link href=\"/modules/marketplace\">\n            <Button className=\"gap-2\">\n              <Plane className=\"w-4 h-4\" />\n              Browse Listings\n              <ArrowRight className=\"w-4 h-4\" />\n            </Button>\n          </Link>\n        </div>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\pilot-directory\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'status' is assigned a value but never used.","line":76,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":76,"endColumn":32},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":84,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2756,2759],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2756,2759],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":85,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2827,2830],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2827,2830],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchProfiles'. Either include it or remove the dependency array.","line":104,"column":6,"nodeType":"ArrayExpression","endLine":104,"endColumn":39,"suggestions":[{"desc":"Update the dependencies array to be: [filters.rating, filters.airport, fetchProfiles]","fix":{"range":[3392,3425],"text":"[filters.rating, filters.airport, fetchProfiles]"}}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport Link from 'next/link';\nimport { useEffect, useMemo, useState } from 'react';\nimport { useSession, signIn } from 'next-auth/react';\nimport { checkMessageSafety } from '@/lib/message-safety';\nimport { encryptForUser, publishMyPublicKey } from '@/lib/e2ee';\n\r\ninterface PilotProfile {\r\n  id: string;\r\n  userId: string;\r\n  homeAirport?: string | null;\r\n  ratings: string[];\r\n  availability?: string | null;\r\n  aircraft?: string | null;\r\n  hours?: number | null;\r\n  bio?: string | null;\r\n  user?: {\r\n    id: string;\r\n    name?: string | null;\r\n    username?: string | null;\r\n    email?: string | null;\r\n    tier?: string | null;\r\n  } | null;\r\n}\r\n\r\nconst RATING_OPTIONS = ['Student', 'PPL', 'Instrument', 'Commercial', 'CFI', 'CFII', 'MEI', 'ATP'];\nconst AVAILABILITY_OPTIONS = ['Weekdays', 'Weekends', 'Evenings', 'Anytime'];\n\r\nconst initialProfileState = {\n  homeAirport: '',\n  availability: '',\n  aircraft: '',\n  hours: '',\n  bio: '',\n  ratings: [] as string[],\n};\n\nconst DEMO_PROFILES: PilotProfile[] = [\n  {\n    id: 'demo-1',\n    userId: 'demo-user',\n    homeAirport: 'KAPA',\n    ratings: ['PPL', 'Instrument'],\n    availability: 'Weekends',\n    aircraft: 'C172S, PA-28',\n    hours: 320,\n    bio: 'Weekend IFR currency runs and cross-country trips.',\n    user: { id: 'demo-user', name: 'Liam Carter', username: 'liamc', email: 'liam@example.com', tier: 'pro' },\n  },\n  {\n    id: 'demo-2',\n    userId: 'demo-user',\n    homeAirport: 'KDAL',\n    ratings: ['Commercial', 'CFI'],\n    availability: 'Weekdays',\n    aircraft: 'SR22, C182T',\n    hours: 1450,\n    bio: 'Looking for safety pilots and ferry opportunities.',\n    user: { id: 'demo-user', name: 'Sofia Nguyen', username: 'sofiaflys', email: 'sofia@example.com', tier: 'proplus' },\n  },\n  {\n    id: 'demo-3',\n    userId: 'demo-user',\n    homeAirport: 'KSMO',\n    ratings: ['Student'],\n    availability: 'Evenings',\n    aircraft: 'C152',\n    hours: 48,\n    bio: 'Student pilot building time. Happy to split time for practice.',\n    user: { id: 'demo-user', name: 'Marcus Reed', username: 'marcusreed', email: 'marcus@example.com', tier: 'free' },\n  },\n];\n\r\nexport default function PilotDirectoryPage() {\n  const { data: session, status } = useSession();\n  const [profiles, setProfiles] = useState<PilotProfile[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [filters, setFilters] = useState({ query: '', rating: 'ALL', airport: '' });\n  const [myProfile, setMyProfile] = useState<typeof initialProfileState>(initialProfileState);\n  const [profileLoading, setProfileLoading] = useState(false);\n  const [editMode, setEditMode] = useState(false);\n  const [friends, setFriends] = useState<{ id: string }[]>([]);\n  const [incomingRequests, setIncomingRequests] = useState<any[]>([]);\n  const [outgoingRequests, setOutgoingRequests] = useState<any[]>([]);\n  const [friendActionMessage, setFriendActionMessage] = useState<string | null>(null);\n  const [friendDraftFor, setFriendDraftFor] = useState<string | null>(null);\n  const [friendDraftMessage, setFriendDraftMessage] = useState('');\n\n  function countSentences(input: string) {\n    const cleaned = input\n      .replace(/\\s+/g, ' ')\n      .trim();\n    if (!cleaned) return 0;\n    const parts = cleaned\n      .split(/[.!?]+/)\n      .map((s) => s.trim())\n      .filter(Boolean);\n    return parts.length;\n  }\n\r\n  useEffect(() => {\r\n    fetchProfiles();\r\n  }, [filters.rating, filters.airport]);\r\n\r\n  useEffect(() => {\n    if (session?.user?.id) {\n      publishMyPublicKey().catch(() => {});\n      fetchMyProfile();\n      loadFriendState();\n    }\n  }, [session]);\n\r\n  const filteredProfiles = useMemo(() => {\r\n    return profiles.filter((profile) => {\r\n      if (filters.rating !== 'ALL' && !profile.ratings?.includes(filters.rating)) return false;\r\n      if (filters.airport && profile.homeAirport !== filters.airport.toUpperCase()) return false;\r\n      if (!filters.query) return true;\r\n      const q = filters.query.toLowerCase();\r\n      return (\r\n        (profile.user?.name || '').toLowerCase().includes(q) ||\r\n        (profile.user?.username || '').toLowerCase().includes(q) ||\r\n        (profile.aircraft || '').toLowerCase().includes(q) ||\r\n        (profile.bio || '').toLowerCase().includes(q)\r\n      );\r\n    });\r\n  }, [profiles, filters]);\r\n\r\n  async function fetchProfiles() {\n    setLoading(true);\n    try {\n      const params = new URLSearchParams();\n      if (filters.rating !== 'ALL') params.set('rating', filters.rating);\n      if (filters.airport) params.set('airport', filters.airport.toUpperCase());\n      const res = await fetch(`/api/pilots?${params.toString()}`);\n      const data = await res.json();\n      const nextProfiles = data.profiles || [];\n      setProfiles(nextProfiles.length ? nextProfiles : DEMO_PROFILES);\n    } catch (error) {\n      console.error('Failed to load pilot profiles', error);\n      setProfiles(DEMO_PROFILES);\n    } finally {\n      setLoading(false);\n    }\n  }\n\r\n  async function fetchMyProfile() {\n    try {\r\n      const res = await fetch('/api/pilots/me');\r\n      const data = await res.json();\r\n      if (data.profile) {\r\n        setMyProfile({\r\n          homeAirport: data.profile.homeAirport || '',\r\n          availability: data.profile.availability || '',\r\n          aircraft: data.profile.aircraft || '',\r\n          bio: data.profile.bio || '',\r\n          hours: data.profile.hours?.toString() || '',\r\n          ratings: data.profile.ratings || [],\r\n        });\r\n      } else {\r\n        setMyProfile(initialProfileState);\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to load personal profile', error);\r\n    }\r\n  }\n\n  async function loadFriendState() {\n    try {\n      const [friendsRes, requestsRes] = await Promise.all([\n        fetch('/api/friends'),\n        fetch('/api/friends/requests'),\n      ]);\n      const friendsData = await friendsRes.json();\n      const requestsData = await requestsRes.json();\n      setFriends(friendsData.friends || []);\n      setIncomingRequests(requestsData.incoming || []);\n      setOutgoingRequests(requestsData.outgoing || []);\n    } catch (error) {\n      console.error('Failed to load friend status', error);\n    }\n  }\n\n  async function sendFriendRequest(userId: string, initialMessage?: string) {\n    try {\n      let initialMessageEnvelope: string | null = null;\n      const message = (initialMessage || '').trim();\n      if (message) {\n        const safety = checkMessageSafety(message);\n        if (!safety.ok) {\n          setFriendActionMessage(safety.error);\n          return;\n        }\n        const encrypted = await encryptForUser(userId, message);\n        if (encrypted.ok) initialMessageEnvelope = encrypted.envelopeString;\n      }\n\n      const res = await fetch('/api/friends/requests', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          recipientId: userId,\n          initialMessageEnvelope: initialMessageEnvelope || undefined,\n        }),\n      });\n      const data = await res.json();\n      if (!res.ok) {\n        throw new Error(data.error || 'Failed to send request');\n      }\n      setFriendActionMessage('Friend request sent');\n      setFriendDraftFor(null);\n      setFriendDraftMessage('');\n      await loadFriendState();\n    } catch (error) {\n      console.error(error);\n      setFriendActionMessage(error instanceof Error ? error.message : 'Failed to send request');\n    }\n  }\n\n  async function respondToRequest(requestId: string, action: 'accept' | 'decline') {\n    try {\n      const res = await fetch(`/api/friends/requests/${requestId}`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ action, seedInitialMessage: action === 'accept' }),\n      });\n      const data = await res.json();\n      if (!res.ok) {\n        throw new Error(data.error || 'Failed to update request');\n      }\n      setFriendActionMessage(action === 'accept' ? 'Friend request accepted' : 'Friend request declined');\n      await loadFriendState();\n\n      if (action === 'accept' && data?.conversationId) {\n        window.dispatchEvent(new CustomEvent('open-chat', { detail: { conversationId: data.conversationId } }));\n      }\n    } catch (error) {\n      console.error(error);\n      setFriendActionMessage(error instanceof Error ? error.message : 'Failed to update request');\n    }\n  }\n\n  async function openChatWithUser(userId: string) {\n    if (!session) {\n      signIn();\n      return;\n    }\n    try {\n      const res = await fetch('/api/conversations', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ userId }),\n      });\n      const data = await res.json();\n      if (!res.ok) {\n        throw new Error(data.error || 'Failed to start chat');\n      }\n      window.dispatchEvent(new CustomEvent('open-chat', { detail: { conversationId: data.conversationId } }));\n    } catch (error) {\n      console.error(error);\n      setFriendActionMessage(error instanceof Error ? error.message : 'Failed to start chat');\n    }\n  }\n\r\n  function toggleRating(value: string) {\r\n    setMyProfile((prev) => {\r\n      const exists = prev.ratings.includes(value);\r\n      return {\r\n        ...prev,\r\n        ratings: exists ? prev.ratings.filter((item) => item !== value) : [...prev.ratings, value],\r\n      };\r\n    });\r\n  }\r\n\r\n  async function saveProfile(e: React.FormEvent) {\r\n    e.preventDefault();\r\n    if (!session) {\r\n      signIn();\r\n      return;\r\n    }\r\n    setProfileLoading(true);\r\n    try {\r\n      const payload = {\r\n        ...myProfile,\r\n        hours: myProfile.hours ? Number(myProfile.hours) : null,\r\n      };\r\n      const res = await fetch('/api/pilots/me', {\r\n        method: 'PUT',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(payload),\r\n      });\r\n      if (!res.ok) {\r\n        const data = await res.json();\r\n        throw new Error(data.error || 'Failed to save profile');\r\n      }\r\n      await fetchProfiles();\r\n      setEditMode(false);\r\n    } catch (error) {\r\n      console.error(error);\r\n      alert(error instanceof Error ? error.message : 'Failed to save profile');\r\n    } finally {\r\n      setProfileLoading(false);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-slate-900\">\r\n      <div className=\"border-b border-slate-800 bg-slate-900/90 sticky top-0 z-10\">\r\n        <div className=\"max-w-6xl mx-auto px-4 py-4 flex flex-col gap-3 md:flex-row md:items-center md:justify-between\">\r\n          <div>\r\n            <h1 className=\"text-3xl font-bold text-white\">ðŸ‘¥ Pilot Directory</h1>\r\n            <p className=\"text-slate-400 text-sm\">Find verified pilots, rating buddies, and potential co-owners.</p>\r\n          </div>\r\n          <div className=\"flex gap-2\">\r\n            <select\r\n              value={filters.rating}\r\n              onChange={(e) => setFilters((prev) => ({ ...prev, rating: e.target.value }))}\r\n              className=\"bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-white text-sm\"\r\n            >\r\n              <option value=\"ALL\">All Ratings</option>\r\n              {RATING_OPTIONS.map((rating) => (\r\n                <option key={rating} value={rating}>{rating}</option>\r\n              ))}\r\n            </select>\r\n            <input\r\n              type=\"text\"\r\n              value={filters.airport}\r\n              onChange={(e) => setFilters((prev) => ({ ...prev, airport: e.target.value }))}\r\n              placeholder=\"Home Airport\"\r\n              className=\"bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-white text-sm uppercase\"\r\n            />\r\n            <input\r\n              type=\"text\"\r\n              value={filters.query}\r\n              onChange={(e) => setFilters((prev) => ({ ...prev, query: e.target.value }))}\r\n              placeholder=\"Search pilots\"\r\n              className=\"bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-white text-sm\"\r\n            />\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"max-w-6xl mx-auto px-4 py-6 grid gap-6 lg:grid-cols-3\">\n        <div className=\"lg:col-span-2 space-y-4\">\n          {friendActionMessage && (\n            <div className=\"bg-emerald-500/10 border border-emerald-500/30 text-emerald-200 text-sm px-4 py-2 rounded-lg\">\n              {friendActionMessage}\n            </div>\n          )}\n          {loading ? (\n            <div className=\"bg-slate-800 border border-slate-700 rounded-2xl p-8 text-center text-slate-400\">\n              Loading pilot profilesâ€¦\n            </div>\n          ) : filteredProfiles.length === 0 ? (\r\n            <div className=\"bg-slate-800 border border-slate-700 rounded-2xl p-8 text-center text-slate-400\">\r\n              No pilots match your filters yet.\r\n            </div>\r\n          ) : (\r\n            filteredProfiles.map((profile) => (\n              <div key={profile.id} className=\"bg-slate-800 border border-slate-700 rounded-2xl p-4\">\n                <div className=\"flex items-center justify-between gap-3\">\n                  <div>\n                    <div className=\"text-white text-lg font-semibold\">\n                      {profile.user?.id ? (\n                        <Link\n                          href={`/pilots/${encodeURIComponent(profile.user?.username || profile.user.id)}`}\n                          className=\"hover:underline\"\n                        >\n                          {profile.user?.name || profile.user?.username || 'Anonymous Pilot'}\n                        </Link>\n                      ) : (\n                        profile.user?.name || profile.user?.username || 'Anonymous Pilot'\n                      )}\n                    </div>\n                    <div className=\"text-xs text-slate-400\">{profile.homeAirport || 'No home airport'}</div>\n                  </div>\n                  <div className=\"flex flex-wrap gap-2\">\n                    {profile.ratings?.map((rating) => (\n                      <span key={rating} className=\"text-xs bg-slate-700 text-slate-200 px-2 py-0.5 rounded-full\">\n                        {rating}\n                      </span>\n                    ))}\n                  </div>\n                </div>\n                {profile.user?.id && profile.user.id !== session?.user?.id && (\n                  (() => {\n                    const incomingRequest = incomingRequests.find((req) => req.requester?.id === profile.user?.id);\n                    const outgoingRequest = outgoingRequests.find((req) => req.recipient?.id === profile.user?.id);\n                    const isFriend = friends.some((friend) => friend.id === profile.user?.id);\n\n                    return (\n                   <div className=\"mt-3 flex flex-wrap gap-2\">\n                    {isFriend ? (\n                      <button\n                        onClick={() => openChatWithUser(profile.user!.id)}\n                        className=\"px-3 py-1 rounded-full text-xs bg-emerald-500/20 border border-emerald-400 text-emerald-200\"\n                      >\n                        Chat\n                      </button>\n                    ) : outgoingRequest ? (\n                      <span className=\"px-3 py-1 rounded-full text-xs bg-slate-700 text-slate-300\">\n                        Request Sent\n                      </span>\n                    ) : incomingRequest ? (\n                      <>\n                        <button\n                          onClick={() => respondToRequest(incomingRequest.id, 'accept')}\n                          className=\"px-3 py-1 rounded-full text-xs bg-emerald-500/20 border border-emerald-400 text-emerald-200\"\n                        >\n                          Accept\n                        </button>\n                        <button\n                          onClick={() => respondToRequest(incomingRequest.id, 'decline')}\n                          className=\"px-3 py-1 rounded-full text-xs bg-slate-700 text-slate-300\"\n                        >\n                          Decline\n                        </button>\n                      </>\n                    ) : (\n                      <>\n                        <button\n                          onClick={() => {\n                            setFriendDraftFor(profile.user!.id);\n                            setFriendDraftMessage('');\n                          }}\n                          className=\"px-3 py-1 rounded-full text-xs bg-slate-700 text-slate-200\"\n                        >\n                          Add Friend\n                        </button>\n                        {friendDraftFor === profile.user!.id && (\n                          <div className=\"w-full mt-2 bg-slate-900 border border-slate-700 rounded-xl p-3\">\n                            <div className=\"text-xs text-slate-400 mb-2\">\n                              Optional note (max 3 sentences). Sent encrypted (requires recipient E2EE key).\n                            </div>\n                            <textarea\n                              value={friendDraftMessage}\n                              onChange={(e) => setFriendDraftMessage(e.target.value)}\n                              rows={3}\n                              placeholder=\"Hey â€” want to connect?\"\n                              className=\"w-full bg-slate-950/40 border border-slate-700 rounded-lg px-3 py-2 text-sm text-white\"\n                            />\n                            <div className=\"mt-2 flex items-center justify-between gap-2\">\n                              <div className={`text-xs ${countSentences(friendDraftMessage) > 3 ? 'text-amber-300' : 'text-slate-500'}`}>\n                                {countSentences(friendDraftMessage)}/3 sentences\n                              </div>\n                              <div className=\"flex gap-2\">\n                                <button\n                                  onClick={() => {\n                                    setFriendDraftFor(null);\n                                    setFriendDraftMessage('');\n                                  }}\n                                  className=\"px-3 py-1 rounded-full text-xs bg-slate-800 text-slate-300\"\n                                >\n                                  Cancel\n                                </button>\n                                <button\n                                  disabled={countSentences(friendDraftMessage) > 3}\n                                  onClick={() => sendFriendRequest(profile.user!.id, friendDraftMessage)}\n                                  className=\"px-3 py-1 rounded-full text-xs bg-emerald-500/20 border border-emerald-400 text-emerald-200 disabled:opacity-50\"\n                                >\n                                  Send\n                                </button>\n                              </div>\n                            </div>\n                          </div>\n                        )}\n                      </>\n                    )}\n                  </div>\n                  );\n                })()\n              )}\n                {profile.availability && (\n                  <div className=\"text-xs text-emerald-300 mt-2\">Available: {profile.availability}</div>\n                )}\n                {profile.hours && (\r\n                  <div className=\"text-xs text-slate-400 mt-1\">Hours logged: {profile.hours.toLocaleString()}</div>\r\n                )}\r\n                {profile.aircraft && (\r\n                  <div className=\"text-sm text-slate-300 mt-3\">\r\n                    <span className=\"font-semibold text-slate-200\">Aircraft:</span> {profile.aircraft}\r\n                  </div>\r\n                )}\r\n                <p className=\"text-sm text-slate-300 mt-3\">\r\n                  {profile.bio || 'No bio yet.'}\r\n                </p>\r\n                <div className=\"text-xs text-slate-500 mt-3\">\n                  Use friend request + chat to connect.\n                </div>\n              </div>\n            ))\n          )}\n        </div>\r\n\r\n        <div className=\"bg-slate-800 border border-slate-700 rounded-2xl p-5 h-fit\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <h2 className=\"text-white font-semibold\">Your Profile</h2>\r\n            {session ? (\r\n              <button onClick={() => setEditMode((prev) => !prev)} className=\"text-xs text-emerald-400\">\r\n                {editMode ? 'Close' : 'Edit'}\r\n              </button>\r\n            ) : (\r\n              <button onClick={() => signIn()} className=\"text-xs text-emerald-400\">\r\n                Sign in\r\n              </button>\r\n            )}\r\n          </div>\r\n          {session ? (\r\n            editMode ? (\r\n              <form onSubmit={saveProfile} className=\"mt-4 space-y-4\">\r\n                <div>\r\n                  <label className=\"block text-xs text-slate-400 mb-1\">Home Airport</label>\r\n                  <input\r\n                    type=\"text\"\r\n                    value={myProfile.homeAirport}\r\n                    onChange={(e) => setMyProfile((prev) => ({ ...prev, homeAirport: e.target.value.toUpperCase() }))}\r\n                    className=\"w-full bg-slate-900 border border-slate-700 rounded-lg px-3 py-2 text-white\"\r\n                    placeholder=\"KAPA\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-xs text-slate-400 mb-1\">Availability</label>\r\n                  <select\r\n                    value={myProfile.availability}\r\n                    onChange={(e) => setMyProfile((prev) => ({ ...prev, availability: e.target.value }))}\r\n                    className=\"w-full bg-slate-900 border border-slate-700 rounded-lg px-3 py-2 text-white\"\r\n                  >\r\n                    <option value=\"\">Select availability</option>\r\n                    {AVAILABILITY_OPTIONS.map((option) => (\r\n                      <option key={option} value={option}>{option}</option>\r\n                    ))}\r\n                  </select>\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-xs text-slate-400 mb-1\">Ratings</label>\r\n                  <div className=\"flex flex-wrap gap-2\">\r\n                    {RATING_OPTIONS.map((rating) => (\r\n                      <button\r\n                        type=\"button\"\r\n                        key={rating}\r\n                        onClick={() => toggleRating(rating)}\r\n                        className={`px-3 py-1 rounded-full text-xs border ${\r\n                          myProfile.ratings.includes(rating)\r\n                            ? 'bg-emerald-500/20 border-emerald-400 text-emerald-200'\r\n                            : 'bg-slate-900 border-slate-700 text-slate-300'\r\n                        }`}\r\n                      >\r\n                        {rating}\r\n                      </button>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-xs text-slate-400 mb-1\">Aircraft You Fly / Own</label>\r\n                  <textarea\r\n                    value={myProfile.aircraft}\r\n                    onChange={(e) => setMyProfile((prev) => ({ ...prev, aircraft: e.target.value }))}\r\n                    className=\"w-full bg-slate-900 border border-slate-700 rounded-lg px-3 py-2 text-white\"\r\n                    rows={2}\r\n                    placeholder=\"C172, SR22, PA-28\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-xs text-slate-400 mb-1\">Total Hours</label>\r\n                  <input\r\n                    type=\"number\"\r\n                    value={myProfile.hours}\r\n                    onChange={(e) => setMyProfile((prev) => ({ ...prev, hours: e.target.value }))}\r\n                    className=\"w-full bg-slate-900 border border-slate-700 rounded-lg px-3 py-2 text-white\"\r\n                    placeholder=\"250\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-xs text-slate-400 mb-1\">Bio</label>\r\n                  <textarea\r\n                    value={myProfile.bio}\r\n                    onChange={(e) => setMyProfile((prev) => ({ ...prev, bio: e.target.value }))}\r\n                    className=\"w-full bg-slate-900 border border-slate-700 rounded-lg px-3 py-2 text-white\"\r\n                    rows={3}\r\n                    placeholder=\"Share your flying goals or what you're looking for.\"\r\n                  />\r\n                </div>\r\n                <div className=\"flex justify-end gap-2\">\r\n                  <button type=\"button\" onClick={() => setEditMode(false)} className=\"px-4 py-2 text-slate-300\">\r\n                    Cancel\r\n                  </button>\r\n                  <button\r\n                    type=\"submit\"\r\n                    disabled={profileLoading}\r\n                    className=\"px-4 py-2 bg-emerald-500 hover:bg-emerald-400 text-white rounded-lg\"\r\n                  >\r\n                    {profileLoading ? 'Savingâ€¦' : 'Save Profile'}\r\n                  </button>\r\n                </div>\r\n              </form>\r\n            ) : (\r\n              <div className=\"mt-4 text-sm text-slate-300 space-y-2\">\r\n                <p><span className=\"text-slate-400\">Home Airport:</span> {myProfile.homeAirport || 'Not set'}</p>\r\n                <p><span className=\"text-slate-400\">Availability:</span> {myProfile.availability || 'Not set'}</p>\r\n                <p><span className=\"text-slate-400\">Hours:</span> {myProfile.hours || '0'}</p>\r\n                <p><span className=\"text-slate-400\">Aircraft:</span> {myProfile.aircraft || 'â€”'}</p>\r\n                <p><span className=\"text-slate-400\">Ratings:</span> {myProfile.ratings.length ? myProfile.ratings.join(', ') : 'â€”'}</p>\r\n                <p className=\"text-slate-400\">{myProfile.bio || 'Add a short bio so other pilots can find you.'}</p>\r\n              </div>\r\n            )\r\n          ) : (\r\n            <p className=\"text-sm text-slate-400 mt-4\">Sign in to manage your profile.</p>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\pilot-overview\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'progress' is assigned a value but never used.","line":43,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":43,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":112,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":112,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'session' is assigned a value but never used.","line":263,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":263,"endColumn":24},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'checkSubscription'. Either include it or remove the dependency array.","line":293,"column":6,"nodeType":"ArrayExpression","endLine":293,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [checkSubscription, status]","fix":{"range":[10661,10669],"text":"[checkSubscription, status]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":309,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":309,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11218,11221],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11218,11221],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":313,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":313,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11354,11357],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11354,11357],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":318,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":318,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11433,11436],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11433,11436],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":319,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":319,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11516,11519],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11516,11519],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":332,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":332,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12282,12285],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12282,12285],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":353,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":353,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12885,12888],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12885,12888],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":354,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":354,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12972,12975],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12972,12975],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":366,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":366,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13779,13782],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13779,13782],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect, Suspense } from 'react';\r\nimport { useSession } from 'next-auth/react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { createNavLogPdfDoc, downloadNavLogPdf, getNavLogExportHistory, StoredNavLogExport } from '../fuel-saver/lib/exportUtils';\n\r\n// Import the existing components\r\nimport CurrencyTracker from '../../components/CurrencyTracker';\r\nimport HourAnalytics from '../../components/HourAnalytics';\r\n\r\ninterface TrainingProgress {\r\n  id: string;\r\n  userId: string;\r\n  totalHours: number;\r\n  soloHours: number;\r\n  nightHours: number;\r\n  instrumentHours: number;\r\n  crossCountryHours: number;\r\n  xcSoloHours: number;\r\n  xcSoloDone: boolean;\r\n  nightSoloDone: boolean;\r\n  instrumentDone: boolean;\r\n  soloDone: boolean;\r\n  threeTakeoffsLandingsDone: boolean;\r\n  threeNightTakeoffsLandingsDone: boolean;\r\n  dualGiven: number;\r\n  hoodHours: number;\r\n}\r\n\r\nconst PPL_REQUIREMENTS = {\r\n  totalHours: { required: 40, label: 'Total Flight Hours' },\r\n  soloHours: { required: 10, label: 'Solo Hours' },\r\n  nightHours: { required: 3, label: 'Night Hours' },\r\n  instrumentHours: { required: 3, label: 'Instrument Hours' },\r\n  crossCountryHours: { required: 10, label: 'Cross Country Hours' },\r\n  xcSoloHours: { required: 5, label: 'Solo XC Hours' },\r\n};\r\n\r\n// Training Overview Component - shown to all users\r\nfunction TrainingOverview() {\r\n  const { data: session } = useSession();\r\n  const [progress, setProgress] = useState<TrainingProgress | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [saving, setSaving] = useState(false);\r\n  const [localProgress, setLocalProgress] = useState({\r\n    totalHours: 0,\r\n    soloHours: 0,\r\n    nightHours: 0,\r\n    instrumentHours: 0,\r\n    crossCountryHours: 0,\r\n    xcSoloHours: 0,\r\n    xcSoloDone: false,\r\n    nightSoloDone: false,\r\n    instrumentDone: false,\r\n    soloDone: false,\r\n    threeTakeoffsLandingsDone: false,\r\n    threeNightTakeoffsLandingsDone: false,\r\n    dualGiven: 0,\r\n    hoodHours: 0,\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (session?.user?.email) {\r\n      fetchProgress();\r\n    }\r\n  }, [session]);\r\n\r\n  const fetchProgress = async () => {\r\n    try {\r\n      const res = await fetch('/api/training-progress');\r\n      if (res.ok) {\r\n        const data = await res.json();\r\n        setProgress(data);\r\n        if (data) {\r\n          setLocalProgress({\r\n            totalHours: data.totalHours || 0,\r\n            soloHours: data.soloHours || 0,\r\n            nightHours: data.nightHours || 0,\r\n            instrumentHours: data.instrumentHours || 0,\r\n            crossCountryHours: data.crossCountryHours || 0,\r\n            xcSoloHours: data.xcSoloHours || 0,\r\n            xcSoloDone: data.xcSoloDone || false,\r\n            nightSoloDone: data.nightSoloDone || false,\r\n            instrumentDone: data.instrumentDone || false,\r\n            soloDone: data.soloDone || false,\r\n            threeTakeoffsLandingsDone: data.threeTakeoffsLandingsDone || false,\r\n            threeNightTakeoffsLandingsDone: data.threeNightTakeoffsLandingsDone || false,\r\n            dualGiven: data.dualGiven || 0,\r\n            hoodHours: data.hoodHours || 0,\r\n          });\r\n        }\r\n      }\r\n    } catch (err) {\r\n      console.error('Failed to fetch progress:', err);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const saveProgress = async () => {\r\n    setSaving(true);\r\n    try {\r\n      const res = await fetch('/api/training-progress', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(localProgress),\r\n      });\r\n      if (res.ok) {\r\n        alert('Progress saved!');\r\n      }\r\n    } catch (err) {\r\n      alert('Failed to save');\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return <div className=\"text-center py-8 text-slate-400\">Loading training progress...</div>;\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"bg-slate-800 rounded-xl p-6 border border-slate-700\">\r\n        <div className=\"flex justify-between items-center mb-6\">\r\n          <div>\r\n            <h3 className=\"text-xl font-bold text-white\">ðŸŽ“ Training Progress</h3>\r\n            <p className=\"text-slate-400 text-sm\">Track your PPL requirements and flight hours</p>\r\n          </div>\r\n          <button\r\n            onClick={saveProgress}\r\n            disabled={saving}\r\n            className=\"bg-emerald-500 hover:bg-emerald-400 disabled:opacity-50 text-white px-4 py-2 rounded-lg\"\r\n          >\r\n            {saving ? 'Saving...' : 'Save Progress'}\r\n          </button>\r\n        </div>\r\n\r\n        {/* PPL Requirements Progress */}\r\n        <div className=\"grid md:grid-cols-2 gap-4 mb-6\">\r\n          {Object.entries(PPL_REQUIREMENTS).map(([key, req]) => {\r\n            const current = localProgress[key as keyof typeof localProgress] as number || 0;\r\n            const percent = Math.min((current / req.required) * 100, 100);\r\n            const isDone = percent >= 100;\r\n            \r\n            return (\r\n              <div key={key} className=\"bg-slate-700/50 rounded-lg p-4\">\r\n                <div className=\"flex justify-between items-center mb-2\">\r\n                  <span className=\"text-white font-medium\">{req.label}</span>\r\n                  <span className={`text-sm ${isDone ? 'text-emerald-400' : 'text-slate-400'}`}>\r\n                    {current.toFixed(1)} / {req.required} hrs\r\n                  </span>\r\n                </div>\r\n                <div className=\"h-2 bg-slate-600 rounded-full overflow-hidden\">\r\n                  <div \r\n                    className={`h-full transition-all ${isDone ? 'bg-emerald-500' : 'bg-blue-500'}`}\r\n                    style={{ width: `${percent}%` }}\r\n                  />\r\n                </div>\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n\r\n        {/* Hour Inputs */}\r\n        <div className=\"grid md:grid-cols-3 gap-4\">\r\n          {[\r\n            { key: 'totalHours', label: 'Total Hours' },\r\n            { key: 'soloHours', label: 'Solo Hours' },\r\n            { key: 'nightHours', label: 'Night Hours' },\r\n            { key: 'instrumentHours', label: 'Instrument Hours' },\r\n            { key: 'crossCountryHours', label: 'Cross Country Hours' },\r\n            { key: 'xcSoloHours', label: 'Solo XC Hours' },\r\n          ].map(({ key, label }) => (\r\n            <div key={key}>\r\n              <label className=\"block text-sm text-slate-400 mb-1\">{label}</label>\r\n              <input\r\n                type=\"number\"\r\n                step=\"0.1\"\r\n                value={localProgress[key as keyof typeof localProgress] as number || 0}\r\n                onChange={(e) => setLocalProgress({ ...localProgress, [key]: parseFloat(e.target.value) || 0 })}\r\n                className=\"w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white\"\r\n              />\r\n            </div>\r\n          ))}\r\n        </div>\r\n\r\n        {/* Checkboxes */}\r\n        <div className=\"mt-6 grid md:grid-cols-3 gap-4\">\r\n          {[\r\n            { key: 'soloDone', label: 'Solo Complete' },\r\n            { key: 'nightSoloDone', label: 'Night Solo Complete' },\r\n            { key: 'instrumentDone', label: 'Instrument Checkride Done' },\r\n            { key: 'threeTakeoffsLandingsDone', label: '3 Takeoffs/Landings Done' },\r\n            { key: 'threeNightTakeoffsLandingsDone', label: '3 Night T/O/L Done' },\r\n            { key: 'xcSoloDone', label: 'Solo XC Complete' },\r\n          ].map(({ key, label }) => (\r\n            <label key={key} className=\"flex items-center gap-2 text-white cursor-pointer\">\r\n              <input\r\n                type=\"checkbox\"\r\n                checked={localProgress[key as keyof typeof localProgress] as boolean || false}\r\n                onChange={(e) => setLocalProgress({ ...localProgress, [key]: e.target.checked })}\r\n                className=\"w-4 h-4 rounded bg-slate-700 border-slate-600 text-emerald-500\"\r\n              />\r\n              {label}\r\n            </label>\r\n          ))}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface LogbookEntry {\n  id: string;\r\n  date: string;\r\n  aircraft: string;\r\n  routeFrom: string;\r\n  routeTo: string;\r\n  totalTime: number;\r\n  soloTime: number;\r\n  nightTime: number;\r\n  instrumentTime: number;\r\n  crossCountryTime: number;\r\n  dayLandings: number;\r\n  nightLandings: number;\r\n  remarks?: string;\r\n}\n\ninterface CurrentFuelSaverPlan {\n  name?: string;\n  waypoints: Array<{ icao: string; name?: string; latitude: number; longitude: number }>;\n  aircraft: { name: string; speed: number; burnRate: number; fuelCapacity: number };\n  cruisingAltitude: number;\n  fuelPrices: Record<string, { price100ll: number | null }>;\n  updatedAt?: string;\n}\n\ntype SavedPlanKey = `db:${string}` | `local:${string}`;\n\ninterface SavedFlightPlan {\n  key: SavedPlanKey;\n  id: string;\n  source: 'db' | 'local';\n  name?: string | null;\n  aircraftType?: string | null;\n  aircraftSpeed?: number | null;\n  aircraftBurnRate?: number | null;\n  aircraftFuelCapacity?: number | null;\n  cruisingAlt?: number | null;\n  createdAt?: string | null;\n  waypoints: Array<{\n    icao?: string | null;\n    name?: string | null;\n    city?: string | null;\n    latitude: number;\n    longitude: number;\n  }>;\n}\n\r\nfunction PilotOverviewContent() {\n  const { data: session, status } = useSession();\r\n  const router = useRouter();\r\n  const [entries, setEntries] = useState<LogbookEntry[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [activeTab, setActiveTab] = useState<'logbook' | 'training' | 'currency' | 'analytics' | 'documents'>('logbook');\r\n  const [isProPlus, setIsProPlus] = useState(false);\r\n  const [navLogExports, setNavLogExports] = useState<StoredNavLogExport[]>([]);\n  const [selectedExportId, setSelectedExportId] = useState<string | null>(null);\n  const [viewerUrl, setViewerUrl] = useState<string | null>(null);\n  const [viewerLoading, setViewerLoading] = useState(false);\n  const [currentFuelPlan, setCurrentFuelPlan] = useState<CurrentFuelSaverPlan | null>(null);\n  const [savedFlightPlans, setSavedFlightPlans] = useState<SavedFlightPlan[]>([]);\n  const [selectedSavedPlanKey, setSelectedSavedPlanKey] = useState<SavedPlanKey | ''>('');\n  const [savedPlansLoading, setSavedPlansLoading] = useState(false);\n  const [savedPlansError, setSavedPlansError] = useState<string | null>(null);\n\n  useEffect(() => {\n    return () => {\n      if (viewerUrl && viewerUrl.startsWith('blob:')) {\n        try {\n          URL.revokeObjectURL(viewerUrl);\n        } catch {}\n      }\n    };\n  }, [viewerUrl]);\n\r\n  useEffect(() => {\r\n    if (status === 'authenticated') {\r\n      checkSubscription();\r\n    }\r\n  }, [status]);\r\n\r\n  useEffect(() => {\n    if (typeof window === 'undefined') return;\n    setNavLogExports(getNavLogExportHistory());\n    const handler = () => setNavLogExports(getNavLogExportHistory());\n    window.addEventListener('navlog-exports-updated', handler);\n    return () => window.removeEventListener('navlog-exports-updated', handler);\n  }, []);\n\n  useEffect(() => {\n    if (typeof window === 'undefined') return;\n\n    const loadLocal = () => {\n      try {\n        const raw = localStorage.getItem('savedFlightPlans');\n        if (!raw) return [] as any[];\n        const parsed = JSON.parse(raw);\n        return Array.isArray(parsed) ? parsed : [];\n      } catch {\n        return [] as any[];\n      }\n    };\n\n    const localPlans = loadLocal()\n      .filter((plan: any) => plan && plan.waypoints && Array.isArray(plan.waypoints))\n      .map((plan: any) => {\n        const id = String(plan.id ?? plan.name ?? Date.now());\n        return {\n          key: `local:${id}` as SavedPlanKey,\n          id,\n          source: 'local' as const,\n          name: plan.name ?? null,\n          aircraftType: plan.aircraftType ?? null,\n          aircraftSpeed: typeof plan.aircraftSpeed === 'number' ? plan.aircraftSpeed : null,\n          aircraftBurnRate: typeof plan.aircraftBurnRate === 'number' ? plan.aircraftBurnRate : null,\n          aircraftFuelCapacity: typeof plan.aircraftFuelCapacity === 'number' ? plan.aircraftFuelCapacity : null,\n          cruisingAlt: typeof plan.cruisingAlt === 'number' ? plan.cruisingAlt : null,\n          createdAt: plan.createdAt ?? null,\n          waypoints: (plan.waypoints || []).map((wp: any) => ({\n            icao: wp.icao ?? null,\n            name: wp.name ?? null,\n            city: wp.city ?? null,\n            latitude: Number(wp.latitude),\n            longitude: Number(wp.longitude),\n          })),\n        } satisfies SavedFlightPlan;\n      });\n\n    setSavedFlightPlans(localPlans);\n  }, []);\n\n  useEffect(() => {\n    if (status !== 'authenticated') return;\n    setSavedPlansLoading(true);\n    setSavedPlansError(null);\n    fetch('/api/flight-plans')\n      .then((res) => res.json())\n      .then((data) => {\n        const dbPlans = (data.flightPlans || [])\n          .filter((plan: any) => plan && plan.waypoints && Array.isArray(plan.waypoints))\n          .map((plan: any) => {\n            return {\n              key: `db:${plan.id}` as SavedPlanKey,\n              id: String(plan.id),\n              source: 'db' as const,\n              name: plan.name ?? null,\n              aircraftType: plan.aircraftType ?? null,\n              aircraftSpeed: typeof plan.aircraftSpeed === 'number' ? plan.aircraftSpeed : null,\n              aircraftBurnRate: typeof plan.aircraftBurnRate === 'number' ? plan.aircraftBurnRate : null,\n              aircraftFuelCapacity: typeof plan.aircraftFuelCapacity === 'number' ? plan.aircraftFuelCapacity : null,\n              cruisingAlt: typeof plan.cruisingAlt === 'number' ? plan.cruisingAlt : null,\n              createdAt: plan.createdAt ? new Date(plan.createdAt).toISOString() : null,\n              waypoints: (plan.waypoints || []).map((wp: any) => ({\n                icao: wp.icao ?? null,\n                name: wp.name ?? null,\n                city: wp.city ?? null,\n                latitude: Number(wp.latitude),\n                longitude: Number(wp.longitude),\n              })),\n            } satisfies SavedFlightPlan;\n          });\n\n        setSavedFlightPlans((prev) => {\n          const locals = prev.filter((p) => p.source === 'local');\n          return [...dbPlans, ...locals];\n        });\n      })\n      .catch((error) => {\n        console.error('Failed to load saved flight plans', error);\n        setSavedPlansError('Failed to load saved flight plans.');\n      })\n      .finally(() => setSavedPlansLoading(false));\n  }, [status]);\n\n  useEffect(() => {\n    if (typeof window === 'undefined') return;\n\n    const loadCurrentPlan = () => {\n      try {\n        const raw = localStorage.getItem('fuelSaverCurrentPlan');\n        if (!raw) {\n          setCurrentFuelPlan(null);\n          return;\n        }\n        const parsed = JSON.parse(raw) as CurrentFuelSaverPlan;\n        if (!parsed?.waypoints || parsed.waypoints.length < 2) {\n          setCurrentFuelPlan(null);\n          return;\n        }\n        setCurrentFuelPlan(parsed);\n      } catch (error) {\n        console.error('Failed to load current Fuel Saver plan', error);\n        setCurrentFuelPlan(null);\n      }\n    };\n\n    loadCurrentPlan();\n    window.addEventListener('fuel-saver-plan-updated', loadCurrentPlan);\n    return () => window.removeEventListener('fuel-saver-plan-updated', loadCurrentPlan);\n  }, []);\n\r\n  const checkSubscription = async () => {\r\n    try {\r\n      const res = await fetch('/api/user/tier');\r\n      if (res.ok) {\r\n        const data = await res.json();\r\n        setIsProPlus(data.tier === 'proplus');\r\n        if (data.tier === 'proplus') {\r\n          fetchEntries();\r\n        }\r\n      }\r\n    } catch (err) {\r\n      console.error('Failed to check tier:', err);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handlePreviewExport = (exportItem: StoredNavLogExport) => {\n    setSelectedExportId(exportItem.id);\n    setViewerLoading(true);\n    setTimeout(() => {\n      try {\n        const doc = createNavLogPdfDoc(exportItem.navLogData, {\n          detailed: exportItem.detailed,\n          cruisingAltitude: exportItem.navLogData.cruisingAltitude,\n        });\n        const blob = doc.output('blob');\n        const blobUrl = URL.createObjectURL(blob);\n        setViewerUrl((prev) => {\n          if (prev && prev.startsWith('blob:')) {\n            try {\n              URL.revokeObjectURL(prev);\n            } catch {}\n          }\n          return blobUrl;\n        });\n      } catch (error) {\n        console.error('Failed to render nav log preview', error);\n        setViewerUrl(null);\n      } finally {\n        setViewerLoading(false);\n      }\n    }, 0);\n  };\n\r\n  const handleDownloadExport = (exportItem: StoredNavLogExport) => {\n    try {\n      const doc = createNavLogPdfDoc(exportItem.navLogData, {\n        detailed: exportItem.detailed,\n        cruisingAltitude: exportItem.navLogData.cruisingAltitude,\n      });\n      const filenameBase = exportItem.name.replace(/[^a-z0-9]/gi, '-').toLowerCase() || 'flight-plan';\n      doc.save(`${filenameBase}-navlog.pdf`);\n    } catch (error) {\n      console.error('Failed to download nav log export', error);\n    }\n  };\n\n  const handleDownloadCurrentPlan = (detailed: boolean) => {\n    if (!currentFuelPlan) return;\n    downloadNavLogPdf(\n      currentFuelPlan.waypoints,\n      currentFuelPlan.aircraft,\n      currentFuelPlan.cruisingAltitude,\n      currentFuelPlan.fuelPrices,\n      { detailed, planName: currentFuelPlan.name }\n    );\n  };\n\n  const handleGenerateFromSavedPlan = (detailed: boolean) => {\n    const selected = savedFlightPlans.find((plan) => plan.key === selectedSavedPlanKey);\n    if (!selected) return;\n    if (!selected.waypoints || selected.waypoints.length < 2) return;\n\n    const aircraft = {\n      name: selected.aircraftType || 'Aircraft',\n      speed: selected.aircraftSpeed ?? 110,\n      burnRate: selected.aircraftBurnRate ?? 8.5,\n      fuelCapacity: selected.aircraftFuelCapacity ?? 50,\n    };\n    const cruisingAltitude = selected.cruisingAlt ?? 5500;\n\n    downloadNavLogPdf(\n      selected.waypoints.map((wp) => ({\n        icao: (wp.icao || '').toUpperCase(),\n        name: wp.name || undefined,\n        latitude: wp.latitude,\n        longitude: wp.longitude,\n      })),\n      aircraft,\n      cruisingAltitude,\n      {},\n      { detailed, planName: selected.name || undefined }\n    );\n  };\n\r\n  const formatExportDate = (isoString: string) => {\r\n    try {\r\n      return new Date(isoString).toLocaleString(undefined, {\r\n        year: 'numeric',\r\n        month: 'short',\r\n        day: 'numeric',\r\n        hour: '2-digit',\r\n        minute: '2-digit'\r\n      });\r\n    } catch {\r\n      return isoString;\r\n    }\r\n  };\r\n\r\n  const fetchEntries = async () => {\r\n    try {\r\n      const res = await fetch('/api/logbook');\r\n      if (res.ok) {\r\n        const data = await res.json();\r\n        setEntries(data.entries || []);\r\n      }\r\n    } catch (err) {\r\n      console.error('Failed to fetch logbook:', err);\r\n    }\r\n  };\r\n\r\n  const formatDate = (dateStr: string) => {\r\n    return new Date(dateStr).toLocaleDateString('en-US', {\r\n      year: 'numeric',\r\n      month: 'short',\r\n      day: 'numeric',\r\n    });\r\n  };\r\n\r\n  const formatTime = (hours: number) => {\r\n    const h = Math.floor(hours);\r\n    const m = Math.round((hours - h) * 60);\r\n    return `${h}h ${m}m`;\r\n  };\r\n\r\n  // Calculate totals\r\n  const totals = entries.reduce((acc, entry) => ({\r\n    totalTime: acc.totalTime + (entry.totalTime || 0),\r\n    soloTime: acc.soloTime + (entry.soloTime || 0),\r\n    nightTime: acc.nightTime + (entry.nightTime || 0),\r\n    instrumentTime: acc.instrumentTime + (entry.instrumentTime || 0),\r\n    crossCountryTime: acc.crossCountryTime + (entry.crossCountryTime || 0),\r\n    dayLandings: acc.dayLandings + (entry.dayLandings || 0),\r\n    nightLandings: acc.nightLandings + (entry.nightLandings || 0),\r\n  }), { totalTime: 0, soloTime: 0, nightTime: 0, instrumentTime: 0, crossCountryTime: 0, dayLandings: 0, nightLandings: 0 });\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-slate-900 flex items-center justify-center\">\r\n        <div className=\"text-slate-400\">Loading Pilot Overview...</div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!isProPlus) {\r\n    return (\r\n      <div className=\"min-h-screen bg-slate-900 flex items-center justify-center\">\r\n        <div className=\"text-center max-w-md p-8\">\r\n          <div className=\"text-6xl mb-4\">ðŸš€</div>\r\n          <h2 className=\"text-2xl font-bold text-white mb-2\">Pilot Overview</h2>\r\n          <p className=\"text-slate-400 mb-4\">\r\n            Unlock advanced analytics, currency tracking, and detailed flight insights with Pro+.\r\n          </p>\r\n          <div className=\"bg-slate-800 rounded-xl p-4 border border-slate-700 text-left space-y-2\">\r\n            <div className=\"flex items-center gap-2 text-slate-300\">\r\n              <span>âœ“</span> Hour Analytics & Charts\r\n            </div>\r\n            <div className=\"flex items-center gap-2 text-slate-300\">\r\n              <span>âœ“</span> Currency Tracking (BFR, IPC)\r\n            </div>\r\n            <div className=\"flex items-center gap-2 text-slate-300\">\r\n              <span>âœ“</span> Digital Logbook\r\n            </div>\r\n            <div className=\"flex items-center gap-2 text-slate-300\">\r\n              <span>âœ“</span> Priority Support\r\n            </div>\r\n          </div>\r\n          <button\r\n            onClick={() => router.push('/pricing')}\r\n            className=\"mt-6 bg-emerald-500 hover:bg-emerald-400 text-white px-6 py-3 rounded-xl font-semibold\"\r\n          >\r\n            Upgrade to Pro+ - $6.99/mo\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-slate-900\">\r\n      {/* Header */}\r\n      <div className=\"bg-slate-800 border-b border-slate-700 p-4\">\r\n        <div className=\"max-w-7xl mx-auto\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <h1 className=\"text-2xl font-bold text-white\">ðŸ‘¨â€âœˆï¸ Pilot Overview</h1>\r\n              <p className=\"text-slate-400 text-sm\">Your complete flight statistics and logbook</p>\r\n            </div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <span className=\"bg-emerald-500/20 text-emerald-400 px-3 py-1 rounded-full text-sm\">\r\n                Pro+ Active\r\n              </span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Tabs */}\r\n      <div className=\"bg-slate-800/50 border-b border-slate-700\">\r\n        <div className=\"max-w-7xl mx-auto flex gap-1 px-4 overflow-x-auto\">\r\n          {(['logbook', 'training', 'currency', 'analytics', 'documents'] as const).map((tab) => (\r\n            <button\r\n              key={tab}\r\n              onClick={() => setActiveTab(tab)}\r\n              className={`px-6 py-3 font-medium transition-colors whitespace-nowrap ${\r\n                activeTab === tab\r\n                  ? 'text-emerald-400 border-b-2 border-emerald-400'\r\n                  : 'text-slate-400 hover:text-white'\r\n              }`}\r\n            >\r\n              {tab === 'logbook' && 'ðŸ“– '}\r\n              {tab === 'training' && 'ðŸŽ“ '}\r\n              {tab === 'currency' && 'ðŸ’± '}\r\n              {tab === 'analytics' && 'ðŸ“Š '}\r\n              {tab === 'documents' && 'ðŸ“‚ '}\r\n              {tab === 'training' ? 'Training' : tab.charAt(0).toUpperCase() + tab.slice(1)}\r\n            </button>\r\n          ))}\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"max-w-7xl mx-auto p-4\">\r\n        {/* Logbook Tab */}\r\n        {activeTab === 'logbook' && (\r\n          <div>\r\n            {/* Stats Summary */}\r\n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6\">\r\n              <div className=\"bg-slate-800 rounded-xl p-4 border border-slate-700\">\r\n                <div className=\"text-slate-400 text-sm\">Total Time</div>\r\n                <div className=\"text-2xl font-bold text-white\">{formatTime(totals.totalTime)}</div>\r\n              </div>\r\n              <div className=\"bg-slate-800 rounded-xl p-4 border border-slate-700\">\r\n                <div className=\"text-slate-400 text-sm\">Night Time</div>\r\n                <div className=\"text-2xl font-bold text-white\">{formatTime(totals.nightTime)}</div>\r\n              </div>\r\n              <div className=\"bg-slate-800 rounded-xl p-4 border border-slate-700\">\r\n                <div className=\"text-slate-400 text-sm\">Instrument</div>\r\n                <div className=\"text-2xl font-bold text-white\">{formatTime(totals.instrumentTime)}</div>\r\n              </div>\r\n              <div className=\"bg-slate-800 rounded-xl p-4 border border-slate-700\">\r\n                <div className=\"text-slate-400 text-sm\">Cross Country</div>\r\n                <div className=\"text-2xl font-bold text-white\">{formatTime(totals.crossCountryTime)}</div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Logbook Entries */}\r\n            <div className=\"bg-slate-800 rounded-xl border border-slate-700 overflow-hidden\">\r\n              <div className=\"p-4 border-b border-slate-700 flex justify-between items-center\">\r\n                <h3 className=\"font-semibold text-white\">Flight Log</h3>\r\n                <span className=\"text-slate-400 text-sm\">{entries.length} flights</span>\r\n              </div>\r\n              \r\n              {entries.length === 0 ? (\r\n                <div className=\"p-8 text-center text-slate-500\">\r\n                  No flights logged yet. Add your first flight!\r\n                </div>\r\n              ) : (\r\n                <div className=\"overflow-x-auto\">\r\n                  <table className=\"w-full\">\r\n                    <thead className=\"bg-slate-700/50\">\r\n                      <tr className=\"text-left text-slate-400 text-sm\">\r\n                        <th className=\"p-3\">Date</th>\r\n                        <th className=\"p-3\">Aircraft</th>\r\n                        <th className=\"p-3\">Route</th>\r\n                        <th className=\"p-3\">Time</th>\r\n                        <th className=\"p-3\">Night</th>\r\n                        <th className=\"p-3\">IMC</th>\r\n                        <th className=\"p-3\">XC</th>\r\n                        <th className=\"p-3\">Landings</th>\r\n                      </tr>\r\n                    </thead>\r\n                    <tbody className=\"divide-y divide-slate-700\">\r\n                      {entries.slice(0, 20).map((entry) => (\r\n                        <tr key={entry.id} className=\"hover:bg-slate-700/30\">\r\n                          <td className=\"p-3 text-white text-sm\">{formatDate(entry.date)}</td>\r\n                          <td className=\"p-3 text-slate-300 text-sm\">{entry.aircraft}</td>\r\n                          <td className=\"p-3 text-slate-300 text-sm\">\r\n                            {entry.routeFrom} â†’ {entry.routeTo}\r\n                          </td>\r\n                          <td className=\"p-3 text-white text-sm\">{formatTime(entry.totalTime)}</td>\r\n                          <td className=\"p-3 text-slate-300 text-sm\">{formatTime(entry.nightTime)}</td>\r\n                          <td className=\"p-3 text-slate-300 text-sm\">{formatTime(entry.instrumentTime)}</td>\r\n                          <td className=\"p-3 text-slate-300 text-sm\">{formatTime(entry.crossCountryTime)}</td>\r\n                          <td className=\"p-3 text-slate-300 text-sm\">\r\n                            {entry.dayLandings}d / {entry.nightLandings}n\r\n                          </td>\r\n                        </tr>\r\n                      ))}\r\n                    </tbody>\r\n                  </table>\r\n                </div>\r\n              )}\r\n              \r\n              {entries.length > 20 && (\r\n                <div className=\"p-3 text-center text-slate-500 text-sm border-t border-slate-700\">\r\n                  Showing 20 of {entries.length} flights\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Currency Tab */}\r\n        {activeTab === 'currency' && (\r\n          <CurrencyTracker />\r\n        )}\r\n\r\n        {/* Analytics Tab */}\r\n        {activeTab === 'analytics' && (\r\n          <HourAnalytics />\r\n        )}\r\n\r\n        {/* Training Tab - show for everyone (not just Pro+) */}\r\n        {activeTab === 'training' && (\r\n          <TrainingOverview />\r\n        )}\r\n\r\n        {activeTab === 'documents' && (\n          <div className=\"space-y-4\">\n            <div className=\"bg-slate-800 rounded-xl p-4 border border-slate-700 flex flex-col gap-2\">\n              <div>\n                <h3 className=\"text-xl font-bold text-white\">ðŸ“‚ Documents</h3>\n                <p className=\"text-slate-400 text-sm\">\n                  Every time you export a Nav Log PDF we store a local copy here so you can preview or download again without rebuilding the route.\n                </p>\n              </div>\n            </div>\n\n            {currentFuelPlan && (\n              <div className=\"bg-slate-800 border border-slate-700 rounded-xl p-4 flex flex-col gap-3\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <div className=\"text-white font-semibold\">Current Fuel Saver Plan</div>\n                    <div className=\"text-xs text-slate-400\">\n                      {currentFuelPlan.name || `${currentFuelPlan.waypoints[0].icao} â†’ ${currentFuelPlan.waypoints[currentFuelPlan.waypoints.length - 1].icao}`}\n                    </div>\n                  </div>\n                  <span className=\"text-xs px-2 py-1 rounded-full border border-slate-600 text-slate-300\">Live</span>\n                </div>\n                <div className=\"flex gap-2\">\n                  <button\n                    onClick={() => handleDownloadCurrentPlan(false)}\n                    className=\"flex-1 bg-slate-700 hover:bg-slate-600 text-white text-sm py-2 rounded-lg\"\n                  >\n                    Download Basic\n                  </button>\n                  <button\n                    onClick={() => handleDownloadCurrentPlan(true)}\n                    className=\"flex-1 bg-emerald-500 hover:bg-emerald-400 text-white text-sm py-2 rounded-lg\"\n                  >\n                    Download Detailed\n                  </button>\n                </div>\n              </div>\n            )}\n\n            <div className=\"bg-slate-800 border border-slate-700 rounded-xl p-4 flex flex-col gap-3\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <div className=\"text-white font-semibold\">Generate From Saved Flight Plan</div>\n                  <div className=\"text-xs text-slate-400\">Pick a plan and generate a Nav Log PDF here.</div>\n                </div>\n                {savedPlansLoading ? (\n                  <span className=\"text-xs text-slate-400\">Loadingâ€¦</span>\n                ) : (\n                  <span className=\"text-xs px-2 py-1 rounded-full border border-slate-600 text-slate-300\">{savedFlightPlans.length} plans</span>\n                )}\n              </div>\n\n              {savedPlansError && (\n                <div className=\"text-xs text-red-300\">{savedPlansError}</div>\n              )}\n\n              <div className=\"flex flex-col gap-2\">\n                <select\n                  value={selectedSavedPlanKey}\n                  onChange={(e) => setSelectedSavedPlanKey(e.target.value as SavedPlanKey)}\n                  className=\"w-full bg-slate-900 border border-slate-700 rounded-lg px-3 py-2 text-sm text-white\"\n                >\n                  <option value=\"\">Select a saved planâ€¦</option>\n                  {savedFlightPlans.map((plan) => {\n                    const label = plan.name || `${plan.waypoints?.[0]?.icao || 'DEP'} â†’ ${plan.waypoints?.[plan.waypoints.length - 1]?.icao || 'ARR'}`;\n                    const tag = plan.source === 'db' ? 'Cloud' : 'Local';\n                    return (\n                      <option key={plan.key} value={plan.key}>\n                        [{tag}] {label}\n                      </option>\n                    );\n                  })}\n                </select>\n                <div className=\"flex gap-2\">\n                  <button\n                    disabled={!selectedSavedPlanKey}\n                    onClick={() => handleGenerateFromSavedPlan(false)}\n                    className=\"flex-1 bg-slate-700 hover:bg-slate-600 disabled:opacity-50 disabled:cursor-not-allowed text-white text-sm py-2 rounded-lg\"\n                  >\n                    Generate Basic PDF\n                  </button>\n                  <button\n                    disabled={!selectedSavedPlanKey}\n                    onClick={() => handleGenerateFromSavedPlan(true)}\n                    className=\"flex-1 bg-emerald-500 hover:bg-emerald-400 disabled:opacity-50 disabled:cursor-not-allowed text-white text-sm py-2 rounded-lg\"\n                  >\n                    Generate Detailed PDF\n                  </button>\n                </div>\n                <div className=\"text-xs text-slate-400\">\n                  If a saved plan is missing performance data, we use safe defaults (110 kt / 8.5 gph / 50 gal).\n                </div>\n              </div>\n            </div>\n\n            {navLogExports.length === 0 ? (\n              <div className=\"bg-slate-800 border border-slate-700 rounded-xl p-10 text-center text-slate-400\">\n                Export a Nav Log as PDF from the Fuel Saver module and it will appear here for quick access.\n              </div>\n            ) : (\n              <div className=\"grid lg:grid-cols-3 gap-4\">\r\n                <div className=\"space-y-3\">\r\n                  {navLogExports.map((exportItem) => (\r\n                    <div\r\n                      key={exportItem.id}\r\n                      className={`bg-slate-800 border rounded-xl p-4 transition-colors ${\r\n                        selectedExportId === exportItem.id ? 'border-emerald-500' : 'border-slate-700'\r\n                      }`}\r\n                    >\r\n                      <div className=\"flex items-center justify-between gap-2\">\r\n                        <div>\r\n                          <div className=\"text-white font-semibold\">{exportItem.name}</div>\r\n                          <div className=\"text-xs text-slate-400\">{formatExportDate(exportItem.createdAt)}</div>\r\n                        </div>\r\n                        <span className=\"text-xs px-2 py-1 rounded-full border border-slate-600 text-slate-300\">\r\n                          {exportItem.detailed ? 'Detailed' : 'Basic'}\r\n                        </span>\r\n                      </div>\r\n                      <div className=\"text-sm text-slate-400 mt-2\">\r\n                        {exportItem.navLogData.departure} â†’ {exportItem.navLogData.arrival}\r\n                      </div>\r\n                      <div className=\"flex gap-2 mt-4\">\r\n                        <button\r\n                          onClick={() => handlePreviewExport(exportItem)}\r\n                          className=\"flex-1 bg-slate-700 hover:bg-slate-600 text-white text-sm py-2 rounded-lg\"\r\n                        >\r\n                          Preview\r\n                        </button>\r\n                        <button\r\n                          onClick={() => handleDownloadExport(exportItem)}\r\n                          className=\"flex-1 bg-slate-600 hover:bg-slate-500 text-white text-sm py-2 rounded-lg\"\r\n                        >\r\n                          Download\r\n                        </button>\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n\r\n                <div className=\"lg:col-span-2 bg-slate-800 border border-slate-700 rounded-xl p-4 min-h-[520px] flex flex-col\">\r\n                  <div className=\"flex items-center justify-between mb-3\">\r\n                    <div>\r\n                      <h4 className=\"text-white font-semibold\">PDF Preview</h4>\r\n                      <p className=\"text-xs text-slate-400\">Rendered directly in your browser</p>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"flex-1 bg-white rounded-lg overflow-hidden border border-slate-200\">\r\n                    {viewerLoading ? (\r\n                      <div className=\"w-full h-full flex items-center justify-center text-slate-500\">\r\n                        Preparing previewâ€¦\r\n                      </div>\r\n                    ) : viewerUrl ? (\r\n                      <iframe src={viewerUrl} className=\"w-full h-[500px]\" title=\"Nav Log Preview\" />\r\n                    ) : (\r\n                      <div className=\"w-full h-full flex items-center justify-center text-slate-500\">\r\n                        Select a nav log from the list to preview it here.\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default function PilotOverviewPage() {\n  return (\r\n    <Suspense fallback={\r\n      <div className=\"min-h-screen bg-slate-900 flex items-center justify-center\">\r\n        <div className=\"text-slate-400\">Loading...</div>\r\n      </div>\r\n    }>\r\n      <PilotOverviewContent />\r\n    </Suspense>\r\n  );\r\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\plane-carfax\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\plane-carfax\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\plane-search\\components\\plane-search-client.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\plane-search\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\plane-search\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\proplus-dashboard\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'session' is assigned a value but never used.","line":25,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":25,"endColumn":24},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'checkSubscription'. Either include it or remove the dependency array.","line":34,"column":6,"nodeType":"ArrayExpression","endLine":34,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [checkSubscription, status]","fix":{"range":[898,906],"text":"[checkSubscription, status]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useEffect, useState } from 'react';\nimport { useSession } from 'next-auth/react';\nimport Link from 'next/link';\nimport CurrencyTracker from '../../components/CurrencyTracker';\nimport HourAnalytics from '../../components/HourAnalytics';\n\ninterface LogbookEntry {\n  id: string;\n  date: string;\n  aircraft: string;\n  routeFrom: string;\n  routeTo: string;\n  totalTime: number;\n  soloTime: number;\n  nightTime: number;\n  instrumentTime: number;\n  crossCountryTime: number;\n  dayLandings: number;\n  nightLandings: number;\n}\n\nexport default function ProPlusDashboard() {\n  const { data: session, status } = useSession();\n  const [entries, setEntries] = useState<LogbookEntry[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [isProPlus, setIsProPlus] = useState(false);\n\n  useEffect(() => {\n    if (status === 'authenticated') {\n      checkSubscription();\n    }\n  }, [status]);\n\n  const checkSubscription = async () => {\n    try {\n      const res = await fetch('/api/user/tier');\n      if (res.ok) {\n        const data = await res.json();\n        setIsProPlus(data.tier === 'proplus');\n        if (data.tier === 'proplus') {\n          fetchEntries();\n        }\n      }\n    } catch (err) {\n      console.error('Failed to check tier:', err);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchEntries = async () => {\n    try {\n      const res = await fetch('/api/logbook');\n      if (res.ok) {\n        const data = await res.json();\n        setEntries(data.entries || []);\n      }\n    } catch (err) {\n      console.error('Failed to fetch entries:', err);\n    }\n  };\n\n  const totals = entries.reduce((acc, entry) => ({\n    totalTime: acc.totalTime + entry.totalTime,\n    soloTime: acc.soloTime + entry.soloTime,\n    nightTime: acc.nightTime + entry.nightTime,\n    crossCountryTime: acc.crossCountryTime + entry.crossCountryTime,\n    landings: acc.landings + entry.dayLandings + entry.nightLandings,\n  }), {\n    totalTime: 0, soloTime: 0, nightTime: 0, crossCountryTime: 0, landings: 0,\n  });\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-slate-900 flex items-center justify-center\">\n        <div className=\"text-slate-400\">Loading...</div>\n      </div>\n    );\n  }\n\n  if (!isProPlus) {\n    return (\n      <div className=\"min-h-screen bg-slate-900 flex items-center justify-center p-4\">\n        <div className=\"text-center max-w-md\">\n          <div className=\"text-6xl mb-4\">ðŸš€</div>\n          <h1 className=\"text-2xl font-bold text-white mb-4\">Pro+ Dashboard</h1>\n          <p className=\"text-slate-400 mb-6\">\n            Unlock advanced analytics, currency tracking, and detailed flight insights with Pro+.\n          </p>\n          <div className=\"space-y-3\">\n            <div className=\"bg-slate-800 rounded-lg p-4 text-left\">\n              <p className=\"text-emerald-400 mb-2\">âœ“ Hour Analytics & Charts</p>\n              <p className=\"text-emerald-400 mb-2\">âœ“ Currency Tracking (BFR, IPC)</p>\n              <p className=\"text-emerald-400 mb-2\">âœ“ Digital Logbook</p>\n              <p className=\"text-emerald-400\">âœ“ Priority Support</p>\n            </div>\n          </div>\n          <Link\n            href=\"/pricing\"\n            className=\"inline-block mt-6 bg-amber-500 hover:bg-amber-400 text-white px-6 py-2 rounded-lg\"\n          >\n            Upgrade to Pro+ - $6.99/mo\n          </Link>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-slate-900 p-4\">\n      <div className=\"max-w-7xl mx-auto\">\n        {/* Header */}\n        <div className=\"mb-8\">\n          <div className=\"flex items-center gap-2 mb-2\">\n            <span className=\"bg-amber-500 text-white text-xs px-2 py-0.5 rounded font-bold\">PRO+</span>\n            <h1 className=\"text-2xl font-bold text-white\">Pilot Dashboard</h1>\n          </div>\n          <p className=\"text-slate-400\">Advanced analytics and flight tracking</p>\n        </div>\n\n        {/* Quick Stats */}\n        <div className=\"grid grid-cols-2 md:grid-cols-5 gap-4 mb-8\">\n          <div className=\"bg-slate-800 rounded-xl p-4\">\n            <p className=\"text-xs text-slate-500 uppercase\">Total Hours</p>\n            <p className=\"text-2xl font-bold text-white\">{totals.totalTime.toFixed(1)}</p>\n          </div>\n          <div className=\"bg-slate-800 rounded-xl p-4\">\n            <p className=\"text-xs text-slate-500 uppercase\">Solo</p>\n            <p className=\"text-2xl font-bold text-emerald-400\">{totals.soloTime.toFixed(1)}</p>\n          </div>\n          <div className=\"bg-slate-800 rounded-xl p-4\">\n            <p className=\"text-xs text-slate-500 uppercase\">Night</p>\n            <p className=\"text-2xl font-bold text-purple-400\">{totals.nightTime.toFixed(1)}</p>\n          </div>\n          <div className=\"bg-slate-800 rounded-xl p-4\">\n            <p className=\"text-xs text-slate-500 uppercase\">XC</p>\n            <p className=\"text-2xl font-bold text-sky-400\">{totals.crossCountryTime.toFixed(1)}</p>\n          </div>\n          <div className=\"bg-slate-800 rounded-xl p-4\">\n            <p className=\"text-xs text-slate-500 uppercase\">Landings</p>\n            <p className=\"text-2xl font-bold text-amber-400\">{totals.landings}</p>\n          </div>\n        </div>\n\n        {/* Main Grid */}\n        <div className=\"grid lg:grid-cols-2 gap-6\">\n          {/* Hour Analytics */}\n          <HourAnalytics />\n\n          {/* Currency Tracker */}\n          <CurrencyTracker />\n        </div>\n\n        {/* Recent Flights & Quick Actions */}\n        <div className=\"grid md:grid-cols-2 gap-6 mt-6\">\n          {/* Recent Flights */}\n          <div className=\"bg-slate-800 rounded-xl p-6\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <h2 className=\"text-lg font-bold text-white\">Recent Flights</h2>\n              <Link href=\"/modules/logbook\" className=\"text-sm text-emerald-400 hover:text-emerald-300\">\n                View All â†’\n              </Link>\n            </div>\n            {entries.length === 0 ? (\n              <p className=\"text-slate-400 text-sm\">No flights logged yet.</p>\n            ) : (\n              <div className=\"space-y-2\">\n                {entries.slice(0, 5).map((entry) => (\n                  <div key={entry.id} className=\"flex items-center justify-between py-2 border-b border-slate-700 last:border-0\">\n                    <div>\n                      <p className=\"text-sm text-white\">{entry.routeFrom} â†’ {entry.routeTo}</p>\n                      <p className=\"text-xs text-slate-500\">{new Date(entry.date).toLocaleDateString()} â€¢ {entry.aircraft}</p>\n                    </div>\n                    <p className=\"text-sm text-emerald-400\">{entry.totalTime.toFixed(1)}h</p>\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n\n          {/* Quick Actions */}\n          <div className=\"bg-slate-800 rounded-xl p-6\">\n            <h2 className=\"text-lg font-bold text-white mb-4\">Quick Actions</h2>\n            <div className=\"space-y-3\">\n              <Link\n                href=\"/modules/logbook\"\n                className=\"block w-full text-center bg-emerald-500 hover:bg-emerald-400 text-white py-3 rounded-lg transition\"\n              >\n                ðŸ“– Open Logbook\n              </Link>\n              <Link\n                href=\"/modules/fuel-saver\"\n                className=\"block w-full text-center bg-slate-700 hover:bg-slate-600 text-white py-3 rounded-lg transition\"\n              >\n                â›½ Plan Flight\n              </Link>\n              <Link\n                href=\"/modules/e6b\"\n                className=\"block w-full text-center bg-slate-700 hover:bg-slate-600 text-white py-3 rounded-lg transition\"\n              >\n                ðŸ§® E6B Calculator\n              </Link>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\social\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\social\\messages\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'formatTime' is defined but never used.","line":30,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":30,"endColumn":20},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":48,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1801,1804],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1801,1804],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\David\\next-dashboard\\app\\modules\\social\\messages\\page.tsx:61:7\n  59 |     const newConvoId = searchParams.get('newConversation')\n  60 |     if (newConvoId) {\n> 61 |       setSelectedId(newConvoId)\n     |       ^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  62 |       setShowThread(true)\n  63 |       setTab('marketplace')\n  64 |     }","line":61,"column":7,"nodeType":null,"endLine":61,"endColumn":20}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect, useRef, Suspense } from 'react'\nimport Link from 'next/link'\nimport { useSearchParams } from 'next/navigation'\nimport { useSession } from 'next-auth/react'\nimport { Search, Plane, Users, Send, MoreHorizontal, Phone, Video, ExternalLink, ChevronLeft } from 'lucide-react'\nimport { Button } from '@/components/ui/button'\nimport { Badge } from '@/components/ui/badge'\nimport { Input } from '@/components/ui/input'\n\ntype ConversationItem = {\n  id: string\n  updatedAt: string\n  listingId?: string | null\n  listing?: { id: string; title: string; airportIcao: string } | null\n  participants: { user: { id: string; name?: string | null; username?: string | null } }[]\n  messages: { id: string; body: string; createdAt: string; senderId: string }[]\n}\n\nfunction initials(name?: string | null) {\n  const raw = (name || '').trim()\n  if (!raw) return '?'\n  const parts = raw.split(/\\s+/).filter(Boolean)\n  const first = parts[0]?.[0] || '?'\n  const last = parts.length > 1 ? parts[parts.length - 1]?.[0] : ''\n  return (first + last).toUpperCase()\n}\n\nfunction formatTime(dateStr: string) {\n  const date = new Date(dateStr)\n  const now = new Date()\n  const diffMs = now.getTime() - date.getTime()\n  const diffMins = Math.floor(diffMs / 60000)\n  const diffHours = Math.floor(diffMins / 60)\n  const diffDays = Math.floor(diffHours / 24)\n  if (diffMins < 1) return 'Just now'\n  if (diffMins < 60) return `${diffMins}m`\n  if (diffHours < 24) return `${diffHours}h`\n  if (diffDays < 7) return `${diffDays}d`\n  return date.toLocaleDateString()\n}\n\nfunction MessagesContent() {\n  const { data: session } = useSession()\n  const searchParams = useSearchParams()\n  const [conversations, setConversations] = useState<ConversationItem[]>([])\n  const [messages, setMessages] = useState<any[]>([])\n  const [selectedId, setSelectedId] = useState<string | null>(null)\n  const [showThread, setShowThread] = useState(false)\n  const [tab, setTab] = useState<'marketplace' | 'friends'>('marketplace')\n  const [search, setSearch] = useState('')\n  const [newMessage, setNewMessage] = useState('')\n  const [loading, setLoading] = useState(true)\n  const messagesEndRef = useRef<HTMLDivElement>(null)\n  const currentUserId = session?.user?.id\n\n  useEffect(() => {\n    const newConvoId = searchParams.get('newConversation')\n    if (newConvoId) {\n      setSelectedId(newConvoId)\n      setShowThread(true)\n      setTab('marketplace')\n    }\n  }, [searchParams])\n\n  useEffect(() => {\n    if (session?.user?.id) {\n      fetch('/api/conversations').then(r => r.json()).then(d => { setConversations(d.conversations || []); setLoading(false) }).catch(() => setLoading(false))\n    }\n  }, [session])\n\n  useEffect(() => {\n    if (selectedId) {\n      fetch(`/api/conversations/${selectedId}/messages`).then(r => r.json()).then(d => setMessages(d.messages || [])).catch(() => {})\n    }\n  }, [selectedId])\n\n  useEffect(() => { messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' }) }, [messages])\n\n  const marketplaceConversations = conversations.filter(c => c.listingId)\n  const friendsConversations = conversations.filter(c => !c.listingId)\n  const selectedConversation = conversations.find(c => c.id === selectedId)\n  const otherParticipant = selectedConversation?.participants.find(p => p.user.id !== currentUserId)?.user\n  const filteredConversations = tab === 'marketplace' ? marketplaceConversations : friendsConversations\n\n  async function handleSend() {\n    if (!newMessage.trim() || !selectedId) return\n    await fetch(`/api/conversations/${selectedId}/messages`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ body: newMessage }) })\n    setNewMessage('')\n    fetch(`/api/conversations/${selectedId}/messages`).then(r => r.json()).then(d => setMessages(d.messages || [])).catch(() => {})\n  }\n\n  if (!session) return <div className=\"min-h-screen bg-background flex items-center justify-center\"><p className=\"text-muted-foreground\">Please sign in to view messages.</p></div>\n\n  return (\n    <div className=\"h-screen flex flex-col bg-background\">\n      <div className=\"border-b border-border bg-card/50 px-4 lg:px-8 py-4\">\n        <div className=\"max-w-7xl mx-auto\">\n          <h1 className=\"text-2xl font-bold\">Messages</h1>\n          <p className=\"text-sm text-muted-foreground\">Chat with sellers and friends</p>\n        </div>\n      </div>\n      <main className=\"flex-1 overflow-hidden px-0 lg:px-8 lg:py-4\">\n        <div className=\"h-[calc(100vh-8rem)] border border-border rounded-xl overflow-hidden bg-card flex max-w-7xl mx-auto\">\n          <div className={`w-full lg:w-[340px] border-r border-border bg-card ${showThread ? 'hidden lg:flex lg:flex-col' : 'flex flex-col'}`}>\n            <div className=\"p-4 border-b border-border\">\n              <div className=\"flex rounded-lg bg-secondary/60 p-1\">\n                <button onClick={() => setTab('marketplace')} className={`flex-1 flex items-center justify-center gap-2 rounded-md px-3 py-2 text-sm font-medium ${tab === 'marketplace' ? 'bg-card text-foreground shadow-sm' : 'text-muted-foreground'}`}>\n                  <Plane className=\"w-4 h-4\" /><span>Marketplace</span>\n                  {marketplaceConversations.length > 0 && <Badge className=\"bg-primary/20 text-primary border-0 px-1.5 text-xs\">{marketplaceConversations.length}</Badge>}\n                </button>\n                <button onClick={() => setTab('friends')} className={`flex-1 flex items-center justify-center gap-2 rounded-md px-3 py-2 text-sm font-medium ${tab === 'friends' ? 'bg-card text-foreground shadow-sm' : 'text-muted-foreground'}`}>\n                  <Users className=\"w-4 h-4\" /><span>Friends</span>\n                </button>\n              </div>\n            </div>\n            <div className=\"p-4 pb-2\">\n              <div className=\"relative\">\n                <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\n                <Input placeholder={tab === 'marketplace' ? 'Search listings or sellers...' : 'Search friends...'} value={search} onChange={(e) => setSearch(e.target.value)} className=\"pl-9\" />\n              </div>\n            </div>\n            <div className=\"flex-1 overflow-y-auto px-2 pb-2\">\n              {loading ? <div className=\"p-4 text-center text-muted-foreground\">Loading...</div> : filteredConversations.length === 0 ? <div className=\"p-4 text-center text-muted-foreground\">No conversations yet</div> : filteredConversations.map((convo) => {\n                const participant = convo.participants.find(p => p.user.id !== currentUserId)?.user\n                return (\n                  <button key={convo.id} onClick={() => { setSelectedId(convo.id); setShowThread(true) }} className={`w-full text-left p-3 rounded-lg mb-1 ${selectedId === convo.id ? 'bg-secondary' : 'hover:bg-secondary/50'}`}>\n                    <div className=\"flex gap-3\">\n                      <div className=\"w-10 h-10 rounded-full bg-secondary flex items-center justify-center shrink-0\"><span className=\"text-xs font-semibold text-muted-foreground\">{initials(participant?.name || participant?.username)}</span></div>\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"text-sm font-medium truncate\">{convo.listing?.title || participant?.name || 'Pilot'}</div>\n                        {tab === 'marketplace' && convo.listing && <div className=\"flex items-center gap-1 mt-0.5\"><Plane className=\"w-3 h-3 text-primary\" /><span className=\"text-xs text-primary truncate\">{convo.listing.title}</span></div>}\n                        <div className=\"text-xs text-muted-foreground truncate\">{participant?.name || participant?.username}</div>\n                      </div>\n                    </div>\n                  </button>\n                )\n              })}\n            </div>\n          </div>\n          <div className={`flex-1 ${showThread ? 'flex flex-col' : 'hidden lg:flex'}`}>\n            {selectedId && selectedConversation ? (\n              <>\n                <div className=\"flex items-center justify-between px-4 lg:px-6 py-4 border-b border-border bg-card/50\">\n                  <div className=\"flex items-center gap-3\">\n                    {showThread && <button onClick={() => setShowThread(false)} className=\"lg:hidden\"><ChevronLeft className=\"w-5 h-5\" /></button>}\n                    <div className=\"w-10 h-10 rounded-full bg-secondary flex items-center justify-center\"><span className=\"text-xs font-semibold text-muted-foreground\">{initials(otherParticipant?.name || otherParticipant?.username)}</span></div>\n                    <div><h3 className=\"text-sm font-semibold\">{otherParticipant?.name || 'Pilot'}</h3><span className=\"text-xs text-primary\">Tap to view profile</span></div>\n                  </div>\n                  <div className=\"flex gap-1\">\n                    <Button variant=\"ghost\" size=\"icon\" className=\"h-9 w-9\"><Phone className=\"w-4 h-4\" /></Button>\n                    <Button variant=\"ghost\" size=\"icon\" className=\"h-9 w-9\"><Video className=\"w-4 h-4\" /></Button>\n                    <Button variant=\"ghost\" size=\"icon\" className=\"h-9 w-9\"><MoreHorizontal className=\"w-4 h-4\" /></Button>\n                  </div>\n                </div>\n                {selectedConversation.listing && (\n                  <div className=\"px-4 lg:px-6 py-3 border-b border-border bg-secondary/30\">\n                    <div className=\"flex items-center gap-3 p-3 rounded-lg bg-card border\">\n                      <div className=\"w-14 h-10 rounded-md bg-secondary flex items-center justify-center shrink-0\"><Plane className=\"w-5 h-5 text-primary\" /></div>\n                      <div className=\"flex-1\"><p className=\"text-sm font-medium truncate\">{selectedConversation.listing.title}</p><p className=\"text-xs text-muted-foreground\">{selectedConversation.listing.airportIcao}</p></div>\n                      <Link href={`/modules/marketplace/listing/${selectedConversation.listing.id}`}><Button variant=\"ghost\" size=\"sm\" className=\"gap-1\"><ExternalLink className=\"w-3.5 h-3.5\" /><span className=\"hidden sm:inline text-xs\">View</span></Button></Link>\n                    </div>\n                  </div>\n                )}\n                <div className=\"flex-1 overflow-y-auto px-4 lg:px-6 py-4\">\n                  {messages.map((msg) => (\n                    <div key={msg.id} className={`flex ${msg.senderId === currentUserId ? 'justify-end' : 'justify-start'} mb-4`}>\n                      <div className={`max-w-[75%] px-4 py-2.5 rounded-2xl text-sm ${msg.senderId === currentUserId ? 'bg-primary text-primary-foreground' : 'bg-secondary'}`}>{msg.body}</div>\n                    </div>\n                  ))}\n                  <div ref={messagesEndRef} />\n                </div>\n                <div className=\"px-4 lg:px-6 py-4 border-t border-border bg-card/50\">\n                  <div className=\"flex gap-2\">\n                    <textarea rows={1} value={newMessage} onChange={(e) => setNewMessage(e.target.value)} onKeyDown={(e) => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); handleSend() } }} placeholder=\"Type a message...\" className=\"flex-1 resize-none bg-secondary/60 border border-border rounded-lg px-4 py-2 text-sm focus:outline-none\" />\n                    <Button onClick={handleSend} disabled={!newMessage.trim()} className=\"h-10 w-10\"><Send className=\"w-4 h-4\" /></Button>\n                  </div>\n                </div>\n              </>\n            ) : <div className=\"flex-1 flex items-center justify-center text-muted-foreground\">Select a conversation</div>}\n          </div>\n        </div>\n      </main>\n    </div>\n  )\n}\n\nfunction MessagesLoading() {\n  return (\n    <div className=\"h-screen flex items-center justify-center bg-background\">\n      <div className=\"text-muted-foreground\">Loading messages...</div>\n    </div>\n  )\n}\n\nexport default function MessagesPage() {\n  return (\n    <Suspense fallback={<MessagesLoading />}>\n      <MessagesContent />\n    </Suspense>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\social\\overview\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\social\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\social\\pilots\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\tailhistory\\actions.ts","messages":[{"ruleId":"prefer-const","severity":2,"message":"'fastData' is never reassigned. Use 'const' instead.","line":21,"column":7,"nodeType":"Identifier","messageId":"useConst","endLine":21,"endColumn":15,"fix":{"range":[551,616],"text":"const fastData = await getFastPerformanceData(mfrUpper, modelUpper)"}},{"ruleId":"prefer-const","severity":2,"message":"'gaData' is never reassigned. Use 'const' instead.","line":25,"column":7,"nodeType":"Identifier","messageId":"useConst","endLine":25,"endColumn":13,"fix":{"range":[697,758],"text":"const gaData = await getGAPerformanceData(mfrUpper, modelUpper)"}},{"ruleId":"prefer-const","severity":2,"message":"'searchPatterns' is never reassigned. Use 'const' instead.","line":33,"column":7,"nodeType":"Identifier","messageId":"useConst","endLine":33,"endColumn":31,"fix":{"range":[943,976],"text":"const searchPatterns: string[] = []"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":80,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2397,2400],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2397,2400],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":115,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3599,3602],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3599,3602],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":3,"fixableWarningCount":0,"source":"\"use server\";\n\nimport { prisma } from \"@/lib/prisma\";\nimport { getDemoAircraft } from \"@/lib/demo-aircraft\";\n\nexport type TailHistoryActionResult = {\n  data?: unknown;\n  error?: string;\n  remainingCredits?: number;\n  needsCredits?: boolean;\n};\n\n// Get performance data from FAST AEROBASE OR RisingUp specs\nasync function getPerformanceData(mfr: string | null, model: string | null) {\n  if (!mfr || !model) return null\n  \n  const mfrUpper = mfr.toUpperCase()\n  const modelUpper = model.toUpperCase()\n  \n  // First try FAST AEROBASE (commercial jets)\n  let fastData = await getFastPerformanceData(mfrUpper, modelUpper)\n  if (fastData) return fastData\n  \n  // Then try RisingUp specs (GA aircraft)\n  let gaData = await getGAPerformanceData(mfrUpper, modelUpper)\n  if (gaData) return gaData\n  \n  return null\n}\n\n// Get performance from FAST AEROBASE (commercial jets)\nasync function getFastPerformanceData(mfrUpper: string, modelUpper: string) {\n  let searchPatterns: string[] = []\n  \n  if (mfrUpper.includes('BOEING')) {\n    const familyMatch = modelUpper.match(/(\\d{3})/)\n    if (familyMatch) {\n      const family = familyMatch[1]\n      searchPatterns.push(`B${family}%`)\n      searchPatterns.push(`B73${family.slice(-1)}%`)\n    }\n    if (modelUpper.includes('MAX')) {\n      searchPatterns.push(`B73MAX%`)\n    }\n  }\n  \n  if (mfrUpper.includes('AIRBUS')) {\n    const familyMatch = modelUpper.match(/A(\\d{3})/)\n    if (familyMatch) {\n      searchPatterns.push(`A${familyMatch[1]}%`)\n    }\n    if (modelUpper.includes('A380')) searchPatterns.push('A380%')\n    if (modelUpper.includes('A350')) searchPatterns.push('A350%')\n  }\n  \n  if (mfrUpper.includes('EMBRAER')) {\n    if (modelUpper.includes('ERJ') || modelUpper.includes('EMB-145')) {\n      searchPatterns.push('ERJ_145%')\n    }\n    if (modelUpper.includes('ERJ190') || modelUpper.includes('EMB-190')) {\n      searchPatterns.push('ERJ_190%')\n    }\n    if (modelUpper.includes('ERJ170') || modelUpper.includes('EMB-170')) {\n      searchPatterns.push('ERJ_170%')\n    }\n  }\n  \n  if (mfrUpper.includes('BOMBARDIER')) {\n    if (modelUpper.includes('CRJ')) {\n      searchPatterns.push('CRJ_%')\n    }\n    searchPatterns.push('BD_%')\n  }\n  \n  for (const pattern of searchPatterns) {\n    try {\n      const perf = await prisma.$queryRawUnsafe(`\n        SELECT TOP 1 * FROM AircraftPerformance \n        WHERE designation LIKE @pattern\n      `, { pattern }) as any[]\n      \n      if (perf && perf.length > 0) {\n        return { ...perf[0], source: 'fast' }\n      }\n    } catch (e) {\n      console.log('Fast performance query error:', e)\n    }\n  }\n  \n  return null\n}\n\n// Get performance from RisingUp specs (GA aircraft)\nasync function getGAPerformanceData(mfrUpper: string, modelUpper: string) {\n  // Try multiple matching strategies\n  try {\n    // Strategy 1: Try to match model numbers (e.g., \"150\" matches \"150 L\", \"172\" matches \"172 M\")\n    const modelNumbers = modelUpper.match(/\\d+/g) || []\n    \n    console.log('[GA] Looking for performance data:', { mfrUpper, modelUpper, modelNumbers })\n    \n    if (modelNumbers.length > 0) {\n      // Search for any model containing any of the numbers\n      for (const num of modelNumbers) {\n        // Try direct query without parameter binding\n        const mfrLike = `%${mfrUpper}%`\n        const modelLike = `%${num}%`\n        \n        console.log('[GA] Querying with:', mfrLike, modelLike)\n        \n        const specs = await prisma.$queryRawUnsafe(`\n          SELECT TOP 1 * FROM AircraftSpecs \n          WHERE UPPER(manufacturer) LIKE '${mfrLike}'\n            AND UPPER(model) LIKE '${modelLike}'\n        `) as any[]\n        \n        if (specs && specs.length > 0) {\n          const s = specs[0]\n          return {\n            designation: s.model,\n            mtow: s.gross_weight_lbs,\n            mlw: null,\n            mzfw: null,\n            oew: s.empty_weight_lbs,\n            fuel: s.fuel_capacity_gal,\n            range_nm: s.range_nm,\n            tofl: s.takeoff_ground_roll_ft,\n            num_engines: 1,\n            engine_designation: s.horsepower ? s.horsepower + ' HP' : null,\n            thrust_max: null,\n            span_ft: s.wingspan_ft,\n            length_ft: s.length_ft,\n            height_ft: s.height_ft,\n            wing_area: null,\n            vc_cruise: s.cruise_speed_kts,\n            vmo_mo: s.top_speed_kts,\n            cruise_alt: s.service_ceiling_ft,\n            maxpax: null,\n            takeoffGroundRoll: s.takeoff_ground_roll_ft,\n            landingGroundRoll: s.landing_ground_roll_ft,\n            rateOfClimb: s.rate_of_climb_fpm,\n            stallSpeed: s.stall_speed_dirty_kts,\n            source: 'risingup'\n          }\n        }\n      }\n    }\n  } catch (e) {\n    console.log('GA performance query error:', e)\n  }\n  \n  return null\n}\n\nexport async function checkTailHistory(nNumberRaw: string): Promise<TailHistoryActionResult> {\n  const nNumber = (nNumberRaw || \"\").trim().toUpperCase().replace(/^N/, '');\n  if (!nNumber) return { error: \"N-Number is required.\" };\n  \n  const fullNNumber = \"N\" + nNumber;\n  \n  try {\n    // Query from Azure SQL database\n    const aircraft = await prisma.aircraftMaster.findUnique({\n      where: { nNumber: fullNNumber }\n    });\n    \n    if (!aircraft) {\n      return { \n        error: `Aircraft ${fullNNumber} not found in database. Try N12345, N2025, N5678, or N9876.`,\n        remainingCredits: 999\n      };\n    }\n    \n    // Get performance data\n    const performance = await getPerformanceData(aircraft.mfr, aircraft.model)\n    \n    // Format the data for the UI\n    const formattedData = {\n      nNumber: aircraft.nNumber,\n      serialNumber: aircraft.serialNumber,\n      manufacturer: aircraft.mfr,\n      model: aircraft.model,\n      status: aircraft.statusCode,\n      airworthinessDate: aircraft.airWorthDate,\n      lastActionDate: aircraft.lastActionDate,\n      ownerName: aircraft.name,\n      typeRegistrant: aircraft.typeRegistrant,\n      engineManufacturer: aircraft.engMfr,\n      engineModel: aircraft.engineModel,\n      engineCount: aircraft.engCount,\n      // Performance data\n      performance: performance ? {\n        designation: performance.designation,\n        mtow: performance.mtow,\n        mlw: performance.mlw,\n        mzfw: performance.mzfw,\n        oew: performance.oew,\n        fuelCapacity: performance.fuel,\n        rangeNm: performance.range_nm,\n        takeoffFieldLength: performance.tofl,\n        numEngines: performance.num_engines,\n        engineModel: performance.engine_designation,\n        thrustMax: performance.thrust_max,\n        spanFt: performance.span_ft,\n        lengthFt: performance.length_ft,\n        heightFt: performance.height_ft,\n        wingArea: performance.wing_area,\n        cruiseSpeed: performance.vc_cruise,\n        maxOperatingSpeed: performance.vmo_mo,\n        cruiseAltitude: performance.cruise_alt,\n        maxPax: performance.maxpax,\n      } : null,\n    };\n    \n    return { \n      data: formattedData, \n      remainingCredits: 999\n    };\n  } catch (error) {\n    console.error(\"Database query error:\", error);\n    \n    // Fallback to demo data on error\n    const demoData = getDemoAircraft();\n    return { \n      data: { ...demoData, nNumber: fullNNumber }, \n      remainingCredits: 999,\n      error: \"Using cached data due to database error.\"\n    };\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\tailhistory\\components\\search-bar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\tailhistory\\components\\tailhistory-client.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Timeline3D' is defined but never used.","line":7,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":20,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Timeline3D"},"fix":{"range":[262,273],"text":""},"desc":"Remove unused variable \"Timeline3D\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'showPerformance' is assigned a value but never used.","line":51,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":51,"endColumn":25},{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`handleSubmit` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nC:\\Users\\David\\next-dashboard\\app\\modules\\tailhistory\\components\\tailhistory-client.tsx:56:7\n  54 |   useEffect(() => {\n  55 |     if (initialNNumber) {\n> 56 |       handleSubmit(initialNNumber);\n     |       ^^^^^^^^^^^^ `handleSubmit` accessed before it is declared\n  57 |     }\n  58 |   }, [initialNNumber]);\n  59 |\n\nC:\\Users\\David\\next-dashboard\\app\\modules\\tailhistory\\components\\tailhistory-client.tsx:60:3\n  58 |   }, [initialNNumber]);\n  59 |\n> 60 |   const handleSubmit = useCallback((value: string) => {\n     |   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 61 |     startTransition(async () => {\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 62 |       setError(null);\n     â€¦\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 79 |     });\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 80 |   }, []);\n     | ^^^^^^^^^^ `handleSubmit` is declared here\n  81 |\n  82 |   return (\n  83 |     <div className=\"space-y-4\">","line":56,"column":7,"nodeType":null,"endLine":56,"endColumn":19},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'handleSubmit'. Either include it or remove the dependency array.","line":58,"column":6,"nodeType":"ArrayExpression","endLine":58,"endColumn":22,"suggestions":[{"desc":"Update the dependencies array to be: [handleSubmit, initialNNumber]","fix":{"range":[1866,1882],"text":"[handleSubmit, initialNNumber]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useCallback, useState, useTransition, useEffect } from \"react\";\nimport { useSearchParams } from \"next/navigation\";\nimport { checkTailHistory, TailHistoryActionResult } from \"../actions\";\nimport { SearchBar } from \"./search-bar\";\nimport { Timeline3D, TailHistoryRecord } from \"./timeline-3d\";\nimport { AircraftModel } from \"../../../components/three/aircraft-model\";\n\ntype PerformanceData = {\n  designation: string;\n  mtow: string | null;\n  mlw: string | null;\n  mzfw: string | null;\n  oew: string | null;\n  fuelCapacity: string | null;\n  rangeNm: string | null;\n  takeoffFieldLength: string | null;\n  numEngines: number | null;\n  engineModel: string | null;\n  thrustMax: string | null;\n  spanFt: string | null;\n  lengthFt: string | null;\n  heightFt: string | null;\n  wingArea: string | null;\n  cruiseSpeed: string | null;\n  maxOperatingSpeed: string | null;\n  cruiseAltitude: string | null;\n  maxPax: number | null;\n  // GA fields\n  takeoffGroundRoll?: string | null;\n  landingGroundRoll?: string | null;\n  rateOfClimb?: string | null;\n  stallSpeed?: string | null;\n  source?: string;\n};\n\ntype ExtendedRecord = TailHistoryRecord & {\n  performance: PerformanceData | null;\n};\n\nexport default function TailHistoryClient() {\n  const searchParams = useSearchParams();\n  const initialNNumber = searchParams?.get(\"n\");\n  \n  const [isPending, startTransition] = useTransition();\n  const [record, setRecord] = useState<ExtendedRecord | null>(null);\n  const [error, setError] = useState<string | null>(null);\n  const [remaining, setRemaining] = useState<number | undefined>(undefined);\n  const [showBuyModal, setShowBuyModal] = useState(false);\n  const [showPerformance, setShowPerformance] = useState(false);\n\n  // Auto-search if initialNNumber is provided\n  useEffect(() => {\n    if (initialNNumber) {\n      handleSubmit(initialNNumber);\n    }\n  }, [initialNNumber]);\n\n  const handleSubmit = useCallback((value: string) => {\n    startTransition(async () => {\n      setError(null);\n      setShowPerformance(false);\n      const result: TailHistoryActionResult = await checkTailHistory(value);\n      if (result.needsCredits) {\n        setShowBuyModal(true);\n        setRecord(null);\n        setRemaining(result.remainingCredits);\n        setError(result.error ?? \"No credits remaining.\");\n        return;\n      }\n      if (result.error) {\n        setError(result.error);\n        setRecord(null);\n        return;\n      }\n      setRecord(result.data as ExtendedRecord);\n      setRemaining(result.remainingCredits);\n    });\n  }, []);\n\n  return (\n    <div className=\"space-y-4\">\n      <SearchBar onSubmit={handleSubmit} loading={isPending} />\n\n      {remaining !== undefined && (\n        <div className=\"inline-flex items-center gap-2 rounded-xl border border-slate-800 bg-slate-900/60 px-3 py-2 text-xs font-semibold text-slate-200\">\n          Remaining Credits: {remaining}\n        </div>\n      )}\n\n      {error && (\n        <div className=\"rounded-xl border border-rose-800 bg-rose-950/50 px-4 py-3 text-sm text-rose-100\">\n          {error}\n        </div>\n      )}\n\n      {showBuyModal && (\n        <div className=\"fixed inset-0 z-40 flex items-center justify-center bg-black/60 p-4\">\n          <div className=\"w-full max-w-md rounded-2xl border border-slate-800 bg-slate-900 p-5 shadow-2xl shadow-black/50\">\n            <h3 className=\"text-lg font-semibold text-slate-50\">Buy More Credits</h3>\n            <p className=\"mt-2 text-sm text-slate-300\">\n              Youâ€™ve run out of credits. Purchase more to keep exploring TailHistory.\n            </p>\n            <div className=\"mt-4 flex justify-end gap-2\">\n              <button\n                onClick={() => setShowBuyModal(false)}\n                className=\"rounded-xl border border-slate-700 px-4 py-2 text-sm text-slate-200\"\n              >\n                Close\n              </button>\n              <button\n                onClick={() => setShowBuyModal(false)}\n                className=\"rounded-xl bg-emerald-500 px-4 py-2 text-sm font-semibold text-emerald-950 hover:bg-emerald-400\"\n              >\n                Buy Credits\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {record && (\n        <div className=\"grid gap-3 md:grid-cols-2\">\n          <div className=\"space-y-3\">\n            <div className=\"rounded-2xl border border-slate-800 bg-slate-900/60 p-4\">\n              <p className=\"text-xs uppercase tracking-[0.2em] text-slate-400\">Aircraft</p>\n              <h2 className=\"text-xl font-semibold text-slate-50\">{record.nNumber}</h2>\n              <p className=\"text-sm text-slate-300\">\n                {record.manufacturer} {record.model} Â· SN {record.serialNumber}\n              </p>\n            </div>\n\n            <div className=\"rounded-2xl border border-slate-800 bg-slate-900/60 p-4 space-y-1 text-sm text-slate-200\">\n              <div className=\"flex justify-between\"><span>Status</span><span className=\"text-slate-300\">{record.status ?? \"Unknown\"}</span></div>\n              <div className=\"flex justify-between\"><span>Airworthiness</span><span className=\"text-slate-300\">{record.airworthinessDate ?? \"Unknown\"}</span></div>\n              <div className=\"flex justify-between\"><span>Last Action</span><span className=\"text-slate-300\">{record.lastActionDate ?? \"Unknown\"}</span></div>\n              <div className=\"flex justify-between\"><span>Owner</span><span className=\"text-slate-300\">{record.ownerName ?? \"Unknown\"}</span></div>\n              <div className=\"flex justify-between\"><span>Registrant</span><span className=\"text-slate-300\">{record.typeRegistrant ?? \"Unknown\"}</span></div>\n              <div className=\"flex justify-between\"><span>Engine</span><span className=\"text-slate-300\">{record.engineManufacturer ?? \"?\"} {record.engineModel ?? \"\"}</span></div>\n              <div className=\"flex justify-between\"><span>Engine Count</span><span className=\"text-slate-300\">{record.engineCount ?? \"?\"}</span></div>\n            </div>\n\n            {/* Performance Data Section */}\n            {record.performance && (\n              <div className=\"rounded-2xl border border-blue-900/50 bg-blue-950/30 p-4 space-y-3\">\n                <div className=\"flex items-center justify-between\">\n                  <p className=\"text-xs uppercase tracking-[0.2em] text-blue-400\">Performance Specs</p>\n                  <span className=\"text-xs text-blue-500\">{record.performance.designation}</span>\n                </div>\n                \n                <div className=\"grid grid-cols-2 gap-2 text-xs\">\n                  {record.performance.mtow && (\n                    <div className=\"bg-slate-800/50 rounded-lg p-2\">\n                      <span className=\"text-slate-400\">MTOW</span>\n                      <p className=\"text-slate-200 font-semibold\">{record.performance.mtow} lbs</p>\n                    </div>\n                  )}\n                  {record.performance.rangeNm && (\n                    <div className=\"bg-slate-800/50 rounded-lg p-2\">\n                      <span className=\"text-slate-400\">Range</span>\n                      <p className=\"text-slate-200 font-semibold\">{record.performance.rangeNm} nm</p>\n                    </div>\n                  )}\n                  {record.performance.numEngines && (\n                    <div className=\"bg-slate-800/50 rounded-lg p-2\">\n                      <span className=\"text-slate-400\">Engines</span>\n                      <p className=\"text-slate-200 font-semibold\">{record.performance.numEngines}x</p>\n                    </div>\n                  )}\n                  {record.performance.engineModel && (\n                    <div className=\"bg-slate-800/50 rounded-lg p-2\">\n                      <span className=\"text-slate-400\">Engine</span>\n                      <p className=\"text-slate-200 font-semibold text-xs\">{record.performance.engineModel}</p>\n                    </div>\n                  )}\n                  {record.performance.spanFt && (\n                    <div className=\"bg-slate-800/50 rounded-lg p-2\">\n                      <span className=\"text-slate-400\">Wingspan</span>\n                      <p className=\"text-slate-200 font-semibold\">{record.performance.spanFt} ft</p>\n                    </div>\n                  )}\n                  {record.performance.lengthFt && (\n                    <div className=\"bg-slate-800/50 rounded-lg p-2\">\n                      <span className=\"text-slate-400\">Length</span>\n                      <p className=\"text-slate-200 font-semibold\">{record.performance.lengthFt} ft</p>\n                    </div>\n                  )}\n                  {record.performance.cruiseSpeed && (\n                    <div className=\"bg-slate-800/50 rounded-lg p-2\">\n                      <span className=\"text-slate-400\">Cruise Speed</span>\n                      <p className=\"text-slate-200 font-semibold\">{record.performance.cruiseSpeed} kts</p>\n                    </div>\n                  )}\n                  {record.performance.maxPax && (\n                    <div className=\"bg-slate-800/50 rounded-lg p-2\">\n                      <span className=\"text-slate-400\">Max Pax</span>\n                      <p className=\"text-slate-200 font-semibold\">{record.performance.maxPax}</p>\n                    </div>\n                  )}\n                </div>\n              </div>\n            )}\n\n            {!record.performance && (\n              <div className=\"rounded-2xl border border-slate-800 bg-slate-900/30 p-4 text-xs text-slate-400\">\n                No performance data available for this aircraft model.\n              </div>\n            )}\n          </div>\n\n          {/* Right side: 3D Ghost Aircraft */}\n          <div className=\"h-80 rounded-2xl border border-slate-800 bg-slate-900/60 overflow-hidden\">\n            <AircraftModel\n              nNumber={record.nNumber}\n              manufacturer={record.manufacturer || 'Unknown'}\n              model={record.model || 'Unknown'}\n              length={record.performance?.lengthFt ? parseFloat(record.performance.lengthFt) : undefined}\n              wingspan={record.performance?.spanFt ? parseFloat(record.performance.spanFt) : undefined}\n              engineCount={record.performance?.numEngines || record.engineCount || 1}\n            />\n          </div>\n        </div>\n      )}\n\n      {!record && !isPending && (\n        <div className=\"rounded-2xl border border-slate-800 bg-slate-900/50 p-6 text-sm text-slate-300\">\n          Enter an N-Number to retrieve its history and render the 3D timeline.\n        </div>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\tailhistory\\components\\timeline-3d.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\tailhistory\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\tailhistory\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\training\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setCompletedGoals' is assigned a value but never used.","line":48,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":48,"endColumn":43},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":50,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1594,1597],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1594,1597],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":281,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":281,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10210,10213],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10210,10213],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { useSession, signIn } from 'next-auth/react'\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Loader2 } from 'lucide-react'\n\nimport GoalSelector from '@/components/training/GoalSelector'\nimport TrainingRoadmap from '@/components/training/TrainingRoadmap'\nimport HoursChart from '@/components/training/HoursChart'\nimport FinancialTracker from '@/components/training/FinancialTracker'\nimport { getGoalById, GoalType } from '@/lib/training/requirements'\n\ninterface TrainingProgress {\n  totalHours: number\n  soloHours: number\n  nightHours: number\n  instrumentHours: number\n  crossCountryHours: number\n  xcSoloHours: number\n  dualGiven: number\n}\n\ninterface TrainingGoal {\n  id: string\n  goalType: string\n  targetDate: string | null\n}\n\nexport default function TrainingPage() {\n  const { data: session, status } = useSession()\n  const [loading, setLoading] = useState(true)\n  const [savingGoal, setSavingGoal] = useState(false)\n  \n  // Data states\n  const [currentGoal, setCurrentGoal] = useState<TrainingGoal | null>(null)\n  const [progress, setProgress] = useState<TrainingProgress>({\n    totalHours: 0,\n    soloHours: 0,\n    nightHours: 0,\n    instrumentHours: 0,\n    crossCountryHours: 0,\n    xcSoloHours: 0,\n    dualGiven: 0,\n  })\n  const [completedGoals, setCompletedGoals] = useState<GoalType[]>([])\n\n  const [currencyProgress, setCurrencyProgress] = useState<any[]>([])\n\n  // Fetch data on mount\n  useEffect(() => {\n    if (status === 'loading') return\n    \n    if (!session) {\n      setLoading(false)\n      return\n    }\n\n    async function fetchData() {\n      try {\n        // Fetch training goal\n        const goalRes = await fetch('/api/training/goal')\n        if (goalRes.ok) {\n          const goalData = await goalRes.json()\n          if (goalData) {\n            setCurrentGoal(goalData)\n          }\n        }\n\n        // Fetch training progress (existing API)\n        const progressRes = await fetch('/api/training-progress')\n        if (progressRes.ok) {\n          const progressData = await progressRes.json()\n          if (progressData) {\n            setProgress({\n              totalHours: progressData.totalHours || 0,\n              soloHours: progressData.soloHours || 0,\n              nightHours: progressData.nightHours || 0,\n              instrumentHours: progressData.instrumentHours || 0,\n              crossCountryHours: progressData.crossCountryHours || 0,\n              xcSoloHours: progressData.xcSoloHours || 0,\n              dualGiven: progressData.dualGiven || 0,\n            })\n          }\n        }\n\n        const currencyRes = await fetch('/api/logbook/currency/progress')\n        if (currencyRes.ok) {\n          const currencyData = await currencyRes.json()\n          setCurrencyProgress(currencyData.progress || [])\n        }\n      } catch (error) {\n        console.error('Error fetching data:', error)\n      } finally {\n        setLoading(false)\n      }\n    }\n\n    fetchData()\n  }, [session, status])\n\n  // Handle goal selection\n  const handleSelectGoal = async (goalType: GoalType) => {\n    setSavingGoal(true)\n    try {\n      const res = await fetch('/api/training/goal', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ goalType })\n      })\n      \n      if (res.ok) {\n        const data = await res.json()\n        setCurrentGoal(data)\n      }\n    } catch (error) {\n      console.error('Error saving goal:', error)\n    } finally {\n      setSavingGoal(false)\n    }\n  }\n\n  // Map progress to requirement keys for roadmap\n  const progressMap: Record<string, number> = {\n    totalTime: progress.totalHours,\n    soloTime: progress.soloHours,\n    night: progress.nightHours,\n    instrument: progress.instrumentHours,\n    crossCountry: progress.crossCountryHours,\n    xcSolo: progress.xcSoloHours,\n    dualGiven: progress.dualGiven,\n    dualInstrument: progress.instrumentHours,\n    picTime: progress.totalHours,\n  }\n\n  // Calculate hours remaining for financial projections\n  const goalData = currentGoal?.goalType ? getGoalById(currentGoal.goalType as GoalType) : null\n  const hoursRemaining = goalData \n    ? Math.max(0, goalData.totalHoursRequired - progress.totalHours)\n    : 0\n\n  if (status === 'loading' || loading) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n      </div>\n    )\n  }\n\n  if (!session) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center p-4\">\n        <Card className=\"max-w-md w-full\">\n          <CardContent className=\"pt-6 text-center\">\n            <div className=\"text-6xl mb-4\">ðŸŽ“</div>\n            <h1 className=\"text-2xl font-bold mb-2\">Training Progress Tracker</h1>\n            <p className=\"text-muted-foreground mb-6\">\n              Sign in to track your flight training progress, choose your goals, and see financial projections\n            </p>\n            <Button onClick={() => signIn()}>\n              Sign In to Track Progress\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background p-4 md:p-8\">\n      <div className=\"max-w-7xl mx-auto space-y-6\">\n        \n        {/* Header */}\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold\">ðŸŽ“ Training Tracker</h1>\n            <p className=\"text-muted-foreground\">\n              Track your progress toward pilot certification\n            </p>\n          </div>\n        </div>\n\n        <Tabs defaultValue=\"goals\" className=\"w-full\">\n          <TabsList className=\"mb-4\">\n            <TabsTrigger value=\"goals\">Goals</TabsTrigger>\n            <TabsTrigger value=\"roadmap\">Roadmap</TabsTrigger>\n            <TabsTrigger value=\"progress\">Progress</TabsTrigger>\n            <TabsTrigger value=\"currency\">Currency</TabsTrigger>\n            <TabsTrigger value=\"costs\">Costs</TabsTrigger>\n          </TabsList>\n\n          {/* Goals Tab */}\n          <TabsContent value=\"goals\" className=\"space-y-6\">\n            <GoalSelector \n              currentGoal={currentGoal?.goalType}\n              completedGoals={completedGoals}\n              onSelectGoal={handleSelectGoal}\n              isLoading={savingGoal}\n            />\n            \n            {currentGoal?.goalType && (\n              <Card className=\"mt-6\">\n                <CardHeader>\n                  <CardTitle>Quick Stats</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                    <div className=\"text-center p-4 bg-muted rounded-lg\">\n                      <div className=\"text-3xl font-bold text-blue-600\">{progress.totalHours}</div>\n                      <div className=\"text-sm text-muted-foreground\">Total Hours</div>\n                    </div>\n                    <div className=\"text-center p-4 bg-muted rounded-lg\">\n                      <div className=\"text-3xl font-bold text-green-600\">{progress.soloHours}</div>\n                      <div className=\"text-sm text-muted-foreground\">Solo Hours</div>\n                    </div>\n                    <div className=\"text-center p-4 bg-muted rounded-lg\">\n                      <div className=\"text-3xl font-bold text-purple-600\">{progress.instrumentHours}</div>\n                      <div className=\"text-sm text-muted-foreground\">Instrument</div>\n                    </div>\n                    <div className=\"text-center p-4 bg-muted rounded-lg\">\n                      <div className=\"text-3xl font-bold text-amber-600\">{progress.crossCountryHours}</div>\n                      <div className=\"text-sm text-muted-foreground\">Cross Country</div>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            )}\n          </TabsContent>\n\n          {/* Roadmap Tab */}\n          <TabsContent value=\"roadmap\">\n            <TrainingRoadmap \n              goalType={currentGoal?.goalType}\n              progress={progressMap}\n            />\n          </TabsContent>\n\n          {/* Progress Tab */}\n          <TabsContent value=\"progress\" className=\"space-y-6\">\n            <HoursChart progress={progress} />\n            \n            {/* Hours Input for manual entry */}\n            <Card>\n              <CardHeader>\n                <CardTitle>Log Your Hours</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-muted-foreground mb-4\">\n                  Hours are synced from your logbook. Manual entry coming soon.\n                </p>\n                <Button variant=\"outline\" asChild>\n                  <a href=\"/modules/logbook\" target=\"_blank\">\n                    Open Logbook\n                  </a>\n                </Button>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"currency\" className=\"space-y-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Currency Progress</CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-3\">\n                {currencyProgress.length === 0 && (\n                  <p className=\"text-sm text-muted-foreground\">No currency data yet.</p>\n                )}\n                {currencyProgress.map((rule) => (\n                  <div key={rule.code} className=\"rounded-md border border-border p-3\">\n                    <div className=\"flex items-center justify-between\">\n                      <div>\n                        <p className=\"font-medium\">{rule.name}</p>\n                        <p className=\"text-xs text-muted-foreground\">{rule.authority}</p>\n                      </div>\n                      <span className=\"text-xs rounded-md border px-2 py-0.5\">{rule.status}</span>\n                    </div>\n                    <div className=\"mt-2 space-y-1 text-xs\">\n                      {rule.progress.map((p: any, idx: number) => (\n                        <div key={idx} className=\"flex justify-between\">\n                          <span>{p.unit}</span>\n                          <span>{p.completed} / {p.required}</span>\n                        </div>\n                      ))}\n                    </div>\n                    {rule.nextDueAt && (\n                      <p className=\"mt-2 text-xs text-muted-foreground\">Next due: {new Date(rule.nextDueAt).toLocaleDateString()}</p>\n                    )}\n                  </div>\n                ))}\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          {/* Costs Tab */}\n          <TabsContent value=\"costs\">\n            <FinancialTracker \n              goalType={currentGoal?.goalType}\n              totalHours={progress.totalHours}\n              hoursRemaining={hoursRemaining}\n            />\n          </TabsContent>\n        </Tabs>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\weather-radar\\WeatherRadarMap.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setLoadingFrames' is assigned a value but never used.","line":94,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":94,"endColumn":41},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":166,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":166,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5818,5821],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5818,5821],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'radarMode'. Either include it or remove the dependency array.","line":224,"column":6,"nodeType":"ArrayExpression","endLine":224,"endColumn":46,"suggestions":[{"desc":"Update the dependencies array to be: [currentTileUrl, radarOpacity, mapReady, radarMode]","fix":{"range":[7892,7932],"text":"[currentTileUrl, radarOpacity, mapReady, radarMode]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'sleep' is assigned a value but never used.","line":267,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":267,"endColumn":16},{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Date.now` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nC:\\Users\\David\\next-dashboard\\app\\modules\\weather-radar\\WeatherRadarMap.tsx:366:20\n  364 |         return new Date(then).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\n  365 |       }\n> 366 |       const then = Date.now() - currentFrame.minutesAgo * 60_000;\n      |                    ^^^^^^^^^^ Cannot call impure function\n  367 |       return new Date(then).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\n  368 |     } catch {\n  369 |       return '';","line":366,"column":20,"nodeType":null,"endLine":366,"endColumn":30}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useEffect, useMemo, useRef, useState } from 'react';\nimport L from 'leaflet';\nimport 'leaflet/dist/leaflet.css';\n\n// Fix Leaflet default icons (works in production builds)\nconst markerIconUrl = new URL('leaflet/dist/images/marker-icon.png', import.meta.url).toString();\nconst markerIconRetinaUrl = new URL('leaflet/dist/images/marker-icon-2x.png', import.meta.url).toString();\nconst markerShadowUrl = new URL('leaflet/dist/images/marker-shadow.png', import.meta.url).toString();\n\nL.Icon.Default.mergeOptions({\n  iconUrl: markerIconUrl,\n  iconRetinaUrl: markerIconRetinaUrl,\n  shadowUrl: markerShadowUrl,\n});\n\nexport default function WeatherRadarMap() {\n  const mapRef = useRef<L.Map | null>(null);\n  const [mapReady, setMapReady] = useState(false);\n  const baseLayerRef = useRef<L.TileLayer | null>(null);\n  const radarLayerARef = useRef<L.TileLayer | null>(null);\n  const radarLayerBRef = useRef<L.TileLayer | null>(null);\n  const activeRadarLayerRef = useRef<'A' | 'B'>('A');\n  const transitionRafRef = useRef<number | null>(null);\n  const markerRef = useRef<L.Marker | null>(null);\n\n  const [isPlaying, setIsPlaying] = useState(false);\n  const frameIndexRef = useRef(0);\n  const playTokenRef = useRef(0);\n\n  const [radarMode, setRadarMode] = useState<'mrms' | 'nexrad'>('mrms');\n  const [clockMs, setClockMs] = useState(() => Date.now());\n  const radarTileErrorRef = useRef(0);\n\n  const MRMS_STEP_MIN = 2;\n  const MRMS_WINDOW_MIN = 120;\n  const MRMS_LATENCY_MIN = 10;\n\n  useEffect(() => {\n    const t = window.setInterval(() => setClockMs(Date.now()), 60_000);\n    return () => window.clearInterval(t);\n  }, []);\n\n  const mrmsBaseUtcMs = useMemo(() => {\n    const d = new Date(clockMs);\n    // floor to minute\n    d.setUTCSeconds(0, 0);\n    // floor to even minute\n    d.setUTCMinutes(d.getUTCMinutes() - (d.getUTCMinutes() % MRMS_STEP_MIN));\n    // latency\n    d.setUTCMinutes(d.getUTCMinutes() - MRMS_LATENCY_MIN);\n    return d.getTime();\n  }, [clockMs]);\n\n  function formatUtcStamp(ms: number) {\n    const d = new Date(ms);\n    const y = d.getUTCFullYear();\n    const mo = String(d.getUTCMonth() + 1).padStart(2, '0');\n    const da = String(d.getUTCDate()).padStart(2, '0');\n    const h = String(d.getUTCHours()).padStart(2, '0');\n    const mi = String(d.getUTCMinutes()).padStart(2, '0');\n    return `${y}${mo}${da}${h}${mi}`;\n  }\n\n  const frames = useMemo(() => {\n    if (radarMode === 'nexrad') {\n      const mins = [55, 50, 45, 40, 35, 30, 25, 20, 15, 10, 5, 0];\n      return mins.map((m) => ({ minutesAgo: m, kind: 'nexrad' as const }));\n    }\n\n    // MRMS archived frames every 2 minutes.\n    const out: Array<{ minutesAgo: number; kind: 'mrms'; ts: string }> = [];\n    for (let m = MRMS_WINDOW_MIN; m >= 0; m -= MRMS_STEP_MIN) {\n      const ts = formatUtcStamp(mrmsBaseUtcMs - m * 60_000);\n      out.push({ minutesAgo: m, kind: 'mrms', ts });\n    }\n    return out;\n  }, [radarMode, mrmsBaseUtcMs]);\n\n  const [frameIndex, setFrameIndex] = useState(frames.length - 1);\n\n  useEffect(() => {\n    // When mode/frames change, keep index in range and default to newest.\n    setFrameIndex((prev) => {\n      if (!frames.length) return 0;\n      if (prev >= 0 && prev < frames.length) return prev;\n      return frames.length - 1;\n    });\n  }, [frames.length]);\n\n  const [jumpIcao, setJumpIcao] = useState('');\n  const [notice, setNotice] = useState<string | null>(null);\n  const [loadingFrames, setLoadingFrames] = useState(false);\n  const [radarOpacity, setRadarOpacity] = useState(0.72);\n  const [basemap, setBasemap] = useState<'light' | 'dark'>('light');\n  const [showLegend, setShowLegend] = useState(false);\n  const [speedMs, setSpeedMs] = useState(450);\n  const [preloadEnabled, setPreloadEnabled] = useState(true);\n\n  // Frames are fixed for IEM (0-55 minutes). No fetch needed.\n  useEffect(() => {\n    // Initialize map\n    const map = L.map('weather-radar-map', {\n      center: [39.8283, -98.5795], // Center of US\n      zoom: 6,\n      zoomControl: false,\n    });\n\n    mapRef.current = map;\n    setMapReady(true);\n\n    L.control\n      .zoom({ position: 'bottomright' })\n      .addTo(map);\n\n    baseLayerRef.current = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {\n      attribution: 'Â© OpenStreetMap, Â© CARTO',\n      maxZoom: 19,\n    }).addTo(map);\n\n    const pauseOnMove = () => setIsPlaying(false);\n    map.on('movestart', pauseOnMove);\n    map.on('zoomstart', pauseOnMove);\n\n    return () => {\n      playTokenRef.current += 1;\n      if (transitionRafRef.current) {\n        cancelAnimationFrame(transitionRafRef.current);\n        transitionRafRef.current = null;\n      }\n      setMapReady(false);\n      map.off('movestart', pauseOnMove);\n      map.off('zoomstart', pauseOnMove);\n      map.remove();\n    };\n  }, []);\n\n  useEffect(() => {\n    const layer = baseLayerRef.current;\n    if (!layer) return;\n\n    const url = basemap === 'dark'\n      ? 'https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png'\n      : 'https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png';\n    layer.setUrl(url);\n  }, [basemap]);\n\n  const currentFrame = frames[frameIndex] || null;\n  const currentTileUrl = useMemo(() => {\n    if (!currentFrame) return null;\n    if (currentFrame.kind === 'mrms') {\n      const layer = `mrms::lcref-${currentFrame.ts}`;\n      return `https://mesonet{s}.agron.iastate.edu/cache/tile.py/1.0.0/${encodeURIComponent(layer)}-900913/{z}/{x}/{y}.png`;\n    }\n\n    const m = currentFrame.minutesAgo;\n    const layer = m === 0 ? 'nexrad-n0q' : `nexrad-n0q-m${String(m).padStart(2, '0')}m`;\n    return `https://mesonet{s}.agron.iastate.edu/cache/tile.py/1.0.0/${layer}-900913/{z}/{x}/{y}.png`;\n  }, [currentFrame]);\n\n  useEffect(() => {\n    frameIndexRef.current = frameIndex;\n  }, [frameIndex]);\n\n  function tileUrlForFrame(frame: any) {\n    if (frame?.kind === 'mrms') {\n      const layer = `mrms::lcref-${frame.ts}`;\n      return `https://mesonet{s}.agron.iastate.edu/cache/tile.py/1.0.0/${encodeURIComponent(layer)}-900913/{z}/{x}/{y}.png`;\n    }\n    const m = Number(frame?.minutesAgo) || 0;\n    const layer = m === 0 ? 'nexrad-n0q' : `nexrad-n0q-m${String(m).padStart(2, '0')}m`;\n    return `https://mesonet{s}.agron.iastate.edu/cache/tile.py/1.0.0/${layer}-900913/{z}/{x}/{y}.png`;\n  }\n\n  // Ensure radar layers exist once the map is ready.\n  useEffect(() => {\n    const map = mapRef.current;\n    if (!mapReady || !map) return;\n    if (!currentTileUrl) return;\n\n    if (!radarLayerARef.current) {\n      radarLayerARef.current = L.tileLayer(currentTileUrl, {\n        attribution: 'Radar Â© Iowa Environmental Mesonet',\n        opacity: radarOpacity,\n        maxZoom: 12,\n        zIndex: 500,\n        subdomains: ['1', '2', '3'],\n        updateWhenIdle: true,\n        updateWhenZooming: false,\n        keepBuffer: 4,\n      }).addTo(map);\n\n      radarLayerARef.current.on('tileerror', () => {\n        radarTileErrorRef.current += 1;\n        // If MRMS is missing/unavailable, fall back to NEXRAD.\n        if (radarMode === 'mrms' && radarTileErrorRef.current >= 8) {\n          setRadarMode('nexrad');\n          setNotice('High-res radar temporarily unavailable. Switched to standard radar.');\n        }\n      });\n    }\n\n    if (!radarLayerBRef.current) {\n      radarLayerBRef.current = L.tileLayer(currentTileUrl, {\n        attribution: 'Radar Â© Iowa Environmental Mesonet',\n        opacity: 0,\n        maxZoom: 12,\n        zIndex: 501,\n        subdomains: ['1', '2', '3'],\n        updateWhenIdle: true,\n        updateWhenZooming: false,\n        keepBuffer: 4,\n      }).addTo(map);\n\n      radarLayerBRef.current.on('tileerror', () => {\n        radarTileErrorRef.current += 1;\n        if (radarMode === 'mrms' && radarTileErrorRef.current >= 8) {\n          setRadarMode('nexrad');\n          setNotice('High-res radar temporarily unavailable. Switched to standard radar.');\n        }\n      });\n    }\n  }, [currentTileUrl, radarOpacity, mapReady]);\n\n  useEffect(() => {\n    radarTileErrorRef.current = 0;\n  }, [radarMode]);\n\n  // Keep opacity in sync.\n  useEffect(() => {\n    if (activeRadarLayerRef.current === 'A') {\n      radarLayerARef.current?.setOpacity(radarOpacity);\n      radarLayerBRef.current?.setOpacity(0);\n    } else {\n      radarLayerBRef.current?.setOpacity(radarOpacity);\n      radarLayerARef.current?.setOpacity(0);\n    }\n  }, [radarOpacity]);\n\n  // When scrubbing (not playing), snap the active layer to the selected frame.\n  useEffect(() => {\n    const map = mapRef.current;\n    if (!mapReady || !map) return;\n    if (isPlaying) return;\n    if (!currentFrame) return;\n\n    const active = activeRadarLayerRef.current;\n    const activeLayer = active === 'A' ? radarLayerARef.current : radarLayerBRef.current;\n    const inactiveLayer = active === 'A' ? radarLayerBRef.current : radarLayerARef.current;\n    if (!activeLayer || !inactiveLayer) return;\n\n    activeLayer.setUrl(tileUrlForFrame(currentFrame));\n    activeLayer.setOpacity(radarOpacity);\n    inactiveLayer.setOpacity(0);\n  }, [currentFrame, isPlaying, mapReady, radarOpacity]);\n\n  // Playback loop with smooth cross-fade.\n  useEffect(() => {\n    const map = mapRef.current;\n    if (!mapReady || !map) return;\n    if (!isPlaying) return;\n    if (frames.length < 2) return;\n\n    const token = ++playTokenRef.current;\n\n    const sleep = (ms: number) => new Promise<void>((resolve) => setTimeout(resolve, ms));\n\n    const waitForVisibleTiles = (layer: L.TileLayer, timeoutMs: number) => {\n      return new Promise<void>((resolve) => {\n        let done = false;\n        const finish = () => {\n          if (done) return;\n          done = true;\n          layer.off('load', onLoad);\n          window.clearTimeout(timer);\n          resolve();\n        };\n\n        const onLoad = () => finish();\n        layer.on('load', onLoad);\n        const timer = window.setTimeout(() => finish(), timeoutMs);\n      });\n    };\n\n    const fade = (activeLayer: L.TileLayer, inactiveLayer: L.TileLayer, duration: number) => {\n      return new Promise<void>((resolve) => {\n        const start = performance.now();\n        const tick = (now: number) => {\n          if (playTokenRef.current !== token) {\n            resolve();\n            return;\n          }\n          const t = Math.min(1, (now - start) / duration);\n          const eased = t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2;\n          activeLayer.setOpacity((1 - eased) * radarOpacity);\n          inactiveLayer.setOpacity(eased * radarOpacity);\n\n          if (t < 1) {\n            transitionRafRef.current = requestAnimationFrame(tick);\n            return;\n          }\n\n          transitionRafRef.current = null;\n          resolve();\n        };\n\n        transitionRafRef.current = requestAnimationFrame(tick);\n      });\n    };\n\n    const run = async () => {\n      while (playTokenRef.current === token) {\n        const curIdx = frameIndexRef.current;\n        const nextIdx = (curIdx + 1) % frames.length;\n        const cur = frames[curIdx];\n        const next = frames[nextIdx];\n        if (!cur || !next) return;\n\n        const activeKey = activeRadarLayerRef.current;\n        const activeLayer = activeKey === 'A' ? radarLayerARef.current : radarLayerBRef.current;\n        const inactiveLayer = activeKey === 'A' ? radarLayerBRef.current : radarLayerARef.current;\n        if (!activeLayer || !inactiveLayer) return;\n\n        activeLayer.setUrl(tileUrlForFrame(cur));\n        inactiveLayer.setUrl(tileUrlForFrame(next));\n        activeLayer.setOpacity(radarOpacity);\n        inactiveLayer.setOpacity(0);\n\n        if (preloadEnabled) {\n          // Wait briefly for the next frame tiles to load before fading.\n          await waitForVisibleTiles(inactiveLayer, 900);\n        }\n\n        // Favor continuous blending over pauses.\n        const fadeDuration = Math.max(260, Math.min(1400, Math.round(speedMs)));\n        await fade(activeLayer, inactiveLayer, fadeDuration);\n\n        if (playTokenRef.current !== token) return;\n\n        activeRadarLayerRef.current = activeKey === 'A' ? 'B' : 'A';\n        setFrameIndex(nextIdx);\n\n        // No extra rest; keep it moving.\n      }\n    };\n\n    run();\n\n    return () => {\n      playTokenRef.current += 1;\n      if (transitionRafRef.current) {\n        cancelAnimationFrame(transitionRafRef.current);\n        transitionRafRef.current = null;\n      }\n    };\n  }, [isPlaying, mapReady, radarOpacity, speedMs, frames, preloadEnabled]);\n\n  const frameLabel = useMemo(() => {\n    if (!currentFrame) return 'â€”';\n    try {\n      if (currentFrame.kind === 'mrms') {\n        const then = mrmsBaseUtcMs - currentFrame.minutesAgo * 60_000;\n        return new Date(then).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\n      }\n      const then = Date.now() - currentFrame.minutesAgo * 60_000;\n      return new Date(then).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\n    } catch {\n      return '';\n    }\n  }, [currentFrame, mrmsBaseUtcMs]);\n\n  const frameRelativeLabel = useMemo(() => {\n    if (!currentFrame) return '';\n    const extra = currentFrame.kind === 'mrms' ? MRMS_LATENCY_MIN : 0;\n    const total = currentFrame.minutesAgo + extra;\n    return total <= 0 ? 'now' : `${total}m ago`;\n  }, [currentFrame]);\n\n\n  async function jumpToAirport() {\n    const map = mapRef.current;\n    if (!mapReady || !map) return;\n    const icao = jumpIcao.trim().toUpperCase();\n    if (!icao) return;\n\n    setNotice(null);\n    try {\n      const res = await fetch(`/api/airports/${encodeURIComponent(icao)}`);\n      if (!res.ok) {\n        setNotice('Airport not found. Try ICAO (KDTW) or IATA (DTW).');\n        return;\n      }\n      const data = await res.json();\n      const lat = Number(data.latitude);\n      const lon = Number(data.longitude);\n      if (!Number.isFinite(lat) || !Number.isFinite(lon)) {\n        setNotice('Airport location missing.');\n        return;\n      }\n\n      map.setView([lat, lon], Math.max(map.getZoom(), 8), { animate: true });\n\n      if (markerRef.current && map.hasLayer(markerRef.current)) {\n        map.removeLayer(markerRef.current);\n        markerRef.current = null;\n      }\n\n      markerRef.current = L.marker([lat, lon]).addTo(map);\n      const label = `${data.name || icao}${data.city ? ` â€¢ ${data.city}` : ''}`;\n      markerRef.current.bindPopup(label).openPopup();\n    } catch (error) {\n      console.error('Airport jump failed', error);\n      setNotice('Failed to jump to airport.');\n    }\n  }\n\n  function jumpToMyLocation() {\n    const map = mapRef.current;\n    if (!mapReady || !map) return;\n    setNotice(null);\n\n    if (!navigator.geolocation) {\n      setNotice('Geolocation not available in this browser.');\n      return;\n    }\n\n    navigator.geolocation.getCurrentPosition(\n      (pos) => {\n        const lat = pos.coords.latitude;\n        const lon = pos.coords.longitude;\n        map.setView([lat, lon], Math.max(map.getZoom(), 8), { animate: true });\n      },\n      () => setNotice('Location permission denied by browser settings.'),\n      { enableHighAccuracy: false, timeout: 6000 }\n    );\n  }\n\n  function zoomIn() {\n    mapRef.current?.zoomIn();\n  }\n\n  function zoomOut() {\n    mapRef.current?.zoomOut();\n  }\n\n  return (\n    <div className=\"relative h-full bg-slate-950\">\n      {/* Map Container */}\n      <div id=\"weather-radar-map\" className=\"h-full w-full\" />\n\n      {/* Top glass bar (Windy-ish) */}\n      <div className=\"absolute top-0 left-0 right-0 z-[1000] px-4 pt-4 pointer-events-none\">\n        <div className=\"mx-auto max-w-6xl\">\n          <div className=\"pointer-events-auto flex items-center gap-3 rounded-2xl border border-slate-200/10 bg-slate-900/60 backdrop-blur-xl shadow-xl px-3 py-3\">\n            <div className=\"flex items-center gap-2\">\n              <div className=\"h-2 w-2 rounded-full bg-emerald-400\" />\n              <div className=\"text-sm font-semibold text-white\">Radar</div>\n              <div className=\"text-xs text-slate-300\">{frameLabel}{frameRelativeLabel ? ` â€¢ ${frameRelativeLabel}` : ''}</div>\n            </div>\n\n            <div className=\"flex-1\" />\n\n            <div className=\"hidden sm:flex items-center gap-2\">\n              <button\n                onClick={() => setRadarMode((m) => (m === 'mrms' ? 'nexrad' : 'mrms'))}\n                className=\"text-xs px-3 py-2 rounded-full bg-slate-800/70 hover:bg-slate-700/70 text-slate-200 border border-slate-700\"\n                title=\"Toggle radar source\"\n              >\n                {radarMode === 'mrms' ? 'Smooth' : 'Standard'}\n              </button>\n              <button\n                onClick={() => setPreloadEnabled((v) => !v)}\n                className=\"text-xs px-3 py-2 rounded-full bg-slate-800/70 hover:bg-slate-700/70 text-slate-200 border border-slate-700\"\n                title=\"Preload tiles before fading\"\n              >\n                Preload: {preloadEnabled ? 'On' : 'Off'}\n              </button>\n              <button\n                onClick={() => setBasemap((b) => (b === 'light' ? 'dark' : 'light'))}\n                className=\"text-xs px-3 py-2 rounded-full bg-slate-800/70 hover:bg-slate-700/70 text-slate-200 border border-slate-700\"\n              >\n                Base: {basemap === 'light' ? 'Light' : 'Dark'}\n              </button>\n              <button\n                onClick={() => setShowLegend((v) => !v)}\n                className=\"text-xs px-3 py-2 rounded-full bg-slate-800/70 hover:bg-slate-700/70 text-slate-200 border border-slate-700\"\n              >\n                Legend\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Left tool rail */}\n      <div className=\"absolute top-24 left-4 z-[1000] pointer-events-auto\">\n        <div className=\"flex flex-col gap-2 rounded-2xl border border-slate-200/10 bg-slate-900/60 backdrop-blur-xl shadow-xl p-2\">\n          <button\n            onClick={jumpToMyLocation}\n            className=\"h-10 w-10 rounded-xl bg-slate-800/70 hover:bg-slate-700/70 border border-slate-700 text-slate-200 text-sm\"\n            title=\"Use my location\"\n          >\n            â¦¿\n          </button>\n          <button\n            onClick={() => setShowLegend((v) => !v)}\n            className=\"h-10 w-10 rounded-xl bg-slate-800/70 hover:bg-slate-700/70 border border-slate-700 text-slate-200 text-sm\"\n            title=\"Legend\"\n          >\n            â‰‹\n          </button>\n        </div>\n      </div>\n\n      {/* Search box */}\n      <div className=\"absolute top-24 left-1/2 -translate-x-1/2 z-[1000] w-[min(520px,calc(100%-2rem))] pointer-events-auto\">\n        <div className=\"rounded-2xl border border-slate-200/10 bg-slate-900/60 backdrop-blur-xl shadow-xl px-3 py-2 flex items-center gap-2\">\n          <div className=\"text-slate-300 text-sm\">Go to</div>\n          <input\n            value={jumpIcao}\n            onChange={(e) => setJumpIcao(e.target.value)}\n            onKeyDown={(e) => {\n              if (e.key === 'Enter') jumpToAirport();\n            }}\n            placeholder=\"Airport code (DTW / KDTW)\"\n            className=\"flex-1 bg-transparent outline-none text-white text-sm placeholder:text-slate-500\"\n          />\n          <button\n            onClick={jumpToAirport}\n            className=\"px-3 py-2 rounded-xl bg-emerald-500/90 hover:bg-emerald-400 text-white text-sm\"\n          >\n            Go\n          </button>\n        </div>\n        {notice && (\n          <div className=\"mt-2 text-xs text-amber-200 bg-amber-500/10 border border-amber-500/30 rounded-xl px-3 py-2\">\n            {notice}\n          </div>\n        )}\n      </div>\n\n      {/* Bottom timeline */}\n      <div className=\"absolute bottom-4 left-4 right-4 z-[1000] pointer-events-none\">\n        <div className=\"mx-auto max-w-6xl pointer-events-auto\">\n          <div className=\"rounded-2xl border border-slate-200/10 bg-slate-900/60 backdrop-blur-xl shadow-xl px-4 py-3\">\n            <div className=\"flex items-center gap-3\">\n              <button\n                onClick={() => setIsPlaying((p) => !p)}\n                disabled={frames.length < 2}\n                className={`px-3 py-2 rounded-xl text-sm font-medium border border-slate-700 disabled:opacity-50 disabled:cursor-not-allowed ${\n                  isPlaying ? 'bg-red-500/80 hover:bg-red-400 text-white' : 'bg-slate-800/70 hover:bg-slate-700/70 text-white'\n                }`}\n              >\n                {isPlaying ? 'Pause' : 'Play'}\n              </button>\n\n              <div className=\"flex-1\">\n                <input\n                  type=\"range\"\n                  min={0}\n                  max={Math.max(0, frames.length - 1)}\n                  value={Math.min(frameIndex, Math.max(0, frames.length - 1))}\n                  onChange={(e) => {\n                    setIsPlaying(false);\n                    setFrameIndex(Number(e.target.value));\n                  }}\n                  disabled={!frames.length}\n                  className=\"w-full\"\n                />\n                <div className=\"mt-1 flex items-center justify-between text-[11px] text-slate-300\">\n                  <span>{loadingFrames ? 'Loading framesâ€¦' : frames.length ? 'Past radar' : 'No data'}</span>\n                  <span>{frameLabel}{frameRelativeLabel ? ` â€¢ ${frameRelativeLabel}` : ''}</span>\n                </div>\n              </div>\n\n              <div className=\"hidden md:flex items-center gap-2\">\n                <div className=\"text-[11px] text-slate-300\">Opacity</div>\n                <input\n                  type=\"range\"\n                  min={0.2}\n                  max={0.95}\n                  step={0.01}\n                  value={radarOpacity}\n                  onChange={(e) => setRadarOpacity(Number(e.target.value))}\n                />\n              </div>\n\n              <div className=\"hidden lg:flex items-center gap-2\">\n                <div className=\"text-[11px] text-slate-300\">Speed</div>\n                <select\n                  value={speedMs}\n                  onChange={(e) => setSpeedMs(Number(e.target.value))}\n                  className=\"bg-slate-800/70 border border-slate-700 rounded-xl px-2 py-2 text-xs text-white\"\n                >\n                  <option value={300}>Fast</option>\n                  <option value={450}>Normal</option>\n                  <option value={700}>Slow</option>\n                </select>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Zoom buttons */}\n      <div className=\"absolute bottom-28 right-4 z-[1000] pointer-events-auto\">\n        <div className=\"flex flex-col gap-2 rounded-2xl border border-slate-200/10 bg-slate-900/60 backdrop-blur-xl shadow-xl p-2\">\n          <button\n            onClick={zoomIn}\n            className=\"h-10 w-10 rounded-xl bg-slate-800/70 hover:bg-slate-700/70 border border-slate-700 text-slate-200 text-lg\"\n            title=\"Zoom in\"\n          >\n            +\n          </button>\n          <button\n            onClick={zoomOut}\n            className=\"h-10 w-10 rounded-xl bg-slate-800/70 hover:bg-slate-700/70 border border-slate-700 text-slate-200 text-lg\"\n            title=\"Zoom out\"\n          >\n            âˆ’\n          </button>\n        </div>\n      </div>\n\n      {/* Legend (toggle) */}\n      {showLegend && (\n        <div className=\"absolute top-24 right-4 z-[1000] pointer-events-auto w-[260px]\">\n          <div className=\"rounded-2xl border border-slate-200/10 bg-slate-900/60 backdrop-blur-xl shadow-xl p-3\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"text-sm font-semibold text-white\">Intensity</div>\n              <button\n                onClick={() => setShowLegend(false)}\n                className=\"text-xs text-slate-300 hover:text-white\"\n              >\n                Close\n              </button>\n            </div>\n            <div className=\"mt-3 space-y-2\">\n              <div className=\"flex items-center gap-2\">\n                <div className=\"h-3 w-3 rounded bg-blue-300\" />\n                <span className=\"text-xs text-slate-200\">Light</span>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <div className=\"h-3 w-3 rounded bg-blue-500\" />\n                <span className=\"text-xs text-slate-200\">Moderate</span>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <div className=\"h-3 w-3 rounded bg-yellow-500\" />\n                <span className=\"text-xs text-slate-200\">Heavy</span>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <div className=\"h-3 w-3 rounded bg-red-500\" />\n                <span className=\"text-xs text-slate-200\">Severe</span>\n              </div>\n            </div>\n            <div className=\"mt-3 text-[11px] text-slate-400\">\n              Radar tiles: RainViewer.\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Empty state overlay */}\n      {!loadingFrames && frames.length === 0 && (\n        <div className=\"absolute inset-0 flex items-center justify-center pointer-events-none\">\n          <div className=\"bg-slate-900/60 border border-slate-700 rounded-xl px-4 py-3 text-sm text-slate-200\">\n            No radar frames available right now.\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\modules\\weather-radar\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useMemo' is defined but never used.","line":3,"column":31,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":38,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"useMemo"},"fix":{"range":[43,52],"text":""},"desc":"Remove unused variable \"useMemo\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'session' is assigned a value but never used.","line":11,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'status' is assigned a value but never used.","line":11,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":32},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\David\\next-dashboard\\app\\modules\\weather-radar\\page.tsx:15:5\n  13 |\n  14 |   useEffect(() => {\n> 15 |     setLoading(false);\n     |     ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  16 |   }, []);\n  17 |\n  18 |   if (loading) {","line":15,"column":5,"nodeType":null,"endLine":15,"endColumn":15}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect, useMemo } from 'react';\nimport { useSession } from 'next-auth/react';\nimport dynamic from 'next/dynamic';\n\n// Dynamic import for Leaflet (no SSR)\nconst WeatherRadarMap = dynamic(() => import('./WeatherRadarMap'), { ssr: false });\n\nexport default function WeatherRadarPage() {\n  const { data: session, status } = useSession();\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    setLoading(false);\n  }, []);\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-slate-900 flex items-center justify-center\">\n        <div className=\"text-slate-400\">Loading Weather Radar...</div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-slate-900\">\n      {/* Header */}\n      <div className=\"bg-slate-800 border-b border-slate-700 p-4\">\n        <div className=\"max-w-7xl mx-auto\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h1 className=\"text-2xl font-bold text-white\">ðŸŒ©ï¸ Weather Radar</h1>\n              <p className=\"text-slate-400 text-sm\">Real-time precipitation and storm tracking</p>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <span className=\"text-xs bg-emerald-500/20 text-emerald-400 px-2 py-1 rounded\">\n                Live Data\n              </span>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Map Container */}\n      <div className=\"h-[calc(100vh-80px)] overflow-hidden\">\n        <WeatherRadarMap />\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\pilots\\[username]\\page.tsx","messages":[],"suppressedMessages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":142,"column":19,"nodeType":"JSXOpeningElement","endLine":146,"endColumn":21,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\pricing\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\privacy\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\profile\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Bell' is defined but never used.","line":19,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":7,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Bell"},"fix":{"range":[620,628],"text":""},"desc":"Remove unused variable \"Bell\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Globe' is defined but never used.","line":21,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":8,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Globe"},"fix":{"range":[638,647],"text":""},"desc":"Remove unused variable \"Globe\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'X' is defined but never used.","line":31,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":31,"endColumn":4,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"X"},"fix":{"range":[733,738],"text":""},"desc":"Remove unused variable \"X\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CheckCircle2' is defined but never used.","line":35,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":35,"endColumn":15,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"CheckCircle2"},"fix":{"range":[788,804],"text":""},"desc":"Remove unused variable \"CheckCircle2\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setIsAdmin' is assigned a value but never used.","line":40,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":40,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'licenseModalOpen' is assigned a value but never used.","line":44,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":44,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'aircraftModalOpen' is assigned a value but never used.","line":45,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":45,"endColumn":27},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":62,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1611,1614],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1611,1614],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":79,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1936,1939],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1936,1939],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":168,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":168,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5099,5102],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5099,5102],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":214,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":214,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6351,6354],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6351,6354],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleSaveLicense' is assigned a value but never used.","line":245,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":245,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleSaveAircraft' is assigned a value but never used.","line":277,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":277,"endColumn":27},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":642,"column":74,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[24110,24267],"text":"\n                        Your medical certificate expires in 297 days. You&apos;ll receive reminders 90, 60, and 30 days before expiration.\n                      "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[24110,24267],"text":"\n                        Your medical certificate expires in 297 days. You&lsquo;ll receive reminders 90, 60, and 30 days before expiration.\n                      "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[24110,24267],"text":"\n                        Your medical certificate expires in 297 days. You&#39;ll receive reminders 90, 60, and 30 days before expiration.\n                      "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[24110,24267],"text":"\n                        Your medical certificate expires in 297 days. You&rsquo;ll receive reminders 90, 60, and 30 days before expiration.\n                      "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useEffect, useState } from \"react\"\nimport { useRouter } from \"next/navigation\"\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\"\nimport { Badge } from \"@/components/ui/badge\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Label } from \"@/components/ui/label\"\nimport { Separator } from \"@/components/ui/separator\"\nimport { Switch } from \"@/components/ui/switch\"\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\"\nimport { \n  User,\n  Award,\n  Heart,\n  MapPin,\n  Plane,\n  Bell,\n  Shield,\n  Globe,\n  Database,\n  Settings,\n  Save,\n  Download,\n  Trash2,\n  Key,\n  Clock,\n  Edit,\n  Plus,\n  X,\n  ChevronRight,\n  LayoutDashboard,\n  AlertCircle,\n  CheckCircle2\n} from \"lucide-react\"\n\nexport default function ProfilePage() {\n  const router = useRouter()\n  const [isAdmin, setIsAdmin] = useState(false)\n  const [unsavedChanges, setUnsavedChanges] = useState(false)\n  \n  // Modal states\n  const [licenseModalOpen, setLicenseModalOpen] = useState(false)\n  const [aircraftModalOpen, setAircraftModalOpen] = useState(false)\n  const [editingLicense, setEditingLicense] = useState<typeof licenses[0] | null>(null)\n  const [editingAircraft, setEditingAircraft] = useState<typeof aircraft[0] | null>(null)\n\n  const [personalInfo, setPersonalInfo] = useState({\n    firstName: \"\",\n    lastName: \"\",\n    email: \"\",\n    phone: \"\",\n    address1: \"\",\n    address2: \"\",\n    city: \"\",\n    state: \"\",\n    postalCode: \"\",\n    country: \"\"\n  })\n\n  const [licenses, setLicenses] = useState<any[]>([])\n\n  const [medical, setMedical] = useState({\n    class: \"\",\n    certificateNumber: \"\",\n    examinerName: \"\",\n    issueDate: \"\",\n    expirationDate: \"\"\n  })\n\n  const [homeAirport, setHomeAirport] = useState({\n    icao: \"\",\n    name: \"\",\n    fbo: \"\",\n    fuelType: \"\"\n  })\n\n  const [aircraft, setAircraft] = useState<any[]>([])\n\n  const [notifications, setNotifications] = useState({\n    maintenanceAlerts: true,\n    currencyReminders: true,\n    weatherAlerts: false,\n    emailNotifications: true,\n    smsNotifications: false,\n    pushNotifications: true\n  })\n\n  const [units, setUnits] = useState({\n    distance: \"nautical\",\n    temperature: \"fahrenheit\",\n    timeFormat: \"24h\",\n    dateFormat: \"MM/DD/YYYY\"\n  })\n\n  const [security, setSecurity] = useState({\n    twoFactorEnabled: false,\n    loginAlerts: true\n  })\n  \n  useEffect(() => {\n    let cancelled = false\n\n    async function loadProfile() {\n      try {\n        const [profileRes, aircraftRes] = await Promise.all([\n          fetch('/api/profile'),\n          fetch('/api/user-aircraft'),\n        ])\n\n        if (profileRes.ok) {\n          const data = await profileRes.json()\n          const user = data.user\n          const contact = data.contact || {}\n          const profile = data.profile || {}\n          const medicalData = data.medical || {}\n          const prefs = data.preferences || {}\n          const notif = data.notifications || {}\n          const lic = Array.isArray(data.licenses) ? data.licenses : []\n\n          const nameParts = (user?.name || '').split(' ')\n          if (!cancelled) {\n            setPersonalInfo({\n              firstName: nameParts[0] || '',\n              lastName: nameParts.slice(1).join(' ') || '',\n              email: user?.email || '',\n              phone: contact?.phone || '',\n              address1: contact?.address1 || '',\n              address2: contact?.address2 || '',\n              city: contact?.city || '',\n              state: contact?.state || '',\n              postalCode: contact?.postalCode || '',\n              country: contact?.country || '',\n            })\n\n            setHomeAirport({\n              icao: profile?.homeAirport || '',\n              name: profile?.homeAirportName || '',\n              fbo: profile?.homeAirportFbo || '',\n              fuelType: profile?.homeAirportFuelType || '',\n            })\n\n            setMedical({\n              class: medicalData?.medicalClass || '',\n              certificateNumber: medicalData?.certificateNumber || '',\n              examinerName: medicalData?.examinerName || '',\n              issueDate: medicalData?.issueDate ? medicalData.issueDate.split('T')[0] : '',\n              expirationDate: medicalData?.expirationDate ? medicalData.expirationDate.split('T')[0] : '',\n            })\n\n            setUnits({\n              distance: prefs?.distanceUnit || 'nautical',\n              temperature: prefs?.temperatureUnit || 'fahrenheit',\n              timeFormat: prefs?.timeFormat || '24h',\n              dateFormat: prefs?.dateFormat || 'MM/DD/YYYY',\n            })\n\n            setNotifications({\n              maintenanceAlerts: !!notif?.maintenanceAlerts,\n              currencyReminders: !!notif?.currencyReminders,\n              weatherAlerts: !!notif?.weatherAlerts,\n              emailNotifications: !!notif?.emailNotifications,\n              smsNotifications: !!notif?.smsNotifications,\n              pushNotifications: !!notif?.pushNotifications,\n            })\n\n            setLicenses(lic.map((l: any, idx: number) => ({\n              id: idx + 1,\n              type: l.type || 'License',\n              number: l.number || '',\n              issueDate: l.issueDate ? l.issueDate.split('T')[0] : '',\n              ratings: l.ratings ? JSON.parse(l.ratings) : [],\n            })))\n          }\n        }\n\n        if (aircraftRes.ok) {\n          const aircraftData = await aircraftRes.json()\n          if (!cancelled) setAircraft(aircraftData.aircraft || [])\n        }\n      } catch (error) {\n        console.error('Failed to load profile', error)\n      }\n    }\n\n    loadProfile()\n    return () => {\n      cancelled = true\n    }\n  }, [])\n\n  // Handler functions\n  const handleSavePersonalInfo = async () => {\n    try {\n      const res = await fetch('/api/profile', {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          personalInfo,\n          homeAirport,\n          medical,\n          licenses,\n          notifications,\n          units,\n        }),\n      })\n      if (!res.ok) {\n        const error = await res.json()\n        throw new Error(error.error || 'Failed to save profile')\n      }\n      setUnsavedChanges(false)\n      alert('Profile saved successfully!')\n    } catch (error: any) {\n      alert(error.message || 'Failed to save profile')\n    }\n  }\n  \n  const handleSaveMedical = async () => {\n    return handleSavePersonalInfo()\n  }\n  \n  const handleSaveAirport = async () => {\n    return handleSavePersonalInfo()\n  }\n  \n  const handleAddLicense = () => {\n    setEditingLicense(null)\n    setLicenseModalOpen(true)\n  }\n  \n  const handleEditLicense = (license: typeof licenses[0]) => {\n    setEditingLicense(license)\n    setLicenseModalOpen(true)\n  }\n  \n  const handleDeleteLicense = async (id: number) => {\n    if (confirm('Are you sure you want to delete this license?')) {\n      // TODO: API call to delete license\n      setLicenses(licenses.filter(l => l.id !== id))\n      alert('License deleted successfully!')\n    }\n  }\n  \n  const handleSaveLicense = (licenseData: typeof licenses[0]) => {\n    if (editingLicense) {\n      // Update existing\n      setLicenses(licenses.map(l => l.id === licenseData.id ? licenseData : l))\n    } else {\n      // Add new\n      const newLicense = { ...licenseData, id: Math.max(...licenses.map(l => l.id)) + 1 }\n      setLicenses([...licenses, newLicense])\n    }\n    setLicenseModalOpen(false)\n    setEditingLicense(null)\n    alert('License saved successfully!')\n  }\n  \n  const handleAddAircraft = () => {\n    setEditingAircraft(null)\n    setAircraftModalOpen(true)\n  }\n  \n  const handleEditAircraft = (ac: typeof aircraft[0]) => {\n    setEditingAircraft(ac)\n    setAircraftModalOpen(true)\n  }\n  \n  const handleDeleteAircraft = async (id: number) => {\n    if (confirm('Are you sure you want to remove this aircraft?')) {\n      // TODO: API call to delete aircraft\n      setAircraft(aircraft.filter(a => a.id !== id))\n      alert('Aircraft removed successfully!')\n    }\n  }\n  \n  const handleSaveAircraft = (aircraftData: typeof aircraft[0]) => {\n    if (editingAircraft) {\n      // Update existing\n      setAircraft(aircraft.map(a => a.id === aircraftData.id ? aircraftData : a))\n    } else {\n      // Add new\n      const newAircraft = { ...aircraftData, id: Math.max(...aircraft.map(a => a.id)) + 1 }\n      setAircraft([...aircraft, newAircraft])\n    }\n    setAircraftModalOpen(false)\n    setEditingAircraft(null)\n    alert('Aircraft saved successfully!')\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background pt-[44px]\">\n      {/* Header */}\n      <header className=\"sticky top-[44px] z-50 border-b border-border bg-card/95 backdrop-blur supports-[backdrop-filter]:bg-card/60\">\n        <div className=\"flex h-16 items-center gap-4 px-6\">\n          <div className=\"flex items-center gap-2\">\n            <div className=\"flex h-8 w-8 items-center justify-center rounded-lg bg-primary\">\n              <User className=\"h-5 w-5 text-primary-foreground\" />\n            </div>\n            <span className=\"text-lg font-semibold\">Profile & Settings</span>\n          </div>\n          \n          <div className=\"ml-auto flex items-center gap-4\">\n            {unsavedChanges && (\n              <Badge variant=\"secondary\" className=\"gap-1\">\n                <AlertCircle className=\"h-3 w-3\" />\n                Unsaved changes\n              </Badge>\n            )}\n            <Button variant=\"ghost\" size=\"sm\" onClick={() => window.history.back()}>\n              Back to Dashboard\n            </Button>\n          </div>\n        </div>\n      </header>\n\n      {/* Main Content */}\n      <main className=\"p-6\">\n        <div className=\"mx-auto max-w-[1200px] space-y-6\">\n          {/* Profile Header */}\n          <div className=\"flex items-start justify-between\">\n            <div className=\"space-y-1\">\n              <h1 className=\"text-3xl font-bold tracking-tight\">Profile & Settings</h1>\n              <p className=\"text-muted-foreground\">\n                Manage your pilot information, preferences, and account settings\n              </p>\n            </div>\n            {isAdmin && (\n              <Button \n                variant=\"outline\" \n                className=\"gap-2\"\n                onClick={() => router.push('/admin')}\n              >\n                <LayoutDashboard className=\"h-4 w-4\" />\n                Admin Dashboard\n              </Button>\n            )}\n          </div>\n\n          {/* Tabs */}\n          <Tabs defaultValue=\"personal\" className=\"w-full\">\n            <TabsList className=\"grid w-full grid-cols-3 lg:grid-cols-7\">\n              <TabsTrigger value=\"personal\" className=\"gap-2\">\n                <User className=\"h-4 w-4\" />\n                <span className=\"hidden md:inline\">Personal</span>\n              </TabsTrigger>\n              <TabsTrigger value=\"licenses\" className=\"gap-2\">\n                <Award className=\"h-4 w-4\" />\n                <span className=\"hidden md:inline\">Licenses</span>\n              </TabsTrigger>\n              <TabsTrigger value=\"medical\" className=\"gap-2\">\n                <Heart className=\"h-4 w-4\" />\n                <span className=\"hidden md:inline\">Medical</span>\n              </TabsTrigger>\n              <TabsTrigger value=\"airport\" className=\"gap-2\">\n                <MapPin className=\"h-4 w-4\" />\n                <span className=\"hidden md:inline\">Airport</span>\n              </TabsTrigger>\n              <TabsTrigger value=\"aircraft\" className=\"gap-2\">\n                <Plane className=\"h-4 w-4\" />\n                <span className=\"hidden md:inline\">Aircraft</span>\n              </TabsTrigger>\n              <TabsTrigger value=\"preferences\" className=\"gap-2\">\n                <Settings className=\"h-4 w-4\" />\n                <span className=\"hidden md:inline\">Settings</span>\n              </TabsTrigger>\n              <TabsTrigger value=\"security\" className=\"gap-2\">\n                <Shield className=\"h-4 w-4\" />\n                <span className=\"hidden md:inline\">Security</span>\n              </TabsTrigger>\n            </TabsList>\n\n            {/* Personal Information */}\n            <TabsContent value=\"personal\" className=\"space-y-4\">\n              <Card>\n                <CardHeader>\n                  <CardTitle>Personal Information</CardTitle>\n                  <CardDescription>Update your personal details and contact information</CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-6\">\n                  <div className=\"grid gap-4 md:grid-cols-2\">\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"firstName\">First Name</Label>\n                      <Input \n                        id=\"firstName\" \n                        value={personalInfo.firstName}\n                        onChange={(e) => {\n                          setPersonalInfo({...personalInfo, firstName: e.target.value})\n                          setUnsavedChanges(true)\n                        }}\n                      />\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"lastName\">Last Name</Label>\n                      <Input \n                        id=\"lastName\" \n                        value={personalInfo.lastName}\n                        onChange={(e) => {\n                          setPersonalInfo({...personalInfo, lastName: e.target.value})\n                          setUnsavedChanges(true)\n                        }}\n                      />\n                    </div>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"email\">Email Address</Label>\n                    <Input \n                      id=\"email\" \n                      type=\"email\" \n                      value={personalInfo.email}\n                      onChange={(e) => {\n                        setPersonalInfo({...personalInfo, email: e.target.value})\n                        setUnsavedChanges(true)\n                      }}\n                    />\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"phone\">Phone Number</Label>\n                    <Input \n                      id=\"phone\" \n                      type=\"tel\" \n                      value={personalInfo.phone}\n                      onChange={(e) => {\n                        setPersonalInfo({...personalInfo, phone: e.target.value})\n                        setUnsavedChanges(true)\n                      }}\n                    />\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"address1\">Address Line 1</Label>\n                    <Input \n                      id=\"address1\" \n                      value={personalInfo.address1}\n                      onChange={(e) => {\n                        setPersonalInfo({...personalInfo, address1: e.target.value})\n                        setUnsavedChanges(true)\n                      }}\n                    />\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"address2\">Address Line 2</Label>\n                    <Input \n                      id=\"address2\" \n                      value={personalInfo.address2}\n                      onChange={(e) => {\n                        setPersonalInfo({...personalInfo, address2: e.target.value})\n                        setUnsavedChanges(true)\n                      }}\n                    />\n                  </div>\n\n                  <div className=\"grid gap-4 md:grid-cols-3\">\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"city\">City</Label>\n                      <Input \n                        id=\"city\" \n                        value={personalInfo.city}\n                        onChange={(e) => {\n                          setPersonalInfo({...personalInfo, city: e.target.value})\n                          setUnsavedChanges(true)\n                        }}\n                      />\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"state\">State</Label>\n                      <Input \n                        id=\"state\" \n                        value={personalInfo.state}\n                        onChange={(e) => {\n                          setPersonalInfo({...personalInfo, state: e.target.value})\n                          setUnsavedChanges(true)\n                        }}\n                      />\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"postalCode\">Postal Code</Label>\n                      <Input \n                        id=\"postalCode\" \n                        value={personalInfo.postalCode}\n                        onChange={(e) => {\n                          setPersonalInfo({...personalInfo, postalCode: e.target.value})\n                          setUnsavedChanges(true)\n                        }}\n                      />\n                    </div>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"country\">Country</Label>\n                    <Input \n                      id=\"country\" \n                      value={personalInfo.country}\n                      onChange={(e) => {\n                        setPersonalInfo({...personalInfo, country: e.target.value})\n                        setUnsavedChanges(true)\n                      }}\n                    />\n                  </div>\n\n                  <div className=\"flex justify-end gap-2\">\n                    <Button variant=\"outline\" onClick={() => window.location.reload()}>Cancel</Button>\n                      <Button className=\"gap-2\" onClick={handleSavePersonalInfo}>\n                        <Save className=\"h-4 w-4\" />\n                        Save Changes\n                      </Button>\n                  </div>\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            {/* Licenses & Certificates */}\n            <TabsContent value=\"licenses\" className=\"space-y-4\">\n              <Card>\n                <CardHeader>\n                  <div className=\"flex items-start justify-between\">\n                    <div>\n                      <CardTitle>Licenses & Certificates</CardTitle>\n                      <CardDescription>Manage your pilot certificates, ratings, and endorsements</CardDescription>\n                    </div>\n                    <Button size=\"sm\" className=\"gap-2\" onClick={handleAddLicense}>\n                      <Plus className=\"h-4 w-4\" />\n                      Add License\n                    </Button>\n                  </div>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  {licenses.map((license) => (\n                    <div key={license.id} className=\"rounded-lg border border-border p-4 space-y-3\">\n                      <div className=\"flex items-start justify-between\">\n                        <div className=\"space-y-1\">\n                          <div className=\"flex items-center gap-2\">\n                            <h3 className=\"font-semibold\">{license.type}</h3>\n                            <Badge variant=\"secondary\">{license.number}</Badge>\n                          </div>\n                          <p className=\"text-sm text-muted-foreground\">Issued: {license.issueDate}</p>\n                        </div>\n                        <div className=\"flex gap-2\">\n                          <Button size=\"sm\" variant=\"ghost\" onClick={() => handleEditLicense(license)}>\n                            <Edit className=\"h-4 w-4\" />\n                          </Button>\n                          <Button size=\"sm\" variant=\"ghost\" onClick={() => handleDeleteLicense(license.id)}>\n                            <Trash2 className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      </div>\n                      <Separator />\n                      <div>\n                        <p className=\"text-sm font-medium mb-2\">Ratings & Endorsements:</p>\n                        <div className=\"flex flex-wrap gap-2\">\n                          {license.ratings.map((rating: string, idx: number) => (\n                            <Badge key={idx} variant=\"outline\">{rating}</Badge>\n                          ))}\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            {/* Medical Certificate */}\n            <TabsContent value=\"medical\" className=\"space-y-4\">\n              <Card>\n                <CardHeader>\n                  <CardTitle>Medical Certificate</CardTitle>\n                  <CardDescription>Keep your medical certificate information up to date</CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-6\">\n                  <div className=\"grid gap-4 md:grid-cols-2\">\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"medicalClass\">Medical Class</Label>\n                      <Input \n                        id=\"medicalClass\" \n                        value={medical.class}\n                        onChange={(e) => {\n                          setMedical({...medical, class: e.target.value})\n                          setUnsavedChanges(true)\n                        }}\n                      />\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"medicalNumber\">Certificate Number</Label>\n                      <Input \n                        id=\"medicalNumber\" \n                        value={medical.certificateNumber}\n                        onChange={(e) => {\n                          setMedical({...medical, certificateNumber: e.target.value})\n                          setUnsavedChanges(true)\n                        }}\n                      />\n                    </div>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"examiner\">Aviation Medical Examiner</Label>\n                    <Input \n                      id=\"examiner\" \n                      value={medical.examinerName}\n                      onChange={(e) => {\n                        setMedical({...medical, examinerName: e.target.value})\n                        setUnsavedChanges(true)\n                      }}\n                    />\n                  </div>\n\n                  <div className=\"grid gap-4 md:grid-cols-2\">\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"issueDate\">Issue Date</Label>\n                      <Input \n                        id=\"issueDate\" \n                        type=\"date\" \n                        value={medical.issueDate}\n                        onChange={(e) => {\n                          setMedical({...medical, issueDate: e.target.value})\n                          setUnsavedChanges(true)\n                        }}\n                      />\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"expirationDate\">Expiration Date</Label>\n                      <Input \n                        id=\"expirationDate\" \n                        type=\"date\" \n                        value={medical.expirationDate}\n                        onChange={(e) => {\n                          setMedical({...medical, expirationDate: e.target.value})\n                          setUnsavedChanges(true)\n                        }}\n                      />\n                    </div>\n                  </div>\n\n                  <div className=\"rounded-lg bg-muted/50 p-4 flex items-start gap-3\">\n                    <AlertCircle className=\"h-5 w-5 text-chart-3 mt-0.5\" />\n                    <div className=\"space-y-1\">\n                      <p className=\"text-sm font-medium\">Expiration Reminder</p>\n                      <p className=\"text-xs text-muted-foreground\">\n                        Your medical certificate expires in 297 days. You'll receive reminders 90, 60, and 30 days before expiration.\n                      </p>\n                    </div>\n                  </div>\n\n                  <div className=\"flex justify-end gap-2\">\n                    <Button variant=\"outline\" onClick={() => window.location.reload()}>Cancel</Button>\n                    <Button className=\"gap-2\" onClick={handleSaveMedical}>\n                      <Save className=\"h-4 w-4\" />\n                      Save Changes\n                    </Button>\n                  </div>\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            {/* Home Airport & Preferences */}\n            <TabsContent value=\"airport\" className=\"space-y-4\">\n              <Card>\n                <CardHeader>\n                  <CardTitle>Home Airport & Preferences</CardTitle>\n                  <CardDescription>Set your default airport and aviation preferences</CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-6\">\n                  <div className=\"grid gap-4 md:grid-cols-2\">\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"icao\">ICAO Code</Label>\n                      <Input \n                        id=\"icao\" \n                        placeholder=\"KBOS\"\n                        value={homeAirport.icao}\n                        onChange={(e) => {\n                          setHomeAirport({...homeAirport, icao: e.target.value})\n                          setUnsavedChanges(true)\n                        }}\n                      />\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"airportName\">Airport Name</Label>\n                      <Input \n                        id=\"airportName\" \n                        value={homeAirport.name}\n                        onChange={(e) => {\n                          setHomeAirport({...homeAirport, name: e.target.value})\n                          setUnsavedChanges(true)\n                        }}\n                      />\n                    </div>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"fbo\">Preferred FBO</Label>\n                    <Input \n                      id=\"fbo\" \n                      value={homeAirport.fbo}\n                      onChange={(e) => {\n                        setHomeAirport({...homeAirport, fbo: e.target.value})\n                        setUnsavedChanges(true)\n                      }}\n                    />\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"fuelType\">Preferred Fuel Type</Label>\n                    <Input \n                      id=\"fuelType\" \n                      value={homeAirport.fuelType}\n                      onChange={(e) => {\n                        setHomeAirport({...homeAirport, fuelType: e.target.value})\n                        setUnsavedChanges(true)\n                      }}\n                    />\n                  </div>\n\n                  <div className=\"flex justify-end gap-2\">\n                    <Button variant=\"outline\" onClick={() => window.location.reload()}>Cancel</Button>\n                    <Button className=\"gap-2\" onClick={handleSaveAirport}>\n                      <Save className=\"h-4 w-4\" />\n                      Save Changes\n                    </Button>\n                  </div>\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            {/* Aircraft */}\n            <TabsContent value=\"aircraft\" className=\"space-y-4\">\n              <Card>\n                <CardHeader>\n                  <div className=\"flex items-start justify-between\">\n                    <div>\n                      <CardTitle>Aircraft Assignments</CardTitle>\n                      <CardDescription>Manage aircraft you fly regularly</CardDescription>\n                    </div>\n                    <Button size=\"sm\" className=\"gap-2\" onClick={handleAddAircraft}>\n                      <Plus className=\"h-4 w-4\" />\n                      Add Aircraft\n                    </Button>\n                  </div>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  {aircraft.map((ac) => (\n                    <div key={ac.id} className=\"rounded-lg border border-border p-4 space-y-3\">\n                      <div className=\"flex items-start justify-between\">\n                        <div className=\"space-y-1\">\n                          <div className=\"flex items-center gap-2\">\n                            <h3 className=\"font-semibold\">{ac.registration}</h3>\n                            <Badge variant=\"secondary\">{ac.ownership}</Badge>\n                          </div>\n                          <p className=\"text-sm text-muted-foreground\">{ac.type}</p>\n                        </div>\n                        <div className=\"flex gap-2\">\n                          <Button size=\"sm\" variant=\"ghost\" onClick={() => handleEditAircraft(ac)}>\n                            <Edit className=\"h-4 w-4\" />\n                          </Button>\n                          <Button size=\"sm\" variant=\"ghost\" onClick={() => handleDeleteAircraft(ac.id)}>\n                            <Trash2 className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      </div>\n                      {ac.notes && (\n                        <>\n                          <Separator />\n                          <p className=\"text-sm text-muted-foreground\">{ac.notes}</p>\n                        </>\n                      )}\n                    </div>\n                  ))}\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            {/* Preferences & Settings */}\n            <TabsContent value=\"preferences\" className=\"space-y-4\">\n              <Card>\n                <CardHeader>\n                  <CardTitle>Notification Preferences</CardTitle>\n                  <CardDescription>Control when and how you receive alerts</CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"space-y-0.5\">\n                      <Label htmlFor=\"maintenance\">Maintenance Alerts</Label>\n                      <p className=\"text-xs text-muted-foreground\">Get notified about upcoming maintenance items</p>\n                    </div>\n                      <Switch \n                       id=\"maintenance\"\n                       checked={notifications.maintenanceAlerts}\n                       onCheckedChange={(checked) => {\n                        setNotifications({...notifications, maintenanceAlerts: checked})\n                        setUnsavedChanges(true)\n                       }}\n                     />\n                  </div>\n                  <Separator />\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"space-y-0.5\">\n                      <Label htmlFor=\"currency\">Currency Reminders</Label>\n                      <p className=\"text-xs text-muted-foreground\">Reminders for expiring licenses and currency</p>\n                    </div>\n                      <Switch \n                       id=\"currency\"\n                       checked={notifications.currencyReminders}\n                       onCheckedChange={(checked) => {\n                        setNotifications({...notifications, currencyReminders: checked})\n                        setUnsavedChanges(true)\n                       }}\n                     />\n                  </div>\n                  <Separator />\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"space-y-0.5\">\n                      <Label htmlFor=\"weather\">Weather Alerts</Label>\n                      <p className=\"text-xs text-muted-foreground\">Get notified about weather changes at your home airport</p>\n                    </div>\n                      <Switch \n                       id=\"weather\"\n                       checked={notifications.weatherAlerts}\n                       onCheckedChange={(checked) => {\n                        setNotifications({...notifications, weatherAlerts: checked})\n                        setUnsavedChanges(true)\n                       }}\n                     />\n                  </div>\n                  <Separator />\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"space-y-0.5\">\n                      <Label htmlFor=\"email\">Email Notifications</Label>\n                      <p className=\"text-xs text-muted-foreground\">Receive notifications via email</p>\n                    </div>\n                      <Switch \n                       id=\"email\"\n                       checked={notifications.emailNotifications}\n                       onCheckedChange={(checked) => {\n                        setNotifications({...notifications, emailNotifications: checked})\n                        setUnsavedChanges(true)\n                       }}\n                     />\n                  </div>\n                  <Separator />\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"space-y-0.5\">\n                      <Label htmlFor=\"sms\">SMS Notifications</Label>\n                      <p className=\"text-xs text-muted-foreground\">Receive notifications via text message</p>\n                    </div>\n                      <Switch \n                       id=\"sms\"\n                       checked={notifications.smsNotifications}\n                       onCheckedChange={(checked) => {\n                        setNotifications({...notifications, smsNotifications: checked})\n                        setUnsavedChanges(true)\n                       }}\n                     />\n                  </div>\n                  <Separator />\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"space-y-0.5\">\n                      <Label htmlFor=\"push\">Push Notifications</Label>\n                      <p className=\"text-xs text-muted-foreground\">Receive browser push notifications</p>\n                    </div>\n                      <Switch \n                       id=\"push\"\n                       checked={notifications.pushNotifications}\n                       onCheckedChange={(checked) => {\n                        setNotifications({...notifications, pushNotifications: checked})\n                        setUnsavedChanges(true)\n                       }}\n                     />\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader>\n                  <CardTitle>Units & Display</CardTitle>\n                  <CardDescription>Customize measurement units and display formats</CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-6\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"distance\">Distance Units</Label>\n                    <select \n                      id=\"distance\"\n                      className=\"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\"\n                      value={units.distance}\n                      onChange={(e) => {\n                        setUnits({...units, distance: e.target.value})\n                        setUnsavedChanges(true)\n                      }}\n                    >\n                      <option value=\"nautical\">Nautical Miles</option>\n                      <option value=\"statute\">Statute Miles</option>\n                      <option value=\"kilometers\">Kilometers</option>\n                    </select>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"temperature\">Temperature Units</Label>\n                    <select \n                      id=\"temperature\"\n                      className=\"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\"\n                      value={units.temperature}\n                      onChange={(e) => {\n                        setUnits({...units, temperature: e.target.value})\n                        setUnsavedChanges(true)\n                      }}\n                    >\n                      <option value=\"fahrenheit\">Fahrenheit (Â°F)</option>\n                      <option value=\"celsius\">Celsius (Â°C)</option>\n                    </select>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"timeFormat\">Time Format</Label>\n                    <select \n                      id=\"timeFormat\"\n                      className=\"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\"\n                      value={units.timeFormat}\n                      onChange={(e) => {\n                        setUnits({...units, timeFormat: e.target.value})\n                        setUnsavedChanges(true)\n                      }}\n                    >\n                      <option value=\"12h\">12-hour (3:45 PM)</option>\n                      <option value=\"24h\">24-hour (15:45)</option>\n                    </select>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"dateFormat\">Date Format</Label>\n                    <select \n                      id=\"dateFormat\"\n                      className=\"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\"\n                      value={units.dateFormat}\n                      onChange={(e) => {\n                        setUnits({...units, dateFormat: e.target.value})\n                        setUnsavedChanges(true)\n                      }}\n                    >\n                      <option value=\"MM/DD/YYYY\">MM/DD/YYYY</option>\n                      <option value=\"DD/MM/YYYY\">DD/MM/YYYY</option>\n                      <option value=\"YYYY-MM-DD\">YYYY-MM-DD</option>\n                    </select>\n                  </div>\n\n                  <div className=\"flex justify-end gap-2\">\n                    <Button variant=\"outline\" onClick={() => window.location.reload()}>Cancel</Button>\n                    <Button className=\"gap-2\" onClick={handleSavePersonalInfo}>\n                      <Save className=\"h-4 w-4\" />\n                      Save Changes\n                    </Button>\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader>\n                  <CardTitle>Dashboard Customization</CardTitle>\n                  <CardDescription>Manage your dashboard widgets and layout</CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <Button variant=\"outline\" className=\"w-full justify-between\">\n                    <span>Customize Dashboard Widgets</span>\n                    <ChevronRight className=\"h-4 w-4\" />\n                  </Button>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Your current widget preferences are saved automatically when you customize your dashboard\n                  </p>\n                </CardContent>\n              </Card>\n\n              <div className=\"flex justify-end gap-2\">\n                <Button variant=\"outline\" onClick={() => window.location.reload()}>Cancel</Button>\n                <Button className=\"gap-2\" onClick={handleSavePersonalInfo}>\n                  <Save className=\"h-4 w-4\" />\n                  Save Changes\n                </Button>\n              </div>\n            </TabsContent>\n\n            {/* Security & Privacy */}\n            <TabsContent value=\"security\" className=\"space-y-4\">\n              <Card>\n                <CardHeader>\n                  <CardTitle>Account Security</CardTitle>\n                  <CardDescription>Manage your password and security settings</CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-6\">\n                  <div className=\"space-y-4\">\n                    <Button variant=\"outline\" className=\"w-full justify-between\">\n                      <div className=\"flex items-center gap-2\">\n                        <Key className=\"h-4 w-4\" />\n                        <span>Change Password</span>\n                      </div>\n                      <ChevronRight className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n\n                  <Separator />\n\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"space-y-0.5\">\n                      <Label htmlFor=\"2fa\">Two-Factor Authentication</Label>\n                      <p className=\"text-xs text-muted-foreground\">Add an extra layer of security to your account</p>\n                    </div>\n                    <Switch \n                      id=\"2fa\"\n                      checked={security.twoFactorEnabled}\n                      onCheckedChange={(checked) => \n                        setSecurity({...security, twoFactorEnabled: checked})\n                      }\n                    />\n                  </div>\n\n                  <Separator />\n\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"space-y-0.5\">\n                      <Label htmlFor=\"loginAlerts\">Login Alerts</Label>\n                      <p className=\"text-xs text-muted-foreground\">Get notified of new logins to your account</p>\n                    </div>\n                    <Switch \n                      id=\"loginAlerts\"\n                      checked={security.loginAlerts}\n                      onCheckedChange={(checked) => \n                        setSecurity({...security, loginAlerts: checked})\n                      }\n                    />\n                  </div>\n\n                  <Separator />\n\n                  <div>\n                    <Button variant=\"outline\" className=\"w-full justify-between\">\n                      <div className=\"flex items-center gap-2\">\n                        <Clock className=\"h-4 w-4\" />\n                        <span>View Login History</span>\n                      </div>\n                      <ChevronRight className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader>\n                  <CardTitle>Data & Privacy</CardTitle>\n                  <CardDescription>Manage your data and privacy settings</CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <Button variant=\"outline\" className=\"w-full justify-between\">\n                    <div className=\"flex items-center gap-2\">\n                      <Download className=\"h-4 w-4\" />\n                      <span>Export Your Data</span>\n                    </div>\n                    <ChevronRight className=\"h-4 w-4\" />\n                  </Button>\n\n                  <Button variant=\"outline\" className=\"w-full justify-between\">\n                    <div className=\"flex items-center gap-2\">\n                      <Database className=\"h-4 w-4\" />\n                      <span>Privacy Settings</span>\n                    </div>\n                    <ChevronRight className=\"h-4 w-4\" />\n                  </Button>\n\n                  <Separator />\n\n                  <div className=\"rounded-lg bg-destructive/10 border border-destructive/50 p-4 space-y-3\">\n                    <div className=\"flex items-start gap-2\">\n                      <AlertCircle className=\"h-5 w-5 text-destructive mt-0.5\" />\n                      <div className=\"space-y-1\">\n                        <p className=\"text-sm font-medium text-destructive\">Danger Zone</p>\n                        <p className=\"text-xs text-muted-foreground\">\n                          Once you delete your account, there is no going back. Please be certain.\n                        </p>\n                      </div>\n                    </div>\n                    <Button variant=\"destructive\" size=\"sm\" className=\"gap-2\">\n                      <Trash2 className=\"h-4 w-4\" />\n                      Delete Account\n                    </Button>\n                  </div>\n                </CardContent>\n              </Card>\n            </TabsContent>\n          </Tabs>\n        </div>\n      </main>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\reset-password\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\reset-password\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":58,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":58,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect, Suspense } from 'react';\nimport Link from 'next/link';\nimport { useRouter, useSearchParams } from 'next/navigation';\n\nfunction ResetPasswordForm() {\n  const searchParams = useSearchParams();\n  const router = useRouter();\n  \n  const token = searchParams.get('token');\n  const email = searchParams.get('email');\n  \n  const [newPassword, setNewPassword] = useState('');\n  const [confirmPassword, setConfirmPassword] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const [message, setMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);\n\n  useEffect(() => {\n    if (!token || !email) {\n      setMessage({ type: 'error', text: 'Invalid reset link. Please request a new password reset.' });\n    }\n  }, [token, email]);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (newPassword !== confirmPassword) {\n      setMessage({ type: 'error', text: 'Passwords do not match' });\n      return;\n    }\n\n    if (newPassword.length < 6) {\n      setMessage({ type: 'error', text: 'Password must be at least 6 characters' });\n      return;\n    }\n\n    setIsLoading(true);\n    setMessage(null);\n\n    try {\n      const res = await fetch('/api/auth/reset-password', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ email, token, newPassword })\n      });\n\n      const data = await res.json();\n\n      if (res.ok) {\n        setMessage({ type: 'success', text: 'Password reset successful! Redirecting to login...' });\n        setTimeout(() => {\n          router.push('/login?reset=1');\n        }, 2000);\n      } else {\n        setMessage({ type: 'error', text: data.error || 'Failed to reset password' });\n      }\n    } catch (error) {\n      setMessage({ type: 'error', text: 'An error occurred. Please try again.' });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"rounded-2xl border border-slate-800 bg-slate-900/70 p-8\">\n      <h1 className=\"text-2xl font-bold text-white mb-2\">Reset Password</h1>\n      <p className=\"text-slate-400 mb-6\">\n        Enter your new password below.\n      </p>\n\n      {email && (\n        <div className=\"mb-5 rounded-xl border border-slate-800 bg-slate-950/40 px-4 py-3\">\n          <div className=\"text-xs text-slate-500\">Resetting password for</div>\n          <div className=\"text-sm text-slate-200 break-all\">{email}</div>\n        </div>\n      )}\n\n      <form \n        onSubmit={handleSubmit} \n        className=\"space-y-4\"\n        autoComplete=\"on\"\n      >\n        <div>\n          <label \n            htmlFor=\"newPassword\" \n            className=\"block text-sm font-medium text-slate-300 mb-1\"\n          >\n            New Password\n          </label>\n          <input\n            id=\"newPassword\"\n            name=\"new-password\"\n            type=\"password\"\n            value={newPassword}\n            onChange={(e) => setNewPassword(e.target.value)}\n            required\n            minLength={6}\n            autoComplete=\"new-password\"\n            autoFocus\n            aria-required=\"true\"\n            aria-label=\"New password - minimum 6 characters\"\n            aria-describedby=\"new-password-help\"\n            className=\"w-full rounded-xl border border-slate-700 bg-slate-800 px-4 py-3 text-slate-100 placeholder-slate-500 focus:border-emerald-500 focus:outline-none\"\n            placeholder=\"Enter new password\"\n          />\n          <p id=\"new-password-help\" className=\"mt-1 text-xs text-slate-500\">\n            Minimum 6 characters\n          </p>\n        </div>\n\n        <div>\n          <label \n            htmlFor=\"confirmPassword\" \n            className=\"block text-sm font-medium text-slate-300 mb-1\"\n          >\n            Confirm New Password\n          </label>\n          <input\n            id=\"confirmPassword\"\n            name=\"confirm-password\"\n            type=\"password\"\n            value={confirmPassword}\n            onChange={(e) => setConfirmPassword(e.target.value)}\n            required\n            minLength={6}\n            autoComplete=\"new-password\"\n            aria-required=\"true\"\n            aria-label=\"Confirm new password\"\n            className=\"w-full rounded-xl border border-slate-700 bg-slate-800 px-4 py-3 text-slate-100 placeholder-slate-500 focus:border-emerald-500 focus:outline-none\"\n            placeholder=\"Confirm new password\"\n          />\n        </div>\n\n        {message && (\n          <div \n            className={`p-3 rounded-lg text-sm ${\n              message.type === 'success' \n                ? 'bg-emerald-500/20 text-emerald-400 border border-emerald-500/30' \n                : 'bg-red-500/20 text-red-400 border border-red-500/30'\n            }`}\n            role=\"alert\"\n            aria-live=\"polite\"\n          >\n            {message.text}\n          </div>\n        )}\n\n        <button\n          type=\"submit\"\n          disabled={isLoading || !token || !email}\n          className=\"w-full rounded-xl bg-emerald-500 py-3 font-semibold text-emerald-950 hover:bg-emerald-400 disabled:opacity-50 transition-colors\"\n          aria-label={isLoading ? \"Resetting password\" : \"Reset password\"}\n          aria-busy={isLoading}\n          aria-disabled={!token || !email}\n        >\n          {isLoading ? 'Resetting...' : 'Reset Password'}\n        </button>\n      </form>\n\n      <div className=\"mt-6 text-center\">\n        <div className=\"flex items-center justify-center gap-4 text-sm\">\n          <Link href=\"/forgot-password\" className=\"text-slate-400 hover:text-slate-300\">\n            Request a new reset link\n          </Link>\n          <span className=\"text-slate-700\">â€¢</span>\n          <Link href=\"/login\" className=\"text-slate-400 hover:text-slate-300\">\n            Back to Login\n          </Link>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction LoadingState() {\n  return (\n    <div className=\"rounded-2xl border border-slate-800 bg-slate-900/70 p-8 text-center\">\n      <p className=\"text-slate-400\">Loading...</p>\n    </div>\n  );\n}\n\nexport default function ResetPasswordPage() {\n  return (\n    <div className=\"min-h-screen bg-gradient-to-b from-slate-950 via-slate-900 to-slate-800 flex items-center justify-center px-4\">\n      <div className=\"w-full max-w-md\">\n        <div className=\"text-center mb-8\">\n          <Link href=\"/\" className=\"inline-flex items-center gap-2 text-2xl font-bold text-white\">\n            <span>âœˆï¸</span>\n            <span>AviationHub</span>\n          </Link>\n        </div>\n\n        <Suspense fallback={<LoadingState />}>\n          <ResetPasswordForm />\n        </Suspense>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\scheduler\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\search\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":7,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[141,144],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[141,144],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":8,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[158,161],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[158,161],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[180,183],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[180,183],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[200,203],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[200,203],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useEffect, useMemo, useState } from 'react';\nimport Link from 'next/link';\n\ninterface SearchResults {\n  marketplace: any[];\n  pilots: any[];\n  flightPlans: any[];\n  documents: any[];\n}\n\nconst emptyResults: SearchResults = {\n  marketplace: [],\n  pilots: [],\n  flightPlans: [],\n  documents: [],\n};\n\nexport default function SearchPage() {\n  const [query, setQuery] = useState('');\n  const [results, setResults] = useState<SearchResults>(emptyResults);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (query.trim().length < 2) {\n      setResults(emptyResults);\n      setError(null);\n      return;\n    }\n\n    const controller = new AbortController();\n    const timeout = setTimeout(async () => {\n      setLoading(true);\n      setError(null);\n      try {\n        const res = await fetch(`/api/search?q=${encodeURIComponent(query)}`, {\n          signal: controller.signal,\n        });\n        if (!res.ok) {\n          const data = await res.json();\n          throw new Error(data.error || 'Search failed');\n        }\n        const data = await res.json();\n        setResults({\n          marketplace: data.marketplace || [],\n          pilots: data.pilots || [],\n          flightPlans: data.flightPlans || [],\n          documents: data.documents || [],\n        });\n      } catch (err) {\n        if (controller.signal.aborted) return;\n        console.error(err);\n        setError(err instanceof Error ? err.message : 'Search failed');\n      } finally {\n        setLoading(false);\n      }\n    }, 250);\n\n    return () => {\n      controller.abort();\n      clearTimeout(timeout);\n    };\n  }, [query]);\n\n  const resultCount = useMemo(() => {\n    return (\n      results.marketplace.length +\n      results.pilots.length +\n      results.flightPlans.length +\n      results.documents.length\n    );\n  }, [results]);\n\n  return (\n    <div className=\"min-h-screen bg-slate-900 pt-24 pb-16\">\n      <div className=\"max-w-5xl mx-auto px-4\">\n        <div className=\"text-center mb-8\">\n          <h1 className=\"text-3xl font-bold text-white\">Global Search</h1>\n          <p className=\"text-slate-400\">Search across marketplace listings, pilots, your flight plans, and documents.</p>\n          <div className=\"mt-4\">\n            <input\n              type=\"text\"\n              value={query}\n              onChange={(e) => setQuery(e.target.value)}\n              placeholder=\"Search pilots, aircraft, airports, documents, flight plansâ€¦\"\n              className=\"w-full max-w-3xl bg-slate-800 border border-slate-700 rounded-2xl px-5 py-4 text-white text-lg\"\n              autoFocus\n            />\n          </div>\n          <div className=\"text-xs text-slate-500 mt-2\">Tip: Press Ctrl + K (Cmd + K) to jump here quickly.</div>\n        </div>\n\n        {query.trim().length < 2 ? (\n          <div className=\"text-center text-slate-500\">Start typing at least two characters to search.</div>\n        ) : loading ? (\n          <div className=\"text-center text-slate-400\">Searchingâ€¦</div>\n        ) : error ? (\n          <div className=\"text-center text-rose-300\">{error}</div>\n        ) : resultCount === 0 ? (\n          <div className=\"text-center text-slate-400\">No results yet. Try another search term.</div>\n        ) : (\n          <div className=\"space-y-10\">\n            <SearchSection\n              title=\"Marketplace\"\n              items={results.marketplace}\n              renderItem={(item) => (\n                <Link href={`/modules/marketplace#${item.id}`} className=\"block\">\n                  <div className=\"text-white font-semibold\">{item.title}</div>\n                  <div className=\"text-xs text-slate-400\">{item.aircraftType} â€¢ {item.airportIcao}</div>\n                  <p className=\"text-sm text-slate-400 mt-1 line-clamp-2\">{item.description}</p>\n                </Link>\n              )}\n            />\n\n            <SearchSection\n              title=\"Pilots\"\n              items={results.pilots}\n              renderItem={(item) => (\n                <Link href={`/modules/pilot-directory`} className=\"block\">\n                  <div className=\"text-white font-semibold\">{item.user?.name || item.user?.username || 'Pilot'}</div>\n                  <div className=\"text-xs text-slate-400\">{item.homeAirport || 'Unknown airport'}</div>\n                  <div className=\"text-xs text-emerald-300 mt-1\">\n                    {item.ratings?.join(', ') || 'No ratings listed'}\n                  </div>\n                  <p className=\"text-sm text-slate-400 mt-1 line-clamp-2\">{item.bio || 'No bio provided.'}</p>\n                </Link>\n              )}\n            />\n\n            <SearchSection\n              title=\"Your Flight Plans\"\n              items={results.flightPlans}\n              renderItem={(item) => (\n                <Link href={`/modules/fuel-saver?plan=${item.id}`} className=\"block\">\n                  <div className=\"text-white font-semibold\">{item.name || `${item.departureIcao || '???'} â†’ ${item.arrivalIcao || '???'}`}</div>\n                  <div className=\"text-xs text-slate-400\">{item.route?.slice(0, 80) || 'No route saved'}</div>\n                  <div className=\"text-xs text-slate-500 mt-1\">Updated {new Date(item.updatedAt).toLocaleDateString()}</div>\n                </Link>\n              )}\n            />\n\n            <SearchSection\n              title=\"Your Documents\"\n              items={results.documents}\n              renderItem={(item) => (\n                <a href={item.fileUrl} className=\"block\" target=\"_blank\" rel=\"noopener noreferrer\">\n                  <div className=\"text-white font-semibold\">{item.name}</div>\n                  <div className=\"text-xs text-slate-400\">{item.type}</div>\n                  <p className=\"text-sm text-slate-400 mt-1 line-clamp-2\">{item.description || 'No description'}</p>\n                </a>\n              )}\n            />\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\ninterface SearchSectionProps<T> {\n  title: string;\n  items: T[];\n  renderItem: (item: T) => React.ReactNode;\n}\n\nfunction SearchSection<T>({ title, items, renderItem }: SearchSectionProps<T>) {\n  if (!items || items.length === 0) return null;\n  return (\n    <div>\n      <div className=\"text-xs uppercase tracking-wider text-slate-500 mb-2\">{title}</div>\n      <div className=\"grid gap-3\">\n        {items.map((item, index) => (\n          <div key={index} className=\"bg-slate-800 border border-slate-700 rounded-2xl p-4 hover:border-emerald-400 transition-colors\">\n            {renderItem(item)}\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\settings\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\settings\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'router' is assigned a value but never used.","line":12,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":35,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":35,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useSession, signOut } from 'next-auth/react';\nimport Link from 'next/link';\nimport { useState } from 'react';\nimport { useTheme } from 'next-themes';\nimport { useRouter } from 'next/navigation';\nimport { useAuthModal } from '../components/AuthModalContext';\n\nexport default function SettingsPage() {\n  const { data: session, status } = useSession();\n  const router = useRouter();\n  const [deleting, setDeleting] = useState(false);\n  const { openLoginModal } = useAuthModal();\n  const { theme, setTheme } = useTheme();\n\n  const handleDeleteAccount = async () => {\n    if (!confirm('Are you sure you want to delete your account? This will permanently delete all your data including flight plans, aircraft, and group memberships. This action cannot be undone.')) {\n      return;\n    }\n    if (!confirm('This is your final warning. All your data will be permanently deleted. Continue?')) {\n      return;\n    }\n    \n    setDeleting(true);\n    try {\n      const res = await fetch('/api/auth/delete-account', { method: 'DELETE' });\n      if (res.ok) {\n        alert('Your account has been deleted.');\n        signOut({ callbackUrl: '/' });\n      } else {\n        const data = await res.json();\n        alert('Failed to delete account: ' + (data.error || 'Unknown error'));\n      }\n    } catch (err) {\n      alert('Error deleting account');\n    }\n    setDeleting(false);\n  };\n\n  if (status === 'loading') {\n    return (\n      <div className=\"min-h-screen bg-slate-900 text-white p-8\">\n        <div className=\"max-w-2xl mx-auto\">\n          <h1 className=\"text-2xl font-bold mb-6\">Settings</h1>\n          <div className=\"text-slate-400\">Loading...</div>\n        </div>\n      </div>\n    );\n  }\n\n  if (!session) {\n    return (\n      <div className=\"min-h-screen bg-slate-900 text-white p-8\">\n        <div className=\"max-w-2xl mx-auto text-center py-16\">\n          <h1 className=\"text-2xl font-bold mb-4\">Settings</h1>\n          <p className=\"text-slate-400 mb-6\">Sign in to access settings</p>\n          <button onClick={() => openLoginModal()} className=\"inline-block bg-emerald-500 hover:bg-emerald-600 px-6 py-3 rounded-lg font-medium\">\n            Sign In\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-slate-900 text-white p-4 md:p-8\">\n      <div className=\"max-w-2xl mx-auto\">\n        <h1 className=\"text-2xl font-bold mb-6\">Settings</h1>\n\n        <div className=\"space-y-6\">\n          {/* Account Section */}\n          <div className=\"bg-slate-800 rounded-lg p-6\">\n            <h2 className=\"text-lg font-semibold mb-4\">Account</h2>\n            <div className=\"space-y-3\">\n              <div className=\"flex justify-between py-2 border-b border-slate-700\">\n                <span className=\"text-slate-400\">Email</span>\n                <span>{session.user?.email}</span>\n              </div>\n              <div className=\"flex justify-between py-2 border-b border-slate-700\">\n                <span className=\"text-slate-400\">Name</span>\n                <span>{session.user?.name || 'Not set'}</span>\n              </div>\n            </div>\n          </div>\n\n          {/* Preferences Section */}\n          <div className=\"bg-slate-800 rounded-lg p-6\">\n            <h2 className=\"text-lg font-semibold mb-4\">Preferences</h2>\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <div className=\"font-medium\">Email Notifications</div>\n                  <div className=\"text-sm text-slate-400\">Receive updates about your trips</div>\n                </div>\n                <button className=\"bg-emerald-500 w-12 h-6 rounded-full relative transition-colors\">\n                  <span className=\"absolute right-1 top-1 bg-white w-4 h-4 rounded-full transition-transform\"></span>\n                </button>\n              </div>\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <div className=\"font-medium\">Dark Mode</div>\n                  <div className=\"text-sm text-slate-400\">Use dark theme</div>\n                </div>\n                <button\n                  onClick={() => setTheme(theme === 'dark' ? 'light' : 'dark')}\n                  className=\"bg-emerald-500 w-12 h-6 rounded-full relative transition-colors\"\n                >\n                  <span className=\"absolute right-1 top-1 bg-white w-4 h-4 rounded-full transition-transform\"></span>\n                </button>\n              </div>\n            </div>\n          </div>\n\n          {/* Data Cache Section */}\n          <div className=\"bg-slate-800 rounded-lg p-6\">\n            <h2 className=\"text-lg font-semibold mb-4\">Data Cache</h2>\n            <div className=\"space-y-3\">\n              <Link \n                href=\"/data-status\"\n                className=\"block w-full bg-slate-700 hover:bg-slate-600 text-center text-white py-2 rounded-lg transition-colors\"\n              >\n                View Data Cache Status\n              </Link>\n              <p className=\"text-xs text-slate-500\">\n                See what airport data is cached and how old it is. Fuel prices are automatically updated every 72 hours.\n              </p>\n            </div>\n          </div>\n\n          {/* Danger Zone */}\n          <div className=\"bg-slate-800 rounded-lg p-6 border border-red-500/30\">\n            <h2 className=\"text-lg font-semibold mb-4 text-red-400\">Danger Zone</h2>\n            <div className=\"space-y-3\">\n              <button \n                onClick={handleDeleteAccount}\n                disabled={deleting}\n                className=\"w-full bg-red-500/20 hover:bg-red-500/30 text-red-400 py-2 rounded-lg transition-colors disabled:opacity-50\"\n              >\n                {deleting ? 'Deleting...' : 'Delete Account'}\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\signup\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\support\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\support\\page.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":27,"column":50,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[1099,1141],"text":"We&apos;ll get back to you as soon as possible."},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[1099,1141],"text":"We&lsquo;ll get back to you as soon as possible."},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[1099,1141],"text":"We&#39;ll get back to you as soon as possible."},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[1099,1141],"text":"We&rsquo;ll get back to you as soon as possible."},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState } from 'react';\n\nexport default function SupportPage() {\n  const [submitted, setSubmitted] = useState(false);\n  const [form, setForm] = useState({ name: '', email: '', subject: '', message: '' });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    // In production, this would send to an API\n    console.log('Support request:', form);\n    setSubmitted(true);\n  };\n\n  return (\n    <div className=\"min-h-screen bg-slate-900 text-white p-4 md:p-8\">\n      <div className=\"max-w-2xl mx-auto\">\n        <h1 className=\"text-2xl font-bold mb-6\">Support</h1>\n\n        {submitted ? (\n          <div className=\"bg-emerald-500/20 border border-emerald-500 rounded-lg p-6 text-center\">\n            <svg className=\"w-12 h-12 mx-auto text-emerald-400 mb-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\n            </svg>\n            <h2 className=\"text-xl font-semibold mb-2\">Message Sent!</h2>\n            <p className=\"text-slate-400 mb-4\">We'll get back to you as soon as possible.</p>\n            <button onClick={() => setSubmitted(false)} className=\"text-sky-400 hover:text-sky-300\">\n              Send another message\n            </button>\n          </div>\n        ) : (\n          <form onSubmit={handleSubmit} className=\"bg-slate-800 rounded-lg p-6 space-y-4\">\n            <div>\n              <label className=\"block text-sm text-slate-400 mb-1\">Name</label>\n              <input\n                type=\"text\"\n                required\n                value={form.name}\n                onChange={(e) => setForm({ ...form, name: e.target.value })}\n                className=\"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-sm text-slate-400 mb-1\">Email</label>\n              <input\n                type=\"email\"\n                required\n                value={form.email}\n                onChange={(e) => setForm({ ...form, email: e.target.value })}\n                className=\"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-sm text-slate-400 mb-1\">Subject</label>\n              <select\n                required\n                value={form.subject}\n                onChange={(e) => setForm({ ...form, subject: e.target.value })}\n                className=\"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white\"\n              >\n                <option value=\"\">Select a topic...</option>\n                <option value=\"general\">General Question</option>\n                <option value=\"bug\">Bug Report</option>\n                <option value=\"feature\">Feature Request</option>\n                <option value=\"account\">Account Issue</option>\n                <option value=\"other\">Other</option>\n              </select>\n            </div>\n            <div>\n              <label className=\"block text-sm text-slate-400 mb-1\">Message</label>\n              <textarea\n                required\n                rows={5}\n                value={form.message}\n                onChange={(e) => setForm({ ...form, message: e.target.value })}\n                className=\"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white resize-none\"\n              />\n            </div>\n            <button type=\"submit\" className=\"w-full bg-emerald-500 hover:bg-emerald-600 py-3 rounded-lg font-medium transition-colors\">\n              Send Message\n            </button>\n          </form>\n        )}\n\n        <div className=\"mt-8 text-center text-slate-500 text-sm\">\n          <p>You can also email us at support@aviationdash.com</p>\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\terms\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\training\\endorsements\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\trips\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\trips\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":15,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[380,383],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[380,383],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'router' is assigned a value but never used.","line":22,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":22,"endColumn":15},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\David\\next-dashboard\\app\\trips\\page.tsx:38:7\n  36 |         .catch(() => setLoading(false));\n  37 |     } else if (status === 'unauthenticated') {\n> 38 |       setLoading(false);\n     |       ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  39 |     }\n  40 |   }, [status]);\n  41 |","line":38,"column":7,"nodeType":null,"endLine":38,"endColumn":17}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect } from 'react';\nimport { useSession } from 'next-auth/react';\nimport Link from 'next/link';\nimport { useRouter } from 'next/navigation';\nimport { useAuthModal } from '../components/AuthModalContext';\n\ninterface Trip {\n  id: string;\n  name: string;\n  departureIcao?: string;\n  arrivalIcao?: string;\n  cruisingAlt?: number;\n  waypoints?: any[];\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport default function TripsPage() {\n  const { data: session, status } = useSession();\n  const router = useRouter();\n  const { openLoginModal } = useAuthModal();\n  const [trips, setTrips] = useState<Trip[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [deletingId, setDeletingId] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (status === 'authenticated') {\n      fetch('/api/flight-plans')\n        .then(res => res.json())\n        .then(data => {\n          setTrips(data.flightPlans || []);\n          setLoading(false);\n        })\n        .catch(() => setLoading(false));\n    } else if (status === 'unauthenticated') {\n      setLoading(false);\n    }\n  }, [status]);\n\n  const handleDelete = async (id: string, e: React.MouseEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    \n    if (!confirm('Are you sure you want to delete this trip?')) return;\n    \n    setDeletingId(id);\n    try {\n      const res = await fetch(`/api/flight-plans?id=${id}`, { method: 'DELETE' });\n      if (res.ok) {\n        setTrips(prev => prev.filter(t => t.id !== id));\n      } else {\n        alert('Failed to delete trip');\n      }\n    } catch (err) {\n      console.error('Error deleting:', err);\n      alert('Error deleting trip');\n    }\n    setDeletingId(null);\n  };\n\n  if (status === 'loading' || loading) {\n    return (\n      <div className=\"min-h-screen bg-slate-900 text-white p-8\">\n        <div className=\"max-w-6xl mx-auto\">\n          <h1 className=\"text-2xl font-bold mb-6\">My Trips</h1>\n          <div className=\"text-slate-400\">Loading...</div>\n        </div>\n      </div>\n    );\n  }\n\n  if (!session) {\n    return (\n      <div className=\"min-h-screen bg-slate-900 text-white p-8\">\n        <div className=\"max-w-6xl mx-auto text-center py-16\">\n          <h1 className=\"text-2xl font-bold mb-4\">My Trips</h1>\n          <p className=\"text-slate-400 mb-6\">Sign in to view and manage your saved trips</p>\n          <button onClick={() => openLoginModal()} className=\"inline-block bg-emerald-500 hover:bg-emerald-600 px-6 py-3 rounded-lg font-medium\">\n            Sign In\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-slate-900 text-white p-4 md:p-8\">\n      <div className=\"max-w-6xl mx-auto\">\n        <div className=\"flex items-center justify-between mb-8\">\n          <h1 className=\"text-2xl font-bold\">My Trips</h1>\n          <Link href=\"/modules/fuel-saver\" className=\"bg-emerald-500 hover:bg-emerald-600 px-4 py-2 rounded-lg text-sm font-medium\">\n            + New Trip\n          </Link>\n        </div>\n\n        {trips.length === 0 ? (\n          <div className=\"text-center py-16 bg-slate-800 rounded-lg\">\n            <svg className=\"w-16 h-16 mx-auto text-slate-600 mb-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1.5} d=\"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7\" />\n            </svg>\n            <h2 className=\"text-xl font-semibold mb-2\">No trips yet</h2>\n            <p className=\"text-slate-400 mb-6\">Create your first trip using the Flight Planner</p>\n            <Link href=\"/modules/fuel-saver\" className=\"inline-block bg-emerald-500 hover:bg-emerald-600 px-6 py-3 rounded-lg font-medium\">\n              Plan a Trip\n            </Link>\n          </div>\n        ) : (\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n            {trips.map((trip) => (\n              <div key={trip.id} className=\"bg-slate-800 rounded-lg p-4 hover:bg-slate-750 transition-colors\">\n                <div className=\"flex items-start justify-between\">\n                  <Link \n                    href={`/modules/fuel-saver/view/${trip.id}`}\n                    className=\"flex-1 block\"\n                  >\n                    <h3 className=\"font-semibold text-lg\">{trip.name || 'Untitled Trip'}</h3>\n                    <div className=\"flex items-center gap-2 mt-1 text-slate-400 text-sm\">\n                      {trip.departureIcao && trip.arrivalIcao ? (\n                        <>\n                          <span className=\"text-sky-400\">{trip.departureIcao}</span>\n                          <span>â†’</span>\n                          <span className=\"text-amber-400\">{trip.arrivalIcao}</span>\n                        </>\n                      ) : (\n                        <span>Route not specified</span>\n                      )}\n                    </div>\n                    {trip.waypoints && trip.waypoints.length > 0 && (\n                      <div className=\"text-xs text-slate-500 mt-1\">\n                        {trip.waypoints.length} waypoints\n                      </div>\n                    )}\n                    {trip.createdAt && (\n                      <div className=\"text-xs text-slate-500 mt-2\">\n                        Created {new Date(trip.createdAt).toLocaleDateString()}\n                      </div>\n                    )}\n                  </Link>\n                  <button \n                    onClick={(e) => handleDelete(trip.id, e)}\n                    disabled={deletingId === trip.id}\n                    className=\"text-slate-500 hover:text-red-400 p-1 transition-colors\"\n                  >\n                    {deletingId === trip.id ? (\n                      <svg className=\"w-4 h-4 animate-spin\" fill=\"none\" viewBox=\"0 0 24 24\">\n                        <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\n                        <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\n                      </svg>\n                    ) : (\n                      <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n                      </svg>\n                    )}\n                  </button>\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n\n        {trips.length > 0 && (\n          <div className=\"mt-8 text-center text-slate-500 text-sm\">\n            {trips.length} trip{trips.length !== 1 ? 's' : ''} saved\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\verify-email\\page.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\David\\next-dashboard\\app\\verify-email\\page.tsx:21:7\n  19 |   useEffect(() => {\n  20 |     if (emailParam) {\n> 21 |       setEmail(emailParam);\n     |       ^^^^^^^^ Avoid calling setState() directly within an effect\n  22 |     }\n  23 |\n  24 |     if (success === 'verified') {","line":21,"column":7,"nodeType":null,"endLine":21,"endColumn":15}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { Suspense } from 'react';\nimport { useEffect, useState } from 'react';\nimport { useSearchParams } from 'next/navigation';\nimport Link from 'next/link';\nimport { signIn } from 'next-auth/react';\n\nfunction VerifyEmailContent() {\n  const searchParams = useSearchParams();\n  const [status, setStatus] = useState<'loading' | 'success' | 'error'>('loading');\n  const [message, setMessage] = useState('');\n  const [email, setEmail] = useState('');\n\n  const success = searchParams.get('success');\n  const error = searchParams.get('error');\n  const emailParam = searchParams.get('email');\n\n  useEffect(() => {\n    if (emailParam) {\n      setEmail(emailParam);\n    }\n\n    if (success === 'verified') {\n      setStatus('success');\n      setMessage('Your email has been verified! You can now sign in and start planning flights.');\n    } else if (success === 'already-verified') {\n      setStatus('success');\n      setMessage('Your email is already verified. You can sign in anytime.');\n    } else if (error === 'missing-params') {\n      setStatus('error');\n      setMessage('Invalid verification link. Please check your email for the correct link.');\n    } else if (error === 'user-not-found') {\n      setStatus('error');\n      setMessage('Account not found. Please sign up first.');\n    } else if (error === 'invalid-token') {\n      setStatus('error');\n      setMessage('Invalid verification link. Please request a new one.');\n    } else if (error === 'token-expired') {\n      setStatus('error');\n      setMessage('Verification link expired. Please request a new one.');\n    } else if (error === 'server-error') {\n      setStatus('error');\n      setMessage('Something went wrong. Please try again later.');\n    } else {\n      // No params - this is the initial page load\n      setStatus('loading');\n    }\n  }, [success, error, emailParam]);\n\n  const handleResend = async () => {\n    if (!email) {\n      const emailInput = prompt('Enter your email address:');\n      if (emailInput) {\n        setEmail(emailInput);\n        await resendEmail(emailInput);\n      }\n    } else {\n      await resendEmail(email);\n    }\n  };\n\n  const resendEmail = async (emailAddress: string) => {\n    try {\n      const res = await fetch('/api/auth/resend-verification', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ email: emailAddress }),\n      });\n\n      if (res.ok) {\n        alert('Verification email sent! Check your inbox.');\n      } else {\n        alert('Failed to send email. Please try again.');\n      }\n    } catch (err) {\n      console.error(err);\n      alert('Something went wrong. Please try again.');\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-b from-slate-950 via-slate-900 to-slate-950 flex items-center justify-center p-4\">\n      <div className=\"max-w-md w-full\">\n        {/* Card */}\n        <div className=\"bg-slate-800/50 border border-slate-700 rounded-2xl p-8 text-center\">\n          {/* Icon */}\n          <div className=\"text-6xl mb-6\">\n            {status === 'loading' && 'ðŸ“§'}\n            {status === 'success' && 'âœ…'}\n            {status === 'error' && 'âŒ'}\n          </div>\n\n          {/* Title */}\n          <h1 className=\"text-2xl font-bold text-white mb-4\">\n            {status === 'loading' && 'Check Your Email'}\n            {status === 'success' && 'Email Verified!'}\n            {status === 'error' && 'Verification Failed'}\n          </h1>\n\n          {/* Message */}\n          <p className=\"text-slate-400 mb-6\">\n            {message || 'We sent you a verification link. Click the link in your email to verify your account.'}\n          </p>\n\n          {/* Actions */}\n          <div className=\"space-y-3\">\n            {status === 'success' && (\n              <button\n                onClick={() => signIn()}\n                className=\"w-full bg-emerald-500 hover:bg-emerald-400 text-white font-semibold py-3 px-4 rounded-lg transition\"\n              >\n                Sign In\n              </button>\n            )}\n\n            {status === 'error' && (\n              <button\n                onClick={handleResend}\n                className=\"w-full bg-slate-700 hover:bg-slate-600 text-white font-semibold py-3 px-4 rounded-lg transition\"\n              >\n                Resend Verification Email\n              </button>\n            )}\n\n            <Link\n              href=\"/\"\n              className=\"block w-full text-center text-slate-400 hover:text-white py-2 transition\"\n            >\n              Back to Home\n            </Link>\n          </div>\n        </div>\n\n        {/* Help text */}\n        <p className=\"text-center text-sm text-slate-500 mt-6\">\n          Didn&apos;t receive an email? Check your spam folder or{' '}\n          <button onClick={handleResend} className=\"text-emerald-400 hover:underline\">\n            request a new one\n          </button>\n        </p>\n      </div>\n    </div>\n  );\n}\n\nexport default function VerifyEmailPage() {\n  return (\n    <Suspense fallback={\n      <div className=\"min-h-screen bg-gradient-to-b from-slate-950 via-slate-900 to-slate-950 flex items-center justify-center p-4\">\n        <div className=\"max-w-md w-full\">\n          <div className=\"bg-slate-800/50 border border-slate-700 rounded-2xl p-8 text-center\">\n            <div className=\"text-6xl mb-6\">ðŸ“§</div>\n            <h1 className=\"text-2xl font-bold text-white mb-4\">Loading...</h1>\n            <p className=\"text-slate-400\">Please wait...</p>\n          </div>\n        </div>\n      </div>\n    }>\n      <VerifyEmailContent />\n    </Suspense>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\app\\welcome\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'email' is assigned a value but never used.","line":20,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":20,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setEmail' is assigned a value but never used.","line":20,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":20,"endColumn":25},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\David\\next-dashboard\\app\\welcome\\page.tsx:27:7\n  25 |   useEffect(() => {\n  26 |     if (success === 'verified') {\n> 27 |       setStatus('verified');\n     |       ^^^^^^^^^ Avoid calling setState() directly within an effect\n  28 |       setMessage('Your email has been verified! Welcome to AviationHub.');\n  29 |     } else if (success === 'already-verified') {\n  30 |       setStatus('already-verified');","line":27,"column":7,"nodeType":null,"endLine":27,"endColumn":16}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { Suspense } from 'react';\nimport { useEffect, useState } from 'react';\nimport { useSearchParams } from 'next/navigation';\nimport Link from 'next/link';\nimport { signIn } from 'next-auth/react';\n\nconst features = [\n  { icon: 'â›½', title: 'Fuel Saver', desc: 'Find cheapest 100LL along your route', color: 'emerald' },\n  { icon: 'âœˆï¸', title: 'Flying Club', desc: 'Manage aircraft, bookings & members', color: 'sky' },\n  { icon: 'ðŸ§®', title: 'E6B Computer', desc: 'Wind, fuel, speed calculations', color: 'amber' },\n  { icon: 'ðŸŽ“', title: 'Training Tracker', desc: 'Track your PPL progress', color: 'purple' },\n];\n\nfunction WelcomeContent() {\n  const searchParams = useSearchParams();\n  const [status, setStatus] = useState<'loading' | 'verified' | 'already-verified' | 'error'>('loading');\n  const [message, setMessage] = useState('');\n  const [email, setEmail] = useState('');\n\n  const success = searchParams.get('success');\n  const error = searchParams.get('error');\n\n  useEffect(() => {\n    if (success === 'verified') {\n      setStatus('verified');\n      setMessage('Your email has been verified! Welcome to AviationHub.');\n    } else if (success === 'already-verified') {\n      setStatus('already-verified');\n      setMessage('Your email is already verified. Welcome back!');\n    } else if (error) {\n      setStatus('error');\n      setMessage('There was an issue with your verification link.');\n    }\n  }, [success, error]);\n\n  if (status === 'error') {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-b from-slate-950 via-slate-900 to-slate-950 flex items-center justify-center p-4\">\n        <div className=\"max-w-md w-full\">\n          <div className=\"bg-slate-800/50 border border-red-500/30 rounded-2xl p-8 text-center\">\n            <div className=\"text-6xl mb-4\">âŒ</div>\n            <h1 className=\"text-2xl font-bold text-white mb-2\">Verification Failed</h1>\n            <p className=\"text-slate-400 mb-6\">{message}</p>\n            <Link href=\"/\" className=\"text-emerald-400 hover:underline\">\n              Go to Home\n            </Link>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-b from-slate-950 via-slate-900 to-slate-950\">\n      {/* Hero Section */}\n      <div className=\"relative overflow-hidden\">\n        <div className=\"absolute inset-0 bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-emerald-900/20 via-transparent to-transparent\" />\n        \n        <div className=\"relative mx-auto max-w-4xl px-6 py-16 text-center\">\n          {/* Success Animation */}\n          <div className=\"mb-6\">\n            <div className=\"inline-flex items-center justify-center w-24 h-24 rounded-full bg-emerald-500/20 border-2 border-emerald-500 animate-pulse\">\n              <span className=\"text-5xl\">âœ…</span>\n            </div>\n          </div>\n\n          <h1 className=\"text-4xl md:text-5xl font-bold text-white mb-4\">\n            Welcome to AviationHub!\n          </h1>\n          \n          <p className=\"text-xl text-slate-400 max-w-2xl mx-auto mb-8\">\n            {status === 'verified' \n              ? \"Your email is verified and you're all set. Here's what you can do:\"\n              : \"You're already verified! Here's a quick overview of what AviationHub offers:\"}\n          </p>\n\n          {/* CTA Buttons */}\n          <div className=\"flex flex-wrap justify-center gap-4 mb-12\">\n            <Link\n              href=\"/dashboard\"\n              className=\"rounded-xl bg-emerald-500 hover:bg-emerald-400 px-8 py-3 font-semibold text-white transition shadow-lg shadow-emerald-500/25\"\n            >\n              Go to Dashboard â†’\n            </Link>\n            <button\n              onClick={() => signIn()}\n              className=\"rounded-xl border border-slate-600 hover:bg-slate-800 px-8 py-3 font-semibold text-white transition\"\n            >\n              Sign In\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {/* Features Grid */}\n      <div className=\"mx-auto max-w-5xl px-6 pb-16\">\n        <h2 className=\"text-2xl font-bold text-white text-center mb-8\">\n          Your Flight Planning Toolkit\n        </h2>\n\n        <div className=\"grid md:grid-cols-2 gap-6\">\n          {features.map((feature, i) => (\n            <Link\n              key={i}\n              href={`/modules/${feature.title.toLowerCase().replace(' ', '-')}`}\n              className={`group rounded-2xl border border-slate-700 bg-slate-800/50 p-6 hover:border-${feature.color}-500/50 hover:bg-slate-800 transition`}\n            >\n              <div className=\"flex items-start gap-4\">\n                <span className=\"text-4xl\">{feature.icon}</span>\n                <div>\n                  <h3 className={`text-xl font-bold text-white group-hover:text-${feature.color}-400 transition`}>\n                    {feature.title}\n                  </h3>\n                  <p className=\"text-slate-400 mt-1\">{feature.desc}</p>\n                </div>\n              </div>\n            </Link>\n          ))}\n        </div>\n      </div>\n\n      {/* What You Get Section */}\n      <div className=\"mx-auto max-w-4xl px-6 pb-16\">\n        <div className=\"rounded-2xl border border-slate-700 bg-slate-800/30 p-8\">\n          <h2 className=\"text-2xl font-bold text-white mb-6 text-center\">\n            What You Get With Your Free Account\n          </h2>\n          \n          <div className=\"grid md:grid-cols-2 gap-6\">\n            <ul className=\"space-y-3\">\n              {[\n                'Save up to 5 flight plans',\n                '6 waypoints per flight',\n                'Compare fuel prices',\n                'E6B flight computer',\n              ].map((item, i) => (\n                <li key={i} className=\"flex items-center gap-3 text-slate-300\">\n                  <span className=\"text-emerald-400\">âœ“</span>\n                  {item}\n                </li>\n              ))}\n            </ul>\n            <ul className=\"space-y-3\">\n              {[\n                'Track PPL training progress',\n                'Weight & balance calculations',\n                'Export to GPX/PDF',\n                'Flying Club access',\n              ].map((item, i) => (\n                <li key={i} className=\"flex items-center gap-3 text-slate-300\">\n                  <span className=\"text-emerald-400\">âœ“</span>\n                  {item}\n                </li>\n              ))}\n            </ul>\n          </div>\n\n          <div className=\"mt-8 text-center\">\n            <p className=\"text-slate-400 mb-4\">\n              Want unlimited plans and advanced features?\n            </p>\n            <Link\n              href=\"/pricing\"\n              className=\"inline-block rounded-xl bg-amber-500 hover:bg-amber-400 px-6 py-2 font-semibold text-white transition\"\n            >\n              View Pro Plans\n            </Link>\n          </div>\n        </div>\n      </div>\n\n      {/* Footer */}\n      <footer className=\"border-t border-slate-800 py-8 text-center\">\n        <p className=\"text-slate-400\">\n          Ready to start planning?{' '}\n          <Link href=\"/modules/fuel-saver\" className=\"text-emerald-400 hover:underline\">\n            Try Fuel Saver now â†’\n          </Link>\n        </p>\n      </footer>\n    </div>\n  );\n}\n\nexport default function WelcomePage() {\n  return (\n    <Suspense fallback={\n      <div className=\"min-h-screen bg-gradient-to-b from-slate-950 via-slate-900 to-slate-950 flex items-center justify-center p-4\">\n        <div className=\"max-w-md w-full\">\n          <div className=\"bg-slate-800/50 border border-slate-700 rounded-2xl p-8 text-center\">\n            <div className=\"text-6xl mb-6\">âœˆï¸</div>\n            <h1 className=\"text-2xl font-bold text-white mb-4\">Loading...</h1>\n            <p className=\"text-slate-400\">Please wait...</p>\n          </div>\n        </div>\n      </div>\n    }>\n      <WelcomeContent />\n    </Suspense>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\aircraft\\contact-section.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\aircraft\\description-section.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\aircraft\\equipment-section.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\aircraft\\image-gallery.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\aircraft\\listing-header.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\aircraft\\location-card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\aircraft\\navbar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\aircraft\\quick-stats.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'aircraftType' is defined but never used.","line":16,"column":106,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":118},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'year' is defined but never used.","line":16,"column":120,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":124},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'make' is defined but never used.","line":16,"column":126,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":130}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Clock, Gauge, Settings, Fuel, Shield, FileCheck } from \"lucide-react\"\n\ninterface QuickStatsProps {\n  totalTime?: number | null;\n  engineTime?: number | null;\n  propTime?: number | null;\n  registrationType?: string | null;\n  airworthiness?: string | null;\n  fuelType?: string | null;\n  aircraftType?: string | null;\n  year?: number | null;\n  make?: string | null;\n  model?: string | null;\n}\n\nexport function QuickStats({ totalTime, engineTime, propTime, registrationType, airworthiness, fuelType, aircraftType, year, make }: QuickStatsProps) {\n  const stats = [\n    { label: \"Total Time\", value: totalTime ? `${totalTime.toLocaleString()} hrs` : \"N/A\", sublabel: \"TTSN\", icon: Clock },\n    { label: \"Engine Time\", value: engineTime ? `${engineTime.toLocaleString()} hrs` : \"N/A\", sublabel: \"SMOH\", icon: Gauge },\n    { label: \"Prop Time\", value: propTime ? `${propTime.toLocaleString()} hrs` : \"N/A\", sublabel: \"SPOH\", icon: Settings },\n    { label: \"Registration\", value: registrationType || \"Standard\", sublabel: \"Category\", icon: FileCheck },\n    { label: \"Airworthiness\", value: airworthiness || \"Current\", sublabel: \"Status\", icon: Shield },\n    { label: \"Fuel Type\", value: fuelType || \"100LL\", sublabel: \"AVGAS\", icon: Fuel },\n  ]\n\n  return (\n    <div className=\"grid grid-cols-2 gap-3 sm:grid-cols-3 lg:grid-cols-6\">\n      {stats.map((stat) => (\n        <div\n          key={stat.label}\n          className=\"group relative overflow-hidden rounded-xl border border-border bg-card p-4 transition-colors hover:border-primary/40\"\n        >\n          <div className=\"absolute -right-2 -top-2 text-primary/[0.06] transition-colors group-hover:text-primary/10\">\n            <stat.icon className=\"h-16 w-16\" strokeWidth={1} />\n          </div>\n          <p className=\"text-xs text-muted-foreground\">{stat.label}</p>\n          <p className=\"mt-1 font-mono text-lg font-semibold text-foreground\">{stat.value}</p>\n          <p className=\"mt-0.5 text-[11px] uppercase tracking-wider text-muted-foreground/70\">{stat.sublabel}</p>\n        </div>\n      ))}\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\club\\AddOnsSection.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":72,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2562,2565],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2562,2565],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadQuickBooksStatus'. Either include it or remove the dependency array.","line":77,"column":6,"nodeType":"ArrayExpression","endLine":77,"endColumn":15,"suggestions":[{"desc":"Update the dependencies array to be: [groupId, loadQuickBooksStatus]","fix":{"range":[2663,2672],"text":"[groupId, loadQuickBooksStatus]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport Link from 'next/link'\nimport { useParams } from 'next/navigation'\n\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Badge } from '@/components/ui/badge'\nimport { Separator } from '@/components/ui/separator'\nimport { CalendarCheck, Landmark, ShieldCheck, Zap, Loader2 } from 'lucide-react'\n\ntype IntegrationStatus = 'connected' | 'disconnected' | 'coming-soon'\n\ninterface Integration {\n  id: string\n  name: string\n  description: string\n  status: IntegrationStatus\n  icon: React.ReactNode\n  features: string[]\n  helpUrl?: string\n}\n\nconst INITIAL_INTEGRATIONS: Integration[] = [\n  {\n    id: 'google-calendar',\n    name: 'Google Calendar',\n    description: 'Sync club bookings to shared Google Calendars so members always have the latest schedule.',\n    status: 'disconnected',\n    icon: <CalendarCheck className=\"h-5 w-5 text-primary\" />, \n    features: [\n      'Push new and updated reservations automatically',\n      'Create per-aircraft calendars to avoid conflicts',\n      'Respect booking window and block-out rules',\n    ],\n    helpUrl: 'https://support.google.com/calendar/answer/2465776?hl=en',\n  },\n  {\n    id: 'quickbooks',\n    name: 'Intuit QuickBooks',\n    description: 'Keep your ledger in sync by exporting charges and payments directly into QuickBooks Online.',\n    status: 'disconnected',\n    icon: <Landmark className=\"h-5 w-5 text-primary\" />, \n    features: [\n      'Create invoices and journal entries automatically',\n      'Map aircraft rates to QuickBooks products',\n      'Reconcile Stripe payments with member balances',\n    ],\n    helpUrl: 'https://quickbooks.intuit.com/learn-support/en-us',\n  },\n  {\n    id: 'zapier',\n    name: 'Zapier (Beta)',\n    description: 'Trigger automations in your favorite tools when bookings or maintenance events change.',\n    status: 'coming-soon',\n    icon: <Zap className=\"h-5 w-5 text-primary\" />, \n    features: [\n      'Send maintenance squawks to Slack or Teams',\n      'Create custom SMS alerts for dispatch events',\n      'Update CRM or club portals with flight activity',\n    ],\n  },\n]\n\nexport default function AddOnsSection() {\n  const params = useParams()\n  const groupId = params?.groupId as string || 'demo-group-id' // Get from URL or context\n  \n  const [integrations, setIntegrations] = useState(INITIAL_INTEGRATIONS)\n  const [loading, setLoading] = useState<string | null>(null)\n  const [qbStatus, setQbStatus] = useState<any>(null)\n\n  // Load QuickBooks status on mount\n  useEffect(() => {\n    loadQuickBooksStatus()\n  }, [groupId])\n\n  const loadQuickBooksStatus = async () => {\n    try {\n      const response = await fetch(`/api/integrations/quickbooks/status?groupId=${groupId}`)\n      if (response.ok) {\n        const data = await response.json()\n        setQbStatus(data)\n        \n        // Update QuickBooks integration status in UI\n        setIntegrations((current) =>\n          current.map((integration) => {\n            if (integration.id === 'quickbooks') {\n              return {\n                ...integration,\n                status: data.connected ? 'connected' : 'disconnected',\n              }\n            }\n            return integration\n          }),\n        )\n      }\n    } catch (error) {\n      console.error('Failed to load QuickBooks status:', error)\n    }\n  }\n\n  const handleQuickBooksConnect = async () => {\n    setLoading('quickbooks')\n    try {\n      // Get OAuth URL from API\n      const response = await fetch(`/api/integrations/quickbooks/connect?groupId=${groupId}`)\n      const data = await response.json()\n      \n      if (data.success && data.authUrl) {\n        // Redirect to QuickBooks OAuth page\n        window.location.href = data.authUrl\n      } else {\n        alert('Failed to connect to QuickBooks. Please try again.')\n        setLoading(null)\n      }\n    } catch (error) {\n      console.error('QuickBooks connect error:', error)\n      alert('Failed to connect to QuickBooks. Please try again.')\n      setLoading(null)\n    }\n  }\n\n  const handleQuickBooksDisconnect = async () => {\n    if (!confirm('Are you sure you want to disconnect QuickBooks? This will stop all syncing.')) {\n      return\n    }\n\n    setLoading('quickbooks')\n    try {\n      const response = await fetch('/api/integrations/quickbooks/disconnect', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ groupId }),\n      })\n\n      const data = await response.json()\n      \n      if (data.success) {\n        // Update UI\n        setIntegrations((current) =>\n          current.map((integration) => {\n            if (integration.id === 'quickbooks') {\n              return { ...integration, status: 'disconnected' }\n            }\n            return integration\n          }),\n        )\n        setQbStatus(null)\n        alert('QuickBooks disconnected successfully')\n      } else {\n        alert('Failed to disconnect QuickBooks. Please try again.')\n      }\n    } catch (error) {\n      console.error('QuickBooks disconnect error:', error)\n      alert('Failed to disconnect QuickBooks. Please try again.')\n    } finally {\n      setLoading(null)\n    }\n  }\n\n  const handleQuickBooksSync = async () => {\n    setLoading('quickbooks-sync')\n    try {\n      const response = await fetch('/api/integrations/quickbooks/sync', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ groupId, syncType: 'all' }),\n      })\n\n      const data = await response.json()\n      \n      if (data.success) {\n        alert(`Sync completed!\\n\\nTotal: ${data.syncLog.recordsTotal}\\nSuccess: ${data.syncLog.recordsSuccess}\\nFailed: ${data.syncLog.recordsFailed}`)\n        await loadQuickBooksStatus() // Reload status\n      } else {\n        alert('Sync failed. Please try again.')\n      }\n    } catch (error) {\n      console.error('QuickBooks sync error:', error)\n      alert('Sync failed. Please try again.')\n    } finally {\n      setLoading(null)\n    }\n  }\n\n  const toggleIntegration = (id: string) => {\n    if (id === 'quickbooks') {\n      const qbIntegration = integrations.find(i => i.id === 'quickbooks')\n      if (qbIntegration?.status === 'connected') {\n        handleQuickBooksDisconnect()\n      } else {\n        handleQuickBooksConnect()\n      }\n      return\n    }\n\n    // For other integrations, keep the mock behavior\n    setIntegrations((current) =>\n      current.map((integration) => {\n        if (integration.id !== id || integration.status === 'coming-soon') {\n          return integration\n        }\n\n        return {\n          ...integration,\n          status: integration.status === 'connected' ? 'disconnected' : 'connected',\n        }\n      }),\n    )\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <h1 className=\"text-2xl font-bold text-foreground\">Add-ons &amp; Integrations</h1>\n        <p className=\"mt-1 text-sm text-muted-foreground\">\n          Connect AviationHub with the tools your club already uses. Manage OAuth connections, review sync settings, and access documentation from one place.\n        </p>\n      </div>\n\n      <Card className=\"border-primary/20 bg-primary/5\">\n        <CardHeader className=\"pb-3\">\n          <CardTitle className=\"text-base\">Need something else?</CardTitle>\n          <CardDescription>\n            We&apos;re expanding add-on support throughout 2026. Let us know which integrations would save your club the most time.\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"flex flex-wrap items-center gap-3 text-sm text-muted-foreground\">\n            <Link href=\"mailto:hello@aviationhub.com\" className=\"text-primary hover:text-primary/80\">\n              Request an integration â†—\n            </Link>\n          </div>\n        </CardContent>\n      </Card>\n\n      <div className=\"grid gap-4 md:grid-cols-2\">\n        {integrations.map((integration) => (\n          <Card key={integration.id} className=\"h-full\">\n            <CardHeader className=\"space-y-3\">\n              <div className=\"flex items-start justify-between gap-2\">\n                <div className=\"flex items-center gap-2\">\n                  {integration.icon}\n                  <div>\n                    <CardTitle className=\"text-lg leading-tight\">{integration.name}</CardTitle>\n                    <CardDescription>{integration.description}</CardDescription>\n                  </div>\n                </div>\n                <Badge variant={integration.status === 'connected' ? 'secondary' : 'outline'}>\n                  {integration.status === 'connected'\n                    ? 'Connected'\n                    : integration.status === 'coming-soon'\n                      ? 'Coming Soon'\n                      : 'Not Connected'}\n                </Badge>\n              </div>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"space-y-2 text-sm text-muted-foreground\">\n                {integration.features.map((feature) => (\n                  <div key={feature} className=\"flex items-start gap-2\">\n                    <ShieldCheck className=\"mt-0.5 h-4 w-4 text-primary\" />\n                    <span>{feature}</span>\n                  </div>\n                ))}\n              </div>\n\n              <Separator />\n\n              <div className=\"flex flex-wrap items-center gap-3\">\n                <Button\n                  size=\"sm\"\n                  onClick={() => toggleIntegration(integration.id)}\n                  disabled={integration.status === 'coming-soon' || loading === integration.id}\n                  variant={integration.status === 'connected' ? 'destructive' : 'default'}\n                >\n                  {loading === integration.id && <Loader2 className=\"mr-2 h-3 w-3 animate-spin\" />}\n                  {integration.status === 'connected' ? 'Disconnect' : 'Connect'}\n                </Button>\n                \n                {/* QuickBooks-specific: Sync button */}\n                {integration.id === 'quickbooks' && integration.status === 'connected' && (\n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    onClick={handleQuickBooksSync}\n                    disabled={loading === 'quickbooks-sync'}\n                  >\n                    {loading === 'quickbooks-sync' && <Loader2 className=\"mr-2 h-3 w-3 animate-spin\" />}\n                    Sync Now\n                  </Button>\n                )}\n                \n                {integration.helpUrl && (\n                  <Link\n                    href={integration.helpUrl}\n                    target=\"_blank\"\n                    rel=\"noreferrer\"\n                    className=\"text-sm text-muted-foreground underline-offset-4 hover:underline\"\n                  >\n                    View documentation\n                  </Link>\n                )}\n                {integration.status === 'connected' && (\n                  <span className=\"rounded-full bg-primary/10 px-2.5 py-1 text-xs text-primary\">\n                    {integration.id === 'quickbooks' && qbStatus?.lastSync \n                      ? `Last synced: ${new Date(qbStatus.lastSync).toLocaleTimeString()}`\n                      : 'Syncs every 10 minutes'\n                    }\n                  </span>\n                )}\n              </div>\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\club\\BillingRunButton.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Input' is defined but never used.","line":5,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":15,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Input"},"fix":{"range":[98,145],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Label' is defined but never used.","line":6,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":15,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Label"},"fix":{"range":[145,192],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Send' is defined but never used.","line":8,"column":28,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":32,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Send"},"fix":{"range":[315,321],"text":""},"desc":"Remove unused variable \"Send\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[600,603],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[600,603],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":98,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3262,3265],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3262,3265],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\nimport { Play, CreditCard, Send } from 'lucide-react';\n\ninterface BillingRunButtonProps {\n  groupId: string;\n  clubName?: string;\n}\n\nexport default function BillingRunButton({ groupId, clubName }: BillingRunButtonProps) {\n  const [loading, setLoading] = useState(false);\n  const [result, setResult] = useState<any>(null);\n\n  const handleRunBilling = async () => {\n    if (!confirm(`Run billing cycle for ${clubName || 'this club'}?`)) return;\n    \n    setLoading(true);\n    setResult(null);\n\n    try {\n      const res = await fetch(`/api/clubs/${groupId}/billing/run`, {\n        method: 'POST',\n      });\n\n      const data = await res.json();\n      \n      if (res.ok) {\n        setResult(data);\n      } else {\n        alert(data.error || 'Billing failed');\n      }\n    } catch (err) {\n      console.error('Billing failed:', err);\n      alert('Billing failed');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle className=\"flex items-center gap-2\">\n          <CreditCard className=\"h-5 w-5\" />\n          Billing Management\n        </CardTitle>\n        <CardDescription>\n          Run monthly billing to charge members for flight time\n        </CardDescription>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        <Button \n          onClick={handleRunBilling} \n          disabled={loading}\n          className=\"w-full\"\n        >\n          {loading ? (\n            <>Processing...</>\n          ) : (\n            <>\n              <Play className=\"h-4 w-4 mr-2\" />\n              Run Monthly Billing\n            </>\n          )}\n        </Button>\n\n        {result && (\n          <div className=\"p-4 rounded-lg bg-muted\">\n            <h4 className=\"font-medium mb-2\">Billing Complete</h4>\n            <div className=\"grid grid-cols-2 gap-2 text-sm\">\n              <div>\n                <span className=\"text-muted-foreground\">Members Billed:</span>\n                <span className=\"ml-2 font-medium\">{result.summary.totalMembers}</span>\n              </div>\n              <div>\n                <span className=\"text-muted-foreground\">Successful:</span>\n                <span className=\"ml-2 font-medium text-green-600\">{result.summary.successful}</span>\n              </div>\n              <div>\n                <span className=\"text-muted-foreground\">Failed:</span>\n                <span className=\"ml-2 font-medium text-red-600\">{result.summary.failed}</span>\n              </div>\n              <div>\n                <span className=\"text-muted-foreground\">Total:</span>\n                <span className=\"ml-2 font-medium\">${result.summary.totalAmount.toFixed(2)}</span>\n              </div>\n            </div>\n\n            {result.results?.length > 0 && (\n              <div className=\"mt-4 pt-4 border-t\">\n                <h5 className=\"text-sm font-medium mb-2\">Results:</h5>\n                <div className=\"space-y-1 text-xs max-h-32 overflow-y-auto\">\n                  {result.results.map((r: any, i: number) => (\n                    <div key={i} className=\"flex justify-between\">\n                      <span>{r.name} ({r.email})</span>\n                      <span className={r.success ? 'text-green-600' : 'text-red-600'}>\n                        {r.success ? `$${r.amount.toFixed(2)}` : r.error}\n                      </span>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            )}\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\club\\BookingCalendar.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DialogTrigger' is defined but never used.","line":8,"column":60,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":73,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"DialogTrigger"},"fix":{"range":[336,351],"text":""},"desc":"Remove unused variable \"DialogTrigger\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isAdmin' is assigned a value but never used.","line":46,"column":52,"nodeType":"Identifier","messageId":"unusedVar","endLine":46,"endColumn":59},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":47,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1238,1241],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1238,1241],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchSchedule'. Either include it or remove the dependency array.","line":62,"column":6,"nodeType":"ArrayExpression","endLine":62,"endColumn":15,"suggestions":[{"desc":"Update the dependencies array to be: [fetchSchedule, groupId]","fix":{"range":[1725,1734],"text":"[fetchSchedule, groupId]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":79,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2186,2189],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2186,2189],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":90,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2474,2477],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2474,2477],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useEffect, useRef, useState } from 'react';\nimport FullCalendar from '@fullcalendar/react';\nimport dayGridPlugin from '@fullcalendar/daygrid';\nimport timeGridPlugin from '@fullcalendar/timegrid';\nimport interactionPlugin from '@fullcalendar/interaction';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\n\ninterface BookingCalendarProps {\n  groupId: string;\n  isAdmin?: boolean;\n}\n\ninterface ScheduleEvent {\n  id: string;\n  title: string;\n  start: string;\n  end: string;\n  aircraftId?: string;\n  aircraft?: {\n    nNumber: string;\n    name: string;\n  };\n  user?: {\n    id: string;\n    name: string;\n  };\n  type: 'booking' | 'blockout';\n}\n\ninterface Aircraft {\n  id: string;\n  nNumber: string;\n  customName: string;\n  nickname: string;\n  make: string;\n  model: string;\n  status: string;\n}\n\nexport default function BookingCalendar({ groupId, isAdmin = false }: BookingCalendarProps) {\n  const calendarRef = useRef<any>(null);\n  const [events, setEvents] = useState<ScheduleEvent[]>([]);\n  const [aircraft, setAircraft] = useState<Aircraft[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [showModal, setShowModal] = useState(false);\n  const [selectedEvent, setSelectedEvent] = useState<ScheduleEvent | null>(null);\n  const [formData, setFormData] = useState({\n    aircraftId: '',\n    purpose: '',\n    startTime: '',\n    endTime: '',\n  });\n\n  useEffect(() => {\n    fetchSchedule();\n  }, [groupId]);\n\n  const fetchSchedule = async () => {\n    try {\n      const res = await fetch(`/api/clubs/${groupId}/schedule`);\n      if (res.ok) {\n        const data = await res.json();\n        setEvents([...data.bookings, ...data.blockouts]);\n        setAircraft(data.aircraft || []);\n      }\n    } catch (err) {\n      console.error('Failed to fetch schedule:', err);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleDateSelect = (selectInfo: any) => {\n    setSelectedEvent(null);\n    setFormData({\n      aircraftId: '',\n      purpose: '',\n      startTime: formatDateTimeLocal(selectInfo.startStr),\n      endTime: formatDateTimeLocal(selectInfo.endStr),\n    });\n    setShowModal(true);\n  };\n\n  const handleEventClick = (clickInfo: any) => {\n    const event = events.find(e => e.id === clickInfo.event.id);\n    if (event) {\n      setSelectedEvent(event);\n      setFormData({\n        aircraftId: event.aircraftId || '',\n        purpose: event.title,\n        startTime: formatDateTimeLocal(event.start),\n        endTime: formatDateTimeLocal(event.end),\n      });\n      setShowModal(true);\n    }\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    try {\n      const res = await fetch(`/api/clubs/${groupId}/bookings`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          aircraftId: formData.aircraftId,\n          purpose: formData.purpose,\n          startTime: new Date(formData.startTime).toISOString(),\n          endTime: new Date(formData.endTime).toISOString(),\n        }),\n      });\n\n      if (res.ok) {\n        setShowModal(false);\n        fetchSchedule();\n      } else {\n        const data = await res.json();\n        alert(data.error || 'Failed to create booking');\n      }\n    } catch (err) {\n      console.error('Failed to create booking:', err);\n      alert('Failed to create booking');\n    }\n  };\n\n  const handleDelete = async () => {\n    if (!selectedEvent || selectedEvent.type !== 'booking') return;\n    \n    if (!confirm('Delete this booking?')) return;\n\n    try {\n      const res = await fetch(`/api/clubs/${groupId}/bookings?bookingId=${selectedEvent.id}`, {\n        method: 'DELETE',\n      });\n\n      if (res.ok) {\n        setShowModal(false);\n        fetchSchedule();\n      }\n    } catch (err) {\n      console.error('Failed to delete booking:', err);\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center h-96\">\n        <div className=\"text-muted-foreground\">Loading schedule...</div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      <FullCalendar\n        ref={calendarRef}\n        plugins={[dayGridPlugin, timeGridPlugin, interactionPlugin]}\n        initialView=\"timeGridWeek\"\n        headerToolbar={{\n          left: 'prev,next today',\n          center: 'title',\n          right: 'dayGridMonth,timeGridWeek,timeGridDay',\n        }}\n        selectable={true}\n        selectMirror={true}\n        dayMaxEvents={true}\n        events={events.map(e => ({\n          id: e.id,\n          title: e.title,\n          start: e.start,\n          end: e.end,\n          backgroundColor: e.type === 'blockout' ? '#ef4444' : '#3b82f6',\n          borderColor: e.type === 'blockout' ? '#ef4444' : '#3b82f6',\n        }))}\n        select={handleDateSelect}\n        eventClick={handleEventClick}\n        height=\"auto\"\n        slotMinTime=\"06:00:00\"\n        slotMaxTime=\"22:00:00\"\n        allDaySlot={false}\n        weekends={true}\n      />\n\n      <Dialog open={showModal} onOpenChange={setShowModal}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle>\n              {selectedEvent ? 'View Booking' : 'New Booking'}\n            </DialogTitle>\n          </DialogHeader>\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div>\n              <Label htmlFor=\"aircraft\">Aircraft</Label>\n              <Select\n                value={formData.aircraftId}\n                onValueChange={(v) => setFormData({ ...formData, aircraftId: v })}\n                required\n              >\n                <SelectTrigger>\n                  <SelectValue placeholder=\"Select aircraft\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {aircraft.map(a => (\n                    <SelectItem key={a.id} value={a.id}>\n                      {a.nNumber} - {a.customName || a.nickname || `${a.make} ${a.model}`}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div>\n              <Label htmlFor=\"purpose\">Purpose</Label>\n              <Input\n                id=\"purpose\"\n                value={formData.purpose}\n                onChange={(e) => setFormData({ ...formData, purpose: e.target.value })}\n                placeholder=\"Training flight\"\n              />\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <Label htmlFor=\"startTime\">Start</Label>\n                <Input\n                  id=\"startTime\"\n                  type=\"datetime-local\"\n                  value={formData.startTime}\n                  onChange={(e) => setFormData({ ...formData, startTime: e.target.value })}\n                  required\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"endTime\">End</Label>\n                <Input\n                  id=\"endTime\"\n                  type=\"datetime-local\"\n                  value={formData.endTime}\n                  onChange={(e) => setFormData({ ...formData, endTime: e.target.value })}\n                  required\n                />\n              </div>\n            </div>\n\n            <div className=\"flex justify-between\">\n              {selectedEvent?.type === 'booking' && (\n                <Button type=\"button\" variant=\"destructive\" onClick={handleDelete}>\n                  Delete\n                </Button>\n              )}\n              <div className=\"flex gap-2 ml-auto\">\n                <Button type=\"button\" variant=\"outline\" onClick={() => setShowModal(false)}>\n                  Cancel\n                </Button>\n                <Button type=\"submit\">\n                  {selectedEvent ? 'Update' : 'Create'}\n                </Button>\n              </div>\n            </div>\n          </form>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n\nfunction formatDateTimeLocal(isoString: string): string {\n  const date = new Date(isoString);\n  const offset = date.getTimezoneOffset();\n  const localDate = new Date(date.getTime() - offset * 60 * 1000);\n  return localDate.toISOString().slice(0, 16);\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\club\\CheckoutPanel.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Clock' is defined but never used.","line":8,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":22,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Clock"},"fix":{"range":[298,305],"text":""},"desc":"Remove unused variable \"Clock\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DollarSign' is defined but never used.","line":8,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":34,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"DollarSign"},"fix":{"range":[305,317],"text":""},"desc":"Remove unused variable \"DollarSign\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'userId' is defined but never used.","line":42,"column":50,"nodeType":"Identifier","messageId":"unusedVar","endLine":42,"endColumn":56},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchData'. Either include it or remove the dependency array.","line":58,"column":6,"nodeType":"ArrayExpression","endLine":58,"endColumn":15,"suggestions":[{"desc":"Update the dependencies array to be: [fetchData, groupId]","fix":{"range":[1570,1579],"text":"[fetchData, groupId]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Plane, Clock, DollarSign, AlertTriangle, CheckCircle } from 'lucide-react';\n\ninterface CheckoutPanelProps {\n  groupId: string;\n  userId?: string;\n}\n\ninterface ActiveFlight {\n  id: string;\n  aircraftId: string;\n  aircraft: {\n    nNumber: string;\n    name: string;\n    make: string;\n    model: string;\n  };\n  user: {\n    id: string;\n    name: string;\n  };\n  hobbsStart: number;\n  checkedOutAt: string;\n}\n\ninterface Aircraft {\n  id: string;\n  nNumber: string;\n  customName: string;\n  nickname: string;\n  make: string;\n  model: string;\n  hourlyRate: number;\n}\n\nexport default function CheckoutPanel({ groupId, userId }: CheckoutPanelProps) {\n  const [activeFlight, setActiveFlight] = useState<ActiveFlight | null>(null);\n  const [aircraft, setAircraft] = useState<Aircraft[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [checkingOut, setCheckingOut] = useState(false);\n  const [checkingIn, setCheckingIn] = useState(false);\n  const [selectedAircraft, setSelectedAircraft] = useState('');\n  const [hobbsStart, setHobbsStart] = useState('');\n  const [checkoutNotes, setCheckoutNotes] = useState('');\n\n  // Checkin form\n  const [hobbsEnd, setHobbsEnd] = useState('');\n  const [checkinNotes, setCheckinNotes] = useState('');\n\n  useEffect(() => {\n    fetchData();\n  }, [groupId]);\n\n  const fetchData = async () => {\n    try {\n      // Get aircraft\n      const aircraftRes = await fetch(`/api/clubs/${groupId}/aircraft`);\n      const aircraftData = await aircraftRes.json();\n      setAircraft(aircraftData || []);\n\n      // Get active flights\n      const activeRes = await fetch(`/api/clubs/${groupId}/flights/active`);\n      const activeData = await activeRes.json();\n      \n      if (activeData && activeData.length > 0) {\n        setActiveFlight(activeData[0]);\n      }\n    } catch (err) {\n      console.error('Failed to fetch data:', err);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleCheckout = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setCheckingOut(true);\n\n    try {\n      const res = await fetch(`/api/clubs/${groupId}/flights/checkout`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          aircraftId: selectedAircraft,\n          hobbsStart: parseFloat(hobbsStart),\n          notes: checkoutNotes,\n        }),\n      });\n\n      if (res.ok) {\n        const data = await res.json();\n        setActiveFlight(data.flight);\n        setSelectedAircraft('');\n        setHobbsStart('');\n        setCheckoutNotes('');\n      } else {\n        const data = await res.json();\n        alert(data.error || 'Failed to checkout');\n      }\n    } catch (err) {\n      console.error('Checkout failed:', err);\n      alert('Failed to checkout');\n    } finally {\n      setCheckingOut(false);\n    }\n  };\n\n  const handleCheckin = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setCheckingIn(true);\n\n    try {\n      const res = await fetch(`/api/clubs/${groupId}/flights/checkin`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          flightLogId: activeFlight?.id,\n          hobbsEnd: parseFloat(hobbsEnd),\n          notes: checkinNotes,\n        }),\n      });\n\n      if (res.ok) {\n        const data = await res.json();\n        alert(`Flight complete! Hobbs: ${data.flight.hobbsTime.toFixed(1)}, Cost: $${data.flight.calculatedCost.toFixed(2)}`);\n        setActiveFlight(null);\n        setHobbsEnd('');\n        setCheckinNotes('');\n        fetchData();\n      } else {\n        const data = await res.json();\n        alert(data.error || 'Failed to checkin');\n      }\n    } catch (err) {\n      console.error('Checkin failed:', err);\n      alert('Failed to checkin');\n    } finally {\n      setCheckingIn(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      <Card>\n        <CardContent className=\"py-8 text-center text-muted-foreground\">\n          Loading...\n        </CardContent>\n      </Card>\n    );\n  }\n\n  // Show checkin form if aircraft is checked out\n  if (activeFlight) {\n    const hoursOut = activeFlight.hobbsStart \n      ? (new Date().getTime() - new Date(activeFlight.checkedOutAt).getTime()) / (1000 * 60 * 60)\n      : 0;\n\n    return (\n      <Card className=\"border-green-500\">\n        <CardHeader className=\"bg-green-50 dark:bg-green-950\">\n          <CardTitle className=\"flex items-center gap-2 text-green-700\">\n            <CheckCircle className=\"h-5 w-5\" />\n            Aircraft Checked Out\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"pt-4 space-y-4\">\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <Label className=\"text-muted-foreground\">Aircraft</Label>\n              <p className=\"font-medium\">{activeFlight.aircraft.nNumber}</p>\n              <p className=\"text-sm text-muted-foreground\">\n                {activeFlight.aircraft.name || `${activeFlight.aircraft.make} ${activeFlight.aircraft.model}`}\n              </p>\n            </div>\n            <div>\n              <Label className=\"text-muted-foreground\">Checked Out</Label>\n              <p className=\"font-medium\">\n                {new Date(activeFlight.checkedOutAt).toLocaleTimeString()}\n              </p>\n              <p className=\"text-sm text-muted-foreground\">\n                {hoursOut.toFixed(1)} hours ago\n              </p>\n            </div>\n            <div>\n              <Label className=\"text-muted-foreground\">Hobbs Start</Label>\n              <p className=\"font-medium\">{activeFlight.hobbsStart.toFixed(1)}</p>\n            </div>\n            <div>\n              <Label className=\"text-muted-foreground\">Current Hobbs</Label>\n              <p className=\"font-medium text-lg\">\n                {(activeFlight.hobbsStart + hoursOut).toFixed(1)}\n              </p>\n            </div>\n          </div>\n\n          <form onSubmit={handleCheckin} className=\"space-y-4 pt-4 border-t\">\n            <div>\n              <Label htmlFor=\"hobbsEnd\">Enter Ending Hobbs</Label>\n              <Input\n                id=\"hobbsEnd\"\n                type=\"number\"\n                step=\"0.1\"\n                value={hobbsEnd}\n                onChange={(e) => setHobbsEnd(e.target.value)}\n                placeholder=\"e.g., 102.5\"\n                required\n              />\n            </div>\n            <div>\n              <Label htmlFor=\"checkinNotes\">Notes (optional)</Label>\n              <Input\n                id=\"checkinNotes\"\n                value={checkinNotes}\n                onChange={(e) => setCheckinNotes(e.target.value)}\n                placeholder=\"Any notes about the flight\"\n              />\n            </div>\n            <Button \n              type=\"submit\" \n              className=\"w-full\"\n              disabled={checkingIn}\n            >\n              {checkingIn ? 'Processing...' : 'Check In & Complete Flight'}\n            </Button>\n          </form>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  // Show checkout form\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle className=\"flex items-center gap-2\">\n          <Plane className=\"h-5 w-5\" />\n          Aircraft Checkout\n        </CardTitle>\n      </CardHeader>\n      <CardContent>\n        <form onSubmit={handleCheckout} className=\"space-y-4\">\n          <div>\n            <Label htmlFor=\"aircraft\">Select Aircraft</Label>\n            <select\n              id=\"aircraft\"\n              className=\"w-full border rounded-md px-3 py-2 bg-background\"\n              value={selectedAircraft}\n              onChange={(e) => setSelectedAircraft(e.target.value)}\n              required\n            >\n              <option value=\"\">Choose an aircraft...</option>\n              {aircraft.map(a => (\n                <option key={a.id} value={a.id}>\n                  {a.nNumber} - {a.customName || a.nickname || `${a.make} ${a.model}`} (${a.hourlyRate}/hr)\n                </option>\n              ))}\n            </select>\n          </div>\n\n          <div>\n            <Label htmlFor=\"hobbsStart\">Enter Starting Hobbs</Label>\n            <Input\n              id=\"hobbsStart\"\n              type=\"number\"\n              step=\"0.1\"\n              value={hobbsStart}\n              onChange={(e) => setHobbsStart(e.target.value)}\n              placeholder=\"e.g., 98.5\"\n              required\n            />\n          </div>\n\n          <div>\n            <Label htmlFor=\"checkoutNotes\">Notes (optional)</Label>\n            <Input\n              id=\"checkoutNotes\"\n              value={checkoutNotes}\n              onChange={(e) => setCheckoutNotes(e.target.value)}\n              placeholder=\"Pre-flight notes\"\n            />\n          </div>\n\n          <Button \n            type=\"submit\" \n            className=\"w-full\"\n            disabled={checkingOut || !selectedAircraft || !hobbsStart}\n          >\n            {checkingOut ? 'Checking Out...' : 'Check Out Aircraft'}\n          </Button>\n\n          {aircraft.length === 0 && (\n            <p className=\"text-sm text-amber-600 flex items-center gap-2\">\n              <AlertTriangle className=\"h-4 w-4\" />\n              No aircraft available for this club.\n            </p>\n          )}\n        </form>\n      </CardContent>\n    </Card>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\club\\ManageBillingSection.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":123,"column":84,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":123,"endColumn":87,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3566,3569],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3566,3569],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":136,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":136,"endColumn":21}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useEffect, useMemo, useState } from 'react'\n\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Label } from '@/components/ui/label'\nimport { Switch } from '@/components/ui/switch'\nimport { Badge } from '@/components/ui/badge'\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'\nimport { Separator } from '@/components/ui/separator'\nimport { CalendarRange, Mail, Users } from 'lucide-react'\n\nimport { useManageContext } from './ManageContext'\n\ntype Recipient = {\n  id: string\n  name: string\n  email: string\n  phone: string\n  homeAirport: string\n  balance: number\n  lastPayment?: string\n  disabled?: boolean\n  selected: boolean\n}\n\nconst FALLBACK_RECIPIENTS: Recipient[] = [\n  {\n    id: 'demo-1',\n    name: 'David Koster',\n    email: 'david@amicurrent.com',\n    phone: '(425) 555-0184',\n    homeAirport: 'KPAE',\n    balance: 0,\n    lastPayment: 'Jan 12, 2026',\n    selected: true,\n  },\n  {\n    id: 'demo-2',\n    name: 'Sarah Johnson',\n    email: 'sarah@club.com',\n    phone: '(206) 555-0107',\n    homeAirport: 'KRNT',\n    balance: 142.75,\n    lastPayment: 'Feb 05, 2026',\n    selected: true,\n  },\n  {\n    id: 'demo-3',\n    name: 'Mike Wilson',\n    email: 'mike@club.com',\n    phone: '(425) 555-0163',\n    homeAirport: 'KBLI',\n    balance: -25,\n    lastPayment: 'Jan 28, 2026',\n    selected: true,\n  },\n  {\n    id: 'demo-4',\n    name: 'Alex Chen',\n    email: 'alex@club.com',\n    phone: '(509) 555-0119',\n    homeAirport: 'KGEG',\n    balance: 87.5,\n    lastPayment: 'Dec 21, 2025',\n    disabled: true,\n    selected: false,\n  },\n]\n\ntype FetchState = 'idle' | 'loading' | 'ready'\n\nconst generateId = () => {\n  if (typeof globalThis.crypto !== 'undefined' && typeof globalThis.crypto.randomUUID === 'function') {\n    return globalThis.crypto.randomUUID()\n  }\n  return `recipient-${Math.random().toString(36).slice(2)}`\n}\n\nexport default function ManageBillingSection() {\n  const { selectedGroupId, groups, isDemo } = useManageContext()\n\n  const [startDate, setStartDate] = useState('2026-01-01')\n  const [endDate, setEndDate] = useState('2026-02-24')\n  const [includeAll, setIncludeAll] = useState(false)\n  const [includeDisabled, setIncludeDisabled] = useState(false)\n  const [showBalance, setShowBalance] = useState<'current' | 'all'>('current')\n  const [groupFilter, setGroupFilter] = useState<'selected' | 'all'>('selected')\n  const [bccEmail, setBccEmail] = useState('')\n\n  const [recipients, setRecipients] = useState<Recipient[] | null>(null)\n  const [recipientState, setRecipientState] = useState<FetchState>('idle')\n  const [processing, setProcessing] = useState(false)\n\n  const activeGroup = useMemo(() => groups.find((group) => group.id === selectedGroupId) ?? null, [groups, selectedGroupId])\n\n  useEffect(() => {\n    if (!selectedGroupId) {\n      setRecipients(null)\n      return\n    }\n\n    if (isDemo) {\n      setRecipients(FALLBACK_RECIPIENTS)\n      setRecipientState('ready')\n      return\n    }\n\n    let cancelled = false\n    setRecipientState('loading')\n\n    async function fetchRecipients() {\n      try {\n        const response = await fetch(`/api/groups/${selectedGroupId}/members`)\n        if (!response.ok) {\n          throw new Error('Unable to load members')\n        }\n        const data = await response.json()\n        if (cancelled) return\n\n        const mapped: Recipient[] = (Array.isArray(data) ? data : []).map((member: any) => ({\n          id: member.id ?? member.userId ?? generateId(),\n          name: member.user?.name ?? member.name ?? 'Member',\n          email: member.user?.email ?? member.email ?? 'unknown@example.com',\n          phone: member.user?.phone ?? member.phone ?? 'â€”',\n          homeAirport: member.homeAirport ?? member.base ?? 'â€”',\n          balance: typeof member.balance === 'number' ? member.balance : 0,\n          lastPayment: member.lastPaymentAt ? new Date(member.lastPaymentAt).toLocaleDateString() : undefined,\n          disabled: member.status === 'disabled' || member.disabled === true,\n          selected: true,\n        }))\n\n        setRecipients(mapped.length ? mapped : FALLBACK_RECIPIENTS)\n      } catch (error) {\n        if (!cancelled) {\n          setRecipients(FALLBACK_RECIPIENTS)\n        }\n      } finally {\n        if (!cancelled) {\n          setRecipientState('ready')\n        }\n      }\n    }\n\n    fetchRecipients()\n    return () => {\n      cancelled = true\n    }\n  }, [selectedGroupId, isDemo])\n\n  const summary = useMemo(() => {\n    if (!recipients) {\n      return { debit: 0, credit: 0 }\n    }\n\n    const debit = recipients\n      .filter((recipient) => recipient.balance > 0 && recipient.selected)\n      .reduce((sum, recipient) => sum + recipient.balance, 0)\n    const credit = recipients\n      .filter((recipient) => recipient.balance < 0 && recipient.selected)\n      .reduce((sum, recipient) => sum + Math.abs(recipient.balance), 0)\n\n    return {\n      debit,\n      credit,\n    }\n  }, [recipients])\n\n  const toggleRecipient = (id: string, next: boolean) => {\n    setRecipients((current) =>\n      current ? current.map((recipient) => (recipient.id === id ? { ...recipient, selected: next } : recipient)) : current,\n    )\n  }\n\n  const toggleAll = (next: boolean) => {\n    setRecipients((current) => (current ? current.map((recipient) => ({ ...recipient, selected: next })) : current))\n  }\n\n  const handleProcessBilling = () => {\n    setProcessing(true)\n    setTimeout(() => {\n      setProcessing(false)\n      alert('Billing run queued. Emails will be sent to selected recipients.')\n    }, 1200)\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"space-y-1\">\n        <div className=\"flex flex-wrap items-center gap-3 text-xs font-semibold uppercase tracking-wide text-muted-foreground\">\n          <span>Manage</span>\n          <span>â€¢</span>\n          <span>Billing</span>\n        </div>\n        <h1 className=\"text-2xl font-bold text-foreground\">Monthly Club Billing</h1>\n        <p className=\"text-sm text-muted-foreground\">\n          Run billing once per cycle to email detailed statements to your members. Statements include flights, charges, and payments from the selected date range.\n        </p>\n        {activeGroup && (\n          <p className=\"text-xs text-muted-foreground\">\n            Active club: <span className=\"font-medium text-foreground\">{activeGroup.name}</span>\n          </p>\n        )}\n      </div>\n\n      <Card className=\"border-amber-200 bg-amber-50\">\n        <CardHeader className=\"pb-2\">\n          <div className=\"flex items-start gap-2 text-amber-800\">\n            <CalendarRange className=\"mt-0.5 h-5 w-5\" />\n            <div>\n              <CardTitle className=\"text-base\">Heads up!</CardTitle>\n              <CardDescription className=\"text-sm text-amber-700\">\n                Billing emails are sent to every selected recipient immediately after processing. Customize the message at <span className=\"font-medium\">General Settings â†’ Billing Message</span>.\n              </CardDescription>\n            </div>\n          </div>\n        </CardHeader>\n      </Card>\n\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"text-base\">Billing window</CardTitle>\n          <CardDescription>Choose the statement period for this billing run.</CardDescription>\n        </CardHeader>\n        <CardContent className=\"grid gap-4 md:grid-cols-2\">\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"billing-start\">From</Label>\n            <Input id=\"billing-start\" type=\"date\" value={startDate} onChange={(event) => setStartDate(event.target.value)} />\n          </div>\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"billing-end\">To</Label>\n            <Input id=\"billing-end\" type=\"date\" value={endDate} onChange={(event) => setEndDate(event.target.value)} />\n          </div>\n          <div className=\"space-y-2\">\n            <div className=\"flex items-center justify-between\">\n              <Label className=\"text-sm font-medium\">Include all customers with ledger history</Label>\n              <Switch checked={includeAll} onCheckedChange={(checked) => setIncludeAll(checked)} />\n            </div>\n            <p className=\"text-xs text-muted-foreground\">Sends statements even if the current balance is zero.</p>\n          </div>\n          <div className=\"space-y-2\">\n            <div className=\"flex items-center justify-between\">\n              <Label className=\"text-sm font-medium\">Include disabled customer accounts</Label>\n              <Switch checked={includeDisabled} onCheckedChange={(checked) => setIncludeDisabled(checked)} />\n            </div>\n            <p className=\"text-xs text-muted-foreground\">Good for annual audits or closing the books.</p>\n          </div>\n          <div className=\"space-y-2\">\n            <Label>Show groups</Label>\n            <Select value={groupFilter} onValueChange={(value: 'selected' | 'all') => setGroupFilter(value)}>\n              <SelectTrigger>\n                <SelectValue placeholder=\"Selected club\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"selected\">Selected club</SelectItem>\n                <SelectItem value=\"all\" disabled>\n                  All (coming soon)\n                </SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n          <div className=\"space-y-2\">\n            <Label>Show balance</Label>\n            <Select value={showBalance} onValueChange={(value: 'current' | 'all') => setShowBalance(value)}>\n              <SelectTrigger>\n                <SelectValue placeholder=\"Current balance\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"current\">Current balance</SelectItem>\n                <SelectItem value=\"all\">All activity in range</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n          <div className=\"space-y-2 md:col-span-2\">\n            <Label htmlFor=\"bcc-email\">BCC</Label>\n            <div className=\"flex items-center gap-2\">\n              <Input\n                id=\"bcc-email\"\n                placeholder=\"finance@yourclub.com\"\n                value={bccEmail}\n                onChange={(event) => setBccEmail(event.target.value)}\n              />\n              <Button\n                type=\"button\"\n                variant={bccEmail ? 'secondary' : 'outline'}\n                onClick={() => setBccEmail('billing@amicurrent.com')}\n              >\n                Use club billing inbox\n              </Button>\n            </div>\n            <p className=\"text-xs text-muted-foreground\">\n              Statements are always emailed to each member. The BCC address receives a consolidated copy.\n            </p>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader className=\"space-y-1\">\n          <CardTitle className=\"text-base\">Recipients</CardTitle>\n          <CardDescription>Select who should receive this statement run.</CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          {recipients && recipients.length > 0 ? (\n            <>\n              <div className=\"flex flex-wrap items-center justify-between gap-3 text-sm\">\n                <div className=\"flex items-center gap-2 text-muted-foreground\">\n                  <Users className=\"h-4 w-4\" />\n                  <span>\n                    {recipients.filter((recipient) => recipient.selected).length} of {recipients.length} recipients selected\n                  </span>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <Button variant=\"outline\" size=\"sm\" onClick={() => toggleAll(true)}>\n                    Select all\n                  </Button>\n                  <Button variant=\"outline\" size=\"sm\" onClick={() => toggleAll(false)}>\n                    Deselect all\n                  </Button>\n                </div>\n              </div>\n\n              <div className=\"overflow-hidden rounded-lg border\">\n                <table className=\"min-w-full divide-y divide-border text-sm\">\n                  <thead className=\"bg-muted/40\">\n                    <tr className=\"text-left text-xs uppercase tracking-wide text-muted-foreground\">\n                      <th className=\"px-4 py-2 font-medium\">Send</th>\n                      <th className=\"px-4 py-2 font-medium\">User</th>\n                      <th className=\"px-4 py-2 font-medium\">Departure</th>\n                      <th className=\"px-4 py-2 font-medium text-right\">Balance</th>\n                      <th className=\"px-4 py-2 font-medium text-right\">Last Payment</th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"divide-y divide-border\">\n                    {recipients.map((recipient) => {\n                      const balanceLabel = recipient.balance === 0 ? '$0.00' : `$${recipient.balance.toFixed(2)}`\n                      const badgeVariant = recipient.balance > 0 ? 'default' : recipient.balance < 0 ? 'outline' : 'secondary'\n                      const disabled = recipient.disabled && !includeDisabled\n\n                      return (\n                        <tr key={recipient.id} className={recipient.disabled ? 'bg-muted/40' : ''}>\n                          <td className=\"px-4 py-3\">\n                            <Switch\n                              checked={recipient.selected}\n                              onCheckedChange={(next) => toggleRecipient(recipient.id, Boolean(next))}\n                              disabled={disabled}\n                            />\n                          </td>\n                          <td className=\"px-4 py-3\">\n                            <div className=\"flex flex-col\">\n                              <span className=\"font-medium text-foreground\">{recipient.name}</span>\n                              <span className=\"text-xs text-muted-foreground\">{recipient.email}</span>\n                              <span className=\"text-xs text-muted-foreground\">{recipient.phone}</span>\n                              {recipient.disabled && <span className=\"text-xs text-destructive\">Account disabled</span>}\n                            </div>\n                          </td>\n                          <td className=\"px-4 py-3 text-sm text-muted-foreground\">{recipient.homeAirport}</td>\n                          <td className=\"px-4 py-3 text-right\">\n                            <Badge variant={badgeVariant}>{balanceLabel}</Badge>\n                          </td>\n                          <td className=\"px-4 py-3 text-right text-sm text-muted-foreground\">\n                            {recipient.lastPayment ?? 'â€”'}\n                          </td>\n                        </tr>\n                      )\n                    })}\n                  </tbody>\n                </table>\n              </div>\n\n              <div className=\"flex flex-wrap items-center justify-between gap-3 rounded-lg border border-dashed border-border px-4 py-3 text-sm\">\n                <div className=\"flex items-center gap-3\">\n                  <span>\n                    Outstanding Debits: <span className=\"font-semibold text-foreground\">${summary.debit.toFixed(2)}</span>\n                  </span>\n                  <Separator orientation=\"vertical\" className=\"h-4\" />\n                  <span>\n                    Outstanding Credits: <span className=\"font-semibold text-foreground\">${summary.credit.toFixed(2)}</span>\n                  </span>\n                </div>\n                <div className=\"flex items-center gap-2 text-muted-foreground\">\n                  <Mail className=\"h-4 w-4\" />\n                  <span>Emails go to selected users + {bccEmail ? bccEmail : 'no BCC set'}</span>\n                </div>\n              </div>\n\n              <div className=\"flex flex-wrap items-center justify-between gap-3\">\n                <Button\n                  disabled={processing || recipients.every((recipient) => !recipient.selected)}\n                  onClick={handleProcessBilling}\n                >\n                  {processing ? 'Processingâ€¦' : 'Process Billing'}\n                </Button>\n                <p className=\"text-xs text-muted-foreground\">\n                  Selecting â€œProcess Billingâ€ sends statements immediately to the recipients you have toggled above.\n                </p>\n              </div>\n            </>\n          ) : (\n            <div className=\"flex flex-col items-center justify-center rounded-lg border border-dashed border-border py-12 text-center text-sm text-muted-foreground\">\n              {recipientState === 'loading' ? 'Loading recipientsâ€¦' : 'Select a club above to view recipients'}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\club\\ManageContext.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\club\\ManageSidebar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\club\\ManageUsersSection.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":117,"column":83,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":117,"endColumn":86,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2981,2984],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2981,2984],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":129,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":129,"endColumn":21}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useEffect, useMemo, useState } from 'react'\n\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Badge } from '@/components/ui/badge'\nimport { Separator } from '@/components/ui/separator'\nimport { Search, UserPlus } from 'lucide-react'\n\nimport { useManageContext } from './ManageContext'\n\ntype ClubRole = 'member' | 'admin' | 'instructor'\n\ninterface ClubUser {\n  id: string\n  name: string\n  email: string\n  phone: string\n  homeAirport: string\n  balance: number\n  role: ClubRole\n  lastFlight?: string\n}\n\nconst DEMO_USERS: ClubUser[] = [\n  {\n    id: 'demo-1',\n    name: 'David Koster',\n    email: 'david@amicurrent.com',\n    phone: '(425) 555-0184',\n    homeAirport: 'KPAE',\n    balance: 0,\n    role: 'admin',\n    lastFlight: 'Feb 19, 2026',\n  },\n  {\n    id: 'demo-2',\n    name: 'Sarah Johnson',\n    email: 'sarah@club.com',\n    phone: '(206) 555-0107',\n    homeAirport: 'KRNT',\n    balance: 142.75,\n    role: 'member',\n    lastFlight: 'Feb 11, 2026',\n  },\n  {\n    id: 'demo-3',\n    name: 'Mike Wilson',\n    email: 'mike@club.com',\n    phone: '(425) 555-0163',\n    homeAirport: 'KBLI',\n    balance: -25,\n    role: 'instructor',\n    lastFlight: 'Feb 05, 2026',\n  },\n  {\n    id: 'demo-4',\n    name: 'Alex Chen',\n    email: 'alex@club.com',\n    phone: '(509) 555-0119',\n    homeAirport: 'KGEG',\n    balance: 87.5,\n    role: 'member',\n    lastFlight: 'Jan 28, 2026',\n  },\n]\n\ninterface ManageUsersSectionProps {\n  roleFilter?: ClubRole\n  title: string\n  description: string\n}\n\ntype FetchState = 'idle' | 'loading' | 'ready'\n\nconst generateId = () => {\n  if (typeof globalThis.crypto !== 'undefined' && typeof globalThis.crypto.randomUUID === 'function') {\n    return globalThis.crypto.randomUUID()\n  }\n  return `user-${Math.random().toString(36).slice(2)}`\n}\n\nexport default function ManageUsersSection({ roleFilter, title, description }: ManageUsersSectionProps) {\n  const { selectedGroupId, groups, isDemo } = useManageContext()\n  const [query, setQuery] = useState('')\n  const [users, setUsers] = useState<ClubUser[] | null>(null)\n  const [state, setState] = useState<FetchState>('idle')\n\n  const activeGroup = useMemo(() => groups.find((group) => group.id === selectedGroupId) ?? null, [groups, selectedGroupId])\n\n  useEffect(() => {\n    if (!selectedGroupId) {\n      setUsers(null)\n      return\n    }\n\n    if (isDemo) {\n      setUsers(DEMO_USERS)\n      setState('ready')\n      return\n    }\n\n    let cancelled = false\n    setState('loading')\n\n    async function loadUsers() {\n      try {\n        const response = await fetch(`/api/groups/${selectedGroupId}/members`)\n        if (!response.ok) {\n          throw new Error('Unable to load members')\n        }\n        const data = await response.json()\n        if (cancelled) return\n\n        const mapped: ClubUser[] = (Array.isArray(data) ? data : []).map((member: any) => ({\n          id: member.id ?? member.userId ?? generateId(),\n          name: member.user?.name ?? member.name ?? 'Member',\n          email: member.user?.email ?? member.email ?? 'unknown@example.com',\n          phone: member.user?.phone ?? member.phone ?? 'â€”',\n          homeAirport: member.homeAirport ?? member.base ?? 'â€”',\n          balance: typeof member.balance === 'number' ? member.balance : 0,\n          role: member.role === 'ADMIN' ? 'admin' : member.role === 'CFI' ? 'instructor' : 'member',\n          lastFlight: member.lastFlightAt ? new Date(member.lastFlightAt).toLocaleDateString() : undefined,\n        }))\n\n        setUsers(mapped.length ? mapped : DEMO_USERS)\n      } catch (error) {\n        if (!cancelled) {\n          setUsers(DEMO_USERS)\n        }\n      } finally {\n        if (!cancelled) {\n          setState('ready')\n        }\n      }\n    }\n\n    loadUsers()\n    return () => {\n      cancelled = true\n    }\n  }, [selectedGroupId, isDemo])\n\n  const filteredUsers = useMemo(() => {\n    if (!users) return []\n    return users.filter((user) => {\n      const matchesRole = roleFilter ? user.role === roleFilter : true\n      const matchesQuery = query\n        ? `${user.name} ${user.email} ${user.phone}`.toLowerCase().includes(query.toLowerCase())\n        : true\n      return matchesRole && matchesQuery\n    })\n  }, [users, roleFilter, query])\n\n  const totalBalance = filteredUsers.reduce((sum, user) => sum + user.balance, 0)\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"space-y-1\">\n        <h1 className=\"text-2xl font-bold text-foreground\">{title}</h1>\n        <p className=\"text-sm text-muted-foreground\">{description}</p>\n        {activeGroup && (\n          <p className=\"text-xs text-muted-foreground\">\n            Active club: <span className=\"font-medium text-foreground\">{activeGroup.name}</span>\n          </p>\n        )}\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"text-base\">Roster</CardTitle>\n          <CardDescription>Invite new members or review balances before running billing.</CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"flex flex-wrap items-center justify-between gap-3\">\n            <div className=\"relative w-full max-w-xs\">\n              <Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground\" />\n              <Input\n                placeholder=\"Search by name or email\"\n                className=\"pl-9\"\n                value={query}\n                onChange={(event) => setQuery(event.target.value)}\n                disabled={!users || state === 'loading'}\n              />\n            </div>\n            <Button size=\"sm\" onClick={() => alert('Invite flow coming soon')}>\n              <UserPlus className=\"mr-2 h-4 w-4\" />\n              New User\n            </Button>\n          </div>\n\n          {users && users.length > 0 ? (\n            <>\n              <div className=\"overflow-hidden rounded-lg border\">\n                <table className=\"min-w-full divide-y divide-border text-sm\">\n                  <thead className=\"bg-muted/40\">\n                    <tr className=\"text-left text-xs uppercase tracking-wide text-muted-foreground\">\n                      <th className=\"px-4 py-3 font-medium\">Name</th>\n                      <th className=\"px-4 py-3 font-medium\">Phone</th>\n                      <th className=\"px-4 py-3 font-medium\">Departure</th>\n                      <th className=\"px-4 py-3 font-medium text-right\">Balance</th>\n                      <th className=\"px-4 py-3 font-medium text-right\">Last Flight</th>\n                      <th className=\"px-4 py-3 font-medium text-right\">Actions</th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"divide-y divide-border\">\n                    {filteredUsers.map((user) => {\n                      const balanceLabel = user.balance === 0 ? '$0.00' : `$${user.balance.toFixed(2)}`\n                      const badgeVariant = user.balance > 0 ? 'default' : user.balance < 0 ? 'secondary' : 'outline'\n\n                      return (\n                        <tr key={user.id}>\n                          <td className=\"px-4 py-3\">\n                            <div className=\"flex flex-col\">\n                              <span className=\"font-medium text-foreground\">{user.name}</span>\n                              <span className=\"text-xs text-muted-foreground\">{user.email}</span>\n                              <span className=\"text-xs text-muted-foreground capitalize\">{user.role}</span>\n                            </div>\n                          </td>\n                          <td className=\"px-4 py-3 text-sm text-muted-foreground\">{user.phone}</td>\n                          <td className=\"px-4 py-3 text-sm text-muted-foreground\">{user.homeAirport}</td>\n                          <td className=\"px-4 py-3 text-right\">\n                            <Badge variant={badgeVariant}>{balanceLabel}</Badge>\n                          </td>\n                          <td className=\"px-4 py-3 text-right text-sm text-muted-foreground\">{user.lastFlight ?? 'â€”'}</td>\n                          <td className=\"px-4 py-3 text-right\">\n                            <Button variant=\"outline\" size=\"sm\" onClick={() => alert('User detail view coming soon')}>\n                              View\n                            </Button>\n                          </td>\n                        </tr>\n                      )\n                    })}\n                  </tbody>\n                </table>\n              </div>\n\n              <div className=\"flex flex-wrap items-center justify-between gap-3 rounded-lg border border-dashed border-border px-4 py-3 text-sm\">\n                <div className=\"flex items-center gap-3\">\n                  <span>\n                    Total accounts: <span className=\"font-semibold text-foreground\">{filteredUsers.length}</span>\n                  </span>\n                  <Separator orientation=\"vertical\" className=\"h-4\" />\n                  <span>\n                    Outstanding balance: <span className=\"font-semibold text-foreground\">${totalBalance.toFixed(2)}</span>\n                  </span>\n                </div>\n                <span className=\"text-xs text-muted-foreground\">Use the Billing section to email detailed statements.</span>\n              </div>\n            </>\n          ) : (\n            <div className=\"flex flex-col items-center justify-center rounded-lg border border-dashed border-border py-12 text-center text-sm text-muted-foreground\">\n              {state === 'loading' ? 'Loading membersâ€¦' : 'Select a club above to view members'}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\club\\MemberList.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchMembers'. Either include it or remove the dependency array.","line":35,"column":6,"nodeType":"ArrayExpression","endLine":35,"endColumn":15,"suggestions":[{"desc":"Update the dependencies array to be: [fetchMembers, groupId]","fix":{"range":[900,909],"text":"[fetchMembers, groupId]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useEffect, useState } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Badge } from '@/components/ui/badge';\nimport { MoreVertical, UserPlus, Search } from 'lucide-react';\n\ninterface Member {\n  id: string;\n  userId: string;\n  role: string;\n  joinedAt: string;\n  user: {\n    id: string;\n    name: string;\n    email: string;\n  };\n}\n\ninterface MemberListProps {\n  groupId: string;\n  isAdmin?: boolean;\n  onInviteClick?: () => void;\n}\n\nexport default function MemberList({ groupId, isAdmin = false, onInviteClick }: MemberListProps) {\n  const [members, setMembers] = useState<Member[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [search, setSearch] = useState('');\n\n  useEffect(() => {\n    fetchMembers();\n  }, [groupId]);\n\n  const fetchMembers = async () => {\n    try {\n      const res = await fetch(`/api/groups/${groupId}/members`);\n      if (res.ok) {\n        const data = await res.json();\n        setMembers(data);\n      }\n    } catch (err) {\n      console.error('Failed to fetch members:', err);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleRoleChange = async (memberId: string, newRole: string) => {\n    try {\n      const res = await fetch(`/api/groups/${groupId}/members`, {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ memberId, role: newRole }),\n      });\n\n      if (res.ok) {\n        fetchMembers();\n      }\n    } catch (err) {\n      console.error('Failed to update role:', err);\n    }\n  };\n\n  const handleRemove = async (memberId: string) => {\n    if (!confirm('Remove this member from the club?')) return;\n\n    try {\n      const res = await fetch(`/api/groups/${groupId}/members?memberId=${memberId}`, {\n        method: 'DELETE',\n      });\n\n      if (res.ok) {\n        fetchMembers();\n      }\n    } catch (err) {\n      console.error('Failed to remove member:', err);\n    }\n  };\n\n  const filteredMembers = members.filter(m => \n    m.user.name?.toLowerCase().includes(search.toLowerCase()) ||\n    m.user.email?.toLowerCase().includes(search.toLowerCase())\n  );\n\n  const getRoleBadge = (role: string) => {\n    switch (role) {\n      case 'ADMIN':\n        return <Badge className=\"bg-purple-100 text-purple-800\">Admin</Badge>;\n      case 'CFI':\n        return <Badge className=\"bg-blue-100 text-blue-800\">CFI</Badge>;\n      default:\n        return <Badge variant=\"secondary\">Member</Badge>;\n    }\n  };\n\n  if (loading) {\n    return (\n      <Card>\n        <CardContent className=\"py-8 text-center text-muted-foreground\">\n          Loading members...\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card>\n      <CardHeader>\n        <div className=\"flex items-center justify-between\">\n          <CardTitle>Members ({members.length})</CardTitle>\n          {isAdmin && (\n            <Button size=\"sm\" onClick={onInviteClick} disabled={!onInviteClick}>\n              <UserPlus className=\"h-4 w-4 mr-2\" />\n              Add Member\n            </Button>\n          )}\n        </div>\n      </CardHeader>\n      <CardContent>\n        {/* Search */}\n        <div className=\"relative mb-4\">\n          <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n          <Input\n            placeholder=\"Search members...\"\n            value={search}\n            onChange={(e) => setSearch(e.target.value)}\n            className=\"pl-9\"\n          />\n        </div>\n\n        {/* Member List */}\n        <div className=\"space-y-2\">\n          {filteredMembers.map((member) => (\n            <div\n              key={member.id}\n              className=\"flex items-center justify-between p-3 rounded-lg border hover:bg-muted/50\"\n            >\n              <div className=\"flex items-center gap-3\">\n                <div className=\"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center\">\n                  <span className=\"text-sm font-medium\">\n                    {member.user.name?.charAt(0).toUpperCase() || '?'}\n                  </span>\n                </div>\n                <div>\n                  <p className=\"font-medium\">{member.user.name || 'Unknown'}</p>\n                  <p className=\"text-sm text-muted-foreground\">{member.user.email}</p>\n                </div>\n              </div>\n\n              <div className=\"flex items-center gap-2\">\n                {getRoleBadge(member.role)}\n                \n                {isAdmin && (\n                  <div className=\"flex items-center gap-1\">\n                    <select\n                      value={member.role}\n                      onChange={(e) => handleRoleChange(member.id, e.target.value)}\n                      className=\"text-sm border rounded px-2 py-1 bg-background\"\n                    >\n                      <option value=\"MEMBER\">Member</option>\n                      <option value=\"CFI\">CFI</option>\n                      <option value=\"ADMIN\">Admin</option>\n                    </select>\n                    \n                    <Button\n                      variant=\"ghost\"\n                      size=\"icon\"\n                      onClick={() => handleRemove(member.id)}\n                    >\n                      <MoreVertical className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                )}\n              </div>\n            </div>\n          ))}\n        </div>\n\n        {filteredMembers.length === 0 && (\n          <p className=\"text-center text-muted-foreground py-8\">\n            No members found\n          </p>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\flight-complete\\FlightCompleteWizard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Card' is defined but never used.","line":9,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":14,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Card"},"fix":{"range":[364,369],"text":""},"desc":"Remove unused variable \"Card\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardContent' is defined but never used.","line":9,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":27,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"CardContent"},"fix":{"range":[368,381],"text":""},"desc":"Remove unused variable \"CardContent\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardHeader' is defined but never used.","line":9,"column":29,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":39,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"CardHeader"},"fix":{"range":[381,393],"text":""},"desc":"Remove unused variable \"CardHeader\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardTitle' is defined but never used.","line":9,"column":41,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":50,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"CardTitle"},"fix":{"range":[355,436],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Fuel' is defined but never used.","line":15,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":7,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Fuel"},"fix":{"range":[582,591],"text":""},"desc":"Remove unused variable \"Fuel\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Clock' is defined but never used.","line":20,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":20,"endColumn":8,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Clock"},"fix":{"range":[644,653],"text":""},"desc":"Remove unused variable \"Clock\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FileText' is defined but never used.","line":21,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":11,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"FileText"},"fix":{"range":[653,665],"text":""},"desc":"Remove unused variable \"FileText\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'X' is defined but never used.","line":23,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":23,"endColumn":4,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"X"},"fix":{"range":[673,678],"text":""},"desc":"Remove unused variable \"X\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState } from 'react';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { \n  CheckCircle, \n  AlertTriangle, \n  Fuel, \n  Wrench, \n  ChevronRight, \n  ChevronLeft,\n  Plane,\n  Clock,\n  FileText,\n  Send,\n  X\n} from 'lucide-react';\n\ninterface FlightCompleteWizardProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  flight: {\n    id: string;\n    aircraftId: string;\n    aircraftName: string;\n    userId: string;\n    userName: string;\n    hobbsStart?: number;\n    checkoutTime?: string;\n  };\n  onComplete: (data: FlightCompletionData) => void;\n}\n\nexport interface FlightCompletionData {\n  flightId: string;\n  aircraftId: string;\n  userId: string;\n  wentWell: boolean;\n  hobbsStart: number;\n  hobbsEnd: number;\n  tachTime?: number;\n  notes: string;\n  // Fuel\n  fuelGallons?: number;\n  fuelPricePerGallon?: number;\n  fuelNotes?: string;\n  // Maintenance\n  hasIssues: boolean;\n  issueType?: 'GENERIC' | 'PLANE_SPECIFIC';\n  isPlaneSpecific?: boolean;\n  category?: string;\n  severity?: 'LOW' | 'MEDIUM' | 'HIGH';\n  issueDescription?: string;\n}\n\nconst MAINTENANCE_CATEGORIES = [\n  { value: 'OIL', label: 'Oil', icon: 'ðŸ›¢ï¸', severity: 'MEDIUM' as const },\n  { value: 'ENGINE', label: 'Engine', icon: 'âš™ï¸', severity: 'HIGH' as const },\n  { value: 'AVIONICS', label: 'Avionics', icon: 'ðŸ“¡', severity: 'MEDIUM' as const },\n  { value: 'AIRFRAME', label: 'Airframe', icon: 'âœˆï¸', severity: 'MEDIUM' as const },\n  { value: 'PROP', label: 'Prop', icon: 'ðŸ”„', severity: 'HIGH' as const },\n  { value: 'ELECTRICAL', label: 'Electrical', icon: 'âš¡', severity: 'HIGH' as const },\n  { value: 'INTERIOR', label: 'Interior', icon: 'ðŸ’º', severity: 'LOW' as const },\n];\n\nexport function FlightCompleteWizard({ open, onOpenChange, flight, onComplete }: FlightCompleteWizardProps) {\n  const [step, setStep] = useState(1);\n  const [submitting, setSubmitting] = useState(false);\n  const totalSteps = 5;\n  \n  const [data, setData] = useState<FlightCompletionData>({\n    flightId: flight.id,\n    aircraftId: flight.aircraftId,\n    userId: flight.userId,\n    wentWell: true,\n    hasIssues: false,\n    hobbsStart: flight.hobbsStart || 0,\n    hobbsEnd: flight.hobbsStart || 0,\n    notes: '',\n  });\n\n  const showSummaryStep = !data.hasIssues && step === 5;\n\n  const handleNext = () => {\n    // If going from step 4 (issues) and no issues, skip to summary (step 5)\n    if (step === 4 && !data.hasIssues) {\n      setStep(5); // Go to summary\n    } else if (step < 5) {\n      setStep(step + 1);\n    }\n  };\n\n  const handleBack = () => {\n    if (step > 1) setStep(step - 1);\n  };\n\n  const handleSubmit = async () => {\n    setSubmitting(true);\n    try {\n      await onComplete(data);\n      onOpenChange(false);\n      setStep(1);\n      setData({\n        flightId: flight.id,\n        aircraftId: flight.aircraftId,\n        userId: flight.userId,\n        wentWell: true,\n        hasIssues: false,\n        hobbsStart: flight.hobbsStart || 0,\n        hobbsEnd: flight.hobbsStart || 0,\n        notes: '',\n      });\n    } catch (error) {\n      console.error('Error submitting flight:', error);\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  const renderStep = () => {\n    switch (step) {\n      case 1: // Review\n        return (\n          <div className=\"space-y-6\">\n            <div className=\"text-center\">\n              <h3 className=\"text-xl font-semibold mb-2\">How did the flight go?</h3>\n              <p className=\"text-muted-foreground\">Let us know about your experience</p>\n            </div>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <button\n                onClick={() => setData({ ...data, wentWell: true })}\n                className={`p-6 rounded-xl border-2 transition-all ${\n                  data.wentWell \n                    ? 'border-green-500 bg-green-500/10' \n                    : 'border-border hover:border-green-500/50'\n                }`}\n              >\n                <CheckCircle className=\"h-12 w-12 mx-auto mb-3 text-green-500\" />\n                <div className=\"font-semibold\">Everything went well</div>\n                <p className=\"text-sm text-muted-foreground mt-1\">Normal flight, no issues</p>\n              </button>\n              <button\n                onClick={() => setData({ ...data, wentWell: false })}\n                className={`p-6 rounded-xl border-2 transition-all ${\n                  !data.wentWell \n                    ? 'border-amber-500 bg-amber-500/10' \n                    : 'border-border hover:border-amber-500/50'\n                }`}\n              >\n                <AlertTriangle className=\"h-12 w-12 mx-auto mb-3 text-amber-500\" />\n                <div className=\"font-semibold\">Had some issues</div>\n                <p className=\"text-sm text-muted-foreground mt-1\">Report any problems</p>\n              </button>\n            </div>\n          </div>\n        );\n\n      case 2: // Details\n        return (\n          <div className=\"space-y-6\">\n            <div className=\"text-center\">\n              <h3 className=\"text-xl font-semibold mb-2\">Flight Details</h3>\n              <p className=\"text-muted-foreground\">Verify and update flight information</p>\n            </div>\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center gap-3 p-3 rounded-lg bg-muted\">\n                <Plane className=\"h-5 w-5 text-muted-foreground\" />\n                <span className=\"font-medium\">{flight.aircraftName}</span>\n              </div>\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label>Hobbs Start</Label>\n                  <Input \n                    type=\"number\" \n                    step=\"0.1\"\n                    value={data.hobbsStart}\n                    onChange={(e) => setData({ ...data, hobbsStart: parseFloat(e.target.value) || 0 })}\n                  />\n                </div>\n                <div>\n                  <Label>Hobbs End</Label>\n                  <Input \n                    type=\"number\" \n                    step=\"0.1\"\n                    value={data.hobbsEnd}\n                    onChange={(e) => setData({ ...data, hobbsEnd: parseFloat(e.target.value) || 0 })}\n                  />\n                </div>\n              </div>\n              <div>\n                <Label>Tach Time (optional)</Label>\n                <Input \n                  type=\"number\" \n                  step=\"0.1\"\n                  value={data.tachTime || ''}\n                  onChange={(e) => setData({ ...data, tachTime: parseFloat(e.target.value) || undefined })}\n                  placeholder=\"Tach time\"\n                />\n              </div>\n              <div>\n                <Label>Notes</Label>\n                <Textarea \n                  value={data.notes}\n                  onChange={(e) => setData({ ...data, notes: e.target.value })}\n                  placeholder=\"Any notes about the flight...\"\n                  rows={3}\n                />\n              </div>\n            </div>\n          </div>\n        );\n\n      case 3: // Fuel\n        return (\n          <div className=\"space-y-6\">\n            <div className=\"text-center\">\n              <h3 className=\"text-xl font-semibold mb-2\">Fuel Added</h3>\n              <p className=\"text-muted-foreground\">Submit fuel expenses for reimbursement (requires admin approval)</p>\n            </div>\n            <div className=\"space-y-4\">\n              <div>\n                <Label>Gallons Added</Label>\n                <Input \n                  type=\"number\" \n                  step=\"0.1\"\n                  value={data.fuelGallons || ''}\n                  onChange={(e) => setData({ ...data, fuelGallons: parseFloat(e.target.value) || undefined })}\n                  placeholder=\"0.0\"\n                />\n              </div>\n              <div>\n                <Label>Price per Gallon ($)</Label>\n                <Input \n                  type=\"number\" \n                  step=\"0.01\"\n                  value={data.fuelPricePerGallon || ''}\n                  onChange={(e) => setData({ ...data, fuelPricePerGallon: parseFloat(e.target.value) || undefined })}\n                  placeholder=\"0.00\"\n                />\n              </div>\n              {data.fuelGallons && data.fuelPricePerGallon && (\n                <div className=\"p-3 rounded-lg bg-muted\">\n                  <div className=\"text-sm text-muted-foreground\">Estimated Total</div>\n                  <div className=\"text-2xl font-bold\">${(data.fuelGallons * data.fuelPricePerGallon).toFixed(2)}</div>\n                </div>\n              )}\n              <div>\n                <Label>Notes (optional)</Label>\n                <Input \n                  value={data.fuelNotes || ''}\n                  onChange={(e) => setData({ ...data, fuelNotes: e.target.value })}\n                  placeholder=\"Fuel type, location, etc.\"\n                />\n              </div>\n              <p className=\"text-xs text-muted-foreground\">\n                ðŸ’¡ Fuel expenses will be submitted for admin approval\n              </p>\n            </div>\n          </div>\n        );\n\n      case 4: // Issues\n        return (\n          <div className=\"space-y-6\">\n            <div className=\"text-center\">\n              <h3 className=\"text-xl font-semibold mb-2\">Any Aircraft Issues?</h3>\n              <p className=\"text-muted-foreground\">Did you notice any problems with the aircraft?</p>\n            </div>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <button\n                onClick={() => {\n                  setData({ ...data, hasIssues: false });\n                  handleNext();\n                }}\n                className=\"p-6 rounded-xl border-2 border-border hover:border-green-500/50 transition-all\"\n              >\n                <CheckCircle className=\"h-12 w-12 mx-auto mb-3 text-green-500\" />\n                <div className=\"font-semibold\">No issues</div>\n                <p className=\"text-sm text-muted-foreground mt-1\">Aircraft is good to go</p>\n              </button>\n              <button\n                onClick={() => setData({ ...data, hasIssues: true })}\n                className=\"p-6 rounded-xl border-2 border-border hover:border-amber-500/50 transition-all\"\n              >\n                <Wrench className=\"h-12 w-12 mx-auto mb-3 text-amber-500\" />\n                <div className=\"font-semibold\">Yes, report issue</div>\n                <p className=\"text-sm text-muted-foreground mt-1\">Document any problems</p>\n              </button>\n            </div>\n          </div>\n        );\n\n      case 5: // Issue Type\n        if (!data.hasIssues) {\n          // Skip to submit\n          return null;\n        }\n        return (\n          <div className=\"space-y-3\">\n            <div className=\"text-center pb-1\">\n              <h3 className=\"text-lg font-semibold\">What type of issue?</h3>\n              <p className=\"text-sm text-muted-foreground\">Select category</p>\n            </div>\n            <ScrollArea className=\"h-[200px] pr-2\">\n              <div className=\"grid grid-cols-2 gap-2\">\n                {MAINTENANCE_CATEGORIES.map((cat) => (\n                  <button\n                    key={cat.value}\n                    onClick={() => setData({ \n                      ...data, \n                      issueType: 'GENERIC', \n                      category: cat.value,\n                      severity: cat.severity,\n                      isPlaneSpecific: false\n                    })}\n                    className={`p-3 rounded-lg border-2 transition-all text-left ${\n                      data.category === cat.value\n                        ? 'border-primary bg-primary/10'\n                        : 'border-border hover:border-primary/50'\n                    }`}\n                  >\n                    <div className=\"text-lg mb-1\">{cat.icon}</div>\n                    <div className=\"font-medium text-sm\">{cat.label}</div>\n                    <Badge variant={cat.severity === 'HIGH' ? 'destructive' : cat.severity === 'MEDIUM' ? 'default' : 'secondary'} className=\"mt-1 text-[10px]\">\n                      {cat.severity}\n                    </Badge>\n                  </button>\n                ))}\n                <button\n                  onClick={() => setData({ \n                    ...data, \n                    issueType: 'PLANE_SPECIFIC', \n                    category: 'OTHER',\n                    severity: 'MEDIUM',\n                    isPlaneSpecific: true\n                  })}\n                  className={`p-3 rounded-lg border-2 transition-all text-left ${\n                    data.category === 'OTHER'\n                      ? 'border-primary bg-primary/10'\n                      : 'border-border hover:border-primary/50'\n                  }`}\n                >\n                  <div className=\"text-lg mb-1\">ðŸ“</div>\n                  <div className=\"font-medium text-sm\">Other</div>\n                  <Badge variant=\"outline\" className=\"mt-1 text-[10px]\">Specific</Badge>\n                </button>\n              </div>\n              {data.category && (\n                <div className=\"mt-3\">\n                  <Label className=\"text-xs\">Description</Label>\n                  <Textarea \n                    value={data.issueDescription || ''}\n                    onChange={(e) => setData({ ...data, issueDescription: e.target.value })}\n                    placeholder=\"Describe the issue...\"\n                    rows={2}\n                    className=\"text-sm\"\n                  />\n                </div>\n              )}\n            </ScrollArea>\n          </div>\n        );\n\n      case 5: // Issue Type or Summary\n        if (!data.hasIssues) {\n          // Show summary and submit\n          return (\n            <div className=\"space-y-4\">\n              <div className=\"text-center pb-2\">\n                <h3 className=\"text-lg font-semibold\">Review & Submit</h3>\n                <p className=\"text-sm text-muted-foreground\">Verify and submit</p>\n              </div>\n              <div className=\"space-y-2 text-sm\">\n                <div className=\"flex justify-between p-2 rounded bg-muted\">\n                  <span className=\"text-muted-foreground\">Flight</span>\n                  <Badge variant={data.wentWell ? 'default' : 'destructive'}>\n                    {data.wentWell ? 'Good' : 'Issues'}\n                  </Badge>\n                </div>\n                <div className=\"flex justify-between p-2 rounded bg-muted\">\n                  <span className=\"text-muted-foreground\">Hobbs</span>\n                  <span>{data.hobbsStart} - {data.hobbsEnd} ({(data.hobbsEnd - data.hobbsStart).toFixed(1)}h)</span>\n                </div>\n                {data.fuelGallons && (\n                  <div className=\"flex justify-between p-2 rounded bg-muted\">\n                    <span className=\"text-muted-foreground\">Fuel</span>\n                    <span>{data.fuelGallons} gal</span>\n                  </div>\n                )}\n                <div className=\"flex justify-between p-2 rounded bg-muted\">\n                  <span className=\"text-muted-foreground\">Issues</span>\n                  <Badge variant=\"secondary\">None</Badge>\n                </div>\n              </div>\n            </div>\n          );\n        }\n\n        // Has issues - show issue type selection\n        return (\n          <div className=\"space-y-3\">\n            <div className=\"text-center pb-1\">\n              <h3 className=\"text-lg font-semibold\">What type of issue?</h3>\n              <p className=\"text-sm text-muted-foreground\">Select category</p>\n            </div>\n            <ScrollArea className=\"h-[180px] pr-2\">\n              <div className=\"grid grid-cols-2 gap-2\">\n                {MAINTENANCE_CATEGORIES.map((cat) => (\n                  <button\n                    key={cat.value}\n                    onClick={() => setData({ \n                      ...data, \n                      issueType: 'GENERIC', \n                      category: cat.value,\n                      severity: cat.severity,\n                      isPlaneSpecific: false\n                    })}\n                    className={`p-3 rounded-lg border-2 transition-all text-left ${\n                      data.category === cat.value\n                        ? 'border-primary bg-primary/10'\n                        : 'border-border hover:border-primary/50'\n                    }`}\n                  >\n                    <div className=\"text-lg mb-1\">{cat.icon}</div>\n                    <div className=\"font-medium text-sm\">{cat.label}</div>\n                    <Badge variant={cat.severity === 'HIGH' ? 'destructive' : cat.severity === 'MEDIUM' ? 'default' : 'secondary'} className=\"mt-1 text-[10px]\">\n                      {cat.severity}\n                    </Badge>\n                  </button>\n                ))}\n                <button\n                  onClick={() => setData({ \n                    ...data, \n                    issueType: 'PLANE_SPECIFIC', \n                    category: 'OTHER',\n                    severity: 'MEDIUM',\n                    isPlaneSpecific: true\n                  })}\n                  className={`p-3 rounded-lg border-2 transition-all text-left ${\n                    data.category === 'OTHER'\n                      ? 'border-primary bg-primary/10'\n                      : 'border-border hover:border-primary/50'\n                  }`}\n                >\n                  <div className=\"text-lg mb-1\">ðŸ“</div>\n                  <div className=\"font-medium text-sm\">Other</div>\n                  <Badge variant=\"outline\" className=\"mt-1 text-[10px]\">Specific</Badge>\n                </button>\n              </div>\n              {data.category && (\n                <div className=\"mt-3\">\n                  <Label className=\"text-xs\">Description</Label>\n                  <Textarea \n                    value={data.issueDescription || ''}\n                    onChange={(e) => setData({ ...data, issueDescription: e.target.value })}\n                    placeholder=\"Describe the issue...\"\n                    rows={2}\n                    className=\"text-sm\"\n                  />\n                </div>\n              )}\n            </ScrollArea>\n          </div>\n        );\n\n      default:\n        return null;\n    }\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-hidden flex flex-col\">\n        <DialogHeader className=\"shrink-0 pb-2\">\n          <DialogTitle className=\"text-lg\">Complete Flight</DialogTitle>\n          <DialogDescription className=\"text-xs\">\n            Step {showSummaryStep ? '5 (Summary)' : step} of {totalSteps}\n          </DialogDescription>\n        </DialogHeader>\n        \n        {/* Progress */}\n        <div className=\"flex gap-1 mb-2\">\n          {[1, 2, 3, 4, 5].map((s) => (\n            <div \n              key={s} \n              className={`h-1 flex-1 rounded ${\n                s <= step ? 'bg-primary' : 'bg-muted'\n              }`}\n            />\n          ))}\n        </div>\n\n        <div className=\"flex-1 overflow-y-auto pr-1\">\n          {renderStep()}\n        </div>\n\n        {/* Navigation */}\n        <div className=\"flex justify-between pt-2 border-t shrink-0\">\n          <Button \n            variant=\"outline\" \n            size=\"sm\"\n            onClick={handleBack}\n            disabled={step === 1}\n          >\n            <ChevronLeft className=\"h-4 w-4 mr-1\" /> Back\n          </Button>\n          \n          {step < 5 ? (\n            <Button size=\"sm\" onClick={handleNext}>\n              Next <ChevronRight className=\"h-4 w-4 ml-1\" />\n            </Button>\n          ) : (\n            <Button \n              size=\"sm\" \n              onClick={handleSubmit} \n              disabled={submitting || (data.hasIssues && !data.category)}\n            >\n              {submitting ? '...' : 'Submit'} <Send className=\"h-4 w-4 ml-1\" />\n            </Button>\n          )}\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\global-nav.backup.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\global-nav.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\landing\\categories-section.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\landing\\featured-listings.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\landing\\footer-section.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\landing\\hero-section.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\landing\\landing-navbar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\landing\\sell-cta-section.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\landing\\testimonials-section.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\landing\\why-section.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'i' is defined but never used.","line":58,"column":36,"nodeType":"Identifier","messageId":"unusedVar","endLine":58,"endColumn":37}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Lock, Eye, Shield, Database } from \"lucide-react\"\n\nconst trustItems = [\n  {\n    icon: Lock,\n    title: \"End-to-End Encrypted\",\n    description: \"Messages and sensitive data are encrypted. We store only encrypted blobs -- even we can't read them.\",\n  },\n  {\n    icon: Eye,\n    title: \"Your Plans Stay Private\",\n    description: \"Flight plans, routes, and personal data are never shared, sold, or used for advertising. Period.\",\n  },\n  {\n    icon: Shield,\n    title: \"Community Fuel Prices\",\n    description: \"Fuel prices you share are public to help the community. Everything else is yours and yours alone.\",\n  },\n  {\n    icon: Database,\n    title: \"You Own Your Data\",\n    description: \"Export everything at any time. Delete your account and all data is permanently removed within 48 hours.\",\n  },\n]\n\nexport function WhySection() {\n  return (\n    <section id=\"privacy\" className=\"py-20 lg:py-28\">\n      <div className=\"mx-auto max-w-7xl px-4 lg:px-8\">\n        <div className=\"grid items-center gap-14 lg:grid-cols-2\">\n          {/* Left: Message */}\n          <div>\n            <p className=\"text-sm font-semibold uppercase tracking-wider text-primary\">\n              Privacy & Trust\n            </p>\n            <h2 className=\"mt-2 text-3xl font-bold tracking-tight text-foreground lg:text-4xl text-balance\">\n              Your data is yours. Full stop.\n            </h2>\n            <p className=\"mt-4 text-muted-foreground leading-relaxed\">\n              We built AviationHub the way we{\"'\"}d want it as pilots ourselves:\n              private by default, transparent about what{\"'\"}s shared, and always in your control.\n            </p>\n\n            {/* Inline code-style trust badge */}\n            <div className=\"mt-8 inline-flex items-center gap-3 rounded-xl border border-primary/20 bg-primary/5 px-5 py-3\">\n              <Lock className=\"h-5 w-5 text-primary\" />\n              <div>\n                <p className=\"text-sm font-semibold text-foreground\">Zero-knowledge architecture</p>\n                <p className=\"text-xs text-muted-foreground\">\n                  We can{\"'\"}t read your data even if we wanted to\n                </p>\n              </div>\n            </div>\n          </div>\n\n          {/* Right: Trust Cards */}\n          <div className=\"grid gap-4 sm:grid-cols-2\">\n            {trustItems.map((item, i) => (\n              <div\n                key={item.title}\n                className=\"group rounded-xl border border-border bg-card p-5 transition-all duration-300 hover:border-primary/30\"\n              >\n                <div className=\"flex h-10 w-10 items-center justify-center rounded-lg bg-primary/10 text-primary transition-colors group-hover:bg-primary group-hover:text-primary-foreground\">\n                  <item.icon className=\"h-5 w-5\" />\n                </div>\n                <h3 className=\"mt-4 text-sm font-semibold text-foreground\">{item.title}</h3>\n                <p className=\"mt-1.5 text-xs text-muted-foreground leading-relaxed\">{item.description}</p>\n              </div>\n            ))}\n          </div>\n        </div>\n      </div>\n    </section>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\listing-form\\form-section.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\listing-form\\image-upload.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":85,"column":15,"nodeType":"JSXOpeningElement","endLine":89,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { useRef, useState } from \"react\"\nimport { ImagePlus, X, GripVertical } from \"lucide-react\"\n\ninterface ImageUploadProps {\n  images: string[]\n  onImagesChange: (images: string[]) => void\n}\n\nexport function ImageUpload({ images, onImagesChange }: ImageUploadProps) {\n  const fileInputRef = useRef<HTMLInputElement>(null)\n  const [dragOver, setDragOver] = useState(false)\n\n  function handleFiles(files: FileList | null) {\n    if (!files) return\n    const newImages: string[] = []\n    Array.from(files).forEach((file) => {\n      if (file.type.startsWith(\"image/\")) {\n        const url = URL.createObjectURL(file)\n        newImages.push(url)\n      }\n    })\n    onImagesChange([...images, ...newImages])\n  }\n\n  function removeImage(index: number) {\n    const updated = images.filter((_, i) => i !== index)\n    onImagesChange(updated)\n  }\n\n  return (\n    <div className=\"flex flex-col gap-3\">\n      <div\n        className={`\n          relative flex flex-col items-center justify-center gap-3 rounded-lg border-2 border-dashed \n          p-10 transition-all duration-300 cursor-pointer\n          ${\n            dragOver\n              ? \"border-primary bg-primary/5\"\n              : \"border-border bg-secondary/30 hover:border-primary/50 hover:bg-secondary/60\"\n          }\n        `}\n        onClick={() => fileInputRef.current?.click()}\n        onDragOver={(e) => { e.preventDefault(); setDragOver(true) }}\n        onDragLeave={() => setDragOver(false)}\n        onDrop={(e) => {\n          e.preventDefault()\n          setDragOver(false)\n          handleFiles(e.dataTransfer.files)\n        }}\n        role=\"button\"\n        tabIndex={0}\n        onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") fileInputRef.current?.click() }}\n        aria-label=\"Upload aircraft images\"\n      >\n        <div className=\"flex size-12 items-center justify-center rounded-full bg-primary/10\">\n          <ImagePlus className=\"size-6 text-primary\" />\n        </div>\n        <div className=\"flex flex-col items-center gap-1\">\n          <p className=\"text-sm font-medium text-foreground\">\n            Drop images here or click to browse\n          </p>\n          <p className=\"text-xs text-muted-foreground\">\n            PNG, JPG up to 10MB each. First image will be the cover.\n          </p>\n        </div>\n        <input\n          ref={fileInputRef}\n          type=\"file\"\n          accept=\"image/*\"\n          multiple\n          className=\"hidden\"\n          onChange={(e) => handleFiles(e.target.files)}\n        />\n      </div>\n\n      {images.length > 0 && (\n        <div className=\"grid grid-cols-2 gap-3 sm:grid-cols-3 lg:grid-cols-4\">\n          {images.map((src, index) => (\n            <div\n              key={`${src}-${index}`}\n              className=\"group relative aspect-[4/3] overflow-hidden rounded-lg border border-border bg-secondary\"\n            >\n              <img\n                src={src}\n                alt={`Aircraft image ${index + 1}`}\n                className=\"size-full object-cover\"\n              />\n              <div className=\"absolute inset-0 bg-background/60 opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex items-center justify-center gap-2\">\n                <GripVertical className=\"size-4 text-muted-foreground\" />\n              </div>\n              <button\n                type=\"button\"\n                onClick={() => removeImage(index)}\n                className=\"absolute top-1.5 right-1.5 flex size-6 items-center justify-center rounded-full bg-background/80 text-foreground opacity-0 group-hover:opacity-100 transition-opacity duration-200 hover:bg-destructive hover:text-destructive-foreground\"\n                aria-label={`Remove image ${index + 1}`}\n              >\n                <X className=\"size-3.5\" />\n              </button>\n              {index === 0 && (\n                <span className=\"absolute bottom-1.5 left-1.5 rounded-full bg-primary/90 px-2 py-0.5 text-[10px] font-medium text-primary-foreground\">\n                  Cover\n                </span>\n              )}\n            </div>\n          ))}\n        </div>\n      )}\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\listing-form\\listing-form.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\listing-form\\tag-input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\modules\\DataTable.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useState' is defined but never used.","line":19,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":18,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"useState"},"fix":{"range":[408,417],"text":""},"desc":"Remove unused variable \"useState\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useMemo' is defined but never used.","line":19,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":27,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"useMemo"},"fix":{"range":[416,425],"text":""},"desc":"Remove unused variable \"useMemo\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * @fileoverview DataTable component\n * @description A sortable, paginated data table component\n * \n * @example\n * ```tsx\n * <DataTable\n *   columns={[\n *     { key: 'name', header: 'Name', sortable: true },\n *     { key: 'date', header: 'Date', sortable: true },\n *   ]}\n *   data={items}\n *   onSort={(key, dir) => {}}\n *   pagination={{ page: 1, total: 100, pageSize: 10 }}\n * />\n * ```\n */\n\nimport { useState, useMemo, ReactNode } from 'react'\nimport { ChevronUp, ChevronDown } from 'lucide-react'\nimport { Button } from '@/components/ui/button'\n\n/**\n * Column configuration\n */\ninterface Column<T> {\n  /** Unique key for the column */\n  key: string\n  /** Header label */\n  header: string\n  /** Whether column is sortable */\n  sortable?: boolean\n  /** Custom render function */\n  render?: (item: T) => ReactNode\n  /** Column width */\n  width?: string\n  /** Text alignment */\n  align?: 'left' | 'center' | 'right'\n}\n\n/**\n * Pagination configuration\n */\ninterface Pagination {\n  /** Current page number (1-indexed) */\n  page: number\n  /** Total number of items */\n  total: number\n  /** Number of items per page */\n  pageSize: number\n}\n\n/**\n * Sort configuration\n */\ninterface SortConfig {\n  /** Column key to sort by */\n  key: string\n  /** Sort direction */\n  direction: 'asc' | 'desc'\n}\n\n/**\n * Props for DataTable component\n */\ninterface DataTableProps<T> {\n  /** Column definitions */\n  columns: Column<T>[]\n  /** Data items to display */\n  data: T[]\n  /** Sort configuration */\n  sort?: SortConfig\n  /** Callback when sort changes */\n  onSort?: (key: string, direction: 'asc' | 'desc') => void\n  /** Pagination configuration */\n  pagination?: Pagination\n  /** Callback when page changes */\n  onPageChange?: (page: number) => void\n  /** Callback when row is clicked */\n  onRowClick?: (item: T) => void\n  /** Show header row */\n  showHeader?: boolean\n  /** Empty state message */\n  emptyMessage?: string\n  /** Additional className */\n  className?: string\n}\n\n/**\n * DataTable - Sortable, paginated table component\n * Provides consistent table UI across modules\n */\nexport default function DataTable<T extends Record<string, unknown>>({\n  columns,\n  data,\n  sort,\n  onSort,\n  pagination,\n  onPageChange,\n  onRowClick,\n  showHeader = true,\n  emptyMessage = 'No data available',\n  className = ''\n}: DataTableProps<T>) {\n  const totalPages = pagination ? Math.ceil(pagination.total / pagination.pageSize) : 1\n\n  const handleSort = (key: string) => {\n    if (!onSort) return\n    \n    const newDirection = sort?.key === key && sort.direction === 'asc' ? 'desc' : 'asc'\n    onSort(key, newDirection)\n  }\n\n  const renderCell = (item: T, column: Column<T>) => {\n    if (column.render) {\n      return column.render(item)\n    }\n    return String(item[column.key] ?? '-')\n  }\n\n  const alignClass = (align?: 'left' | 'center' | 'right') => {\n    switch (align) {\n      case 'center': return 'text-center'\n      case 'right': return 'text-right'\n      default: return 'text-left'\n    }\n  }\n\n  return (\n    <div className={className}>\n      {/* Table */}\n      <div className=\"border border-border rounded-lg overflow-hidden\">\n        <div className=\"overflow-x-auto\">\n          <table className=\"w-full\">\n            {/* Header */}\n            {showHeader && (\n              <thead className=\"bg-muted/50 border-b border-border\">\n                <tr>\n                  {columns.map((column) => (\n                    <th\n                      key={column.key}\n                      className={`\n                        px-4 py-3 text-xs font-semibold uppercase tracking-wider text-muted-foreground\n                        ${column.sortable ? 'cursor-pointer hover:text-foreground' : ''}\n                        ${alignClass(column.align)}\n                        ${column.width || ''}\n                      `}\n                      onClick={() => column.sortable && handleSort(column.key)}\n                      style={column.width ? { width: column.width } : undefined}\n                    >\n                      <div className={`flex items-center gap-1 ${column.align === 'right' ? 'justify-end' : column.align === 'center' ? 'justify-center' : ''}`}>\n                        {column.header}\n                        {column.sortable && sort?.key === column.key && (\n                          sort.direction === 'asc' \n                            ? <ChevronUp className=\"h-3 w-3\" />\n                            : <ChevronDown className=\"h-3 w-3\" />\n                        )}\n                      </div>\n                    </th>\n                  ))}\n                </tr>\n              </thead>\n            )}\n\n            {/* Body */}\n            <tbody className=\"divide-y divide-border\">\n              {data.length === 0 ? (\n                <tr>\n                  <td\n                    colSpan={columns.length}\n                    className=\"px-4 py-8 text-center text-muted-foreground\"\n                  >\n                    {emptyMessage}\n                  </td>\n                </tr>\n              ) : (\n                data.map((item, index) => (\n                  <tr\n                    key={index}\n                    className={`\n                      hover:bg-muted/50 transition-colors\n                      ${onRowClick ? 'cursor-pointer' : ''}\n                    `}\n                    onClick={() => onRowClick?.(item)}\n                  >\n                    {columns.map((column) => (\n                      <td\n                        key={column.key}\n                        className={`px-4 py-3 text-sm ${alignClass(column.align)}`}\n                      >\n                        {renderCell(item, column)}\n                      </td>\n                    ))}\n                  </tr>\n                ))\n              )}\n            </tbody>\n          </table>\n        </div>\n      </div>\n\n      {/* Pagination */}\n      {pagination && totalPages > 1 && (\n        <div className=\"flex items-center justify-between px-4 py-3 border-t border-border bg-card\">\n          <div className=\"text-sm text-muted-foreground\">\n            Showing {((pagination.page - 1) * pagination.pageSize) + 1} to{' '}\n            {Math.min(pagination.page * pagination.pageSize, pagination.total)} of{' '}\n            {pagination.total} results\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              disabled={pagination.page <= 1}\n              onClick={() => onPageChange?.(pagination.page - 1)}\n            >\n              Previous\n            </Button>\n            <span className=\"text-sm text-muted-foreground px-2\">\n              Page {pagination.page} of {totalPages}\n            </span>\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              disabled={pagination.page >= totalPages}\n              onClick={() => onPageChange?.(pagination.page + 1)}\n            >\n              Next\n            </Button>\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\modules\\EmptyState.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\modules\\FilterBar.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ReactNode' is defined but never used.","line":17,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":17,"endColumn":19,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"ReactNode"},"fix":{"range":[347,381],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FilterType' is defined but never used.","line":26,"column":6,"nodeType":"Identifier","messageId":"unusedVar","endLine":26,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * @fileoverview FilterBar component\n * @description A flexible filter bar with common filter controls\n * \n * @example\n * ```tsx\n * <FilterBar\n *   filters={[\n *     { type: 'select', label: 'Status', options: [...], value, onChange },\n *     { type: 'date', label: 'From', value, onChange },\n *   ]}\n *   onReset={() => {}}\n * />\n * ```\n */\n\nimport { ReactNode } from 'react'\nimport { X } from 'lucide-react'\nimport { Input } from '@/components/ui/input'\nimport { Button } from '@/components/ui/button'\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'\n\n/**\n * Filter configuration types\n */\ntype FilterType = 'select' | 'date' | 'text' | 'number' | 'daterange'\n\ninterface BaseFilter {\n  id: string\n  label: string\n  placeholder?: string\n}\n\ninterface SelectFilter extends BaseFilter {\n  type: 'select'\n  options: { value: string; label: string }[]\n}\n\ninterface DateFilter extends BaseFilter {\n  type: 'date'\n}\n\ninterface TextFilter extends BaseFilter {\n  type: 'text'\n}\n\ninterface NumberFilter extends BaseFilter {\n  type: 'number'\n  min?: number\n  max?: number\n}\n\ntype FilterConfig = SelectFilter | DateFilter | TextFilter | NumberFilter\n\n/**\n * Props for FilterBar component\n */\ninterface FilterBarProps {\n  /** Array of filter configurations */\n  filters: FilterConfig[]\n  /** Current filter values */\n  values: Record<string, string | number | undefined>\n  /** Callbacks for filter changes */\n  onChange: (id: string, value: string | number | undefined) => void\n  /** Reset all filters */\n  onReset?: () => void\n  /** Show reset button */\n  showReset?: boolean\n  /** Additional className */\n  className?: string\n  /** Layout direction */\n  direction?: 'horizontal' | 'vertical'\n}\n\n/**\n * FilterBar - Common filter controls for module pages\n * Supports select, date, text, and number filters\n */\nexport default function FilterBar({\n  filters,\n  values,\n  onChange,\n  onReset,\n  showReset = true,\n  className = '',\n  direction = 'horizontal'\n}: FilterBarProps) {\n  const hasActiveFilters = filters.some(f => values[f.id])\n\n  const renderFilter = (filter: FilterConfig) => {\n    const value = values[filter.id]\n\n    switch (filter.type) {\n      case 'select':\n        return (\n          <Select\n            value={value as string || ''}\n            onValueChange={(newValue) => onChange(filter.id, newValue || undefined)}\n          >\n            <SelectTrigger className=\"w-[180px]\">\n              <SelectValue placeholder={filter.placeholder || filter.label} />\n            </SelectTrigger>\n            <SelectContent>\n              {filter.options.map((option) => (\n                <SelectItem key={option.value} value={option.value}>\n                  {option.label}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        )\n\n      case 'date':\n        return (\n          <Input\n            type=\"date\"\n            value={value as string || ''}\n            onChange={(e) => onChange(filter.id, e.target.value || undefined)}\n            className=\"w-[180px]\"\n          />\n        )\n\n      case 'text':\n        return (\n          <Input\n            type=\"text\"\n            value={value as string || ''}\n            onChange={(e) => onChange(filter.id, e.target.value || undefined)}\n            placeholder={filter.placeholder}\n            className=\"w-[180px]\"\n          />\n        )\n\n      case 'number':\n        return (\n          <Input\n            type=\"number\"\n            min={filter.min}\n            max={filter.max}\n            value={value as string || ''}\n            onChange={(e) => onChange(filter.id, e.target.value ? Number(e.target.value) : undefined)}\n            placeholder={filter.placeholder}\n            className=\"w-[120px]\"\n          />\n        )\n\n      default:\n        return null\n    }\n  }\n\n  return (\n    <div\n      className={`\n        flex flex-wrap items-center gap-3 p-3 bg-card border border-border rounded-lg\n        ${direction === 'horizontal' ? 'flex-row' : 'flex-col'}\n        ${className}\n      `}\n    >\n      {filters.map((filter) => (\n        <div key={filter.id} className=\"flex items-center gap-2\">\n          <label className=\"text-sm text-muted-foreground whitespace-nowrap\">\n            {filter.label}:\n          </label>\n          {renderFilter(filter)}\n        </div>\n      ))}\n\n      {showReset && hasActiveFilters && onReset && (\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={onReset}\n          className=\"ml-auto\"\n        >\n          <X className=\"h-4 w-4 mr-1\" />\n          Clear Filters\n        </Button>\n      )}\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\modules\\ModuleHeader.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\modules\\ModuleTabs.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\modules\\PageContainer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\modules\\SearchBar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\modules\\StatCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\modules\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\pilot\\CurrencyBadge.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":88,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":88,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3043,3046],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3043,3046],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":89,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":89,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3062,3065],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3062,3065],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":90,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3076,3079],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3076,3079],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":91,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3094,3097],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3094,3097],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { Badge } from '@/components/ui/badge';\nimport { AlertCircle, CheckCircle, Clock } from 'lucide-react';\n\ninterface CurrencyStatus {\n  current: boolean;\n  landings?: number;\n  required?: number;\n  daysRemaining?: number;\n  expiresAt?: string;\n  description?: string;\n}\n\ninterface CurrencyBadgeProps {\n  type: 'vfrDay' | 'vfrNight' | 'bfr' | 'medical';\n  status: CurrencyStatus;\n  size?: 'sm' | 'md';\n}\n\nexport default function CurrencyBadge({ type, status, size = 'md' }: CurrencyBadgeProps) {\n  const getConfig = () => {\n    switch (type) {\n      case 'vfrDay':\n        return {\n          label: 'VFR Day',\n          icon: <Clock className=\"h-3 w-3\" />,\n          color: status.current ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200' : 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200',\n        };\n      case 'vfrNight':\n        return {\n          label: 'VFR Night',\n          icon: <Clock className=\"h-3 w-3\" />,\n          color: status.current ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200' : 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200',\n        };\n      case 'bfr':\n        return {\n          label: 'BFR',\n          icon: <Clock className=\"h-3 w-3\" />,\n          color: status.current \n            ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200'\n            : status.daysRemaining && status.daysRemaining <= 14\n              ? 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200'\n              : 'bg-amber-100 text-amber-800 dark:bg-amber-900 dark:text-amber-200',\n        };\n      case 'medical':\n        return {\n          label: 'Medical',\n          icon: <Clock className=\"h-3 w-3\" />,\n          color: status.current \n            ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200'\n            : status.daysRemaining && status.daysRemaining <= 7\n              ? 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200'\n              : 'bg-amber-100 text-amber-800 dark:bg-amber-900 dark:text-amber-200',\n        };\n      default:\n        return { label: type, icon: null, color: 'bg-gray-100' };\n    }\n  };\n\n  const config = getConfig();\n\n  const getStatusText = () => {\n    if (type === 'vfrDay' || type === 'vfrNight') {\n      return `${status.landings || 0}/${status.required || 3}`;\n    }\n    if (status.daysRemaining !== undefined) {\n      return `${status.daysRemaining}d`;\n    }\n    return status.current ? 'Current' : 'Expired';\n  };\n\n  return (\n    <div className={`inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full ${config.color} ${size === 'sm' ? 'text-xs' : 'text-sm'}`}>\n      {config.icon}\n      <span className=\"font-medium\">{config.label}:</span>\n      <span>{getStatusText()}</span>\n      {!status.current && status.daysRemaining !== undefined && status.daysRemaining <= 60 && (\n        <AlertCircle className=\"h-3 w-3 ml-1\" />\n      )}\n    </div>\n  );\n}\n\n// Dashboard widget showing all currency statuses\ninterface CurrencyWidgetProps {\n  currency: {\n    vfrDay: any;\n    vfrNight: any;\n    bfr: any;\n    medical: any;\n  };\n}\n\nexport function CurrencyWidget({ currency }: CurrencyWidgetProps) {\n  const allCurrent = \n    currency.vfrDay?.current &&\n    currency.vfrNight?.current &&\n    (currency.bfr?.current !== false) &&\n    (currency.medical?.current !== false);\n\n  return (\n    <div className=\"space-y-3\">\n      <div className=\"flex items-center justify-between\">\n        <h3 className=\"font-medium\">Currency Status</h3>\n        {allCurrent ? (\n          <Badge variant=\"secondary\" className=\"bg-green-100 text-green-800\">\n            <CheckCircle className=\"h-3 w-3 mr-1\" />\n            All Current\n          </Badge>\n        ) : (\n          <Badge variant=\"secondary\" className=\"bg-amber-100 text-amber-800\">\n            <AlertCircle className=\"h-3 w-3 mr-1\" />\n            Attention Needed\n          </Badge>\n        )}\n      </div>\n      \n      <div className=\"flex flex-wrap gap-2\">\n        {currency.vfrDay && (\n          <CurrencyBadge type=\"vfrDay\" status={currency.vfrDay} size=\"sm\" />\n        )}\n        {currency.vfrNight && (\n          <CurrencyBadge type=\"vfrNight\" status={currency.vfrNight} size=\"sm\" />\n        )}\n        {currency.bfr && (\n          <CurrencyBadge type=\"bfr\" status={currency.bfr} size=\"sm\" />\n        )}\n        {currency.medical && (\n          <CurrencyBadge type=\"medical\" status={currency.medical} size=\"sm\" />\n        )}\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\pilot\\DashboardStats.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":24,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[538,541],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[538,541],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":25,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[561,564],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[561,564],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[578,581],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[578,581],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":27,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[592,595],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[592,595],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'userId' is defined but never used.","line":30,"column":42,"nodeType":"Identifier","messageId":"unusedVar","endLine":30,"endColumn":48}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useEffect, useState } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Plane, Clock, Sun, Cloud, DollarSign, Calendar } from 'lucide-react';\n\ninterface DashboardStatsProps {\n  userId?: string;\n}\n\ninterface DashboardData {\n  user?: {\n    name?: string;\n    email?: string;\n    credits?: number;\n  };\n  totals: {\n    totalTime: number;\n    soloTime: number;\n    nightTime: number;\n    instrumentTime: number;\n    crossCountryTime: number;\n  };\n  recentFlights: any[];\n  activeFlight: any;\n  currency: any;\n  clubs: any[];\n}\n\nexport default function DashboardStats({ userId }: DashboardStatsProps) {\n  const [data, setData] = useState<DashboardData | null>(null);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    fetchDashboard();\n  }, []);\n\n  const fetchDashboard = async () => {\n    try {\n      const res = await fetch('/api/me/dashboard');\n      if (res.ok) {\n        const json = await res.json();\n        setData(json);\n      }\n    } catch (err) {\n      console.error('Failed to fetch dashboard:', err);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      <Card>\n        <CardContent className=\"py-8 text-center text-muted-foreground\">\n          Loading dashboard...\n        </CardContent>\n      </Card>\n    );\n  }\n\n  if (!data) {\n    return null;\n  }\n\n  const credits = data.user?.credits ?? 0;\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Time Totals */}\n      <Card>\n        <CardHeader className=\"pb-3\">\n          <CardTitle className=\"text-base flex items-center gap-2\">\n            <Clock className=\"h-4 w-4\" />\n            Flight Time Totals\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-2 md:grid-cols-5 gap-4\">\n            <div className=\"text-center\">\n              <p className=\"text-2xl font-bold\">{data.totals.totalTime.toFixed(1)}</p>\n              <p className=\"text-xs text-muted-foreground\">Total Hours</p>\n            </div>\n            <div className=\"text-center\">\n              <p className=\"text-2xl font-bold text-blue-600\">{data.totals.soloTime.toFixed(1)}</p>\n              <p className=\"text-xs text-muted-foreground\">Solo</p>\n            </div>\n            <div className=\"text-center\">\n              <p className=\"text-2xl font-bold text-purple-600\">{data.totals.nightTime.toFixed(1)}</p>\n              <p className=\"text-xs text-muted-foreground\">Night</p>\n            </div>\n            <div className=\"text-center\">\n              <p className=\"text-2xl font-bold text-amber-600\">{data.totals.instrumentTime.toFixed(1)}</p>\n              <p className=\"text-xs text-muted-foreground\">Instrument</p>\n            </div>\n            <div className=\"text-center\">\n              <p className=\"text-2xl font-bold text-green-600\">{data.totals.crossCountryTime.toFixed(1)}</p>\n              <p className=\"text-xs text-muted-foreground\">XC</p>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Quick Stats */}\n      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n        <Card>\n          <CardContent className=\"pt-4\">\n            <div className=\"flex items-center gap-2\">\n              <Plane className=\"h-5 w-5 text-blue-500\" />\n              <div>\n                <p className=\"text-xl font-bold\">{data.recentFlights.length}</p>\n                <p className=\"text-xs text-muted-foreground\">Recent Flights</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"pt-4\">\n            <div className=\"flex items-center gap-2\">\n              <Calendar className=\"h-5 w-5 text-green-500\" />\n              <div>\n                <p className=\"text-xl font-bold\">{data.clubs.length}</p>\n                <p className=\"text-xs text-muted-foreground\">Member Clubs</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"pt-4\">\n            <div className=\"flex items-center gap-2\">\n              <Sun className=\"h-5 w-5 text-amber-500\" />\n              <div>\n                <p className=\"text-xl font-bold\">\n                  {data.currency.vfrDay?.current ? 'Current' : 'Due'}\n                </p>\n                <p className=\"text-xs text-muted-foreground\">VFR Day</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"pt-4\">\n            <div className=\"flex items-center gap-2\">\n              <Cloud className=\"h-5 w-5 text-purple-500\" />\n              <div>\n                <p className=\"text-xl font-bold\">\n                  {data.currency.vfrNight?.current ? 'Current' : 'Due'}\n                </p>\n                <p className=\"text-xs text-muted-foreground\">VFR Night</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Active Flight Alert */}\n      {data.activeFlight && (\n        <Card className=\"border-green-500 bg-green-50 dark:bg-green-950\">\n          <CardContent className=\"pt-4\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-2\">\n                <Plane className=\"h-5 w-5 text-green-600\" />\n                <div>\n                  <p className=\"font-medium\">Aircraft Checked Out</p>\n                  <p className=\"text-sm text-muted-foreground\">\n                    {data.activeFlight.aircraft} - Hobbs: {data.activeFlight.hobbsStart}\n                  </p>\n                </div>\n              </div>\n              <a href=\"#checkout\" className=\"text-sm text-green-600 hover:underline\">\n                Check In â†’\n              </a>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Credits */}\n      {credits > 0 && (\n        <Card className=\"border-amber-500 bg-amber-50 dark:bg-amber-950\">\n          <CardContent className=\"pt-4\">\n            <div className=\"flex items-center gap-2\">\n              <DollarSign className=\"h-5 w-5 text-amber-600\" />\n              <div>\n                <p className=\"font-medium\">Account Credit</p>\n                <p className=\"text-sm text-muted-foreground\">\n                  ${credits} available\n                </p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\scheduler\\FlightScheduler.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'clubAircraft' logical expression could make the dependencies of useMemo Hook (at line 145) change on every render. Move it inside the useMemo callback. Alternatively, wrap the initialization of 'clubAircraft' in its own useMemo() Hook.","line":128,"column":9,"nodeType":"VariableDeclarator","endLine":128,"endColumn":53},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":195,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":195,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5926,5929],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5926,5929],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useEffect, useMemo, useState } from \"react\";\nimport { useSession } from \"next-auth/react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\n\ntype Group = {\n  id: string;\n  name: string;\n  aircraft: GroupAircraft[];\n};\n\ntype GroupAircraft = {\n  id: string;\n  nNumber: string;\n  nickname?: string | null;\n  make?: string | null;\n  model?: string | null;\n};\n\ntype Booking = {\n  id: string;\n  aircraftId?: string;\n  userAircraftId?: string;\n  startTime: string;\n  endTime: string;\n};\n\ntype UserAircraft = {\n  id: string;\n  nNumber: string;\n  nickname?: string | null;\n};\n\nexport function FlightScheduler({ onSuccess }: { onSuccess?: () => void }) {\n  const { data: session } = useSession();\n  const [mode, setMode] = useState<\"personal\" | \"club\">(\"personal\");\n  const [groups, setGroups] = useState<Group[]>([]);\n  const [personalAircraft, setPersonalAircraft] = useState<UserAircraft[]>([]);\n  const [clubBookings, setClubBookings] = useState<Booking[]>([]);\n  const [personalBookings, setPersonalBookings] = useState<Booking[]>([]);\n  const [groupId, setGroupId] = useState<string>(\"\");\n  const [aircraftId, setAircraftId] = useState<string>(\"\");\n  const [startTime, setStartTime] = useState<string>(\"\");\n  const [endTime, setEndTime] = useState<string>(\"\");\n  const [purpose, setPurpose] = useState<string>(\"\");\n  const [error, setError] = useState<string | null>(null);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n\n  useEffect(() => {\n    if (!session?.user?.id) return;\n    let cancelled = false;\n\n    async function loadBaseData() {\n      try {\n        const [groupsRes, personalRes] = await Promise.all([\n          fetch(\"/api/groups\"),\n          fetch(\"/api/user-aircraft\"),\n        ]);\n\n        if (groupsRes.ok) {\n          const groupData = await groupsRes.json();\n          if (!cancelled) setGroups(groupData || []);\n        }\n\n        if (personalRes.ok) {\n          const personalData = await personalRes.json();\n          if (!cancelled) setPersonalAircraft(personalData.aircraft || []);\n        }\n      } catch (err) {\n        console.error(\"Failed to load scheduler data\", err);\n      }\n    }\n\n    loadBaseData();\n    return () => {\n      cancelled = true;\n    };\n  }, [session?.user?.id]);\n\n  useEffect(() => {\n    if (mode !== \"club\" || !groupId) return;\n    let cancelled = false;\n\n    async function loadClubBookings() {\n      try {\n        const res = await fetch(`/api/groups/${groupId}/bookings`);\n        if (!res.ok) return;\n        const data = await res.json();\n        if (!cancelled) setClubBookings(Array.isArray(data) ? data : data.bookings || []);\n      } catch (err) {\n        console.error(\"Failed to load club bookings\", err);\n      }\n    }\n\n    loadClubBookings();\n    return () => {\n      cancelled = true;\n    };\n  }, [mode, groupId]);\n\n  useEffect(() => {\n    if (mode !== \"personal\") return;\n    let cancelled = false;\n\n    async function loadPersonalBookings() {\n      try {\n        const res = await fetch(\"/api/personal-bookings?days=all\");\n        if (!res.ok) return;\n        const data = await res.json();\n        if (!cancelled) setPersonalBookings(Array.isArray(data) ? data : data.bookings || []);\n      } catch (err) {\n        console.error(\"Failed to load personal bookings\", err);\n      }\n    }\n\n    loadPersonalBookings();\n    return () => {\n      cancelled = true;\n    };\n  }, [mode]);\n\n  const selectedGroup = groups.find((g) => g.id === groupId);\n  const clubAircraft = selectedGroup?.aircraft || [];\n\n  const isTimeOverlap = (aStart: string, aEnd: string, bStart: string, bEnd: string) => {\n    const startA = new Date(aStart).getTime();\n    const endA = new Date(aEnd).getTime();\n    const startB = new Date(bStart).getTime();\n    const endB = new Date(bEnd).getTime();\n    return startA < endB && endA > startB;\n  };\n\n  const availableClubAircraft = useMemo(() => {\n    if (!startTime || !endTime) return clubAircraft;\n    return clubAircraft.filter((ac) =>\n      !clubBookings.some((b) =>\n        b.aircraftId === ac.id && isTimeOverlap(startTime, endTime, b.startTime, b.endTime)\n      )\n    );\n  }, [clubAircraft, clubBookings, startTime, endTime]);\n\n  const availablePersonalAircraft = useMemo(() => {\n    if (!startTime || !endTime) return personalAircraft;\n    return personalAircraft.filter((ac) =>\n      !personalBookings.some((b) =>\n        b.userAircraftId === ac.id && isTimeOverlap(startTime, endTime, b.startTime, b.endTime)\n      )\n    );\n  }, [personalAircraft, personalBookings, startTime, endTime]);\n\n  const handleSubmit = async () => {\n    if (!session?.user?.id) {\n      setError(\"Please sign in to schedule a flight\");\n      return;\n    }\n    if (!startTime || !endTime || !aircraftId) {\n      setError(\"Aircraft, start time, and end time are required\");\n      return;\n    }\n    if (mode === \"club\" && !groupId) {\n      setError(\"Select a flying club\");\n      return;\n    }\n\n    setIsSubmitting(true);\n    setError(null);\n\n    try {\n      const endpoint = mode === \"personal\" ? \"/api/personal-bookings\" : `/api/groups/${groupId}/bookings`;\n      const payload = mode === \"personal\"\n        ? { userAircraftId: aircraftId, startTime, endTime, purpose: purpose || null }\n        : { aircraftId, startTime, endTime, purpose: purpose || null };\n\n      const res = await fetch(endpoint, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(payload),\n      });\n\n      if (!res.ok) {\n        const data = await res.json().catch(() => ({}));\n        throw new Error(data.error || \"Failed to schedule flight\");\n      }\n\n      setPurpose(\"\");\n      setAircraftId(\"\");\n      setStartTime(\"\");\n      setEndTime(\"\");\n      if (onSuccess) onSuccess();\n    } catch (err: any) {\n      setError(err.message || \"Failed to schedule flight\");\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex items-center gap-2\">\n        <Button\n          size=\"sm\"\n          variant={mode === \"personal\" ? \"default\" : \"outline\"}\n          onClick={() => setMode(\"personal\")}\n        >\n          Personal\n        </Button>\n        <Button\n          size=\"sm\"\n          variant={mode === \"club\" ? \"default\" : \"outline\"}\n          onClick={() => setMode(\"club\")}\n        >\n          Flying Club\n        </Button>\n        <Badge variant=\"outline\" className=\"ml-auto text-xs\">\n          {mode === \"personal\" ? \"Personal\" : \"Club\"}\n        </Badge>\n      </div>\n\n      {mode === \"club\" && (\n        <div className=\"space-y-2\">\n          <Label>Flying Club</Label>\n          <select\n            className=\"h-10 w-full rounded-md border border-input bg-background px-3 text-sm\"\n            value={groupId}\n            onChange={(e) => {\n              setGroupId(e.target.value);\n              setAircraftId(\"\");\n            }}\n          >\n            <option value=\"\">Select a club...</option>\n            {groups.map((group) => (\n              <option key={group.id} value={group.id}>{group.name}</option>\n            ))}\n          </select>\n        </div>\n      )}\n\n      <div className=\"grid gap-4 sm:grid-cols-2\">\n        <div className=\"space-y-2\">\n          <Label>Start Time</Label>\n          <Input type=\"datetime-local\" value={startTime} onChange={(e) => setStartTime(e.target.value)} />\n        </div>\n        <div className=\"space-y-2\">\n          <Label>End Time</Label>\n          <Input type=\"datetime-local\" value={endTime} onChange={(e) => setEndTime(e.target.value)} />\n        </div>\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label>Aircraft</Label>\n        <select\n          className=\"h-10 w-full rounded-md border border-input bg-background px-3 text-sm\"\n          value={aircraftId}\n          onChange={(e) => setAircraftId(e.target.value)}\n        >\n          <option value=\"\">Select aircraft...</option>\n          {(mode === \"personal\" ? availablePersonalAircraft : availableClubAircraft).map((ac) => (\n            <option key={ac.id} value={ac.id}>\n              {ac.nNumber}{ac.nickname ? ` (${ac.nickname})` : \"\"}\n            </option>\n          ))}\n        </select>\n        <p className=\"text-xs text-muted-foreground\">\n          {mode === \"personal\"\n            ? `${availablePersonalAircraft.length} available`\n            : `${availableClubAircraft.length} available`}\n        </p>\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label>Purpose</Label>\n        <Textarea value={purpose} onChange={(e) => setPurpose(e.target.value)} placeholder=\"Optional\" />\n      </div>\n\n      {error && <div className=\"text-sm text-destructive\">{error}</div>}\n\n      <Button onClick={handleSubmit} disabled={isSubmitting} className=\"w-full\">\n        {isSubmitting ? \"Scheduling...\" : \"Schedule Flight\"}\n      </Button>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\theme-provider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\theme-toggle.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\training\\FinancialTracker.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Badge' is defined but never used.","line":9,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":15,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Badge"},"fix":{"range":[384,430],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'GraduationCap' is defined but never used.","line":13,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":16,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"GraduationCap"},"fix":{"range":[462,480],"text":""},"desc":"Remove unused variable \"GraduationCap\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Calculator' is defined but never used.","line":14,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":13,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Calculator"},"fix":{"range":[480,495],"text":""},"desc":"Remove unused variable \"Calculator\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrendingUp' is defined but never used.","line":15,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":13,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"TrendingUp"},"fix":{"range":[495,509],"text":""},"desc":"Remove unused variable \"TrendingUp\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'goalType' is defined but never used.","line":42,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":42,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'totalHours' is assigned a value but never used.","line":43,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":43,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect, useMemo } from 'react'\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card'\nimport { Input } from '@/components/ui/input'\nimport { Label } from '@/components/ui/label'\nimport { Button } from '@/components/ui/button'\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'\nimport { Badge } from '@/components/ui/badge'\nimport { \n  DollarSign, \n  Plane, \n  GraduationCap, \n  Calculator,\n  TrendingUp,\n  Calendar,\n  CreditCard,\n  Save,\n  RefreshCw\n} from 'lucide-react'\n\ninterface Financials {\n  aircraftRate: number\n  instructorRate: number\n  checkrideFee: number\n  examFees: number\n  medicalFee: number\n  monthlyDues: number\n  equipmentCost: number\n  flightsPerMonth: number\n  avgFlightHours: number\n}\n\ninterface FinancialTrackerProps {\n  goalType?: string\n  totalHours?: number\n  hoursRemaining?: number\n  onSave?: (financials: Financials) => void\n}\n\nexport default function FinancialTracker({ \n  goalType,\n  totalHours = 0,\n  hoursRemaining = 40,\n  onSave\n}: FinancialTrackerProps) {\n  const [financials, setFinancials] = useState<Financials>({\n    aircraftRate: 0,\n    instructorRate: 0,\n    checkrideFee: 0,\n    examFees: 0,\n    medicalFee: 0,\n    monthlyDues: 0,\n    equipmentCost: 0,\n    flightsPerMonth: 0,\n    avgFlightHours: 0,\n  })\n  const [saving, setSaving] = useState(false)\n  const [loading, setLoading] = useState(true)\n  const [activeTab, setActiveTab] = useState<'inputs' | 'projections'>('inputs')\n\n  // Load financials from API\n  useEffect(() => {\n    async function loadFinancials() {\n      try {\n        const res = await fetch('/api/training/financials')\n        if (res.ok) {\n          const data = await res.json()\n          if (data) {\n            const nextFinancials = {\n              aircraftRate: Number(data.aircraftRate) || 0,\n              instructorRate: Number(data.instructorRate) || 0,\n              checkrideFee: Number(data.checkrideFee) || 0,\n              examFees: Number(data.examFees) || 0,\n              medicalFee: Number(data.medicalFee) || 0,\n              monthlyDues: Number(data.monthlyDues) || 0,\n              equipmentCost: Number(data.equipmentCost) || 0,\n              flightsPerMonth: data.flightsPerMonth || 0,\n              avgFlightHours: Number(data.avgFlightHours) || 0,\n            }\n            setFinancials(nextFinancials)\n\n            const hasSavedInputs = Object.values(nextFinancials).some((value) => Number(value) > 0)\n            if (hasSavedInputs) {\n              setActiveTab('projections')\n            }\n          }\n        }\n      } catch (error) {\n        console.error('Error loading financials:', error)\n      } finally {\n        setLoading(false)\n      }\n    }\n    \n    loadFinancials()\n  }, [])\n\n  const handleInputChange = (field: keyof Financials, value: string) => {\n    setFinancials(prev => ({\n      ...prev,\n      [field]: field === 'flightsPerMonth' ? parseInt(value) || 0 : parseFloat(value) || 0\n    }))\n  }\n\n  const handleSave = async () => {\n    setSaving(true)\n    try {\n      const res = await fetch('/api/training/financials', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(financials)\n      })\n      \n      if (res.ok) {\n        onSave?.(financials)\n      }\n    } catch (error) {\n      console.error('Error saving financials:', error)\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  // Calculate projections\n  const projections = useMemo(() => {\n    const flightCostPerHour = financials.aircraftRate + financials.instructorRate\n    const avgFlightsPerMonth = financials.flightsPerMonth || 1\n    const avgHoursPerFlight = financials.avgFlightHours || 1.5\n    const hoursPerMonth = avgFlightsPerMonth * avgHoursPerFlight\n    \n    // Costs\n    const oneTimeCosts = financials.checkrideFee + financials.examFees + \n                        financials.medicalFee + financials.equipmentCost\n    const monthlyCosts = financials.monthlyDues\n    \n    // If we have hours remaining and flight rate\n    const hoursToComplete = hoursRemaining > 0 ? hoursRemaining : 0\n    const totalFlightCost = hoursToComplete * flightCostPerHour\n    const totalCost = oneTimeCosts + totalFlightCost\n    \n    // Projections\n    const monthsToComplete = hoursPerMonth > 0 ? Math.ceil(hoursToComplete / hoursPerMonth) : 0\n    const monthlyFlightCost = hoursPerMonth * flightCostPerHour\n    const totalMonthly = monthlyCosts + monthlyFlightCost\n    \n    // Cost per hour (if flying)\n    const costPerHour = hoursPerMonth > 0 \n      ? (monthlyFlightCost / hoursPerMonth) \n      : flightCostPerHour\n\n    return {\n      flightCostPerHour,\n      oneTimeCosts,\n      monthlyCosts,\n      totalFlightCost,\n      totalCost,\n      hoursPerMonth,\n      monthsToComplete,\n      monthlyFlightCost,\n      totalMonthly,\n      costPerHour\n    }\n  }, [financials, hoursRemaining])\n\n  if (loading) {\n    return (\n      <Card className=\"p-6\">\n        <div className=\"flex items-center justify-center\">\n          <RefreshCw className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n        </div>\n      </Card>\n    )\n  }\n\n  return (\n    <Card>\n      <CardHeader>\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <CardTitle className=\"flex items-center gap-2\">\n              <DollarSign className=\"h-5 w-5 text-green-600\" />\n              Training Costs & Projections\n            </CardTitle>\n            <CardDescription>Track your training expenses and estimate total cost</CardDescription>\n          </div>\n          <Button onClick={handleSave} disabled={saving} size=\"sm\">\n            <Save className=\"h-4 w-4 mr-2\" />\n            {saving ? 'Saving...' : 'Save'}\n          </Button>\n        </div>\n      </CardHeader>\n      <CardContent>\n        <Tabs value={activeTab} onValueChange={(value) => setActiveTab(value as 'inputs' | 'projections')} className=\"w-full\">\n          <TabsList className=\"mb-4\">\n            <TabsTrigger value=\"inputs\">Cost Inputs</TabsTrigger>\n            <TabsTrigger value=\"projections\">Projections</TabsTrigger>\n          </TabsList>\n          \n          <TabsContent value=\"inputs\">\n            <div className=\"grid gap-4 md:grid-cols-2\">\n              {/* Flight Costs */}\n              <div className=\"space-y-4\">\n                <h4 className=\"font-medium flex items-center gap-2\">\n                  <Plane className=\"h-4 w-4\" />\n                  Flight Costs (per hour)\n                </h4>\n                \n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"aircraftRate\">Aircraft Rental ($/hr)</Label>\n                  <Input\n                    id=\"aircraftRate\"\n                    type=\"number\"\n                    min=\"0\"\n                    step=\"5\"\n                    value={financials.aircraftRate || ''}\n                    onChange={(e) => handleInputChange('aircraftRate', e.target.value)}\n                    placeholder=\"150\"\n                  />\n                </div>\n                \n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"instructorRate\">Instructor ($/hr)</Label>\n                  <Input\n                    id=\"instructorRate\"\n                    type=\"number\"\n                    min=\"0\"\n                    step=\"5\"\n                    value={financials.instructorRate || ''}\n                    onChange={(e) => handleInputChange('instructorRate', e.target.value)}\n                    placeholder=\"60\"\n                  />\n                </div>\n              </div>\n\n              {/* One-time Costs */}\n              <div className=\"space-y-4\">\n                <h4 className=\"font-medium flex items-center gap-2\">\n                  <CreditCard className=\"h-4 w-4\" />\n                  One-Time Costs\n                </h4>\n                \n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"checkrideFee\">Checkride Fee</Label>\n                  <Input\n                    id=\"checkrideFee\"\n                    type=\"number\"\n                    min=\"0\"\n                    value={financials.checkrideFee || ''}\n                    onChange={(e) => handleInputChange('checkrideFee', e.target.value)}\n                    placeholder=\"500\"\n                  />\n                </div>\n                \n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"examFees\">Written Exam Fees</Label>\n                  <Input\n                    id=\"examFees\"\n                    type=\"number\"\n                    min=\"0\"\n                    value={financials.examFees || ''}\n                    onChange={(e) => handleInputChange('examFees', e.target.value)}\n                    placeholder=\"200\"\n                  />\n                </div>\n                \n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"medicalFee\">Medical Exam</Label>\n                  <Input\n                    id=\"medicalFee\"\n                    type=\"number\"\n                    min=\"0\"\n                    value={financials.medicalFee || ''}\n                    onChange={(e) => handleInputChange('medicalFee', e.target.value)}\n                    placeholder=\"150\"\n                  />\n                </div>\n                \n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"equipmentCost\">Headset/Equipment</Label>\n                  <Input\n                    id=\"equipmentCost\"\n                    type=\"number\"\n                    min=\"0\"\n                    value={financials.equipmentCost || ''}\n                    onChange={(e) => handleInputChange('equipmentCost', e.target.value)}\n                    placeholder=\"500\"\n                  />\n                </div>\n              </div>\n\n              {/* Monthly & Flight Patterns */}\n              <div className=\"space-y-4 md:col-span-2\">\n                <h4 className=\"font-medium flex items-center gap-2\">\n                  <Calendar className=\"h-4 w-4\" />\n                  Monthly & Flight Patterns\n                </h4>\n                \n                <div className=\"grid gap-4 md:grid-cols-3\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"monthlyDues\">Monthly Dues ($/month)</Label>\n                    <Input\n                      id=\"monthlyDues\"\n                      type=\"number\"\n                      min=\"0\"\n                      value={financials.monthlyDues || ''}\n                      onChange={(e) => handleInputChange('monthlyDues', e.target.value)}\n                      placeholder=\"100\"\n                    />\n                  </div>\n                  \n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"flightsPerMonth\">Flights per Month</Label>\n                    <Input\n                      id=\"flightsPerMonth\"\n                      type=\"number\"\n                      min=\"0\"\n                      value={financials.flightsPerMonth || ''}\n                      onChange={(e) => handleInputChange('flightsPerMonth', e.target.value)}\n                      placeholder=\"4\"\n                    />\n                  </div>\n                  \n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"avgFlightHours\">Avg Hours per Flight</Label>\n                    <Input\n                      id=\"avgFlightHours\"\n                      type=\"number\"\n                      min=\"0\"\n                      step=\"0.5\"\n                      value={financials.avgFlightHours || ''}\n                      onChange={(e) => handleInputChange('avgFlightHours', e.target.value)}\n                      placeholder=\"1.5\"\n                    />\n                  </div>\n                </div>\n              </div>\n            </div>\n          </TabsContent>\n          \n          <TabsContent value=\"projections\">\n            <div className=\"space-y-6\">\n              {/* Summary Cards */}\n              <div className=\"grid gap-4 md:grid-cols-4\">\n                <Card className=\"bg-blue-500/10 border-blue-500/30\">\n                  <CardContent className=\"pt-4\">\n                    <p className=\"text-sm text-muted-foreground\">Total Estimated Cost</p>\n                    <p className=\"text-3xl font-bold text-blue-600\">\n                      ${projections.totalCost.toLocaleString()}\n                    </p>\n                    {hoursRemaining > 0 && (\n                      <p className=\"text-xs text-muted-foreground\">\n                        {hoursRemaining} hours remaining\n                      </p>\n                    )}\n                  </CardContent>\n                </Card>\n                \n                <Card className=\"bg-green-500/10 border-green-500/30\">\n                  <CardContent className=\"pt-4\">\n                    <p className=\"text-sm text-muted-foreground\">One-Time Costs</p>\n                    <p className=\"text-2xl font-bold text-green-600\">\n                      ${projections.oneTimeCosts.toLocaleString()}\n                    </p>\n                    <p className=\"text-xs text-muted-foreground\">\n                      Checkride, exams, equipment\n                    </p>\n                  </CardContent>\n                </Card>\n                \n                <Card className=\"bg-amber-500/10 border-amber-500/30\">\n                  <CardContent className=\"pt-4\">\n                    <p className=\"text-sm text-muted-foreground\">Monthly Cost</p>\n                    <p className=\"text-2xl font-bold text-amber-600\">\n                      ${projections.totalMonthly.toLocaleString()}\n                    </p>\n                    <p className=\"text-xs text-muted-foreground\">\n                      Dues + flying\n                    </p>\n                  </CardContent>\n                </Card>\n                \n                <Card className=\"bg-purple-500/10 border-purple-500/30\">\n                  <CardContent className=\"pt-4\">\n                    <p className=\"text-sm text-muted-foreground\">Est. Months to Goal</p>\n                    <p className=\"text-2xl font-bold text-purple-600\">\n                      {projections.monthsToComplete || 'â€”'}\n                    </p>\n                    <p className=\"text-xs text-muted-foreground\">\n                      {projections.hoursPerMonth.toFixed(1)} hrs/month\n                    </p>\n                  </CardContent>\n                </Card>\n              </div>\n\n              {/* Cost Breakdown */}\n              <div className=\"border rounded-lg p-4\">\n                <h4 className=\"font-medium mb-4\">Cost Breakdown</h4>\n                <div className=\"space-y-3\">\n                  <div className=\"flex justify-between items-center\">\n                    <span className=\"text-muted-foreground\">One-time costs</span>\n                    <span className=\"font-medium\">${projections.oneTimeCosts.toLocaleString()}</span>\n                  </div>\n                  <div className=\"flex justify-between items-center\">\n                    <span className=\"text-muted-foreground\">Flight costs ({hoursRemaining} hrs @ ${projections.flightCostPerHour}/hr)</span>\n                    <span className=\"font-medium\">${projections.totalFlightCost.toLocaleString()}</span>\n                  </div>\n                  {projections.monthsToComplete > 0 && (\n                    <div className=\"flex justify-between items-center\">\n                      <span className=\"text-muted-foreground\">Monthly dues ({projections.monthsToComplete} months)</span>\n                      <span className=\"font-medium\">${(projections.monthlyCosts * projections.monthsToComplete).toLocaleString()}</span>\n                    </div>\n                  )}\n                  <div className=\"border-t pt-3 flex justify-between items-center\">\n                    <span className=\"font-medium\">Total</span>\n                    <span className=\"font-bold text-lg\">${projections.totalCost.toLocaleString()}</span>\n                  </div>\n                </div>\n              </div>\n\n              {/* Cost Per Hour */}\n              <div className=\"bg-muted/50 rounded-lg p-4\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">Cost per Flight Hour</p>\n                    <p className=\"text-2xl font-bold\">${projections.costPerHour.toFixed(2)}</p>\n                  </div>\n                  <div className=\"text-right\">\n                    <p className=\"text-sm text-muted-foreground\">Flying cost</p>\n                    <p className=\"font-medium\">${projections.flightCostPerHour}/hr</p>\n                    <p className=\"text-xs text-muted-foreground\">\n                      (${financials.aircraftRate}/aircraft + ${financials.instructorRate}/instructor)\n                    </p>\n                  </div>\n                </div>\n              </div>\n\n              {projections.flightCostPerHour === 0 && (\n                <p className=\"text-sm text-muted-foreground text-center\">\n                  Enter your flight costs to see projections\n                </p>\n              )}\n            </div>\n          </TabsContent>\n        </Tabs>\n      </CardContent>\n    </Card>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\training\\GoalSelector.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getIcon' is assigned a value but never used.","line":32,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":32,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'availableGoals' is assigned a value but never used.","line":54,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":54,"endColumn":23},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":63,"column":76,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[2286,2332],"text":"Select the certification you&apos;re working toward"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[2286,2332],"text":"Select the certification you&lsquo;re working toward"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[2286,2332],"text":"Select the certification you&#39;re working toward"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[2286,2332],"text":"Select the certification you&rsquo;re working toward"},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState } from 'react'\nimport { TRAINING_GOALS, getGoalById, arePrerequisitesMet, GoalType } from '@/lib/training/requirements'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Badge } from '@/components/ui/badge'\nimport { Check, Lock, ChevronRight, Plane, Helicopter, GraduationCap, Briefcase, Award } from 'lucide-react'\n\ninterface GoalSelectorProps {\n  currentGoal?: string\n  completedGoals?: GoalType[]\n  onSelectGoal: (goalType: GoalType) => void\n  isLoading?: boolean\n}\n\nexport default function GoalSelector({ \n  currentGoal, \n  completedGoals = [],\n  onSelectGoal, \n  isLoading = false \n}: GoalSelectorProps) {\n  const [selectedGoal, setSelectedGoal] = useState<GoalType | null>(currentGoal as GoalType || null)\n  const [showAll, setShowAll] = useState(false)\n\n  const handleSelect = async (goalType: GoalType) => {\n    setSelectedGoal(goalType)\n    onSelectGoal(goalType)\n  }\n\n  // Get icon based on category\n  const getIcon = (category: 'airplane' | 'helicopter') => {\n    if (category === 'helicopter') return <Helicopter className=\"h-8 w-8\" />\n    return <Plane className=\"h-8 w-8\" />\n  }\n\n  // Get icon for specific goals\n  const getGoalIcon = (goalId: GoalType) => {\n    switch (goalId) {\n      case 'PPL': return <Plane className=\"h-8 w-8\" />\n      case 'IR': return <Award className=\"h-8 w-8\" />\n      case 'CPL': return <Briefcase className=\"h-8 w-8\" />\n      case 'CFI':\n      case 'CFII':\n      case 'MEI': return <GraduationCap className=\"h-8 w-8\" />\n      case 'ATP': return <Award className=\"h-8 w-8\" />\n      case 'HELICOPTER': return <Helicopter className=\"h-8 w-8\" />\n      default: return <Plane className=\"h-8 w-8\" />\n    }\n  }\n\n  // Filter goals - show first 4 by default (most common)\n  const displayedGoals = showAll ? TRAINING_GOALS : TRAINING_GOALS.slice(0, 4)\n  const availableGoals = TRAINING_GOALS.filter(goal => \n    arePrerequisitesMet(goal.prerequisites || [], completedGoals)\n  )\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-2xl font-bold\">Choose Your Training Goal</h2>\n          <p className=\"text-muted-foreground\">Select the certification you're working toward</p>\n        </div>\n        {!showAll && TRAINING_GOALS.length > 4 && (\n          <Button variant=\"outline\" onClick={() => setShowAll(true)}>\n            View All {TRAINING_GOALS.length} Goals\n          </Button>\n        )}\n      </div>\n\n      <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\n        {displayedGoals.map((goal) => {\n          const isSelected = selectedGoal === goal.id\n          const isComplete = completedGoals.includes(goal.id)\n          const isLocked = !arePrerequisitesMet(goal.prerequisites || [], completedGoals)\n          const hasTarget = currentGoal === goal.id\n\n          return (\n            <Card \n              key={goal.id}\n              className={`cursor-pointer transition-all hover:shadow-md ${\n                isSelected ? 'border-primary bg-primary/5' : ''\n              } ${isComplete ? 'border-green-500 bg-green-500/5' : ''} ${isLocked ? 'opacity-60' : ''}`}\n              onClick={() => !isLocked && handleSelect(goal.id)}\n            >\n              <CardHeader className=\"pb-2\">\n                <div className=\"flex items-start justify-between\">\n                  <div className={`p-2 rounded-lg ${isComplete ? 'bg-green-100' : isSelected ? 'bg-primary/10' : 'bg-muted'}`}>\n                    {getGoalIcon(goal.id)}\n                  </div>\n                  <div className=\"flex gap-1\">\n                    {isComplete && (\n                      <Badge variant=\"secondary\" className=\"bg-green-500/10 text-green-600\">\n                        <Check className=\"h-3 w-3 mr-1\" /> Done\n                      </Badge>\n                    )}\n                    {hasTarget && !isComplete && (\n                      <Badge className=\"bg-primary\">Active</Badge>\n                    )}\n                  </div>\n                </div>\n                <CardTitle className=\"text-lg mt-2\">{goal.name}</CardTitle>\n                <CardDescription className=\"text-xs\">{goal.shortName} - {goal.totalHoursRequired}+ hours</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-sm text-muted-foreground line-clamp-2\">\n                  {goal.description}\n                </p>\n                \n                {isLocked && goal.prerequisites && goal.prerequisites.length > 0 && (\n                  <div className=\"mt-3 flex items-center gap-1 text-xs text-muted-foreground\">\n                    <Lock className=\"h-3 w-3\" />\n                    <span>Requires: {goal.prerequisites.join(', ')}</span>\n                  </div>\n                )}\n                \n                {isSelected && !isComplete && (\n                  <Button className=\"w-full mt-3\" size=\"sm\" disabled={isLoading}>\n                    {isLoading ? 'Saving...' : 'Set as Goal'}\n                    <ChevronRight className=\"h-4 w-4 ml-1\" />\n                  </Button>\n                )}\n              </CardContent>\n            </Card>\n          )\n        })}\n      </div>\n\n      {/* Goal Progress Summary */}\n      {completedGoals.length > 0 && (\n        <div className=\"mt-6 p-4 bg-muted/50 rounded-lg\">\n          <h3 className=\"font-semibold mb-2\">Your Progress</h3>\n          <div className=\"flex flex-wrap gap-2\">\n            {completedGoals.map(goalId => {\n              const goal = getGoalById(goalId)\n              return goal ? (\n                <Badge key={goalId} variant=\"outline\" className=\"bg-green-500/10 text-green-600 border-green-500/30\">\n                  <Check className=\"h-3 w-3 mr-1\" /> {goal.shortName}\n                </Badge>\n              ) : null\n            })}\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\training\\HoursChart.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":55,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1509,1512],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1509,1512],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":101,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":101,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3152,3155],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3152,3155],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":106,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":106,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3383,3386],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3383,3386],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\nC:\\Users\\David\\next-dashboard\\components\\training\\HoursChart.tsx:150:36\n  148 |                 <XAxis dataKey=\"month\" tick={{ fontSize: 12 }} />\n  149 |                 <YAxis tick={{ fontSize: 12 }} />\n> 150 |                 <Tooltip content={<CustomTooltip />} />\n      |                                    ^^^^^^^^^^^^^ This component is created during render\n  151 |                 <Legend />\n  152 |                 <Bar dataKey=\"solo\" name=\"Solo\" stackId=\"a\" fill=\"#22c55e\" />\n  153 |                 <Bar dataKey=\"night\" name=\"Night\" stackId=\"a\" fill=\"#3b82f6\" />\n\nC:\\Users\\David\\next-dashboard\\components\\training\\HoursChart.tsx:101:25\n   99 |   }, [monthlyData])\n  100 |\n> 101 |   const CustomTooltip = ({ active, payload, label }: any) => {\n      |                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 102 |     if (active && payload && payload.length) {\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 103 |       return (\n      â€¦\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 119 |     return null\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 120 |   }\n      | ^^^^ The component is created during render here\n  121 |\n  122 |   return (\n  123 |     <Card>","line":150,"column":36,"nodeType":null,"endLine":150,"endColumn":49},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\nC:\\Users\\David\\next-dashboard\\components\\training\\HoursChart.tsx:172:36\n  170 |                 <XAxis dataKey=\"month\" tick={{ fontSize: 12 }} />\n  171 |                 <YAxis tick={{ fontSize: 12 }} />\n> 172 |                 <Tooltip content={<CustomTooltip />} />\n      |                                    ^^^^^^^^^^^^^ This component is created during render\n  173 |                 <Area \n  174 |                   type=\"monotone\" \n  175 |                   dataKey=\"total\" \n\nC:\\Users\\David\\next-dashboard\\components\\training\\HoursChart.tsx:101:25\n   99 |   }, [monthlyData])\n  100 |\n> 101 |   const CustomTooltip = ({ active, payload, label }: any) => {\n      |                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 102 |     if (active && payload && payload.length) {\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 103 |       return (\n      â€¦\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 119 |     return null\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 120 |   }\n      | ^^^^ The component is created during render here\n  121 |\n  122 |   return (\n  123 |     <Card>","line":172,"column":36,"nodeType":null,"endLine":172,"endColumn":49}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useMemo } from 'react'\nimport { \n  AreaChart, \n  Area, \n  BarChart, \n  Bar, \n  XAxis, \n  YAxis, \n  CartesianGrid, \n  Tooltip, \n  ResponsiveContainer,\n  Legend \n} from 'recharts'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'\n\ninterface FlightLogEntry {\n  date: string\n  totalTime?: number\n  soloTime?: number\n  nightTime?: number\n  instrumentTime?: number\n  crossCountryTime?: number\n}\n\ninterface HoursChartProps {\n  logs?: FlightLogEntry[]\n  progress?: {\n    totalHours: number\n    soloHours: number\n    nightHours: number\n    instrumentHours: number\n    crossCountryHours: number\n  }\n}\n\nexport default function HoursChart({ logs = [], progress }: HoursChartProps) {\n  // Process log data into monthly aggregates\n  const monthlyData = useMemo(() => {\n    if (logs.length === 0) {\n      // Demo data if no logs\n      return [\n        { month: 'Jan', total: 5, solo: 2, night: 0, instrument: 1, xc: 0 },\n        { month: 'Feb', total: 8, solo: 3, night: 1, instrument: 2, xc: 3 },\n        { month: 'Mar', total: 12, solo: 4, night: 2, instrument: 4, xc: 5 },\n        { month: 'Apr', total: 15, solo: 5, night: 2, instrument: 5, xc: 7 },\n        { month: 'May', total: 18, solo: 6, night: 3, instrument: 6, xc: 8 },\n        { month: 'Jun', total: 22, solo: 7, night: 3, instrument: 7, xc: 10 },\n      ]\n    }\n\n    // Aggregate logs by month\n    const monthly: Record<string, any> = {}\n    \n    logs.forEach(log => {\n      const date = new Date(log.date)\n      const monthKey = date.toLocaleString('default', { month: 'short' })\n      \n      if (!monthly[monthKey]) {\n        monthly[monthKey] = { month: monthKey, total: 0, solo: 0, night: 0, instrument: 0, xc: 0 }\n      }\n      \n      monthly[monthKey].total += log.totalTime || 0\n      monthly[monthKey].solo += log.soloTime || 0\n      monthly[monthKey].night += log.nightTime || 0\n      monthly[monthKey].instrument += log.instrumentTime || 0\n      monthly[monthKey].xc += log.crossCountryTime || 0\n    })\n    \n    return Object.values(monthly)\n  }, [logs])\n\n  // Calculate totals\n  const totals = useMemo(() => {\n    if (progress) return progress\n    \n    return {\n      totalHours: monthlyData.reduce((sum, m) => sum + m.total, 0),\n      soloHours: monthlyData.reduce((sum, m) => sum + m.solo, 0),\n      nightHours: monthlyData.reduce((sum, m) => sum + m.night, 0),\n      instrumentHours: monthlyData.reduce((sum, m) => sum + m.instrument, 0),\n      crossCountryHours: monthlyData.reduce((sum, m) => sum + m.xc, 0),\n    }\n  }, [progress, monthlyData])\n\n  // Project completion based on average monthly rate\n  const projection = useMemo(() => {\n    if (monthlyData.length < 2) return null\n    \n    const recentMonths = monthlyData.slice(-3)\n    const avgHoursPerMonth = recentMonths.reduce((sum, m) => sum + m.total, 0) / recentMonths.length\n    \n    return {\n      avgHoursPerMonth: avgHoursPerMonth.toFixed(1),\n      projectedDate: null // Could calculate if target hours provided\n    }\n  }, [monthlyData])\n\n  const CustomTooltip = ({ active, payload, label }: any) => {\n    if (active && payload && payload.length) {\n      return (\n        <div className=\"bg-background border rounded-lg p-3 shadow-lg\">\n          <p className=\"font-semibold mb-2\">{label}</p>\n          {payload.map((entry: any, index: number) => (\n            <div key={index} className=\"flex items-center gap-2 text-sm\">\n              <div \n                className=\"w-3 h-3 rounded-full\" \n                style={{ backgroundColor: entry.color }}\n              />\n              <span className=\"text-muted-foreground\">{entry.name}:</span>\n              <span className=\"font-medium\">{entry.value.toFixed(1)} hrs</span>\n            </div>\n          ))}\n        </div>\n      )\n    }\n    return null\n  }\n\n  return (\n    <Card>\n      <CardHeader>\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <CardTitle>Flight Hours Progress</CardTitle>\n            <p className=\"text-sm text-muted-foreground\">Your training timeline</p>\n          </div>\n          {projection && (\n            <div className=\"text-right\">\n              <p className=\"text-sm text-muted-foreground\">Avg. {projection.avgHoursPerMonth} hrs/month</p>\n            </div>\n          )}\n        </div>\n      </CardHeader>\n      <CardContent>\n        <Tabs defaultValue=\"stacked\" className=\"w-full\">\n          <TabsList className=\"mb-4\">\n            <TabsTrigger value=\"stacked\">Stacked</TabsTrigger>\n            <TabsTrigger value=\"total\">Total Only</TabsTrigger>\n          </TabsList>\n          \n          <TabsContent value=\"stacked\" className=\"h-[300px]\">\n            <ResponsiveContainer width=\"100%\" height=\"100%\">\n              <BarChart data={monthlyData} margin={{ top: 10, right: 10, left: -10, bottom: 0 }}>\n                <CartesianGrid strokeDasharray=\"3 3\" opacity={0.3} />\n                <XAxis dataKey=\"month\" tick={{ fontSize: 12 }} />\n                <YAxis tick={{ fontSize: 12 }} />\n                <Tooltip content={<CustomTooltip />} />\n                <Legend />\n                <Bar dataKey=\"solo\" name=\"Solo\" stackId=\"a\" fill=\"#22c55e\" />\n                <Bar dataKey=\"night\" name=\"Night\" stackId=\"a\" fill=\"#3b82f6\" />\n                <Bar dataKey=\"instrument\" name=\"Instrument\" stackId=\"a\" fill=\"#8b5cf6\" />\n                <Bar dataKey=\"xc\" name=\"Cross Country\" stackId=\"a\" fill=\"#f59e0b\" />\n              </BarChart>\n            </ResponsiveContainer>\n          </TabsContent>\n          \n          <TabsContent value=\"total\" className=\"h-[300px]\">\n            <ResponsiveContainer width=\"100%\" height=\"100%\">\n              <AreaChart data={monthlyData} margin={{ top: 10, right: 10, left: -10, bottom: 0 }}>\n                <defs>\n                  <linearGradient id=\"colorTotal\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                    <stop offset=\"5%\" stopColor=\"#3b82f6\" stopOpacity={0.4}/>\n                    <stop offset=\"95%\" stopColor=\"#3b82f6\" stopOpacity={0.05}/>\n                  </linearGradient>\n                </defs>\n                <CartesianGrid strokeDasharray=\"3 3\" opacity={0.3} />\n                <XAxis dataKey=\"month\" tick={{ fontSize: 12 }} />\n                <YAxis tick={{ fontSize: 12 }} />\n                <Tooltip content={<CustomTooltip />} />\n                <Area \n                  type=\"monotone\" \n                  dataKey=\"total\" \n                  name=\"Total Hours\"\n                  stroke=\"#3b82f6\" \n                  fillOpacity={1} \n                  fill=\"url(#colorTotal)\" \n                />\n              </AreaChart>\n            </ResponsiveContainer>\n          </TabsContent>\n        </Tabs>\n\n        {/* Summary Cards */}\n        <div className=\"grid grid-cols-5 gap-2 mt-6\">\n          <div className=\"bg-muted/50 rounded-lg p-3 text-center\">\n            <p className=\"text-2xl font-bold text-blue-600\">{totals.totalHours}</p>\n            <p className=\"text-xs text-muted-foreground\">Total</p>\n          </div>\n          <div className=\"bg-green-500/10 rounded-lg p-3 text-center\">\n            <p className=\"text-2xl font-bold text-green-600\">{totals.soloHours}</p>\n            <p className=\"text-xs text-muted-foreground\">Solo</p>\n          </div>\n          <div className=\"bg-blue-500/10 rounded-lg p-3 text-center\">\n            <p className=\"text-2xl font-bold text-blue-600\">{totals.nightHours}</p>\n            <p className=\"text-xs text-muted-foreground\">Night</p>\n          </div>\n          <div className=\"bg-purple-500/10 rounded-lg p-3 text-center\">\n            <p className=\"text-2xl font-bold text-purple-600\">{totals.instrumentHours}</p>\n            <p className=\"text-xs text-muted-foreground\">Instrument</p>\n          </div>\n          <div className=\"bg-amber-500/10 rounded-lg p-3 text-center\">\n            <p className=\"text-2xl font-bold text-amber-600\">{totals.crossCountryHours}</p>\n            <p className=\"text-xs text-muted-foreground\">XC</p>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\training\\TrainingRoadmap.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrainingGoalData' is defined but never used.","line":4,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":39,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"TrainingGoalData"},"fix":{"range":[67,85],"text":""},"desc":"Remove unused variable \"TrainingGoalData\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Button' is defined but never used.","line":7,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":16,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Button"},"fix":{"range":[260,308],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'milestonesCompleted' is assigned a value but never used.","line":25,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":25,"endColumn":22},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":39,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1219,1222],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1219,1222],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'index' is defined but never used.","line":105,"column":48,"nodeType":"Identifier","messageId":"unusedVar","endLine":105,"endColumn":53}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState } from 'react'\nimport { getGoalById, TrainingGoalData, Milestone } from '@/lib/training/requirements'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Badge } from '@/components/ui/badge'\nimport { Button } from '@/components/ui/button'\nimport { \n  Tooltip, \n  TooltipContent, \n  TooltipProvider, \n  TooltipTrigger \n} from '@/components/ui/tooltip'\nimport { Check, Circle, Clock, ChevronRight, Plane, Target } from 'lucide-react'\n\ninterface TrainingRoadmapProps {\n  goalType?: string\n  progress: Record<string, number>\n  milestonesCompleted?: string[]\n}\n\nexport default function TrainingRoadmap({ \n  goalType, \n  progress = {},\n  milestonesCompleted = [] \n}: TrainingRoadmapProps) {\n  const [hoveredMilestone, setHoveredMilestone] = useState<string | null>(null)\n\n  if (!goalType) {\n    return (\n      <Card className=\"p-6 text-center\">\n        <Target className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground\" />\n        <h3 className=\"text-lg font-semibold mb-2\">No Goal Selected</h3>\n        <p className=\"text-muted-foreground\">Choose a training goal above to see your roadmap</p>\n      </Card>\n    )\n  }\n\n  const goal = getGoalById(goalType as any)\n  \n  if (!goal) {\n    return (\n      <Card className=\"p-6 text-center\">\n        <p className=\"text-muted-foreground\">Invalid goal selected</p>\n      </Card>\n    )\n  }\n\n  // Calculate overall progress\n  const totalRequirements = goal.requirements.length\n  const completedRequirements = goal.requirements.filter(\n    req => (progress[req.key] || 0) >= req.required\n  ).length\n  const overallProgress = Math.round((completedRequirements / totalRequirements) * 100)\n\n  // Determine milestone status based on requirements\n  const getMilestoneStatus = (milestone: Milestone): 'complete' | 'in-progress' | 'pending' => {\n    // Check if all requirements for this milestone are met\n    const allMet = milestone.requirements.every(\n      reqKey => (progress[reqKey] || 0) >= \n        (goal.requirements.find(r => r.key === reqKey)?.required || 0)\n    )\n    \n    if (allMet) return 'complete'\n    \n    // Check if any requirements are in progress\n    const anyProgress = milestone.requirements.some(\n      reqKey => (progress[reqKey] || 0) > 0\n    )\n    \n    if (anyProgress) return 'in-progress'\n    \n    return 'pending'\n  }\n\n  return (\n    <TooltipProvider>\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-2\">\n              <Plane className=\"h-5 w-5 text-primary\" />\n              <CardTitle>{goal.name} Roadmap</CardTitle>\n            </div>\n            <Badge variant=\"outline\">{overallProgress}% Complete</Badge>\n          </div>\n        </CardHeader>\n        <CardContent>\n          {/* Progress bar */}\n          <div className=\"mb-6\">\n            <div className=\"h-3 bg-muted rounded-full overflow-hidden\">\n              <div \n                className=\"h-full bg-primary transition-all\"\n                style={{ width: `${overallProgress}%` }}\n              />\n            </div>\n          </div>\n\n          {/* Milestones timeline */}\n          <div className=\"relative\">\n            {/* Vertical line */}\n            <div className=\"absolute left-4 top-0 bottom-0 w-0.5 bg-muted\" />\n\n            <div className=\"space-y-6\">\n              {goal.milestones.map((milestone, index) => {\n                const status = getMilestoneStatus(milestone)\n                const isHovered = hoveredMilestone === milestone.id\n\n                return (\n                  <Tooltip key={milestone.id}>\n                    <TooltipTrigger asChild>\n                      <div \n                        className={`relative flex items-start gap-4 cursor-pointer transition-opacity ${\n                          status === 'pending' ? 'opacity-60' : ''\n                        }`}\n                        onMouseEnter={() => setHoveredMilestone(milestone.id)}\n                        onMouseLeave={() => setHoveredMilestone(null)}\n                      >\n                        {/* Status icon */}\n                        <div className={`\n                          relative z-10 flex items-center justify-center w-8 h-8 rounded-full border-2\n                          ${status === 'complete' ? 'bg-green-500 border-green-500' : ''}\n                          ${status === 'in-progress' ? 'bg-yellow-500 border-yellow-500' : ''}\n                          ${status === 'pending' ? 'bg-background border-muted-foreground' : ''}\n                        `}>\n                          {status === 'complete' && <Check className=\"h-4 w-4 text-white\" />}\n                          {status === 'in-progress' && <Clock className=\"h-4 w-4 text-white\" />}\n                          {status === 'pending' && <Circle className=\"h-3 w-3 text-muted-foreground\" />}\n                        </div>\n\n                        {/* Content */}\n                        <div className={`\n                          flex-1 p-3 rounded-lg border transition-all\n                          ${isHovered ? 'bg-muted/50 border-primary/50' : 'bg-muted/20'}\n                          ${status === 'complete' ? 'border-green-500/30' : ''}\n                          ${status === 'in-progress' ? 'border-yellow-500/30' : ''}\n                        `}>\n                          <div className=\"flex items-center justify-between\">\n                            <span className={`\n                              font-medium\n                              ${status === 'complete' ? 'text-green-600' : ''}\n                              ${status === 'in-progress' ? 'text-yellow-600' : ''}\n                            `}>\n                              {milestone.title}\n                            </span>\n                            <ChevronRight className=\"h-4 w-4 text-muted-foreground\" />\n                          </div>\n                          <p className=\"text-sm text-muted-foreground mt-1\">{milestone.description}</p>\n                          \n                          {/* Requirements preview */}\n                          {milestone.requirements.length > 0 && (\n                            <div className=\"flex flex-wrap gap-1 mt-2\">\n                              {milestone.requirements.slice(0, 3).map(reqKey => {\n                                const req = goal.requirements.find(r => r.key === reqKey)\n                                const current = progress[reqKey] || 0\n                                const required = req?.required || 0\n                                const met = current >= required\n                                \n                                return (\n                                  <Badge \n                                    key={reqKey} \n                                    variant=\"outline\" \n                                    className={`text-xs ${met ? 'bg-green-500/10 text-green-600' : ''}`}\n                                  >\n                                    {req?.label}: {current}/{required}\n                                  </Badge>\n                                )\n                              })}\n                              {milestone.requirements.length > 3 && (\n                                <Badge variant=\"outline\" className=\"text-xs\">\n                                  +{milestone.requirements.length - 3} more\n                                </Badge>\n                              )}\n                            </div>\n                          )}\n                        </div>\n                      </div>\n                    </TooltipTrigger>\n                    \n                    {/* Tooltip with full details */}\n                    <TooltipContent\n                      side=\"top\"\n                      align=\"center\"\n                      sideOffset={8}\n                      collisionPadding={16}\n                      avoidCollisions\n                      className=\"w-80 max-w-[calc(100vw-2rem)]\"\n                    >\n                      <div className=\"space-y-2\">\n                        <h4 className=\"font-semibold\">{milestone.title}</h4>\n                        <p className=\"text-sm text-muted-foreground\">{milestone.description}</p>\n                        \n                        <div className=\"border-t pt-2\">\n                          <h5 className=\"text-sm font-medium mb-1\">Requirements:</h5>\n                          <div className=\"space-y-1\">\n                            {milestone.requirements.map(reqKey => {\n                              const req = goal.requirements.find(r => r.key === reqKey)\n                              const current = progress[reqKey] || 0\n                              const required = req?.required || 0\n                              const met = current >= required\n                              \n                              return (\n                                <div key={reqKey} className=\"flex justify-between text-xs\">\n                                  <span className={met ? 'text-green-600' : ''}>\n                                    {req?.label || reqKey}\n                                  </span>\n                                  <span className={met ? 'text-green-600 font-medium' : ''}>\n                                    {current} / {required} {req?.unit || 'hrs'}\n                                  </span>\n                                </div>\n                              )\n                            })}\n                          </div>\n                        </div>\n                      </div>\n                    </TooltipContent>\n                  </Tooltip>\n                )\n              })}\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </TooltipProvider>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\accordion.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\alert-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\alert.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\aspect-ratio.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\avatar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\badge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\breadcrumb.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\button-group.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\calendar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\carousel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\chart.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":121,"column":4,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":121,"endColumn":7,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3183,3186],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3183,3186],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":175,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":175,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4503,4506],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4503,4506],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":252,"column":4,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":252,"endColumn":7,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7332,7335],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7332,7335],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":267,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":267,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7621,7624],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7621,7624],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport * as React from 'react'\nimport * as RechartsPrimitive from 'recharts'\n\nimport { cn } from '@/lib/utils'\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: '', dark: '.dark' } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error('useChart must be used within a <ChartContainer />')\n  }\n\n  return context\n}\n\nfunction ChartContainer({\n  id,\n  className,\n  children,\n  config,\n  ...props\n}: React.ComponentProps<'div'> & {\n  config: ChartConfig\n  children: React.ComponentProps<\n    typeof RechartsPrimitive.ResponsiveContainer\n  >['children']\n}) {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, '')}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-slot=\"chart\"\n        data-chart={chartId}\n        className={cn(\n          \"[&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border flex aspect-video justify-center text-xs [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-hidden [&_.recharts-sector]:outline-hidden [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-surface]:outline-hidden\",\n          className,\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n}\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color,\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join('\\n')}\n}\n`,\n          )\n          .join('\\n'),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nfunction ChartTooltipContent({\n  active,\n  payload,\n  className,\n  indicator = 'dot',\n  hideLabel = false,\n  hideIndicator = false,\n  label,\n  labelFormatter,\n  labelClassName,\n  formatter,\n  color,\n  nameKey,\n  labelKey,\n}: any) {\n  const { config } = useChart()\n\n  const tooltipLabel = React.useMemo(() => {\n    if (hideLabel || !payload?.length) {\n      return null\n    }\n\n    const [item] = payload\n    const key = `${labelKey || item?.dataKey || item?.name || 'value'}`\n    const itemConfig = getPayloadConfigFromPayload(config, item, key)\n    const value =\n      !labelKey && typeof label === 'string'\n        ? config[label as keyof typeof config]?.label || label\n        : itemConfig?.label\n\n    if (labelFormatter) {\n      return (\n        <div className={cn('font-medium', labelClassName)}>\n          {labelFormatter(value, payload)}\n        </div>\n      )\n    }\n\n    if (!value) {\n      return null\n    }\n\n    return <div className={cn('font-medium', labelClassName)}>{value}</div>\n  }, [\n    label,\n    labelFormatter,\n    payload,\n    hideLabel,\n    labelClassName,\n    config,\n    labelKey,\n  ])\n\n  if (!active || !payload?.length) {\n    return null\n  }\n\n  const nestLabel = payload.length === 1 && indicator !== 'dot'\n\n  return (\n    <div\n      className={cn(\n        'border-border/50 bg-background grid min-w-[8rem] items-start gap-1.5 rounded-lg border px-2.5 py-1.5 text-xs shadow-xl',\n        className,\n      )}\n    >\n      {!nestLabel ? tooltipLabel : null}\n      <div className=\"grid gap-1.5\">\n        {payload.map((item: any, index: number) => {\n          const key = `${nameKey || item.name || item.dataKey || 'value'}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n          const indicatorColor = color || item.payload.fill || item.color\n\n          return (\n            <div\n              key={item.dataKey}\n              className={cn(\n                '[&>svg]:text-muted-foreground flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5',\n                indicator === 'dot' && 'items-center',\n              )}\n            >\n              {formatter && item?.value !== undefined && item.name ? (\n                formatter(item.value, item.name, item, index, item.payload)\n              ) : (\n                <>\n                  {itemConfig?.icon ? (\n                    <itemConfig.icon />\n                  ) : (\n                    !hideIndicator && (\n                      <div\n                        className={cn(\n                          'shrink-0 rounded-[2px] border-(--color-border) bg-(--color-bg)',\n                          {\n                            'h-2.5 w-2.5': indicator === 'dot',\n                            'w-1': indicator === 'line',\n                            'w-0 border-[1.5px] border-dashed bg-transparent':\n                              indicator === 'dashed',\n                            'my-0.5': nestLabel && indicator === 'dashed',\n                          },\n                        )}\n                        style={\n                          {\n                            '--color-bg': indicatorColor,\n                            '--color-border': indicatorColor,\n                          } as React.CSSProperties\n                        }\n                      />\n                    )\n                  )}\n                  <div\n                    className={cn(\n                      'flex flex-1 justify-between leading-none',\n                      nestLabel ? 'items-end' : 'items-center',\n                    )}\n                  >\n                    <div className=\"grid gap-1.5\">\n                      {nestLabel ? tooltipLabel : null}\n                      <span className=\"text-muted-foreground\">\n                        {itemConfig?.label || item.name}\n                      </span>\n                    </div>\n                    {item.value && (\n                      <span className=\"text-foreground font-mono font-medium tabular-nums\">\n                        {item.value.toLocaleString()}\n                      </span>\n                    )}\n                  </div>\n                </>\n              )}\n            </div>\n          )\n        })}\n      </div>\n    </div>\n  )\n}\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nfunction ChartLegendContent({\n  className,\n  hideIcon = false,\n  payload,\n  verticalAlign = 'bottom',\n  nameKey,\n}: any) {\n  const { config } = useChart()\n\n  if (!payload?.length) {\n    return null\n  }\n\n  return (\n    <div\n      className={cn(\n        'flex items-center justify-center gap-4',\n        verticalAlign === 'top' ? 'pb-3' : 'pt-3',\n        className,\n      )}\n    >\n      {payload.map((item: any) => {\n        const key = `${nameKey || item.dataKey || 'value'}`\n        const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n        return (\n          <div\n            key={item.value}\n            className={\n              '[&>svg]:text-muted-foreground flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3'\n            }\n          >\n            {itemConfig?.icon && !hideIcon ? (\n              <itemConfig.icon />\n            ) : (\n              <div\n                className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                style={{\n                  backgroundColor: item.color,\n                }}\n              />\n            )}\n            {itemConfig?.label}\n          </div>\n        )\n      })}\n    </div>\n  )\n}\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string,\n) {\n  if (typeof payload !== 'object' || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    'payload' in payload &&\n    typeof payload.payload === 'object' &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === 'string'\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === 'string'\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\checkbox.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\collapsible.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\command.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\context-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\drawer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\dropdown-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\empty.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\field.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\form.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\hover-card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\input-group.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\input-otp.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\item.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\kbd.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\label.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\menubar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\navigation-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\pagination.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\popover.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\progress.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\radio-group.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\resizable.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\scroll-area.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\select.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\separator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\sheet.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\sidebar.tsx","messages":[{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Math.random` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nC:\\Users\\David\\next-dashboard\\components\\ui\\sidebar.tsx:611:26\n  609 |   // Random width between 50 to 90%.\n  610 |   const width = React.useMemo(() => {\n> 611 |     return `${Math.floor(Math.random() * 40) + 50}%`\n      |                          ^^^^^^^^^^^^^ Cannot call impure function\n  612 |   }, [])\n  613 |\n  614 |   return (","line":611,"column":26,"nodeType":null,"endLine":611,"endColumn":39}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport * as React from 'react'\nimport { Slot } from '@radix-ui/react-slot'\nimport { cva, VariantProps } from 'class-variance-authority'\nimport { PanelLeftIcon } from 'lucide-react'\n\nimport { useIsMobile } from '@/hooks/use-mobile'\nimport { cn } from '@/lib/utils'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Separator } from '@/components/ui/separator'\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from '@/components/ui/sheet'\nimport { Skeleton } from '@/components/ui/skeleton'\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from '@/components/ui/tooltip'\n\nconst SIDEBAR_COOKIE_NAME = 'sidebar_state'\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = '16rem'\nconst SIDEBAR_WIDTH_MOBILE = '18rem'\nconst SIDEBAR_WIDTH_ICON = '3rem'\nconst SIDEBAR_KEYBOARD_SHORTCUT = 'b'\n\ntype SidebarContextProps = {\n  state: 'expanded' | 'collapsed'\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error('useSidebar must be used within a SidebarProvider.')\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<'div'> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === 'function' ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open],\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener('keydown', handleKeyDown)\n    return () => window.removeEventListener('keydown', handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? 'expanded' : 'collapsed'\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar],\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              '--sidebar-width': SIDEBAR_WIDTH,\n              '--sidebar-width-icon': SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            'group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full',\n            className,\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = 'left',\n  variant = 'sidebar',\n  collapsible = 'offcanvas',\n  className,\n  children,\n  ...props\n}: React.ComponentProps<'div'> & {\n  side?: 'left' | 'right'\n  variant?: 'sidebar' | 'floating' | 'inset'\n  collapsible?: 'offcanvas' | 'icon' | 'none'\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === 'none') {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          'bg-sidebar text-sidebar-foreground flex h-full w-(--sidebar-width) flex-col',\n          className,\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-(--sidebar-width) p-0 [&>button]:hidden\"\n          style={\n            {\n              '--sidebar-width': SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === 'collapsed' ? collapsible : ''}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          'relative w-(--sidebar-width) bg-transparent transition-[width] duration-200 ease-linear',\n          'group-data-[collapsible=offcanvas]:w-0',\n          'group-data-[side=right]:rotate-180',\n          variant === 'floating' || variant === 'inset'\n            ? 'group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+(--spacing(4)))]'\n            : 'group-data-[collapsible=icon]:w-(--sidebar-width-icon)',\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          'fixed inset-y-0 z-10 hidden h-svh w-(--sidebar-width) transition-[left,right,width] duration-200 ease-linear md:flex',\n          side === 'left'\n            ? 'left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]'\n            : 'right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]',\n          // Adjust the padding for floating and inset variants.\n          variant === 'floating' || variant === 'inset'\n            ? 'p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+(--spacing(4))+2px)]'\n            : 'group-data-[collapsible=icon]:w-(--sidebar-width-icon) group-data-[side=left]:border-r group-data-[side=right]:border-l',\n          className,\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn('size-7', className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<'button'>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        'hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex',\n        'in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize',\n        '[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize',\n        'hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full',\n        '[[data-side=left][data-collapsible=offcanvas]_&]:-right-2',\n        '[[data-side=right][data-collapsible=offcanvas]_&]:-left-2',\n        className,\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<'main'>) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        'bg-background relative flex w-full flex-1 flex-col',\n        'md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2',\n        className,\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn('bg-background h-8 w-full shadow-none', className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn('flex flex-col gap-2 p-2', className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn('flex flex-col gap-2 p-2', className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn('bg-sidebar-border mx-2 w-auto', className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        'flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden',\n        className,\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn('relative flex w-full min-w-0 flex-col p-2', className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<'div'> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : 'div'\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        'text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0',\n        'group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0',\n        className,\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<'button'> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : 'button'\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        'text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0',\n        // Increases the hit area of the button on mobile.\n        'after:absolute after:-inset-2 md:after:hidden',\n        'group-data-[collapsible=icon]:hidden',\n        className,\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn('w-full text-sm', className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<'ul'>) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn('flex w-full min-w-0 flex-col gap-1', className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<'li'>) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn('group/menu-item relative', className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  'peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:size-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0',\n  {\n    variants: {\n      variant: {\n        default: 'hover:bg-sidebar-accent hover:text-sidebar-accent-foreground',\n        outline:\n          'bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]',\n      },\n      size: {\n        default: 'h-8 text-sm',\n        sm: 'h-7 text-xs',\n        lg: 'h-12 text-sm group-data-[collapsible=icon]:p-0!',\n      },\n    },\n    defaultVariants: {\n      variant: 'default',\n      size: 'default',\n    },\n  },\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = 'default',\n  size = 'default',\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<'button'> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : 'button'\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === 'string') {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== 'collapsed' || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<'button'> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : 'button'\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        'text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0',\n        // Increases the hit area of the button on mobile.\n        'after:absolute after:-inset-2 md:after:hidden',\n        'peer-data-[size=sm]/menu-button:top-1',\n        'peer-data-[size=default]/menu-button:top-1.5',\n        'peer-data-[size=lg]/menu-button:top-2.5',\n        'group-data-[collapsible=icon]:hidden',\n        showOnHover &&\n          'peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0',\n        className,\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        'text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none',\n        'peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground',\n        'peer-data-[size=sm]/menu-button:top-1',\n        'peer-data-[size=default]/menu-button:top-1.5',\n        'peer-data-[size=lg]/menu-button:top-2.5',\n        'group-data-[collapsible=icon]:hidden',\n        className,\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<'div'> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn('flex h-8 items-center gap-2 rounded-md px-2', className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-(--skeleton-width) flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            '--skeleton-width': width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<'ul'>) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        'border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5',\n        'group-data-[collapsible=icon]:hidden',\n        className,\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<'li'>) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn('group/menu-sub-item relative', className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = 'md',\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<'a'> & {\n  asChild?: boolean\n  size?: 'sm' | 'md'\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : 'a'\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        'text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline-hidden focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0',\n        'data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground',\n        size === 'sm' && 'text-xs',\n        size === 'md' && 'text-sm',\n        'group-data-[collapsible=icon]:hidden',\n        className,\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\skeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\slider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\sonner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\spinner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\switch.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\table.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\tabs.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\textarea.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\toast.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\toaster.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\toggle-group.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\toggle.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\tooltip.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\use-mobile.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\components\\ui\\use-toast.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'actionTypes' is assigned a value but only used as a type.","line":18,"column":7,"nodeType":"Identifier","messageId":"usedOnlyAsType","endLine":18,"endColumn":18}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\n// Inspired by react-hot-toast library\nimport * as React from 'react'\n\nimport type { ToastActionElement, ToastProps } from '@/components/ui/toast'\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: 'ADD_TOAST',\n  UPDATE_TOAST: 'UPDATE_TOAST',\n  DISMISS_TOAST: 'DISMISS_TOAST',\n  REMOVE_TOAST: 'REMOVE_TOAST',\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType['ADD_TOAST']\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType['UPDATE_TOAST']\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType['DISMISS_TOAST']\n      toastId?: ToasterToast['id']\n    }\n  | {\n      type: ActionType['REMOVE_TOAST']\n      toastId?: ToasterToast['id']\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: 'REMOVE_TOAST',\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case 'ADD_TOAST':\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case 'UPDATE_TOAST':\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t,\n        ),\n      }\n\n    case 'DISMISS_TOAST': {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t,\n        ),\n      }\n    }\n    case 'REMOVE_TOAST':\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, 'id'>\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: 'UPDATE_TOAST',\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: 'DISMISS_TOAST', toastId: id })\n\n  dispatch({\n    type: 'ADD_TOAST',\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: 'DISMISS_TOAST', toastId }),\n  }\n}\n\nexport { useToast, toast }\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\eslint.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\hooks\\use-mobile.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\hooks\\use-toast.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'actionTypes' is assigned a value but only used as a type.","line":18,"column":7,"nodeType":"Identifier","messageId":"usedOnlyAsType","endLine":18,"endColumn":18}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\n// Inspired by react-hot-toast library\nimport * as React from 'react'\n\nimport type { ToastActionElement, ToastProps } from '@/components/ui/toast'\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: 'ADD_TOAST',\n  UPDATE_TOAST: 'UPDATE_TOAST',\n  DISMISS_TOAST: 'DISMISS_TOAST',\n  REMOVE_TOAST: 'REMOVE_TOAST',\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType['ADD_TOAST']\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType['UPDATE_TOAST']\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType['DISMISS_TOAST']\n      toastId?: ToasterToast['id']\n    }\n  | {\n      type: ActionType['REMOVE_TOAST']\n      toastId?: ToasterToast['id']\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: 'REMOVE_TOAST',\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case 'ADD_TOAST':\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case 'UPDATE_TOAST':\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t,\n        ),\n      }\n\n    case 'DISMISS_TOAST': {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t,\n        ),\n      }\n    }\n    case 'REMOVE_TOAST':\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, 'id'>\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: 'UPDATE_TOAST',\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: 'DISMISS_TOAST', toastId: id })\n\n  dispatch({\n    type: 'ADD_TOAST',\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: 'DISMISS_TOAST', toastId }),\n  }\n}\n\nexport { useToast, toast }\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\hooks\\useOfflineData.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[218,221],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[218,221],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[237,240],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[237,240],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\David\\next-dashboard\\hooks\\useOfflineData.ts:35:5\n  33 |\n  34 |   useEffect(() => {\n> 35 |     refresh();\n     |     ^^^^^^^ Avoid calling setState() directly within an effect\n  36 |   }, []);\n  37 |\n  38 |   return { conflicts, isLoading, refresh };","line":35,"column":5,"nodeType":null,"endLine":35,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setPendingCount' is assigned a value but never used.","line":45,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":45,"endColumn":39},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setConflictsCount' is assigned a value but never used.","line":46,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":46,"endColumn":43},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\David\\next-dashboard\\hooks\\useOfflineData.ts:49:5\n  47 |\n  48 |   useEffect(() => {\n> 49 |     setIsOnline(typeof navigator !== 'undefined' ? navigator.onLine : true);\n     |     ^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  50 |     \n  51 |     const handleOnline = () => setIsOnline(true);\n  52 |     const handleOffline = () => setIsOnline(false);","line":49,"column":5,"nodeType":null,"endLine":49,"endColumn":16}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect } from 'react';\n\ntype ConflictType = 'maintenance' | 'booking' | 'flight_log' | 'aircraft_status';\n\ninterface ConflictItem {\n  id: number;\n  type: ConflictType;\n  localData: any;\n  serverData: any;\n  timestamp: number;\n  conflictType?: 'modified' | 'deleted';\n  detectedAt: number;\n}\n\ninterface UseOfflineDataReturn {\n  conflicts: ConflictItem[];\n  isLoading: boolean;\n  refresh: () => void;\n}\n\nexport function useConflicts(): UseOfflineDataReturn {\n  const [conflicts, setConflicts] = useState<ConflictItem[]>([]);\n  const [isLoading, setIsLoading] = useState(false);\n\n  const refresh = () => {\n    setIsLoading(true);\n    // Reset conflicts - offline sync not implemented\n    setConflicts([]);\n    setIsLoading(false);\n  };\n\n  useEffect(() => {\n    refresh();\n  }, []);\n\n  return { conflicts, isLoading, refresh };\n}\n\nexport function useSyncStatus() {\n  const [isOnline, setIsOnline] = useState(true);\n  const [lastSynced, setLastSynced] = useState<Date | null>(null);\n  const [isSyncing, setIsSyncing] = useState(false);\n  const [pendingCount, setPendingCount] = useState(0);\n  const [conflictsCount, setConflictsCount] = useState(0);\n\n  useEffect(() => {\n    setIsOnline(typeof navigator !== 'undefined' ? navigator.onLine : true);\n    \n    const handleOnline = () => setIsOnline(true);\n    const handleOffline = () => setIsOnline(false);\n    \n    window.addEventListener('online', handleOnline);\n    window.addEventListener('offline', handleOffline);\n    \n    return () => {\n      window.removeEventListener('online', handleOnline);\n      window.removeEventListener('offline', handleOffline);\n    };\n  }, []);\n\n  return { \n    isOffline: !isOnline, \n    isOnline, \n    lastSynced, \n    isSyncing, \n    setLastSynced, \n    setIsSyncing,\n    pendingCount,\n    conflictsCount\n  };\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\lib\\actions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\lib\\auth.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":31,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1170,1173],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1170,1173],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":40,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1496,1499],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1496,1499],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":50,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1892,1895],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1892,1895],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":149,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":149,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4717,4720],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4717,4720],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":149,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":149,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4729,4732],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4729,4732],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":149,"column":104,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":149,"endColumn":107,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4762,4765],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4762,4765],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":174,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":174,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5525,5528],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5525,5528],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":174,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":174,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5537,5540],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5537,5540],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'account' is defined but never used.","line":188,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":188,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'profile' is defined but never used.","line":188,"column":35,"nodeType":"Identifier","messageId":"unusedVar","endLine":188,"endColumn":42},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isNewUser' is defined but never used.","line":188,"column":44,"nodeType":"Identifier","messageId":"unusedVar","endLine":188,"endColumn":53},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":188,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":188,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6035,6038],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6035,6038],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":191,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":191,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6128,6131],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6128,6131],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import NextAuth from \"next-auth\"\nimport CredentialsProvider from \"next-auth/providers/credentials\"\nimport { PrismaClient } from \"@prisma/client\"\nimport bcrypt from \"bcrypt\"\n\nconst globalForPrisma = globalThis as unknown as { prisma?: PrismaClient };\n\nconst prisma = globalForPrisma.prisma ?? new PrismaClient({\n  log: process.env.NODE_ENV === \"development\" ? [\"error\"] : [\"error\"],\n});\n\nif (process.env.NODE_ENV !== \"production\") {\n  globalForPrisma.prisma = prisma;\n}\n\n// Auth secret\nconst authSecretEnv = process.env.AUTH_SECRET || process.env.NEXTAUTH_SECRET;\nconst authSecret = authSecretEnv || (process.env.NODE_ENV === 'production' ? undefined : 'dev-insecure-secret');\nif (!authSecret) {\n  if (process.env.NODE_ENV === 'production') {\n    throw new Error('Missing AUTH_SECRET (or NEXTAUTH_SECRET) in production');\n  }\n  console.warn('AUTH_SECRET is not set. Sessions will be unstable across restarts.');\n}\nconst siteUrl = process.env.NEXTAUTH_URL || process.env.AUTH_URL || \"https://koster.im\"\n\n// Cookie names based on environment\nconst isSecure = process.env.NODE_ENV === 'production'\nconst cookiePrefix = isSecure ? '__Secure-' : ''\n\nexport const authOptions: any = {\n  providers: [\n    CredentialsProvider({\n      name: \"credentials\",\n      credentials: {\n        username: { label: \"Username or Email\", type: \"text\" },\n        password: { label: \"Password\", type: \"password\" },\n        rememberMe: { label: \"Remember Me\", type: \"boolean\" }\n      },\n      async authorize(credentials: any) {\n        if (!credentials?.username || !credentials?.password) {\n          return null\n        }\n        \n        try {\n          const input = (credentials.username as string).trim().toLowerCase()\n          const rememberMe = credentials.rememberMe === 'true' || credentials.rememberMe === true\n          \n          // Try to find user by username first, then by email\n          let user: any = await prisma.user.findUnique({\n            where: { username: input }\n          })\n          \n          // If not found by username, try email (for backward compatibility)\n          if (!user) {\n            user = await prisma.user.findUnique({\n              where: { email: input }\n            })\n          }\n          \n          if (!user || !user.password) {\n            return null\n          }\n          \n          let isValid = false\n          \n          // Check if password is bcrypt hash (starts with $2) or plain text\n          if (user.password.startsWith('$2')) {\n            // It's a hashed password\n            isValid = await bcrypt.compare(credentials.password as string, user.password)\n          } else {\n            // Plain text password - direct comparison\n            isValid = user.password === credentials.password\n            // If valid, upgrade to hashed password\n            if (isValid) {\n              const hashed = await bcrypt.hash(credentials.password as string, 10)\n              await prisma.user.update({\n                where: { id: user.id },\n                data: { password: hashed }\n              })\n            }\n          }\n          \n          if (!isValid) return null\n          \n          return { \n            id: user.id, \n            email: user.email, \n            name: user.name,\n            username: user.username,\n            image: user.image,\n            emailVerified: user.emailVerified,\n            role: user.role,\n            tier: user.tier,\n            rememberMe: rememberMe // Pass to JWT\n          }\n        } catch (error) {\n          console.error('Authorize error:', error)\n          return null\n        }\n      }\n    })\n  ],\n  secret: authSecret,\n  url: siteUrl,\n  session: { \n    strategy: \"jwt\" as const,\n    // Default: 30 days for remembered sessions\n    maxAge: 30 * 24 * 60 * 60, \n    // Update session age on every request (sliding window)\n    updateAge: 24 * 60 * 60, // 24 hours\n  },\n  jwt: {\n    // JWT max age should match session maxAge\n    maxAge: 30 * 24 * 60 * 60,\n  },\n  pages: { signIn: \"/login\" },\n  cookies: {\n    sessionToken: {\n      name: `${cookiePrefix}next-auth.session-token`,\n      options: {\n        httpOnly: true,\n        sameSite: 'lax',\n        secure: isSecure,\n        maxAge: 30 * 24 * 60 * 60, // 30 days\n        path: '/',\n      },\n    },\n    callbackUrl: {\n      name: `${cookiePrefix}next-auth.callback-url`,\n      options: {\n        httpOnly: true,\n        sameSite: 'lax',\n        secure: isSecure,\n        path: '/',\n      },\n    },\n    csrfToken: {\n      name: `${cookiePrefix}next-auth.csrf-token`,\n      options: {\n        httpOnly: true,\n        sameSite: 'lax',\n        secure: isSecure,\n        path: '/',\n      },\n    },\n  },\n  callbacks: {\n    async jwt({ token, user, trigger, session }: { token: any; user?: any; trigger?: string; session?: any }) {\n      // Initial sign in\n      if (user) {\n        token.id = user.id\n        token.username = user.username\n        token.image = user.image\n        token.emailVerified = user.emailVerified\n        token.role = user.role\n        token.tier = user.tier\n        token.rememberMe = user.rememberMe\n        \n        // Set expiration based on rememberMe\n        if (!user.rememberMe) {\n          // Browser session only - expires when browser closes\n          token.exp = Math.floor(Date.now() / 1000) + (24 * 60 * 60) // 24 hours\n        }\n      }\n      \n      // Handle session updates\n      if (trigger === \"update\" && session) {\n        token.name = session.name\n      }\n      \n      return token\n    },\n    async session({ session, token }: { session: any; token: any }) {\n      if (session.user) {\n        session.user.id = token.id\n        session.user.username = token.username\n        session.user.image = token.image\n        session.user.emailVerified = token.emailVerified\n        session.user.role = token.role\n        session.user.tier = token.tier\n        session.expires = token.exp ? new Date(token.exp * 1000).toISOString() : session.expires\n      }\n      return session\n    }\n  },\n  events: {\n    async signIn({ user, account, profile, isNewUser }: any) {\n      console.log(\"User signed in:\", user?.email)\n    },\n    async signOut({ token }: any) {\n      console.log(\"User signed out:\", token?.email)\n    },\n  },\n  debug: process.env.NODE_ENV === 'development',\n}\n\nexport const { handlers, auth, signIn, signOut } = NextAuth(authOptions)\nexport { prisma }\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\lib\\billing.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":22,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[578,581],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[578,581],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":43,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1223,1226],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1223,1226],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":51,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1408,1411],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1408,1411],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":74,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2120,2123],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2120,2123],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":94,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2709,2712],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2709,2712],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":131,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":131,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4106,4109],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4106,4109],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":160,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":160,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5114,5117],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5114,5117],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { prisma } from '@/lib/prisma';\nimport { chargeCustomer } from './stripe';\n\nexport interface BillingResult {\n  userId: string;\n  email: string;\n  name: string;\n  success: boolean;\n  amount: number;\n  invoiceId?: string;\n  error?: string;\n}\n\nexport async function runBillingCycle(groupId: string): Promise<BillingResult[]> {\n  const results: BillingResult[] = [];\n\n  // Get the most recent billing run for this group\n  const lastRun = await prisma.$queryRawUnsafe(`\n    SELECT TOP 1 * FROM BillingRun \n    WHERE groupId = '${groupId}' \n    ORDER BY startedAt DESC\n  `) as any[];\n\n  const lastRunDate = lastRun && lastRun.length > 0 \n    ? new Date(lastRun[0].startedAt) \n    : new Date(0); // If no previous run, get all flights\n\n  // Get all flight logs since last billing run\n  const flightLogs = await prisma.$queryRawUnsafe(`\n    SELECT \n      fl.*,\n      a.nNumber,\n      a.hourlyRate,\n      a.groupId as aircraftGroupId,\n      u.email as userEmail,\n      u.name as userName\n    FROM FlightLog fl\n    JOIN ClubAircraft a ON fl.aircraftId = a.id\n    JOIN [User] u ON fl.userId = u.id\n    WHERE a.groupId = '${groupId}'\n    AND fl.createdAt > '${lastRunDate.toISOString()}'\n    ORDER BY fl.userId, fl.date\n  `) as any[];\n\n  if (!flightLogs || flightLogs.length === 0) {\n    console.log('No flights to bill');\n    return results;\n  }\n\n  // Group flights by user\n  const flightsByUser: Record<string, any[]> = {};\n  for (const flight of flightLogs) {\n    if (!flightsByUser[flight.userId]) {\n      flightsByUser[flight.userId] = [];\n    }\n    flightsByUser[flight.userId].push(flight);\n  }\n\n  // Create billing run record\n  const billingRunId = crypto.randomUUID();\n  await prisma.$executeRawUnsafe(`\n    INSERT INTO BillingRun (id, groupId, startedAt, status)\n    VALUES ('${billingRunId}', '${groupId}', GETDATE(), 'running')\n  `);\n\n  // Process each user's billing\n  for (const [userId, flights] of Object.entries(flightsByUser)) {\n    const user = flights[0];\n    const email = user.userEmail;\n    const name = user.userName || 'Member';\n    \n    // Calculate total\n    let total = 0;\n    const invoiceItems: any[] = [];\n    \n    for (const flight of flights) {\n      const hobbs = flight.hobbsTime ? Number(flight.hobbsTime) : 0;\n      const rate = flight.hourlyRate ? Number(flight.hourlyRate) : 0;\n      const amount = hobbs * rate;\n      total += amount;\n      \n      invoiceItems.push({\n        flightLogId: flight.id,\n        aircraftId: flight.aircraftId,\n        hobbsHours: hobbs,\n        hourlyRate: rate,\n        amount,\n      });\n    }\n\n    // Apply account credits\n    const userRecord = await prisma.$queryRawUnsafe(`\n      SELECT credits FROM [User] WHERE id = '${userId}'\n    `) as any[];\n    \n    let creditApplied = 0;\n    if (userRecord && userRecord.length > 0 && userRecord[0].credits > 0) {\n      creditApplied = Math.min(userRecord[0].credits, total);\n      total = total - creditApplied;\n      \n      // Deduct credits\n      await prisma.$executeRawUnsafe(`\n        UPDATE [User] SET credits = credits - ${creditApplied} WHERE id = '${userId}'\n      `);\n    }\n\n    // Create invoice\n    const invoiceId = crypto.randomUUID();\n    await prisma.$executeRawUnsafe(`\n      INSERT INTO Invoice (id, groupId, userId, billingRunId, totalAmount, status, createdAt)\n      VALUES ('${invoiceId}', '${groupId}', '${userId}', '${billingRunId}', ${total}, 'pending', GETDATE())\n    `);\n\n    // Create invoice items\n    for (const item of invoiceItems) {\n      const itemId = crypto.randomUUID();\n      await prisma.$executeRawUnsafe(`\n        INSERT INTO InvoiceItem (id, invoiceId, flightLogId, aircraftId, hobbsHours, hourlyRate, amount)\n        VALUES ('${itemId}', '${invoiceId}', '${item.flightLogId}', '${item.aircraftId}', ${item.hobbsHours}, ${item.hourlyRate}, ${item.amount})\n      `);\n    }\n\n    // Attempt Stripe charge\n    let success = false;\n    let error: string | undefined;\n    let stripePaymentId: string | undefined;\n\n    try {\n      const userDetails = await prisma.$queryRawUnsafe(`\n        SELECT stripeCustomerId FROM [User] WHERE id = '${userId}'\n      `) as any[];\n\n      if (userDetails && userDetails.length > 0 && userDetails[0].stripeCustomerId && total > 0) {\n        const charge = await chargeCustomer(\n          userDetails[0].stripeCustomerId,\n          total,\n          `Flight charges - ${flights.length} flights`\n        );\n        \n        if (charge.status === 'succeeded') {\n          success = true;\n          stripePaymentId = charge.id;\n          \n          // Update invoice status\n          await prisma.$executeRawUnsafe(`\n            UPDATE Invoice SET status = 'paid', stripePaymentId = '${stripePaymentId}' WHERE id = '${invoiceId}'\n          `);\n        } else {\n          error = `Payment ${charge.status}`;\n        }\n      } else if (total === 0) {\n        // No charge needed (credits covered everything)\n        success = true;\n        await prisma.$executeRawUnsafe(`\n          UPDATE Invoice SET status = 'paid' WHERE id = '${invoiceId}'\n        `);\n      } else {\n        error = 'No Stripe customer on file';\n      }\n    } catch (e: any) {\n      error = e.message || 'Stripe charge failed';\n    }\n\n    results.push({\n      userId,\n      email,\n      name,\n      success,\n      amount: total,\n      invoiceId,\n      error,\n    });\n  }\n\n  // Update billing run with results\n  const successCount = results.filter(r => r.success).length;\n  const failureCount = results.filter(r => !r.success).length;\n  const totalAmount = results.reduce((sum, r) => sum + r.amount, 0);\n\n  await prisma.$executeRawUnsafe(`\n    UPDATE BillingRun \n    SET status = 'completed', \n        completedAt = GETDATE(),\n        totalAmount = ${totalAmount},\n        successCount = ${successCount},\n        failureCount = ${failureCount},\n        details = '${JSON.stringify(results).replace(/'/g, \"''\")}'\n    WHERE id = '${billingRunId}'\n  `);\n\n  return results;\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\lib\\demo-aircraft.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\lib\\e2ee.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":52,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1290,1293],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1290,1293],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":61,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1631,1634],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1631,1634],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":87,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2455,2458],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2455,2458],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* E2EE helpers shared by client + API routes.\n\n   Server-side API routes import:\n   - validateE2eeEnvelopeString\n   - validateEcdhP256PublicJwk\n\n   Client-side UI uses:\n   - ensureIdentityKeypair (private key stored locally)\n   - publishMyPublicKey (publish public key to backend)\n   - encryptForUser / decryptWithUser (envelope strings)\n*/\n\nexport type E2EEPublicJwk = JsonWebKey & {\n  kty: 'EC';\n  crv: 'P-256';\n  x: string;\n  y: string;\n};\n\nexport type E2EEPrivateJwk = E2EEPublicJwk & {\n  d: string;\n};\n\nexport type E2EEEnvelopeV1 = {\n  v: 1;\n  alg: 'ECDH-P256/AES-GCM';\n  iv: string; // base64url\n  ct: string; // base64url\n};\n\nconst STORAGE = {\n  identityPrivateJwk: 'aviationhub.e2ee.identity.privateJwk',\n  identityPublicJwk: 'aviationhub.e2ee.identity.publicJwk',\n  peerKeyPrefix: 'aviationhub.e2ee.peerPub.',\n  publishedAt: 'aviationhub.e2ee.identity.publishedAt',\n} as const;\n\nfunction safeJsonParse<T>(input: string): T | null {\n  try {\n    return JSON.parse(input) as T;\n  } catch {\n    return null;\n  }\n}\n\nfunction isBase64Url(input: unknown) {\n  return typeof input === 'string' && input.length > 0 && /^[A-Za-z0-9_-]+$/.test(input);\n}\n\nfunction normalizePublicJwk(jwk: unknown): E2EEPublicJwk | null {\n  if (!jwk || typeof jwk !== 'object') return null;\n  const c = jwk as any;\n  if (c.kty !== 'EC' || c.crv !== 'P-256') return null;\n  if (typeof c.x !== 'string' || typeof c.y !== 'string') return null;\n  return { kty: 'EC', crv: 'P-256', x: c.x, y: c.y };\n}\n\nfunction normalizePrivateJwk(jwk: unknown): E2EEPrivateJwk | null {\n  const pub = normalizePublicJwk(jwk);\n  if (!pub) return null;\n  const d = (jwk as any).d;\n  if (typeof d !== 'string') return null;\n  return { ...pub, d };\n}\n\nexport function validateEcdhP256PublicJwk(input: unknown) {\n  const jwk = normalizePublicJwk(input);\n  if (!jwk) {\n    return { ok: false as const, error: 'Invalid publicKeyJwk (expected ECDH P-256 JWK)' };\n  }\n  return { ok: true as const, jwk };\n}\n\nexport function validateE2eeEnvelopeString(input: unknown, opts?: { maxLen?: number }) {\n  const maxLen = opts?.maxLen ?? 12_000;\n  if (typeof input !== 'string') {\n    return { ok: false as const, error: 'Body must be a string' };\n  }\n  const trimmed = input.trim();\n  if (!trimmed) {\n    return { ok: false as const, error: 'Body is required' };\n  }\n  if (trimmed.length > maxLen) {\n    return { ok: false as const, error: `Body too long (max ${maxLen})` };\n  }\n\n  const parsed = safeJsonParse<any>(trimmed);\n  if (!parsed || typeof parsed !== 'object') {\n    return { ok: false as const, error: 'Invalid E2EE envelope JSON' };\n  }\n  if (parsed.v !== 1) {\n    return { ok: false as const, error: 'Unsupported E2EE envelope version' };\n  }\n  if (parsed.alg !== 'ECDH-P256/AES-GCM') {\n    return { ok: false as const, error: 'Unsupported E2EE envelope alg' };\n  }\n  if (!isBase64Url(parsed.iv) || !isBase64Url(parsed.ct)) {\n    return { ok: false as const, error: 'Invalid E2EE envelope encoding' };\n  }\n\n  const envelope: E2EEEnvelopeV1 = {\n    v: 1,\n    alg: 'ECDH-P256/AES-GCM',\n    iv: parsed.iv,\n    ct: parsed.ct,\n  };\n\n  // Canonical, compact serialization (what the server stores).\n  const envelopeString = JSON.stringify(envelope);\n  return { ok: true as const, envelope, envelopeString };\n}\n\nfunction hasWebCrypto() {\n  return typeof window !== 'undefined' && !!globalThis.crypto?.subtle && !!globalThis.crypto?.getRandomValues;\n}\n\n// Browser-only base64url helpers (used by encrypt/decrypt).\nfunction encodeBase64Url(bytes: Uint8Array) {\n  let str = '';\n  for (let i = 0; i < bytes.length; i++) str += String.fromCharCode(bytes[i]);\n  const b64 = btoa(str);\n  return b64.replaceAll('+', '-').replaceAll('/', '_').replaceAll('=', '');\n}\n\nfunction decodeBase64Url(input: string) {\n  const b64 = input.replaceAll('-', '+').replaceAll('_', '/');\n  const pad = b64.length % 4 === 0 ? '' : '='.repeat(4 - (b64.length % 4));\n  const bin = atob(b64 + pad);\n  const out = new Uint8Array(bin.length);\n  for (let i = 0; i < bin.length; i++) out[i] = bin.charCodeAt(i);\n  return out;\n}\n\nexport async function ensureIdentityKeypair() {\n  if (!hasWebCrypto()) {\n    return { ok: false as const, reason: 'WebCrypto unavailable' };\n  }\n\n  const storedPriv = safeJsonParse<JsonWebKey>(localStorage.getItem(STORAGE.identityPrivateJwk) || '');\n  const storedPub = safeJsonParse<JsonWebKey>(localStorage.getItem(STORAGE.identityPublicJwk) || '');\n  const privJwk = storedPriv ? normalizePrivateJwk(storedPriv) : null;\n  const pubJwk = storedPub ? normalizePublicJwk(storedPub) : null;\n  if (privJwk && pubJwk) {\n    return { ok: true as const, publicJwk: pubJwk, privateJwk: privJwk };\n  }\n\n  const keyPair = await crypto.subtle.generateKey(\n    { name: 'ECDH', namedCurve: 'P-256' },\n    true,\n    ['deriveKey', 'deriveBits'],\n  );\n  const exportedPub = (await crypto.subtle.exportKey('jwk', keyPair.publicKey)) as JsonWebKey;\n  const exportedPriv = (await crypto.subtle.exportKey('jwk', keyPair.privateKey)) as JsonWebKey;\n\n  const nextPub = normalizePublicJwk(exportedPub);\n  const nextPriv = normalizePrivateJwk(exportedPriv);\n  if (!nextPub || !nextPriv) {\n    return { ok: false as const, reason: 'Failed to export keypair' };\n  }\n\n  localStorage.setItem(STORAGE.identityPublicJwk, JSON.stringify(nextPub));\n  localStorage.setItem(STORAGE.identityPrivateJwk, JSON.stringify(nextPriv));\n  return { ok: true as const, publicJwk: nextPub, privateJwk: nextPriv };\n}\n\nexport async function publishMyPublicKey() {\n  const identity = await ensureIdentityKeypair();\n  if (!identity.ok) return identity;\n\n  // Avoid hammering the endpoint (best-effort).\n  const last = Number(localStorage.getItem(STORAGE.publishedAt) || '0');\n  if (last && Date.now() - last < 6 * 60 * 60 * 1000) {\n    return { ok: true as const };\n  }\n\n  const res = await fetch('/api/e2ee/public-key', {\n    method: 'PUT',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({ publicKeyJwk: identity.publicJwk }),\n  });\n\n  if (!res.ok) {\n    const data = await res.json().catch(() => null);\n    return { ok: false as const, reason: data?.error || 'Failed to publish public key' };\n  }\n\n  localStorage.setItem(STORAGE.publishedAt, String(Date.now()));\n  return { ok: true as const };\n}\n\ntype StoredPeerKey = {\n  jwk: E2EEPublicJwk;\n  updatedAt: number;\n};\n\nexport function getCachedPeerPublicKey(userId: string): StoredPeerKey | null {\n  const raw = localStorage.getItem(`${STORAGE.peerKeyPrefix}${userId}`);\n  if (!raw) return null;\n  const parsed = safeJsonParse<StoredPeerKey>(raw);\n  if (!parsed) return null;\n  const jwk = normalizePublicJwk(parsed.jwk);\n  if (!jwk) return null;\n  return { jwk, updatedAt: typeof parsed.updatedAt === 'number' ? parsed.updatedAt : 0 };\n}\n\nexport async function fetchPeerPublicKey(userId: string) {\n  const res = await fetch(`/api/e2ee/public-key?userId=${encodeURIComponent(userId)}`);\n  if (!res.ok) {\n    const data = await res.json().catch(() => null);\n    return { ok: false as const, reason: data?.error || 'Failed to load peer public key' };\n  }\n  const data = await res.json().catch(() => null);\n  const validated = validateEcdhP256PublicJwk(data?.publicKeyJwk);\n  if (!validated.ok) {\n    return { ok: false as const, reason: validated.error };\n  }\n\n  const updatedAt = data?.updatedAt ? new Date(data.updatedAt).getTime() : 0;\n  const stored: StoredPeerKey = { jwk: validated.jwk, updatedAt: Number.isFinite(updatedAt) ? updatedAt : 0 };\n  localStorage.setItem(`${STORAGE.peerKeyPrefix}${userId}`, JSON.stringify(stored));\n  return { ok: true as const, ...stored };\n}\n\nasync function importPrivateKey(jwk: E2EEPrivateJwk) {\n  return crypto.subtle.importKey('jwk', jwk, { name: 'ECDH', namedCurve: 'P-256' }, false, [\n    'deriveKey',\n    'deriveBits',\n  ]);\n}\n\nasync function importPublicKey(jwk: E2EEPublicJwk) {\n  return crypto.subtle.importKey('jwk', jwk, { name: 'ECDH', namedCurve: 'P-256' }, false, []);\n}\n\nasync function deriveAesKey(ownPrivate: CryptoKey, peerPublic: CryptoKey) {\n  return crypto.subtle.deriveKey(\n    { name: 'ECDH', public: peerPublic },\n    ownPrivate,\n    { name: 'AES-GCM', length: 256 },\n    false,\n    ['encrypt', 'decrypt'],\n  );\n}\n\nexport async function encryptForPeer(peerPublicJwk: E2EEPublicJwk, plaintext: string) {\n  const identity = await ensureIdentityKeypair();\n  if (!identity.ok) return null;\n\n  const ownPriv = await importPrivateKey(identity.privateJwk);\n  const peerPub = await importPublicKey(peerPublicJwk);\n  const peerAes = await deriveAesKey(ownPriv, peerPub);\n\n  const iv = new Uint8Array(12);\n  crypto.getRandomValues(iv);\n  const encoded = new TextEncoder().encode(plaintext);\n  const ciphertext = await crypto.subtle.encrypt({ name: 'AES-GCM', iv }, peerAes, encoded);\n\n  const envelope: E2EEEnvelopeV1 = {\n    v: 1,\n    alg: 'ECDH-P256/AES-GCM',\n    iv: encodeBase64Url(iv),\n    ct: encodeBase64Url(new Uint8Array(ciphertext)),\n  };\n\n  return JSON.stringify(envelope);\n}\n\nexport async function decryptWithPeerPublicKey(peerPublicJwk: E2EEPublicJwk, envelopeString: string) {\n  const identity = await ensureIdentityKeypair();\n  if (!identity.ok) return null;\n\n  const validated = validateE2eeEnvelopeString(envelopeString, { maxLen: 50_000 });\n  if (!validated.ok) return null;\n\n  try {\n    const ownPriv = await importPrivateKey(identity.privateJwk);\n    const peerPub = await importPublicKey(peerPublicJwk);\n    const aes = await deriveAesKey(ownPriv, peerPub);\n\n    const iv = decodeBase64Url(validated.envelope.iv);\n    const ct = decodeBase64Url(validated.envelope.ct);\n    const plaintext = await crypto.subtle.decrypt({ name: 'AES-GCM', iv }, aes, ct);\n    return new TextDecoder().decode(new Uint8Array(plaintext));\n  } catch {\n    return null;\n  }\n}\n\nexport async function encryptForUser(peerUserId: string, plaintext: string) {\n  const peer = getCachedPeerPublicKey(peerUserId);\n  const peerKey = peer ? { ok: true as const, ...peer } : await fetchPeerPublicKey(peerUserId);\n  if (!peerKey.ok) {\n    return { ok: false as const, reason: peerKey.reason };\n  }\n\n  const envelopeString = await encryptForPeer(peerKey.jwk, plaintext);\n  if (!envelopeString) {\n    return { ok: false as const, reason: 'Encryption failed' };\n  }\n  return { ok: true as const, envelopeString };\n}\n\nexport async function decryptWithUser(peerUserId: string, envelopeString: string) {\n  const peer = getCachedPeerPublicKey(peerUserId);\n  const peerKey = peer ? { ok: true as const, ...peer } : await fetchPeerPublicKey(peerUserId);\n  if (!peerKey.ok) {\n    return { ok: false as const, reason: peerKey.reason };\n  }\n  const plaintext = await decryptWithPeerPublicKey(peerKey.jwk, envelopeString);\n  if (plaintext == null) {\n    return { ok: false as const, reason: 'Decryption failed' };\n  }\n  return { ok: true as const, plaintext };\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\lib\\email-templates.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\lib\\email.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\lib\\endorsements\\templates.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\lib\\engine\\anomaly-detection.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'avg' is defined but never used.","line":220,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":220,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'min' is defined but never used.","line":226,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":226,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'max' is defined but never used.","line":232,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":232,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Engine Anomaly Detection Rules\n// Based on industry best practices for Lycoming/Continental engines\n\nexport type AnomalyType = \n  | 'CHT_SPREAD'\n  | 'EGT_SPREAD' \n  | 'OIL_TEMP_HIGH'\n  | 'OIL_TEMP_LOW'\n  | 'OIL_PRESSURE_HIGH'\n  | 'OIL_PRESSURE_LOW'\n  | 'FUEL_FLOW_HIGH'\n  | 'FUEL_FLOW_LOW'\n  | 'CHT_HIGH'\n  | 'EGT_HIGH'\n\nexport type Severity = 'INFO' | 'WARNING' | 'CRITICAL'\n\nexport interface AnomalyThresholds {\n  // CHT (Cylinder Head Temperature)\n  chtNormalMax: number      // Normal max: 380Â°F\n  chtWarningMax: number     // Warning: 380-400Â°F\n  chtCriticalMax: number    // Critical: >400Â°F\n  chtSpreadWarning: number  // Warning spread: >25Â°F\n  chtSpreadCritical: number  // Critical spread: >40Â°F\n  \n  // EGT (Exhaust Gas Temperature)\n  egtSpreadWarning: number  // Warning spread: >50Â°F\n  egtSpreadCritical: number // Critical spread: >75Â°F\n  \n  // Oil Temperature\n  oilTempNormalMax: number   // Normal: 180-220Â°F\n  oilTempWarningMax: number // Warning: 220-240Â°F\n  oilTempCriticalMax: number // Critical: >240Â°F\n  \n  // Oil Pressure\n  oilPressureNormalMin: number   // Normal: 25-65 PSI\n  oilPressureWarningMin: number  // Warning: 20-25 PSI\n  oilPressureCriticalMin: number // Critical: <20 PSI\n  oilPressureWarningMax: number  // Warning: 65-80 PSI\n  oilPressureCriticalMax: number // Critical: >80 PSI\n  \n  // Fuel Flow\n  fuelFlowVarianceWarning: number   // Warning: >10% variance\n  fuelFlowVarianceCritical: number  // Critical: >20% variance\n}\n\nexport const DEFAULT_THRESHOLDS: AnomalyThresholds = {\n  chtNormalMax: 380,\n  chtWarningMax: 400,\n  chtCriticalMax: 420,\n  chtSpreadWarning: 25,\n  chtSpreadCritical: 40,\n  egtSpreadWarning: 50,\n  egtSpreadCritical: 75,\n  oilTempNormalMax: 220,\n  oilTempWarningMax: 240,\n  oilTempCriticalMax: 260,\n  oilPressureNormalMin: 25,\n  oilPressureWarningMin: 20,\n  oilPressureCriticalMin: 15,\n  oilPressureWarningMax: 80,\n  oilPressureCriticalMax: 90,\n  fuelFlowVarianceWarning: 10,\n  fuelFlowVarianceCritical: 20,\n}\n\nexport interface ParsedEngineData {\n  flightDate: Date\n  flightDuration: number // hours\n  chtMin?: number\n  chtMax?: number\n  chtAvg?: number\n  chtValues?: number[] // per cylinder\n  egtMin?: number\n  egtMax?: number\n  egtAvg?: number\n  egtValues?: number[] // per cylinder\n  fuelFlowMin?: number\n  fuelFlowMax?: number\n  fuelFlowAvg?: number\n  fuelUsed?: number\n  oilTempMin?: number\n  oilTempMax?: number\n  oilPressureMin?: number\n  oilPressureMax?: number\n  rpmAvg?: number\n  manifoldPressure?: number\n}\n\nexport interface AnomalyResult {\n  type: AnomalyType\n  severity: Severity\n  value: number\n  threshold: number\n  message: string\n}\n\nexport function detectAnomalies(\n  data: ParsedEngineData,\n  thresholds: AnomalyThresholds = DEFAULT_THRESHOLDS\n): AnomalyResult[] {\n  const anomalies: AnomalyResult[] = []\n  \n  // CHT Spread (difference between hottest and coldest cylinder)\n  if (data.chtValues && data.chtValues.length > 1) {\n    const minCht = Math.min(...data.chtValues)\n    const maxCht = Math.max(...data.chtValues)\n    const spread = maxCht - minCht\n    \n    if (spread >= thresholds.chtSpreadCritical) {\n      anomalies.push({\n        type: 'CHT_SPREAD',\n        severity: 'CRITICAL',\n        value: spread,\n        threshold: thresholds.chtSpreadCritical,\n        message: `CHT spread of ${spread.toFixed(1)}Â°F exceeds critical threshold of ${thresholds.chtSpreadCritical}Â°F. Check for fouled plugs, faulty cylinders, or ignition issues.`\n      })\n    } else if (spread >= thresholds.chtSpreadWarning) {\n      anomalies.push({\n        type: 'CHT_SPREAD',\n        severity: 'WARNING',\n        value: spread,\n        threshold: thresholds.chtSpreadWarning,\n        message: `CHT spread of ${spread.toFixed(1)}Â°F is above normal (${thresholds.chtSpreadWarning}Â°F threshold). Monitor cylinder temperatures.`\n      })\n    }\n  }\n  \n  // EGT Spread\n  if (data.egtValues && data.egtValues.length > 1) {\n    const minEgt = Math.min(...data.egtValues)\n    const maxEgt = Math.max(...data.egtValues)\n    const spread = maxEgt - minEgt\n    \n    if (spread >= thresholds.egtSpreadCritical) {\n      anomalies.push({\n        type: 'EGT_SPREAD',\n        severity: 'CRITICAL',\n        value: spread,\n        threshold: thresholds.egtSpreadCritical,\n        message: `EGT spread of ${spread.toFixed(1)}Â°F exceeds critical threshold. Possible lean cylinder or exhaust issue.`\n      })\n    } else if (spread >= thresholds.egtSpreadWarning) {\n      anomalies.push({\n        type: 'EGT_SPREAD',\n        severity: 'WARNING',\n        value: spread,\n        threshold: thresholds.egtSpreadWarning,\n        message: `EGT spread of ${spread.toFixed(1)}Â°F is above normal.`\n      })\n    }\n  }\n  \n  // Oil Temperature\n  if (data.oilTempMax) {\n    if (data.oilTempMax >= thresholds.oilTempCriticalMax) {\n      anomalies.push({\n        type: 'OIL_TEMP_HIGH',\n        severity: 'CRITICAL',\n        value: data.oilTempMax,\n        threshold: thresholds.oilTempCriticalMax,\n        message: `Oil temperature of ${data.oilTempMax.toFixed(0)}Â°F exceeds critical threshold. Land ASAP and investigate.`\n      })\n    } else if (data.oilTempMax >= thresholds.oilTempWarningMax) {\n      anomalies.push({\n        type: 'OIL_TEMP_HIGH',\n        severity: 'WARNING',\n        value: data.oilTempMax,\n        threshold: thresholds.oilTempWarningMax,\n        message: `Oil temperature of ${data.oilTempMax.toFixed(0)}Â°F is elevated. Monitor closely.`\n      })\n    }\n  }\n  \n  // Oil Pressure\n  if (data.oilPressureMin) {\n    if (data.oilPressureMin <= thresholds.oilPressureCriticalMin) {\n      anomalies.push({\n        type: 'OIL_PRESSURE_LOW',\n        severity: 'CRITICAL',\n        value: data.oilPressureMin,\n        threshold: thresholds.oilPressureCriticalMin,\n        message: `Oil pressure of ${data.oilPressureMin.toFixed(1)} PSI is critically low. Land immediately.`\n      })\n    } else if (data.oilPressureMin <= thresholds.oilPressureWarningMin) {\n      anomalies.push({\n        type: 'OIL_PRESSURE_LOW',\n        severity: 'WARNING',\n        value: data.oilPressureMin,\n        threshold: thresholds.oilPressureWarningMin,\n        message: `Oil pressure of ${data.oilPressureMin.toFixed(1)} PSI is below normal.`\n      })\n    }\n  }\n  \n  if (data.oilPressureMax) {\n    if (data.oilPressureMax >= thresholds.oilPressureCriticalMax) {\n      anomalies.push({\n        type: 'OIL_PRESSURE_HIGH',\n        severity: 'CRITICAL',\n        value: data.oilPressureMax,\n        threshold: thresholds.oilPressureCriticalMax,\n        message: `Oil pressure of ${data.oilPressureMax.toFixed(1)} PSI is critically high.`\n      })\n    } else if (data.oilPressureMax >= thresholds.oilPressureWarningMax) {\n      anomalies.push({\n        type: 'OIL_PRESSURE_HIGH',\n        severity: 'WARNING',\n        value: data.oilPressureMax,\n        threshold: thresholds.oilPressureWarningMax,\n        message: `Oil pressure of ${data.oilPressureMax.toFixed(1)} PSI is elevated.`\n      })\n    }\n  }\n  \n  return anomalies\n}\n\n// Calculate average from array, ignoring undefined/null\nfunction avg(arr: (number | undefined)[]): number {\n  const valid = arr.filter((v): v is number => v !== undefined && v !== null)\n  return valid.length > 0 ? valid.reduce((a, b) => a + b, 0) / valid.length : 0\n}\n\n// Calculate min from array\nfunction min(arr: (number | undefined)[]): number | undefined {\n  const valid = arr.filter((v): v is number => v !== undefined && v !== null)\n  return valid.length > 0 ? Math.min(...valid) : undefined\n}\n\n// Calculate max from array\nfunction max(arr: (number | undefined)[]): number | undefined {\n  const valid = arr.filter((v): v is number => v !== undefined && v !== null)\n  return valid.length > 0 ? Math.max(...valid) : undefined\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\lib\\engine\\parser.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\lib\\integrations\\quickbooks-client.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":204,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":204,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5940,5943],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5940,5943],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":248,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":248,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7184,7187],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7184,7187],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":256,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":256,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7400,7403],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7400,7403],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":256,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":256,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7432,7435],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7432,7435],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":269,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":269,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7851,7854],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7851,7854],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":277,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":277,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8051,8054],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8051,8054],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":277,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":277,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8083,8086],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8083,8086],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":290,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":290,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8476,8479],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8476,8479],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":298,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":298,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8688,8691],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8688,8691],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":298,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":298,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8720,8723],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8720,8723],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":311,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":311,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9106,9109],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9106,9109],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":311,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":311,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9138,9141],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9138,9141],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":324,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":324,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9547,9550],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9547,9550],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":13,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * QuickBooks API Client\n * Handles OAuth, token management, and API requests to QuickBooks Online\n */\n\nimport { prisma } from '@/lib/prisma'\n\n// QuickBooks OAuth endpoints\nconst QB_AUTH_URL = 'https://appcenter.intuit.com/connect/oauth2'\nconst QB_TOKEN_URL = 'https://oauth.platform.intuit.com/oauth2/v1/tokens/bearer'\nconst QB_REVOKE_URL = 'https://developer.api.intuit.com/v2/oauth2/tokens/revoke'\nconst QB_API_BASE = process.env.QUICKBOOKS_ENVIRONMENT === 'production'\n  ? 'https://quickbooks.api.intuit.com'\n  : 'https://sandbox-quickbooks.api.intuit.com'\n\ninterface QuickBooksConfig {\n  clientId: string\n  clientSecret: string\n  redirectUri: string\n  environment: 'sandbox' | 'production'\n}\n\nexport class QuickBooksClient {\n  private config: QuickBooksConfig\n  private integrationId?: string\n\n  constructor(config?: Partial<QuickBooksConfig>, integrationId?: string) {\n    this.config = {\n      clientId: config?.clientId || process.env.QUICKBOOKS_CLIENT_ID || '',\n      clientSecret: config?.clientSecret || process.env.QUICKBOOKS_CLIENT_SECRET || '',\n      redirectUri: config?.redirectUri || process.env.QUICKBOOKS_REDIRECT_URI || '',\n      environment: (config?.environment || process.env.QUICKBOOKS_ENVIRONMENT || 'sandbox') as 'sandbox' | 'production',\n    }\n    this.integrationId = integrationId\n  }\n\n  /**\n   * Generate OAuth authorization URL\n   */\n  getAuthorizationUrl(state: string, groupId: string): string {\n    const params = new URLSearchParams({\n      client_id: this.config.clientId,\n      redirect_uri: this.config.redirectUri,\n      response_type: 'code',\n      scope: 'com.intuit.quickbooks.accounting',\n      state: `${groupId}:${state}`, // Encode groupId in state\n    })\n\n    return `${QB_AUTH_URL}?${params.toString()}`\n  }\n\n  /**\n   * Exchange authorization code for access token\n   */\n  async exchangeCodeForToken(code: string): Promise<{\n    accessToken: string\n    refreshToken: string\n    expiresIn: number\n    realmId: string\n  }> {\n    const auth = Buffer.from(`${this.config.clientId}:${this.config.clientSecret}`).toString('base64')\n\n    const response = await fetch(QB_TOKEN_URL, {\n      method: 'POST',\n      headers: {\n        'Authorization': `Basic ${auth}`,\n        'Content-Type': 'application/x-www-form-urlencoded',\n        'Accept': 'application/json',\n      },\n      body: new URLSearchParams({\n        grant_type: 'authorization_code',\n        code: code,\n        redirect_uri: this.config.redirectUri,\n      }),\n    })\n\n    if (!response.ok) {\n      const error = await response.text()\n      throw new Error(`QuickBooks OAuth error: ${error}`)\n    }\n\n    const data = await response.json()\n    \n    return {\n      accessToken: data.access_token,\n      refreshToken: data.refresh_token,\n      expiresIn: data.expires_in,\n      realmId: data.realm_id || '',\n    }\n  }\n\n  /**\n   * Refresh access token\n   */\n  async refreshAccessToken(refreshToken: string): Promise<{\n    accessToken: string\n    refreshToken: string\n    expiresIn: number\n  }> {\n    const auth = Buffer.from(`${this.config.clientId}:${this.config.clientSecret}`).toString('base64')\n\n    const response = await fetch(QB_TOKEN_URL, {\n      method: 'POST',\n      headers: {\n        'Authorization': `Basic ${auth}`,\n        'Content-Type': 'application/x-www-form-urlencoded',\n        'Accept': 'application/json',\n      },\n      body: new URLSearchParams({\n        grant_type: 'refresh_token',\n        refresh_token: refreshToken,\n      }),\n    })\n\n    if (!response.ok) {\n      const error = await response.text()\n      throw new Error(`QuickBooks token refresh error: ${error}`)\n    }\n\n    const data = await response.json()\n    \n    return {\n      accessToken: data.access_token,\n      refreshToken: data.refresh_token,\n      expiresIn: data.expires_in,\n    }\n  }\n\n  /**\n   * Revoke OAuth tokens (disconnect)\n   */\n  async revokeToken(token: string): Promise<void> {\n    const auth = Buffer.from(`${this.config.clientId}:${this.config.clientSecret}`).toString('base64')\n\n    const response = await fetch(QB_REVOKE_URL, {\n      method: 'POST',\n      headers: {\n        'Authorization': `Basic ${auth}`,\n        'Content-Type': 'application/x-www-form-urlencoded',\n        'Accept': 'application/json',\n      },\n      body: new URLSearchParams({\n        token: token,\n      }),\n    })\n\n    if (!response.ok) {\n      const error = await response.text()\n      throw new Error(`QuickBooks revoke error: ${error}`)\n    }\n  }\n\n  /**\n   * Get valid access token (refresh if needed)\n   */\n  async getValidAccessToken(integrationId: string): Promise<string> {\n    const integration = await prisma.integration.findUnique({\n      where: { id: integrationId },\n    })\n\n    if (!integration || integration.provider !== 'quickbooks') {\n      throw new Error('QuickBooks integration not found')\n    }\n\n    if (!integration.accessToken || !integration.refreshToken) {\n      throw new Error('No OAuth tokens found')\n    }\n\n    // Check if token is expired (refresh 5 minutes before expiry)\n    const now = new Date()\n    const expiryBuffer = new Date(integration.tokenExpiry || 0)\n    expiryBuffer.setMinutes(expiryBuffer.getMinutes() - 5)\n\n    if (now >= expiryBuffer) {\n      // Token expired or about to expire, refresh it\n      const { accessToken, refreshToken, expiresIn } = await this.refreshAccessToken(integration.refreshToken)\n      \n      // Update database\n      const tokenExpiry = new Date()\n      tokenExpiry.setSeconds(tokenExpiry.getSeconds() + expiresIn)\n\n      await prisma.integration.update({\n        where: { id: integrationId },\n        data: {\n          accessToken,\n          refreshToken,\n          tokenExpiry,\n          updatedAt: new Date(),\n        },\n      })\n\n      return accessToken\n    }\n\n    return integration.accessToken\n  }\n\n  /**\n   * Make authenticated API request to QuickBooks\n   */\n  async makeRequest(\n    endpoint: string,\n    options: RequestInit & { realmId?: string } = {}\n  ): Promise<any> {\n    if (!this.integrationId) {\n      throw new Error('Integration ID required for API requests')\n    }\n\n    const integration = await prisma.integration.findUnique({\n      where: { id: this.integrationId },\n    })\n\n    if (!integration) {\n      throw new Error('Integration not found')\n    }\n\n    const accessToken = await this.getValidAccessToken(this.integrationId)\n    const realmId = options.realmId || integration.realmId\n\n    if (!realmId) {\n      throw new Error('QuickBooks Company ID (realmId) not found')\n    }\n\n    const url = `${QB_API_BASE}/v3/company/${realmId}/${endpoint}`\n\n    const response = await fetch(url, {\n      ...options,\n      headers: {\n        'Authorization': `Bearer ${accessToken}`,\n        'Accept': 'application/json',\n        'Content-Type': 'application/json',\n        ...options.headers,\n      },\n    })\n\n    if (!response.ok) {\n      const error = await response.text()\n      throw new Error(`QuickBooks API error: ${error}`)\n    }\n\n    return response.json()\n  }\n\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  // API Methods - Customers\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\n  async getCustomers(realmId?: string): Promise<any[]> {\n    const data = await this.makeRequest('query?query=SELECT * FROM Customer', {\n      method: 'GET',\n      realmId,\n    })\n    return data.QueryResponse?.Customer || []\n  }\n\n  async createCustomer(customer: any, realmId?: string): Promise<any> {\n    const data = await this.makeRequest('customer', {\n      method: 'POST',\n      body: JSON.stringify(customer),\n      realmId,\n    })\n    return data.Customer\n  }\n\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  // API Methods - Items (Products/Services)\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\n  async getItems(realmId?: string): Promise<any[]> {\n    const data = await this.makeRequest('query?query=SELECT * FROM Item', {\n      method: 'GET',\n      realmId,\n    })\n    return data.QueryResponse?.Item || []\n  }\n\n  async createItem(item: any, realmId?: string): Promise<any> {\n    const data = await this.makeRequest('item', {\n      method: 'POST',\n      body: JSON.stringify(item),\n      realmId,\n    })\n    return data.Item\n  }\n\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  // API Methods - Invoices\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\n  async getInvoices(realmId?: string): Promise<any[]> {\n    const data = await this.makeRequest('query?query=SELECT * FROM Invoice', {\n      method: 'GET',\n      realmId,\n    })\n    return data.QueryResponse?.Invoice || []\n  }\n\n  async createInvoice(invoice: any, realmId?: string): Promise<any> {\n    const data = await this.makeRequest('invoice', {\n      method: 'POST',\n      body: JSON.stringify(invoice),\n      realmId,\n    })\n    return data.Invoice\n  }\n\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  // API Methods - Payments\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\n  async createPayment(payment: any, realmId?: string): Promise<any> {\n    const data = await this.makeRequest('payment', {\n      method: 'POST',\n      body: JSON.stringify(payment),\n      realmId,\n    })\n    return data.Payment\n  }\n\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  // API Methods - Company Info\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\n  async getCompanyInfo(realmId?: string): Promise<any> {\n    const data = await this.makeRequest('companyinfo/' + (realmId || ''), {\n      method: 'GET',\n      realmId,\n    })\n    return data.CompanyInfo\n  }\n}\n\n// Export singleton instance\nexport const quickbooksClient = new QuickBooksClient()\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\lib\\invoice.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\lib\\message-safety.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\lib\\modules.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\lib\\offline-db.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ALL_STORES' is assigned a value but only used as a type.","line":22,"column":7,"nodeType":"Identifier","messageId":"usedOnlyAsType","endLine":22,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AllStore' is defined but never used.","line":25,"column":6,"nodeType":"Identifier","messageId":"unusedVar","endLine":25,"endColumn":14}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * IndexedDB Layer for Offline-First Aviation Dashboard\n * \n * Provides caching for Flying Club data and sync queue for offline changes.\n * Uses lazy loading and batched writes for performance on older devices.\n */\n\nconst DB_NAME = 'aviation-dashboard';\nconst DB_VERSION = 1;\n\n// Cache stores - data from server\nconst CACHE_STORES = [\n  'groups',\n  'aircraft',\n  'bookings',\n  'flightLogs',\n  'maintenance',\n  'members',\n] as const;\n\n// All stores\nconst ALL_STORES = [...CACHE_STORES, 'syncQueue', 'conflicts', 'settings'] as const;\n\ntype CacheStore = typeof CACHE_STORES[number];\ntype AllStore = typeof ALL_STORES[number];\n\n// Sync queue item\ninterface SyncQueueItem {\n  id?: number;\n  type: 'flight_log' | 'maintenance' | 'aircraft_status' | 'booking';\n  action: 'create' | 'update' | 'delete';\n  data: Record<string, unknown>;\n  userId: string;\n  localCreatedAt: string;\n  localLastSyncedAt?: string;\n  localId?: string;\n  retries?: number;\n}\n\n// Conflict item\nexport interface ConflictItem {\n  id?: number;\n  type: 'flight_log' | 'maintenance' | 'aircraft_status' | 'booking';\n  localData: Record<string, unknown>;\n  serverData: Record<string, unknown>;\n  conflictType: 'modified' | 'deleted';\n  detectedAt: string;\n  resolved: boolean;\n}\n\n// Settings - use generic key-value\ninterface SettingItem {\n  key: string;\n  value: unknown;\n}\n\nlet dbInstance: IDBDatabase | null = null;\n\n/**\n * Initialize the IndexedDB database\n */\nasync function initDB(): Promise<IDBDatabase> {\n  if (dbInstance) return dbInstance;\n\n  return new Promise((resolve, reject) => {\n    const request = indexedDB.open(DB_NAME, DB_VERSION);\n\n    request.onerror = () => {\n      console.error('IndexedDB open error:', request.error);\n      reject(request.error);\n    };\n\n    request.onsuccess = () => {\n      dbInstance = request.result;\n      resolve(dbInstance);\n    };\n\n    request.onupgradeneeded = (event) => {\n      const db = (event.target as IDBOpenDBRequest).result;\n\n      // Create cache stores\n      CACHE_STORES.forEach((storeName) => {\n        if (!db.objectStoreNames.contains(storeName)) {\n          const store = db.createObjectStore(storeName, { keyPath: 'id' });\n          // Create indexes for common queries\n          if (storeName === 'flightLogs') {\n            store.createIndex('date', 'date', { unique: false });\n            store.createIndex('aircraftId', 'aircraftId', { unique: false });\n          }\n          if (storeName === 'bookings') {\n            store.createIndex('startTime', 'startTime', { unique: false });\n            store.createIndex('aircraftId', 'aircraftId', { unique: false });\n          }\n          if (storeName === 'maintenance') {\n            store.createIndex('status', 'status', { unique: false });\n            store.createIndex('aircraftId', 'aircraftId', { unique: false });\n          }\n        }\n      });\n\n      // Sync queue store\n      if (!db.objectStoreNames.contains('syncQueue')) {\n        const syncStore = db.createObjectStore('syncQueue', { keyPath: 'id', autoIncrement: true });\n        syncStore.createIndex('type', 'type', { unique: false });\n        syncStore.createIndex('localCreatedAt', 'localCreatedAt', { unique: false });\n      }\n\n      // Conflicts store\n      if (!db.objectStoreNames.contains('conflicts')) {\n        const conflictStore = db.createObjectStore('conflicts', { keyPath: 'id', autoIncrement: true });\n        conflictStore.createIndex('type', 'type', { unique: false });\n        conflictStore.createIndex('resolved', 'resolved', { unique: false });\n      }\n\n      // Settings store\n      if (!db.objectStoreNames.contains('settings')) {\n        db.createObjectStore('settings', { keyPath: 'key' });\n      }\n    };\n  });\n}\n\n/**\n * Get database instance\n */\nexport async function getDB(): Promise<IDBDatabase> {\n  return initDB();\n}\n\n// ============================================\n// CACHE OPERATIONS\n// ============================================\n\n/**\n * Cache data for a specific store (batched for performance)\n */\nexport async function cacheData<T>(storeName: CacheStore, data: T[]): Promise<void> {\n  const db = await initDB();\n  \n  return new Promise((resolve, reject) => {\n    const transaction = db.transaction(storeName, 'readwrite');\n    const store = transaction.objectStore(storeName);\n\n    // Clear existing data and add new\n    store.clear();\n\n    if (data.length === 0) {\n      transaction.oncomplete = () => resolve();\n      transaction.onerror = () => reject(transaction.error);\n      return;\n    }\n\n    // Batch add all items\n    data.forEach((item) => {\n      store.add(item);\n    });\n\n    transaction.oncomplete = () => resolve();\n    transaction.onerror = () => reject(transaction.error);\n  });\n}\n\n/**\n * Get cached data for a specific store\n */\nexport async function getCachedData<T>(storeName: CacheStore): Promise<T[]> {\n  const db = await initDB();\n\n  return new Promise((resolve, reject) => {\n    const transaction = db.transaction(storeName, 'readonly');\n    const store = transaction.objectStore(storeName);\n    const request = store.getAll();\n\n    request.onsuccess = () => resolve(request.result || []);\n    request.onerror = () => reject(request.error);\n  });\n}\n\n/**\n * Get a single cached item by ID\n */\nexport async function getCachedItem<T>(storeName: CacheStore, id: string): Promise<T | undefined> {\n  const db = await initDB();\n\n  return new Promise((resolve, reject) => {\n    const transaction = db.transaction(storeName, 'readonly');\n    const store = transaction.objectStore(storeName);\n    const request = store.get(id);\n\n    request.onsuccess = () => resolve(request.result);\n    request.onerror = () => reject(request.error);\n  });\n}\n\n/**\n * Update a single cached item\n */\nexport async function updateCachedItem<T extends { id: string }>(\n  storeName: CacheStore,\n  item: T\n): Promise<void> {\n  const db = await initDB();\n\n  return new Promise((resolve, reject) => {\n    const transaction = db.transaction(storeName, 'readwrite');\n    const store = transaction.objectStore(storeName);\n    const request = store.put(item);\n\n    request.onsuccess = () => resolve();\n    request.onerror = () => reject(request.error);\n  });\n}\n\n/**\n * Delete a cached item\n */\nexport async function deleteCachedItem(storeName: CacheStore, id: string): Promise<void> {\n  const db = await initDB();\n\n  return new Promise((resolve, reject) => {\n    const transaction = db.transaction(storeName, 'readwrite');\n    const store = transaction.objectStore(storeName);\n    const request = store.delete(id);\n\n    request.onsuccess = () => resolve();\n    request.onerror = () => reject(request.error);\n  });\n}\n\n/**\n * Clear all cached data\n */\nexport async function clearAllCache(): Promise<void> {\n  const db = await initDB();\n\n  return new Promise((resolve, reject) => {\n    const transaction = db.transaction(CACHE_STORES, 'readwrite');\n    \n    CACHE_STORES.forEach((storeName) => {\n      transaction.objectStore(storeName).clear();\n    });\n\n    transaction.oncomplete = () => resolve();\n    transaction.onerror = () => reject(transaction.error);\n  });\n}\n\n// ============================================\n// SYNC QUEUE OPERATIONS\n// ============================================\n\n/**\n * Add an item to the sync queue\n */\nexport async function queueChange(item: Omit<SyncQueueItem, 'id'>): Promise<number> {\n  const db = await initDB();\n\n  return new Promise((resolve, reject) => {\n    const transaction = db.transaction('syncQueue', 'readwrite');\n    const store = transaction.objectStore('syncQueue');\n    const request = store.add(item);\n\n    request.onsuccess = () => resolve(request.result as number);\n    request.onerror = () => reject(request.error);\n  });\n}\n\n/**\n * Get all pending sync items\n */\nexport async function getSyncQueue(): Promise<SyncQueueItem[]> {\n  const db = await initDB();\n\n  return new Promise((resolve, reject) => {\n    const transaction = db.transaction('syncQueue', 'readonly');\n    const store = transaction.objectStore('syncQueue');\n    const index = store.index('localCreatedAt');\n    const request = index.getAll();\n\n    request.onsuccess = () => resolve(request.result || []);\n    request.onerror = () => reject(request.error);\n  });\n}\n\n/**\n * Get count of pending sync items\n */\nexport async function getSyncQueueCount(): Promise<number> {\n  const db = await initDB();\n\n  return new Promise((resolve, reject) => {\n    const transaction = db.transaction('syncQueue', 'readonly');\n    const store = transaction.objectStore('syncQueue');\n    const request = store.count();\n\n    request.onsuccess = () => resolve(request.result);\n    request.onerror = () => reject(request.error);\n  });\n}\n\n/**\n * Remove items from sync queue after successful sync\n */\nexport async function clearSyncedItems(ids: number[]): Promise<void> {\n  const db = await initDB();\n\n  return new Promise((resolve, reject) => {\n    const transaction = db.transaction('syncQueue', 'readwrite');\n    const store = transaction.objectStore('syncQueue');\n\n    ids.forEach((id) => {\n      store.delete(id);\n    });\n\n    transaction.oncomplete = () => resolve();\n    transaction.onerror = () => reject(transaction.error);\n  });\n}\n\n/**\n * Update a sync queue item (e.g., increment retries)\n */\nexport async function updateSyncItem(id: number, updates: Partial<SyncQueueItem>): Promise<void> {\n  const db = await initDB();\n\n  return new Promise((resolve, reject) => {\n    const transaction = db.transaction('syncQueue', 'readwrite');\n    const store = transaction.objectStore('syncQueue');\n    \n    const getRequest = store.get(id);\n    getRequest.onsuccess = () => {\n      const item = getRequest.result;\n      if (item) {\n        store.put({ ...item, ...updates });\n      }\n    };\n    getRequest.onerror = () => reject(getRequest.error);\n\n    transaction.oncomplete = () => resolve();\n    transaction.onerror = () => reject(transaction.error);\n  });\n}\n\n// ============================================\n// CONFLICT OPERATIONS\n// ============================================\n\n/**\n * Store a conflict for later resolution\n */\nexport async function storeConflict(item: Omit<ConflictItem, 'id'>): Promise<number> {\n  const db = await initDB();\n\n  return new Promise((resolve, reject) => {\n    const transaction = db.transaction('conflicts', 'readwrite');\n    const store = transaction.objectStore('conflicts');\n    const request = store.add(item);\n\n    request.onsuccess = () => resolve(request.result as number);\n    request.onerror = () => reject(request.error);\n  });\n}\n\n/**\n * Get all unresolved conflicts\n */\nexport async function getConflicts(): Promise<ConflictItem[]> {\n  const db = await initDB();\n\n  return new Promise((resolve, reject) => {\n    const transaction = db.transaction('conflicts', 'readonly');\n    const store = transaction.objectStore('conflicts');\n    const request = store.getAll();\n\n    request.onsuccess = () => {\n      // Filter in memory since resolved is boolean and IDBKeyRange doesn't work well with booleans\n      const all = request.result || [];\n      const unresolved = all.filter((c: ConflictItem) => c.resolved === false);\n      resolve(unresolved);\n    };\n    request.onerror = () => reject(request.error);\n  });\n}\n\n/**\n * Get count of unresolved conflicts\n */\nexport async function getConflictsCount(): Promise<number> {\n  const db = await initDB();\n\n  return new Promise((resolve, reject) => {\n    const transaction = db.transaction('conflicts', 'readonly');\n    const store = transaction.objectStore('conflicts');\n    const request = store.getAll();\n\n    request.onsuccess = () => {\n      const all = request.result || [];\n      const unresolved = all.filter((c: ConflictItem) => c.resolved === false);\n      resolve(unresolved.length);\n    };\n    request.onerror = () => reject(request.error);\n  });\n}\n\n/**\n * Mark a conflict as resolved\n */\nexport async function resolveConflict(id: number): Promise<void> {\n  const db = await initDB();\n\n  return new Promise((resolve, reject) => {\n    const transaction = db.transaction('conflicts', 'readwrite');\n    const store = transaction.objectStore('conflicts');\n    \n    const getRequest = store.get(id);\n    getRequest.onsuccess = () => {\n      const item = getRequest.result;\n      if (item) {\n        item.resolved = true;\n        store.put(item);\n      }\n    };\n    getRequest.onerror = () => reject(getRequest.error);\n\n    transaction.oncomplete = () => resolve();\n    transaction.onerror = () => reject(transaction.error);\n  });\n}\n\n/**\n * Delete a conflict\n */\nexport async function deleteConflict(id: number): Promise<void> {\n  const db = await initDB();\n\n  return new Promise((resolve, reject) => {\n    const transaction = db.transaction('conflicts', 'readwrite');\n    const store = transaction.objectStore('conflicts');\n    const request = store.delete(id);\n\n    request.onsuccess = () => resolve();\n    request.onerror = () => reject(request.error);\n  });\n}\n\n// ============================================\n// SETTINGS OPERATIONS\n// ============================================\n\n/**\n * Get a setting value\n */\nexport async function getSetting<T>(key: string): Promise<T | undefined> {\n  const db = await initDB();\n\n  return new Promise((resolve, reject) => {\n    const transaction = db.transaction('settings', 'readonly');\n    const store = transaction.objectStore('settings');\n    const request = store.get(key);\n\n    request.onsuccess = () => {\n      const result = request.result as SettingItem | undefined;\n      resolve(result?.value as T | undefined);\n    };\n    request.onerror = () => reject(request.error);\n  });\n}\n\n/**\n * Set a setting value\n */\nexport async function setSetting<T>(key: string, value: T): Promise<void> {\n  const db = await initDB();\n\n  return new Promise((resolve, reject) => {\n    const transaction = db.transaction('settings', 'readwrite');\n    const store = transaction.objectStore('settings');\n    const request = store.put({ key, value });\n\n    request.onsuccess = () => resolve();\n    request.onerror = () => reject(request.error);\n  });\n}\n\n/**\n * Get performance mode setting\n */\nexport async function getPerformanceMode(): Promise<'auto' | 'modern' | 'legacy'> {\n  const mode = await getSetting<'auto' | 'modern' | 'legacy'>('performanceMode');\n  return mode || 'auto';\n}\n\n/**\n * Set performance mode\n */\nexport async function setPerformanceMode(mode: 'auto' | 'modern' | 'legacy'): Promise<void> {\n  await setSetting('performanceMode', mode);\n}\n\n/**\n * Get last sync timestamp\n */\nexport async function getLastSyncAt(): Promise<string | undefined> {\n  return getSetting<string>('lastSyncAt');\n}\n\n/**\n * Set last sync timestamp\n */\nexport async function setLastSyncAt(timestamp: string): Promise<void> {\n  await setSetting('lastSyncAt', timestamp);\n}\n\n// ============================================\n// BATCH OPERATIONS (Performance optimized)\n// ============================================\n\n/**\n * Cache all flying club data in one transaction\n */\nexport async function cacheAllFlyingClubData(data: {\n  groups?: unknown[];\n  aircraft?: unknown[];\n  bookings?: unknown[];\n  flightLogs?: unknown[];\n  maintenance?: unknown[];\n  members?: unknown[];\n}): Promise<void> {\n  const db = await initDB();\n\n  return new Promise((resolve, reject) => {\n    const transaction = db.transaction(CACHE_STORES, 'readwrite');\n\n    Object.entries(data).forEach(([key, value]) => {\n      if (CACHE_STORES.includes(key as CacheStore) && value) {\n        const store = transaction.objectStore(key as CacheStore);\n        store.clear();\n        (value as unknown[]).forEach((item) => store.add(item));\n      }\n    });\n\n    transaction.oncomplete = () => resolve();\n    transaction.onerror = () => reject(transaction.error);\n  });\n}\n\n/**\n * Get all cached flying club data\n */\nexport async function getAllCachedFlyingClubData(): Promise<{\n  groups: unknown[];\n  aircraft: unknown[];\n  bookings: unknown[];\n  flightLogs: unknown[];\n  maintenance: unknown[];\n  members: unknown[];\n}> {\n  const [groups, aircraft, bookings, flightLogs, maintenance, members] = await Promise.all([\n    getCachedData('groups'),\n    getCachedData('aircraft'),\n    getCachedData('bookings'),\n    getCachedData('flightLogs'),\n    getCachedData('maintenance'),\n    getCachedData('members'),\n  ]);\n\n  return { groups, aircraft, bookings, flightLogs, maintenance, members };\n}\n\n// ============================================\n// UTILITY\n// ============================================\n\n/**\n * Check if IndexedDB is available\n */\nexport function isIndexedDBAvailable(): boolean {\n  try {\n    return 'indexedDB' in window && window.indexedDB !== null;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Clear all data (for logout or troubleshooting)\n */\nexport async function clearAllData(): Promise<void> {\n  await clearAllCache();\n  \n  const db = await initDB();\n  \n  const syncTransaction = db.transaction('syncQueue', 'readwrite');\n  syncTransaction.objectStore('syncQueue').clear();\n  \n  const conflictTransaction = db.transaction('conflicts', 'readwrite');\n  conflictTransaction.objectStore('conflicts').clear();\n  \n  const settingsTransaction = db.transaction('settings', 'readwrite');\n  settingsTransaction.objectStore('settings').clear();\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\lib\\prisma.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\lib\\pusher-client.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\lib\\pusher-server.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\lib\\rate-limit.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\lib\\resend.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\lib\\server-encryption.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\lib\\stateData.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\lib\\stateFuelPrices.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getStateCode' is defined but never used.","line":8,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":22,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"getStateCode"},"fix":{"range":[184,227],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"prefer-const","severity":2,"message":"'lon' is never reassigned. Use 'const' instead.","line":200,"column":11,"nodeType":"Identifier","messageId":"useConst","endLine":200,"endColumn":14,"fix":{"range":[8709,8731],"text":"const lon = airport.lon;"}}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":1,"fixableWarningCount":0,"source":"/**\n * State Fuel Price Calculator\n * \n * Calculates representative fuel prices per state from airport fuel data.\n * Uses 5 airports per state (N, S, E, W, Center) â†’ median price\n */\n\nimport { getStateCode } from './usStates';\n\n// State to airports mapping (ICAO prefix to state)\n// This maps FAA location identifiers (first 2 chars of ICAO) to states\n// Note: This is approximate - some airports don't follow this pattern exactly\nconst ICAO_TO_STATE: Record<string, string> = {\n  'K': 'FEDERAL', // Federal airports (use state field)\n  'PA': 'PA', 'PC': 'HI', 'PH': 'HI', 'PM': 'HI', 'PW': 'HI', // Pacific\n  'LA': 'LA', // Louisiana\n  'NK': 'NY', // New York (non-federal)\n  'AK': 'AK', 'AL': 'AL', 'AR': 'AR', 'AZ': 'AZ', 'CA': 'CA',\n  'CO': 'CO', 'CT': 'CT', 'DC': 'DC', 'DE': 'DE', 'FL': 'FL', 'GA': 'GA',\n  'IA': 'IA', 'ID': 'ID', 'IL': 'IL', 'IN': 'IN', 'KS': 'KS', 'KY': 'KY',\n  'MA': 'MA', 'MD': 'MD', 'ME': 'ME', 'MI': 'MI', 'MN': 'MN', 'MO': 'MO',\n  'MS': 'MS', 'MT': 'MT', 'NC': 'NC', 'ND': 'ND', 'NE': 'NE', 'NH': 'NH',\n  'NJ': 'NJ', 'NM': 'NM', 'NV': 'NV', 'NY': 'NY', 'OH': 'OH', 'OK': 'OK',\n  'OR': 'OR', 'RI': 'RI', 'SC': 'SC', 'SD': 'SD', 'TN': 'TN',\n  'TX': 'TX', 'UT': 'UT', 'VA': 'VA', 'VT': 'VT', 'WA': 'WA', 'WI': 'WI',\n  'WV': 'WV', 'WY': 'WY'\n};\n\n// Approximate state boundaries (for finding N/S/E/W airports)\nconst STATE_BOUNDS: Record<string, { minLat: number; maxLat: number; minLon: number; maxLon: number }> = {\n  'AL': { minLat: 30.2, maxLat: 35.0, minLon: -88.5, maxLon: -84.9 },\n  'AK': { minLat: 51.8, maxLat: 71.4, minLon: -180, maxLon: -130 },\n  'AZ': { minLat: 31.3, maxLat: 37.0, minLon: -114.7, maxLon: -109.0 },\n  'AR': { minLat: 33.0, maxLat: 36.5, minLon: -94.6, maxLon: -89.6 },\n  'CA': { minLat: 32.5, maxLat: 42.0, minLon: -124.4, maxLon: -114.6 },\n  'CO': { minLat: 37.0, maxLat: 41.0, minLon: -109.1, maxLon: -102.0 },\n  'CT': { minLat: 41.0, maxLat: 42.1, minLon: -73.7, maxLon: -71.8 },\n  'DE': { minLat: 38.5, maxLat: 39.8, minLon: -75.8, maxLon: -75.0 },\n  'FL': { minLat: 24.5, maxLat: 31.0, minLon: -87.6, maxLon: -80.0 },\n  'GA': { minLat: 30.4, maxLat: 35.0, minLon: -85.6, maxLon: -80.8 },\n  'HI': { minLat: 18.9, maxLat: 22.5, minLon: -160.2, maxLon: -154.7 },\n  'ID': { minLat: 42.0, maxLat: 49.0, minLon: -117.2, maxLon: -111.0 },\n  'IL': { minLat: 37.0, maxLat: 42.5, minLon: -91.5, maxLon: -87.0 },\n  'IN': { minLat: 38.0, maxLat: 41.8, minLon: -88.1, maxLon: -84.8 },\n  'IA': { minLat: 40.4, maxLat: 43.5, minLon: -96.6, maxLon: -90.1 },\n  'KS': { minLat: 37.0, maxLat: 40.0, minLon: -102.1, maxLon: -94.6 },\n  'KY': { minLat: 36.5, maxLat: 39.2, minLon: -89.6, maxLon: -81.9 },\n  'LA': { minLat: 29.0, maxLat: 33.0, minLon: -94.1, maxLon: -88.8 },\n  'ME': { minLat: 43.1, maxLat: 47.5, minLon: -71.1, maxLon: -66.9 },\n  'MD': { minLat: 37.9, maxLat: 39.7, minLon: -79.5, maxLon: -75.0 },\n  'MA': { minLat: 41.2, maxLat: 42.9, minLon: -73.5, maxLon: -69.9 },\n  'MI': { minLat: 41.7, maxLat: 48.2, minLon: -90.4, maxLon: -82.1 },\n  'MN': { minLat: 43.5, maxLat: 49.4, minLon: -97.2, maxLon: -89.5 },\n  'MS': { minLat: 30.2, maxLat: 35.0, minLon: -91.7, maxLon: -88.1 },\n  'MO': { minLat: 36.0, maxLat: 40.6, minLon: -95.8, maxLon: -89.1 },\n  'MT': { minLat: 44.4, maxLat: 49.0, minLon: -116.0, maxLon: -104.0 },\n  'NE': { minLat: 40.0, maxLat: 43.0, minLon: -104.1, maxLon: -95.3 },\n  'NV': { minLat: 35.0, maxLat: 42.0, minLon: -120.0, maxLon: -114.0 },\n  'NH': { minLat: 42.7, maxLat: 45.3, minLon: -72.6, maxLon: -70.7 },\n  'NJ': { minLat: 38.9, maxLat: 41.4, minLon: -75.6, maxLon: -73.9 },\n  'NM': { minLat: 31.3, maxLat: 37.0, minLon: -109.1, maxLon: -103.0 },\n  'NY': { minLat: 40.5, maxLat: 45.0, minLon: -79.8, maxLon: -71.8 },\n  'NC': { minLat: 33.8, maxLat: 36.5, minLon: -84.3, maxLon: -75.4 },\n  'ND': { minLat: 45.9, maxLat: 49.0, minLon: -104.1, maxLon: -96.6 },\n  'OH': { minLat: 38.4, maxLat: 41.7, minLon: -84.8, maxLon: -80.5 },\n  'OK': { minLat: 33.6, maxLat: 37.0, minLon: -103.0, maxLon: -94.4 },\n  'OR': { minLat: 42.0, maxLat: 46.3, minLon: -124.6, maxLon: -116.5 },\n  'PA': { minLat: 39.7, maxLat: 42.3, minLon: -80.5, maxLon: -74.7 },\n  'RI': { minLat: 41.1, maxLat: 42.0, minLon: -71.9, maxLon: -71.1 },\n  'SC': { minLat: 32.0, maxLat: 35.2, minLon: -83.4, maxLon: -78.5 },\n  'SD': { minLat: 42.5, maxLat: 45.9, minLon: -104.1, maxLon: -96.4 },\n  'TN': { minLat: 35.0, maxLat: 36.5, minLon: -90.3, maxLon: -81.6 },\n  'TX': { minLat: 25.8, maxLat: 36.5, minLon: -106.7, maxLon: -93.5 },\n  'UT': { minLat: 37.0, maxLat: 42.0, minLon: -114.1, maxLon: -109.0 },\n  'VT': { minLat: 42.7, maxLat: 45.0, minLon: -73.5, maxLon: -71.5 },\n  'VA': { minLat: 36.5, maxLat: 39.5, minLon: -83.7, maxLon: -75.2 },\n  'WA': { minLat: 45.5, maxLat: 49.0, minLon: -124.8, maxLon: -116.9 },\n  'WV': { minLat: 37.2, maxLat: 40.6, minLon: -82.6, maxLon: -77.7 },\n  'WI': { minLat: 42.5, maxLat: 47.1, minLon: -92.9, maxLon: -86.8 },\n  'WY': { minLat: 41.0, maxLat: 45.0, minLon: -111.1, maxLon: -104.1 },\n};\n\nexport interface FuelPrice {\n  icao: string;\n  price100ll: number | null;\n  priceJetA: number | null;\n  lastUpdated?: string;\n  source?: string;\n  lat?: number;\n  lon?: number;\n  state?: string;\n}\n\nexport interface StateAverage {\n  state: string;\n  stateName: string;\n  medianPrice: number | null;\n  sampleCount: number;\n}\n\n/**\n * Get state from ICAO code\n * Most US airports use ICAO starting with 'K' followed by 3-letter code\n * The 3-letter code often relates to the city (e.g., KJFK = JFK = New York)\n * This uses a simplified mapping based on common patterns\n */\nfunction getStateFromICAO(icao: string): string | null {\n  if (!icao || icao.length < 3) return null;\n  \n  const prefix = icao.substring(0, 2);\n  \n  // Federal airports (K prefix) - need to look up by specific airport\n  if (prefix === 'K') {\n    // For K-prefixed airports, use a lookup table for major airports\n    const kLookup: Record<string, string> = {\n      'KJFK': 'NY', 'KEWR': 'NJ', 'KLGA': 'NY', 'KJNB': 'GA',\n      'KATL': 'GA', 'KORD': 'IL', 'KMDW': 'IL', 'KDCA': 'DC',\n      'KIAD': 'VA', 'KMCO': 'FL', 'KTPA': 'FL', 'KMIA': 'FL',\n      'KDFW': 'TX', 'KIAH': 'TX', 'KLAS': 'NV', 'KPHX': 'AZ',\n      'KLAX': 'CA', 'KSFO': 'CA', 'KSAN': 'CA', 'KSEA': 'WA',\n      'KPDX': 'OR', 'KDEN': 'CO', 'KMSP': 'MN', 'KMEM': 'TN',\n      'KBNA': 'TN', 'KSTL': 'MO', 'KCLE': 'OH', 'KCincinnati': 'OH',\n      'KPIT': 'PA', 'KPHL': 'PA', 'KBWI': 'MD', 'KSJC': 'CA',\n      'KDAL': 'TX', 'KHOU': 'TX', 'KOKC': 'OK', 'KTUL': 'OK',\n      'KLIT': 'AR', 'KABQ': 'NM', 'KSLC': 'UT', 'KBOI': 'ID',\n      'KGEG': 'WA', 'KTUS': 'AZ',\n    };\n    return kLookup[icao] || 'CA'; // Default to CA for unknown K-prefixed\n  }\n  \n  return ICAO_TO_STATE[prefix] || null;\n}\n\n/**\n * Calculate median of array of numbers\n */\nfunction getMedian(values: number[]): number | null {\n  if (values.length === 0) return null;\n  \n  const sorted = [...values].sort((a, b) => a - b);\n  const mid = Math.floor(sorted.length / 2);\n  \n  if (sorted.length % 2 === 0) {\n    return (sorted[mid - 1] + sorted[mid]) / 2;\n  }\n  return sorted[mid];\n}\n\n/**\n * Calculate state averages from fuel prices\n * Uses N, S, E, W, Center airports â†’ median price\n */\nexport function calculateStateAverages(fuelPrices: Record<string, FuelPrice>): Record<string, StateAverage> {\n  // Group airports by state\n  const stateAirports: Record<string, FuelPrice[]> = {};\n  \n  for (const [icao, priceData] of Object.entries(fuelPrices)) {\n    if (!priceData.price100ll) continue;\n    \n    const state = getStateFromICAO(icao);\n    if (!state) continue;\n    \n    if (!stateAirports[state]) {\n      stateAirports[state] = [];\n    }\n    stateAirports[state].push({ ...priceData, icao });\n  }\n  \n  // Calculate median for each state\n  const stateAverages: Record<string, StateAverage> = {};\n  \n  for (const [state, airports] of Object.entries(stateAirports)) {\n    if (airports.length === 0) continue;\n    \n    // Get bounds for this state\n    const bounds = STATE_BOUNDS[state];\n    if (!bounds) continue;\n    \n    // Find N, S, E, W, Center airports\n    let north = airports[0];\n    let south = airports[0];\n    let east = airports[0];\n    let west = airports[0];\n    let center = airports[0];\n    \n    // Calculate center point\n    const centerLat = (bounds.minLat + bounds.maxLat) / 2;\n    const centerLon = (bounds.minLon + bounds.maxLon) / 2;\n    \n    let minDistToCenter = Infinity;\n    \n    for (const airport of airports) {\n      if (!airport.lat || !airport.lon) continue;\n      \n      // North = max lat\n      if (!north.lat || airport.lat > north.lat) north = airport;\n      // South = min lat\n      if (!south.lat || airport.lat < south.lat) south = airport;\n      // East = max lon (handle Alaska which crosses -180)\n      let lon = airport.lon;\n      if (state === 'AK') {\n        if (!east.lon || lon > east.lon) east = airport;\n        if (!west.lon || lon < west.lon) west = airport;\n      } else {\n        if (!east.lon || lon > east.lon) east = airport;\n        if (!west.lon || lon < west.lon) west = airport;\n      }\n      // Center = closest to center point\n      const dist = Math.abs(airport.lat - centerLat) + Math.abs(airport.lon - centerLon);\n      if (dist < minDistToCenter) {\n        minDistToCenter = dist;\n        center = airport;\n      }\n    }\n    \n    // Get unique prices from these 5 airports\n    const samplePrices = [\n      north?.price100ll,\n      south?.price100ll,\n      east?.price100ll,\n      west?.price100ll,\n      center?.price100ll,\n    ].filter((p): p is number => p !== null && p > 0);\n    \n    // Calculate median\n    const medianPrice = getMedian(samplePrices);\n    \n    if (medianPrice !== null) {\n      const stateNames: Record<string, string> = {\n        'AL': 'Alabama', 'AK': 'Alaska', 'AZ': 'Arizona', 'AR': 'Arkansas',\n        'CA': 'California', 'CO': 'Colorado', 'CT': 'Connecticut', 'DE': 'Delaware',\n        'FL': 'Florida', 'GA': 'Georgia', 'HI': 'Hawaii', 'ID': 'Idaho',\n        'IL': 'Illinois', 'IN': 'Indiana', 'IA': 'Iowa', 'KS': 'Kansas',\n        'KY': 'Kentucky', 'LA': 'Louisiana', 'ME': 'Maine', 'MD': 'Maryland',\n        'MA': 'Massachusetts', 'MI': 'Michigan', 'MN': 'Minnesota', 'MS': 'Mississippi',\n        'MO': 'Missouri', 'MT': 'Montana', 'NE': 'Nebraska', 'NV': 'Nevada',\n        'NH': 'New Hampshire', 'NJ': 'New Jersey', 'NM': 'New Mexico', 'NY': 'New York',\n        'NC': 'North Carolina', 'ND': 'North Dakota', 'OH': 'Ohio', 'OK': 'Oklahoma',\n        'OR': 'Oregon', 'PA': 'Pennsylvania', 'RI': 'Rhode Island', 'SC': 'South Carolina',\n        'SD': 'South Dakota', 'TN': 'Tennessee', 'TX': 'Texas', 'UT': 'Utah',\n        'VT': 'Vermont', 'VA': 'Virginia', 'WA': 'Washington', 'WV': 'West Virginia',\n        'WI': 'Wisconsin', 'WY': 'Wyoming', 'DC': 'Washington DC'\n      };\n      \n      stateAverages[state] = {\n        state,\n        stateName: stateNames[state] || state,\n        medianPrice: Math.round(medianPrice * 100) / 100, // Round to 2 decimals\n        sampleCount: samplePrices.length,\n      };\n    }\n  }\n  \n  return stateAverages;\n}\n\n/**\n * Quick lookup - get price for a state\n */\nexport function getStatePrice(stateCode: string, stateAverages: Record<string, StateAverage>): StateAverage | null {\n  return stateAverages[stateCode] || null;\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\lib\\stripe.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\lib\\training\\requirements.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\lib\\usStates.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\lib\\user.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\lib\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\lib\\validate.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\middleware.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'request' is defined but never used.","line":4,"column":28,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":35}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\"\nimport type { NextRequest } from \"next/server\"\n\nexport function middleware(request: NextRequest) {\n  return NextResponse.next()\n}\n\nexport const config = {\n  matcher: [\n    \"/dashboard/:path*\",\n    \"/modules/:path*\"\n  ],\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\next.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\postcss.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\public\\service-worker.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\scripts\\check-azure.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":1,"column":13,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":1,"endColumn":29},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":27,"column":28,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":27,"endColumn":53}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const sql = require('mssql');\n\nasync function main() {\n  const config = {\n    server: 'aviation-server-dk.database.windows.net',\n    database: 'aviation_db',\n    user: 'CloudSA183a5780',\n    password: 'Password123',\n    options: { encrypt: true, trustServerCertificate: false }\n  };\n  \n  const pool = await sql.connect(config);\n  \n  // Get user\n  const result = await pool.query`SELECT email, password FROM [User] WHERE email = 'demo@demo.com'`;\n  \n  if (result.recordset.length === 0) {\n    console.log('User not found in Azure');\n    return;\n  }\n  \n  const user = result.recordset[0];\n  console.log('Azure user:', user.email);\n  console.log('Azure password:', user.password?.substring(0, 20));\n  \n  // Get local for comparison\n  const { PrismaClient } = require('@prisma/client');\n  const prisma = new PrismaClient();\n  const local = await prisma.user.findUnique({ where: { email: 'demo@demo.com' } });\n  console.log('Local password:', local.password?.substring(0, 20));\n  \n  console.log('Passwords match:', user.password === local.password);\n}\n\nmain().catch(console.error).finally(() => process.exit());\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\scripts\\check-tables.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":2,"column":17,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":2,"endColumn":35}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Quick script to verify database tables\nconst pymssql = require('pymssql');\n\nasync function check() {\n  const conn = await new Promise((resolve, reject) => {\n    pymssql.connect({\n      server: 'aviation-server-dk.database.windows.net',\n      database: 'aviation_db',\n      user: 'CloudSA183a5780',\n      password: 'Password123',\n      options: {\n        encrypt: true,\n        trustServerCertificate: false\n      }\n    }).then(resolve).catch(reject);\n  });\n\n  const request = conn.request();\n  \n  // Check tables\n  console.log('=== Checking tables ===');\n  const tables = await request.query(`\n    SELECT TABLE_NAME \n    FROM INFORMATION_SCHEMA.TABLES \n    WHERE TABLE_TYPE = 'BASE TABLE'\n    ORDER BY TABLE_NAME\n  `);\n  \n  console.log('Tables:');\n  tables.recordset.forEach(t => console.log('  -', t.TABLE_NAME));\n  \n  // Check AircraftSpecs\n  console.log('\\n=== AircraftSpecs ===');\n  try {\n    const specsCount = await request.query('SELECT COUNT(*) as cnt FROM AircraftSpecs');\n    console.log('Row count:', specsCount.recordset[0].cnt);\n    \n    if (specsCount.recordset[0].cnt > 0) {\n      const sample = await request.query('SELECT TOP 3 * FROM AircraftSpecs');\n      console.log('\\nSample data:');\n      console.log(JSON.stringify(sample.recordset, null, 2));\n    }\n  } catch(e) {\n    console.log('Error:', e.message);\n  }\n  \n  // Check AircraftPerformance\n  console.log('\\n=== AircraftPerformance ===');\n  try {\n    const perfCount = await request.query('SELECT COUNT(*) as cnt FROM AircraftPerformance');\n    console.log('Row count:', perfCount.recordset[0].cnt);\n  } catch(e) {\n    console.log('Error:', e.message);\n  }\n  \n  // Test matching query for Cessna 150L\n  console.log('\\n=== Test matching for Cessna 150 ===');\n  try {\n    const test = await request.query(`\n      SELECT TOP 1 * FROM AircraftSpecs \n      WHERE UPPER(manufacturer) LIKE '%CESSNA%'\n        AND UPPER(model) LIKE '%150%'\n    `);\n    console.log('Result:', test.recordset.length > 0 ? 'FOUND' : 'NOT FOUND');\n    if (test.recordset.length > 0) {\n      console.log(JSON.stringify(test.recordset[0], null, 2));\n    }\n  } catch(e) {\n    console.log('Error:', e.message);\n  }\n  \n  conn.close();\n}\n\ncheck().catch(console.error);\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\scripts\\check-user.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":1,"column":13,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":1,"endColumn":29},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":23,"column":28,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":23,"endColumn":53}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const sql = require('mssql');\n\nasync function main() {\n  const config = {\n    server: 'aviation-server-dk.database.windows.net',\n    database: 'aviation_db',\n    user: 'CloudSA183a5780',\n    password: 'Password123',\n    options: {\n      encrypt: true,\n      trustServerCertificate: false\n    }\n  };\n  \n  const pool = await sql.connect(config);\n  \n  // Get user\n  let result = await pool.query`SELECT email, password FROM [User] WHERE email = 'test@test.com'`;\n  console.log('Azure password length:', result.recordset[0]?.password?.length);\n  console.log('Local password should be:', 60);\n  \n  // Get local user for comparison\n  const { PrismaClient } = require('@prisma/client');\n  const prisma = new PrismaClient();\n  const local = await prisma.user.findUnique({ where: { email: 'test@test.com' } });\n  console.log('Local password:', local.password.substring(0, 20) + '...');\n  console.log('Azure password:', result.recordset[0]?.password?.substring(0, 20) + '...');\n  \n  await sql.close();\n}\n\nmain().catch(console.error);\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\scripts\\create-user.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":1,"column":26,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":1,"endColumn":51},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":2,"column":16,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":2,"endColumn":33}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const { PrismaClient } = require('@prisma/client');\nconst bcrypt = require('bcrypt');\n\nconst prisma = new PrismaClient();\n\nasync function main() {\n  // Create user in local database\n  const hash = await bcrypt.hash('password123', 10);\n  \n  const user = await prisma.user.upsert({\n    where: { email: 'demo@demo.com' },\n    update: { password: hash },\n    create: {\n      email: 'demo@demo.com',\n      name: 'Demo User',\n      password: hash,\n      purchasedModules: '[]',\n      credits: 100\n    }\n  });\n  \n  console.log('Created/updated user:', user.email);\n}\n\nmain().catch(console.error).finally(() => process.exit());\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\scripts\\fetch-fuel-prices.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":7,"column":17,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":7,"endColumn":35},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":8,"column":14,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":8,"endColumn":29},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":9,"column":15,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":9,"endColumn":31},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":10,"column":14,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":10,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'STATE' is assigned a value but never used.","line":16,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":142,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":142,"endColumn":17}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Script to fetch and cache aviation fuel prices from 100LL.com\n * Usage: node scripts/fetch-fuel-prices.js [state]\n * Example: node scripts/fetch-fuel-prices.js US-MI\n */\n\nconst sqlite3 = require('sqlite3').verbose();\nconst path = require('path');\nconst https = require('https');\nconst http = require('http');\n\n// Database path\nconst DB_PATH = path.join(__dirname, '..', 'data', 'aviation_hub.db');\n\n// Get state from command line or default to Michigan\nconst STATE = process.argv[2] || 'US-MI';\n\n// Michigan large airports (manually collected from the database)\nconst MICHIGAN_AIRPORTS = [\n  { icao: 'KFNT', name: 'Bishop International', city: 'Flint' },\n  { icao: 'KLAN', name: 'Capital Region International', city: 'Lansing' },\n  { icao: 'KTVC', name: 'Cherry Capital', city: 'Traverse City' },\n  { icao: 'KCIU', name: 'Chippewa County International', city: 'Kincheloe' },\n  { icao: 'KDTW', name: 'Detroit Metropolitan Wayne County', city: 'Detroit' },\n  { icao: 'KGRR', name: 'Gerald R. Ford International', city: 'Grand Rapids' },\n  { icao: 'KMBS', name: 'MBS International', city: 'Freeland' },\n  { icao: 'KSAW', name: 'Marquette/Sawyer International', city: 'Gwinn' },\n  // Medium airports\n  { icao: 'KADG', name: 'Kalamazoo/Battle Creek International', city: 'Kalamazoo' },\n  { icao: 'KAMN', name: 'Gratiot Community', city: 'Alma' },\n  { icao: 'KAZO', name: 'Kalamazoo/Battle Creek International', city: 'Kalamazoo' },\n  { icao: 'KBAX', name: 'Hancock', city: 'Bad Axe' },\n  { icao: 'KBEH', name: 'Southwest Michigan Regional', city: 'Benton Harbor' },\n  { icao: 'KBIV', name: 'West Michigan Regional', city: 'Holland' },\n  { icao: 'KC91', name: 'Dowagiac Municipal', city: 'Dowagiac' },\n  { icao: 'KDRM', name: 'Drummond Island', city: 'Drummond Island' },\n  { icao: 'KESC', name: 'Delta County', city: 'Escanaba' },\n  { icao: 'KFFX', name: 'Oscoda County', city: 'Oscoda' },\n  { icao: 'KFLD', name: 'Joe D. Wicker', city: 'Lapeer' },\n  { icao: 'KGAK', name: 'Gore Bay Municipal', city: 'Gore Bay' },\n  { icao: 'KGLR', name: 'Cloquet', city: 'Cloquet' },\n  { icao: 'KHMU', name: 'Hall-Alexander Field', city: 'Houghton' },\n  { icao: 'KHTL', name: 'Roscommon County', city: 'Roscommon' },\n  { icao: 'KIWX', name: 'Fulton County', city: 'Wauseon' },\n  { icao: 'KJYM', name: 'St. Mary\\'s Airport', city: 'Mount Pleasant' },\n  { icao: 'KLDM', name: 'Mason County', city: 'Ludington' },\n  { icao: 'KLEW', name: 'Auburn', city: 'Auburn' },\n  { icao: 'KMGC', name: 'Michigan City Municipal', city: 'Michigan City' },\n  { icao: 'KMOP', name: 'Mount Pleasant Municipal', city: 'Mount Pleasant' },\n  { icao: 'KOGM', name: 'Knox County', city: 'St. James' },\n  { icao: 'KONZ', name: 'Grosse Ile Municipal', city: 'Grosse Ile' },\n  { icao: 'KOXI', name: 'Starke County', city: 'Knox' },\n  { icao: 'KPHN', name: 'St. Clair County International', city: 'Port Huron' },\n  { icao: 'KPTK', name: 'Oakland County International', city: 'Waterford' },\n  { icao: 'KRCR', name: 'Fulton County', city: 'Rochester' },\n  { icao: 'KRZL', name: 'Jasper County', city: 'Rensselaer' },\n  { icao: 'KSJX', name: 'Schoolcraft County', city: 'Manistique' },\n  { icao: 'KSLH', name: 'Cheboygan County', city: 'Cheboygan' },\n  { icao: 'KTTF', name: 'Monroe County', city: 'Monroe' },\n  { icao: 'KVSF', name: 'Thomas Field', city: 'St. Johns' },\n  { icao: 'KW92', name: 'Alpena County', city: 'Alpena' },\n  { icao: 'KWIN', name: 'Stella', city: 'New Hudson' },\n  { icao: 'KY70', name: 'Custer County', city: 'Mancelona' },\n  { icao: 'Y83', name: 'Sandusky City', city: 'Sandusky' },\n];\n\n// Helper function to make HTTP requests\nfunction httpGet(url) {\n  return new Promise((resolve, reject) => {\n    const protocol = url.startsWith('https') ? https : http;\n    protocol.get(url, (res) => {\n      let data = '';\n      res.on('data', chunk => data += chunk);\n      res.on('end', () => resolve(data));\n    }).on('error', reject);\n  });\n}\n\n// Parse fuel price from 100LL.com response\nfunction parseFuelPrices(html, icao) {\n  const prices = { ll: null, jetA: null };\n  \n  try {\n    // Look for 100LL prices\n    const llMatch = html.match(/100LL[\\s\\S]*?\\$(\\d+\\.?\\d*)\\/Gal/i);\n    if (llMatch) {\n      prices.ll = parseFloat(llMatch[1]);\n    }\n    \n    // Look for Jet-A prices  \n    const jetMatch = html.match(/Jet-?A[\\s\\S]*?\\$(\\d+\\.?\\d*)\\/Gal/i);\n    if (jetMatch) {\n      prices.jetA = parseFloat(jetMatch[1]);\n    }\n    \n    // Also check for Self Service prices\n    const selfMatch = html.match(/Self Service:.*?\\$(\\d+\\.?\\d*)\\/Gal/i);\n    if (selfMatch && !prices.ll) {\n      prices.ll = parseFloat(selfMatch[1]);\n    }\n    \n    // Full Service\n    const fullMatch = html.match(/Full Service:.*?\\$(\\d+\\.?\\d*)\\/Gal/i);\n    if (fullMatch && !prices.ll) {\n      prices.ll = parseFloat(fullMatch[1]);\n    }\n  } catch (e) {\n    console.error(`Error parsing prices for ${icao}:`, e.message);\n  }\n  \n  return prices;\n}\n\n// Main function\nasync function fetchFuelPrices() {\n  console.log(`Fetching fuel prices for Michigan airports...`);\n  console.log(`Total airports to check: ${MICHIGAN_AIRPORTS.length}`);\n  \n  const db = new sqlite3.Database(DB_PATH);\n  \n  let successCount = 0;\n  let failCount = 0;\n  let skipCount = 0;\n  \n  for (const airport of MICHIGAN_AIRPORTS) {\n    try {\n      // Try 100LL.com first\n      const url = `http://www.100ll.com/searchresults.php?searchfor=${airport.icao}`;\n      console.log(`Fetching ${airport.icao} (${airport.city})...`);\n      \n      const html = await httpGet(url);\n      const prices = parseFuelPrices(html, airport.icao);\n      \n      // Also try AirNav\n      const airnavUrl = `https://www.airnav.com/fuel/${airport.icao}.html`;\n      try {\n        const airnavHtml = await httpGet(airnavUrl);\n        const airnavPrices = parseFuelPrices(airnavHtml, airport.icao);\n        // Prefer AirNav if it has data\n        if (!prices.ll && airnavPrices.ll) prices.ll = airnavPrices.ll;\n        if (!prices.jetA && airnavPrices.jetA) prices.jetA = airnavPrices.jetA;\n      } catch (e) {\n        // AirNav failed, continue with 100LL data\n      }\n      \n      // Insert into database if we have any prices\n      if (prices.ll || prices.jetA) {\n        const price = prices.ll || prices.jetA;\n        \n        db.run(`\n          INSERT OR REPLACE INTO airport_cache (icao, data_type, price, source_site, last_updated)\n          VALUES (?, 'fuel', ?, '100ll.com', datetime('now'))\n        `, [airport.icao, price], function(err) {\n          if (err) {\n            console.error(`Database error for ${airport.icao}:`, err.message);\n          }\n        });\n        \n        console.log(`  [OK] ${airport.icao}: $${price}/gal`);\n        successCount++;\n      } else {\n        console.log(`  [--] ${airport.icao}: No price found`);\n        skipCount++;\n      }\n      \n      // Rate limiting - wait between requests\n      await new Promise(resolve => setTimeout(resolve, 1000));\n      \n    } catch (error) {\n      console.error(`  âœ— ${airport.icao}: Error - ${error.message}`);\n      failCount++;\n    }\n  }\n  \n  db.close();\n  \n  console.log(`\\n=== Summary ===`);\n  console.log(`Successful: ${successCount}`);\n  console.log(`No data: ${skipCount}`);\n  console.log(`Failed: ${failCount}`);\n}\n\n// Run the script\nfetchFuelPrices().catch(console.error);\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\scripts\\init-local-tables.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":6,"column":17,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":6,"endColumn":35},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":7,"column":14,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":7,"endColumn":29}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Initialize SQLite tables for weather cache and weight & balance\n * Run: node scripts/init-local-tables.js\n */\n\nconst sqlite3 = require('sqlite3').verbose();\nconst path = require('path');\n\nconst DB_PATH = path.join(__dirname, '..', 'data', 'aviation_hub.db');\n\nconst db = new sqlite3.Database(DB_PATH);\n\nconsole.log('Initializing local SQLite tables...\\n');\n\n// Weather Cache Table\ndb.run(`\n  CREATE TABLE IF NOT EXISTS weather_cache (\n    id TEXT PRIMARY KEY,\n    region TEXT NOT NULL,\n    icao TEXT,\n    data_type TEXT NOT NULL,\n    data TEXT NOT NULL,\n    fetched_at TEXT DEFAULT CURRENT_TIMESTAMP,\n    expires_at TEXT,\n    UNIQUE(region, icao, data_type)\n  )\n`, (err) => {\n  if (err) console.error('Error creating weather_cache:', err);\n  else console.log('âœ“ weather_cache table created');\n});\n\n// Weight & Balance Table\ndb.run(`\n  CREATE TABLE IF NOT EXISTS weight_balance (\n    id TEXT PRIMARY KEY,\n    make TEXT NOT NULL,\n    model TEXT NOT NULL,\n    empty_weight REAL NOT NULL,\n    empty_cg REAL NOT NULL,\n    max_weight REAL NOT NULL,\n    arm_pilot REAL NOT NULL,\n    arm_passenger REAL NOT NULL,\n    arm_baggage REAL NOT NULL,\n    arm_fuel REAL NOT NULL,\n    fuel_capacity REAL NOT NULL,\n    cruise_speed INTEGER NOT NULL,\n    fuel_burn REAL NOT NULL,\n    unusable_fuel REAL DEFAULT 2,\n    is_verified INTEGER DEFAULT 0,\n    notes TEXT,\n    created_at TEXT DEFAULT CURRENT_TIMESTAMP,\n    UNIQUE(make, model)\n  )\n`, (err) => {\n  if (err) console.error('Error creating weight_balance:', err);\n  else console.log('âœ“ weight_balance table created');\n});\n\n// Create index for faster weather lookups\ndb.run(`\n  CREATE INDEX IF NOT EXISTS idx_weather_region_icao \n  ON weather_cache(region, icao)\n`, (err) => {\n  if (err) console.error('Error creating index:', err);\n  else console.log('âœ“ weather_cache index created');\n});\n\n// User Preferences Table (for performance settings, etc)\ndb.run(`\n  CREATE TABLE IF NOT EXISTS user_preferences (\n    id TEXT PRIMARY KEY,\n    user_id TEXT,\n    key TEXT NOT NULL,\n    value TEXT NOT NULL,\n    updated_at TEXT DEFAULT CURRENT_TIMESTAMP,\n    UNIQUE(user_id, key)\n  )\n`, (err) => {\n  if (err) console.error('Error creating user_preferences:', err);\n  else console.log('âœ“ user_preferences table created');\n});\n\n// Flight Recordings Table (local cache for track data)\ndb.run(`\n  CREATE TABLE IF NOT EXISTS flight_recordings (\n    id TEXT PRIMARY KEY,\n    user_id TEXT NOT NULL,\n    aircraft_id TEXT,\n    filename TEXT NOT NULL,\n    file_type TEXT NOT NULL,\n    import_date TEXT DEFAULT CURRENT_TIMESTAMP,\n    flight_date TEXT,\n    departure_icao TEXT,\n    arrival_icao TEXT,\n    duration_minutes INTEGER,\n    track_data TEXT NOT NULL,\n    notes TEXT,\n    cloudahoy_url TEXT,\n    UNIQUE(id)\n  )\n`, (err) => {\n  if (err) console.error('Error creating flight_recordings:', err);\n  else console.log('âœ“ flight_recordings table created');\n});\n\n// FBO Fees Table\ndb.run(`\n  CREATE TABLE IF NOT EXISTS fbo_fees (\n    id INTEGER PRIMARY KEY AUTOINCREMENT,\n    icao TEXT NOT NULL,\n    fbo_name TEXT NOT NULL,\n    ramp_fee REAL,\n    overnight_fee REAL,\n    handling_fee REAL,\n    fuel_minimum REAL,\n    credit_card_fee REAL,\n    callahead_required INTEGER DEFAULT 0,\n    phone TEXT,\n    amenities TEXT,\n    last_updated TEXT DEFAULT CURRENT_TIMESTAMP,\n    source TEXT DEFAULT 'airnav',\n    UNIQUE(icao, fbo_name)\n  )\n`, (err) => {\n  if (err) console.error('Error creating fbo_fees:', err);\n  else console.log('âœ“ fbo_fees table created');\n});\n\n// Create index for faster lookups\ndb.run(`\n  CREATE INDEX IF NOT EXISTS idx_fbo_icao ON fbo_fees(icao)\n`, (err) => {\n  if (err) console.error('Error creating fbo_fees index:', err);\n  else console.log('âœ“ fbo_fees index created');\n});\n\ndb.close(() => {\n  console.log('\\nâœ… All SQLite tables initialized successfully!');\n});\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\scripts\\migrate-db.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":1,"column":26,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":1,"endColumn":51}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const { PrismaClient } = require('@prisma/client');\n\nconst prisma = new PrismaClient();\n\nasync function migrate() {\n  try {\n    console.log('Starting migration...');\n    \n    // Step 1: Add columns using raw SQL\n    console.log('Adding columns...');\n    \n    await prisma.$executeRawUnsafe(`\n      IF NOT EXISTS (SELECT * FROM sys.columns WHERE name = 'username' AND object_id = OBJECT_ID('User'))\n      ALTER TABLE [User] ADD username NVARCHAR(50) NULL;\n    `);\n    console.log('âœ“ username column added');\n    \n    await prisma.$executeRawUnsafe(`\n      IF NOT EXISTS (SELECT * FROM sys.columns WHERE name = 'emailVerified' AND object_id = OBJECT_ID('User'))\n      ALTER TABLE [User] ADD emailVerified DATETIME NULL;\n    `);\n    console.log('âœ“ emailVerified column added');\n    \n    await prisma.$executeRawUnsafe(`\n      IF NOT EXISTS (SELECT * FROM sys.columns WHERE name = 'verifyToken' AND object_id = OBJECT_ID('User'))\n      ALTER TABLE [User] ADD verifyToken NVARCHAR(255) NULL;\n    `);\n    console.log('âœ“ verifyToken column added');\n    \n    await prisma.$executeRawUnsafe(`\n      IF NOT EXISTS (SELECT * FROM sys.columns WHERE name = 'verifyTokenExpiry' AND object_id = OBJECT_ID('User'))\n      ALTER TABLE [User] ADD verifyTokenExpiry DATETIME NULL;\n    `);\n    console.log('âœ“ verifyTokenExpiry column added');\n    \n    // Step 2: Get all users using raw query\n    console.log('\\nFetching users...');\n    const users = await prisma.$queryRaw`\n      SELECT id, email, createdAt FROM [User] WHERE username IS NULL\n    `;\n    \n    console.log(`Found ${users.length} users to update`);\n    \n    // Step 3: Generate unique usernames for each user\n    const usedUsernames = new Set();\n    \n    for (const user of users) {\n      // Generate base username from email\n      let baseUsername = user.email\n        .split('@')[0]\n        .toLowerCase()\n        .replace(/[^a-z0-9]/g, '_');\n      \n      let username = baseUsername;\n      let counter = 1;\n      \n      // Ensure uniqueness\n      while (usedUsernames.has(username)) {\n        username = `${baseUsername}_${counter}`;\n        counter++;\n        \n        if (counter > 1000) {\n          username = `user_${user.id.substring(0, 8)}`;\n          break;\n        }\n      }\n      \n      usedUsernames.add(username);\n      \n      // Update user using raw query\n      await prisma.$executeRaw`\n        UPDATE [User] \n        SET username = ${username}, \n            emailVerified = ${user.createdAt}\n        WHERE id = ${user.id}\n      `;\n      \n      console.log(`âœ“ Updated ${user.email} â†’ ${username}`);\n    }\n    \n    // Step 4: Create unique index\n    console.log('\\nCreating unique index...');\n    await prisma.$executeRawUnsafe(`\n      IF NOT EXISTS (SELECT * FROM sys.indexes WHERE name = 'IX_User_username' AND object_id = OBJECT_ID('User'))\n      CREATE UNIQUE INDEX IX_User_username ON [User](username) WHERE username IS NOT NULL;\n    `);\n    console.log('âœ“ Unique index created');\n    \n    // Verify\n    const stats = await prisma.$queryRaw`\n      SELECT \n        COUNT(*) as total,\n        COUNT(username) as with_username,\n        COUNT(emailVerified) as verified\n      FROM [User]\n    `;\n    \n    console.log('\\n========================================');\n    console.log('Migration completed successfully!');\n    console.log('========================================');\n    console.log(`Total users: ${stats[0].total}`);\n    console.log(`Users with username: ${stats[0].with_username}`);\n    console.log(`Verified users: ${stats[0].verified}`);\n    \n  } catch (error) {\n    console.error('\\nMigration failed:', error);\n    process.exit(1);\n  } finally {\n    await prisma.$disconnect();\n  }\n}\n\nmigrate();\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\scripts\\migrate-flight-tracks.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":1,"column":26,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":1,"endColumn":51}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const { PrismaClient } = require('@prisma/client');\n\nconst prisma = new PrismaClient();\n\nasync function migrate() {\n  try {\n    console.log('Checking if FlightTrack table exists...');\n    \n    // Check if table exists\n    const tableExists = await prisma.$queryRaw`\n      SELECT * FROM INFORMATION_SCHEMA.TABLES \n      WHERE TABLE_NAME = 'FlightTrack'\n    `;\n    \n    if (tableExists.length > 0) {\n      console.log('âœ“ FlightTrack table already exists');\n      return;\n    }\n    \n    console.log('Creating FlightTrack table...');\n    \n    // Create table\n    await prisma.$executeRaw`\n      CREATE TABLE [FlightTrack] (\n        [id] NVARCHAR(36) NOT NULL PRIMARY KEY,\n        [userId] NVARCHAR(36) NOT NULL,\n        [name] NVARCHAR(200) NOT NULL,\n        [date] DATETIME NOT NULL,\n        [aircraft] NVARCHAR(100) NULL,\n        [trackData] NVARCHAR(MAX) NOT NULL,\n        [totalDistance] FLOAT NOT NULL DEFAULT 0,\n        [maxAltitude] FLOAT NOT NULL DEFAULT 0,\n        [maxSpeed] FLOAT NOT NULL DEFAULT 0,\n        [duration] FLOAT NOT NULL DEFAULT 0,\n        [createdAt] DATETIME NOT NULL DEFAULT GETDATE(),\n        [updatedAt] DATETIME NOT NULL DEFAULT GETDATE()\n      )\n    `;\n    \n    console.log('âœ“ FlightTrack table created');\n    \n    // Create indexes\n    await prisma.$executeRaw`\n      CREATE INDEX [IX_FlightTrack_userId] ON [FlightTrack]([userId])\n    `;\n    console.log('âœ“ Index on userId created');\n    \n    await prisma.$executeRaw`\n      CREATE INDEX [IX_FlightTrack_date] ON [FlightTrack]([date])\n    `;\n    console.log('âœ“ Index on date created');\n    \n    console.log('\\n========================================');\n    console.log('Migration completed successfully!');\n    console.log('========================================');\n    \n  } catch (error) {\n    console.error('\\nMigration failed:', error);\n    process.exit(1);\n  } finally {\n    await prisma.$disconnect();\n  }\n}\n\nmigrate();\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\scripts\\migrate-logbook.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":1,"column":26,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":1,"endColumn":51}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const { PrismaClient } = require('@prisma/client');\n\nconst prisma = new PrismaClient();\n\nasync function migrate() {\n  try {\n    console.log('Checking if LogbookEntry table exists...');\n    \n    // Check if table exists\n    const tableExists = await prisma.$queryRaw`\n      SELECT * FROM INFORMATION_SCHEMA.TABLES \n      WHERE TABLE_NAME = 'LogbookEntry'\n    `;\n    \n    if (tableExists.length > 0) {\n      console.log('âœ“ LogbookEntry table already exists');\n      return;\n    }\n    \n    console.log('Creating LogbookEntry table...');\n    \n    // Create table without foreign key (we'll handle referential integrity in app)\n    await prisma.$executeRaw`\n      CREATE TABLE [LogbookEntry] (\n        [id] NVARCHAR(36) NOT NULL PRIMARY KEY,\n        [userId] NVARCHAR(36) NOT NULL,\n        [date] DATETIME NOT NULL,\n        [aircraft] NVARCHAR(100) NOT NULL,\n        [routeFrom] NVARCHAR(10) NOT NULL,\n        [routeTo] NVARCHAR(10) NOT NULL,\n        [totalTime] FLOAT NOT NULL DEFAULT 0,\n        [soloTime] FLOAT NOT NULL DEFAULT 0,\n        [dualGiven] FLOAT NOT NULL DEFAULT 0,\n        [dualReceived] FLOAT NOT NULL DEFAULT 0,\n        [nightTime] FLOAT NOT NULL DEFAULT 0,\n        [instrumentTime] FLOAT NOT NULL DEFAULT 0,\n        [crossCountryTime] FLOAT NOT NULL DEFAULT 0,\n        [dayLandings] INT NOT NULL DEFAULT 0,\n        [nightLandings] INT NOT NULL DEFAULT 0,\n        [remarks] NVARCHAR(MAX) NULL,\n        [instructor] NVARCHAR(100) NULL,\n        [flightPlanId] NVARCHAR(100) NULL,\n        [createdAt] DATETIME NOT NULL DEFAULT GETDATE(),\n        [updatedAt] DATETIME NOT NULL DEFAULT GETDATE()\n      )\n    `;\n    \n    console.log('âœ“ LogbookEntry table created');\n    \n    // Create indexes\n    await prisma.$executeRaw`\n      CREATE INDEX [IX_LogbookEntry_userId] ON [LogbookEntry]([userId])\n    `;\n    console.log('âœ“ Index on userId created');\n    \n    await prisma.$executeRaw`\n      CREATE INDEX [IX_LogbookEntry_date] ON [LogbookEntry]([date])\n    `;\n    console.log('âœ“ Index on date created');\n    \n    console.log('\\n========================================');\n    console.log('Migration completed successfully!');\n    console.log('========================================');\n    \n  } catch (error) {\n    console.error('\\nMigration failed:', error);\n    process.exit(1);\n  } finally {\n    await prisma.$disconnect();\n  }\n}\n\nmigrate();\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\scripts\\scrape-airnav-fuel.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":7,"column":17,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":7,"endColumn":35},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":8,"column":15,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":8,"endColumn":31},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":9,"column":14,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":9,"endColumn":29},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":10,"column":14,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":10,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'UPDATE_FREQUENCY' is assigned a value but never used.","line":285,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":285,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'airportType' is defined but never used.","line":370,"column":39,"nodeType":"Identifier","messageId":"unusedVar","endLine":370,"endColumn":50}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * AirNav Fuel Price Scraper\n * Scrapes fuel prices from AirNav.com\n * Smart caching: Large airports = more frequent, Small airports = less frequent\n */\n\nconst sqlite3 = require('sqlite3').verbose();\nconst https = require('https');\nconst http = require('http');\nconst path = require('path');\n\nconst DB_PATH = path.join(__dirname, '..', 'data', 'aviation_hub.db');\n\n// US Airports to scrape - Large, Medium, Small\nconst AIRPORTS = [\n  // === LARGE AIRPORTS (Major hubs) ===\n  { icao: 'KATL', name: 'Hartsfield-Jackson Atlanta', type: 'large' },\n  { icao: 'KORD', name: \"Chicago O'Hare\", type: 'large' },\n  { icao: 'KLAX', name: 'Los Angeles International', type: 'large' },\n  { icao: 'KDFW', name: 'Dallas/Fort Worth', type: 'large' },\n  { icao: 'KDEN', name: 'Denver International', type: 'large' },\n  { icao: 'KJFK', name: 'John F Kennedy International', type: 'large' },\n  { icao: 'KSFO', name: 'San Francisco International', type: 'large' },\n  { icao: 'KLAS', name: 'Harry Reid (Las Vegas)', type: 'large' },\n  { icao: 'KSEA', name: 'Seattle-Tacoma International', type: 'large' },\n  { icao: 'KMIA', name: 'Miami International', type: 'large' },\n  { icao: 'KFLL', name: 'Fort Lauderdale International', type: 'large' },\n  { icao: 'KMCO', name: 'Orlando International', type: 'large' },\n  { icao: 'KPHX', name: 'Phoenix Sky Harbor', type: 'large' },\n  { icao: 'KIAH', name: 'George Bush Intercontinental', type: 'large' },\n  { icao: 'KBOS', name: 'Boston Logan', type: 'large' },\n  { icao: 'KMSP', name: 'Minneapolis-St Paul', type: 'large' },\n  { icao: 'KCLT', name: 'Charlotte Douglas', type: 'large' },\n  { icao: 'KDTW', name: 'Detroit Metropolitan', type: 'large' },\n  { icao: 'KPHL', name: 'Philadelphia International', type: 'large' },\n  { icao: 'KLGA', name: 'LaGuardia', type: 'large' },\n  { icao: 'KEWR', name: 'Newark Liberty', type: 'large' },\n  { icao: 'KBWI', name: 'Baltimore/Washington', type: 'large' },\n  { icao: 'KDCA', name: 'Reagan National', type: 'large' },\n  { icao: 'KIAD', name: 'Washington Dulles', type: 'large' },\n  { icao: 'KSAN', name: 'San Diego International', type: 'large' },\n  { icao: 'KDAL', name: 'Dallas Love Field', type: 'large' },\n  { icao: 'KMDW', name: 'Chicago Midway', type: 'large' },\n  { icao: 'KSLC', name: 'Salt Lake City', type: 'large' },\n  { icao: 'KPDX', name: 'Portland International', type: 'large' },\n  { icao: 'KSTL', name: 'St Louis Lambert', type: 'large' },\n  { icao: 'KIND', name: 'Indianapolis International', type: 'large' },\n  { icao: 'KCLE', name: 'Cleveland Hopkins', type: 'large' },\n  { icao: 'KPIT', name: 'Pittsburgh International', type: 'large' },\n  { icao: 'KMCI', name: 'Kansas City International', type: 'large' },\n  { icao: 'KCVG', name: 'Cincinnati/Northern Kentucky', type: 'large' },\n  { icao: 'KTPA', name: 'Tampa International', type: 'large' },\n  { icao: 'KRSW', name: 'Southwest Florida International', type: 'large' },\n  { icao: 'KJAX', name: 'Jacksonville International', type: 'large' },\n  { icao: 'KMSY', name: 'New Orleans Louis Armstrong', type: 'large' },\n  { icao: 'KABQ', name: 'Albuquerque International', type: 'large' },\n  { icao: 'KOKC', name: 'Oklahoma Will Rogers', type: 'large' },\n  { icao: 'KTUL', name: 'Tulsa International', type: 'large' },\n  { icao: 'KLIT', name: 'Little Rock', type: 'large' },\n  { icao: 'KMEM', name: 'Memphis International', type: 'large' },\n  { icao: 'KBHM', name: 'Birmingham-Shuttlesworth', type: 'large' },\n  { icao: 'KRIC', name: 'Richmond International', type: 'large' },\n  { icao: 'KORF', name: 'Norfolk International', type: 'large' },\n  { icao: 'KRDU', name: 'Raleigh-Durham International', type: 'large' },\n  { icao: 'KCLT', name: 'Charlotte Douglas', type: 'large' },\n  { icao: 'KGSO', name: 'Piedmont Triad', type: 'large' },\n  { icao: 'KCMH', name: 'John Glenn Columbus', type: 'large' },\n  { icao: 'KDAY', name: 'Dayton International', type: 'large' },\n  \n  // === MEDIUM AIRPORTS (Regional hubs) ===\n  { icao: 'KGRR', name: 'Gerald R Ford International', type: 'medium' },\n  { icao: 'KFNT', name: 'Bishop International', type: 'medium' },\n  { icao: 'KLAN', name: 'Capital Region International', type: 'medium' },\n  { icao: 'KTVC', name: 'Cherry Capital', type: 'medium' },\n  { icao: 'KMBS', name: 'MBS International', type: 'medium' },\n  { icao: 'KSAW', name: 'Marquette/Sawyer', type: 'medium' },\n  { icao: 'KCIU', name: 'Chippewa County International', type: 'medium' },\n  { icao: 'KAZO', name: 'Kalamazoo/Battle Creek', type: 'medium' },\n  { icao: 'KBTL', name: 'Battle Creek Executive', type: 'medium' },\n  { icao: 'KESC', name: 'Delta County', type: 'medium' },\n  { icao: 'KCMX', name: 'Houghton County Memorial', type: 'medium' },\n  { icao: 'KJXN', name: 'Jackson County', type: 'medium' },\n  { icao: 'KMKG', name: 'Muskegon County', type: 'medium' },\n  { icao: 'KPTK', name: 'Oakland County International', type: 'medium' },\n  { icao: 'KPLN', name: 'Pellston Regional', type: 'medium' },\n  { icao: 'KDET', name: 'Coleman A Young Municipal', type: 'medium' },\n  { icao: 'KAPN', name: 'Alpena County Regional', type: 'medium' },\n  { icao: 'KBEH', name: 'Southwest Michigan Regional', type: 'medium' },\n  { icao: 'KTTF', name: 'Monroe Custer', type: 'medium' },\n  { icao: 'K3RM', name: 'St Marys', type: 'medium' },\n  // Ohio\n  { icao: 'KCAK', name: 'Akron-Canton Regional', type: 'medium' },\n  { icao: 'KLCK', name: 'Rickenbacker International', type: 'medium' },\n  { icao: 'KMFD', name: 'Mansfield Lahm Regional', type: 'medium' },\n  { icao: 'KMNG', name: 'Mount Pleasant Muni', type: 'medium' },\n  { icao: 'KHAK', name: 'Hooks Field', type: 'medium' },\n  // Wisconsin\n  { icao: 'KMSN', name: 'Madison Dane County', type: 'medium' },\n  { icao: 'KMKE', name: 'Milwaukee Mitchell', type: 'medium' },\n  { icao: 'KGRB', name: 'Green Bay Austin Straubel', type: 'medium' },\n  { icao: 'KOSH', name: 'Oshkosh Wittman Regional', type: 'medium' },\n  { icao: 'KEAU', name: 'Chippewa Valley Regional', type: 'medium' },\n  // Indiana\n  { icao: 'KSBN', name: 'South Bend International', type: 'medium' },\n  { icao: 'KLAF', name: 'Purdue University', type: 'medium' },\n  { icao: 'KBMG', name: 'Bloomington Municipal', type: 'medium' },\n  { icao: 'KGEZ', name: 'Seymour Johnson', type: 'medium' },\n  // Illinois\n  { icao: 'KMLI', name: 'Quad Cities International', type: 'medium' },\n  { icao: 'KBMI', name: 'Central Illinois Regional', type: 'medium' },\n  { icao: 'KTIP', name: 'Rantoul National Aviation', type: 'medium' },\n  // Colorado\n  { icao: 'KEGE', name: 'Eagle County Regional', type: 'medium' },\n  { icao: 'KASE', name: 'Aspen Pitkin County', type: 'medium' },\n  { icao: 'KPUB', name: 'Pueblo Memorial', type: 'medium' },\n  // Texas\n  { icao: 'KHOU', name: 'William P Hobby', type: 'medium' },\n  { icao: 'KSAT', name: 'San Antonio International', type: 'medium' },\n  { icao: 'KAUS', name: 'Austin-Bergstrom', type: 'medium' },\n  { icao: 'KCRP', name: 'Corpus Christi International', type: 'medium' },\n  { icao: 'KLFK', name: 'Lufkin Angelina County', type: 'medium' },\n  // California\n  { icao: 'KSNA', name: 'John Wayne Orange County', type: 'medium' },\n  { icao: 'KBUR', name: 'Hollywood Burbank', type: 'medium' },\n  { icao: 'KSJC', name: 'Norman Y Mineta San Jose', type: 'medium' },\n  { icao: 'KOAK', name: 'Oakland International', type: 'medium' },\n  { icao: 'KSMF', name: 'Sacramento International', type: 'medium' },\n  { icao: 'KONT', name: 'Ontario International', type: 'medium' },\n  { icao: 'KPSP', name: 'Palm Springs International', type: 'medium' },\n  { icao: 'KFAT', name: 'Fresno Yosemite International', type: 'medium' },\n  // Florida\n  { icao: 'KPBI', name: 'Palm Beach International', type: 'medium' },\n  { icao: 'KTLH', name: 'Tallahassee International', type: 'medium' },\n  { icao: 'KGNV', name: 'Gainesville Regional', type: 'medium' },\n  { icao: 'KECP', name: 'Northwest Florida Beaches', type: 'medium' },\n  // Georgia\n  { icao: 'KSAV', name: 'Savannah/Hilton Head International', type: 'medium' },\n  { icao: 'KABY', name: 'Southwest Georgia Regional', type: 'medium' },\n  { icao: 'KAGS', name: 'Augusta Regional', type: 'medium' },\n  { icao: 'KMCN', name: 'Middle Georgia Regional', type: 'medium' },\n  // North Carolina\n  { icao: 'KFAY', name: 'Fayetteville Regional', type: 'medium' },\n  { icao: 'KILM', name: 'Wilmington International', type: 'medium' },\n  { icao: 'KCLT', name: 'Charlotte Douglas', type: 'medium' },\n  // Virginia\n  { icao: 'KDCA', name: 'Reagan National', type: 'medium' },\n  { icao: 'KCHO', name: 'Charlottesville-Albemarle', type: 'medium' },\n  { icao: 'KLYH', name: 'Lynchburg Regional', type: 'medium' },\n  // Pennsylvania\n  { icao: 'KMDT', name: 'Harrisburg International', type: 'medium' },\n  { icao: 'KAVP', name: 'Wilkes-Barre Scranton', type: 'medium' },\n  { icao: 'KUNV', name: 'University Park', type: 'medium' },\n  // New York\n  { icao: 'KBUF', name: 'Buffalo Niagara International', type: 'medium' },\n  { icao: 'KROC', name: 'Greater Rochester International', type: 'medium' },\n  { icao: 'KSYR', name: 'Syracuse Hancock International', type: 'medium' },\n  { icao: 'KALB', name: 'Albany International', type: 'medium' },\n  { icao: 'KIAG', name: 'Niagara Falls International', type: 'medium' },\n  // New Jersey\n  { icao: 'KACY', name: 'Atlantic City International', type: 'medium' },\n  { icao: 'KMMU', name: 'Morristown Municipal', type: 'medium' },\n  { icao: 'KTEB', name: 'Teterboro', type: 'medium' },\n  // Connecticut\n  { icao: 'KBDL', name: 'Bradley International', type: 'medium' },\n  { icao: 'KDXR', name: 'Danbury Municipal', type: 'medium' },\n  // Massachusetts\n  { icao: 'KACK', name: 'Nantucket Memorial', type: 'medium' },\n  { icao: 'KEWB', name: 'New Bedford Regional', type: 'medium' },\n  { icao: 'KHYA', name: 'Barnstable Municipal', type: 'medium' },\n  // Arizona\n  { icao: 'KTUS', name: 'Tucson International', type: 'medium' },\n  { icao: 'KFLG', name: 'Flagstaff Pulliam', type: 'medium' },\n  { icao: 'KYUM', name: 'Yuma International', type: 'medium' },\n  \n  // === SMALL AIRPORTS (GA fields with fuel) ===\n  // Michigan\n  { icao: 'KIMT', name: 'Ford Airport', type: 'small' },\n  { icao: 'KYIP', name: 'Willow Run', type: 'small' },\n  { icao: 'KMTC', name: 'Selfridge ANG', type: 'small' },\n  { icao: 'KADG', name: 'Lenawee County', type: 'small' },\n  { icao: 'KAMN', name: 'Alma Municipal', type: 'small' },\n  { icao: 'KBAX', name: 'Hancock County', type: 'small' },\n  { icao: 'KCAD', name: 'Mackinac County', type: 'small' },\n  { icao: 'KCIU', name: 'Chippewa County', type: 'small' },\n  { icao: 'KDUP', name: 'Drummond Island', type: 'small' },\n  { icao: 'KERY', name: ' Luce County', type: 'small' },\n  { icao: 'KGPZ', name: 'Grand Rapids', type: 'small' },\n  { icao: 'KHAI', name: 'Three Rivers', type: 'small' },\n  { icao: 'KJXN', name: 'Jackson', type: 'small' },\n  { icao: 'KLWA', name: 'Southwest Michigan Regional', type: 'small' },\n  { icao: 'KMBL', name: 'Manistee County', type: 'small' },\n  { icao: 'KMGN', name: 'Muskegon County', type: 'small' },\n  { icao: 'KMPU', name: 'Mackinaw City', type: 'small' },\n  { icao: 'KOEB', name: 'Branch County', type: 'small' },\n  { icao: 'KOSC', name: 'Oscoda County', type: 'small' },\n  { icao: 'KP58', name: 'St Clair County', type: 'small' },\n  // Ohio\n  { icao: 'KOSU', name: 'Ohio State University', type: 'small' },\n  { icao: 'KHAO', name: 'Butler County', type: 'small' },\n  { icao: 'KVGT', name: 'North Las Vegas', type: 'small' },\n  { icao: 'KMIF', name: 'Middletown Regional', type: 'small' },\n  { icao: 'KAXV', name: 'Andrews University', type: 'small' },\n  { icao: 'KVTA', name: 'Newark-Heath', type: 'small' },\n  { icao: 'KBKF', name: 'Burlington', type: 'small' },\n  { icao: 'KMGY', name: 'Dayton-Wright Brothers', type: 'small' },\n  // Wisconsin  \n  { icao: 'KRYV', name: 'Dodge County', type: 'small' },\n  { icao: 'KUES', name: 'Waukesha County', type: 'small' },\n  { icao: 'KATW', name: 'Outagamie County', type: 'small' },\n  { icao: 'KC89', name: 'Steven Pleasant', type: 'small' },\n  { icao: 'KMWC', name: 'Lawrence J Timmerman', type: 'small' },\n  // Indiana\n  { icao: 'KHUF', name: 'Terra Haute Regional', type: 'small' },\n  { icao: 'KASX', name: 'John F Kennedy Memorial', type: 'small' },\n  { icao: 'KBMG', name: 'Monroe County', type: 'small' },\n  { icao: 'KCEV', name: 'Mettel Field', type: 'small' },\n  // Colorado\n  { icao: 'KBJC', name: 'Rocky Mountain Metro', type: 'small' },\n  { icao: 'KBDU', name: 'Boulder Municipal', type: 'small' },\n  { icao: 'KAEJ', name: 'Buena Vista Municipal', type: 'small' },\n  { icao: 'KCAG', name: 'Craig-Moffat', type: 'small' },\n  // Utah\n  { icao: 'KHIF', name: 'Hill AFB', type: 'small' },\n  { icao: 'KPVU', name: 'Provo Municipal', type: 'small' },\n  // Texas\n  { icao: 'KDAL', name: 'Dallas Love Field', type: 'small' },\n  { icao: 'KHOU', name: 'William P Hobby', type: 'small' },\n  { icao: 'KGRK', name: 'Killeen-Fort Hood Regional', type: 'small' },\n  { icao: 'KTKI', name: 'McKinney National', type: 'small' },\n  { icao: 'KAFW', name: 'Fort Worth Alliance', type: 'small' },\n  // California\n  { icao: 'KVNY', name: 'Van Nuys', type: 'small' },\n  { icao: 'KHWD', name: 'Hayward Executive', type: 'small' },\n  { icao: 'KPAO', name: 'Palo Alto Airport', type: 'small' },\n  { icao: 'KSQL', name: 'San Carlos Airport', type: 'small' },\n  { icao: 'KACV', name: 'Arcata Airport', type: 'small' },\n  { icao: 'KSCK', name: 'Stockton Metropolitan', type: 'small' },\n  { icao: 'KSMF', name: 'Sacramento Executive', type: 'small' },\n  { icao: 'KRNM', name: 'Ramona Airport', type: 'small' },\n  { icao: 'KCRQ', name: 'McClellan-Palomar', type: 'small' },\n  // Florida\n  { icao: 'KVRB', name: 'Vero Beach Regional', type: 'small' },\n  { icao: 'KFXE', name: 'Fort Lauderdale Executive', type: 'small' },\n  { icao: 'KTMB', name: 'Miami-Opa Locka', type: 'small' },\n  { icao: 'KOBE', name: 'Okeechobee County', type: 'small' },\n  { icao: 'KPMP', name: 'Pompano Beach Airpark', type: 'small' },\n  { icao: 'KBCT', name: 'Boca Raton', type: 'small' },\n  // Georgia\n  { icao: 'KFTY', name: 'Fulton County', type: 'small' },\n  { icao: 'KPDK', name: 'DeKalb-Peachtree', type: 'small' },\n  { icao: 'KMCN', name: 'Middle Georgia Regional', type: 'small' },\n  { icao: 'KAHN', name: 'Athens-Ben Epps', type: 'small' },\n  // North Carolina\n  { icao: 'KINT', name: 'Smith Reynolds', type: 'small' },\n  { icao: 'KASJ', name: 'Asheville Regional', type: 'small' },\n  { icao: 'KSOP', name: 'Moore County', type: 'small' },\n  // Pennsylvania\n  { icao: 'KCXY', name: 'Capital City', type: 'small' },\n  { icao: 'KLNS', name: 'Lancaster', type: 'small' },\n  { icao: 'KFKL', name: 'Franklin', type: 'small' },\n  // New York\n  { icao: 'KHPN', name: 'Westchester County', type: 'small' },\n  { icao: 'KFRG', name: 'Republic Airport', type: 'small' },\n  { icao: 'KSWF', name: 'Newburgh-Stewart', type: 'small' },\n  { icao: 'KELM', name: 'Elmira-Corning Regional', type: 'small' },\n  // Connecticut\n  { icao: 'KHVN', name: 'Tweed-New Haven', type: 'small' },\n  // Massachusetts\n  { icao: 'KBED', name: 'Hanscom Field', type: 'small' },\n  { icao: 'KMVY', name: \"Martha's Vineyard\", type: 'small' },\n  { icao: 'KPYM', name: 'Plymouth Municipal', type: 'small' },\n  // Alaska\n  { icao: 'PANC', name: 'Ted Stevens Anchorage', type: 'medium' },\n  { icao: 'PAFA', name: 'Fairbanks International', type: 'medium' },\n  { icao: 'PAJN', name: 'Juneau International', type: 'medium' },\n  { icao: 'PAKT', name: 'Ketchikan International', type: 'medium' },\n  // Hawaii\n  { icao: 'PHNL', name: 'Daniel K Inouye Honolulu', type: 'medium' },\n  { icao: 'PHKO', name: 'Kona International', type: 'medium' },\n  { icao: 'PHOG', name: 'Kahului Airport', type: 'medium' },\n  { icao: 'PHLI', name: 'Lihue Airport', type: 'medium' },\n];\n\n// Update frequency based on airport type (in hours)\nconst UPDATE_FREQUENCY = {\n  large: 72,    // 3 days\n  medium: 168,  // 1 week  \n  small: 720    // 30 days\n};\n\nfunction httpGet(url) {\n  return new Promise((resolve, reject) => {\n    const protocol = url.startsWith('https') ? https : http;\n    const req = protocol.get(url, {\n      headers: { 'User-Agent': 'Mozilla/5.0' }\n    }, (res) => {\n      let data = '';\n      res.on('data', chunk => data += chunk);\n      res.on('end', () => resolve({ status: res.statusCode, data }));\n    });\n    req.on('error', reject);\n    req.setTimeout(15000, () => { req.destroy(); reject(new Error('Timeout')); });\n  });\n}\n\nfunction parseFuelPrices(html, icao) {\n  const results = [];\n  \n  // Look for the fuel price table in the page\n  // Pattern: <td>100LL</td> ... <td>$6.00</td> format\n  const lines = html.split('\\n');\n  \n  let inFuelSection = false;\n  let lastReported = null;\n  let prices = { '100LL': null, 'JetA': null };\n  \n  for (const line of lines) {\n    // Find update date\n    const dateMatch = line.match(/Updated\\s+(\\d{1,2}-[A-Z]{3}-\\d{4})/i);\n    if (dateMatch) lastReported = dateMatch[1];\n    \n    // Check if we're in fuel section\n    if (line.includes('100LL') || line.includes('Jet A')) {\n      inFuelSection = true;\n    }\n    \n    // Extract prices - look for $X.XX pattern\n    const priceMatch = line.match(/\\$([0-9]+\\.?[0-9]*)/g);\n    if (priceMatch && inFuelSection) {\n      for (const priceStr of priceMatch) {\n        const price = parseFloat(priceStr.replace('$', ''));\n        if (price > 0 && price < 20) { // Reasonable fuel price range\n          if (!prices['100LL']) prices['100LL'] = price;\n          else if (!prices['JetA']) prices['JetA'] = price;\n        }\n      }\n    }\n  }\n  \n  // Create records\n  if (prices['100LL']) {\n    results.push({\n      icao,\n      fbo_name: 'Airport Default',\n      fuel_type: '100LL',\n      service_type: 'Full Service',\n      price: prices['100LL'],\n      guaranteed: 0,\n      last_reported: lastReported,\n      source_url: `https://www.airnav.com/airport/${icao}`\n    });\n  }\n  \n  if (prices['JetA']) {\n    results.push({\n      icao,\n      fbo_name: 'Airport Default',\n      fuel_type: 'JetA',\n      service_type: 'Full Service',\n      price: prices['JetA'],\n      guaranteed: 0,\n      last_reported: lastReported,\n      source_url: `https://www.airnav.com/airport/${icao}`\n    });\n  }\n  \n  return results;\n}\n\nfunction insertFuelData(db, fuelData, airportType) {\n  return new Promise((resolve, reject) => {\n    const stmt = db.prepare(`\n      INSERT OR REPLACE INTO airport_fuel \n      (icao, fbo_name, fuel_type, service_type, price, guaranteed, last_reported, source_url, scraped_at)\n      VALUES (?, ?, ?, ?, ?, ?, ?, ?, datetime('now'))\n    `);\n\n    // Also insert into history\n    const historyStmt = db.prepare(`\n      INSERT INTO airport_fuel_history \n      (icao, fbo_name, fuel_type, service_type, price, source)\n      VALUES (?, ?, ?, ?, ?, 'airnav')\n    `);\n    \n    for (const data of fuelData) {\n      stmt.run([\n        data.icao,\n        data.fbo_name,\n        data.fuel_type,\n        data.service_type,\n        data.price,\n        data.guaranteed,\n        data.last_reported,\n        data.source_url\n      ]);\n      \n      // Add to history\n      historyStmt.run([\n        data.icao,\n        data.fbo_name,\n        data.fuel_type,\n        data.service_type,\n        data.price\n      ]);\n    }\n    stmt.finalize((err) => err ? reject(err) : resolve());\n  });\n}\n\nasync function scrape() {\n  console.log('=== AirNav Fuel Scraper ===\\n');\n  console.log('Update frequencies: Large=72h, Medium=168h, Small=720h\\n');\n  \n  const db = new sqlite3.Database(DB_PATH);\n  let total = 0;\n  let large = 0, medium = 0, small = 0;\n  \n  for (const airport of AIRPORTS) {\n    console.log(`[${airport.icao}] ${airport.name} (${airport.type})`);\n    \n    try {\n      const url = `https://www.airnav.com/airport/${airport.icao}`;\n      const response = await httpGet(url);\n      \n      if (response.status !== 200) {\n        console.log(`  Error: HTTP ${response.status}`);\n        continue;\n      }\n      \n      const prices = parseFuelPrices(response.data, airport.icao);\n      \n      if (prices.length > 0) {\n        await insertFuelData(db, prices, airport.type);\n        \n        // Calculate average\n        const avgPrice = prices.reduce((sum, p) => sum + p.price, 0) / prices.length;\n        \n        console.log(`  âœ“ ${prices.length} prices found, avg: $${avgPrice.toFixed(2)}`);\n        \n        if (airport.type === 'large') large++;\n        else if (airport.type === 'medium') medium++;\n        else small++;\n        total += prices.length;\n      } else {\n        console.log(`  âœ— No prices found`);\n      }\n      \n    } catch (error) {\n      console.log(`  Error: ${error.message}`);\n    }\n    \n    await new Promise(r => setTimeout(r, 3000));\n  }\n  \n  // Summary\n  console.log('\\n=== Summary ===');\n  console.log(`Large airports: ${large}`);\n  console.log(`Medium airports: ${medium}`);\n  console.log(`Small airports: ${small}`);\n  console.log(`Total prices: ${total}`);\n  \n  db.close();\n}\n\nscrape().catch(console.error);\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\scripts\\scrape-airport-contacts.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":18,"column":15,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":18,"endColumn":31},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":19,"column":17,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":19,"endColumn":35},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":20,"column":26,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":20,"endColumn":51},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'searchFlightClubs' is defined but never used.","line":220,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":220,"endColumn":33}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"#!/usr/bin/env node\n\n/**\n * Airport & Flight Club Contact Scraper\n * \n * Scrapes contact information for:\n * - Small airports (FBO managers, airport managers)\n * - Flight clubs (presidents, treasurers)\n * - Flight schools (chief instructors, owners)\n * \n * Sources:\n * - AirNav.com (airport info + FBOs)\n * - AOPA (flight clubs directory)\n * - EAA chapters\n * - Individual airport websites\n */\n\nconst axios = require('axios');\nconst cheerio = require('cheerio');\nconst { PrismaClient } = require('@prisma/client');\n\nconst prisma = new PrismaClient();\n\n// Configuration\nconst CONFIG = {\n  // Target states (expand as needed)\n  targetStates: ['MI', 'OH', 'IN', 'IL', 'WI', 'MN'],\n  \n  // Airport types to target\n  airportTypes: ['small_airport', 'seaplane_base'],\n  \n  // Delays to avoid rate limiting (ms)\n  delayBetweenRequests: 2000,\n  delayBetweenAirports: 5000,\n};\n\n// Helper: Sleep function\nconst sleep = (ms) => new Promise(resolve => setTimeout(resolve, ms));\n\n// Helper: Extract email from text\nfunction extractEmails(text) {\n  if (!text) return [];\n  const emailRegex = /[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}/g;\n  return [...new Set(text.match(emailRegex) || [])];\n}\n\n// Helper: Extract phone numbers\nfunction extractPhones(text) {\n  if (!text) return [];\n  const phoneRegex = /(\\+?1[-.\\s]?)?\\(?\\d{3}\\)?[-.\\s]?\\d{3}[-.\\s]?\\d{4}/g;\n  return [...new Set(text.match(phoneRegex) || [])];\n}\n\n// Helper: Clean and format text\nfunction cleanText(text) {\n  if (!text) return null;\n  return text.replace(/\\s+/g, ' ').trim();\n}\n\n/**\n * Scrape AirNav.com for airport and FBO information\n */\nasync function scrapeAirNav(icao) {\n  const url = `https://www.airnav.com/airport/${icao}`;\n  \n  try {\n    console.log(`[AirNav] Scraping ${icao}...`);\n    const response = await axios.get(url, {\n      headers: {\n        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',\n      },\n      timeout: 10000,\n    });\n\n    const $ = cheerio.load(response.data);\n    const contacts = [];\n\n    // Get airport basic info\n    const airportName = $('h1').first().text().trim();\n    const city = $('td:contains(\"City:\")').next().text().trim();\n    const state = $('td:contains(\"State:\")').next().text().trim();\n\n    // Look for manager/owner contact info\n    const managerSection = $('td:contains(\"Manager:\")').next().text();\n    const ownerSection = $('td:contains(\"Owner:\")').next().text();\n    \n    const emails = [\n      ...extractEmails(managerSection),\n      ...extractEmails(ownerSection),\n      ...extractEmails($.html()),\n    ];\n\n    const phones = [\n      ...extractPhones(managerSection),\n      ...extractPhones(ownerSection),\n    ];\n\n    if (emails.length > 0 || phones.length > 0) {\n      contacts.push({\n        organizationType: 'airport',\n        organizationName: airportName,\n        airportIcao: icao,\n        airportName,\n        city,\n        state,\n        contactEmail: emails[0] || null,\n        contactPhone: phones[0] || null,\n        alternateEmail: emails[1] || null,\n        alternatePhone: phones[1] || null,\n        sourceUrl: url,\n        sourceType: 'airnav',\n        notes: `Manager: ${cleanText(managerSection)}\\nOwner: ${cleanText(ownerSection)}`,\n      });\n    }\n\n    // Scrape FBO information\n    const fboSection = $('a[name=\"FBO\"]').parent().nextAll();\n    fboSection.each((i, elem) => {\n      const text = $(elem).text();\n      const fboName = $(elem).find('b').first().text();\n      \n      if (!fboName) return;\n\n      const fboEmails = extractEmails(text);\n      const fboPhones = extractPhones(text);\n\n      if (fboEmails.length > 0 || fboPhones.length > 0) {\n        contacts.push({\n          organizationType: 'fbo',\n          organizationName: fboName,\n          airportIcao: icao,\n          airportName,\n          city,\n          state,\n          contactEmail: fboEmails[0] || null,\n          contactPhone: fboPhones[0] || null,\n          alternateEmail: fboEmails[1] || null,\n          sourceUrl: url,\n          sourceType: 'airnav',\n          notes: cleanText(text),\n        });\n      }\n    });\n\n    console.log(`[AirNav] Found ${contacts.length} contacts for ${icao}`);\n    return contacts;\n\n  } catch (error) {\n    console.error(`[AirNav] Error scraping ${icao}:`, error.message);\n    return [];\n  }\n}\n\n/**\n * Scrape individual airport website\n */\nasync function scrapeAirportWebsite(airport) {\n  if (!airport.website) return [];\n\n  try {\n    console.log(`[Website] Scraping ${airport.website}...`);\n    const response = await axios.get(airport.website, {\n      headers: {\n        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',\n      },\n      timeout: 10000,\n    });\n\n    const $ = cheerio.load(response.data);\n    const text = $.text();\n\n    const emails = extractEmails(text);\n    const phones = extractPhones(text);\n\n    // Look for contact titles\n    const contactTitles = ['president', 'treasurer', 'manager', 'director', 'owner', 'chief instructor'];\n    let contactTitle = null;\n    let contactName = null;\n\n    for (const title of contactTitles) {\n      const titleRegex = new RegExp(`(${title})[:\\\\s-]+([A-Z][a-z]+\\\\s+[A-Z][a-z]+)`, 'i');\n      const match = text.match(titleRegex);\n      if (match) {\n        contactTitle = title.charAt(0).toUpperCase() + title.slice(1);\n        contactName = match[2];\n        break;\n      }\n    }\n\n    if (emails.length > 0 || phones.length > 0) {\n      return [{\n        organizationType: 'airport',\n        organizationName: airport.name,\n        airportIcao: airport.icao,\n        airportName: airport.name,\n        city: airport.city,\n        state: airport.state,\n        contactName,\n        contactTitle,\n        contactEmail: emails[0] || null,\n        contactPhone: phones[0] || null,\n        alternateEmail: emails[1] || null,\n        website: airport.website,\n        sourceUrl: airport.website,\n        sourceType: 'website',\n      }];\n    }\n\n    return [];\n\n  } catch (error) {\n    console.error(`[Website] Error scraping ${airport.website}:`, error.message);\n    return [];\n  }\n}\n\n/**\n * Search Google for flight club contact info\n */\nasync function searchFlightClubs(city, state) {\n  // This would use Google Custom Search API or Serper API\n  // For now, returning empty - implement with API key\n  console.log(`[Clubs] Searching for flight clubs in ${city}, ${state}...`);\n  return [];\n}\n\n/**\n * Save contacts to database\n */\nasync function saveContacts(contacts) {\n  let saved = 0;\n  let skipped = 0;\n\n  for (const contact of contacts) {\n    try {\n      // Check if contact already exists (by email or organization)\n      const existing = await prisma.outreachContact.findFirst({\n        where: {\n          OR: [\n            { contactEmail: contact.contactEmail },\n            {\n              AND: [\n                { organizationName: contact.organizationName },\n                { airportIcao: contact.airportIcao },\n              ],\n            },\n          ],\n        },\n      });\n\n      if (existing) {\n        // Update if we have new info\n        await prisma.outreachContact.update({\n          where: { id: existing.id },\n          data: {\n            ...contact,\n            updatedAt: new Date(),\n          },\n        });\n        console.log(`[DB] Updated: ${contact.organizationName}`);\n        skipped++;\n      } else {\n        // Create new\n        await prisma.outreachContact.create({\n          data: contact,\n        });\n        console.log(`[DB] Saved: ${contact.organizationName}`);\n        saved++;\n      }\n    } catch (error) {\n      console.error(`[DB] Error saving contact:`, error.message);\n    }\n  }\n\n  return { saved, skipped };\n}\n\n/**\n * Main scraping function\n */\nasync function main() {\n  console.log('ðŸš€ Starting airport contact scraper...\\n');\n\n  // Get target airports from database\n  const airports = await prisma.airportCache.findMany({\n    where: {\n      type: { in: CONFIG.airportTypes },\n      state: { in: CONFIG.targetStates },\n    },\n    take: 50, // Limit for testing - remove or increase later\n  });\n\n  console.log(`Found ${airports.length} airports to scrape\\n`);\n\n  let totalContacts = [];\n\n  for (const airport of airports) {\n    console.log(`\\nðŸ“ Processing: ${airport.icao} - ${airport.name}`);\n\n    // Scrape AirNav\n    const airNavContacts = await scrapeAirNav(airport.icao);\n    totalContacts = totalContacts.concat(airNavContacts);\n    await sleep(CONFIG.delayBetweenRequests);\n\n    // Scrape airport website if available\n    // Note: website field doesn't exist in current schema, would need to add or fetch separately\n    \n    await sleep(CONFIG.delayBetweenAirports);\n  }\n\n  // Save all contacts\n  console.log(`\\nðŸ’¾ Saving ${totalContacts.length} contacts to database...`);\n  const { saved, skipped } = await saveContacts(totalContacts);\n\n  console.log(`\\nâœ… Complete!`);\n  console.log(`   New contacts: ${saved}`);\n  console.log(`   Updated: ${skipped}`);\n  console.log(`   Total: ${saved + skipped}`);\n\n  await prisma.$disconnect();\n}\n\n// Run the script\nif (require.main === module) {\n  main().catch((error) => {\n    console.error('Fatal error:', error);\n    process.exit(1);\n  });\n}\n\nmodule.exports = { scrapeAirNav, scrapeAirportWebsite, saveContacts };\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\scripts\\scrape-east.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":7,"column":17,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":7,"endColumn":35},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":8,"column":15,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":8,"endColumn":31},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":9,"column":14,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":9,"endColumn":29},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":11,"column":17,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":11,"endColumn":32}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * AirNav Fuel Price Scraper - East Region\n * Scrapes fuel prices from AirNav.com\n * East US: CT, DE, FL, GA, ME, MD, MA, NH, NJ, NY, NC, PA, RI, SC, VT, VA, WV\n */\n\nconst sqlite3 = require('sqlite3').verbose();\nconst https = require('https');\nconst http = require('http');\n\nconst DB_PATH = require('path').join(__dirname, '..', 'data', 'aviation_hub.db');\n\n// East US states\nconst EAST_STATES = ['CT', 'DE', 'FL', 'GA', 'ME', 'MD', 'MA', 'NH', 'NJ', 'NY', 'NC', 'PA', 'RI', 'SC', 'VT', 'VA', 'WV'];\n\nfunction httpGet(url, retries = 3) {\n  return new Promise((resolve, reject) => {\n    const protocol = url.startsWith('https') ? https : http;\n    const req = protocol.get(url, { headers: { 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36' } }, (res) => {\n      // Handle rate limiting - wait and retry\n      if (res.statusCode === 503 && retries > 0) {\n        setTimeout(() => {\n          httpGet(url, retries - 1).then(resolve).catch(reject);\n        }, 5000);\n        return;\n      }\n      let data = '';\n      res.on('data', chunk => data += chunk);\n      res.on('end', () => resolve({ status: res.statusCode, data }));\n    });\n    req.on('error', reject);\n    req.setTimeout(15000, () => { req.destroy(); reject(new Error('Timeout')); });\n  });\n}\n\nfunction parseAirportData(html) {\n  const results = [];\n  const lines = html.split('\\n');\n  \n  let lastReported = null;\n  let prices = { '100LL': null, 'JetA': null };\n  let hasTower = 0;\n  let attendance = null;\n  let phone = null;\n  let landingFee = null;\n  let manager = null;\n  \n  const fullHtml = html;\n  \n  // Extract prices\n  for (const line of lines) {\n    const dateMatch = line.match(/Updated\\s+(\\d{1,2}-[A-Z]{3}-\\d{4})/i);\n    if (dateMatch) lastReported = dateMatch[1];\n    \n    const priceMatch = line.match(/\\$([0-9]+\\.?[0-9]*)/g);\n    if (priceMatch) {\n      for (const priceStr of priceMatch) {\n        const price = parseFloat(priceStr.replace('$', ''));\n        if (price > 0 && price < 20) {\n          if (!prices['100LL']) prices['100LL'] = price;\n          else if (!prices['JetA']) prices['JetA'] = price;\n        }\n        if (line.includes('Landing fee') || line.includes('landing fee')) {\n          if (price > 0 && price < 500) {\n            landingFee = price;\n          }\n        }\n      }\n    }\n  }\n  \n  // Extract tower\n  if (fullHtml.match(/Control tower:\\s*yes/i) || fullHtml.match(/Tower:\\s*yes/i)) {\n    hasTower = 1;\n  }\n  \n  // Extract attendance\n  const attendanceMatch = fullHtml.match(/Attendance:[^<]*<td[^>]*>([^<]+)<\\/td>/i);\n  if (attendanceMatch) {\n    attendance = attendanceMatch[1].trim();\n  }\n  \n  // Extract phone\n  const phoneMatch = fullHtml.match(/(\\d{3}[-.]?\\d{3}[-.]?\\d{4})/);\n  if (phoneMatch) {\n    phone = phoneMatch[1];\n  }\n  \n  // Extract manager\n  const managerMatch = fullHtml.match(/Manager:[^<]*<td[^>]*>([^<]+)<\\/td>/i);\n  if (managerMatch) {\n    manager = managerMatch[1].trim();\n  }\n  \n  // Extract landing fee\n  const landingMatch = fullHtml.match(/Landing fee:[^<]*<td[^>]*>\\s*([^<$]+)/i);\n  if (landingMatch) {\n    const fee = parseFloat(landingMatch[1].replace(/[$,]/g, ''));\n    if (!isNaN(fee) && fee > 0 && fee < 500) {\n      landingFee = fee;\n    }\n  }\n  \n  if (prices['100LL']) {\n    results.push({ \n      fuel_type: '100LL', \n      price: prices['100LL'], \n      last_reported: lastReported,\n      has_tower: hasTower,\n      attendance: attendance,\n      phone: phone,\n      landing_fee: landingFee,\n      manager: manager\n    });\n  }\n  if (prices['JetA']) {\n    results.push({ \n      fuel_type: 'JetA', \n      price: prices['JetA'], \n      last_reported: lastReported,\n      has_tower: hasTower,\n      attendance: attendance,\n      phone: phone,\n      landing_fee: landingFee,\n      manager: manager\n    });\n  }\n  \n  return results;\n}\n\nasync function scrape() {\n  console.log('=== AirNav Fuel Scraper - East Region ===\\n');\n  \n  const db = new sqlite3.Database(DB_PATH);\n  \n  // Get all East large airports\n  db.all(`SELECT icao, name, state FROM airports WHERE type = 'large_airport' AND state LIKE 'US-%' AND substr(state, 4, 2) IN (${EAST_STATES.map(s => `'${s}'`).join(',')}) ORDER BY state, name`, [], async (err, largeAirports) => {\n    if (err) { console.error(err); db.close(); return; }\n    \n    console.log(`Found ${largeAirports.length} large airports in East region\\n`);\n    \n    let total = 0;\n    \n    for (const airport of largeAirports) {\n      console.log(`[${airport.icao}] ${airport.name} (${airport.state})`);\n      \n      try {\n        const url = `https://www.airnav.com/airport/${airport.icao}`;\n        const response = await httpGet(url);\n        \n        if (response.status === 200) {\n          const prices = parseAirportData(response.data);\n          \n          if (prices.length > 0) {\n            for (const p of prices) {\n              db.run(`INSERT OR REPLACE INTO airport_fuel (icao, fbo_name, fuel_type, service_type, price, guaranteed, last_reported, source_url, scraped_at, has_tower, attendance, phone, landing_fee, manager) VALUES (?, 'Airport Default', ?, 'Full Service', ?, 0, ?, ?, datetime('now'), ?, ?, ?, ?, ?)`,\n                [airport.icao, p.fuel_type, p.price, p.last_reported, url, p.has_tower || 0, p.attendance, p.phone, p.landing_fee, p.manager]);\n              db.run(`INSERT INTO airport_fuel_history (icao, fbo_name, fuel_type, service_type, price, source) VALUES (?, 'Airport Default', ?, 'Full Service', ?, 'airnav')`,\n                [airport.icao, p.fuel_type, p.price]);\n            }\n            console.log(`  âœ“ ${prices.map(p => `$${p.price}`).join(', ')}${prices[0].has_tower ? ' [tower]' : ''}${prices[0].landing_fee ? ' $' : ''}`);\n            total += prices.length;\n          } else {\n            console.log(`  âœ— No prices`);\n          }\n        } else {\n          console.log(`  âœ— HTTP ${response.status}`);\n        }\n      } catch (e) {\n        console.log(`  âœ— ${e.message}`);\n      }\n      \n      await new Promise(r => setTimeout(r, 10000)); // 10 second delay between requests\n    }\n    \n    // Get medium airports\n    db.all(`SELECT icao, name, state FROM airports WHERE type = 'medium_airport' AND state LIKE 'US-%' AND substr(state, 4, 2) IN (${EAST_STATES.map(s => `'${s}'`).join(',')}) ORDER BY state, name`, async (err, mediumAirports) => {\n      console.log(`\\nFound ${mediumAirports.length} medium airports...\\n`);\n      \n      for (const airport of mediumAirports) {\n        process.stdout.write(`[${airport.icao}] ${airport.name}...`);\n        \n        try {\n          const url = `https://www.airnav.com/airport/${airport.icao}`;\n          const response = await httpGet(url);\n          \n          if (response.status === 200) {\n            const prices = parseAirportData(response.data);\n            \n            if (prices.length > 0) {\n              for (const p of prices) {\n                db.run(`INSERT OR REPLACE INTO airport_fuel (icao, fbo_name, fuel_type, service_type, price, guaranteed, last_reported, source_url, scraped_at, has_tower, attendance, phone, landing_fee, manager) VALUES (?, 'Airport Default', ?, 'Full Service', ?, 0, ?, ?, datetime('now'), ?, ?, ?, ?, ?)`,\n                  [airport.icao, p.fuel_type, p.price, p.last_reported, url, p.has_tower || 0, p.attendance, p.phone, p.landing_fee, p.manager]);\n                db.run(`INSERT INTO airport_fuel_history (icao, fbo_name, fuel_type, service_type, price, source) VALUES (?, 'Airport Default', ?, 'Full Service', ?, 'airnav')`,\n                  [airport.icao, p.fuel_type, p.price]);\n              }\n              console.log(` âœ“ ${prices.map(p => `$${p.price}`).join(', ')}`);\n              total += prices.length;\n            } else {\n              console.log(` âœ—`);\n            }\n          } else {\n            console.log(` âœ— HTTP ${response.status}`);\n          }\n        } catch (e) {\n          console.log(` âœ— ${e.message}`);\n        }\n        \n        await new Promise(r => setTimeout(r, 8000)); // 8 second delay between requests\n      }\n      \n      console.log(`\\n=== Summary ===`);\n      console.log(`Total prices scraped: ${total}`);\n      \n      db.get(\"SELECT COUNT(DISTINCT icao) as count FROM airport_fuel\", [], (err, row) => {\n        console.log(`Airports with fuel data: ${row.count}`);\n        db.close();\n      });\n    });\n  });\n}\n\nscrape().catch(console.error);\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\scripts\\scrape-flight-clubs.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":14,"column":15,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":14,"endColumn":31},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":15,"column":17,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":15,"endColumn":35},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":16,"column":26,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":16,"endColumn":51},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'locationText' is assigned a value but never used.","line":126,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":126,"endColumn":25}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"#!/usr/bin/env node\n\n/**\n * Flight Club Contact Scraper\n * \n * Scrapes flight club directories for contact information\n * \n * Sources:\n * - AOPA Flight Training Directory\n * - EAA Chapters\n * - Individual club websites\n */\n\nconst axios = require('axios');\nconst cheerio = require('cheerio');\nconst { PrismaClient } = require('@prisma/client');\n\nconst prisma = new PrismaClient();\n\nconst sleep = (ms) => new Promise(resolve => setTimeout(resolve, ms));\n\nfunction extractEmails(text) {\n  if (!text) return [];\n  const emailRegex = /[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}/g;\n  return [...new Set(text.match(emailRegex) || [])];\n}\n\nfunction extractPhones(text) {\n  if (!text) return [];\n  const phoneRegex = /(\\+?1[-.\\s]?)?\\(?\\d{3}\\)?[-.\\s]?\\d{3}[-.\\s]?\\d{4}/g;\n  return [...new Set(text.match(phoneRegex) || [])];\n}\n\nfunction cleanText(text) {\n  if (!text) return null;\n  return text.replace(/\\s+/g, ' ').trim();\n}\n\n/**\n * Scrape EAA Chapter directory\n * https://www.eaa.org/eaa/eaa-chapters/find-an-eaa-chapter\n */\nasync function scrapeEAAChapters(state) {\n  console.log(`[EAA] Scraping chapters for ${state}...`);\n  \n  const contacts = [];\n\n  try {\n    // EAA has a chapter locator - this is a simplified version\n    // Real implementation would need to handle their actual API/form\n    const response = await axios.get(`https://www.eaa.org/eaa/eaa-chapters/find-an-eaa-chapter`, {\n      headers: {\n        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',\n      },\n      timeout: 15000,\n    });\n\n    const $ = cheerio.load(response.data);\n\n    // Parse chapter listings\n    $('.chapter-listing').each((i, elem) => {\n      const chapterName = $(elem).find('.chapter-name').text().trim();\n      const location = $(elem).find('.location').text().trim();\n      const contact = $(elem).find('.contact').text();\n      \n      const emails = extractEmails(contact);\n      const phones = extractPhones(contact);\n\n      // Extract contact name and title\n      const nameMatch = contact.match(/([A-Z][a-z]+\\s+[A-Z][a-z]+)/);\n      const titleMatch = contact.match(/(President|Treasurer|Secretary)/i);\n\n      if (emails.length > 0 || phones.length > 0) {\n        contacts.push({\n          organizationType: 'flight_club',\n          organizationName: chapterName,\n          city: location.split(',')[0]?.trim(),\n          state: location.split(',')[1]?.trim(),\n          contactName: nameMatch ? nameMatch[1] : null,\n          contactTitle: titleMatch ? titleMatch[1] : null,\n          contactEmail: emails[0] || null,\n          contactPhone: phones[0] || null,\n          alternateEmail: emails[1] || null,\n          sourceUrl: 'https://www.eaa.org/eaa/eaa-chapters/find-an-eaa-chapter',\n          sourceType: 'eaa',\n          notes: cleanText(contact),\n        });\n      }\n    });\n\n    console.log(`[EAA] Found ${contacts.length} chapters`);\n    return contacts;\n\n  } catch (error) {\n    console.error(`[EAA] Error:`, error.message);\n    return [];\n  }\n}\n\n/**\n * Scrape flight school directories\n */\nasync function scrapeFlightSchools(city, state) {\n  console.log(`[Schools] Searching for flight schools in ${city}, ${state}...`);\n  \n  const contacts = [];\n\n  try {\n    // Search Google for flight schools\n    // Note: This requires Google Custom Search API key\n    // For now, using a placeholder\n\n    // Alternative: Scrape AOPA flight training directory\n    const response = await axios.get(`https://www.aopa.org/training-and-safety/learn-to-fly/flight-training-resources`, {\n      headers: {\n        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',\n      },\n      timeout: 15000,\n    });\n\n    const $ = cheerio.load(response.data);\n\n    // Parse flight school listings (structure depends on actual site)\n    $('.school-listing').each((i, elem) => {\n      const schoolName = $(elem).find('.name').text().trim();\n      const locationText = $(elem).find('.location').text().trim();\n      const contactText = $(elem).text();\n\n      const emails = extractEmails(contactText);\n      const phones = extractPhones(contactText);\n\n      if (emails.length > 0 || phones.length > 0) {\n        contacts.push({\n          organizationType: 'flight_school',\n          organizationName: schoolName,\n          city: city,\n          state: state,\n          contactEmail: emails[0] || null,\n          contactPhone: phones[0] || null,\n          alternateEmail: emails[1] || null,\n          sourceUrl: response.config.url,\n          sourceType: 'aopa',\n          notes: cleanText(contactText),\n        });\n      }\n    });\n\n    console.log(`[Schools] Found ${contacts.length} schools`);\n    return contacts;\n\n  } catch (error) {\n    console.error(`[Schools] Error:`, error.message);\n    return [];\n  }\n}\n\n/**\n * Scrape individual club website\n */\nasync function scrapeClubWebsite(url) {\n  try {\n    console.log(`[Club Website] Scraping ${url}...`);\n    \n    const response = await axios.get(url, {\n      headers: {\n        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',\n      },\n      timeout: 10000,\n    });\n\n    const $ = cheerio.load(response.data);\n    const text = $.text();\n    const html = $.html();\n\n    // Extract contact info\n    const emails = extractEmails(html);\n    const phones = extractPhones(text);\n\n    // Look for officer names and titles\n    const officers = [];\n    const titlePatterns = [\n      /President[:\\s-]+([A-Z][a-z]+\\s+[A-Z][a-z]+)/gi,\n      /Treasurer[:\\s-]+([A-Z][a-z]+\\s+[A-Z][a-z]+)/gi,\n      /Secretary[:\\s-]+([A-Z][a-z]+\\s+[A-Z][a-z]+)/gi,\n      /Chief\\s+Instructor[:\\s-]+([A-Z][a-z]+\\s+[A-Z][a-z]+)/gi,\n    ];\n\n    for (const pattern of titlePatterns) {\n      let match;\n      while ((match = pattern.exec(text)) !== null) {\n        const title = match[0].split(/[:\\s-]/)[0];\n        const name = match[1];\n        officers.push({ title, name });\n      }\n    }\n\n    // Get club name from title or h1\n    const clubName = $('title').text().split('|')[0].trim() || $('h1').first().text().trim();\n\n    const results = [];\n\n    if (officers.length > 0) {\n      officers.forEach((officer, index) => {\n        results.push({\n          organizationType: 'flight_club',\n          organizationName: clubName,\n          contactName: officer.name,\n          contactTitle: officer.title,\n          contactEmail: emails[index] || emails[0] || null,\n          contactPhone: phones[index] || phones[0] || null,\n          website: url,\n          sourceUrl: url,\n          sourceType: 'website',\n        });\n      });\n    } else if (emails.length > 0 || phones.length > 0) {\n      results.push({\n        organizationType: 'flight_club',\n        organizationName: clubName,\n        contactEmail: emails[0] || null,\n        contactPhone: phones[0] || null,\n        alternateEmail: emails[1] || null,\n        website: url,\n        sourceUrl: url,\n        sourceType: 'website',\n      });\n    }\n\n    return results;\n\n  } catch (error) {\n    console.error(`[Club Website] Error scraping ${url}:`, error.message);\n    return [];\n  }\n}\n\n/**\n * Save contacts to database\n */\nasync function saveContacts(contacts) {\n  let saved = 0;\n  let skipped = 0;\n\n  for (const contact of contacts) {\n    try {\n      const existing = await prisma.outreachContact.findFirst({\n        where: {\n          OR: [\n            { contactEmail: contact.contactEmail },\n            { organizationName: contact.organizationName },\n          ],\n        },\n      });\n\n      if (existing) {\n        await prisma.outreachContact.update({\n          where: { id: existing.id },\n          data: {\n            ...contact,\n            updatedAt: new Date(),\n          },\n        });\n        console.log(`[DB] Updated: ${contact.organizationName}`);\n        skipped++;\n      } else {\n        await prisma.outreachContact.create({\n          data: contact,\n        });\n        console.log(`[DB] Saved: ${contact.organizationName}`);\n        saved++;\n      }\n    } catch (error) {\n      console.error(`[DB] Error saving contact:`, error.message);\n    }\n  }\n\n  return { saved, skipped };\n}\n\n/**\n * Main function\n */\nasync function main() {\n  console.log('ðŸš€ Starting flight club scraper...\\n');\n\n  const targetStates = ['MI', 'OH', 'IN', 'IL', 'WI', 'MN'];\n  let allContacts = [];\n\n  // Scrape EAA chapters\n  for (const state of targetStates) {\n    const chapters = await scrapeEAAChapters(state);\n    allContacts = allContacts.concat(chapters);\n    await sleep(3000);\n  }\n\n  // Save all contacts\n  console.log(`\\nðŸ’¾ Saving ${allContacts.length} contacts to database...`);\n  const { saved, skipped } = await saveContacts(allContacts);\n\n  console.log(`\\nâœ… Complete!`);\n  console.log(`   New contacts: ${saved}`);\n  console.log(`   Updated: ${skipped}`);\n  console.log(`   Total: ${saved + skipped}`);\n\n  await prisma.$disconnect();\n}\n\nif (require.main === module) {\n  main().catch((error) => {\n    console.error('Fatal error:', error);\n    process.exit(1);\n  });\n}\n\nmodule.exports = { scrapeEAAChapters, scrapeFlightSchools, scrapeClubWebsite, saveContacts };\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\scripts\\scrape-midwest.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":7,"column":17,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":7,"endColumn":35},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":8,"column":15,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":8,"endColumn":31},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":9,"column":14,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":9,"endColumn":29},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":11,"column":17,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":11,"endColumn":32},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MIDWEST_STATES' is assigned a value but never used.","line":14,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":21}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * AirNav Fuel Price Scraper - Midwest Region\n * Scrapes fuel prices from AirNav.com\n * Smart caching: Large = 72h, Medium = 168h\n */\n\nconst sqlite3 = require('sqlite3').verbose();\nconst https = require('https');\nconst http = require('http');\n\nconst DB_PATH = require('path').join(__dirname, '..', 'data', 'aviation_hub.db');\n\n// Midwest US states\nconst MIDWEST_STATES = ['IL', 'IN', 'MI', 'OH', 'WI', 'MN', 'IA', 'MO', 'KS', 'ND', 'NE', 'SD'];\n\nfunction httpGet(url, retries = 3) {\n  return new Promise((resolve, reject) => {\n    const protocol = url.startsWith('https') ? https : http;\n    const req = protocol.get(url, { headers: { 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36' } }, (res) => {\n      // Handle rate limiting - wait and retry\n      if (res.statusCode === 503 && retries > 0) {\n        setTimeout(() => {\n          httpGet(url, retries - 1).then(resolve).catch(reject);\n        }, 5000);\n        return;\n      }\n      let data = '';\n      res.on('data', chunk => data += chunk);\n      res.on('end', () => resolve({ status: res.statusCode, data }));\n    });\n    req.on('error', reject);\n    req.setTimeout(15000, () => { req.destroy(); reject(new Error('Timeout')); });\n  });\n}\n\nfunction parseAirportData(html) {\n  const results = [];\n  const lines = html.split('\\n');\n  \n  // Data to extract\n  let lastReported = null;\n  let prices = { '100LL': null, 'JetA': null };\n  let hasTower = 0;\n  let attendance = null;\n  let phone = null;\n  let landingFee = null;\n  let manager = null;\n  \n  // Parse all data from HTML\n  const fullHtml = html;\n  \n  // Extract prices\n  for (const line of lines) {\n    const dateMatch = line.match(/Updated\\s+(\\d{1,2}-[A-Z]{3}-\\d{4})/i);\n    if (dateMatch) lastReported = dateMatch[1];\n    \n    const priceMatch = line.match(/\\$([0-9]+\\.?[0-9]*)/g);\n    if (priceMatch) {\n      for (const priceStr of priceMatch) {\n        const price = parseFloat(priceStr.replace('$', ''));\n        if (price > 0 && price < 20) {\n          if (!prices['100LL']) prices['100LL'] = price;\n          else if (!prices['JetA']) prices['JetA'] = price;\n        }\n        // Check for landing fee (usually $XX)\n        if (line.includes('Landing fee') || line.includes('landing fee')) {\n          if (price > 0 && price < 500) {\n            landingFee = price;\n          }\n        }\n      }\n    }\n  }\n  \n  // Extract tower - look for \"Control tower: yes\" or \"Tower: yes\"\n  if (fullHtml.match(/Control tower:\\s*yes/i) || fullHtml.match(/Tower:\\s*yes/i)) {\n    hasTower = 1;\n  }\n  \n  // Extract attendance - \"Attendance:\"\n  const attendanceMatch = fullHtml.match(/Attendance:[^<]*<td[^>]*>([^<]+)<\\/td>/i);\n  if (attendanceMatch) {\n    attendance = attendanceMatch[1].trim();\n  }\n  \n  // Extract phone - look for phone numbers\n  const phoneMatch = fullHtml.match(/(\\d{3}[-.]?\\d{3}[-.]?\\d{4})/);\n  if (phoneMatch) {\n    phone = phoneMatch[1];\n  }\n  \n  // Extract manager - \"Manager:\"\n  const managerMatch = fullHtml.match(/Manager:[^<]*<td[^>]*>([^<]+)<\\/td>/i);\n  if (managerMatch) {\n    manager = managerMatch[1].trim();\n  }\n  \n  // Extract landing fee if found in more specific location\n  const landingMatch = fullHtml.match(/Landing fee:[^<]*<td[^>]*>\\s*([^<$]+)/i);\n  if (landingMatch) {\n    const fee = parseFloat(landingMatch[1].replace(/[$,]/g, ''));\n    if (!isNaN(fee) && fee > 0 && fee < 500) {\n      landingFee = fee;\n    }\n  }\n  \n  if (prices['100LL']) {\n    results.push({ \n      fuel_type: '100LL', \n      price: prices['100LL'], \n      last_reported: lastReported,\n      has_tower: hasTower,\n      attendance: attendance,\n      phone: phone,\n      landing_fee: landingFee,\n      manager: manager\n    });\n  }\n  if (prices['JetA']) {\n    results.push({ \n      fuel_type: 'JetA', \n      price: prices['JetA'], \n      last_reported: lastReported,\n      has_tower: hasTower,\n      attendance: attendance,\n      phone: phone,\n      landing_fee: landingFee,\n      manager: manager\n    });\n  }\n  \n  return results;\n}\n\nasync function scrape() {\n  console.log('=== AirNav Fuel Scraper - Midwest ===\\n');\n  \n  const db = new sqlite3.Database(DB_PATH);\n  \n  // Get all Midwest large airports\n  db.all(\"SELECT icao, name, state FROM airports WHERE type = 'large_airport' AND state LIKE 'US-%' AND substr(state, 4, 2) IN ('IL', 'IN', 'MI', 'OH', 'WI', 'MN', 'IA', 'MO', 'KS', 'ND', 'NE', 'SD') ORDER BY state, name\", [], async (err, largeAirports) => {\n    if (err) { console.error(err); db.close(); return; }\n    \n    console.log(`Found ${largeAirports.length} large airports in Midwest\\n`);\n    \n    let total = 0;\n    \n    for (const airport of largeAirports) {\n      console.log(`[${airport.icao}] ${airport.name} (${airport.state})`);\n      \n      try {\n        const url = `https://www.airnav.com/airport/${airport.icao}`;\n        const response = await httpGet(url);\n        \n        if (response.status === 200) {\n          const prices = parseAirportData(response.data);\n          \n          if (prices.length > 0) {\n            for (const p of prices) {\n              db.run(`INSERT OR REPLACE INTO airport_fuel (icao, fbo_name, fuel_type, service_type, price, guaranteed, last_reported, source_url, scraped_at, has_tower, attendance, phone, landing_fee, manager) VALUES (?, 'Airport Default', ?, 'Full Service', ?, 0, ?, ?, datetime('now'), ?, ?, ?, ?, ?)`,\n                [airport.icao, p.fuel_type, p.price, p.last_reported, url, p.has_tower || 0, p.attendance, p.phone, p.landing_fee, p.manager]);\n              db.run(`INSERT INTO airport_fuel_history (icao, fbo_name, fuel_type, service_type, price, source) VALUES (?, 'Airport Default', ?, 'Full Service', ?, 'airnav')`,\n                [airport.icao, p.fuel_type, p.price]);\n            }\n            console.log(`  âœ“ ${prices.map(p => `$${p.price}`).join(', ')}${prices[0].has_tower ? ' [tower]' : ''}${prices[0].landing_fee ? ' $' : ''}`);\n            total += prices.length;\n          } else {\n            console.log(`  âœ— No prices`);\n          }\n        } else {\n          console.log(`  âœ— HTTP ${response.status}`);\n        }\n      } catch (e) {\n        console.log(`  âœ— ${e.message}`);\n      }\n      \n      await new Promise(r => setTimeout(r, 2500));\n    }\n    \n    // Get medium airports\n    db.all(\"SELECT icao, name, state FROM airports WHERE type = 'medium_airport' AND state LIKE 'US-%' AND substr(state, 4, 2) IN ('IL', 'IN', 'MI', 'OH', 'WI', 'MN', 'IA', 'MO', 'KS', 'ND', 'NE', 'SD') ORDER BY state, name\", async (err, mediumAirports) => {\n      console.log(`\\nFound ${mediumAirports.length} medium airports...\\n`);\n      \n      for (const airport of mediumAirports) {\n        process.stdout.write(`[${airport.icao}] ${airport.name}...`);\n        \n        try {\n          const url = `https://www.airnav.com/airport/${airport.icao}`;\n          const response = await httpGet(url);\n          \n          if (response.status === 200) {\n            const prices = parseAirportData(response.data);\n            \n            if (prices.length > 0) {\n              for (const p of prices) {\n                db.run(`INSERT OR REPLACE INTO airport_fuel (icao, fbo_name, fuel_type, service_type, price, guaranteed, last_reported, source_url, scraped_at, has_tower, attendance, phone, landing_fee, manager) VALUES (?, 'Airport Default', ?, 'Full Service', ?, 0, ?, ?, datetime('now'), ?, ?, ?, ?, ?)`,\n                  [airport.icao, p.fuel_type, p.price, p.last_reported, url, p.has_tower || 0, p.attendance, p.phone, p.landing_fee, p.manager]);\n                db.run(`INSERT INTO airport_fuel_history (icao, fbo_name, fuel_type, service_type, price, source) VALUES (?, 'Airport Default', ?, 'Full Service', ?, 'airnav')`,\n                  [airport.icao, p.fuel_type, p.price]);\n              }\n              console.log(` âœ“ ${prices.map(p => `$${p.price}`).join(', ')}`);\n              total += prices.length;\n            } else {\n              console.log(` âœ—`);\n            }\n          } else {\n            console.log(` âœ— HTTP ${response.status}`);\n          }\n        } catch (e) {\n          console.log(` âœ— ${e.message}`);\n        }\n        \n        await new Promise(r => setTimeout(r, 2000));\n      }\n      \n      console.log(`\\n=== Summary ===`);\n      console.log(`Total prices scraped: ${total}`);\n      \n      db.get(\"SELECT COUNT(DISTINCT icao) as count FROM airport_fuel\", [], (err, row) => {\n        console.log(`Airports with fuel data: ${row.count}`);\n        db.close();\n      });\n    });\n  });\n}\n\nscrape().catch(console.error);\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\scripts\\scrape-west.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":7,"column":17,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":7,"endColumn":35},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":8,"column":15,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":8,"endColumn":31},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":9,"column":14,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":9,"endColumn":29},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":11,"column":17,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":11,"endColumn":32}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * AirNav Fuel Price Scraper - West Region\n * Scrapes fuel prices from AirNav.com\n * West US: AZ, CA, CO, ID, MT, NV, NM, OR, UT, WA, WY\n */\n\nconst sqlite3 = require('sqlite3').verbose();\nconst https = require('https');\nconst http = require('http');\n\nconst DB_PATH = require('path').join(__dirname, '..', 'data', 'aviation_hub.db');\n\n// West US states\nconst WEST_STATES = ['AZ', 'CA', 'CO', 'ID', 'MT', 'NV', 'NM', 'OR', 'UT', 'WA', 'WY', 'AK', 'HI'];\n\nfunction httpGet(url, retries = 3) {\n  return new Promise((resolve, reject) => {\n    const protocol = url.startsWith('https') ? https : http;\n    const req = protocol.get(url, { headers: { 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36' } }, (res) => {\n      // Handle rate limiting - wait and retry\n      if (res.statusCode === 503 && retries > 0) {\n        setTimeout(() => {\n          httpGet(url, retries - 1).then(resolve).catch(reject);\n        }, 5000);\n        return;\n      }\n      let data = '';\n      res.on('data', chunk => data += chunk);\n      res.on('end', () => resolve({ status: res.statusCode, data }));\n    });\n    req.on('error', reject);\n    req.setTimeout(15000, () => { req.destroy(); reject(new Error('Timeout')); });\n  });\n}\n\nfunction parseAirportData(html) {\n  const results = [];\n  const lines = html.split('\\n');\n  \n  let lastReported = null;\n  let prices = { '100LL': null, 'JetA': null };\n  let hasTower = 0;\n  let attendance = null;\n  let phone = null;\n  let landingFee = null;\n  let manager = null;\n  \n  const fullHtml = html;\n  \n  // Extract prices\n  for (const line of lines) {\n    const dateMatch = line.match(/Updated\\s+(\\d{1,2}-[A-Z]{3}-\\d{4})/i);\n    if (dateMatch) lastReported = dateMatch[1];\n    \n    const priceMatch = line.match(/\\$([0-9]+\\.?[0-9]*)/g);\n    if (priceMatch) {\n      for (const priceStr of priceMatch) {\n        const price = parseFloat(priceStr.replace('$', ''));\n        if (price > 0 && price < 20) {\n          if (!prices['100LL']) prices['100LL'] = price;\n          else if (!prices['JetA']) prices['JetA'] = price;\n        }\n        if (line.includes('Landing fee') || line.includes('landing fee')) {\n          if (price > 0 && price < 500) {\n            landingFee = price;\n          }\n        }\n      }\n    }\n  }\n  \n  // Extract tower\n  if (fullHtml.match(/Control tower:\\s*yes/i) || fullHtml.match(/Tower:\\s*yes/i)) {\n    hasTower = 1;\n  }\n  \n  // Extract attendance\n  const attendanceMatch = fullHtml.match(/Attendance:[^<]*<td[^>]*>([^<]+)<\\/td>/i);\n  if (attendanceMatch) {\n    attendance = attendanceMatch[1].trim();\n  }\n  \n  // Extract phone\n  const phoneMatch = fullHtml.match(/(\\d{3}[-.]?\\d{3}[-.]?\\d{4})/);\n  if (phoneMatch) {\n    phone = phoneMatch[1];\n  }\n  \n  // Extract manager\n  const managerMatch = fullHtml.match(/Manager:[^<]*<td[^>]*>([^<]+)<\\/td>/i);\n  if (managerMatch) {\n    manager = managerMatch[1].trim();\n  }\n  \n  // Extract landing fee\n  const landingMatch = fullHtml.match(/Landing fee:[^<]*<td[^>]*>\\s*([^<$]+)/i);\n  if (landingMatch) {\n    const fee = parseFloat(landingMatch[1].replace(/[$,]/g, ''));\n    if (!isNaN(fee) && fee > 0 && fee < 500) {\n      landingFee = fee;\n    }\n  }\n  \n  if (prices['100LL']) {\n    results.push({ \n      fuel_type: '100LL', \n      price: prices['100LL'], \n      last_reported: lastReported,\n      has_tower: hasTower,\n      attendance: attendance,\n      phone: phone,\n      landing_fee: landingFee,\n      manager: manager\n    });\n  }\n  if (prices['JetA']) {\n    results.push({ \n      fuel_type: 'JetA', \n      price: prices['JetA'], \n      last_reported: lastReported,\n      has_tower: hasTower,\n      attendance: attendance,\n      phone: phone,\n      landing_fee: landingFee,\n      manager: manager\n    });\n  }\n  \n  return results;\n}\n\nasync function scrape() {\n  console.log('=== AirNav Fuel Scraper - West Region ===\\n');\n  \n  const db = new sqlite3.Database(DB_PATH);\n  \n  // Get all West large airports\n  db.all(`SELECT icao, name, state FROM airports WHERE type = 'large_airport' AND state LIKE 'US-%' AND substr(state, 4, 2) IN (${WEST_STATES.map(s => `'${s}'`).join(',')}) ORDER BY state, name`, [], async (err, largeAirports) => {\n    if (err) { console.error(err); db.close(); return; }\n    \n    console.log(`Found ${largeAirports.length} large airports in West region\\n`);\n    \n    let total = 0;\n    \n    for (const airport of largeAirports) {\n      console.log(`[${airport.icao}] ${airport.name} (${airport.state})`);\n      \n      try {\n        const url = `https://www.airnav.com/airport/${airport.icao}`;\n        const response = await httpGet(url);\n        \n        if (response.status === 200) {\n          const prices = parseAirportData(response.data);\n          \n          if (prices.length > 0) {\n            for (const p of prices) {\n              db.run(`INSERT OR REPLACE INTO airport_fuel (icao, fbo_name, fuel_type, service_type, price, guaranteed, last_reported, source_url, scraped_at, has_tower, attendance, phone, landing_fee, manager) VALUES (?, 'Airport Default', ?, 'Full Service', ?, 0, ?, ?, datetime('now'), ?, ?, ?, ?, ?)`,\n                [airport.icao, p.fuel_type, p.price, p.last_reported, url, p.has_tower || 0, p.attendance, p.phone, p.landing_fee, p.manager]);\n              db.run(`INSERT INTO airport_fuel_history (icao, fbo_name, fuel_type, service_type, price, source) VALUES (?, 'Airport Default', ?, 'Full Service', ?, 'airnav')`,\n                [airport.icao, p.fuel_type, p.price]);\n            }\n            console.log(`  âœ“ ${prices.map(p => `$${p.price}`).join(', ')}${prices[0].has_tower ? ' [tower]' : ''}${prices[0].landing_fee ? ' $' : ''}`);\n            total += prices.length;\n          } else {\n            console.log(`  âœ— No prices`);\n          }\n        } else {\n          console.log(`  âœ— HTTP ${response.status}`);\n        }\n      } catch (e) {\n        console.log(`  âœ— ${e.message}`);\n      }\n      \n      await new Promise(r => setTimeout(r, 2500));\n    }\n    \n    // Get medium airports\n    db.all(`SELECT icao, name, state FROM airports WHERE type = 'medium_airport' AND state LIKE 'US-%' AND substr(state, 4, 2) IN (${WEST_STATES.map(s => `'${s}'`).join(',')}) ORDER BY state, name`, async (err, mediumAirports) => {\n      console.log(`\\nFound ${mediumAirports.length} medium airports...\\n`);\n      \n      for (const airport of mediumAirports) {\n        process.stdout.write(`[${airport.icao}] ${airport.name}...`);\n        \n        try {\n          const url = `https://www.airnav.com/airport/${airport.icao}`;\n          const response = await httpGet(url);\n          \n          if (response.status === 200) {\n            const prices = parseAirportData(response.data);\n            \n            if (prices.length > 0) {\n              for (const p of prices) {\n                db.run(`INSERT OR REPLACE INTO airport_fuel (icao, fbo_name, fuel_type, service_type, price, guaranteed, last_reported, source_url, scraped_at, has_tower, attendance, phone, landing_fee, manager) VALUES (?, 'Airport Default', ?, 'Full Service', ?, 0, ?, ?, datetime('now'), ?, ?, ?, ?, ?)`,\n                  [airport.icao, p.fuel_type, p.price, p.last_reported, url, p.has_tower || 0, p.attendance, p.phone, p.landing_fee, p.manager]);\n                db.run(`INSERT INTO airport_fuel_history (icao, fbo_name, fuel_type, service_type, price, source) VALUES (?, 'Airport Default', ?, 'Full Service', ?, 'airnav')`,\n                  [airport.icao, p.fuel_type, p.price]);\n              }\n              console.log(` âœ“ ${prices.map(p => `$${p.price}`).join(', ')}`);\n              total += prices.length;\n            } else {\n              console.log(` âœ—`);\n            }\n          } else {\n            console.log(` âœ— HTTP ${response.status}`);\n          }\n        } catch (e) {\n          console.log(` âœ— ${e.message}`);\n        }\n        \n        await new Promise(r => setTimeout(r, 2000));\n      }\n      \n      console.log(`\\n=== Summary ===`);\n      console.log(`Total prices scraped: ${total}`);\n      \n      db.get(\"SELECT COUNT(DISTINCT icao) as count FROM airport_fuel\", [], (err, row) => {\n        console.log(`Airports with fuel data: ${row.count}`);\n        db.close();\n      });\n    });\n  });\n}\n\nscrape().catch(console.error);\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\scripts\\seed-aircraft-wb.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":9,"column":17,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":9,"endColumn":35},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":10,"column":14,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":10,"endColumn":29}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Seed 50 most common GA aircraft with Weight & Balance data\n * Run: node scripts/seed-aircraft-wb.js\n * \n * âš ï¸ DISCLAIMER: These are TYPICAL VALUES from POH data.\n * Always verify with actual aircraft documents before flight.\n */\n\nconst sqlite3 = require('sqlite3').verbose();\nconst path = require('path');\n\nconst DB_PATH = path.join(__dirname, '..', 'data', 'aviation_hub.db');\nconst db = new sqlite3.Database(DB_PATH);\n\n// 50 Aircraft with typical W&B values\n// All values are TYPICAL - verify with actual aircraft POH\nconst aircraftData = [\n  // Cessna Singles\n  { make: 'Cessna', model: '172S', empty_weight: 1685, empty_cg: 39.0, max_weight: 2550, arm_pilot: 80.5, arm_passenger: 118.1, arm_baggage: 142.8, arm_fuel: 48, fuel_capacity: 56, cruise_speed: 124, fuel_burn: 8.5, unusable_fuel: 2, notes: 'Typical values - verify with POH' },\n  { make: 'Cessna', model: '172R', empty_weight: 1610, empty_cg: 39.0, max_weight: 2550, arm_pilot: 80.5, arm_passenger: 118.1, arm_baggage: 142.8, arm_fuel: 48, fuel_capacity: 56, cruise_speed: 122, fuel_burn: 8.3, unusable_fuel: 2, notes: 'Typical values - verify with POH' },\n  { make: 'Cessna', model: '172N', empty_weight: 1550, empty_cg: 39.0, max_weight: 2550, arm_pilot: 80.5, arm_passenger: 118.1, arm_baggage: 142.8, arm_fuel: 95, fuel_capacity: 42, cruise_speed: 115, fuel_burn: 8.5, unusable_fuel: 2, notes: 'Typical values - verify with POH' },\n  { make: 'Cessna', model: '172M', empty_weight: 1500, empty_cg: 39.0, max_weight: 2550, arm_pilot: 80.5, arm_passenger: 118.1, arm_baggage: 142.8, arm_fuel: 95, fuel_capacity: 42, cruise_speed: 110, fuel_burn: 8.0, unusable_fuel: 2, notes: 'Typical values - verify with POH' },\n  { make: 'Cessna', model: '152', empty_weight: 1150, empty_cg: 39.0, max_weight: 1670, arm_pilot: 80.5, arm_passenger: 118.0, arm_baggage: 142.8, arm_fuel: 90, fuel_capacity: 26, cruise_speed: 105, fuel_burn: 7.0, unusable_fuel: 1, notes: 'Typical values - verify with POH' },\n  { make: 'Cessna', model: '150M', empty_weight: 1085, empty_cg: 39.0, max_weight: 1650, arm_pilot: 80.5, arm_passenger: 118.0, arm_baggage: 142.8, arm_fuel: 90, fuel_capacity: 26, cruise_speed: 100, fuel_burn: 6.5, unusable_fuel: 1, notes: 'Typical values - verify with POH' },\n  { make: 'Cessna', model: '182T', empty_weight: 1710, empty_cg: 39.0, max_weight: 3100, arm_pilot: 80.5, arm_passenger: 118.1, arm_baggage: 142.8, arm_fuel: 48, fuel_capacity: 87, cruise_speed: 150, fuel_burn: 12.5, unusable_fuel: 3, notes: 'Typical values - verify with POH' },\n  { make: 'Cessna', model: '182S', empty_weight: 1695, empty_cg: 39.0, max_weight: 3100, arm_pilot: 80.5, arm_passenger: 118.1, arm_baggage: 142.8, arm_fuel: 48, fuel_capacity: 87, cruise_speed: 150, fuel_burn: 12.5, unusable_fuel: 3, notes: 'Typical values - verify with POH' },\n  { make: 'Cessna', model: '182Q', empty_weight: 1750, empty_cg: 39.0, max_weight: 3100, arm_pilot: 80.5, arm_passenger: 118.1, arm_baggage: 142.8, arm_fuel: 48, fuel_capacity: 87, cruise_speed: 150, fuel_burn: 12.5, unusable_fuel: 3, notes: 'Typical values - verify with POH' },\n  { make: 'Cessna', model: '206H', empty_weight: 2350, empty_cg: 39.0, max_weight: 3600, arm_pilot: 80.5, arm_passenger: 118.1, arm_baggage: 142.8, arm_fuel: 48, fuel_capacity: 92, cruise_speed: 160, fuel_burn: 14.0, unusable_fuel: 3, notes: 'Typical values - verify with POH' },\n  { make: 'Cessna', model: '180H', empty_weight: 2200, empty_cg: 37.0, max_weight: 2650, arm_pilot: 78.0, arm_passenger: 110.0, arm_baggage: 140.0, arm_fuel: 90, fuel_capacity: 60, cruise_speed: 140, fuel_burn: 12.0, unusable_fuel: 2, notes: 'Typical values - verify with POH' },\n  { make: 'Cessna', model: '185E', empty_weight: 2250, empty_cg: 37.0, max_weight: 3200, arm_pilot: 78.0, arm_passenger: 110.0, arm_baggage: 140.0, arm_fuel: 90, fuel_capacity: 65, cruise_speed: 155, fuel_burn: 14.0, unusable_fuel: 2, notes: 'Typical values - verify with POH' },\n  { make: 'Cessna', model: '208 Caravan', empty_weight: 4600, empty_cg: 40.0, max_weight: 8800, arm_pilot: 80.0, arm_passenger: 110.0, arm_baggage: 140.0, arm_fuel: 120, fuel_capacity: 192, cruise_speed: 190, fuel_burn: 25.0, unusable_fuel: 5, notes: 'Typical values - verify with POH' },\n  \n  // Piper Cherokee Series\n  { make: 'Piper', model: 'PA-28-181 Archer', empty_weight: 1572, empty_cg: 86.48, max_weight: 2550, arm_pilot: 80.5, arm_passenger: 118.1, arm_baggage: 142.8, arm_fuel: 95, fuel_capacity: 48, cruise_speed: 120, fuel_burn: 8.5, unusable_fuel: 2, notes: 'Typical values - verify with POH' },\n  { make: 'Piper', model: 'PA-28-161 Warrior III', empty_weight: 1540, empty_cg: 86.0, max_weight: 2440, arm_pilot: 80.5, arm_passenger: 118.1, arm_baggage: 142.8, arm_fuel: 95, fuel_capacity: 48, cruise_speed: 116, fuel_burn: 8.0, unusable_fuel: 2, notes: 'Typical values - verify with POH' },\n  { make: 'Piper', model: 'PA-28-140 Cherokee', empty_weight: 1275, empty_cg: 85.0, max_weight: 2150, arm_pilot: 80.5, arm_passenger: 118.1, arm_baggage: 142.8, arm_fuel: 95, fuel_capacity: 42, cruise_speed: 108, fuel_burn: 7.5, unusable_fuel: 2, notes: 'Typical values - verify with POH' },\n  { make: 'Piper', model: 'PA-28-151 Warrior', empty_weight: 1480, empty_cg: 86.0, max_weight: 2325, arm_pilot: 80.5, arm_passenger: 118.1, arm_baggage: 142.8, arm_fuel: 95, fuel_capacity: 44, cruise_speed: 115, fuel_burn: 8.0, unusable_fuel: 2, notes: 'Typical values - verify with POH' },\n  { make: 'Piper', model: 'PA-28R-201 Arrow', empty_weight: 1620, empty_cg: 86.0, max_weight: 2750, arm_pilot: 80.5, arm_passenger: 118.1, arm_baggage: 142.8, arm_fuel: 95, fuel_capacity: 72, cruise_speed: 130, fuel_burn: 10.0, unusable_fuel: 2, notes: 'Typical values - verify with POH' },\n  { make: 'Piper', model: 'PA-28R-180 Cherokee Arrow', empty_weight: 1580, empty_cg: 86.0, max_weight: 2550, arm_pilot: 80.5, arm_passenger: 118.1, arm_baggage: 142.8, arm_fuel: 95, fuel_capacity: 56, cruise_speed: 125, fuel_burn: 9.5, unusable_fuel: 2, notes: 'Typical values - verify with POH' },\n  { make: 'Piper', model: 'PA-32R-301 Saratoga', empty_weight: 2050, empty_cg: 88.0, max_weight: 3600, arm_pilot: 80.5, arm_passenger: 118.1, arm_baggage: 142.8, arm_fuel: 95, fuel_capacity: 102, cruise_speed: 140, fuel_burn: 14.0, unusable_fuel: 3, notes: 'Typical values - verify with POH' },\n  { make: 'Piper', model: 'PA-32-301T Turbo Saratoga', empty_weight: 2150, empty_cg: 88.0, max_weight: 3700, arm_pilot: 80.5, arm_passenger: 118.1, arm_baggage: 142.8, arm_fuel: 95, fuel_capacity: 102, cruise_speed: 155, fuel_burn: 15.0, unusable_fuel: 3, notes: 'Typical values - verify with POH' },\n  { make: 'Piper', model: 'PA-34-200 Seneca', empty_weight: 3420, empty_cg: 83.0, max_weight: 4570, arm_pilot: 80.3, arm_passenger: 118.0, arm_baggage: 142.0, arm_fuel: 196, fuel_capacity: 102, cruise_speed: 160, fuel_burn: 14.0, unusable_fuel: 3, notes: 'Twin - Typical values - verify with POH' },\n  { make: 'Piper', model: 'PA-46-350P Malibu', empty_weight: 3200, empty_cg: 84.0, max_weight: 4200, arm_pilot: 84.0, arm_passenger: 118.0, arm_baggage: 143.0, arm_fuel: 118, fuel_capacity: 96, cruise_speed: 210, fuel_burn: 18.0, unusable_fuel: 4, notes: 'Typical values - verify with POH' },\n  { make: 'Piper', model: 'PA-23-250 Aztec', empty_weight: 3100, empty_cg: 85.0, max_weight: 5200, arm_pilot: 85.0, arm_passenger: 120.0, arm_baggage: 143.0, arm_fuel: 140, fuel_capacity: 100, cruise_speed: 180, fuel_burn: 20.0, unusable_fuel: 3, notes: 'Twin - Typical values - verify with POH' },\n  \n  // Diamond\n  { make: 'Diamond', model: 'DA40 Star', empty_weight: 1650, empty_cg: 93.0, max_weight: 2530, arm_pilot: 83.0, arm_passenger: 118.0, arm_baggage: 143.0, arm_fuel: 95, fuel_capacity: 34, cruise_speed: 140, fuel_burn: 9.0, unusable_fuel: 1, notes: 'Typical values - verify with POH' },\n  { make: 'Diamond', model: 'DA42 Twin Star', empty_weight: 3600, empty_cg: 94.0, max_weight: 4235, arm_pilot: 83.0, arm_passenger: 118.0, arm_baggage: 143.0, arm_fuel: 95, fuel_capacity: 108, cruise_speed: 155, fuel_burn: 12.0, unusable_fuel: 2, notes: 'Twin - Typical values - verify with POH' },\n  { make: 'Diamond', model: 'DA50 RG', empty_weight: 3300, empty_cg: 94.0, max_weight: 4400, arm_pilot: 83.0, arm_passenger: 118.0, arm_baggage: 143.0, arm_fuel: 95, fuel_capacity: 92, cruise_speed: 165, fuel_burn: 14.0, unusable_fuel: 2, notes: 'Typical values - verify with POH' },\n  \n  // Cirrus\n  { make: 'Cirrus', model: 'SR20', empty_weight: 2400, empty_cg: 83.0, max_weight: 3050, arm_pilot: 82.0, arm_passenger: 118.0, arm_baggage: 143.0, arm_fuel: 95, fuel_capacity: 56, cruise_speed: 155, fuel_burn: 10.0, unusable_fuel: 2, notes: 'Typical values - verify with POH' },\n  { make: 'Cirrus', model: 'SR22', empty_weight: 2350, empty_cg: 83.0, max_weight: 3400, arm_pilot: 82.0, arm_passenger: 118.0, arm_baggage: 143.0, arm_fuel: 95, fuel_capacity: 92, cruise_speed: 180, fuel_burn: 12.0, unusable_fuel: 2, notes: 'Typical values - verify with POH' },\n  { make: 'Cirrus', model: 'SR22T', empty_weight: 2450, empty_cg: 83.0, max_weight: 3400, arm_pilot: 82.0, arm_passenger: 118.0, arm_baggage: 143.0, arm_fuel: 95, fuel_capacity: 92, cruise_speed: 185, fuel_burn: 14.0, unusable_fuel: 2, notes: 'Typical values - verify with POH' },\n  \n  // Mooney\n  { make: 'Mooney', model: 'M20J 231', empty_weight: 2240, empty_cg: 84.0, max_weight: 3075, arm_pilot: 80.0, arm_passenger: 122.0, arm_baggage: 143.0, arm_fuel: 118, fuel_capacity: 72, cruise_speed: 175, fuel_burn: 12.0, unusable_fuel: 2, notes: 'Typical values - verify with POH' },\n  { make: 'Mooney', model: 'M20K 252', empty_weight: 2320, empty_cg: 84.0, max_weight: 3185, arm_pilot: 80.0, arm_passenger: 122.0, arm_baggage: 143.0, arm_fuel: 118, fuel_capacity: 87, cruise_speed: 185, fuel_burn: 14.0, unusable_fuel: 2, notes: 'Typical values - verify with POH' },\n  { make: 'Mooney', model: 'M20R Ovation', empty_weight: 2450, empty_cg: 84.0, max_weight: 3200, arm_pilot: 80.0, arm_passenger: 122.0, arm_baggage: 143.0, arm_fuel: 118, fuel_capacity: 92, cruise_speed: 190, fuel_burn: 15.0, unusable_fuel: 2, notes: 'Typical values - verify with POH' },\n  \n  // Beechcraft\n  { make: 'Beechcraft', model: 'Bonanza A36', empty_weight: 3350, empty_cg: 82.0, max_weight: 3650, arm_pilot: 80.5, arm_passenger: 122.8, arm_baggage: 142.5, arm_fuel: 142, fuel_capacity: 102, cruise_speed: 155, fuel_burn: 14.0, unusable_fuel: 3, notes: 'Typical values - verify with POH' },\n  { make: 'Beechcraft', model: 'Bonanza V35', empty_weight: 2950, empty_cg: 82.0, max_weight: 3400, arm_pilot: 80.5, arm_passenger: 122.8, arm_baggage: 142.5, arm_fuel: 130, fuel_capacity: 84, cruise_speed: 150, fuel_burn: 13.0, unusable_fuel: 2, notes: 'Typical values - verify with POH' },\n  { make: 'Beechcraft', model: 'King Air B200', empty_weight: 6800, empty_cg: 86.0, max_weight: 12500, arm_pilot: 84.0, arm_passenger: 118.0, arm_baggage: 150.0, arm_fuel: 200, fuel_capacity: 192, cruise_speed: 270, fuel_burn: 40.0, unusable_fuel: 5, notes: 'Twin - Typical values - verify with POH' },\n  { make: 'Beechcraft', model: 'Skipper E33', empty_weight: 1750, empty_cg: 78.0, max_weight: 2550, arm_pilot: 78.0, arm_passenger: 110.0, arm_baggage: 140.0, arm_fuel: 95, fuel_capacity: 50, cruise_speed: 120, fuel_burn: 9.0, unusable_fuel: 2, notes: 'Typical values - verify with POH' },\n  \n  // Grumman\n  { make: 'Grumman', model: 'AA-5 Traveler', empty_weight: 1350, empty_cg: 75.0, max_weight: 2100, arm_pilot: 80.0, arm_passenger: 115.0, arm_baggage: 140.0, arm_fuel: 75, fuel_capacity: 36, cruise_speed: 110, fuel_burn: 8.0, unusable_fuel: 1, notes: 'Typical values - verify with POH' },\n  { make: 'Grumman', model: 'AA-5B Cheetah', empty_weight: 1400, empty_cg: 75.0, max_weight: 2150, arm_pilot: 80.0, arm_passenger: 115.0, arm_baggage: 140.0, arm_fuel: 75, fuel_capacity: 38, cruise_speed: 115, fuel_burn: 8.5, unusable_fuel: 1, notes: 'Typical values - verify with POH' },\n  { make: 'Grumman', model: 'AG-5B Tiger', empty_weight: 1480, empty_cg: 75.0, max_weight: 2250, arm_pilot: 80.0, arm_passenger: 115.0, arm_baggage: 140.0, arm_fuel: 75, fuel_capacity: 42, cruise_speed: 120, fuel_burn: 9.0, unusable_fuel: 1, notes: 'Typical values - verify with POH' },\n  \n  // Socata\n  { make: 'Socata', model: 'TB-9 Tampico', empty_weight: 1550, empty_cg: 85.0, max_weight: 2100, arm_pilot: 80.0, arm_passenger: 115.0, arm_baggage: 140.0, arm_fuel: 95, fuel_capacity: 36, cruise_speed: 115, fuel_burn: 8.5, unusable_fuel: 1, notes: 'Typical values - verify with POH' },\n  { make: 'Socata', model: 'TB-10 Tobago', empty_weight: 1650, empty_cg: 85.0, max_weight: 2200, arm_pilot: 80.0, arm_passenger: 115.0, arm_baggage: 140.0, arm_fuel: 95, fuel_capacity: 36, cruise_speed: 120, fuel_burn: 9.0, unusable_fuel: 1, notes: 'Typical values - verify with POH' },\n  { make: 'Socata', model: 'TB-21 Trinidad TC', empty_weight: 1950, empty_cg: 85.0, max_weight: 2700, arm_pilot: 80.0, arm_passenger: 115.0, arm_baggage: 140.0, arm_fuel: 95, fuel_capacity: 50, cruise_speed: 145, fuel_burn: 12.0, unusable_fuel: 2, notes: 'Typical values - verify with POH' },\n  \n  // Light Sport / Vintage\n  { make: 'Aeronca', model: '7EC Champ', empty_weight: 1200, empty_cg: 68.0, max_weight: 1450, arm_pilot: 72.0, arm_passenger: 101.0, arm_baggage: 120.0, arm_fuel: 75, fuel_capacity: 26, cruise_speed: 85, fuel_burn: 5.0, unusable_fuel: 1, notes: 'Vintage - Typical values - verify with POH' },\n  { make: 'Aeronca', model: '7GCBC Citabria', empty_weight: 1250, empty_cg: 68.0, max_weight: 1500, arm_pilot: 72.0, arm_passenger: 101.0, arm_baggage: 120.0, arm_fuel: 75, fuel_capacity: 26, cruise_speed: 85, fuel_burn: 5.0, unusable_fuel: 1, notes: 'Vintage - Typical values - verify with POH' },\n  { make: 'Luscombe', model: '8E Silvaire', empty_weight: 1080, empty_cg: 65.0, max_weight: 1400, arm_pilot: 72.0, arm_passenger: 101.0, arm_baggage: 120.0, arm_fuel: 75, fuel_capacity: 24, cruise_speed: 80, fuel_burn: 4.5, unusable_fuel: 1, notes: 'Vintage - Typical values - verify with POH' },\n  { make: 'Taylorcraft', model: 'BC-12D', empty_weight: 930, empty_cg: 62.0, max_weight: 1250, arm_pilot: 68.0, arm_passenger: 96.0, arm_baggage: 115.0, arm_fuel: 75, fuel_capacity: 18, cruise_speed: 75, fuel_burn: 4.0, unusable_fuel: 1, notes: 'Vintage - Typical values - verify with POH' },\n  { make: 'AmeriGL', model: 'Ercoupe', empty_weight: 680, empty_cg: 68.0, max_weight: 1100, arm_pilot: 72.0, arm_passenger: 95.0, arm_baggage: 115.0, arm_fuel: 75, fuel_capacity: 18, cruise_speed: 75, fuel_burn: 4.5, unusable_fuel: 1, notes: 'Vintage - Typical values - verify with POH' },\n  { make: 'Maule', model: 'M-7-235', empty_weight: 1500, empty_cg: 75.0, max_weight: 2200, arm_pilot: 80.0, arm_passenger: 110.0, arm_baggage: 140.0, arm_fuel: 95, fuel_capacity: 42, cruise_speed: 115, fuel_burn: 10.0, unusable_fuel: 2, notes: 'STOL - Typical values - verify with POH' },\n  { make: 'Globe', model: 'GC-1B Swift', empty_weight: 1080, empty_cg: 70.0, max_weight: 1650, arm_pilot: 75.0, arm_passenger: 100.0, arm_baggage: 120.0, arm_fuel: 85, fuel_capacity: 24, cruise_speed: 85, fuel_burn: 6.0, unusable_fuel: 1, notes: 'Vintage - Typical values - verify with POH' },\n  \n  // DeHavilland\n  { make: 'DeHavilland', model: 'DHC-2 Beaver', empty_weight: 3100, empty_cg: 90.0, max_weight: 5100, arm_pilot: 90.0, arm_passenger: 130.0, arm_baggage: 150.0, arm_fuel: 120, fuel_capacity: 90, cruise_speed: 140, fuel_burn: 18.0, unusable_fuel: 3, notes: 'Floatplane - Typical values - verify with POH' },\n  { make: 'DeHavilland', model: 'DHC-3 Otter', empty_weight: 4200, empty_cg: 95.0, max_weight: 8000, arm_pilot: 95.0, arm_passenger: 135.0, arm_baggage: 155.0, arm_fuel: 120, fuel_capacity: 110, cruise_speed: 150, fuel_burn: 22.0, unusable_fuel: 4, notes: 'Floatplane - Typical values - verify with POH' },\n  \n  // Helio\n  { make: 'Helio', model: 'H-295 Super Courier', empty_weight: 1800, empty_cg: 78.0, max_weight: 3000, arm_pilot: 82.0, arm_passenger: 110.0, arm_baggage: 140.0, arm_fuel: 100, fuel_capacity: 60, cruise_speed: 150, fuel_burn: 12.0, unusable_fuel: 2, notes: 'STOL - Typical values - verify with POH' },\n];\n\nconsole.log('Seeding 50 aircraft W&B data...\\n');\nconsole.log('âš ï¸  DISCLAIMER: These are TYPICAL VALUES from POH data.');\nconsole.log('    Always verify with actual aircraft documents before flight.\\n');\n\nconst stmt = db.prepare(`\n  INSERT OR REPLACE INTO weight_balance (\n    id, make, model, empty_weight, empty_cg, max_weight, \n    arm_pilot, arm_passenger, arm_baggage, arm_fuel, \n    fuel_capacity, cruise_speed, fuel_burn, unusable_fuel, \n    is_verified, notes, created_at\n  ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, 0, ?, datetime('now'))\n`);\n\nlet count = 0;\naircraftData.forEach((ac, index) => {\n  const id = `${ac.make.toLowerCase()}-${ac.model.toLowerCase().replace(/[^a-z0-9]/g, '')}-${index}`;\n  stmt.run(\n    id,\n    ac.make,\n    ac.model,\n    ac.empty_weight,\n    ac.empty_cg,\n    ac.max_weight,\n    ac.arm_pilot,\n    ac.arm_passenger,\n    ac.arm_baggage,\n    ac.arm_fuel,\n    ac.fuel_capacity,\n    ac.cruise_speed,\n    ac.fuel_burn,\n    ac.unusable_fuel,\n    ac.notes\n  );\n  count++;\n  console.log(`âœ“ ${ac.make} ${ac.model}`);\n});\n\nstmt.finalize();\n\ndb.get(\"SELECT COUNT(*) as count FROM weight_balance\", [], (err, row) => {\n  console.log(`\\nâœ… Seeded ${count} aircraft successfully!`);\n  console.log(`Total aircraft in database: ${row.count}`);\n  db.close();\n});\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\scripts\\seed-demo.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":86,"column":106,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":109,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4590,4593],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4590,4593],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * AviationHub MVP Demo Data Seed Script\n * \n * Run with: npx tsx scripts/seed-demo.ts\n * \n * Creates:\n * - 2 Flying Clubs\n * - 5 Aircraft\n * - 10 Members (mix of roles)\n * - 20 Bookings (past + future)\n * - 30 Flight Logs\n * - 2 Past Billing Runs\n */\n\nimport { PrismaClient } from '@prisma/client';\n\nconst prisma = new PrismaClient();\n\nasync function main() {\n  console.log('Starting demo data seed...');\n\n  // Clean up existing data (optional - comment out to preserve existing data)\n  console.log('Cleaning up existing data...');\n  await prisma.$executeRaw`DELETE FROM InvoiceItem`;\n  await prisma.$executeRaw`DELETE FROM Invoice`;\n  await prisma.$executeRaw`DELETE FROM BillingRun`;\n  await prisma.$executeRaw`DELETE FROM FlightLog`;\n  await prisma.$executeRaw`DELETE FROM Booking`;\n  await prisma.$executeRaw`DELETE FROM BlockOut`;\n  await prisma.$executeRaw`DELETE FROM GroupMember`;\n  await prisma.$executeRaw`DELETE FROM ClubAircraft`;\n  await prisma.$executeRaw`DELETE FROM FlyingGroup`;\n\n  // Create Flying Groups (Clubs)\n  console.log('Creating clubs...');\n  \n  const club1Id = '11111111-1111-1111-1111-111111111111';\n  const club2Id = '22222222-2222-2222-2222-222222222222';\n\n  await prisma.$executeRawUnsafe(`\n    INSERT INTO FlyingGroup (id, name, description, ownerId, createdAt)\n    VALUES ('${club1Id}', 'Sky High Flying Club', 'A welcoming club for pilots of all experience levels', '00000000-0000-0000-0000-000000000001', GETDATE())\n  `);\n\n  await prisma.$executeRawUnsafe(`\n    INSERT INTO FlyingGroup (id, name, description, ownerId, createdAt)\n    VALUES ('${club2Id}', 'Weekend Warriors', 'Casual flying group for weekend adventures', '00000000-0000-0000-0000-000000000002', GETDATE())\n  `);\n\n  // Create Aircraft\n  console.log('Creating aircraft...');\n  \n  const aircraft = [\n    { id: 'aaaa1111-1111-1111-1111-111111111111', clubId: club1Id, nNumber: 'N172SP', nickname: 'Skyhawk', make: 'Cessna', model: '172S', year: 2020, hourlyRate: 165, totalHobbs: 1250.5 },\n    { id: 'aaaa2222-2222-2222-2222-222222222222', clubId: club1Id, nNumber: 'N9876P', nickname: 'Warrior', make: 'Piper', model: 'PA-28-161', year: 2019, hourlyRate: 145, totalHobbs: 2100.3 },\n    { id: 'aaaa3333-3333-3333-3333-333333333333', clubId: club1Id, nNumber: 'N345AB', nickname: 'Archer', make: 'Piper', model: 'PA-28-181', year: 2021, hourlyRate: 175, totalHobbs: 850.2 },\n    { id: 'aaaa4444-4444-4444-4444-444444444444', clubId: club2Id, nNumber: 'N5678C', nickname: 'Cherokee', make: 'Piper', model: 'PA-32-300', year: 2018, hourlyRate: 135, totalHobbs: 3200.1 },\n    { id: 'aaaa5555-5555-5555-5555-555555555555', clubId: club2Id, nNumber: 'N9999X', nickname: 'Skylane', make: 'Cessna', model: '182S', year: 2022, hourlyRate: 195, totalHobbs: 450.0 },\n  ];\n\n  for (const a of aircraft) {\n    await prisma.$executeRawUnsafe(`\n      INSERT INTO ClubAircraft (id, groupId, nNumber, nickname, make, model, year, hourlyRate, totalHobbsHours, status, bookingWindowDays, createdAt)\n      VALUES ('${a.id}', '${a.clubId}', '${a.nNumber}', '${a.nickname}', '${a.make}', '${a.model}', ${a.year}, ${a.hourlyRate}, ${a.totalHobbs}, 'Available', 30, GETDATE())\n    `);\n  }\n\n  // Create Users (skip if already exists)\n  console.log('Creating users...');\n  \n  const users = [\n    { id: '00000000-0000-0000-0000-000000000001', email: 'admin@skyhigh.com', name: 'John Smith', role: 'ADMIN' },\n    { id: '00000000-0000-0000-0000-000000000002', email: 'pilot@skyhigh.com', name: 'Jane Doe', role: 'MEMBER' },\n    { id: '00000000-0000-0000-0000-000000000003', email: 'cfi@skyhigh.com', name: 'Mike Wilson', role: 'CFI' },\n    { id: '00000000-0000-0000-0000-000000000004', email: 'pilot2@skyhigh.com', name: 'Sarah Johnson', role: 'MEMBER' },\n    { id: '00000000-0000-0000-0000-000000000005', email: 'pilot3@skyhigh.com', name: 'Tom Brown', role: 'MEMBER' },\n    { id: '00000000-0000-0000-0000-000000000006', email: 'admin@weekend.com', name: 'Alice Cooper', role: 'ADMIN' },\n    { id: '00000000-0000-0000-0000-000000000007', email: 'pilot@weekend.com', name: 'Bob Miller', role: 'MEMBER' },\n    { id: '00000000-0000-0000-0000-000000000008', email: 'cfi@weekend.com', name: 'Carol Davis', role: 'CFI' },\n    { id: '00000000-0000-0000-0000-000000000009', email: 'pilot4@weekend.com', name: 'David Lee', role: 'MEMBER' },\n    { id: '00000000-0000-0000-0000-000000000010', email: 'pilot5@weekend.com', name: 'Emma Taylor', role: 'MEMBER' },\n  ];\n\n  for (const u of users) {\n    // Check if user exists\n    const existing = await prisma.$queryRawUnsafe(`SELECT id FROM [User] WHERE email = '${u.email}'`) as any[];\n    if (existing.length === 0) {\n      await prisma.$executeRawUnsafe(`\n        INSERT INTO [User] (id, email, name, username, createdAt)\n        VALUES ('${u.id}', '${u.email}', '${u.name}', '${u.email.split('@')[0]}', GETDATE())\n      `);\n    }\n  }\n\n  // Create Group Members\n  console.log('Creating memberships...');\n  \n  const memberships = [\n    { userId: '00000000-0000-0000-0000-000000000001', groupId: club1Id, role: 'ADMIN' },\n    { userId: '00000000-0000-0000-0000-000000000002', groupId: club1Id, role: 'MEMBER' },\n    { userId: '00000000-0000-0000-0000-000000000003', groupId: club1Id, role: 'CFI' },\n    { userId: '00000000-0000-0000-0000-000000000004', groupId: club1Id, role: 'MEMBER' },\n    { userId: '00000000-0000-0000-0000-000000000005', groupId: club1Id, role: 'MEMBER' },\n    { userId: '00000000-0000-0000-0000-000000000006', groupId: club2Id, role: 'ADMIN' },\n    { userId: '00000000-0000-0000-0000-000000000007', groupId: club2Id, role: 'MEMBER' },\n    { userId: '00000000-0000-0000-0000-000000000008', groupId: club2Id, role: 'CFI' },\n    { userId: '00000000-0000-0000-0000-000000000009', groupId: club2Id, role: 'MEMBER' },\n    { userId: '00000000-0000-0000-0000-000000000010', groupId: club2Id, role: 'MEMBER' },\n  ];\n\n  for (const m of memberships) {\n    await prisma.$executeRawUnsafe(`\n      INSERT INTO GroupMember (id, userId, groupId, role, joinedAt)\n      VALUES (NEWID(), '${m.userId}', '${m.groupId}', '${m.role}', GETDATE())\n    `);\n  }\n\n  // Create Bookings (some past, some future)\n  console.log('Creating bookings...');\n  \n  const now = new Date();\n  const bookings = [];\n\n  // Past bookings (last 30 days)\n  for (let i = 0; i < 10; i++) {\n    const date = new Date(now);\n    date.setDate(date.getDate() - Math.floor(Math.random() * 30));\n    const startTime = new Date(date);\n    startTime.setHours(9 + Math.floor(Math.random() * 8), 0, 0, 0);\n    const endTime = new Date(startTime);\n    endTime.setHours(endTime.getHours() + 1 + Math.floor(Math.random() * 3));\n    \n    bookings.push({\n      aircraftId: aircraft[Math.floor(Math.random() * aircraft.length)].id,\n      userId: users[Math.floor(Math.random() * 5)].id,\n      startTime: startTime.toISOString(),\n      endTime: endTime.toISOString(),\n      purpose: ['Training', 'Cross Country', 'Local Practice', 'Night Flight'][Math.floor(Math.random() * 4)],\n    });\n  }\n\n  // Future bookings (next 14 days)\n  for (let i = 0; i < 10; i++) {\n    const date = new Date(now);\n    date.setDate(date.getDate() + Math.floor(Math.random() * 14));\n    const startTime = new Date(date);\n    startTime.setHours(9 + Math.floor(Math.random() * 8), 0, 0, 0);\n    const endTime = new Date(startTime);\n    endTime.setHours(endTime.getHours() + 1 + Math.floor(Math.random() * 3));\n    \n    bookings.push({\n      aircraftId: aircraft[Math.floor(Math.random() * aircraft.length)].id,\n      userId: users[Math.floor(Math.random() * 5)].id,\n      startTime: startTime.toISOString(),\n      endTime: endTime.toISOString(),\n      purpose: ['Training', 'Cross Country', 'Local Practice', 'Night Flight'][Math.floor(Math.random() * 4)],\n    });\n  }\n\n  for (const b of bookings) {\n    await prisma.$executeRawUnsafe(`\n      INSERT INTO Booking (id, aircraftId, userId, startTime, endTime, purpose, createdAt)\n      VALUES (NEWID(), '${b.aircraftId}', '${b.userId}', '${b.startTime}', '${b.endTime}', '${b.purpose}', GETDATE())\n    `);\n  }\n\n  // Create Flight Logs (past flights with hobbs times)\n  console.log('Creating flight logs...');\n  \n  for (let i = 0; i < 30; i++) {\n    const date = new Date(now);\n    date.setDate(date.getDate() - Math.floor(Math.random() * 90));\n    const aircraftId = aircraft[Math.floor(Math.random() * aircraft.length)].id;\n    const userId = users[Math.floor(Math.random() * 5)].id;\n    const hobbsTime = 0.5 + Math.random() * 2.5;\n    const hourlyRate = aircraft.find(a => a.id === aircraftId)?.hourlyRate || 150;\n    \n    await prisma.$executeRawUnsafe(`\n      INSERT INTO FlightLog (id, aircraftId, userId, date, hobbsTime, hobbsStart, hobbsEnd, calculatedCost, createdAt)\n      VALUES (\n        NEWID(), \n        '${aircraftId}', \n        '${userId}', \n        '${date.toISOString()}', \n        ${hobbsTime.toFixed(2)},\n        ${(1000 + i * 0.1).toFixed(1)},\n        ${(1000 + i * 0.1 + hobbsTime).toFixed(1)},\n        ${(hobbsTime * hourlyRate).toFixed(2)},\n        GETDATE()\n      )\n    `);\n  }\n\n  // Create Logbook entries for currency tracking\n  console.log('Creating logbook entries...');\n  \n  for (const u of users.slice(0, 5)) {\n    // Add some recent entries with landings\n    for (let i = 0; i < 5; i++) {\n      const date = new Date(now);\n      date.setDate(date.getDate() - Math.floor(Math.random() * 80));\n      \n      await prisma.$executeRawUnsafe(`\n        INSERT INTO LogbookEntry (id, userId, date, aircraft, routeFrom, routeTo, totalTime, dayLandings, nightLandings, createdAt)\n        VALUES (\n          NEWID(),\n          '${u.id}',\n          '${date.toISOString()}',\n          'Cessna 172',\n          'KABC',\n          'KXYZ',\n          ${(1 + Math.random() * 2).toFixed(1)},\n          ${Math.floor(Math.random() * 3) + 1},\n          ${Math.random() > 0.5 ? Math.floor(Math.random() * 2) : 0},\n          GETDATE()\n        )\n      `);\n    }\n  }\n\n  // Update User credentials for demo\n  console.log('Setting up pilot credentials...');\n  \n  const bfrDate = new Date(now);\n  bfrDate.setMonth(bfrDate.getMonth() + 6); // BFR due in 6 months\n  \n  const medicalDate = new Date(now);\n  medicalDate.setMonth(medicalDate.getMonth() + 18); // Medical valid for 18 months\n\n  await prisma.$executeRawUnsafe(`\n    UPDATE [User] SET bfrExpiry = '${bfrDate.toISOString()}', medicalExpiry = '${medicalDate.toISOString()}', medicalClass = '2'\n    WHERE email IN ('pilot@skyhigh.com', 'pilot2@skyhigh.com', 'pilot@weekend.com')\n  `);\n\n  console.log('Demo data seeded successfully!');\n  console.log('');\n  console.log('Demo Accounts:');\n  console.log('------------');\n  console.log('Sky High Flying Club:');\n  console.log('  admin@skyhigh.com / password (Admin)');\n  console.log('  pilot@skyhigh.com / password (Member)');\n  console.log('  cfi@skyhigh.com / password (CFI)');\n  console.log('');\n  console.log('Weekend Warriors:');\n  console.log('  admin@weekend.com / password (Admin)');\n  console.log('  pilot@weekend.com / password (Member)');\n  console.log('  cfi@weekend.com / password (CFI)');\n}\n\nmain()\n  .catch((e) => {\n    console.error('Error seeding data:', e);\n    process.exit(1);\n  })\n  .finally(async () => {\n    await prisma.$disconnect();\n  });\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\scripts\\seed-fbo-fees.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":6,"column":17,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":6,"endColumn":35},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":7,"column":14,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":7,"endColumn":29}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Seed FBO fees for common airports\n * Run: node scripts/seed-fbo-fees.js\n */\n\nconst sqlite3 = require('sqlite3').verbose();\nconst path = require('path');\n\nconst DB_PATH = path.join(__dirname, '..', 'data', 'aviation_hub.db');\n\nconst db = new sqlite3.Database(DB_PATH);\n\n// Common US airports with typical FBO fees\n// These are estimates - real fees vary by FBO and change frequently\nconst fboFeesData = [\n  // Seattle Area\n  { icao: 'KPAE', fbo_name: 'Snohomish County Airport', ramp_fee: 35, overnight_fee: 25, handling_fee: 0, fuel_minimum: 0, credit_card_fee: 0, phone: '425-353-9857', amenities: JSON.stringify({ crew_car: true, rental_car: true, conference: true, wifi: true }) },\n  { icao: 'KSEA', fbo_name: 'Sea-Tac Intl', ramp_fee: 75, overnight_fee: 50, handling_fee: 100, fuel_minimum: 100, credit_card_fee: 3, phone: '206-433-5378', amenities: JSON.stringify({ crew_car: true, rental_car: true, restaurant: true, lounge: true }) },\n  { icao: 'KBFI', fbo_name: 'King County Intl', ramp_fee: 45, overnight_fee: 30, handling_fee: 50, fuel_minimum: 0, credit_card_fee: 0, phone: '206-296-7330', amenities: JSON.stringify({ crew_car: true, rental_car: true, wifi: true }) },\n  \n  // Portland Area\n  { icao: 'KPDX', fbo_name: 'Portland Intl', ramp_fee: 65, overnight_fee: 40, handling_fee: 75, fuel_minimum: 50, credit_card_fee: 0, phone: '503-335-2700', amenities: JSON.stringify({ crew_car: true, rental_car: true, restaurant: true, lounge: true }) },\n  { icao: 'KHIO', fbo_name: 'Hillsboro Airport', ramp_fee: 30, overnight_fee: 20, handling_fee: 0, fuel_minimum: 0, credit_card_fee: 0, phone: '503-629-4886', amenities: JSON.stringify({ crew_car: true, wifi: true }) },\n  \n  // San Francisco Area\n  { icao: 'KSFO', fbo_name: 'San Francisco Intl', ramp_fee: 125, overnight_fee: 85, handling_fee: 150, fuel_minimum: 200, credit_card_fee: 3, phone: '650-877-5427', amenities: JSON.stringify({ crew_car: true, rental_car: true, restaurant: true, lounge: true, shower: true }) },\n  { icao: 'KOAK', fbo_name: 'Oakland Intl', ramp_fee: 55, overnight_fee: 40, handling_fee: 60, fuel_minimum: 50, credit_card_fee: 0, phone: '510-563-6464', amenities: JSON.stringify({ crew_car: true, rental_car: true, restaurant: true }) },\n  { icao: 'KSJC', fbo_name: 'San Jose Intl', ramp_fee: 55, overnight_fee: 35, handling_fee: 50, fuel_minimum: 50, credit_card_fee: 0, phone: '408-299-5850', amenities: JSON.stringify({ crew_car: true, rental_car: true, wifi: true }) },\n  \n  // Los Angeles Area\n  { icao: 'KLAX', fbo_name: 'Los Angeles Intl', ramp_fee: 150, overnight_fee: 100, handling_fee: 200, fuel_minimum: 300, credit_card_fee: 3, phone: '310-646-2842', amenities: JSON.stringify({ crew_car: true, rental_car: true, restaurant: true, lounge: true, shower: true }) },\n  { icao: 'KVNY', fbo_name: 'Van Nuys', ramp_fee: 45, overnight_fee: 30, handling_fee: 50, fuel_minimum: 25, credit_card_fee: 0, phone: '818-780-9696', amenities: JSON.stringify({ crew_car: true, rental_car: true, restaurant: true }) },\n  { icao: 'KHHR', fbo_name: 'Hawthorne Municipal', ramp_fee: 25, overnight_fee: 20, handling_fee: 0, fuel_minimum: 0, credit_card_fee: 0, phone: '310-349-1635', amenities: JSON.stringify({ wifi: true }) },\n  { icao: 'KBUR', fbo_name: 'Burbank', ramp_fee: 50, overnight_fee: 35, handling_fee: 50, fuel_minimum: 25, credit_card_fee: 0, phone: '818-840-8840', amenities: JSON.stringify({ crew_car: true, rental_car: true, restaurant: true }) },\n  \n  // Denver Area\n  { icao: 'KDEN', fbo_name: 'Denver Intl', ramp_fee: 85, overnight_fee: 55, handling_fee: 100, fuel_minimum: 100, credit_card_fee: 0, phone: '303-342-4400', amenities: JSON.stringify({ crew_car: true, rental_car: true, restaurant: true, lounge: true }) },\n  { icao: 'KAPA', fbo_name: 'Centennial Airport', ramp_fee: 35, overnight_fee: 25, handling_fee: 0, fuel_minimum: 0, credit_card_fee: 0, phone: '303-790-0598', amenities: JSON.stringify({ crew_car: true, wifi: true }) },\n  { icao: 'KBJC', fbo_name: 'Rocky Mountain Metro', ramp_fee: 30, overnight_fee: 20, handling_fee: 0, fuel_minimum: 0, credit_card_fee: 0, phone: '303-271-8700', amenities: JSON.stringify({ wifi: true }) },\n  \n  // Phoenix Area\n  { icao: 'KPHX', fbo_name: 'Phoenix Sky Harbor', ramp_fee: 75, overnight_fee: 50, handling_fee: 85, fuel_minimum: 75, credit_card_fee: 0, phone: '602-273-7290', amenities: JSON.stringify({ crew_car: true, rental_car: true, restaurant: true, lounge: true }) },\n  { icao: 'KDVT', fbo_name: 'Deer Valley', ramp_fee: 25, overnight_fee: 15, handling_fee: 0, fuel_minimum: 0, credit_card_fee: 0, phone: '623-935-5900', amenities: JSON.stringify({ wifi: true }) },\n  { icao: 'KSDL', fbo_name: 'Scottsdale Airport', ramp_fee: 30, overnight_fee: 20, handling_fee: 0, fuel_minimum: 0, credit_card_fee: 0, phone: '483-9000', amenities: JSON.stringify({ crew_car: true, wifi: true }) },\n  \n  // Las Vegas Area\n  { icao: 'KLAS', fbo_name: 'McCarran Intl', ramp_fee: 95, overnight_fee: 60, handling_fee: 125, fuel_minimum: 150, credit_card_fee: 3, phone: '702-261-3800', amenities: JSON.stringify({ crew_car: true, rental_car: true, restaurant: true, lounge: true, shower: true }) },\n  { icao: 'KHND', fbo_name: 'Henderson Executive', ramp_fee: 35, overnight_fee: 25, handling_fee: 0, fuel_minimum: 0, credit_card_fee: 0, phone: '702-261-0000', amenities: JSON.stringify({ crew_car: true, wifi: true }) },\n  \n  // Dallas/Fort Worth Area\n  { icao: 'KDFW', fbo_name: 'Dallas/Fort Worth Intl', ramp_fee: 100, overnight_fee: 65, handling_fee: 125, fuel_minimum: 150, credit_card_fee: 0, phone: '972-973-3112', amenities: JSON.stringify({ crew_car: true, rental_car: true, restaurant: true, lounge: true, shower: true }) },\n  { icao: 'KDAL', fbo_name: 'Dallas Love Field', ramp_fee: 50, overnight_fee: 35, handling_fee: 50, fuel_minimum: 25, credit_card_fee: 0, phone: '214-670-6913', amenities: JSON.stringify({ crew_car: true, rental_car: true, restaurant: true }) },\n  { icao: 'KAFW', fbo_name: 'Fort Worth Alliance', ramp_fee: 40, overnight_fee: 30, handling_fee: 0, fuel_minimum: 0, credit_card_fee: 0, phone: '817-890-4600', amenities: JSON.stringify({ crew_car: true, wifi: true }) },\n  \n  // Houston Area\n  { icao: 'KIAH', fbo_name: 'George Bush Intl', ramp_fee: 95, overnight_fee: 60, handling_fee: 125, fuel_minimum: 150, credit_card_fee: 3, phone: '281-233-1730', amenities: JSON.stringify({ crew_car: true, rental_car: true, restaurant: true, lounge: true, shower: true }) },\n  { icao: 'KHOU', fbo_name: 'William P Hobby', ramp_fee: 45, overnight_fee: 30, handling_fee: 50, fuel_minimum: 25, credit_card_fee: 0, phone: '713-884-6891', amenities: JSON.stringify({ crew_car: true, rental_car: true, restaurant: true }) },\n  { icao: 'KCLL', fbo_name: 'Easterwood Field', ramp_fee: 25, overnight_fee: 20, handling_fee: 0, fuel_minimum: 0, credit_card_fee: 0, phone: '979-846-1740', amenities: JSON.stringify({ wifi: true }) },\n  \n  // Chicago Area\n  { icao: 'KORD', fbo_name: \"O'Hare Intl\", ramp_fee: 125, overnight_fee: 85, handling_fee: 175, fuel_minimum: 200, credit_card_fee: 3, phone: '847-294-1448', amenities: JSON.stringify({ crew_car: true, rental_car: true, restaurant: true, lounge: true, shower: true }) },\n  { icao: 'KMID', fbo_name: 'Chicago Midway', ramp_fee: 55, overnight_fee: 40, handling_fee: 60, fuel_minimum: 50, credit_card_fee: 0, phone: '708-563-3350', amenities: JSON.stringify({ crew_car: true, rental_car: true, restaurant: true }) },\n  { icao: 'KPWK', fbo_name: 'Chicago Executive', ramp_fee: 35, overnight_fee: 25, handling_fee: 0, fuel_minimum: 0, credit_card_fee: 0, phone: '847-259-6000', amenities: JSON.stringify({ crew_car: true, wifi: true }) },\n  \n  // Atlanta Area\n  { icao: 'KATL', fbo_name: 'Hartsfield-Jackson', ramp_fee: 115, overnight_fee: 75, handling_fee: 150, fuel_minimum: 200, credit_card_fee: 3, phone: '404-530-6600', amenities: JSON.stringify({ crew_car: true, rental_car: true, restaurant: true, lounge: true, shower: true }) },\n  { icao: 'KPDK', fbo_name: 'DeKalb-Peachtree', ramp_fee: 30, overnight_fee: 20, handling_fee: 0, fuel_minimum: 0, credit_card_fee: 0, phone: '404-559-2600', amenities: JSON.stringify({ crew_car: true, wifi: true }) },\n  { icao: 'KFTY', fbo_name: 'Fulton County', ramp_fee: 25, overnight_fee: 18, handling_fee: 0, fuel_minimum: 0, credit_card_fee: 0, phone: '404-699-6800', amenities: JSON.stringify({ wifi: true }) },\n  \n  // Miami Area\n  { icao: 'KMIA', fbo_name: 'Miami Intl', ramp_fee: 125, overnight_fee: 85, handling_fee: 175, fuel_minimum: 200, credit_card_fee: 3, phone: '305-876-7070', amenities: JSON.stringify({ crew_car: true, rental_car: true, restaurant: true, lounge: true, shower: true }) },\n  { icao: 'KOPF', fbo_name: 'Miami Opa Locka', ramp_fee: 40, overnight_fee: 30, handling_fee: 0, fuel_minimum: 0, credit_card_fee: 0, phone: '305-869-1660', amenities: JSON.stringify({ crew_car: true, wifi: true }) },\n  { icao: 'KTMB', fbo_name: 'Miami Executive', ramp_fee: 30, overnight_fee: 20, handling_fee: 0, fuel_minimum: 0, credit_card_fee: 0, phone: '305-234-8361', amenities: JSON.stringify({ wifi: true }) },\n  \n  // New York Area\n  { icao: 'KJFK', fbo_name: 'John F Kennedy Intl', ramp_fee: 175, overnight_fee: 125, handling_fee: 250, fuel_minimum: 400, credit_card_fee: 3, phone: '718-244-7475', amenities: JSON.stringify({ crew_car: true, rental_car: true, restaurant: true, lounge: true, shower: true }) },\n  { icao: 'KLGA', fbo_name: 'LaGuardia', ramp_fee: 145, overnight_fee: 100, handling_fee: 200, fuel_minimum: 300, credit_card_fee: 3, phone: '718-533-3900', amenities: JSON.stringify({ crew_car: true, rental_car: true, restaurant: true, lounge: true }) },\n  { icao: 'KEWR', fbo_name: 'Newark Liberty', ramp_fee: 135, overnight_fee: 90, handling_fee: 175, fuel_minimum: 250, credit_card_fee: 3, phone: '973-961-6000', amenities: JSON.stringify({ crew_car: true, rental_car: true, restaurant: true, lounge: true, shower: true }) },\n  { icao: 'KTEB', fbo_name: 'Teterboro', ramp_fee: 85, overnight_fee: 55, handling_fee: 100, fuel_minimum: 100, credit_card_fee: 0, phone: '201-288-1800', amenities: JSON.stringify({ crew_car: true, rental_car: true, restaurant: true, lounge: true }) },\n  { icao: 'KHPN', fbo_name: 'Westchester County', ramp_fee: 50, overnight_fee: 35, handling_fee: 50, fuel_minimum: 25, credit_card_fee: 0, phone: '914-948-6520', amenities: JSON.stringify({ crew_car: true, rental_car: true, restaurant: true }) },\n  \n  // Boston Area\n  { icao: 'KBOS', fbo_name: 'Boston Logan Intl', ramp_fee: 125, overnight_fee: 85, handling_fee: 175, fuel_minimum: 200, credit_card_fee: 3, phone: '617-561-1800', amenities: JSON.stringify({ crew_car: true, rental_car: true, restaurant: true, lounge: true, shower: true }) },\n  { icao: 'KBED', fbo_name: 'Hanscom Field', ramp_fee: 45, overnight_fee: 30, handling_fee: 50, fuel_minimum: 25, credit_card_fee: 0, phone: '781-274-0700', amenities: JSON.stringify({ crew_car: true, rental_car: true, restaurant: true }) },\n  { icao: 'KOWD', fbo_name: 'Norwood Memorial', ramp_fee: 30, overnight_fee: 20, handling_fee: 0, fuel_minimum: 0, credit_card_fee: 0, phone: '781-769-2100', amenities: JSON.stringify({ wifi: true }) },\n  \n  // Washington DC Area\n  { icao: 'KIAD', fbo_name: 'Washington Dulles', ramp_fee: 95, overnight_fee: 65, handling_fee: 125, fuel_minimum: 150, credit_card_fee: 3, phone: '703-572-8250', amenities: JSON.stringify({ crew_car: true, rental_car: true, restaurant: true, lounge: true, shower: true }) },\n  { icao: 'KDCA', fbo_name: 'Reagan National', ramp_fee: 85, overnight_fee: 55, handling_fee: 100, fuel_minimum: 100, credit_card_fee: 0, phone: '703-417-0342', amenities: JSON.stringify({ crew_car: true, rental_car: true, restaurant: true }) },\n  { icao: 'KBWI', fbo_name: 'Baltimore/Washington', ramp_fee: 55, overnight_fee: 40, handling_fee: 60, fuel_minimum: 50, credit_card_fee: 0, phone: '410-859-7017', amenities: JSON.stringify({ crew_car: true, rental_car: true, restaurant: true }) },\n  \n  // Detroit Area\n  { icao: 'KDTW', fbo_name: 'Detroit Metro Wayne County', ramp_fee: 85, overnight_fee: 55, handling_fee: 100, fuel_minimum: 100, credit_card_fee: 0, phone: '734-942-3540', amenities: JSON.stringify({ crew_car: true, rental_car: true, restaurant: true, lounge: true }) },\n  { icao: 'KTTF', fbo_name: 'Monroe', ramp_fee: 25, overnight_fee: 18, handling_fee: 0, fuel_minimum: 0, credit_card_fee: 0, phone: '734-384-5100', amenities: JSON.stringify({ wifi: true }) },\n  \n  // Minneapolis Area\n  { icao: 'KMSP', fbo_name: 'Minneapolis-St Paul', ramp_fee: 75, overnight_fee: 50, handling_fee: 100, fuel_minimum: 100, credit_card_fee: 0, phone: '612-725-4500', amenities: JSON.stringify({ crew_car: true, rental_car: true, restaurant: true, lounge: true }) },\n  { icao: 'KMIC', fbo_name: 'Crystal Airport', ramp_fee: 20, overnight_fee: 15, handling_fee: 0, fuel_minimum: 0, credit_card_fee: 0, phone: '612-588-9576', amenities: JSON.stringify({ wifi: true }) },\n  \n  // Nashville Area\n  { icao: 'KBNA', fbo_name: 'Nashville Intl', ramp_fee: 55, overnight_fee: 40, handling_fee: 60, fuel_minimum: 50, credit_card_fee: 0, phone: '615-275-1675', amenities: JSON.stringify({ crew_car: true, rental_car: true, restaurant: true }) },\n  { icao: 'KMQY', fbo_name: 'Smyrna Airport', ramp_fee: 20, overnight_fee: 15, handling_fee: 0, fuel_minimum: 0, credit_card_fee: 0, phone: '615-223-3509', amenities: JSON.stringify({ wifi: true }) },\n  \n  // Charlotte Area\n  { icao: 'KCLT', fbo_name: 'Charlotte Douglas Intl', ramp_fee: 75, overnight_fee: 50, handling_fee: 85, fuel_minimum: 75, credit_card_fee: 0, phone: '704-359-4000', amenities: JSON.stringify({ crew_car: true, rental_car: true, restaurant: true, lounge: true }) },\n  { icao: 'KCHO', fbo_name: 'Charlottesville-Albemarle', ramp_fee: 25, overnight_fee: 18, handling_fee: 0, fuel_minimum: 0, credit_card_fee: 0, phone: '434-973-9791', amenities: JSON.stringify({ wifi: true }) },\n  \n  // Orlando Area\n  { icao: 'KMCO', fbo_name: 'Orlando Intl', ramp_fee: 75, overnight_fee: 50, handling_fee: 85, fuel_minimum: 75, credit_card_fee: 0, phone: '407-825-2000', amenities: JSON.stringify({ crew_car: true, rental_car: true, restaurant: true, lounge: true }) },\n  { icao: 'KORL', fbo_name: 'Orlando Executive', ramp_fee: 35, overnight_fee: 25, handling_fee: 0, fuel_minimum: 0, credit_card_fee: 0, phone: '407-896-0500', amenities: JSON.stringify({ crew_car: true, wifi: true }) },\n  { icao: 'KTIX', fbo_name: 'Space Coast Regional', ramp_fee: 20, overnight_fee: 15, handling_fee: 0, fuel_minimum: 0, credit_card_fee: 0, phone: '321-267-8780', amenities: JSON.stringify({ wifi: true }) },\n  \n  // Salt Lake City Area\n  { icao: 'KSLC', fbo_name: 'Salt Lake City Intl', ramp_fee: 65, overnight_fee: 45, handling_fee: 75, fuel_minimum: 75, credit_card_fee: 0, phone: '801-575-2400', amenities: JSON.stringify({ crew_car: true, rental_car: true, restaurant: true, lounge: true }) },\n  { icao: 'KPVU', fbo_name: 'Provo Municipal', ramp_fee: 25, overnight_fee: 18, handling_fee: 0, fuel_minimum: 0, credit_card_fee: 0, phone: '801-373-8686', amenities: JSON.stringify({ wifi: true }) },\n  \n  // Albuquerque Area\n  { icao: 'KABQ', fbo_name: 'Albuquerque Intl Sunport', ramp_fee: 45, overnight_fee: 30, handling_fee: 50, fuel_minimum: 25, credit_card_fee: 0, phone: '505-244-7700', amenities: JSON.stringify({ crew_car: true, rental_car: true, restaurant: true }) },\n  { icao: 'KAEG', fbo_name: 'Double Eagle II', ramp_fee: 20, overnight_fee: 15, handling_fee: 0, fuel_minimum: 0, credit_card_fee: 0, 'phone': '505-884-1613', amenities: JSON.stringify({ wifi: true }) },\n  \n  // Reno Area\n  { icao: 'KRNO', fbo_name: 'Reno-Tahoe Intl', ramp_fee: 45, overnight_fee: 30, handling_fee: 50, fuel_minimum: 25, credit_card_fee: 0, phone: '775-328-6400', amenities: JSON.stringify({ crew_car: true, rental_car: true, restaurant: true }) },\n  { icao: 'KTRK', fbo_name: 'Truckee-Tahoe', ramp_fee: 35, overnight_fee: 25, handling_fee: 0, fuel_minimum: 0, credit_card_fee: 0, phone: '530-587-4119', amenities: JSON.stringify({ wifi: true }) },\n  \n  // Honolulu Area\n  { icao: 'PHNL', fbo_name: 'Daniel K Inouye Intl', ramp_fee: 95, overnight_fee: 65, handling_fee: 125, fuel_minimum: 150, credit_card_fee: 0, phone: '808-836-6413', amenities: JSON.stringify({ crew_car: true, rental_car: true, restaurant: true, lounge: true }) },\n  { icao: 'PHOG', fbo_name: 'Kahului Airport', ramp_fee: 45, overnight_fee: 30, handling_fee: 50, fuel_minimum: 25, credit_card_fee: 0, phone: '808-872-3830', amenities: JSON.stringify({ crew_car: true, wifi: true }) },\n  \n  // Anchorage Area\n  { icao: 'PANC', fbo_name: 'Ted Stevens Anchorage Intl', ramp_fee: 65, overnight_fee: 45, handling_fee: 75, fuel_minimum: 75, credit_card_fee: 0, phone: '907-266-5300', amenities: JSON.stringify({ crew_car: true, rental_car: true, restaurant: true, lounge: true }) },\n  { icao: 'PAFA', fbo_name: 'Fairbanks Intl', ramp_fee: 45, overnight_fee: 30, handling_fee: 50, fuel_minimum: 25, credit_card_fee: 0, phone: '907-474-0700', amenities: JSON.stringify({ crew_car: true, restaurant: true }) },\n  \n  // Popular Destinations\n  { icao: 'KOSH', fbo_name: 'Oshkosh Wittman', ramp_fee: 30, overnight_fee: 20, handling_fee: 0, fuel_minimum: 0, credit_card_fee: 0, phone: '920-236-5040', amenities: JSON.stringify({ wifi: true, restaurant: true }) },\n  { icao: 'KSUN', fbo_name: 'Friedman Memorial', ramp_fee: 30, overnight_fee: 20, handling_fee: 0, fuel_minimum: 0, credit_card_fee: 0, 'phone': '208-788-4956', amenities: JSON.stringify({ wifi: true }) },\n  { icao: 'KTWF', fbo_name: 'Joslin Field - Magic Valley', ramp_fee: 25, overnight_fee: 18, handling_fee: 0, fuel_minimum: 0, credit_card_fee: 0, phone: '208-733-3438', amenities: JSON.stringify({ wifi: true }) },\n  { icao: 'KEKO', fbo_name: 'Elko Regional', ramp_fee: 20, overnight_fee: 15, handling_fee: 0, fuel_minimum: 0, credit_card_fee: 0, phone: '775-738-4044', amenities: JSON.stringify({ wifi: true }) },\n  { icao: 'KSLE', fbo_name: 'Salem Municipal', ramp_fee: 25, overnight_fee: 18, handling_fee: 0, fuel_minimum: 0, credit_card_fee: 0, phone: '503-588-8420', amenities: JSON.stringify({ wifi: true }) },\n  { icao: 'KBLI', fbo_name: 'Bellingham Intl', ramp_fee: 25, overnight_fee: 18, handling_fee: 0, fuel_minimum: 0, credit_card_fee: 0, phone: '360-676-2700', amenities: JSON.stringify({ wifi: true, crew_car: true }) },\n  { icao: 'KGEG', fbo_name: 'Spokane Intl', ramp_fee: 40, overnight_fee: 28, handling_fee: 45, fuel_minimum: 20, credit_card_fee: 0, phone: '509-455-6455', amenities: JSON.stringify({ crew_car: true, rental_car: true, restaurant: true }) },\n  { icao: 'KYKM', fbo_name: 'Yakima Air Terminal', ramp_fee: 20, overnight_fee: 15, handling_fee: 0, fuel_minimum: 0, credit_card_fee: 0, phone: '509-575-6149', amenities: JSON.stringify({ wifi: true }) },\n];\n\nconsole.log('Seeding FBO fees...\\n');\n\nconst stmt = db.prepare(`\n  INSERT OR REPLACE INTO fbo_fees \n  (icao, fbo_name, ramp_fee, overnight_fee, handling_fee, fuel_minimum, credit_card_fee, phone, amenities, source)\n  VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, 'seed')\n`);\n\nlet inserted = 0;\nfboFeesData.forEach(data => {\n  stmt.run(\n    data.icao,\n    data.fbo_name,\n    data.ramp_fee,\n    data.overnight_fee,\n    data.handling_fee,\n    data.fuel_minimum,\n    data.credit_card_fee,\n    data.phone,\n    data.amenities\n  );\n  inserted++;\n});\n\nstmt.finalize((err) => {\n  if (err) {\n    console.error('Error seeding FBO fees:', err);\n  } else {\n    console.log(`âœ… Seeded ${inserted} FBO fee records`);\n    \n    // Verify count\n    db.get(\"SELECT COUNT(*) as count FROM fbo_fees\", (err, row) => {\n      if (err) {\n        console.error('Error counting records:', err);\n      } else {\n        console.log(`   Total records in database: ${row.count}`);\n      }\n      db.close();\n    });\n  }\n});\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\scripts\\seed-large-airports.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":6,"column":17,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":6,"endColumn":35},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":7,"column":14,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":7,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'remote' is assigned a value but never used.","line":93,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":93,"endColumn":15}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Script to seed all US large airport fuel prices\n * Uses regional averages based on FAA regions\n */\n\nconst sqlite3 = require('sqlite3').verbose();\nconst path = require('path');\n\nconst DB_PATH = path.join(__dirname, '..', 'data', 'aviation_hub.db');\n\n// Known prices for major airports (from 100LL.com research)\nconst KNOWN_PRICES = {\n  // Michigan (Great Lakes)\n  'KFNT': 6.25, 'KLAN': 6.15, 'KTVC': 6.45, 'KCIU': 7.15,\n  'KDTW': 6.55, 'KGRR': 5.99, 'KMBS': 6.35, 'KSAW': 7.25,\n  // Major US airports - sample prices from various sources\n  'KATL': 6.45, 'KORD': 6.29, 'KLAX': 7.85, 'KDFW': 5.95,\n  'KJFK': 7.25, 'KLAS': 6.95, 'KMIA': 6.75, 'KSEA': 7.45,\n  'KSFO': 8.15, 'KDEN': 5.85, 'KPHX': 6.25, 'KIAH': 5.75,\n  'KBOS': 7.15, 'KMSP': 6.05, 'KCLT': 5.85, 'KSTL': 5.65,\n  'KPDX': 6.75, 'KRDU': 5.95, 'KSLC': 5.95, 'KSAN': 7.25,\n  'KIND': 5.75, 'KCLE': 6.15, 'KPIT': 5.95, 'KMCI': 5.65,\n  'KCVG': 5.85, 'KTPA': 6.25, 'KRSW': 6.45, 'KMCO': 6.35,\n  'KJAX': 6.15, 'KMSY': 5.85, 'KBWI': 6.45, 'KPHL': 6.55,\n  'KLGA': 7.35, 'KEWR': 7.25, 'KDCA': 6.85, 'KIAD': 6.75,\n  'KSJC': 7.95, 'KOAK': 7.85, 'KSNA': 7.45, 'KBUR': 7.15,\n  'KSMF': 6.85, 'KONT': 7.05, 'KPSP': 6.95, 'KSAT': 5.75,\n  'KAUS': 5.85, 'KHOU': 5.65, 'KABQ': 6.15, 'KTUS': 6.25,\n  'KOKC': 5.55, 'KTUL': 5.65, 'KLIT': 5.75, 'KBNA': 5.85,\n  'KMEM': 5.75, 'KBHM': 5.95, 'KCLT': 5.85, 'KGSP': 5.95,\n  'KRIC': 5.85, 'KORF': 6.15, 'KCRW': 6.25, 'KCAK': 5.95,\n  'KCMH': 5.85, 'KDAY': 5.75, 'KTYS': 5.95, 'KAVL': 5.85,\n  'KGSO': 5.85, 'KFAY': 5.65, 'KILM': 5.75, 'KCHS': 5.95,\n  'KSAV': 5.85, 'KBQK': 5.75, 'KTLH': 5.65, 'KPBI': 6.45,\n  'KFLL': 6.55, 'KMIA': 6.75, 'KECP': 6.25, 'KGSB': 5.85,\n  'KPGV': 5.75, 'KOAJ': 5.65, 'KISO': 5.55, 'KEWN': 5.85,\n  'KMRH': 5.75, 'KHKY': 5.65, 'KCLT': 5.85, 'KGMU': 5.95,\n  'KCAE': 5.85, 'KAGS': 5.75, 'KAHN': 5.85, 'KCRE': 5.65,\n  'KFLO': 5.55, 'KGMJ': 5.65, 'KLBT': 5.75, 'KMEB': 5.65,\n};\n\n// Regional base prices (from FAA regions data)\nconst REGIONAL_BASE = {\n  // Great Lakes (ACE, AGL)\n  'IL': 6.15, 'IN': 5.95, 'MI': 6.25, 'OH': 5.85, 'WI': 5.95, 'MN': 6.05, 'IA': 5.75, 'MO': 5.65, 'KS': 5.55, 'NE': 5.65, 'SD': 5.75, 'ND': 5.85,\n  // Eastern (AEA, AER)\n  'CT': 7.05, 'DE': 6.45, 'ME': 7.15, 'MD': 6.55, 'MA': 7.25, 'NH': 7.15, 'NJ': 6.85, 'NY': 6.95, 'PA': 6.45, 'RI': 7.05, 'VT': 7.25, 'VA': 6.15, 'WV': 5.95, 'DC': 6.85,\n  // Southern (ASO)\n  'AL': 5.85, 'FL': 6.35, 'GA': 5.85, 'KY': 5.75, 'MS': 5.65, 'NC': 5.85, 'SC': 5.75, 'TN': 5.75, 'PR': 5.95, 'VI': 5.95,\n  // Southwest (ASW)\n  'AR': 5.65, 'LA': 5.75, 'NM': 6.15, 'OK': 5.55, 'TX': 5.75,\n  // Western-Pacific (AWP)\n  'AZ': 6.25, 'CA': 7.45, 'HI': 8.25, 'NV': 6.85, 'AK': 9.15, 'GU': 7.95, 'AS': 8.25, 'MP': 7.75, 'PW': 7.95,\n  // Northwest Mountain (ANM)\n  'ID': 5.95, 'MT': 6.05, 'OR': 6.45, 'UT': 5.95, 'WA': 7.15, 'WY': 5.85,\n};\n\n// Fallback base price\nconst DEFAULT_BASE = 6.00;\n\n// Get base price for an airport based on state\nfunction getBasePrice(icao) {\n  // Known prices first\n  if (KNOWN_PRICES[icao]) return KNOWN_PRICES[icao];\n  \n  // Try to determine state from ICAO (first 2 letters after K)\n  const stateCode = icao.substring(1, 3);\n  const stateMap = {\n    'AL': 'AL', 'AK': 'AK', 'AZ': 'AZ', 'AR': 'AR', 'CA': 'CA',\n    'CO': 'CO', 'CT': 'CT', 'DE': 'DE', 'FL': 'FL', 'GA': 'GA',\n    'HI': 'HI', 'ID': 'ID', 'IL': 'IL', 'IN': 'IN', 'IA': 'IA',\n    'KS': 'KS', 'KY': 'KY', 'LA': 'LA', 'ME': 'ME', 'MD': 'MD',\n    'MA': 'MA', 'MI': 'MI', 'MN': 'MN', 'MS': 'MS', 'MO': 'MO',\n    'MT': 'MT', 'NE': 'NE', 'NV': 'NV', 'NH': 'NH', 'NJ': 'NJ',\n    'NM': 'NM', 'NY': 'NY', 'NC': 'NC', 'ND': 'ND', 'OH': 'OH',\n    'OK': 'OK', 'OR': 'OR', 'PA': 'PA', 'RI': 'RI', 'SC': 'SC',\n    'SD': 'SD', 'TN': 'TN', 'TX': 'TX', 'UT': 'UT', 'VT': 'VT',\n    'VA': 'VA', 'WA': 'WA', 'WV': 'WV', 'WI': 'WI', 'WY': 'WY',\n    'DC': 'DC', 'PR': 'PR', 'VI': 'VI', 'GU': 'GU', 'AS': 'AS'\n  };\n  \n  const state = stateMap[stateCode];\n  return state ? (REGIONAL_BASE[state] || DEFAULT_BASE) : DEFAULT_BASE;\n}\n\n// Apply variance based on airport type/location\nfunction applyVariance(base, icao) {\n  // Major hubs tend to have slightly lower prices (competition)\n  const majorHubs = ['ATL', 'ORD', 'DFW', 'DEN', 'LAX', 'JFK', 'SFO', 'SEA', 'MIA', 'BOS', 'LAS', 'PHX', 'IAH', 'MSP', 'CLT', 'FLL', 'MCO', 'DTW', 'PHL', 'LGA', 'EWR', 'BWI', 'DCA', 'IAD', 'SLC', 'SAN', 'IND', 'CLE', 'PIT', 'MCI', 'CVG', 'TPA', 'RSW', 'JAX', 'MSY', 'SAT', 'AUS', 'HOU', 'ABQ', 'TUS', 'OKC', 'TUL', 'LIT', 'MEM', 'BHM'];\n  const isHub = majorHubs.some(h => icao.endsWith(h));\n  \n  // Hawaii, Alaska, remote locations more expensive\n  const remote = ['PAE', 'BLI', 'ACV', 'EKA', 'FCA', 'GTF', 'HLN', 'FLO', 'LAX', 'SFO', 'OAK', 'SJC', 'ITO', 'KOA', 'OGG', 'LIH', 'HNL', 'ANC', 'BRW', 'FAI', 'OME', 'ADK', 'PSG', 'JNU', 'KTN', 'WRG', 'YAK', 'DLM', 'GUM', 'SPN', 'PPG', 'ROR', 'ROP'];\n  \n  let variance = Math.random() * 0.5 - 0.25; // +/- 0.25\n  \n  if (isHub) variance -= 0.15; // Slightly lower at major hubs\n  \n  return Math.round((base + variance) * 100) / 100;\n}\n\nfunction seedLargeAirportPrices() {\n  const db = new sqlite3.Database(DB_PATH);\n  \n  console.log('Seeding US large airport fuel prices...\\n');\n  \n  // Get all large airports\n  db.all(\"SELECT icao, type FROM airports WHERE type = 'large_airport'\", [], (err, rows) => {\n    if (err) {\n      console.error('Error fetching airports:', err.message);\n      db.close();\n      return;\n    }\n    \n    console.log(`Found ${rows.length} large airports`);\n    \n    const insertStmt = db.prepare(`\n      INSERT OR REPLACE INTO airport_cache (icao, data_type, price, source_site, last_updated)\n      VALUES (?, 'fuel', ?, 'regional_avg', datetime('now'))\n    `);\n    \n    let known = 0, generated = 0;\n    \n    rows.forEach(airport => {\n      const base = getBasePrice(airport.icao);\n      const price = KNOWN_PRICES[airport.icao] || applyVariance(base, airport.icao);\n      \n      insertStmt.run(airport.icao, price);\n      \n      if (KNOWN_PRICES[airport.icao]) known++;\n      else generated++;\n    });\n    \n    insertStmt.finalize(() => {\n      db.get(\"SELECT COUNT(*) as count FROM airport_cache WHERE data_type = 'fuel'\", [], (err, row) => {\n        console.log(`\\n=== Summary ===`);\n        console.log(`Large airports: ${rows.length}`);\n        console.log(`  - Known prices: ${known}`);\n        console.log(`  - Generated: ${generated}`);\n        console.log(`Total fuel prices cached: ${row.count}`);\n        \n        db.close();\n      });\n    });\n  });\n}\n\nseedLargeAirportPrices();\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\scripts\\seed-michigan-fuel.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":6,"column":17,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":6,"endColumn":35},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":7,"column":14,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":7,"endColumn":29}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Script to seed Michigan aviation fuel prices\n * Uses realistic regional averages from Great Lakes region\n */\n\nconst sqlite3 = require('sqlite3').verbose();\nconst path = require('path');\n\nconst DB_PATH = path.join(__dirname, '..', 'data', 'aviation_hub.db');\n\n// Known prices for Michigan airports (from 100LL.com research)\nconst KNOWN_PRICES = {\n  // Large airports - real data\n  'KFNT': 6.25, 'KLAN': 6.15, 'KTVC': 6.45, 'KCIU': 7.15,\n  'KDTW': 6.55, 'KGRR': 5.99, 'KMBS': 6.35, 'KSAW': 7.25,\n  // Medium airports - real data from 100LL.com\n  'KADG': 5.85, 'KAMN': 5.95, 'KAZO': 5.85, 'KBAX': 4.95,\n  'KBEH': 5.69, 'KBIV': 6.69, 'KC91': 5.00, 'KDRM': 6.50,\n  'KESC': 6.85, 'KFFX': 5.95, 'KFLD': 5.55, 'KHMU': 7.45,\n  'KHTL': 5.85, 'KIWX': 5.65, 'KJYM': 5.75, 'KLDM': 4.85,\n  'KMGC': 4.63, 'KMOP': 5.65, 'KOGM': 6.25, 'KONZ': 5.95,\n  'KOXI': 4.45, 'KPHN': 5.85, 'KPTK': 5.07, 'KRCR': 4.49,\n  'KRZL': 4.45, 'KSJX': 6.55, 'KSLH': 6.25, 'KTTF': 5.75,\n  'KVSF': 5.55, 'KW92': 6.35, 'KWIN': 5.25, 'KY70': 6.15,\n  'Y83': 5.20,\n};\n\n// Price variance by location\nfunction getBasePrice(icao, type) {\n  const upperPeninsula = ['SAW', 'ESC', 'MQT', 'CMX', 'IMT', 'DAK', 'SLH', 'SJX', 'BTL'];\n  const detroitMetro = ['DTW', 'DET', 'PTK', 'VLL', 'ONZ', 'TTF', 'RNP'];\n  \n  let base = type === 'large_airport' ? 6.00 : type === 'medium_airport' ? 5.75 : 5.50;\n  \n  if (upperPeninsula.some(s => icao.includes(s))) base += 0.75;\n  else if (detroitMetro.some(s => icao.includes(s))) base += 0.35;\n  \n  return base;\n}\n\nfunction seedFuelPrices() {\n  const db = new sqlite3.Database(DB_PATH);\n  \n  console.log('Seeding Michigan fuel prices...\\n');\n  \n  db.all(\"SELECT icao, type FROM airports WHERE state = 'US-MI'\", [], (err, rows) => {\n    if (err) {\n      console.error('Error fetching airports:', err.message);\n      db.close();\n      return;\n    }\n    \n    console.log(`Found ${rows.length} airports in Michigan`);\n    \n    const insertStmt = db.prepare(`\n      INSERT OR REPLACE INTO airport_cache (icao, data_type, price, source_site, last_updated)\n      VALUES (?, 'fuel', ?, 'regional_avg', datetime('now'))\n    `);\n    \n    let withPrices = 0;\n    \n    rows.forEach(airport => {\n      let price;\n      if (KNOWN_PRICES[airport.icao]) {\n        price = KNOWN_PRICES[airport.icao];\n      } else {\n        const base = getBasePrice(airport.icao, airport.type);\n        price = base + (Math.random() * 0.5 - 0.25);\n        price = Math.round(price * 100) / 100;\n      }\n      \n      insertStmt.run(airport.icao, price);\n      withPrices++;\n      \n      if (withPrices <= 10) {\n        const source = KNOWN_PRICES[airport.icao] ? 'known' : 'generated';\n        console.log(`  [OK] ${airport.icao} (${source}): $${price.toFixed(2)}/gal`);\n      }\n    });\n    \n    insertStmt.finalize(() => {\n      db.get(\"SELECT COUNT(*) as count FROM airport_cache WHERE data_type = 'fuel'\", [], (err, row) => {\n        console.log(`\\n=== Summary ===`);\n        console.log(`Total Michigan airports: ${rows.length}`);\n        console.log(`Fuel prices cached: ${row.count}`);\n        \n        db.close();\n      });\n    });\n  });\n}\n\nseedFuelPrices();\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\scripts\\seed.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":1,"column":1,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":1,"endColumn":18},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":2,"column":26,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":2,"endColumn":51}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"require(\"dotenv\").config();\nconst { PrismaClient } = require(\"@prisma/client\");\n\nasync function main() {\n  const prisma = new PrismaClient();\n\n  const user = await prisma.user.upsert({\n    where: { email: \"dkoster@oakland.edu\" },\n    update: { credits: 500 },\n    create: {\n      email: \"dkoster@oakland.edu\",\n      name: \"dkoster@oakland.edu\",\n      credits: 500,\n      purchasedModules: \"[]\",\n    },\n  });\n\n  console.log(\"Seeded user:\", user.email, \"credits:\", user.credits);\n\n  await prisma.$disconnect();\n}\n\nmain().catch((e) => {\n  console.error(e);\n  process.exit(1);\n});\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\scripts\\sync-demo.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":1,"column":26,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":1,"endColumn":51},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":2,"column":13,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":2,"endColumn":29}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const { PrismaClient } = require('@prisma/client');\nconst sql = require('mssql');\n\nconst prisma = new PrismaClient();\n\nasync function main() {\n  // Get user from local\n  const local = await prisma.user.findUnique({ where: { email: 'demo@demo.com' } });\n  console.log('Local user:', local.email, 'pwd:', local.password.substring(0, 20));\n  \n  // Connect to Azure\n  const config = {\n    server: 'aviation-server-dk.database.windows.net',\n    database: 'aviation_db',\n    user: 'CloudSA183a5780',\n    password: 'Password123',\n    options: { encrypt: true, trustServerCertificate: false }\n  };\n  \n  try {\n    const pool = await sql.connect(config);\n    \n    // Check if exists\n    const check = await pool.query`SELECT email FROM [User] WHERE email = 'demo@demo.com'`;\n    \n    if (check.recordset.length === 0) {\n      // Insert\n      await pool.query`\n        INSERT INTO [User] (id, email, name, password, purchasedModules, credits, createdAt, updatedAt)\n        VALUES (NEWID(), 'demo@demo.com', 'Demo User', ${local.password}, '[]', 100, GETDATE(), GETDATE())\n      `;\n      console.log('Created in Azure');\n    } else {\n      // Update\n      await pool.query`UPDATE [User] SET password = ${local.password} WHERE email = 'demo@demo.com'`;\n      console.log('Updated in Azure');\n    }\n  } catch (e) {\n    console.log('Azure error (user might already exist):', e.message);\n  }\n}\n\nmain().catch(console.error).finally(() => process.exit());\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\scripts\\sync-user.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":1,"column":26,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":1,"endColumn":51},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":11,"column":15,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":11,"endColumn":31}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const { PrismaClient } = require('@prisma/client');\n\nconst prisma = new PrismaClient();\n\nasync function main() {\n  // Get user from local\n  const localUser = await prisma.user.findUnique({ where: { email: 'test@test.com' } });\n  console.log('Local user:', localUser.email, 'pwd length:', localUser.password.length);\n  \n  // Now try Azure directly via raw SQL\n  const sql = require('mssql');\n  \n  const config = {\n    server: 'aviation-server-dk.database.windows.net',\n    database: 'aviation_db',\n    user: 'CloudSA183a5780',\n    password: 'Password123',\n    options: {\n      encrypt: true,\n      trustServerCertificate: false\n    }\n  };\n  \n  const pool = await sql.connect(config);\n  \n  // Check if user exists\n  let result = await pool.query`SELECT * FROM [User] WHERE email = 'test@test.com'`;\n  console.log('Azure users found:', result.recordset.length);\n  \n  if (result.recordset.length === 0) {\n    // Insert user\n    await pool.query`\n      INSERT INTO [User] (id, email, name, password, purchasedModules, credits, createdAt, updatedAt)\n      VALUES (NEWID(), 'test@test.com', 'Test User', ${localUser.password}, '[]', 100, GETDATE(), GETDATE())\n    `;\n    console.log('User created in Azure');\n  } else {\n    console.log('User already exists in Azure');\n  }\n  \n  await sql.close();\n}\n\nmain().catch(console.error);\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\scripts\\update-fuel-prices-cron.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":8,"column":17,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":8,"endColumn":35},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":9,"column":14,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":9,"endColumn":29}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Cron job script to update fuel prices every 72 hours\n * Run this via Vercel Cron or a separate scheduler\n * \n * Schedule: Every 72 hours\n */\n\nconst sqlite3 = require('sqlite3').verbose();\nconst path = require('path');\n\nconst DB_PATH = process.env.DB_PATH || path.join(__dirname, '..', 'data', 'aviation_hub.db');\n\n// Regional base prices (updated periodically)\nconst REGIONAL_BASE = {\n  'IL': 6.15, 'IN': 5.95, 'MI': 6.25, 'OH': 5.85, 'WI': 5.95, 'MN': 6.05, \n  'IA': 5.75, 'MO': 5.65, 'KS': 5.55, 'NE': 5.65, 'SD': 5.75, 'ND': 5.85,\n  'CT': 7.05, 'DE': 6.45, 'ME': 7.15, 'MD': 6.55, 'MA': 7.25, 'NH': 7.15, \n  'NJ': 6.85, 'NY': 6.95, 'PA': 6.45, 'RI': 7.05, 'VT': 7.25, 'VA': 6.15, \n  'WV': 5.95, 'DC': 6.85,\n  'AL': 5.85, 'FL': 6.35, 'GA': 5.85, 'KY': 5.75, 'MS': 5.65, 'NC': 5.85, \n  'SC': 5.75, 'TN': 5.75, 'PR': 5.95, 'VI': 5.95,\n  'AR': 5.65, 'LA': 5.75, 'NM': 6.15, 'OK': 5.55, 'TX': 5.75,\n  'AZ': 6.25, 'CA': 7.45, 'HI': 8.25, 'NV': 6.85, 'AK': 9.15, 'GU': 7.95,\n  'ID': 5.95, 'MT': 6.05, 'OR': 6.45, 'UT': 5.95, 'WA': 7.15, 'WY': 5.85,\n};\n\nconst DEFAULT_BASE = 6.00;\n\n// Get state code from ICAO\nfunction getStateCode(icao) {\n  const stateMap = {\n    'AL': 'AL', 'AK': 'AK', 'AZ': 'AZ', 'AR': 'AR', 'CA': 'CA',\n    'CO': 'CO', 'CT': 'CT', 'DE': 'DE', 'FL': 'FL', 'GA': 'GA',\n    'HI': 'HI', 'ID': 'ID', 'IL': 'IL', 'IN': 'IN', 'IA': 'IA',\n    'KS': 'KS', 'KY': 'KY', 'LA': 'LA', 'ME': 'ME', 'MD': 'MD',\n    'MA': 'MA', 'MI': 'MI', 'MN': 'MN', 'MS': 'MS', 'MO': 'MO',\n    'MT': 'MT', 'NE': 'NE', 'NV': 'NV', 'NH': 'NH', 'NJ': 'NJ',\n    'NM': 'NM', 'NY': 'NY', 'NC': 'NC', 'ND': 'ND', 'OH': 'OH',\n    'OK': 'OK', 'OR': 'OR', 'PA': 'PA', 'RI': 'RI', 'SC': 'SC',\n    'SD': 'SD', 'TN': 'TN', 'TX': 'TX', 'UT': 'UT', 'VT': 'VT',\n    'VA': 'VA', 'WA': 'WA', 'WV': 'WV', 'WI': 'WI', 'WY': 'WY',\n    'DC': 'DC', 'PR': 'PR', 'VI': 'VI', 'GU': 'GU', 'AS': 'AS'\n  };\n  return stateMap[icao.substring(1, 3)];\n}\n\nfunction getNewPrice(icao) {\n  const state = getStateCode(icao);\n  const base = state ? (REGIONAL_BASE[state] || DEFAULT_BASE) : DEFAULT_BASE;\n  // Small variance update (+/- 0.10 to simulate price changes)\n  const change = (Math.random() * 0.20) - 0.10;\n  return Math.round((base + change) * 100) / 100;\n}\n\nasync function updateFuelPrices() {\n  console.log('=== Starting 72-hour fuel price update ===\\n');\n  console.log(`Time: ${new Date().toISOString()}`);\n  \n  const db = new sqlite3.Database(DB_PATH);\n  \n  // Get all airports with cached fuel prices\n  db.all(\"SELECT icao, price FROM airport_cache WHERE data_type = 'fuel'\", [], (err, rows) => {\n    if (err) {\n      console.error('Error fetching cached prices:', err.message);\n      db.close();\n      process.exit(1);\n    }\n    \n    console.log(`Found ${rows.length} cached fuel prices`);\n    \n    const updateStmt = db.prepare(`\n      UPDATE airport_cache \n      SET price = ?, last_updated = datetime('now')\n      WHERE icao = ? AND data_type = 'fuel'\n    `);\n    \n    let updated = 0;\n    rows.forEach(row => {\n      const newPrice = getNewPrice(row.icao);\n      updateStmt.run(newPrice, row.icao);\n      updated++;\n    });\n    \n    updateStmt.finalize(() => {\n      // Log summary\n      const now = new Date().toISOString();\n      console.log(`\\n=== Update Complete ===`);\n      console.log(`Prices updated: ${updated}`);\n      console.log(`Completed: ${now}`);\n      \n      // Record this update in a log\n      console.log('\\nNote: Next update scheduled in 72 hours');\n      \n      db.close();\n      process.exit(0);\n    });\n  });\n}\n\n// Run if called directly\nif (require.main === module) {\n  updateFuelPrices();\n}\n\nmodule.exports = { updateFuelPrices };\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\scripts\\verify-user.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":1,"column":26,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":1,"endColumn":51},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":2,"column":16,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":2,"endColumn":33}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const { PrismaClient } = require('@prisma/client');\nconst bcrypt = require('bcrypt');\n\nconst prisma = new PrismaClient();\n\nasync function main() {\n  const email = 'demo@demo.com';\n  const password = 'password123';\n  \n  const user = await prisma.user.findUnique({ where: { email } });\n  \n  if (!user) {\n    console.log('User not found');\n    return;\n  }\n  \n  console.log('User found:', user.email);\n  console.log('Stored password:', user.password?.substring(0, 20));\n  \n  const isValid = await bcrypt.compare(password, user.password);\n  console.log('Password valid:', isValid);\n}\n\nmain().catch(console.error).finally(() => process.exit());\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\types\\next-auth.d.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DefaultUser' is defined but never used.","line":1,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":37,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"DefaultUser"},"fix":{"range":[23,36],"text":""},"desc":"Remove unused variable \"DefaultUser\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'JWT' is defined but never used.","line":2,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"JWT"},"fix":{"range":[57,94],"text":""},"desc":"Remove unused import declaration."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { DefaultSession, DefaultUser } from \"next-auth\";\nimport { JWT } from \"next-auth/jwt\";\n\ndeclare module \"next-auth\" {\n  interface Session {\n    user: {\n      id: string;\n      username?: string | null;\n      emailVerified?: Date | null;\n      role?: string;\n      tier?: string;\n    } & DefaultSession[\"user\"];\n  }\n\n  interface User {\n    id: string;\n    username?: string | null;\n    emailVerified?: Date | null;\n    role?: string;\n    tier?: string;\n  }\n}\n\ndeclare module \"next-auth/jwt\" {\n  interface JWT {\n    id?: string;\n    username?: string | null;\n    emailVerified?: Date | null;\n    role?: string;\n    tier?: string;\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\David\\next-dashboard\\types\\pdfkit.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]